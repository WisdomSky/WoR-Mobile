var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(o,n){function r(t){try{a(s.next(t))}catch(e){n(e)}}function h(t){try{a(s["throw"](t))}catch(e){n(e)}}function a(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(r,h)}a((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,r,h,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},SceneBase=function(t){function e(){var e=t.call(this)||this;return e["boolean"]=!1,e.shake=new Shake,e}return __extends(e,t),e.prototype.getCon=function(){return this.con},e.prototype.init=function(){GmGlobal.vmc.sceneLayer.addChildAt(this,0),this.con=new egret.DisplayObjectContainer,this.addChild(this.con),this.shadowLayer=new egret.DisplayObjectContainer,this.shadowLayer.touchEnabled=!1,this.shadowLayer.touchChildren=!1,this.unitLayer=new egret.DisplayObjectContainer,this.unitLayer.touchEnabled=!1,this.unitLayer.touchChildren=!1,this.titleLayer=new egret.DisplayObjectContainer,this.titleLayer.touchEnabled=!1,this.titleLayer.touchChildren=!1,this.npcTitleLayer=new egret.DisplayObjectContainer,this.npcTitleLayer.touchEnabled=!1,this.npcTitleLayer.touchChildren=!0,this.effectLayer=new egret.DisplayObjectContainer,this.effectLayer.touchEnabled=!1,this.effectLayer.touchChildren=!1,this.textLayer=new egret.DisplayObjectContainer,this.textLayer.touchEnabled=!1,this.textLayer.touchChildren=!1,this.con.addChild(this.shadowLayer),this.con.addChild(this.unitLayer),this.con.addChild(this.effectLayer),this.con.addChild(this.titleLayer),this.con.addChild(this.npcTitleLayer),this.con.addChild(this.textLayer)},e.prototype.addUnit=function(t){this.addToUnitLayer(t),t.type==UnitType.NPC?t.addToScene(this.shadowLayer,this.npcTitleLayer):t.addToScene(this.shadowLayer,this.titleLayer),this.sortTitle(t.title)},e.prototype.removeUnit=function(t){t&&t.removeFromScene()},e.prototype.addToUnitLayer=function(t){t.parent||(this.unitLayer.addChild(t),this.sortUnit(t))},e.prototype.addToUnitLayerNoSort=function(t){t.parent||this.unitLayer.addChild(t)},e.prototype.removeFromUnitLayer=function(t){t.parent&&this.unitLayer.removeChild(t)},e.prototype.sortUnit=function(t){this.sortChild(t,this.unitLayer)},e.prototype.sortChild=function(t,e){if(e.contains(t)){var i=e.getChildIndex(t),s=i;if(i==e.numChildren-1||t.y<=e.getChildAt(i+1).y)for(var o=i-1;o>-1;o--){if(t.y>e.getChildAt(o).y){s=o+1;break}s=o}else for(s=e.numChildren-1,o=i+1;o<e.numChildren;o++)if(t.y<=e.getChildAt(o).y){s=o;break}s!=i&&e.setChildIndex(t,s)}},e.prototype.sortTitle=function(t){this.sortChild(t,this.titleLayer)},e.prototype.addToEffectLayer=function(t){this.effectLayer.addChild(t)},e.prototype.addToShadowLayer=function(t){this.shadowLayer.addChild(t)},e.prototype.show=function(){this.parent||GmGlobal.vmc.sceneLayer.addChild(this)},e.prototype.hide=function(){this.parent&&GmGlobal.vmc.sceneLayer.removeChild(this)},e.prototype.clear=function(){this.isClear=!0,this.unitLayer.removeChildren(),this.shadowLayer.removeChildren(),this.effectLayer.removeChildren(),this.removeChildren(),this.shake.clear(),this.shake=null,this.parent&&GmGlobal.vmc.sceneLayer.removeChild(this),GmGlobal.res.destroyUnuseMCData()},e}(egret.DisplayObjectContainer);__reflect(SceneBase.prototype,"SceneBase");var BlockSceneBase=function(t){function e(){var e=t.call(this)||this;return e._scale=1,e}return __extends(e,t),e.prototype.getSceneType=function(){return this.map.type},e.prototype.getMapCfg=function(){return this.map},e.prototype.initScene=function(t,e,i){void 0===i&&(i=!0),this.map=t;var s=GmGlobal.mc.mapMgr.getBlockMapData(t.mapRes);if(this.mapData=s,this.blockMap=new BlockMapView(this.map.mapRes,s,e),this.con.addChildAt(this.blockMap,0),GmGlobal.stageHeight>1560){var o=GmGlobal.stageHeight/1560;this.scaleX=o,this.scaleY=o,this._scale=o,this._trueWidth=Math.floor(this.mapData.width*o),this._trueHeight=Math.floor(this.mapData.height*o)}else this._trueWidth=this.mapData.width,this._trueHeight=this.mapData.height;this.resize();var n,r;this._scenerys=[];for(var h=0;h<this.mapData.scenerys.length;h++)n=this.mapData.scenerys[h],r=new SceneryView(GmConst.MAP_DIR+this.map.mapRes+"/",n),3==n.type?this.addToEffectLayer(r):1==n.type?this.shadowLayer.addChildAt(r,0):this.addToUnitLayerNoSort(r),r.init(),n.name&&""!=n.name&&(r.touchEnabled=!0),EventBus.dispatchEvt(EventType.ADD_SCENERY,r),this._scenerys.push(r);this.initTile(),this.playBgMusic()},e.prototype.onYgDirChange=function(t){},e.prototype.onYaoganUp=function(){},e.prototype.onTouchEnd=function(t){YaoganView.instence().hide(),this.onYaoganUp()},e.prototype.resize=function(){this.mapData.width<GmGlobal.stageWidth?this.x=Math.floor((GmGlobal.stageWidth-this.mapData.width)/2):this.x=0,this.con.width=this.blockMap.width,this.con.height=this.blockMap.height,this._cx=Math.floor(GmGlobal.stageWidth/2),this._cy=Math.floor(GmGlobal.stageHeight/2),this.vport=new egret.Rectangle(0,0,GmGlobal.stageWidth,GmGlobal.stageHeight)},e.prototype.showGrid=function(){var t=new egret.Shape;this.con.addChildAt(t,1),t.graphics.lineStyle(1,16777215,.5);for(var e=0;e<this.mapData.grid.cols;e++)t.graphics.moveTo(e*this.mapData.grid.gridWidth,0),t.graphics.lineTo(e*this.mapData.grid.gridWidth,this.mapData.height);for(var i=0;i<this.mapData.grid.rows;i++)t.graphics.moveTo(0,i*this.mapData.grid.gridHeight),t.graphics.lineTo(this.mapData.width,i*this.mapData.grid.gridHeight);t.graphics.beginFill(14939726,.3);for(var e=0;e<this.mapData.grid.cols;e++)for(var i=0;i<this.mapData.grid.rows;i++)1==this.mapData.grid.barrierGrid[i][e]&&t.graphics.drawRect(e*this.mapData.grid.gridWidth,i*this.mapData.grid.gridHeight,this.mapData.grid.gridWidth,this.mapData.grid.gridHeight);this.pathShape=new egret.Shape,this.con.addChildAt(this.pathShape,2)},e.prototype.drawPath=function(t){this.pathShape.graphics.clear(),this.pathShape.graphics.beginFill(16711680,1);for(var e=0;e<t.length;e+=2)this.pathShape.graphics.drawRect(t[e]-12,t[e+1]-12,24,24);this.pathShape.graphics.endFill()},e.prototype.drawGrid=function(t,e){this.pathShape.graphics.clear(),this.pathShape.graphics.beginFill(16711680,1),this.pathShape.graphics.drawRect(24*e,24*t,24,24),this.pathShape.graphics.endFill()},e.prototype.updateFocus=function(t,e){var i=this,s=t-i._cx;0>s||i.con.width<=GmGlobal.stageWidth?s=0:s*i._scale>i._trueWidth-GmGlobal.stageWidth&&(s=(i._trueWidth-GmGlobal.stageWidth)/i._scale);var o=e-i._cy;0>o||i.con.height<=GmGlobal.stageHeight?o=0:o*i._scale>i._trueHeight-GmGlobal.stageHeight&&(o=(i._trueHeight-GmGlobal.stageHeight)/i._scale),i.vport.x=s,i.vport.y=o,i.con.scrollRect=i.vport,i.blockMap.updateViewPort(i.vport)},e.prototype.playBgMusic=function(){this.map&&this.map.bgMusic&&GmGlobal.sound.playBgm(this.map.bgMusic)},e.prototype.stopBgMusic=function(){GmGlobal.sound.stopBgm()},e.prototype.initTile=function(){this._tile=new Tile,this._tile.data=this.mapData.grid.barrierGrid,this._aStar=new AStar(this._tile,140)},e.prototype.findWay=function(t,e,i,s){var o=this._aStar.find(t,e,i,s);return o?o:null},e.prototype.findNearestValidPoint=function(t,e,i){for(var s=0;i>s;++s){var o=this.searchRound(t-s,e-s,2*(s+1)+1);if(o)return o}return null},e.prototype.searchRound=function(t,e,i){for(var s=new egret.Point,o=this.mapData.grid,n=e-1,r=0;i>r;++r)if(s.x=t+r,s.y=n,0==o.getBGCellValue(s.y,s.x))return s;var h=t+i-1;for(r=0;i>r;++r)if(s.x=h,s.y=e+r,0==o.getBGCellValue(s.y,s.x))return s;for(n=e+i-1,r=h;r>=t-1;--r)if(s.x=r,s.y=n,0==o.getBGCellValue(s.y,s.x))return s;for(h=t-1,r=n;r>=e-1;--r)if(s.x=h,s.y=r,0==o.getBGCellValue(s.y,s.x))return s;return null},e.prototype.isInTp=function(t,e){var i=this.mapData.tps;if(!i)return null;for(var s=0,o=i;s<o.length;s++){var n=o[s];if(n.x<=t&&n.x+n.width>=t&&n.y<=e&&n.y+n.height>=e)return n}return null},e.prototype.setSceneryVisible=function(t,e){if(this._scenerys)for(var i=0;i<this._scenerys.length;i++){var s=this._scenerys[i];s.scenery.name==t&&(s.visible=e)}},e.prototype.clearScene=function(){if(this._aStar&&(this._aStar=null),this._scenerys){for(var t=0;t<this._scenerys.length;t++){var e=this._scenerys[t];e.parent&&e.parent.removeChild(e),e.clear()}this._scenerys=null}this.blockMap&&(this.con.removeChild(this.blockMap),this.blockMap.clear()),this.mapData=null},e.prototype.clear=function(){this.clearScene(),YaoganView.instence().hide(),this.scrollView&&this.scrollView.parent&&this.removeChild(this.scrollView),this.scrollView=null,t.prototype.clear.call(this)},e}(SceneBase);__reflect(BlockSceneBase.prototype,"BlockSceneBase");var ActionUnitView=function(t){function e(){var e=t.call(this)||this;return e.mScale=1,e.aLoop=-1,e.isClear=!1,e.isBody=!1,e.isPause=!1,e.frameRate=8,e._dir=DirType.RIGHT,e.dirScale=1,e._alpha=1,e.isRelease=!1,e}return __extends(e,t),e.prototype.setInfo=function(t,e,i,s,o){void 0===o&&(o=ActionType.STAND),this.uid=t,this.action=o,this.resetModel(e,i,s)},e.prototype.resetModel=function(t,e,i){return this.resetHeight(e,i),this.resetScale(i),this.body&&this.res==t?void this.reuse():(this.res=t,this.clearBody(),void(null!=t&&this.loadModel()))},e.prototype.resetHeight=function(t,e){this.mHeight=t*e},e.prototype.resetScale=function(t){this.mScale=t,this.updateBodyScale()},e.prototype.updateBodyScale=function(){this.body&&(this.body.scaleX=this._dir<0?-this.mScale:this.mScale,this.body.scaleY=this.mScale)},e.prototype.loadModel=function(){GmGlobal.res.getMovieClipData(GmConst.MODEL_DIR,this.res,this.onLoaded,this)},e.prototype.onLoaded=function(t,e){this.isRelease||this.res!=e||(this.body=new egret.MovieClip(t.generateMovieClipData(this.res)),this.body&&(this.body.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromState,this),this.body.smoothing=!0,this.isBody=!0,this.updateBodyScale(),this.updateState(),this.addChildAt(this.body,0),this.onBodyLoaded()))},e.prototype.onBodyLoaded=function(){},e.prototype.updateState=function(){this.dir=this._dir,this.body.alpha=this._alpha,this.setAction(this.action||ActionType.STAND,this.aLoop),this.isPause?this.body.stop():this.body.isPlaying||this.body.gotoAndPlay(this.actionName,this.aLoop)},Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},set:function(t){this._dir=t,this.updateActionName(),this.body&&(t==DirType.LEFT||t==DirType.UP_LEFT||t==DirType.DOWN_LEFT?(this.body.scaleX=-this.mScale,this.dirScale=-1):(this.body.scaleX=this.mScale,this.dirScale=1),this.updateModel(),this.dirUpdate())},enumerable:!0,configurable:!0}),e.prototype.dirUpdate=function(){},e.prototype.setAlpha=function(t){this._alpha=t,this.body&&(this.body.alpha=t)},e.prototype.setAction=function(t,e,i,s){return void 0===e&&(e=-1),void 0===i&&(i=8),void 0===s&&(s=!1),this.body&&t==this.action&&e!=this.aLoop&&!s?(this.aLoop=e,void this.body.play(e)):(this.action=t,this.aLoop=e,this.frameRate=i,this.updateActionName(),void this.updateModel(s))},e.prototype.updateModel=function(t){if(void 0===t&&(t=!1),this.body&&this.actionName){if(this.body.currentLabel==this.actionName&&!t)return!1;if(Utils.hasLabel(this.body,this.actionName))return this.body.frameRate=this.frameRate,this.body.gotoAndPlay(this.actionName,this.aLoop),!0}return!1},e.prototype.updateActionName=function(){switch(this.action){case ActionType.STAND:this.actionName="stand-to";break;case ActionType.STAND_TO:this.actionName="stand-to";break;case ActionType.RUN:this.actionName="run_03";break;case ActionType.ATTACK:this.actionName="attack";break;case ActionType.SKILL:this.actionName="skill";break;default:this.actionName=null}},e.prototype.pause=function(){this.isPause=!0,this.body&&this.body.stop()},e.prototype.resume=function(){this.isPause=!1,this.body&&this.body.play()},e.prototype.clearBody=function(){return this.body?(this.body.stop(),this.body.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromState,this),this.body.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.body.parent&&this.removeChild(this.body),GmGlobal.res.releaseMCData(this.res,!1,this.onLoaded,this),this.body=null,void(this.isBody=!1)):void GmGlobal.res.stopMovieClipLoad(this.res,this.onLoaded,this)},e.prototype.onAddToStage=function(){this.body.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromState,this),this.body.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.body.play()},e.prototype.onRemoveFromState=function(){this.body.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromState,this),this.body.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.body.stop()},e.prototype.unuse=function(){this.clearBody(),this.isRelease=!0,this.res=null,this.aLoop=-1,this.alpha=1,this.filters=[]},e.prototype.reuse=function(){this.body&&(this.body.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromState,this),this.updateState())},e.prototype.clear=function(){this.clearBody(),this.action=null,this.isClear=!0},e}(egret.DisplayObjectContainer);__reflect(ActionUnitView.prototype,"ActionUnitView");var UIBase=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._ctime=0,e&&(i.skinName=e),i}return __extends(e,t),e.center=function(t){t.x=Math.floor((GmGlobal.stageWidth-t.width)/2),t.y=Math.floor((GmGlobal.stageHeight-t.height)/2)},e.aCenter=function(t){t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=GmGlobal.stageWidth/2,t.y=GmGlobal.stageHeight/2},e.prototype.bindCloseTirggerCmd=function(t,e){this._cCmd=t,this._cCmdArgs=e},e.prototype.childrenCreated=function(){this.isInit=!0,this.resize()},e.prototype.resize=function(){},e.prototype.show=function(t,e,i,s,o){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===s&&(s=.8),void 0===o&&(o=0),this.isShow||(this.isShow=!0,e?ModalWnd.doModal(t,this,i?this.maskClose:null,s,o):t.addChild(this),this.updatePos(),this.addEvts())},e.prototype.tweenShow=function(){this.scaleX=0,this.scaleY=0,egret.Tween.get(this).to({scaleX:1,scaleY:1},400,egret.Ease.backOut)},e.prototype.alphaShow=function(){this.alpha=0,egret.Tween.get(this).to({alpha:1},200);var t=ModalWnd.getModalWnd(this),e=ModalWnd.isFloorView(this.parent,this);t&&e&&(t.overlay.alpha=0,egret.Tween.get(t.overlay).to({alpha:t.alpha},200))},e.prototype.alphaClose=function(t,e){var i=ModalWnd.getModalWnd(this),s=ModalWnd.isFloorView(this.parent,this);i&&s&&egret.Tween.get(i.overlay).to({alpha:0},200),egret.Tween.get(this).to({alpha:0},200).call(t,e)},e.prototype.showAt=function(t,e){this.isShow||(this.isShow=!0,t.addChildAt(this,e),this.updatePos(),this.addEvts())},e.prototype.maskClose=function(){this.close()},e.prototype.close=function(){this.isShow&&(this.rmEvts(),GmGlobal.cc.dataCtl.clearReqCbByThis(this),this._ctime=egret.getTimer(),this.isShow=!1,this.alpha=1,this._cCmd&&(CmdBus.doCmd(this._cCmd,this._cCmdArgs),this._cCmd=null,this._cCmdArgs=null),this.parent&&this.parent.removeChild(this))},e.prototype.closeAndDestroy=function(){this.close(),this.destroy()},e.prototype.isDestroy=function(){return this.isShow?!1:egret.getTimer()-this._ctime>15e3},e.prototype.destroy=function(){this.isInit=!1},e}(eui.Component);__reflect(UIBase.prototype,"UIBase");var SceneView=function(t){function e(){var e=t.call(this)||this;return e._selBox=0,e._npcFcIdx=0,e._nextSkillId=-1,e._nextADis=0,e.otherRoles={},e.monsters={},e.npcs={},e.pets={},e.hbs={},e.boxs={},e.towers={},e.dropItems=[],e._hpTexts=[],e._skHpTexts=[],e._attackPoint=new egret.Point,e._cc=GmGlobal.cc,e._mc=GmGlobal.mc,e._smgr=e._mc.sceneMgr,e._role=e._mc.role,e._c=UnitViewCreator.instence(),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.unitLayer.touchChildren=!0},e.prototype.initScene=function(e,i,s){void 0===s&&(s=!0),t.prototype.initScene.call(this,e,i,s),this.initUI(),this.initUnit()},e.prototype.initUnit=function(){this.initHero(),this.addOtherRoles(),this.addMosnters(),this.addNpcs(),this.addPets(),this.addHbs(),this.addBox(),this.addTowers()},e.prototype.initUI=function(){this._smgr.mapType==SceneType.CITY||FubenType.isNoFightFb(this._smgr.mapId)||BattleSkillPanle.getInstence().show()},e.prototype.inited=function(){this.addListener();var t=GameTick.instence();t.startTick(),t.bindTick(this.updateUnitVisible,this);var e=this._mc.sceneMgr;if(e.fx&&e.fy){var i=Math.atan2(e.fy-this.roleView.point.y,e.fx-this.roleView.point.x),s=Utils.distence(e.fx,e.fy,this.roleView.point.x,this.roleView.point.y)-this.roleView.aDis+24,o=this.roleView.point.x+s*Math.cos(i),n=this.roleView.point.y+s*Math.sin(i);this.moveToPoint(o,n),e.fx=0,e.fy=0}},e.prototype.addListener=function(){FubenType.isNoTouch(this._mc.sceneMgr.mapId)||(this.unitLayer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchUnit,this),this.npcTitleLayer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNpcTitle,this),this.blockMap.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchMap,this)),EventBus.addListener(EventType.RESIZE,this.onResize,this),EventBus.addListener(EventType.S_CLOSE,this.onSocketClose,this),EventBus.addListener(EventType.M_RLV_UPD,this.onLvUp,this),EventBus.addListener(EventType.M_EXP_UPD,this.onExpUp,this),EventBus.addListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.addListener(EventType.TRIGGER_GUIDE,this.onTriggerGuide,this),EventBus.addListener(EventType.BUFF_ICON,this.onItemBuff,this),CmdBus.adListener(CmdType.BATTLE_ATTACK,this.doAttack,this),CmdBus.adListener(CmdType.DO_ZHUABU,this.doZhuabu,this),this._cc.dataCtl.regPbCb(PbMsgId.YCKJ_AW,this.onYckjAw,this)},e.prototype.removeListener=function(){FubenType.isNoTouch(this._mc.sceneMgr.mapId)||(this.unitLayer.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchUnit,this),this.npcTitleLayer.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNpcTitle,this),this.blockMap.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchMap,this)),EventBus.rmListener(EventType.RESIZE,this.onResize,this),EventBus.rmListener(EventType.S_CLOSE,this.onSocketClose,this),EventBus.rmListener(EventType.M_RLV_UPD,this.onLvUp,this),EventBus.rmListener(EventType.M_EXP_UPD,this.onExpUp,this),EventBus.rmListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.rmListener(EventType.TRIGGER_GUIDE,this.onTriggerGuide,this),EventBus.rmListener(EventType.BUFF_ICON,this.onItemBuff,this),CmdBus.rmListener(CmdType.BATTLE_ATTACK,this.doAttack,this),CmdBus.rmListener(CmdType.DO_ZHUABU,this.doZhuabu,this),this._cc.dataCtl.unRegPbCb(PbMsgId.YCKJ_AW)},e.prototype.onResize=function(){this.resize(),this.roleView&&this.updateFocus(this.roleView.point.x,this.roleView.point.y)},e.prototype.onSocketClose=function(){this._selUnitView=null,this.unlockView(),this._autoAttackAi&&this._autoAttackAi.stop(),this.removeAllRoles(),this.removeAllMonster(),this.removeAllPet()},e.prototype.initHero=function(){var t=this._smgr;if(this.roleView=this._c.createMyRoleView(),this.roleView.touchEnabled=!1,t.eX&&t.eY)this.roleView.resetPos(t.eX,t.eY);else{var e=Utils.random(this.mapData.drect.x,this.mapData.drect.x+Math.floor(Math.random()*this.mapData.drect.width)),i=Utils.random(this.mapData.drect.y,this.mapData.drect.y+Math.floor(Math.random()*this.mapData.drect.height));this.roleView.resetPos(e,i)}t.eDir?this.roleView.dir=t.eDir:this.roleView.dir=Utils.random(1,6),this.updateToushi(this.roleView),this.updateHalo(this.roleView),this.updateBaohu(this.roleView,this.roleView.unitData.bh),this.addUnit(this.roleView),this.updateFocus(this.roleView.point.x,this.roleView.point.y),this.roleView.bindSceneCb(this.onUnitMoving,this.onUnitMoveEnd,this),this.initItemBuff();var s=AutoReturnTask.getInstance();s.isTrigger&&s.start(this.roleView.x,this.roleView.y)},e.prototype.getMyPetHp=function(){return this.myPetView?this.myPetView.unitData.hp:0},e.prototype.isPosChange=function(t,e){return this.roleView.x!=t||this.roleView.y!=e?!0:!1},e.prototype.startAutoAttack=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._autoAttackAi=new AutoAttackAI(this.roleView,this.monsters,this.otherRoles);var i=this._mc.sceneMgr.lockType;i&&(this._autoAttackAi.lockType=i,this._mc.sceneMgr.lockType=0,this.myPetView&&(this.myPetView.lockType=i)),this._autoAttackAi.isPvp=t,this._autoAttackAi.isAutoTarget=e,this._autoAttackAi.start(),this.roleView.setAutoAi(this._autoAttackAi)},e.prototype.stopAutoAttack=function(){this._autoAttackAi&&(this._autoAttackAi.clear(),this._autoAttackAi=null,this.roleView.setAutoAi(null)),this.myPetView&&this.myPetView.stopAI()},e.prototype.lockUnitType=function(t,e,i){this._autoAttackAi&&(this._autoAttackAi.lockType=t,this._autoAttackAi.mToX=e,this._autoAttackAi.mToY=i,this.myPetView&&(this.myPetView.lockType=t)),this.moveToPoint(e,i)},e.prototype.getLockUnitType=function(){return this._autoAttackAi?this._autoAttackAi.lockType:0},e.prototype.getRoleView=function(){return this.roleView},e.prototype.updateUnitVisible=function(){for(var t in this.otherRoles){var e=this.otherRoles[t];this.vport.containsPoint(e.point)?e.parent||this.addUnit(e):e.parent&&this.removeUnit(e)}for(var t in this.monsters){var e=this.monsters[t];this.vport.containsPoint(e.point)?e.parent||(this.addUnit(e),this._selUnitView&&e==this._selUnitView&&e.title.show(!1)):e.parent&&this.removeUnit(e)}for(var t in this.npcs){var e=this.npcs[t];this.vport.containsPoint(e.point)?e.parent||this.addUnit(e):e.parent&&this.removeUnit(e)}for(var t in this.pets){var e=this.pets[t];this.vport.containsPoint(e.point)?e.parent||this.addUnit(e):e.parent&&this.removeUnit(e)}for(var t in this.hbs){var e=this.hbs[t];this.vport.containsPoint(e.point)?e.parent||this.addUnit(e):e.parent&&this.removeUnit(e)}},e.prototype.onUnitMoving=function(t){this.sortUnit(t),t==this.roleView&&(this.updateFocus(this.roleView.point.x,this.roleView.point.y),this._nextSkillId>=0&&this.moveCheckAttackDis())},e.prototype.onUnitMoveEnd=function(t){if(t==this.roleView){this.rmGbEffect(),this._autoAttackAi&&this._autoAttackAi.checkMoveTo();var e=this.isInTp(t.point.x,t.point.y);if(e){if("3"!=e.tomap)return void this._cc.dataCtl.pbReq(PbReqId.SCENE_TRANS,[e.tomap]);if(this._smgr.mapId==this._mc.yckjMgr.bossRranserId)return void this._cc.dataCtl.pbReq(PbReqId.SCENE_TRANS,[e.tomap])}if(this._selBox&&(this.onGetSceneBox(this._selBox),this._selBox=0),this._selUnitView)if(this._selUnitView.isFuncNpc){var i=this._selUnitView;this._selUnitView=null,this.triggerNpcFunc(i,this._npcFcIdx);var s=GmGlobal.vmc.mGuide,o=s.getCurrentStep();o&&o.id==GuideTargetId.MOVE_TO&&s.triggerTargetByID(GuideTargetId.MOVE_TO)}else this._nextSkillId>=0&&this.moveCheckAttackDis()}},e.prototype.moveCheckAttackDis=function(){this._selUnitView&&(0==this._nextSkillId?this.checkAttackDis(this.roleView.aDis>200?2:1)&&this.doNormlAttack():this._nextSkillId>0&&this.checkAttackDis(this._nextSkillType,this._nextADis)&&this.doSkillAttack(this._nextSkillId))},e.prototype.onGetSceneBox=function(t){var e=this.getBoxView(t);if(e){this._autoAttackAi&&this._autoAttackAi.stop();var i=BoxOpenView.getInstence();2==e.itemId?(i.openBox(t),this.onOpenBox()):(i.setBoxInfo(t,"Opening chest ...",2,this.onOpenBox,this),i.show(this))}},e.prototype.onOpenBox=function(){this.roleView.lockedView||this._selEffect&&this._selEffect.parent&&this._selEffect.parent.removeChild(this._selEffect),this._autoAttackAi&&this._autoAttackAi.start()},e.prototype.onTouchUnit=function(t){if(t.target.type==UnitType.BOX){if(this.roleView.isDead)return;if(this.roleView.attackData.skillId>0)return void MsgBox.prompt("Casting skill");0==this.roleView.attackData.skillId&&this.roleView.stopNormalAttack(),Utils.distence(t.target.x,t.target.y,this.roleView.x,this.roleView.y)<50?this.onGetSceneBox(t.target.uid):(this._selBox=t.target.uid,this.moveToPoint(t.target.x,t.target.y,!1,!1),this.unlockView(),this.showSelEffect(t.target.x,t.target.y))}else if(t.target.uid&&t.target.type){var e=this.getSceneUnitView(t.target.uid,t.target.type);if(e&&e!=this.roleView&&e!=this.myPetView){if(e.type==UnitType.ROLE){if(this.roleView.unitData.bh)return void MsgBox.prompt("Can’t attack players in Peace mode.");if(e.unitData.bh)return void MsgBox.prompt("The target is in protection, can’t attack.")}this.rmGbEffect(),e.isFuncNpc?this.triggerNpcFunc(e):this.selTarget(e,!0,!0)}}},e.prototype.onNpcTitle=function(t){var e=t.target;if(e.typeId){var i=this.getNpcUnitView(e.typeId);this.triggerNpcFunc(i)}},e.prototype.triggerNpcFunc=function(t,e){void 0===e&&(e=0),t&&t.isFuncNpc&&(Utils.distence(t.point.x,t.point.y,this.roleView.point.x,this.roleView.point.y)<=120?6701==t.typeId?this._mc.guideMgr.isModeuleOpen(ModelID.EQUIP,!0)&&CmdBus.doCmd(CmdType.O_EQUIP,e):6702==t.typeId?this._mc.guideMgr.isModeuleOpen(ModelID.TOUSHI,!0)&&CmdBus.doCmd(CmdType.O_TOUSHI_M):6703==t.typeId?this._mc.guideMgr.isModeuleOpen(ModelID.TRADE,!0)&&CmdBus.doCmd(CmdType.O_TRADE):6704==t.typeId?this._mc.guideMgr.isModeuleOpen(ModelID.KAPULA,!0)&&CmdBus.doCmd(CmdType.O_KAPULA):6705==t.typeId&&this._mc.guideMgr.isModeuleOpen(ModelID.GONGHUI,!0)&&(this._mc.ghMgr.id?CmdBus.doCmd(CmdType.O_GONGHUI,e):CmdBus.doCmd(CmdType.O_GONGHUI_C)):this.moveToNpc(t))},e.prototype.moveToNpc=function(t,e){void 0===e&&(e=0),this._selUnitView=t,this._npcFcIdx=e;var i=Math.atan2(this.roleView.point.y-t.point.y,this.roleView.point.x-t.point.x),s=t.point.x+72*Math.cos(i),o=t.point.y+72*Math.sin(i);this.moveToPoint(s,o,!1)},e.prototype.checkAttackDis=function(t,e){if(void 0===t&&(t=1),void 0===e&&(e=0),1==t)this.updateAttackPoint(this.roleView.point,this._selUnitView.point,this.roleView.aDis,this._attackPoint);else{var i=this.roleView.point,s=this._selUnitView.point,o=Math.atan2(i.y-s.y,i.x-s.x),n=(e||this.roleView.aDis)-34;this._attackPoint.x=s.x+Math.cos(o)*n,this._attackPoint.y=s.y+Math.sin(o)*n}var r=Utils.distence(this.roleView.point.x,this.roleView.point.y,this._selUnitView.point.x,this._selUnitView.point.y),h=Utils.distence(this._selUnitView.point.x,this._selUnitView.point.y,this._attackPoint.x,this._attackPoint.y);if(h+24>=r)return!0;var a=this.mapData.grid.gridWidth,l=this.mapData.grid.gridHeight,c=Math.floor(this._attackPoint.y/a),d=Math.floor(this._attackPoint.x/l);if(0!=this.mapData.grid.barrierGrid[c][d]){var p=Math.atan2(this.roleView.point.y-this._selUnitView.point.y,this.roleView.point.x-this._selUnitView.point.x),u=this.mapData.getFarGrid(this._selUnitView.point.x,this._selUnitView.point.y,p);if(u){this._attackPoint.x=(u.x+.5)*a,this._attackPoint.y=(u.y+.5)*l;var m=Utils.distence(this._attackPoint.x,this._attackPoint.y,this._selUnitView.x,this._selUnitView.y),n=(e||this.roleView.aDis)-34;m>=n&&(this._attackPoint.x=this._selUnitView.x,this._attackPoint.y=this._selUnitView.y)}}return!1},e.prototype.updateAttackPoint=function(t,e,i,s){var o=Math.atan2(t.y-e.y,t.x-e.x),n=i-34,r=this.mapData.grid.gridWidth,h=0,a=e.y+n*Math.sin(o);a<e.y&&a-e.y<-r?a=e.y-r:a>e.y&&a-e.y>r&&(a=e.y+r);var l=Math.abs(a-e.y),c=Math.sqrt(n*n-l*l);h=t.x<e.x?e.x-c:e.x+c,s.y=a,Math.abs(h-e.x)<Math.abs(t.x-e.x)?s.x=h:s.x=t.x},e.prototype.lockedView=function(t){if(this.roleView.lockedView){if(this.roleView.lockedView==t)return;this.roleView.lockedView.selEffect=null}if(this.roleView.lockedView=t,this.showSelEffect(t.x,t.y,t),t.isBoss&&this._mc.sceneMgr.mapId!=FubenType.SWSX){var e=BossHpBar.getInstance();e.show(GmGlobal.vmc.sceneLayer),e.setInfo(t.uid,t.uName,t.unitData.hp,t.unitData.hpMax),e.setHp(t.unitData.hp)}this._autoAttackAi&&0==this.roleView.attackData.skillId&&this.roleView.stand()},e.prototype.showSelEffect=function(t,e,i){if(void 0===i&&(i=null),this._selEffect||(this._selEffect=new eui.Image("seleffect_png"),this._selEffect.anchorOffsetX=37,this._selEffect.anchorOffsetY=16),this._selEffect.x=t,this._selEffect.y=e,i&&(i.selEffect=this._selEffect),!this._selEffect.parent)if(i){var s=this.shadowLayer.getChildIndex(i.shadow);this.shadowLayer.addChildAt(this._selEffect,s)}else this.shadowLayer.addChild(this._selEffect)},e.prototype.unlockView=function(){this.roleView.lockedView&&(this._selEffect&&this._selEffect.parent&&this._selEffect.parent.removeChild(this._selEffect),this.roleView.lockedView.selEffect=null,this.roleView.lockedView=null,this._nextSkillId=-1,this._nextSkillType=0)},e.prototype.moveToDefultPoint=function(){if(!this.mapData.drect.containsPoint(this.roleView.point)){var t=this.mapData.drect.x+this.mapData.drect.width/2,e=this.mapData.drect.y+this.mapData.drect.height/2;this.moveToPoint(t,e)}},e.prototype.selTarget=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this._selUnitView&&this._selUnitView!=t&&this._selUnitView.title.show(!0),t.team&&t.team==this.roleView.team||(t.type==UnitType.MONSTER&&(t.title.show(!1),i&&this.getSceneType()==SceneType.WILD&&this._autoAttackAi&&(this._autoAttackAi.lockType=t.typeId)),this._selUnitView=t,this.lockedView(t),e&&this.chackFree()&&this.checkDisAndAttack())},e.prototype.checkDisAndAttack=function(){this.checkAttackDis(this.roleView.aDis>200?2:1)?this.doNormlAttack():(this._nextSkillId=0,this._nextADis=this.roleView.aDis,this.moveToPoint(this._attackPoint.x,this._attackPoint.y))},e.prototype.doNormlAttack=function(){this.chackFree()&&this._selUnitView&&0!=this.roleView.attackData.skillId&&(this.roleView.action==ActionType.RUN&&this.roleView.stand(),e.resetDirByTarget(this.roleView,this._selUnitView),this._cc.sceneCtl.reqUnitAttack(this.roleView.point.x,this.roleView.point.y,this._selUnitView.uid,this._selUnitView.type))},e.prototype.doSkillAttack=function(t){if(!this.chackFree())return!1;var i=this._mc.skillMgr.getSkillCfg(t);return i.needTarget&&!this._selUnitView?(MsgBox.prompt("No target"),!1):(this._selUnitView&&e.resetDirByTarget(this.roleView,this._selUnitView),this.roleView.action==ActionType.RUN&&this.roleView.stand(),!i.needTarget||this.checkAttackDis(i.atype||1,i.adis)?(this._cc.sceneCtl.reqUnitSkill(this.roleView.point.x,this.roleView.point.y,this._selUnitView?this._selUnitView.uid:0,this._selUnitView?this._selUnitView.type:0,t),!0):(this._nextSkillId=t,this._nextSkillType=i.atype,this._nextADis=i.adis,this.moveToPoint(this._attackPoint.x,this._attackPoint.y),!1))},e.prototype.chackFree=function(){return this.roleView.isDead||this.roleView.isBingdong||this.roleView.isXuanyun?!1:this.roleView.attackData.skillId>0?!1:!0},e.prototype.onTouchMap=function(t){this.chackFree()&&(this.clearSelUnit(),this._autoAttackAi&&this._autoAttackAi.clearMoveTo(),this.moveToPoint(t.localX,t.localY,!0,!0))},e.prototype.showGbEffect=function(t,e){this._gbEffect||(this._gbEffect=new MovieClipEx("shubiao")),this._gbEffect.x=t,this._gbEffect.y=e,this.unitLayer.addChild(this._gbEffect),this._gbEffect.play()},e.prototype.rmGbEffect=function(t){void 0===t&&(t=!1),this._gbEffect&&(this._gbEffect.stop(),this._gbEffect.parent&&this._gbEffect.parent.removeChild(this._gbEffect),t&&(this._gbEffect.clear(),this._gbEffect=null))},e.prototype.clearSelUnit=function(){this._selUnitView&&(this._selUnitView=null,this.unlockView())},e.prototype.onYgDirChange=function(t){if(this.chackFree()){this.clearSelUnit();
var e=this.mapData.getFarGrid(this.roleView.point.x,this.roleView.point.y,t);if(e){var i=this.mapData.grid.getRowByY(this.roleView.point.y),s=this.mapData.grid.getColByX(this.roleView.point.x);if(i!=e.y||s!=e.x){var o=[Math.floor((e.x+.5)*this.mapData.grid.gridWidth),Math.floor((e.y+.5)*this.mapData.grid.gridHeight)],n=this.roleView.dir,r=Utils.getDir(Math.round(180*t/Math.PI),n);r&&(n=r),this._cc.sceneCtl.reqSceneMove(this.roleView.point.x,this.roleView.point.y,o,n)&&(this.roleView.action!=ActionType.STAND&&this.roleView.action!=ActionType.RUN&&this.roleView.stand(),this.roleView.movePath(o))}}}},e.prototype.onYaoganUp=function(){this.chackFree()&&this.roleView.reqStop()},e.prototype.moveToPoint=function(t,e,i,s){void 0===i&&(i=!0),void 0===s&&(s=!1);var o=this.getMoveMath(t,e,this.roleView.point.x,this.roleView.point.y);if(!o||0==o.length)return!1;for(var n=[],r=0;r<o.length;r++)n.push(Math.floor((o[r][1]+.5)*this.mapData.grid.gridWidth),Math.floor((o[r][0]+.5)*this.mapData.grid.gridHeight));if(2==n.length&&this.roleView.point.x==n[0]&&this.roleView.point.y==n[1])return!1;var h=this.roleView.dir,a=0,l=0;if(n.length>3){var c=n.length;l=Math.atan2(n[c-1]-n[c-3],n[c-2]-n[c-4])}else l=Math.atan2(n[1]-this.roleView.point.y,n[0]-this.roleView.point.x);a=Math.round(180*l/Math.PI);var d=Utils.getDir(a,h);return d&&(h=d),this._cc.sceneCtl.reqSceneMove(this.roleView.point.x,this.roleView.point.y,n,h,i)?(s&&this.showGbEffect(n[n.length-2],n[n.length-1]),this.roleView.action!=ActionType.STAND&&this.roleView.action!=ActionType.RUN&&this.roleView.stand(),this.roleView.movePath(n),!0):!1},e.prototype.aiMoveToPath=function(t,e,i){var s=this.getMoveMath(e,i,t.point.x,t.point.y);if(s&&0!=s.length){for(var o=[],n=0;n<s.length;n++)o.push(Math.floor((s[n][1]+.5)*this.mapData.grid.gridWidth),Math.floor((s[n][0]+.5)*this.mapData.grid.gridHeight));if(2!=o.length||t.point.x!=o[0]||t.point.y!=o[1]){var r=t.dir,h=0,a=0;if(o.length>3){var l=o.length;a=Math.atan2(o[l-1]-o[l-3],o[l-2]-o[l-4])}else a=Math.atan2(o[1]-t.point.y,o[0]-t.point.x);h=Math.round(180*a/Math.PI);var c=Utils.getDir(h,r);c&&(r=c),this._cc.sceneCtl.reqAiSceneMove(t.uid,t.point.x,t.point.y,o,r)}}},e.prototype.petMoveToPath=function(t,e,i){var s=this.getMoveMath(e,i,t.point.x,t.point.y);if(s&&0!=s.length){for(var o=[],n=0;n<s.length;n++)o.push(Math.floor((s[n][1]+.5)*this.mapData.grid.gridWidth),Math.floor((s[n][0]+.5)*this.mapData.grid.gridHeight));if(2!=o.length||t.point.x!=o[0]||t.point.y!=o[1]){var r=t.dir,h=0,a=0;if(o.length>3){var l=o.length;a=Math.atan2(o[l-1]-o[l-3],o[l-2]-o[l-4])}else a=Math.atan2(o[1]-t.point.y,o[0]-t.point.x);h=Math.round(180*a/Math.PI);var c=Utils.getDir(h,r);c&&(r=c),this.myPetView==t&&this._cc.sceneCtl.reqPetMove(t.point.x,t.point.y,o,r),t.action!=ActionType.STAND&&t.action!=ActionType.RUN&&t.stand(),t.movePath(o)}}},e.prototype.getMoveMath=function(t,e,i,s){if(0>=t||0>=e)return null;var o=this.mapData.grid.gridWidth,n=this.mapData.grid.gridHeight,r=Math.floor(s/o),h=Math.floor(i/n),a=Math.floor(e/o),l=Math.floor(t/n);if(0!=this.mapData.grid.barrierGrid[a][l]){var c=this.findNearestValidPoint(l,a,15);if(!c)return;var d=this.findWay(r,h,c.y,c.x);if(d)return d}else{var d=this.findWay(r,h,a,l);if(d)return d.length>1&&d.shift(),d}return null},e.prototype.addNpcs=function(){var t=this._mc.npcMgr.getMapNpcs(this._smgr.mapId);if(t)for(var e=this._c,i=0,s=t;i<s.length;i++){var o=s[i],n=e.createNpcView(o.id);n&&(n.resetPos(o.x,o.y),this.addUnit(n),this.npcs[n.uid]=n)}},e.prototype.addOtherRoles=function(){var t=this._smgr.othRoles;for(var e in t)this.createRoleView(t[e])},e.prototype.addMosnters=function(){var t=this._smgr.monsters;for(var e in t)this.createMosnter(t[e],!0)},e.prototype.addPets=function(){var t=this._smgr.pets;for(var e in t)this.createPetView(t[e])},e.prototype.addHbs=function(){var t=this._smgr.hbs;for(var e in t)this.createHbView(t[e])},e.prototype.addBox=function(){var t=this._smgr.boxs;for(var e in t)this.createBoxView(t[e])},e.prototype.addTowers=function(){var t=this._smgr.towers;for(var e in t)this.createTowerView(t[e])},e.prototype.unitEnter=function(t){for(var e=(this._c,this._smgr.othRoles,this._smgr.monsters,0),i=t;e<i.length;e++){var s=i[e];s.type==UnitType.ROLE?this.createRoleView(s):s.type==UnitType.MONSTER?this.createMosnter(s):s.type==UnitType.PET?this.createPetView(s):s.type==UnitType.HUOBAN?this.createHbView(s):s.type==UnitType.BOX?this.createBoxView(s):s.type==UnitType.TOWER&&this.createTowerView(s)}},e.prototype.createRoleView=function(t){if(!this.otherRoles[t.uid]){var e=this._c.createRoleView(t);return this._smgr.mapType==SceneType.CITY?e.touchEnabled=!1:e.touchEnabled=!0,e.resetPos(t.x,t.y),this.updateToushi(e),this.updateHalo(e),this.updateBaohu(e,e.unitData.bh),this.addUnit(e),e.bindSceneCb(this.onUnitMoving,this.onUnitMoveEnd,this),this.otherRoles[t.uid]=e,0==t.arg.hp?(e.isDead=!0,e.filters=FilterUtils.disabled()):t.path&&t.path.length>0?e.movePath(t.path):t.action==ActionType.ATTACK&&(t.arg.uid=t.uid,t.arg.type=t.type,t.arg.x=t.x,t.arg.y=t.y,this.onUnitNormalAttack(e,t.arg)),e}return null},e.prototype.unitExit=function(t){for(var e=0;e<t.length;e+=2){var i=t[e],s=t[e+1];this.clearSelUnitByID(i,s),s==UnitType.ROLE?this.otherRoleExit(i):s==UnitType.MONSTER?this.monsterExit(i):s==UnitType.PET?this.petExit(i):s==UnitType.HUOBAN?this.hbExit(i):s==UnitType.BOX&&this.boxExit(i)}},e.prototype.otherRoleExit=function(t){var e=this.otherRoles[t];e&&(e.stand(),this.removeUnit(e),this._c.releaseRoleView(e),delete this.otherRoles[t])},e.prototype.monsterExit=function(t){var e=this.monsters[t];if(e&&!e.isDead){if(e.stand(),this.removeUnit(e),e.isBoss&&BossHpBar.isShow){var i=BossHpBar.getInstance();i.uid==e.uid&&i.close()}this._c.releaseMonsterView(e),delete this.monsters[t]}},e.prototype.petExit=function(t){if(this.myPetView&&this.myPetView.uid==t)this.myPetView.stand(),this.myPetView.stopAI(),this.removeUnit(this.myPetView),this.myPetView=null;else{var e=this.pets[t];if(!e||e.isDead)return;delete this.pets[t],e.stand(),this.removeUnit(e),this._c.releasePetView(e)}},e.prototype.hbExit=function(t){var e=this.hbs[t];e&&!e.isDead&&(delete this.hbs[t],e.stand(),this.removeUnit(e),this._c.releaseHbView(e))},e.prototype.boxExit=function(t){var e=this.boxs[t];e&&(delete this.boxs[t],this.removeFromUnitLayer(e))},e.prototype.createMosnter=function(t,e){if(void 0===e&&(e=!1),!this.monsters[t.uid]){var i=this._c.createMonsterView(t);if(!i)return;if(i.resetPos(t.x,t.y),this.addUnit(i),i.bindSceneCb(this.onUnitMoving,this.onUnitMoveEnd,this),this.monsters[t.uid]=i,t.path?i.movePath(t.path):t.action==ActionType.ATTACK&&(t.arg.uid=t.uid,t.arg.type=t.type,t.arg.x=t.x,t.arg.y=t.y,this.onUnitNormalAttack(i,t.arg)),!i.isBoss&&!e){var s=McEffect.create("chunsong001-006");s.show(this.shadowLayer,t.x,t.y,.5,.5),i.alphaShow()}}},e.prototype.createPetView=function(t){var e=t.arg.rid==this.roleView.uid?!0:!1;e&&this.myPetView&&this.myPetView.uid!=t.uid&&(this.myPetView.stand(),this.myPetView.stopAI(),this.removeUnit(this.myPetView),this.myPetView=null);var i=this._c.createPetView(t,e);i&&(this._smgr.mapType==SceneType.CITY?i.touchEnabled=!1:i.touchEnabled=!0,e&&(this.myPetView=i,this.myPetView.startAI(this.roleView),this._autoAttackAi&&(this.myPetView.lockType=this._autoAttackAi.lockType)),i.resetPos(t.x,t.y),this.addUnit(i),i.bindSceneCb(this.onUnitMoving,this.onUnitMoveEnd,this),e||(this.pets[t.uid]=i),t.path?i.movePath(t.path):t.action==ActionType.ATTACK&&(t.arg.x=t.x,t.arg.y=t.y,this.onUnitNormalAttack(i,t.arg)))},e.prototype.createHbView=function(t){var e=this._c.createHbView(t);e&&(e.resetPos(t.x,t.y),this.addUnit(e),e.bindSceneCb(this.onUnitMoving,this.onUnitMoveEnd,this),this.hbs[t.uid]=e,t.path?e.movePath(t.path):t.action==ActionType.ATTACK&&(t.arg.x=t.x,t.arg.y=t.y,this.onUnitNormalAttack(e,t.arg)))},e.prototype.createBoxView=function(t){if(!this.boxs[t.uid]){var e;1==t.arg.itemid?(e=new SceneBox(t.uid,"moku_box_png"),e.anchorOffsetX=48,e.anchorOffsetY=80):2==t.arg.itemid&&(e=new SceneBox(t.uid,"mm_model_png",2),e.anchorOffsetX=46,e.anchorOffsetY=80),e&&(e.x=t.x,e.y=t.y,this.addToUnitLayer(e),this.boxs[t.uid]=e)}},e.prototype.createTowerView=function(t){if(!this.towers[t.uid]){var e;if(1==t.arg.itemid){e=new TowerUnitView(t.uid,"sx_model_png",80,354);var i=TowerHpBar.getInstance();i.setInfo(t.uid,"Statue",t.arg.hp,t.arg.hm)}e&&(e.x=t.x,e.y=t.y,e.setHp(t.arg.hp,t.arg.hm),this.blockMap.addChild(e),this.towers[t.uid]=e)}},e.prototype.resetUnitPos=function(t,e,i){t.resetPos(e,i),this.sortUnit(t)},e.prototype.resetMyRolePos=function(t){this.resetUnitPos(this.roleView,t.x,t.y),this.updateFocus(this.roleView.point.x,this.roleView.point.y)},e.prototype.unitStand=function(t){var e=this.getSceneUnitView(t.uid,t.type);e&&(e.action!=ActionType.STAND&&e.action!=ActionType.RUN?(e.attackData.skillId=-1,e.fightStand()):e.stand(),this.resetUnitPos(e,t.x,t.y),t.uid==this.roleView.uid&&this.updateFocus(this.roleView.point.x,this.roleView.point.y))},e.prototype.unitMove=function(t){t.type==UnitType.ROLE?this.onRoleMove(t):t.type==UnitType.MONSTER?this.onMonsterMove(t):t.type==UnitType.PET?this.onPetMove(t):t.type==UnitType.HUOBAN&&this.onHbMove(t)},e.prototype.onRoleMove=function(t){var e=this.otherRoles[t.uid];e&&((e.action!=ActionType.STAND||e.action!=ActionType.STAND_TO)&&e.stand(),t.direct!=e.dir&&this.resetUnitPos(e,t.x,t.y),t.path&&(e.speed=t.speed||GmConst.ROLE_SPEED,e.movePath(t.path)))},e.prototype.onMonsterMove=function(t){var e=this.monsters[t.uid];e&&(this.resetUnitPos(e,t.x,t.y),t.path&&e.movePath(t.path))},e.prototype.onPetMove=function(t){var e;e=this.myPetView&&t.uid==this.myPetView.uid?this.myPetView:this.pets[t.uid],e&&((e.action!=ActionType.STAND||e.action!=ActionType.STAND_TO)&&e.stand(),this.resetUnitPos(e,t.x,t.y),t.path&&(e.speed=t.speed||GmConst.ROLE_SPEED,e.movePath(t.path)))},e.prototype.onHbMove=function(t){var e=this.hbs[t.uid];e&&(this.resetUnitPos(e,t.x,t.y),t.path&&e.movePath(t.path))},e.prototype.onUnitAttack=function(t){if(t.type==UnitType.ROLE&&t.uid==this.roleView.uid)this.resetUnitPos(this.roleView,t.x,t.y),this.onUnitNormalAttack(this.roleView,t);else{var e=this.getSceneUnitView(t.uid,t.type);e&&!e.isDead&&(this.resetUnitPos(e,t.x,t.y),this.onUnitNormalAttack(e,t))}},e.prototype.onUnitSkill=function(t){if(t.type==UnitType.ROLE&&t.uid==this.roleView.uid)this.resetUnitPos(this.roleView,t.x,t.y),this.onUnitSkillAttack(t,this.roleView),CmdBus.doCmd(CmdType.BATTLE_USE_SKILL,t.atk.sk,0,2);else{var e=this.getSceneUnitView(t.uid,t.type);e&&!e.isDead&&(this.resetUnitPos(e,t.x,t.y),this.onUnitSkillAttack(t,e))}},e.prototype.checkAtkMe=function(t,e){this._smgr.mapType==SceneType.WILD&&t.type==UnitType.ROLE&&e==this.roleView&&(this.roleView.lockedView&&this.roleView.lockedView.type==UnitType.ROLE||(this._selUnitView=t,this.lockedView(t)))},e.prototype.onUnitNormalAttack=function(t,i){if(t.action==ActionType.RUN&&t.stand(),this.resetUnitPos(t,i.x,i.y),i.atk){var s=this.getSceneUnitView(i.atk.mb,i.atk.type);s?(e.resetDirByTarget(t,s),this.checkAtkMe(t,s)):this.resetDirByPos(t,i.atk.x,i.atk.y);var o=t.attackData;o.attacker=t.uid,o.attackerType=t.type,o.defender=i.atk.mb,o.defenderType=i.atk.type,o.fdhp=i.dhp1,o.fbj=i.dbj1,s?(o.targetX=s.point.x,o.targetY=s.point.y,o.targetH=s.mHeight):(o.targetX=i.atk.x,o.targetY=i.atk.y,o.targetH=0),o.skillId=0,o.efNum=0,t.normalAttack(i.atk.as)}},e.prototype.onUnitSkillAttack=function(t,i){(i.action==ActionType.RUN||0==i.attackData.skillId)&&i.stand();var s=this.getSceneUnitView(t.atk.mb,t.atk.type);s&&(e.resetDirByTarget(i,s),this.checkAtkMe(i,s));var o=i.attackData;o.attacker=i.uid,o.attackerType=i.type,o.skillId=t.atk.sk,o.duration=t.atk.tm||0,o.efNum=t.atk.c||0,s&&(o.defender=s.uid,o.defenderType=t.atk.type,o.targetX=s.point.x,o.targetY=s.point.y,o.targetH=s.mHeight),i.skillAttack(o.skillId)},e.prototype.unitDead=function(t){var e=t[0],i=t[1],s=t.length>2?t[2]:0;if(e==this.roleView.uid&&i==UnitType.ROLE)this.doMyRoleDead();else if(i==UnitType.TOWER){var o=this.towers[e];this.blockMap.removeChild(o),delete this.towers[e]}else{var n=this.getSceneUnitView(e,i);if(n&&(n.stand(),n.unitData.hp=0,n.title.updateHP(n.unitData.hp),i==UnitType.MONSTER&&s==this.roleView.uid&&(this._smgr.mapType==SceneType.WILD&&this.showMonsterExp(n.typeId),EventBus.dispatchEvt(EventType.MONSTER_DEAD,n.typeId)),this.doUnitDead(e,n.type),n.isBoss&&(this._bossPos||(this._bossPos=new egret.Point),this._bossPos.x=n.point.x,this._bossPos.y=n.point.y),n==this.roleView.lockedView&&(this._lastMsgPos||(this._lastMsgPos=new egret.Point),this._lastMsgPos.x=n.point.x,this._lastMsgPos.y=n.point.y),n.dead(!0),n.isBoss&&BossHpBar.isShow)){var r=BossHpBar.getInstance();r.uid==n.uid&&r.close()}}},e.prototype.unitUpdateData=function(t){var e=this.getSceneUnitView(t.uid,t.type);if(e){if((0==t.effect.ts||t.effect.ts)&&(e.unitData.ts=t.effect.ts,this.updateToushi(e)),(0==t.effect.gh||t.effect.gh)&&(e.unitData.halo=t.effect.gh,this.updateHalo(e)),(0==t.effect.fhz||t.effect.fhz)&&(e.unitData.bh=t.effect.fhz,this.updateBaohu(e,t.effect.fhz)),(0==t.effect.ch||t.effect.ch)&&e.type==UnitType.ROLE){e.unitData.ch=t.effect.ch;var i=e;i.addChenghao(t.effect.ch,e.title.parent,-e.mHeight)}if((0==t.effect.team||t.effect.team)&&(e.team=t.effect.team),0==t.effect.hp||t.effect.hp){if(e.title.updateHP(t.effect.hp),e.unitData.hp=t.effect.hp,e.isBoss&&BossHpBar.isShow){var s=BossHpBar.getInstance();s.uid==e.uid&&s.setHp(t.effect.hp)}if(t.type==UnitType.ROLE)if(t.uid==this.roleView.uid){var o=t.effect.hp-this._role.hp;this._role.hp=t.effect.hp,EventBus.dispatchEvt(EventType.S_HP_CH,o>0?o:null),0==this.roleView.unitData.hp&&this.doMyRoleDead()}else 0==e.unitData.hp&&(e.stand(),e.isDead=!0,e.filters=FilterUtils.disabled(),e.removeAllBuff(),this.clearSelUnit())}if(t.effect.bf)for(var n in t.effect.bf){var r=t.effect.bf[n];r?e.addBuff(Number(n),r):e.removeBuff(Number(n))}if(t.effect.name){e.uName=t.effect.name,e.title.setName(t.effect.name);var h=this.getPetViewByRoleId(e.uid);if(h){var a=this._mc.npcMgr.getNpcCfg(h.typeId);a&&h.title.setName(a.name+" of "+e.uName)}}if(void 0!=t.effect.gname&&e.title.setGonghui(t.effect.gname),t.effect.fuhuo&&(e.isDead=!1,e.filters=[],t.type==UnitType.ROLE)){var l=McEffect.create("fuhuo");l.show(e,0,0),t.uid==this.roleView.uid&&FuHuoView.release()}}},e.prototype.battleHp=function(t,e){if(t.title.updateHP(e),t.unitData.hp=e,t.isBoss&&BossHpBar.isShow){var i=BossHpBar.getInstance();i.uid==t.uid&&i.setHp(e)}if(t.type==UnitType.ROLE)if(t.uid==this.roleView.uid){var s=e-this._role.hp;this._role.hp=e,EventBus.dispatchEvt(EventType.S_HP_CH,s>0?s:null),0==this.roleView.unitData.hp&&this.doMyRoleDead()}else 0==t.unitData.hp&&(t.stand(),t.isDead=!0,t.filters=FilterUtils.disabled(),t.removeAllBuff(),this.clearSelUnit())},e.prototype.battleSb=function(t){var e=this.getSceneUnitView(t.uid,t.type||2);e&&this.showSkillHpTxt(0,e.point.x,e.point.y,e.mHeight,1,"sb")},e.prototype.battleNormalHurt=function(t){if(t.type!=UnitType.TOWER){var e=this.getSceneUnitView(t.uid,t.type||2);if(e){this.battleHp(e,t.hp);var i=e.attackData.ax=t.x||0,s=e.attackData.ay=t.y||0,o=e.dirScale;i>0&&s>0&&(o=i<e.point.x?1:-1);var n=null;t.bj&&(n="bj"),t.auid==this.roleView.uid&&("bj"==n?GmGlobal.sound.playSoundEffect("baoji"):GmGlobal.sound.playSoundEffect(this._nHitSound)),this.showHpTxt(t.uid,t.type,o,t.dhp,e.point.x,e.point.y,e.mHeight,n)}}else{var r=this.towers[t.uid];if(r){r.updHp(t.hp);var h=TowerHpBar.getInstance();h.uid==t.uid&&h.setHp(t.hp),h.show(GmGlobal.vmc.uiLayer)}}},e.prototype.battleSkillHurt=function(t){var e=this.getSceneUnitView(t.uid,t.type||2);if(e){this.battleHp(e,t.hp);var i=null;t.bj&&(i="bj"),this.showSkillHpTxt(t.dhp,e.point.x,e.point.y,e.mHeight,t.cnt||1,i)}},e.prototype.battleFjHurt=function(t){var e=this.getSceneUnitView(t.uid,t.type||2);e&&(this.battleHp(e,t.hp),this.showHpTxt(t.uid,t.type,e.dirScale,t.dhp,e.point.x,e.point.y,e.mHeight,null))},e.prototype.updateRoleHp=function(t){this.roleView.title.updateHP(t),this.roleView.unitData.hp=t},e.prototype.updateRoleSpeed=function(t){this.roleView.speed=t},e.prototype.hpAddEffect=function(t){var e=HpAddEffect.create();e.show(this.textLayer,t,this.roleView.point.x,this.roleView.point.y,this.roleView.mHeight)},e.prototype.killAward=function(t){var e=0,i=null;for(var s in t.item){var o=Number(s);if(10004!=o){var n=t.item[s],r=SceneItemView.create(),h=GmConst.DROP_ITEM_GRID[e];if(r.setInfo(o,n,t.x+40*h[0],t.y+40*h[1],this.roleView.point,this.onDropItemMoveEnd,this),this.addToUnitLayer(r),o!=ItemID.GOLD){i||(i="Obtain");var a=this._mc.itemMgr.getItemCfg(o);a&&(i+=" <item="+o+"></item> *"+n),e++}}}i&&GmGlobal.cc.chatCtl.addMsg(i,ChatChannel.SYS)},e.prototype.onDropItemMoveEnd=function(t){var e=this.dropItems.indexOf(t);-1!=e&&this.dropItems.splice(e,1)},e.prototype.showMvpAw=function(t){var e=Utils.getRandomIndexArray(10),i=0,s=this.getBossView();if(s&&(this._bossPos||(this._bossPos=new egret.Point),this._bossPos.x=s.point.x,this._bossPos.y=s.point.y),this._bossPos)for(var o in t){var n=t[o],r=BossItemView.create();r.setItem(n.itemid,1,0),r.x=this._bossPos.x,r.y=this._bossPos.y,this.addToUnitLayer(r);var h=36*e[i],a=Utils.random(100,120),l=a*Math.cos(h),c=a*Math.sin(h);r.moveTo(r.x+l,r.y+c,this.onBossItemEnd,this),this.bossItems?this.bossItems.push(r):this.bossItems=[r],i++}},e.prototype.onBossItemEnd=function(t){var e=this.bossItems.indexOf(t);-1!=e&&this.bossItems.splice(e,1)},e.prototype.clearBossItem=function(){if(this.bossItems){for(var t=0,e=this.bossItems;t<e.length;t++){var i=e[t];BossItemView.release(i)}this.bossItems=null}},e.prototype.onYckjAw=function(t){var e=Utils.getRandomIndexArray(10),i=0;if(this.roleView.lockedView){var s=this.getMonsterView(this.roleView.lockedView.typeId);s&&(this._lastMsgPos||(this._lastMsgPos=new egret.Point),this._lastMsgPos.x=s.point.x,this._lastMsgPos.y=s.point.y)}if(this._lastMsgPos||(this._lastMsgPos=new egret.Point(this.roleView.x,this.roleView.y)),this._lastMsgPos)for(var o in t.award){var n=Number(o),r=BossItemView.create();r.setItem(n,t.award[o],n==t.myaward||1==t.myaward?this._mc.role.roleId:0,5,this.roleView),r.x=this.roleView.x,r.y=this.roleView.y,this.addToUnitLayer(r);var h=36*e[i],a=Utils.random(100,120),l=a*Math.cos(h),c=a*Math.sin(h);r.moveTo(r.x+l,r.y+c,this.onYckjItemEnd,this),this.bossItems?this.bossItems.push(r):this.bossItems=[r],i++}},e.prototype.onYckjItemEnd=function(t){if(t.roleId){var e=this._mc.itemMgr.getItemCfg(t.itemId);if(e){var i=TextFormat.setColor(e.name,Utils.getQualityColor(e.quality))+" *"+t.num;Horselamp.showVText(i,this._mc.itemMgr.getItemIcon(t.itemId))}}var s=this.bossItems.indexOf(t);-1!=s&&this.bossItems.splice(s,1)},e.prototype.updateToushi=function(t){var e=this._smgr.getTsRes(t.typeId,t.unitData.ts);t.setToushi(e)},e.prototype.updateHalo=function(t){var e=this._mc.haloMgr.getHalpRes(t.unitData.halo);t.setHalo(e)},e.prototype.updateBaohu=function(t,e){e?t.setBaohu():t.clearBaohu()},e.resetDirByTarget=function(t,e){var i=Math.atan2(e.point.y-t.point.y,e.point.x-t.point.x),s=Math.round(180*i/Math.PI),o=Utils.getDir(s,t.dir);o&&(t.dir=o)},e.prototype.resetDirByPos=function(t,e,i){var s=Math.atan2(i-t.point.y,e-t.point.x),o=Math.round(180*s/Math.PI),n=Utils.getDir(o,t.dir);n&&(t.dir=n)},e.prototype.getSceneUnitView=function(t,e){return e==UnitType.ROLE?t==this._role.roleId?this.roleView:this.otherRoles[t]:e==UnitType.MONSTER?this.monsters[t]:e==UnitType.PET?this.myPetView&&this.myPetView.uid==t?this.myPetView:this.pets[t]:e==UnitType.HUOBAN?this.hbs[t]:0>t?this.npcs[t]:null},e.prototype.getNpcUnitView=function(t){for(var e in this.npcs){var i=this.npcs[e];if(i.typeId==t)return i}return null},e.prototype.getBossView=function(){for(var t in this.monsters){var e=this.monsters[t];if(e.isBoss)return e}return null},e.prototype.getMonsterView=function(t){for(var e in this.monsters){var i=this.monsters[e];if(i.typeId==t)return i}return null},e.prototype.getBoxView=function(t){for(var e in this.boxs){var i=this.boxs[e];if(i.uid==t)return i}return null},e.prototype.getTowerView=function(t){for(var e in this.towers){var i=this.towers[e];if(i.uid==t)return i}return null},e.prototype.getPetViewByRoleId=function(t){if(this.myPetView&&this.myPetView.roleId==t)return this.myPetView;for(var e in this.pets){var i=this.pets[e];if(i.roleId==t)return i}return null},e.prototype.showHpTxt=function(t,e,i,s,o,n,r,h){var a=BattleHpText.create();0!=s?(a.setTxt(s,this.getHpTextStyle(t,e,h),h),a.show(this.textLayer,i,o,n,r,this.onTextShowFinish,this)):h&&a.showEffect(h,this.textLayer,o,n,r,this.onTextShowFinish,this),this._hpTexts.push(a)},e.prototype.showSkillHpTxt=function(t,e,i,s,o,n){if(void 0===o&&(o=1),void 0===n&&(n=null),0!=t){var r=SkillHpText.create();r.setTxt(t,o,"bj"==n?"bj":null),r.show(this.textLayer,e,i,s,this.onSkTextShowFinish,this),this._skHpTexts.push(r)}else if(n){var h=BattleHpText.create();h.showEffect(n,this.textLayer,e,i,s,this.onTextShowFinish,this),this._hpTexts.push(h)}},e.prototype.doAttack=function(t){var e=this.getSceneUnitView(t.defender,t.defenderType);if(t.skillId>0){if(e&&t.hitEffect){var i=McEffect.create(t.hitEffect);i.show(this.effectLayer,e.point.x,e.point.y-.3*e.mHeight,t.aScaleX)}}else{if(2==t.fbj){var s=e?e.point.x:t.targetX,o=e?e.point.y:t.targetY,n=e?e.height:t.targetH;this.showSkillHpTxt(0,s,o,n,1,"sb"),t.fbj=-1}else if(t.fdhp>0){var s=e?e.point.x:t.targetX,o=e?e.point.y:t.targetY,n=e?e.height:t.targetH;e&&(e.unitData.hp=Math.max(e.unitData.hp-t.fdhp,0),e.unitData.hp<e.title.getHp()&&(this.battleHp(e,e.unitData.hp),e==this.roleView&&(this._role.hp=e.unitData.hp,EventBus.dispatchEvt(EventType.S_HP_CH))));var r=this.getSceneUnitView(t.attacker,t.attackerType),h=0,a=0;r&&(h=r.point.x,a=r.point.y);var l=e?e.dirScale:t.aScaleX;h>0&&a>0&&(l=s>h?1:-1);var i=null;1==t.fbj&&(i="bj"),t.attacker==this.roleView.uid&&("bj"==i?GmGlobal.sound.playSoundEffect("baoji"):GmGlobal.sound.playSoundEffect(t.hitSound)),this.showHpTxt(t.defender,t.defenderType,l,t.fdhp,s,o,n,i),t.fdhp=-1,t.fbj=-1}if(e){if(e!=this._selUnitView&&e.title.show(!0),t.hitEffect){var i=McEffect.create(t.hitEffect);i.show(this.effectLayer,e.point.x,e.point.y-.3*e.mHeight,t.aScaleX)}t.hitSound&&(this._nHitSound=t.hitSound)}}},e.prototype.getHpTextStyle=function(t,e,i){return"bj"==i?"battle_json.num_y_":e==UnitType.ROLE&&t==this.roleView.uid||e==UnitType.PET&&this.myPetView&&t==this.myPetView.uid?"battle_json.num_o_":"battle_json.num_w_"},e.prototype.onTextShowFinish=function(t){var e=this._hpTexts.indexOf(t);-1!=e&&this._hpTexts.splice(e,1)},e.prototype.onSkTextShowFinish=function(t){var e=this._skHpTexts.indexOf(t);-1!=e&&this._skHpTexts.splice(e,1)},e.prototype.clearHpText=function(){for(var t=0,e=this._hpTexts;t<e.length;t++){var i=e[t];i.clear()}this._hpTexts=null;for(var s=0,o=this._skHpTexts;s<o.length;s++){var n=o[s];n.clear()}this._skHpTexts=null},e.prototype.updateRoleInfo=function(){var t=this._mc.role;this.roleView.title.setName(t.name),this.roleView.title.setGonghui(t.gonghui)},e.prototype.onLvUp=function(){if(this.roleView){var t=McEffect.create("shengji");t.show(this.effectLayer,this.roleView.point.x,this.roleView.point.y-50),GmGlobal.sound.playSoundEffect("sj")}},e.prototype.onExpUp=function(t){if(this.roleView){var e=ExpText.create();e.show(this.textLayer,t.data,this.roleView.point.x,this.roleView.point.y,this.roleView.mHeight)}},e.prototype.showMonsterExp=function(t){var e=this._mc;if(!(e.role.plV<=0)){var i=e.npcMgr.getNpcCfg(t);if(i&&i.exp&&this.roleView){var s=this.getExpScale(),o=ExpText.create();o.show(this.textLayer,Math.floor(i.exp*s),this.roleView.point.x,this.roleView.point.y,this.roleView.mHeight),this._cc.chatCtl.addMsg("Obtain Exp *"+Math.floor(i.exp*s),ChatChannel.SYS)}}},e.prototype.getExpScale=function(){var t=this._mc,e=1;void 0!=t.vipMgr.state&&(e+=.05);var i=t.vip1Mgr.getTqValue(16);i&&(e+=i/100);var s=this._mc.sceneMgr;if(!s.buffIcons)return e;var o=s.buffIcons[10020];o&&o.cd>0&&(e+=.5);var n=0,r=s.buffIcons[10068];return r&&r.cd>0&&(n+=3),r=s.buffIcons[10069],r&&r.cd>0&&(n+=6),r=s.buffIcons[10070],r&&r.cd>0&&(n+=10),n>0&&(e*=n),e},e.prototype.doZhuabu=function(){if(!this._selUnitView||this._selUnitView.type!=UnitType.MONSTER||this._selUnitView.isDead)return void MsgBox.prompt("No target selected");var t=this._mc.npcMgr.getNpcCfg(this._selUnitView.typeId);if(2==t.type)return void MsgBox.prompt("Can't capture boss-Type Monster");if(this.roleView.attackData.skillId>0)return void MsgBox.prompt("Casting skill");0==this.roleView.attackData.skillId?this.roleView.stopNormalAttack():this.roleView.isMove&&this.roleView.reqStop(),this._autoAttackAi&&this._autoAttackAi.stop();var e=ZhuabuView.getInstence();e.setZhabuMonster(this._selUnitView.uid,this._selUnitView.typeId,this.onZhuabuRet,this),e.show(this)},e.prototype.onZhuabuRet=function(){this._autoAttackAi&&this._autoAttackAi.start()},e.prototype.doMyRoleDead=function(){this.roleView.stand(),this.roleView.isDead=!0,this.roleView.filters=FilterUtils.disabled(),this.roleView.removeAllBuff(),this.clearSelUnit(),this.map.isfh?FuHuoView.getInstence().show(GmGlobal.vmc.uiLayer,this.map.fhCd,this.map.fhPrice):FubenType.isNoGoback(this.map.id)||(DelayTimeView.getInstence().show(GmGlobal.vmc.uiLayer,2,"Dead，TP in %s",this.onDeadTimeOut,this),this.map.type==SceneType.WILD&&AutoReturnTask.getInstance().trigger())},e.prototype.onDeadTimeOut=function(){GmGlobal.cc.sceneCtl.reqGoBackCity()},e.prototype.doUnitDead=function(t,e){if(this.clearSelUnitByID(t,e),e==UnitType.ROLE)t!=this._role.roleId&&delete this.otherRoles[t];else if(e==UnitType.MONSTER){delete this.monsters[t];var i=ZhuabuView.getInstence();i.isShow&&i.zbId==t&&(MsgBox.prompt("Monster Dead，Capture failed"),i.close(),this.onZhuabuRet())}else e==UnitType.PET?this.myPetView&&t==this.myPetView.uid?(this.myPetView.stopAI(),this.myPetView=null):delete this.pets[t]:e==UnitType.HUOBAN&&delete this.hbs[t];this.myPetView&&this.myPetView.checkLockView(t,e)},e.prototype.getNearestFightView=function(t,e,i,s){void 0===s&&(s=0);var o=s||1e4,n=this,r=null;for(var h in n.monsters){var a=n.monsters[h];if(!(a.team&&a.team==t||a.isDead)){var l=Utils.distence(e,i,a.point.x,a.point.y);o>l&&(r=a,o=l)}}for(var h in n.otherRoles){var a=n.otherRoles[h];if(!(a.team&&a.team==t||a.isDead||0==a.unitData.hp)){var l=Utils.distence(e,i,a.point.x,a.point.y);o>l&&(r=a,o=l)}}for(var h in n.pets){var a=n.pets[h];if(a!=this.myPetView&&!(a.team&&a.team==t||a.isDead||0==a.unitData.hp)){var l=Utils.distence(e,i,a.point.x,a.point.y);o>l&&(r=a,o=l)}}for(var h in n.hbs){var a=n.hbs[h];if(!(a.team&&a.team==t||a.isDead||0==a.unitData.hp)){var l=Utils.distence(e,i,a.point.x,a.point.y);o>l&&(r=a,o=l)}}return r},e.prototype.getNearestMonster=function(t,e,i){void 0===i&&(i=0);var s=i||1e4,o=this,n=null;for(var r in o.monsters){var h=o.monsters[r];if(!h.isDead&&0!=h.unitData.hp){var a=Utils.distence(t,e,h.point.x,h.point.y);s>a&&(n=h,s=a)}}return n},e.prototype.getNearestMonsterByType=function(t,e,i,s,o){void 0===o&&(o=0);var n=o||1e4,r=this,h=null;for(var a in r.monsters){var l=r.monsters[a];if(!(l.team&&l.team==t||l.isDead||0==l.unitData.hp||l.typeId!=s)){var c=Utils.distence(e,i,l.point.x,l.point.y);n>c&&(h=l,n=c)}}return h},e.prototype.onTriggerGuide=function(t){var e=(t.data,GmGlobal.vmc.mGuide);this._mc.sceneMgr;e.guideData&&this.triggerGuide(e)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&this.triggerGuide(t)},e.prototype.triggerGuide=function(t){if(t.guideData.id==GuideID.KILL_MONSTER2){if(this._mc.sceneMgr.mapType!=SceneType.WILD)return;this.moveToGuidePoint(t)}else if(t.guideData.id==GuideID.EQUIPE_STRONG||t.guideData.id==GuideID.KQL_GM||t.guideData.id==GuideID.EQUIPE_JL||t.guideData.id==GuideID.TOUSHI_ZZ||t.guideData.id==GuideID.JOIN_GH||t.guideData.id==GuideID.EQUIPE_DZ||t.guideData.id==GuideID.JIAOYI){if(this._mc.sceneMgr.mapType!=SceneType.CITY)return;this.moveToGuideNpc(t)}},e.prototype.moveToGuidePoint=function(t){var e=t.getCurrentStep();if(e&&e.id==GuideTargetId.MOVE_TO){var i=this._mc.guideMgr,s=i.getGuideTask();if(s.idx){var o=i.getTaskListInfo(s.idx);o&&(this.unlockView(),o.id==GuideID.KILL_MONSTER2?this.lockUnitType(o.y,o.posx,o.posy):(this._autoAttackAi&&(this._autoAttackAi.mToX=o.posx,this._autoAttackAi.mToY=o.posy),this.moveToPoint(o.posx,o.posy,!1)))}t.triggerTargetByID(GuideTargetId.MOVE_TO)}},e.prototype.moveToGuideNpc=function(t){var e=t.getCurrentStep();if(e&&e.id==GuideTargetId.MOVE_TO){var i=this._mc.guideMgr,s=i.getGuideTask();if(s.idx){var o=i.getTaskListInfo(s.idx),n=i.getNpcId(t.guideData.id);if(o&&-1!=n){var r=this.getNpcUnitView(n);if(r)if(this._autoAttackAi&&(this._autoAttackAi.lockType=n),Utils.distence(r.x,r.y,this.roleView.x,this.roleView.y)<=96){this.triggerNpcFunc(r);var h=t.getCurrentStep();h&&h.id==GuideTargetId.MOVE_TO&&t.triggerTargetByID(GuideTargetId.MOVE_TO)}else this.moveToNpc(r)}}}},e.prototype.openNpcFunc=function(t,e){var i=this.getNpcUnitView(t);i&&(Utils.distence(i.x,i.y,this.roleView.x,this.roleView.y)<=96?this.triggerNpcFunc(i,e):this.moveToNpc(i,e))},e.prototype.clearSelUnitByID=function(t,e){this._selUnitView&&this._selUnitView.type==e&&t==this._selUnitView.uid&&(this._selUnitView=null,this.unlockView())},e.prototype.initItemBuff=function(){var t=this._mc.sceneMgr.buffIcons;for(var e in t){var i=t[e];this.roleView.showItemBuffEffect(Number(e),i.cd)}},e.prototype.onItemBuff=function(t){var e=t.data,i=this._mc.sceneMgr.buffIcons;if(i&&i[e]){var s=i[e];this.roleView.showItemBuffEffect(e,s.cd)}},e.prototype.removeAllRoles=function(){var t=this._c;for(var e in this.otherRoles){var i=this.otherRoles[e];this.removeUnit(i),delete this.otherRoles[i.uid],t.releaseRoleView(i)}},e.prototype.removeAllMonster=function(){var t=this._c;for(var e in this.monsters){var i=this.monsters[e];this.removeUnit(i),delete this.monsters[i.uid],t.releaseMonsterView(i)}},e.prototype.removeAllNpc=function(){var t=this._c;for(var e in this.npcs){var i=this.npcs[e];this.removeUnit(i),delete this.npcs[i.uid],t.releaseNpcView(i)}},e.prototype.removeAllPet=function(){var t=this._c;for(var e in this.pets){var i=this.pets[e];this.removeUnit(i),delete this.pets[e],t.releasePetView(i)}},e.prototype.removeAllHb=function(){var t=this._c;for(var e in this.hbs){var i=this.hbs[e];this.removeUnit(i),delete this.hbs[e],t.releaseHbView(i)}},e.prototype.removeAllBox=function(){for(var t in this.boxs){var e=this.boxs[t];this.removeFromUnitLayer(e),delete this.boxs[t]}},e.prototype.removeAllTower=function(){for(var t in this.towers){var e=this.towers[t];this.blockMap.removeChild(e),delete this.towers[t]}},e.prototype.clear=function(){GameTick.instence().clear(),FuHuoView.release(),DelayTimeView.release(),BossHpBar.getInstance().close(),TowerHpBar.getInstance().close(),this.stopAutoAttack(),this.removeListener(),this.roleView&&(this.roleView.stand(),this.roleView.removeBindCb(),this.roleView.lockedView=null,this.removeUnit(this.roleView),this.roleView.unuse(),this.roleView=null),this.myPetView&&(this.myPetView.stand(),this.myPetView.removeBindCb(),this.removeUnit(this.myPetView),this.myPetView.unuse(),this.myPetView=null),this.removeAllRoles(),this.removeAllMonster(),this.removeAllNpc(),this.removeAllHb(),this.removeAllBox(),this.removeAllTower(),this.clearHpText(),this.clearBossItem(),BattleSkillPanle.getInstence().hide(),ZhuabuView.close(),BoxOpenView.close(),this.rmGbEffect(!0),this._cc=null,this._mc=null,this._smgr=null,this._c=null,this._role=null,t.prototype.clear.call(this)},e}(BlockSceneBase);__reflect(SceneView.prototype,"SceneView");var BattleUnitView=function(t){function e(){var e=t.call(this)||this;return e.team=0,e.aDis=0,e.isFuncNpc=!1,e.isBoss=!1,e.isDead=!1,e.isMove=!1,e.speed=0,e.isInSkill=!1,e.isBingdong=!1,e.isXuanyun=!1,e._cSp=0,e._s=0,e._a=0,e.tox=0,e.toy=0,e._aInterval=-1,e.touchChildren=!1,e.touchEnabled=!0,e.point=new egret.Point,e.attackData=new AttackData,e}return __extends(e,t),e.prototype.setInfo=function(e,i,s,o,n){void 0===n&&(n=ActionType.STAND),t.prototype.setInfo.call(this,e,i,s,o,n),this.playCfg=GmGlobal.mc.btMgr.getModelPlayCfg(i)
},e.prototype.bindSceneCb=function(t,e,i){void 0===i&&(i=null),this.movingCb=t,this.moveEndCb=e,this.cbObj=i},e.prototype.setSkillEndCb=function(t,e){this.skillEndCb=t,this.skillCbObj=e},e.prototype.removeBindCb=function(){this.movingCb=null,this.moveEndCb=null,this.cbObj=null,this.skillEndCb=null,this.skillCbObj=null},e.prototype.addToScene=function(t,e){this.addTitle(e),this.addShadow(t)},e.prototype.addShadow=function(t){if(!this.shadow){var e=RES.getRes("shadow_png");if(!e)return;this.shadow=new egret.Bitmap(e),this.shadow.anchorOffsetX=.5*this.shadow.width,this.shadow.anchorOffsetY=.5*this.shadow.height,this.shadow.scaleX=this.mScale,this.shadow.scaleY=this.mScale}this.shadow.x=this.x,this.shadow.y=this.y,t.addChild(this.shadow)},e.prototype.resetScale=function(e){t.prototype.resetScale.call(this,e),this.shadow&&(this.shadow.scaleX=this.mScale,this.shadow.scaleY=this.mScale)},e.prototype.resetPos=function(t,e){this.x=this.point.x=t,this.y=this.point.y=e,this.title&&(this.title.x=t,this.title.y=e+this.title.offsetY),this.shadow&&(this.shadow.x=t,this.shadow.y=e)},e.prototype.moveTo=function(t,e){this.setAction(ActionType.RUN),this.tox=t,this.toy=e,this._s=Utils.distence(t,e,this.point.x,this.point.y),this._a=Math.atan2(e-this.point.y,t-this.point.x);var i=Math.round(180*this._a/Math.PI),s=Utils.getDir(i,this.dir);s&&(this.dir=s),this.isMove||(this.isMove=!0,this._cSp||(this._cSp=this.speed),GameTick.instence().bindTick(this.onTick,this))},e.prototype.movePath=function(t){t&&0!=t.length&&(this.mPath=t,this._cSp=this.speed,this.moveTo(t.shift(),t.shift()))},e.prototype.onTick=function(t){var e=this,i=e._cSp*t;e._s-=i,e._s<=0?(e.point.x=e.tox,e.point.y=e.toy):(e.point.x+=i*Math.cos(e._a),e.point.y+=i*Math.sin(e._a)),e.x=e.point.x,e.y=e.point.y,e.onPosUpdate(),e.movingCb&&e.movingCb.call(e.cbObj,e),e._s<=0&&e.onMoveEnd()},e.prototype.onPosUpdate=function(){var t=this;t.shadow&&(t.shadow.x=t.point.x,t.shadow.y=t.point.y),t.selEffect&&(t.selEffect.x=t.point.x,t.selEffect.y=t.point.y),t.title&&(t.title.x=t.point.x,t.title.y=t.point.y+t.title.offsetY)},e.prototype.onMoveEnd=function(){return this.mPath&&this.mPath.length>0?void this.moveTo(this.mPath.shift(),this.mPath.shift()):(this.stand(),void(this.moveEndCb&&this.moveEndCb.call(this.cbObj,this)))},e.prototype.stopMove=function(){this.isMove&&(this.isMove=!1,this.mPath=null,this._cSp=0,GameTick.instence().unbindTick(this.onTick,this))},e.prototype.getActionFrame=function(t){if(!this.body)return 0;for(var e=0,i=this.body.frameLabels;e<i.length;e++){var s=i[e];if(s.name==t)return s.end-s.frame+1}return 0},e.prototype.stand=function(){this.attackData.reset(),this.setAction(ActionType.STAND),this.stopMove(),this.stopAttack()},e.prototype.fightStand=function(){this.setAction(ActionType.STAND_TO),this.stopMove()},e.prototype.dead=function(t){if(this.isDead=!0,this.removeAllBuff(),t)if(this.shadow.parent&&this.shadow.parent.removeChild(this.shadow),egret.Tween.removeTweens(this),this.attackData.ax>0&&this.attackData.ay>0){var e=Math.atan2(this.point.y-this.attackData.ay,this.point.x-this.attackData.ax),i=this.point.x+60*Math.cos(e),s=this.point.y+60*Math.sin(e),o=this.attackData.ax<this.point.x?DirType.LEFT:DirType.RIGHT;this.dir=o,egret.Tween.get(this).to({x:i,y:s},200,egret.Ease.sineOut).to({alpha:0},500).call(this.onDeadEnd,this)}else egret.Tween.get(this).to({alpha:0},500).call(this.onDeadEnd,this);else this.onDeadEnd()},e.prototype.onDeadEnd=function(){this.title&&this.title.remove(),this.parent&&this.parent.removeChild(this)},e.prototype.alphaShow=function(){egret.Tween.removeTweens(this),this.alpha=0,egret.Tween.get(this).to({alpha:1},500)},e.prototype.stopAttack=function(){this._aInterval>=0&&(this._aInterval=-1,GameTick.instence().clearTimeOut(this.onAttackITimeOut,this))},e.prototype.checkNormalAttack=function(){if(-1==this.attackData.skillId)return!1;var t=GmGlobal.vmc.scene.currenScene;if(this.attackData.defenderType==UnitType.TOWER){var e=t.getTowerView(this.attackData.defender);return e?!0:!1}var i=GmGlobal.vmc.scene.currenScene.getSceneUnitView(this.attackData.defender,this.attackData.defenderType);return i?(this.attackData&&(this.attackData.targetX=i.point.x,this.attackData.targetY=i.point.y),!0):!1},e.prototype.normalAttack=function(t){if(void 0===t&&(t=0),!this.playCfg)return void this.attackData.reset();if(this._aSpeed=t,this.mcLableCfg=this.playCfg[0],!this.mcLableCfg)return void this.attackData.reset();if(!this.body)return this.action=ActionType.ATTACK,void(this.aLoop=1);var e=this.getActionFrame("attack"),i=8;if(t&&e){i=Math.floor(e/1e3*t),i=Math.max(i,8),i=Math.min(i,30),this.body.frameRate=i;var s=1e3/t;this._aInterval=s-e/i,this._aInterval<.02&&(this._aInterval=0)}else this._aInterval=-1;this.setAction(ActionType.ATTACK,1,i)},e.prototype.onAttackITimeOut=function(){this.checkNormalAttack()?this.setAction(ActionType.ATTACK,1,this.frameRate,!0):this.fightStand()},e.prototype.skillAttack=function(t){if(61008==t&&this.removeBuffBySkillId(61006),!this.playCfg)return void this.attackData.reset();if(this.mcLableCfg=this.playCfg[t],!this.mcLableCfg)return void this.attackData.reset();if(this.mcLableCfg.pf){this.pauseData={};for(var e=this.mcLableCfg.pf,i=0;i<e.length;i+=2)this.pauseData[e[i]]=e[i+1]}var s=ActionType.SKILL;return"attack"==this.mcLableCfg.aname?s=ActionType.ATTACK:"stand-to"==this.mcLableCfg.aname&&(s=ActionType.STAND_TO),this.body?(this.stopAttack(),s==this.action&&this.setAction(ActionType.STAND),this.setAction(s,1,8,!0),void(this.mcLableCfg.aSound&&GmGlobal.sound.playSoundEffect(this.mcLableCfg.aSound))):(this.action=s,void(this.aLoop=1))},e.prototype.addBuff=function(t,e){var i=this.getBuff(t);if(i)i.resetTime(e);else{var s=GmGlobal.mc.btMgr.getBuffCfg(t);if(!s||!s.ts)return;i=BuffEffect.create(),i.x=0,i.y=(s.tspos||0)*-this.mHeight,i.scaleX=1,i.addLayer=0,i.effectId=s.ts,i.buffData.bfId=t,i.buffData.time=e,i.show(this,this.onBuffEffectEnd,this),this.pushBuffEffect(i),this.updateBuffState(t,!0)}},e.prototype.getBuff=function(t){if(this._buffEffects){for(var e=0,i=this._buffEffects;e<i.length;e++){var s=i[e];if(s.buffData.bfId==t)return s}return null}},e.prototype.removeBuff=function(t){if(this._buffEffects)for(var e=0;e<this._buffEffects.length;e++){var i=this._buffEffects[e];if(i.buffData.bfId==t)return this._buffEffects.splice(e,1),BuffEffect.release(i),void this.updateBuffState(t,!1)}},e.prototype.removeBuffBySkillId=function(t){if(this._buffEffects)for(var e=0;e<this._buffEffects.length;e++){var i=this._buffEffects[e];if(i.buffData.skillId==t)return this._buffEffects.splice(e,1),void BuffEffect.release(i)}},e.prototype.removeAllBuff=function(){if(this._buffEffects){for(var t=0;t<this._buffEffects.length;t++){var e=this._buffEffects[t];this._buffEffects.splice(t,1),BuffEffect.release(e)}this.isXuanyun=!1,this.isBingdong=!1}},e.prototype.updateBuffState=function(t,e){t==BuffId.BINGDONG?(this.isBingdong=e,e?(this.stand(),this.body&&this.body.stop()):this.body&&this.body.play()):t==BuffId.XUANYUN&&(this.isXuanyun=e,e&&this.stand())},e.prototype.showEF=function(){if(this.mcLableCfg.ef)if(this.attackData.duration&&!this.mcLableCfg.aef){var t=BuffEffect.create();t.x=-1==this.dirScale?-this.mcLableCfg.efp[0]:this.mcLableCfg.efp[0],t.y=this.mcLableCfg.efp[1],t.scaleX=this.mcLableCfg.nomirror?1:this.dirScale,t.addLayer=-1==this.mcLableCfg.efl?-1:0,t.effectId=this.mcLableCfg.ef,t.buffData.skillId=this.attackData.skillId,t.buffData.time=this.attackData.duration,t.show(this,this.onBuffEffectEnd,this),this.pushBuffEffect(t)}else{var t=McEffect.create(this.mcLableCfg.ef);t.show(this,-1==this.dirScale?-this.mcLableCfg.efp[0]:this.mcLableCfg.efp[0],this.mcLableCfg.efp[1],this.mcLableCfg.nomirror?1:this.dirScale,1,-1==this.mcLableCfg.efl?-1:0)}},e.prototype.showItemBuffEffect=function(t,e){var i=GmGlobal.mc.itemMgr.getItemBuffEffect(t);if(i&&e){var s=BuffEffect.create();s.x=0,s.y=-this.mHeight/2,s.effectId=i,s.buffData.time=e,s.show(this,this.onBuffEffectEnd,this),this.pushBuffEffect(s)}},e.prototype.pushBuffEffect=function(t){this._buffEffects?this._buffEffects.push(t):this._buffEffects=[t]},e.prototype.onBuffEffectEnd=function(t){t.buffData.bfId&&this.updateBuffState(t.buffData.bfId,!1);var e=this._buffEffects.indexOf(t);-1!=e&&(this._buffEffects.splice(e,1),BuffEffect.release(t))},e.prototype.hasSkillEffect=function(t){if(!this._skillEffects)return!1;for(var e=0,i=this._skillEffects;e<i.length;e++){var s=i[e];if(s.attackData.skillId==t)return!0}return!1},e.prototype.doAttack=function(){if(0==this.attackData.skillId&&this.mcLableCfg.aSound&&GmGlobal.sound.playSoundEffect(this.mcLableCfg.aSound),this.attackData.aScaleX=this.dirScale,this.mcLableCfg.aef){if(this.attackData.skillId>0&&this.hasSkillEffect(this.attackData.skillId))return;var t=SkillEffect.create(this.mcLableCfg.aef),e=0,i=0,s=this.mcLableCfg.aefp[0];if(this.mcLableCfg.aefscale&&(s*=this.mcLableCfg.aefscale),1==this.mcLableCfg.etarget||this.mcLableCfg.isMove?(e=this.point.x+s*this.dirScale*this.mScale,i=this.point.y+this.mcLableCfg.aefp[1]*this.mScale):(e=this.attackData.targetX+s*this.dirScale,i=this.attackData.targetY+this.mcLableCfg.aefp[1]),this.mcLableCfg.isMove){t.isMove=!0,t.speed=this.mcLableCfg.speed||1e3,this.attackData.targetY-=Math.floor(this.attackData.targetH/3);var o=Utils.distence(e,i,this.attackData.targetX,this.attackData.targetY),n=this.attackData.skillId?100:0;if(80>o||isNaN(o)||0==this.attackData.targetX&&0==this.attackData.targetY)this.attackData.targetY=i,this.attackData.targetX=e+this.dirScale*(o+n),t.angle=1==this.dirScale?0:180;else{var r=Math.atan2(this.attackData.targetY-i,this.attackData.targetX-e),h=180*r/Math.PI;t.angle=h,this.attackData.targetX+=n*Math.cos(r),this.attackData.targetY+=n*Math.sin(r)}}if(t.setAttackData(this.attackData),t.show(e,i,this.mcLableCfg.aefscale||1,this.onEffectPlayend,this,this.dirScale),this._skillEffects?this._skillEffects.push(t):this._skillEffects=[t],this.attackData.efNum>1){var a=SubEffectCreator.create();a.initSubs(this.mcLableCfg.aef,this.mcLableCfg.aSound,this.attackData.efNum-1,this.attackData,e,i,this.mcLableCfg.aefscale||1,this.dirScale),a.show(this.onSubCEnd,this),this._subEfCreator?this._subEfCreator.push(a):this._subEfCreator=[a]}}else this.attackData.hitEffect=this.mcLableCfg.hitef,this.attackData.hitSound=this.mcLableCfg.hSound,CmdBus.doCmd(CmdType.BATTLE_ATTACK,this.attackData)},e.prototype.onSubCEnd=function(t){var e=this._subEfCreator.indexOf(t);-1!=e&&this._subEfCreator.splice(e,-1)},e.prototype.onEffectPlayend=function(t){var e=this._skillEffects.indexOf(t);-1!=e&&this._skillEffects.splice(e,1)},e.prototype.clearEffects=function(){if(this._skillEffects){for(var t=0,e=this._skillEffects;t<e.length;t++){var i=e[t];i.doRelease()}this._skillEffects=null}if(this._buffEffects){for(var s=0,o=this._buffEffects;s<o.length;s++){var i=o[s];BuffEffect.release(i)}this._buffEffects=null}if(this._subEfCreator){for(var n=0,r=this._subEfCreator;n<r.length;n++){var h=r[n];SubEffectCreator.release(h)}this._subEfCreator=null}},e.prototype.onBodyLoaded=function(){this.body.addEventListener(egret.Event.COMPLETE,this.onActionPlayEnd,this),this.body.addEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onEventFrame,this),this.action==ActionType.ATTACK&&this.normalAttack(this._aSpeed)},e.prototype.onEventFrame=function(t){this.mcLableCfg&&(t.frameLabel==this.mcLableCfg.afevent&&this.doAttack(),t.frameLabel==this.mcLableCfg.efevent&&this.showEF())},e.prototype.onActionPlayEnd=function(t){this.pauseData=null,0==this.attackData.skillId?-1==this._aInterval?(this.attackData.reset(),this.fightStand()):this._aInterval>0?(this.fightStand(),GameTick.instence().setTimeOut(this._aInterval,this.onAttackITimeOut,this)):this.onAttackITimeOut():(this.mcLableCfg=null,this.attackData.skillId=-1,this.fightStand(),this.onSkillEnd())},e.prototype.onSkillEnd=function(){this.skillEndCb&&this.skillEndCb.call(this.skillCbObj)},e.prototype.clearBody=function(){this.body&&(this.body.removeEventListener(egret.Event.COMPLETE,this.onActionPlayEnd,this),this.body.removeEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onEventFrame,this)),t.prototype.clearBody.call(this)},e.prototype.removeFromScene=function(){this.parent&&this.parent.removeChild(this),this.title&&this.title.parent&&this.title.parent.removeChild(this.title),this.shadow&&this.shadow.parent&&this.shadow.parent.removeChild(this.shadow)},e.prototype.unuse=function(){this.stopMove(),this.removeBindCb(),egret.Tween.removeTweens(this),this.clearEffects(),this.type=0,this.typeId=0,this.name="",this.team=0,this.aDis=0,this.isFuncNpc=!1,this.isBoss=!1,this.isInSkill=!1,this.isBingdong=!1,this.isXuanyun=!1,this.playCfg=null,this.mcLableCfg=null,this.attackData&&this.attackData.reset(),this.unitData&&this.unitData.reset(),t.prototype.unuse.call(this)},e.prototype.reuse=function(){this.isDead=!1,this.body&&(this.body.addEventListener(egret.Event.COMPLETE,this.onActionPlayEnd,this),this.body.addEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onEventFrame,this)),t.prototype.reuse.call(this)},e.prototype.clear=function(){this.unuse(),this.title&&(this.title.clear(),this.title=null),this.shadow=null,t.prototype.clear.call(this)},e}(ActionUnitView);__reflect(BattleUnitView.prototype,"BattleUnitView");var PVPSceneView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addListener=function(){t.prototype.addListener.call(this),EventBus.addListener(EventType.PVP_TIME,this.onPvpTime,this)},e.prototype.removeListener=function(){t.prototype.removeListener.call(this),EventBus.rmListener(EventType.PVP_TIME,this.onPvpTime,this)},e.prototype.onPvpTime=function(){this._pvpAI&&this._pvpAI.start()},e.prototype.createRoleView=function(e){var i=t.prototype.createRoleView.call(this,e);return i&&!this._pvpAI&&(this._pvpAI=new PVPAI(i,this.roleView)),i},e.prototype.stopAutoAttack=function(){t.prototype.stopAutoAttack.call(this),this.clearPVPAI()},e.prototype.clearPVPAI=function(){this._pvpAI&&(this._pvpAI.clear(),this._pvpAI=null)},e.prototype.clear=function(){this.clearPVPAI(),t.prototype.clear.call(this)},e}(SceneView);__reflect(PVPSceneView.prototype,"PVPSceneView");var WanfaSceneUIBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getHeight=function(){return this.height},e.prototype.show=function(t){this.parent||(t.addChild(this),this.onResize()),EventBus.addListener(EventType.RESIZE,this.onResize,this),EventBus.addListener(EventType.BOSSHP_SHOW,this.onShoeBossHp,this),EventBus.addListener(EventType.TOWERHP_SHOW,this.onTHpShow,this),e.currentUI=this},e.prototype.onResize=function(){GmConst.IS_FULLSCENE?this.y=GmConst.TOP_SPACE+GmConst.UI_FREE_Y:this.y=GmConst.UI_FREE_Y,this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.onShoeBossHp=function(){var t=BossHpBar.getInstance();t.topSpace=this.y+this.getHeight()+15,t.onResize()},e.prototype.onTHpShow=function(){var t=TowerHpBar.getInstance();t.topSpace=this.y+this.getHeight()+15,t.onResize()},e.prototype.close=function(){EventBus.rmListener(EventType.RESIZE,this.onResize,this),EventBus.rmListener(EventType.BOSSHP_SHOW,this.onShoeBossHp,this),EventBus.rmListener(EventType.TOWERHP_SHOW,this.onTHpShow,this),this.parent&&this.parent.removeChild(this),e.currentUI=null},e}(eui.Component);__reflect(WanfaSceneUIBase.prototype,"WanfaSceneUIBase");var ItemSellView=function(t){function e(){var e=t.call(this,"ItemSellSkin")||this;return e._num=1,e._maxNum=1,e._price=0,e._isQuick=!1,e._sNo=0,e}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.getNum=function(){return this._num},e.prototype.getCostId=function(){return this._costItem},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.numTxt.restrict="0-9"},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bJia.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJia,this),this.bJian.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJian,this),this.bCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.numTxt.addEventListener(egret.Event.CHANGE,this.onNumChange,this)},e.prototype.rmEvts=function(){this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bJia.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJia,this),this.bJian.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJian,this),this.bCancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.numTxt.removeEventListener(egret.Event.CHANGE,this.onNumChange,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.checkGuide(),this.tweenShow()},e.prototype.setItem=function(t,e,i,s,o,n){void 0===s&&(s=999),void 0===o&&(o=!1),void 0===n&&(n=1),this._item=t,this._num=n,this._costItem=i,this._maxNum=s,this._isQuick=o;var r=GmGlobal.mc.itemMgr,h=r.getItemCfg(t);h&&(this.itemName.text=h.name,this._price=e,this.tprice.text=String(this._price),this.tpIcon.source=r.getItemSicon(i)),this.cTxt.text=o?"Quick Purchase Price：":"Price：",Utils.setBtnEnable(this.bJia,!0),Utils.setBtnEnable(this.bJian,!0),this.updateNumTxt()},e.prototype.setItemMany=function(t,e,i,s){this._item=t,this._num=s,this._costItem=i,this._maxNum=s;var o=GmGlobal.mc.itemMgr,n=o.getItemCfg(t);n&&(this.itemName.text=n.name,this._price=e,this.tprice.text=String(this._price),this.tpIcon.source=o.getItemSicon(i)),this.numTxt.text=this._num.toString(),Utils.setBtnEnable(this.bJia,!1),Utils.setBtnEnable(this.bJian,!1),this.numTxt.touchEnabled=!1},e.prototype.setPmItem=function(t,e,i){this._pmIdx=i,this.itemName.text="Purchase limit",this._num=1,this._maxNum=e,this._price=t,Utils.setBtnEnable(this.bJia,!0),Utils.setBtnEnable(this.bJian,!0),this.updPmTxt()},e.prototype.updPmTxt=function(){this.numTxt.text=this._num.toString();var t=GmGlobal.mc.huntMgr.getPmCfg(),e=this._num*this._price/t.medaltodiamond,i=GmGlobal.mc.itemMgr,s=i.getItemNum(ItemID.MVP_MEDAL);s>=e?(this.tpIcon.source=i.getItemSicon(ItemID.MVP_MEDAL),this.tprice.text=String(e)):(this.tpIcon.source=i.getItemSicon(ItemID.DIAMOND),this.tprice.text=String(this._num*this._price))},e.prototype.onJia=function(){GmGlobal.vmc.mGuide.triggerTarget(this.bJia),this._num++,this._num>this._maxNum&&(this._num=this._maxNum),this._pmIdx?this.updPmTxt():this.updateNumTxt()},e.prototype.onJian=function(){this._num--,this._num<1&&(this._num=1),this._pmIdx?this.updPmTxt():this.updateNumTxt()},e.prototype.onNumChange=function(){this._num=Number(this.numTxt.text),this._pmIdx?(this._num>this._maxNum&&(this._num=this._maxNum),this.updPmTxt()):(this._num>this._maxNum&&(this._num=this._maxNum,this.numTxt.text=this._num.toString()),this.tprice.text=String(this._num*this._price))},e.prototype.updateNumTxt=function(){this.numTxt.text=this._num.toString(),this.tprice.text=String(this._num*this._price)},e.prototype.onCs=function(){if(0!=this._num){var t=GmGlobal.cc;if(this._pmIdx)return void t.dataCtl.doAction(ServerActionId.HUNT_PM_BUY,[this._pmIdx,this._num],this.close,this);GmGlobal.vmc.mGuide.triggerTarget(this.bBuy);0!=this._sNo&&GmGlobal.server.clearSerialCallbak(this._sNo),this._isQuick?t.dataCtl.doAction(ServerActionId.QUICK_BUY,[this._price*this._num],this.doBuy,this,null):this.doBuy()}},e.prototype.doBuy=function(){var t=this,e=this;this._sNo=GmGlobal.cc.itemCtl.reqBuyItem(this._item,this._num,this._costItem,function(i){e._sNo=0,t.close()})},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.KQL_GM&&(t.bindTarget(GuideTargetId.SHOP_ADD,this.bJia,this.bJia.parent.localToGlobal(this.bJia.x,this.bJia.y)),t.bindTarget(GuideTargetId.SHOP_BUY,this.bBuy,this.bBuy.parent.localToGlobal(this.bBuy.x,this.bBuy.y)))},e.prototype.close=function(){0!=this._sNo&&GmGlobal.server.clearSerialCallbak(this._sNo),this._pmIdx&&(this._pmIdx=null),this.numTxt.touchEnabled=!0,t.prototype.close.call(this)},e}(UIBase);__reflect(ItemSellView.prototype,"ItemSellView");var PetAIState=function(){function t(){}return t}();__reflect(PetAIState.prototype,"PetAIState");var AIStateType=function(){function t(){}return t.HANG=1,t.FOLLOW=2,t.ATTACK=3,t}();__reflect(AIStateType.prototype,"AIStateType");var ConfirmBox=function(t){function e(){var e=t.call(this,"ConfirmBoxSkin")||this;return e._txt="",e._timerId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.txt.lineSpacing=10},e.prototype.updatePos=function(){this.x=Math.round(GmGlobal.stageWidth/2),this.y=Math.round(GmGlobal.stageHeight/2),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.cancelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.update(),this.scaleX=0,this.scaleY=0,egret.Tween.get(this).to({scaleX:1,scaleY:1},400,egret.Ease.backOut)},e.prototype.setCDTime=function(t){0>=t||(this._cdTime=t,this.onTime(),this._timerId=egret.setInterval(this.onTime,this,1e3))},e.prototype.onTime=function(){this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(this._txt+"("+this._cdTime+")",this.txt.width)),this._cdTime--,this._cdTime<0&&this.onCancel()},e.prototype.clearTimer=function(){0!=this._timerId&&(egret.clearInterval(this._timerId),this._timerId=0)},e.prototype.updateBox=function(t,e,i,s,o,n){for(var r=[],h=6;h<arguments.length;h++)r[h-6]=arguments[h];this._txt=t,this._okBtnTxt=e,this._cancelBtnTxt=i,this._okCB=s,this._cancelCB=o,this._thisObj=n,this._args=r,this.clearTimer(),this.isShow&&(this.update(),this.updatePos())},e.prototype.update=function(){this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(this._txt,this.txt.width)),this.okBtn.label=this._okBtnTxt||MsgBox.OK,this.cancelBtn.label=this._cancelBtnTxt||MsgBox.CANCEL;var t=Math.max(this.txt.textHeight,100);this.txtBg.height=t+40,this.txt.y=this.txtBg.y+(this.txtBg.height-this.txt.textHeight)/2,this.okBtn.y=this.cancelBtn.y=this.txtBg.y+this.txtBg.height+this.okBtn.anchorOffsetY*this.okBtn.scaleY+20,this.height=this.txtBg.y+this.txtBg.height+this.okBtn.height*this.okBtn.scaleY+40,this.txt.numLines>3?this.txt.textAlign=egret.HorizontalAlign.LEFT:this.txt.textAlign=egret.HorizontalAlign.CENTER},e.prototype.onOk=function(){this.clearTimer(),this._okCB&&(t=this._okCB).call.apply(t,[this._thisObj].concat(this._args)),this.close();var t},e.prototype.onCancel=function(){this.clearTimer(),this._cancelCB&&(t=this._cancelCB).call.apply(t,[this._thisObj].concat(this._args)),this.close();var t},e.prototype.close=function(){this.clearTimer(),this._okCB=null,this._cancelCB=null,this._thisObj=null,this._args=null,t.prototype.close.call(this)},e}(UIBase);__reflect(ConfirmBox.prototype,"ConfirmBox");var AlertBox=function(t){function e(e){void 0===e&&(e="AlertBoxSkin");var i=t.call(this,e)||this;return i._txt="",i._timerId=0,i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.txt.lineSpacing=6},e.prototype.updatePos=function(){this.x=Math.round(GmGlobal.stageWidth/2),this.y=Math.round(GmGlobal.stageHeight/2),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.update(),this.btnEnable(!0),this.tweenShow()},e.prototype.setCDTime=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),0>=t||(this._timeoutCb=e,this._timeoutObj=i,this._cdTime=t,this.startTimer(),this.onTime())},e.prototype.onTime=function(){this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(this._txt+"("+this._cdTime+")",this.txt.width)),this._cdTime--,this._cdTime<0&&(this._timeoutCb&&this._timeoutCb.call(this._timeoutObj),this.close())},e.prototype.startTimer=function(){this._timerId=egret.setInterval(this.onTime,this,1e3)},e.prototype.stopTimer=function(){0!=this._timerId&&(egret.clearInterval(this._timerId),this._timerId=0)},e.prototype.updateBox=function(t,e,i,s,o){void 0===o&&(o=null),this._txt=t,this._btnTxt=e,this._okCB=i,this._thisObj=s,this._cbData=o,this.stopTimer(),this.update()},e.prototype.update=function(){this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(this._txt||"",this.txt.width)),this.okBtn.label=this._btnTxt||MsgBox.OK;var t=Math.max(this.txt.textHeight,66);this.txtBg.height=t+40,this.txt.y=this.txtBg.y+(this.txtBg.height-this.txt.textHeight)/2,this.okBtn.y=this.txtBg.y+this.txtBg.height+this.okBtn.anchorOffsetY*this.okBtn.scaleY+20,this.height=this.txtBg.y+this.txtBg.height+this.okBtn.height*this.okBtn.scaleY+40},e.prototype.btnEnable=function(t){this.okBtn.touchEnabled=t,t?this.okBtn.filters=[]:this.okBtn.filters=FilterUtils.disabled()},e.prototype.resetText=function(t){this._txt=t,this.isInit&&this.update()},e.prototype.onOk=function(t){this.stopTimer(),this._okCB&&this._okCB.call(this._thisObj,this._cbData),this.close()},e.prototype.close=function(){this.stopTimer(),this._okCB=null,this._thisObj=null,this._cbData=null,t.prototype.close.call(this)},e}(UIBase);__reflect(AlertBox.prototype,"AlertBox");var SingleOperation=function(){function t(){this._timer=0,this.isStop=!0,this._progressInfo=new ProgressInfo}return t.prototype.execute=function(t,e,i,s){void 0===i&&(i=null),this._onProgress=t,this._onComplete=e,this._onError=i,this._thisObj=s,this.isStop=!1},t.prototype.autoProgress=function(t){this._progressInfo.total=100,this._autoStep=100/t,this._timer=egret.setInterval(this.onAutoProgress,this,0)},t.prototype.onAutoProgress=function(){this._progressInfo.current+=this._autoStep,this._progressInfo.current>100&&(this._progressInfo.current=100),this.notifyProgress()},t.prototype.notifyProgress=function(){null!=this._onProgress&&this._onProgress.call(this._thisObj,this._progressInfo),this._progressInfo.total==this._progressInfo.current&&(egret.clearInterval(this._timer),this._timer=0)},t.prototype.notifyComplete=function(){0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0),null!=this._onComplete&&this._onComplete.call(this._thisObj,this),this.clear()},t.prototype.stop=function(){this.isStop=!0},t.prototype.clear=function(){this._onProgress=null,this._onComplete=null,this._onError=null,this._thisObj=null},t}();__reflect(SingleOperation.prototype,"SingleOperation",["IOperation"]);var MovieClipEx=function(t){function e(e){var i=t.call(this)||this;return i._isPlay=!0,i._effectId=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"effectId",{get:function(){return this._effectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlay",{get:function(){return this._isPlay},enumerable:!0,configurable:!0}),e.prototype.onEffectLoaded=function(t){return this.parent?(this._mc=new egret.MovieClip(t.generateMovieClipData(this._effectId)),void(this._mc&&(this.addChild(this._mc),this._isPlay&&(this._mc.gotoAndPlay(this._effectId,this._loop),-1!=this._loop&&this._mc.addEventListener(egret.MovieClipEvent.COMPLETE,this.onComplete,this))))):void GmGlobal.res.releaseMCData(this._effectId,!1,this.onEffectLoaded,this)},e.prototype.play=function(t,e,i){void 0===t&&(t=-1),void 0===e&&(e=null),void 0===i&&(i=null),this._isPlay=!0,this._loop=t,this._cb=e,this._thisObj=i,this._mc?(this._mc.gotoAndPlay(this._effectId,t),-1!=t&&this._mc.addEventListener(egret.MovieClipEvent.COMPLETE,this.onComplete,this)):GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this._effectId,this.onEffectLoaded,this)},e.prototype.onComplete=function(){this._cb&&this._thisObj&&this._cb.call(this._thisObj)},e.prototype.stop=function(){this._isPlay=!1,this._mc&&(this._mc.removeEventListener(egret.MovieClipEvent.COMPLETE,this.onComplete,this),this._mc.stop())},e.prototype.clear=function(t){void 0===t&&(t=!0),GmGlobal.res.releaseMCData(this._effectId,t,this.onEffectLoaded,this),this._mc&&(this.stop(),this.removeChild(this._mc),this._mc=null),this.parent&&this.parent.removeChild(this),this._cb=null,this._thisObj=null},e}(egret.DisplayObjectContainer);__reflect(MovieClipEx.prototype,"MovieClipEx");var UnitTitle=function(t){function e(){var e=t.call(this)||this;return e.offsetY=0,e}return __extends(e,t),e.prototype.getHp=function(){return 0},e}(eui.Component);__reflect(UnitTitle.prototype,"UnitTitle",["IObject"]);var BattleResultView=function(t){function e(e){var i=t.call(this,e)||this;return i.isCanClose=!1,i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),this.isCanClose=!1,egret.startTick(this.onTick,this),egret.setTimeout(this.delayEnd,this,1e3)},e.prototype.delayEnd=function(){this.isCanClose=!0},e.prototype.onTick=function(t){return this.lightCon.rotation+=1,!0},e.prototype.maskClose=function(){this.isCanClose&&this.close()},e.prototype.close=function(){egret.stopTick(this.onTick,this),t.prototype.close.call(this)},e}(UIBase);__reflect(BattleResultView.prototype,"BattleResultView");var AwardTipView=function(t){function e(){return t.call(this,"AwardGetTipSkin")||this}return __extends(e,t),e.showAward=function(t,i,s,o,n,r,h){void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),void 0===n&&(n=e),void 0===r&&(r="Item Obtained"),void 0===h&&(h=[0]),n||(n=e);var a=this._instences[n];a||(a=new n,this._instences[n]=a),a.setTit(r),a.setItems(t,h),a.show(GmGlobal.vmc.uiLayer),a.bindCloseCallback(i,s,o)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1)},e.prototype.bindCloseCallback=function(t,e,i){this._cbThis=e,this._sbData=i,this._closeCB=t,this._sbData?(this.sbBtn.visible=!0,this.okBtn.x=170,this.sbBtn.iconDisplay.source="sicon_json.sicon_"+this._sbData.itemid,this.sbBtn.label=this._sbData.label):(this.sbBtn.visible=!1,this.okBtn.x=this.width/2)},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.sbBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSbBtn,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.sbBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSbBtn,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.vmc.mGuide;i.hasGuide(GuideID.KQL_GM)?i.bindTarget(GuideTargetId.CLOSE_BTN2,this.okBtn,this.okBtn.parent.localToGlobal(this.okBtn.x,this.okBtn.y)):this.tweenShow()},e.prototype.setTit=function(t){void 0===t&&(t="Item Obtained"),""==t&&(t="Item Obtained"),this.tTit.text=t},e.prototype.setItems=function(t,e){if(void 0===e&&(e=[0]),t&&0!=t.length){this.scoll.viewport.scrollV=0,this._itemGridCon&&ItemGridCon.release(this._itemGridCon),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,100),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,10,this.itemCon,null,540),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,e&&this._itemGridCon.setItems(t,!1,"",e);var i=Math.ceil(t.length/5),s=Math.min(10*(i-1)+100*i,340);this.scoll.height=s,this.height=this.scoll.y+this.scoll.height+130,this.bgCon.height=this.scoll.height+20,this.okBtn.y=this.sbBtn.y=this.height-56}},e.prototype.clear=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),this._closeCB=null,this._sbData=null,this._cbThis=null
},e.prototype.onSbBtn=function(){this._sbData&&this._sbData.cb.call(this._cbThis),this.clear(),t.prototype.close.call(this)},e.prototype.close=function(){var e=GmGlobal.vmc.mGuide;e&&e.triggerTarget(this.okBtn),this._closeCB&&this._closeCB.call(this._cbThis),this.clear(),t.prototype.close.call(this),PFConst.HAS_AD&&GmGlobal.cc.pfCtl.pfCloseBannerAd()},e._instences={},e}(UIBase);__reflect(AwardTipView.prototype,"AwardTipView");var OneStateButton=function(t){function e(){var e=t.call(this)||this;return e.sound="ui_fangan",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._sX=this.scaleX,this._sY=this.scaleY},e.prototype.onTouchBegin=function(e){t.prototype.onTouchBegin.call(this,e),this.scaleX=1.1*this._sX,this.scaleY=1.1*this._sY,this.sound&&""!=this.sound&&GmGlobal.sound.playSoundEffect(this.sound)},e.prototype.onTouchCancle=function(e){t.prototype.onTouchCancle.call(this,e),this.buttonReleased()},e.prototype.buttonReleased=function(){this.scaleX=this._sX,this.scaleY=this._sY},e}(eui.Button);__reflect(OneStateButton.prototype,"OneStateButton",["eui.UIComponent","egret.DisplayObject"]);var PetUnitView=function(t){function e(){var e=t.call(this)||this;return e.tfType=0,e}return __extends(e,t),e.prototype.addTitle=function(t){this.title||(this.title=new RoleTitle);var e=GmGlobal.mc.role,i=this.isMyTeam();this.title.setTitleInfo(this.uName,e.roleId==this.roleId?!0:!1,this.unitData.hp,this.unitData.hpMax,i),this.title.setOffsetY(-20),this.title.x=this.point.x,this.title.y=this.point.y+this.title.offsetY,t.addChild(this.title)},e.prototype.isMyTeam=function(){var t=GmGlobal.mc.role;return this.team>0&&this.team==t.team?!0:!1},e.prototype.onDeadEnd=function(){t.prototype.onDeadEnd.call(this),UnitViewCreator.instence().releasePetView(this)},e.prototype.clear=function(){this.tfType=0,t.prototype.clear.call(this)},e}(BattleUnitView);__reflect(PetUnitView.prototype,"PetUnitView");var RoleUnitView=function(t){function e(){var e=t.call(this)||this;return e._bhEffect="biaochebaohu",e}return __extends(e,t),e.prototype.addTitle=function(t){this.title||(this.title=new RoleTitle);var e=GmGlobal.mc.role,i=this.uid==e.roleId?!0:!1,s=i?!0:this.team>0&&this.team==e.team?!0:!1;this.title.setTitleInfo(this.uName,i,this.unitData.hp,this.unitData.hpMax,s),this.title.setGonghui(this.unitData.gh),this.title.setOffsetY(-20),this.title.x=this.point.x,this.title.y=this.point.y+this.title.offsetY,t.addChild(this.title),this.unitData.ch&&this.addChenghao(this.unitData.ch,t,-this.mHeight-10),this.addMM(),1==this.team&&FubenType.getClientType(GmGlobal.mc.sceneMgr.mapId)==FubenType.WANGZUO&&(this._shTitle||(this._shTitle=new egret.TextField,this._shTitle.size=20,this._shTitle.textColor=16711680,this._shTitle.stroke=1,this._shTitle.strokeColor=0),this._shTitle.text=GmGlobal.mc.wfMgr.getWzNameByMapid(GmGlobal.mc.sceneMgr.mapId)+" Guardian",this._shTitle.anchorOffsetX=this._shTitle.textWidth/2,this.resetShTitlePos(),this._shTitle.parent||t.addChild(this._shTitle))},e.prototype.resetShTitlePos=function(){this._shTitle.x=this.point.x,this._shTitle.y=this.point.y-this.mHeight-this._shTitle.height-20},e.prototype.resetPos=function(e,i){t.prototype.resetPos.call(this,e,i),this._shTitle&&this.resetShTitlePos(),this.chenghao&&(this.chenghao.y=i+this._chOffsetY,this.chenghao.x=e),this.mmCon&&this.setMMPos()},e.prototype.onPosUpdate=function(){t.prototype.onPosUpdate.call(this),this._shTitle&&this.resetShTitlePos(),this.chenghao&&(this.chenghao.y=this.point.y+this._chOffsetY,this.chenghao.x=this.point.x),this.mmCon&&this.setMMPos()},e.prototype.updateActionName=function(){switch(this.action){case ActionType.STAND:this.dir==DirType.UP_RIGHT||this.dir==DirType.UP_LEFT?this.actionName="stand_01":this.dir==DirType.RIGHT||this.dir==DirType.LEFT?this.actionName="stand_03":this.actionName="stand_06";break;case ActionType.STAND_TO:this.actionName="stand-to";break;case ActionType.RUN:this.dir==DirType.UP_RIGHT||this.dir==DirType.UP_LEFT?this.actionName="run_01":this.dir==DirType.RIGHT||this.dir==DirType.LEFT?this.actionName="run_03":this.actionName="run_06";break;case ActionType.ATTACK:this.actionName="attack";break;case ActionType.SKILL:this.actionName="skill";break;default:this.actionName=null}},e.prototype.dirUpdate=function(){this._tsView&&this.body&&(this._tsView.scaleX=this.body.scaleX)},e.prototype.updateModel=function(e){return void 0===e&&(e=!1),t.prototype.updateModel.call(this,e)?(this._tsView&&this._tsView.gotoAndPlay(this.actionName,this.aLoop),!0):!1},e.prototype.setToushi=function(t){this._tsRes!=t&&(this._tsView&&this.clearToushi(),t&&(this._tsRes=t,GmGlobal.res.getMovieClipData(GmConst.TOUSHI_DIR,t,this.onToushiLoaded,this)))},e.prototype.clearToushi=function(){this._tsView?(this._tsView.parent&&this.removeChild(this._tsView),GmGlobal.res.releaseMCData(this._tsRes,!1,this.onToushiLoaded,this),this._tsView=null):GmGlobal.res.stopMovieClipLoad(this._tsRes,this.onToushiLoaded,this),this._tsRes=null},e.prototype.onToushiLoaded=function(t){this._tsView=new egret.MovieClip(t.generateMovieClipData(this._tsRes)),this.isBody&&this.showToushi()},e.prototype.showToushi=function(){this._bhView&&this._bhView.parent?this.addChildAt(this._tsView,this.getChildIndex(this._bhView)):this.addChild(this._tsView),this._tsView.scaleX=this.body.scaleX,this.onFrame(null)},e.prototype.setHalo=function(t){this._haloRes!=t&&(this._haloView&&this.clearHalo(),t&&(this._haloRes=t,GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,t,this.onHaloLoaded,this)))},e.prototype.clearHalo=function(){this._haloView?(this._haloView.parent&&this.removeChild(this._haloView),GmGlobal.res.releaseMCData(this._haloRes,!1,this.onHaloLoaded,this),this._haloView=null):GmGlobal.res.stopMovieClipLoad(this._haloRes,this.onHaloLoaded,this),this._haloRes=null},e.prototype.onHaloLoaded=function(t){this._haloView=new egret.MovieClip(t.generateMovieClipData(this._haloRes)),this.isBody&&this.showHalo()},e.prototype.showHalo=function(){this._haloView.play(-1),this.addChildAt(this._haloView,0)},e.prototype.setBaohu=function(){this._bhView?(this._bhView.parent||this.showBaohu(),this.clearHalo()):GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this._bhEffect,this.onBaohuLoaded,this)},e.prototype.clearBaohu=function(){this._bhView?(this._bhView.parent&&this.removeChild(this._bhView),GmGlobal.res.releaseMCData(this._bhEffect,!1,this.onBaohuLoaded,this),this._bhView=null):GmGlobal.res.stopMovieClipLoad(this._bhEffect,this.onBaohuLoaded,this)},e.prototype.onBaohuLoaded=function(t){this._bhView=new egret.MovieClip(t.generateMovieClipData(this._bhEffect)),this.isBody&&this.showBaohu()},e.prototype.showBaohu=function(){this._bhView.y=-55,this.addChild(this._bhView)},e.prototype.addChenghao=function(t,e,i){if(0==t)return void this.rmChenghao();var s=GmGlobal.mc.titleMgr.getIconById(t);s&&(this.chenghao||(this.chenghao=new eui.Image,this.chenghao.touchEnabled=!1),this.chenghao.source=s,this.chenghao.anchorOffsetX=80,this.chenghao.anchorOffsetY=60,this._chOffsetY=i,this.chenghao.y=this.y+i,this.chenghao.x=this.x,e&&!this.chenghao.parent&&(e.addChild(this.chenghao),this.setMMPos()))},e.prototype.rmChenghao=function(){this.chenghao&&this.chenghao.parent&&this.chenghao.parent.removeChild(this.chenghao)},e.prototype.addMM=function(){var t=GmGlobal.mc.wfMgr.mmCatInfo;t[this.uid]&&this.setMMNum(t[this.uid])},e.prototype.setMMNum=function(t){if(t>0)if(this.mmCon||(this.mmCon=new egret.DisplayObjectContainer,this.mmCon.touchEnabled=!1,this.mmCon.touchChildren=!1,this.mmCon.anchorOffsetX=62),!this.mmCon.parent&&this.title.parent&&(this.title.parent.addChild(this.mmCon),this.setMMPos()),this.mmCon.numChildren<t)for(var e=this.mmCon.numChildren;t>e;e++){var i=new eui.Image("mm_smodel_png");i.x=e%5*25,i.y=-25*Math.floor(e/5+1),this.mmCon.addChild(i)}else for(;this.mmCon.numChildren>t;)this.mmCon.removeChildAt(t-1);else this.clearMM()},e.prototype.clearMM=function(){if(this.mmCon){for(;this.mmCon.numChildren>0;)this.mmCon.removeChildAt(0);this.mmCon.parent&&this.mmCon.parent.removeChild(this.mmCon)}},e.prototype.setMMPos=function(){if(this.mmCon){var t=this.mHeight;this.chenghao&&this.chenghao.parent&&(t+=60),this.mmCon.y=this.y-t,this.mmCon.x=this.x}},e.prototype.onBodyLoaded=function(){t.prototype.onBodyLoaded.call(this),this.body.addEventListener(egret.MovieClipEvent.ENTER_FRAME,this.onFrame,this),this._tsView&&!this._tsView.parent&&this.addChild(this._tsView),this._haloView&&this.showHalo(),this._bhView&&this.showBaohu()},e.prototype.onFrame=function(t){if(this.body.isPlaying){this._tsView&&this._tsView.parent&&this._tsView.gotoAndStop(this.body.currentFrame);var e=this.body.currentFrame;if(this.pauseData&&this.pauseData[e]){this.body.stop();var i=125*this.pauseData[e]/1e3;GameTick.instence().setTimeOut(i,this.onActionPauseEnd,this),delete this.pauseData[e]}}},e.prototype.onActionPauseEnd=function(){this.body.play()},e.prototype.onDeadEnd=function(){t.prototype.onDeadEnd.call(this),this.rmShTitle(),UnitViewCreator.instence().releaseRoleView(this)},e.prototype.clearBody=function(){GameTick.instence().clearTimeOut(this.onActionPauseEnd,this),this.clearToushi(),this.clearHalo(),this.clearBaohu(),this.body&&this.body.removeEventListener(egret.MovieClipEvent.ENTER_FRAME,this.onFrame,this),t.prototype.clearBody.call(this)},e.prototype.removeFromScene=function(){this._shTitle&&this._shTitle.parent&&this._shTitle.parent.removeChild(this._shTitle),this.chenghao&&this.chenghao.parent&&this.chenghao.parent.removeChild(this.chenghao),t.prototype.removeFromScene.call(this)},e.prototype.rmShTitle=function(){this._shTitle&&(this._shTitle.parent&&this._shTitle.parent.removeChild(this._shTitle),this._shTitle=null)},e.prototype.unuse=function(){this.stopAttack(),this.rmShTitle(),this.rmChenghao(),this.clearMM(),t.prototype.unuse.call(this)},e.prototype.reuse=function(){this.body&&this.body.addEventListener(egret.MovieClipEvent.ENTER_FRAME,this.onFrame,this),t.prototype.reuse.call(this)},e}(BattleUnitView);__reflect(RoleUnitView.prototype,"RoleUnitView");var TipsBase=function(t){function e(){var e=t.call(this,"TipsSkin")||this;return e.SPACE_TITLE=12,e.SPACE_TXT=8,e.SPACE_X=9,e.T1SIZE=24,e.T2SIZE=22,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.showTips=function(e,i,s){t.prototype.show.call(this,e,!0,!0,.01),0>i?i=0:i+this.width>GmGlobal.stageWidth&&(i=GmGlobal.stageWidth-this.width),this.x=i,0>s?s=0:s+this.height>GmGlobal.stageHeight&&(s=GmGlobal.stageHeight-this.height),this.y=s},e.prototype.updateIcon=function(t){this.item.setItem(new Item(t,0))},e.prototype.resetTipsHeight=function(){},e.prototype.close=function(){this.item.setItem(null),t.prototype.close.call(this)},e}(UIBase);__reflect(TipsBase.prototype,"TipsBase");var WanfaJxgcView=function(t){function e(){return t.call(this,"WanfaJxgcSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bg.source=this.getBgRes()},e.prototype.getBgRes=function(){return"jixie_bg_jpg"},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bCreate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.bExit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bYq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),this.bStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this);for(var t=1;4>t;t++){var e=this["icon"+t];e.dui.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTc,this)}EventBus.addListener(EventType.M_JUPD+JsonID.JXGC_UPD,this.updateData,this),EventBus.addListener(EventType.M_JUPD+JsonID.MK_UPD,this.updateData,this),EventBus.addListener(EventType.FB_TEAM,this.updateTeamList,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bCreate.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.bExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bYq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),this.bStart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this);for(var t=1;4>t;t++){var e=this["icon"+t];e.dui.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTc,this)}EventBus.rmListener(EventType.M_JUPD+JsonID.JXGC_UPD,this.updateData,this),EventBus.rmListener(EventType.M_JUPD+JsonID.MK_UPD,this.updateData,this),EventBus.rmListener(EventType.FB_TEAM,this.updateTeamList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateData(),this.updateTeamList()},e.prototype.getCfg=function(){return GmGlobal.mc.wfMgr.getJxgcCfg()},e.prototype.getData=function(){return GmGlobal.mc.dataMgr.getJData(JsonID.JXGC_UPD)},e.prototype.updateData=function(){var t=GmGlobal.mc,e=this.getCfg(),i=this.getData(),s=void 0==i.data.acnt?e.cnt:i.data.acnt;this.tNum.text="Daily Challenges："+s,i.data.b>=e.bprice.length?this.buyCon.visible=!1:(this.buyCon.visible=!0,this.tPrice.text=this.getBuyCost(i.data.b||0,e.bprice).toString()),Utils.setBtnEnable(this.bCreate,s>0?!0:!1),this.updateTeamInfo(t.wfMgr.fbTeam)},e.prototype.getBuyCost=function(t,e){return t<e.length?e[t]:e[e.length-1]},e.prototype.updateTeamInfo=function(t){if(t){this.infoCon.visible=!0,this.bCreate.visible=!1;var e=t[1];e.roleid==GmGlobal.mc.role.roleId?(this.bStart.visible=!0,this.bExit.visible=!1):(this.bStart.visible=!1,this.bExit.visible=!0)}else this.infoCon.visible=!1,this.bCreate.visible=!0},e.prototype.isThisFb=function(t){return t&&t[1].fid==FubenType.JXGC?!0:!1},e.prototype.updateTeamList=function(){var t=GmGlobal.mc,e=t.wfMgr.fbTeam;if(!this.isThisFb(e))return this.infoCon.visible=!1,void(this.bCreate.visible=!0);this.updateTeamInfo(e);for(var i=!1,s=0;4>s;s++){var o=this["icon"+s],n=e[s+1];if(n){o.icon.visible=!0,o.dui.visible=!1,o.tLv.visible=!0,o.tName.visible=!0,o.roleId=n.roleid,o.tLv.text="Lv."+n.lv,o.tName.text=n.name,o.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+n.career+".png";var r=GmGlobal.mc.setMgr.getXkCfg(n.head||0);o.txk.source="txk_json."+(r?r.icon:"txk"),0==s?(o.dui.visible=!0,n.roleid==GmGlobal.mc.role.roleId&&(i=!0),o.dui.source="com_json.dui"):i&&(o.dui.visible=!0,o.dui.source="com_json.tichu")}else o.icon.visible=!1,o.txk.source="txk_json.txk",o.dui.visible=!1,o.tLv.visible=!1,o.tName.visible=!1;o.updateIconIdx()}},e.prototype.onTc=function(t){var e=t.target.parent.roleId;GmGlobal.cc.dataCtl.doAction(ServerActionId.TAKEOUT,[e])},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this.getCfg().rule)},e.prototype.onCreate=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_CREATE,[FubenType.JXGC])},e.prototype.onYq=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&FubenInvateView.show(t[1].roleid,FubenType.JXGC)},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ENTER,null,this.onEnterOk,this)},e.prototype.onEnterOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.onExit=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_EXIT,null)},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_JXGC_AW,1,this.getCfg().items,this.getCfg().awtxt)},e.prototype.onAdd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.JXGC_BUY)},e.prototype.clearTeamData=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&t[1].fid==FubenType.JXGC&&(GmGlobal.mc.wfMgr.fbTeam=null)},e.prototype.close=function(){this.clearTeamData(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("jixie_bg_jpg")},e}(UIBase);__reflect(WanfaJxgcView.prototype,"WanfaJxgcView");var MvpJlView=function(t){function e(){var e=t.call(this,"MvpJlSkin")||this;return e._sNo=0,e._rankId=RankID.MVP_RANK,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this.jlScoll.verticalScrollBar&&(this.jlScoll.verticalScrollBar.autoVisibility=!1),this.jlScoll.horizontalScrollBar&&(this.jlScoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="MvpJlItemSkin",this.itemList.itemRenderer=MvpJlItem,this._jlArray=new eui.ArrayCollection,this.jlList.dataProvider=this._jlArray,this.jlList.itemRendererSkinName="MvpPJlItemSkin",this.jlList.itemRenderer=MvpPJlItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.onJl=function(t,e){if(0==t&&e){var i=[];this.jlScoll.viewport.scrollH=0,this.jlScoll.stopAnimation();for(var s in e.award)i.push(e.award[s]);this._jlArray.replaceAll(i);var o=[];for(var s in e.rank)o.push(e.rank[s].rid);this._cc.rankCtl.getRoleData(o,e.rank,[RoleAttrId.CAREER],this.onRank,this)}},e.prototype.onRank=function(t){var e=0;this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this._array.removeAll();for(var i in t){var s=t[i],o={rdata:s,idx:Number(i)};s.rid==this._mc.role.roleId&&(e=o.idx),this._array.addItem(o)}e>0?this.tRank.text=e.toString():this.tRank.text="Unranked"},e.prototype.setRankType=function(t){void 0===t&&(t=0),this.scoll.viewport.scrollV=0;var e=GmGlobal.mc.role;this._cc.dataCtl.pbReq(PbReqId.MVP_JL,[t+1,e.kfFlag],null,this.onJl,this)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MVP_JL)},e.prototype.close=function(){0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(MvpJlView.prototype,"MvpJlView");var CmdBus=function(){function t(){}return t.doCmd=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];var o=t.cmds[e];if(o)for(var n=o.length,r=0;n>r;r++){var h=o[r];h.notify.apply(h,i)}},t.adListener=function(e,i,s){var o=t.cmds[e];if(o)for(var n=0,r=o;n<r.length;n++){var h=r[n];if(h.has(i,s))return}else t.cmds[e]=[];t.cmds[e].push(new CmdObs(i,s))},t.rmListener=function(e,i,s){var o=t.cmds[e];if(o){for(var n=o.length,r=0;n>r;r++){var h=o[r];if(h.compar(s)){o.splice(r,1);break}}0==o.length&&delete t.cmds[e]}},t.cmds={},t}();__reflect(CmdBus.prototype,"CmdBus");var CmdObs=function(){function t(t,e){this._cb=null,this._context=null,this._cb=t,this._context=e}return t.prototype.notify=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];(i=this._cb).call.apply(i,[this._context].concat(t));var i},t.prototype.compar=function(t){return t==this._context},t.prototype.has=function(t,e){return t==this._cb&&e==this._context?!0:!1},t}();__reflect(CmdObs.prototype,"CmdObs");var CmdType;!function(t){t[t.O_R_SEL=0]="O_R_SEL",t[t.C_R_SEL=1]="C_R_SEL",t[t.CK_CREATE=2]="CK_CREATE",t[t.O_R_CREATE=3]="O_R_CREATE",t[t.C_R_CREATE=4]="C_R_CREATE",t[t.PLOAD_CS=5]="PLOAD_CS",t[t.ENTER_CS=6]="ENTER_CS",t[t.O_MUI=7]="O_MUI",t[t.AD_M_ICON=8]="AD_M_ICON",t[t.RM_M_ICON=9]="RM_M_ICON",t[t.RE_M_ICON=10]="RE_M_ICON",t[t.C_MUI=11]="C_MUI",t[t.O_HERO=12]="O_HERO",t[t.C_HERO=13]="C_HERO",t[t.O_HERO_EQP=14]="O_HERO_EQP",t[t.C_HERO_EQP=15]="C_HERO_EQP",t[t.O_HERO_CARD=16]="O_HERO_CARD",t[t.C_HERO_CARD=17]="C_HERO_CARD",t[t.O_HERO_TIP=18]="O_HERO_TIP",t[t.C_HERO_TIP=19]="C_HERO_TIP",t[t.O_HERO_JJ_TIP=20]="O_HERO_JJ_TIP",t[t.C_HERO_JJ_TIP=21]="C_HERO_JJ_TIP",t[t.O_HERO_YZ_JL=22]="O_HERO_YZ_JL",t[t.C_HERO_YZ_JL=23]="C_HERO_YZ_JL",t[t.O_HERO_YZ_ZH=24]="O_HERO_YZ_ZH",t[t.C_HERO_YZ_ZH=25]="C_HERO_YZ_ZH",t[t.O_CHAT=26]="O_CHAT",t[t.C_CHAT=27]="C_CHAT",t[t.O_MAIL=28]="O_MAIL",t[t.C_MAIL=29]="C_MAIL",t[t.O_MAIL_H=30]="O_MAIL_H",t[t.C_MAIL_H=31]="C_MAIL_H",t[t.O_MAILC_V=32]="O_MAILC_V",t[t.C_MAILC_V=33]="C_MAILC_V",t[t.O_SET=34]="O_SET",t[t.C_SET=35]="C_SET",t[t.O_BUG_SM=36]="O_BUG_SM",t[t.O_SHARE=37]="O_SHARE",t[t.C_SHARE=38]="C_SHARE",t[t.O_RULE=39]="O_RULE",t[t.C_RULE=40]="C_RULE",t[t.O_PAY=41]="O_PAY",t[t.C_PAY=42]="C_PAY",t[t.O_RANK=43]="O_RANK",t[t.C_RANK=44]="C_RANK",t[t.O_NOTICE=45]="O_NOTICE",t[t.C_NOTICE=46]="C_NOTICE",t[t.O_BAG=47]="O_BAG",t[t.C_BAG=48]="C_BAG",t[t.O_BAG_FJ=49]="O_BAG_FJ",t[t.C_BAG_FJ=50]="C_BAG_FJ",t[t.O_BAG_HC=51]="O_BAG_HC",t[t.C_BAG_HC=52]="C_BAG_HC",t[t.O_BAG_ZX=53]="O_BAG_ZX",t[t.C_BAG_ZX=54]="C_BAG_ZX",t[t.O_SELL=55]="O_SELL",t[t.C_SELL=56]="C_SELL",t[t.O_BUY=57]="O_BUY",t[t.C_BUY=58]="C_BUY",t[t.O_TASK=59]="O_TASK",t[t.C_TASK=60]="C_TASK",t[t.O_SIGNIN=61]="O_SIGNIN",t[t.C_SIGNIN=62]="C_SIGNIN",t[t.O_LZS=63]="O_LZS",t[t.C_LZS=64]="C_LZS",t[t.O_FPAY=65]="O_FPAY",t[t.C_FPAY=66]="C_FPAY",t[t.O_DPAY=67]="O_DPAY",t[t.C_DPAY=68]="C_DPAY",t[t.O_LP_SHARE=69]="O_LP_SHARE",t[t.C_LP_SHARE=70]="C_LP_SHARE",t[t.O_MAPSEL=71]="O_MAPSEL",t[t.C_MAPSEL=72]="C_MAPSEL",t[t.O_EQUIP=73]="O_EQUIP",t[t.C_EQUIP=74]="C_EQUIP",t[t.O_EQUIP_JC=75]="O_EQUIP_JC",t[t.C_EQUIP_JC=76]="C_EQUIP_JC",t[t.O_TOUSHI_M=77]="O_TOUSHI_M",t[t.C_TOUSHI_M=78]="C_TOUSHI_M",t[t.O_TOUSHI=79]="O_TOUSHI",t[t.C_TOUSHI=80]="C_TOUSHI",t[t.O_SKILL=81]="O_SKILL",t[t.C_SKILL=82]="C_SKILL",t[t.O_PET=83]="O_PET",t[t.C_PET=84]="C_PET",t[t.O_PET_USE=85]="O_PET_USE",t[t.C_PET_USE=86]="C_PET_USE",t[t.O_PET_TIP=87]="O_PET_TIP",t[t.C_PET_TIP=88]="C_PET_TIP",t[t.O_TRADE=89]="O_TRADE",t[t.C_TRADE=90]="C_TRADE",t[t.O_TRADE_SELL=91]="O_TRADE_SELL",t[t.C_TRADE_SELL=92]="C_TRADE_SELL",t[t.O_TRADE_ZS=93]="O_TRADE_ZS",t[t.C_TRADE_ZS=94]="C_TRADE_ZS",t[t.O_SHOP=95]="O_SHOP",t[t.C_SHOP=96]="C_SHOP",t[t.O_EXCHANGE=97]="O_EXCHANGE",t[t.C_EXCHANGE=98]="C_EXCHANGE",t[t.O_WEID=99]="O_WEID",t[t.C_WEID=100]="C_WEID",t[t.O_FULI=101]="O_FULI",t[t.C_FULI=102]="C_FULI",t[t.O_FULI_LST=103]="O_FULI_LST",t[t.C_FULI_LST=104]="C_FULI_LST",t[t.O_JINGLI=105]="O_JINGLI",t[t.C_JINGLI=106]="C_JINGLI",t[t.O_VIP=107]="O_VIP",t[t.C_VIP=108]="C_VIP",t[t.O_REWARD=109]="O_REWARD",t[t.C_REWARD=110]="C_REWARD",t[t.O_MVP=111]="O_MVP",t[t.C_MVP=112]="C_MVP",t[t.O_MVP_JL=113]="O_MVP_JL",t[t.C_MVP_JL=114]="C_MVP_JL",t[t.O_MVP_AW=115]="O_MVP_AW",t[t.C_MVP_AW=116]="C_MVP_AW",t[t.O_MVP_JOIN=117]="O_MVP_JOIN",t[t.C_MVP_JOIN=118]="C_MVP_JOIN",t[t.O_XINGZUO=119]="O_XINGZUO",t[t.C_XINGZUO=120]="C_XINGZUO",t[t.O_XZ_ATTR=121]="O_XZ_ATTR",t[t.C_XZ_ATTR=122]="C_XZ_ATTR",t[t.O_GUAJI=123]="O_GUAJI",t[t.C_GUAJI=124]="C_GUAJI",t[t.O_WF_LST=125]="O_WF_LST",t[t.C_WF_LST=126]="C_WF_LST",t[t.O_WANFA=127]="O_WANFA",t[t.C_WANFA=128]="C_WANFA",t[t.O_ARENA_JFAW=129]="O_ARENA_JFAW",t[t.C_ARENA_JFAW=130]="C_ARENA_JFAW",t[t.O_ARENA_ZB=131]="O_ARENA_ZB",t[t.C_ARENA_ZB=132]="C_ARENA_ZB",t[t.O_ARENA_JS=133]="O_ARENA_JS",t[t.C_ARENA_JS=134]="C_ARENA_JS",t[t.O_WZ_AW=135]="O_WZ_AW",t[t.C_WZ_AW=136]="C_WZ_AW",t[t.O_DC_ZB=137]="O_DC_ZB",t[t.C_DC_ZB=138]="C_DC_ZB",t[t.O_GONGHUI=139]="O_GONGHUI",t[t.C_GONGHUI=140]="C_GONGHUI",t[t.O_GONGHUI_C=141]="O_GONGHUI_C",t[t.C_GONGHUI_C=142]="C_GONGHUI_C",t[t.O_GONGHUI_XXCY=143]="O_GONGHUI_XXCY",t[t.C_GONGHUI_XXCY=144]="C_GONGHUI_XXCY",t[t.O_GONGHUI_RANK=145]="O_GONGHUI_RANK",t[t.C_GONGHUI_RANK=146]="C_GONGHUI_RANK",t[t.O_GONGHUI_SQ_TIP=147]="O_GONGHUI_SQ_TIP",t[t.C_GONGHUI_SQ_TIP=148]="C_GONGHUI_SQ_TIP",t[t.O_KAPULA=149]="O_KAPULA",t[t.C_KAPULA=150]="C_KAPULA",t[t.O_FIRSTPAY=151]="O_FIRSTPAY",t[t.C_FIRSTPAY=152]="C_FIRSTPAY",t[t.O_HUOBAN=153]="O_HUOBAN",t[t.C_HUOBAN=154]="C_HUOBAN",t[t.O_HUOBAN_ZR=155]="O_HUOBAN_ZR",t[t.C_HUOBAN_ZR=156]="C_HUOBAN_ZR",t[t.O_HUOBAN_JH=157]="O_HUOBAN_JH",t[t.C_HUOBAN_JH=158]="C_HUOBAN_JH",t[t.O_YCSHOP=159]="O_YCSHOP",t[t.C_YCSHOP=160]="C_YCSHOP",t[t.O_BAOWU=161]="O_BAOWU",t[t.C_BAOWU=162]="C_BAOWU",t[t.O_BAOWU_ATR=163]="O_BAOWU_ATR",t[t.C_BAOWU_ATR=164]="C_BAOWU_ATR",t[t.O_BAOWU_JH=165]="O_BAOWU_JH",t[t.C_BAOWU_JH=166]="C_BAOWU_JH",t[t.O_HAOLI=167]="O_HAOLI",t[t.C_HAOLI=168]="C_HAOLI",t[t.O_7DAY=169]="O_7DAY",t[t.C_7DAY=170]="C_7DAY",t[t.O_YIYUAN=171]="O_YIYUAN",t[t.C_YIYUAN=172]="C_YIYUAN",t[t.O_CAT=173]="O_CAT",t[t.C_CAT=174]="C_CAT",t[t.O_FRIEND=175]="O_FRIEND",t[t.C_FRIEND=176]="C_FRIEND",t[t.O_FRIEND_CHAT=177]="O_FRIEND_CHAT",t[t.C_FRIEND_CHAT=178]="C_FRIEND_CHAT",t[t.O_DAY7_GIFT=179]="O_DAY7_GIFT",t[t.C_DAY7_GIFT=180]="C_DAY7_GIFT",t[t.O_TUJIAN=181]="O_TUJIAN",t[t.C_TUJIAN=182]="C_TUJIAN",t[t.O_TUJIAN_GZ=183]="O_TUJIAN_GZ",t[t.C_TUJIAN_GZ=184]="C_TUJIAN_GZ",t[t.O_TUJIAN_RH=185]="O_TUJIAN_RH",t[t.C_TUJIAN_RH=186]="C_TUJIAN_RH",t[t.BATTLE_ATTACK=187]="BATTLE_ATTACK",t[t.BATTLE_USE_SKILL=188]="BATTLE_USE_SKILL",t[t.S_ZHUABU=189]="S_ZHUABU",t[t.DO_ZHUABU=190]="DO_ZHUABU",t[t.C_GUIDE_TASK=191]="C_GUIDE_TASK",t[t.EXIT_JQ=192]="EXIT_JQ",t[t.O_SEL_SV=193]="O_SEL_SV",t[t.C_SEL_SV=194]="C_SEL_SV",t[t.C_SLIST=195]="C_SLIST",t[t.S_BCJS=196]="S_BCJS",t[t.O_JXGC_AW=197]="O_JXGC_AW",t[t.C_JXGC_AW=198]="C_JXGC_AW",t[t.XS_REPLACE=199]="XS_REPLACE",t[t.S_FREE_BTN=200]="S_FREE_BTN",t[t.H_FREE_BTN=201]="H_FREE_BTN",t[t.DO_EXIT_FB=202]="DO_EXIT_FB",t[t.O_GTASK=203]="O_GTASK",t[t.C_GTASK=204]="C_GTASK",t[t.O_SY_AW=205]="O_SY_AW",t[t.C_SY_AW=206]="C_SY_AW",t[t.O_SY_RANK=207]="O_SY_RANK",t[t.C_SY_RANK=208]="C_SY_RANK",t[t.O_DGIFT=209]="O_DGIFT",t[t.C_DGIFT=210]="C_DGIFT",t[t.C_QUICK_TASK=211]="C_QUICK_TASK",t[t.O_SWEET=212]="O_SWEET",t[t.C_SWEET=213]="C_SWEET",t[t.O_SWEET_ZG=214]="O_SWEET_ZG",t[t.C_SWEET_ZG=215]="C_SWEET_ZG",t[t.O_HUNT=216]="O_HUNT",t[t.C_HUNT=217]="C_HUNT",t[t.O_HUNT_PM=218]="O_HUNT_PM",t[t.C_HUNT_PM=219]="C_HUNT_PM",t[t.O_HUNT_PM_CK=220]="O_HUNT_PM_CK",t[t.C_HUNT_PM_CK=221]="C_HUNT_PM_CK",t[t.O_HUNT_PAY=222]="O_HUNT_PAY",t[t.C_HUNT_PAY=223]="C_HUNT_PAY",t[t.O_WEIGHT=224]="O_WEIGHT",t[t.C_WEIGHT=225]="C_WEIGHT",t[t.O_TITLE=226]="O_TITLE",t[t.C_TITLE=227]="C_TITLE",t[t.O_VIP1=228]="O_VIP1",t[t.C_VIP1=229]="C_VIP1",t[t.O_LJS=230]="O_LJS",t[t.C_LJS=231]="C_LJS",t[t.O_LJS_TJ=232]="O_LJS_TJ",t[t.C_LJS_TJ=233]="C_LJS_TJ",t[t.O_LJS_ZSLJ=234]="O_LJS_ZSLJ",t[t.C_LJS_ZSLJ=235]="C_LJS_ZSLJ",t[t.O_WDLOGIN=236]="O_WDLOGIN",t[t.C_WDLOGIN=237]="C_WDLOGIN",t[t.O_MM_JFAW=238]="O_MM_JFAW",t[t.C_MM_JFAW=239]="C_MM_JFAW",t[t.O_RECORD=240]="O_RECORD",t[t.C_RECORD=241]="C_RECORD",t[t.O_SHIPIN=242]="O_SHIPIN",t[t.C_SHIPIN=243]="C_SHIPIN",t[t.O_XK=244]="O_XK",t[t.C_XK=245]="C_XK",t[t.O_PAYTEST=246]="O_PAYTEST",t[t.C_PAYTEST=247]="C_PAYTEST",t[t.O_HALO=248]="O_HALO",t[t.C_HALO=249]="C_HALO",t[t.O_PET_CH_ZSX=250]="O_PET_CH_ZSX",t[t.C_PET_CH_ZSX=251]="C_PET_CH_ZSX",t[t.O_MCJ=252]="O_MCJ",t[t.C_MCJ=253]="C_MCJ",t[t.O_MCJ_CJ=254]="O_MCJ_CJ",t[t.C_MCJ_CJ=255]="C_MCJ_CJ",t[t.O_GNOTICE=256]="O_GNOTICE",t[t.C_GNOTICE=257]="C_GNOTICE",t[t.O_HLQD=258]="O_HLQD",t[t.C_HLQD=259]="C_HLQD",t[t.O_DDS_AW=260]="O_DDS_AW",t[t.C_DDS_AW=261]="C_DDS_AW",t[t.O_ZCD_AW=262]="O_ZCD_AW",t[t.C_ZCD_AW=263]="C_ZCD_AW",t[t.O_LHJ_JFAW=264]="O_LHJ_JFAW",t[t.C_LHJ_JFAW=265]="C_LHJ_JFAW",t[t.O_LHJ_DH=266]="O_LHJ_DH",t[t.C_LHJ_DH=267]="C_LHJ_DH",t[t.O_LHJ_RANK=268]="O_LHJ_RANK",t[t.C_LHJ_RANK=269]="C_LHJ_RANK",t[t.O_LHJ_RULE=270]="O_LHJ_RULE",t[t.C_LHJ_RULE=271]="C_LHJ_RULE",t[t.O_ZLB=272]="O_ZLB",t[t.C_ZLB=273]="C_ZLB",t[t.O_WJ=274]="O_WJ",t[t.S_M_CD=275]="S_M_CD",t[t.C_M_CD=276]="C_M_CD",t[t.O_YCKJ=277]="O_YCKJ",t[t.C_YCKJ=278]="C_YCKJ",t[t.O_MS_HC=279]="O_MS_HC",t[t.C_MS_HC=280]="C_MS_HC",t[t.JZT_TOPOS=281]="JZT_TOPOS",t[t.O_JZT_R=282]="O_JZT_R",t[t.C_JZT_R=283]="C_JZT_R"}(CmdType||(CmdType={}));var EventBus=function(){function t(){}return t.addListener=function(e,i,s,o){void 0===o&&(o=0),t._evt.addEventListener(e,i,s,!1,o)},t.rmListener=function(e,i,s){t._evt.removeEventListener(e,i,s)},t.dispatchEvt=function(e,i){void 0===i&&(i=null),t._evt.dispatchEvent(new egret.Event(e,!1,!1,i))},t._evt=new egret.EventDispatcher,t}();__reflect(EventBus.prototype,"EventBus");var EventType=function(){function t(){}return t.HIDDE_CHANGE="GM_HC",t.S_CLOSE="GM_SCLOSE",t.S_ERROR="GM_SERROR",t.S_RECONNECT="GM_RC",t.OFFLINE="gm_offline",t.INITED="GM_INITED",t.ENTER_GAME="enter_game",t.GAME_READY="GM_READY",t.ENTER_SCENE="enter_sc",t.LEAVE_SCENE="leave_scene",t.RESIZE="gm_resize",t.M_CHATMSG_UPD="M_CHATMSG_UPD",t.M_MY_PCHAT="m_my_pacht",t.M_CHATMAG_ALLUPD="M_C_ALL",t.M_CHATMSG_INIT="M_CHATMSG_INIT",t.PCHAT_LOG="pchat_log",t.M_JUPD="M_JUPD_",t.M_UPD_CON="M_UPD_CON",t.M_MUI_SW_PRE="M_MUI_SW_PRE",t.M_MUI_READY="M_MUI_READY",t.M_R_UPD="M_R_UPD",t.M_RLV_UPD="m_rlv_upe",t.M_EXP_UPD="m_exp_upd",t.PAY_OPEN="PAY_OPEN",t.M_PAY_UPD="M_PAY_UPD",t.M_FPAY_UPD="m_fpay_upd",t.M_DPAY_UPD="m_dpay_upd",t.M_IS_PAY="M_IS_PAY",t.M_HUOD_CJ_AWD="M_HUOD_CJ_AWD",t.M_HUOD_ZCM="M_HUOD_ZCM",t.M_HUOD_PAY="M_HUOD_PAY",t.M_HUOD_PAY_BOX="M_HUOD_PAY_BOX",t.M_SHARE="M_SHARE",t.M_SHARE_SP="M_SHARE_SP",t.M_MAIL_UPD="M_MAIL_UPD",t.RANK_UPD="RANK_UPD",t.M_TASK_DAY="M_TASK_DAY",t.M_TASK_GROW="M_TASK_GROW",t.M_TASK_HYD="M_TASK_HYD",t.M_TASK_LOOP="m_task_loop",t.M_TASK_WEEK="m_task_week",t.SIGNIN_UPD="signin_upd",t.CHOUJIANG_UPD="choujiang_upd",t.CHOUJIANG_AW_UPD="choujiang_aw_upd",t.LZS_UPD="lzs_upd",t.GUIDE_DIALOG_FINISH="gdfinish",t.GUIDE_FINISH="guidefinish",t.GUIDE_TASK_UPD="guidetaskupd",t.TRIGGER_GUIDE="trigerguide",t.YK_UPD="yk_upd",t.LC_UPD="lc_upd",t.JJ_UPD="jj_upd",t.M_ELIST_UPD="m_elist_upd",t.M_EQUIP_UPD="m_equip_upd",t.M_EQUIP_YZ_UPD="M_EQUIP_YZ_UPD",t.M_EQUIP_MS_UPD="m_equip_ms_upd",t.M_HERO_UPD="m_hero_upd",t.M_ECARD_UPD="m_ecard_upd",t.M_EATRS_UPD="m_eatrs_upd",t.M_TOUSHI_UPD="M_TOUSHI_UPD",t.M_TOUSHI_BID_UPD="M_TOUSHI_BID_UPD",t.M_TOUSHI_SC="M_TOUSHI_SC",t.M_SKILL_UPD="M_SKILL_UPD",t.M_PET_UPD="M_PET_UPD",t.M_PET_INFO="M_PET_INFO",t.M_PET_CH_UPD="mpetchupd",t.M_FL_QD="M_FL_QD",t.M_WD_QD="M_WD_QD",t.M_FL_LB="M_FL_LB",t.M_FL_LIANC="M_FL_LIANC",t.M_FL_LC="M_FL_LC",t.M_FL_ND="M_FL_ND",t.M_FL_ND_AWD="M_FL_ND_AWD",t.M_FL_TZ="m_fl_tz",t.M_SHOP="M_SHOP",t.M_SHOP_ZS="M_SHOP_ZS",t.M_VIP="M_VIP",t.M_MONTH="m_month",t.M_WEEK="m_week",t.M_FIRSTPAY="M_FIRSTPAY",t.M_TRADE="M_TRADE",t.M_TRADE_SELL="M_TRADE_SELL",t.M_TRADE_GZ="M_TRADE_GZ",t.M_TRADE_BPRICE="M_TRADE_BPRICE",t.M_GUILD="M_GUILD",t.M_GUILD_SQ_LST="M_GUILD_SQ_LST",t.M_GUILD_LST="M_GUILD_LST",t.M_GUILD_M_LST="M_GUILD_M_LST",t.M_GUILD_FL="M_GUILD_FL",t.M_GUILD_FL_ITEM="M_GUILD_FL_ITEM",t.M_GUILD_DD="M_GUILD_DD",t.M_GUILD_HZ="M_GUILD_HZ",t.M_GUILD_HZ_TIME="M_GUILD_HZ_TIME",t.M_RWD="M_RWD",t.M_RWD_RC="M_RWD_RC",t.M_RWD_TZ="M_RWD_TZ",t.M_RWD_SJ="M_RWD_SJ",t.M_MVP_NUM="M_MVP_NUM",t.M_MVP_NUMS="M_MVP_NUMS",t.M_MVP_LST="M_MVP_LST",t.M_HUOB_INFO="M_HUOB_INFO",t.M_HUOB_LST="M_HUOB_LST",t.M_HUOB_ZR="M_HUOB_ZR",t.M_YCSHOP_AW="M_YCSHOP_AW",t.M_BAOWU="M_BAOWU",t.M_HAOLI="M_HAOLI",t.M_YIYUAN="M_YIYUAN",t.M_DAY7="M_DAY7",t.M_DAY7_TZ="M_DAY7_TZ",t.M_DAY7_GIFT="M_DAY7_GIFT",t.M_CAT="M_CAT",t.M_FRIEND_ADD="toast.addfriend",t.M_FRIEND_DEL="toast.delfriend",t.M_TUJIAN="M_TUJIAN",t.S_HP_CH="s_hp_ch",t.S_SP_CH="s_sp_ch",t.M_SKILL_L_UPD="M_SKILL_L_UPD",t.M_R_Z_UPD="M_R_Z_UPD",t.XZ_UPD="xz_upd",t.HD_STATE_UPD="hd_state_upd",t.HD_CLOSE="hd_close",t.FB_COMPLETE="tb_complete",t.WZ_UPD="wz_upd",t.YB_UPD="yb_upd",t.YB_LEVEL="yb_level",t.JJ_ZB_UPD="jj_zb_upd",t.BUFF_ICON="buff_icon",t.BUFF_RM="buff_rm",t.BUFF_CLEAR="buff_clear",t.CT_BUFF_UPD="ctBuffUpd",t.PVP_TIME="pvp_time",t.FB_TEAM="jx_team",t.BOSSHP_SHOW="bhp_show",t.BOSSHP_HIDE="bhp_hide",t.TOWERHP_SHOW="thp_s",t.GTASK_UPD="gtask_upd",t.SY_TIME_UPD="sy_time_upd",t.SY_BUFF="sy_buff",t.DC_UPD="dc_upd",t.DC_ZB_UPD="dc_zb_upd",t.DC_AW="dc_aw",t.DGIFT_UPD="dgift_upd",t.DGIFT_LC_UPD="dgift_lc_upd",t.DGIFT_LB="dgift_lb",t.HUNT_UPD="HUNT_UPD",t.HUNT_PAY_UPD="HUNT_PAY_UPD",t.HUNT_TIME_LOG="HUNT_TIME_LOG",t.TITLE_UPD="TITLE_UPD",t.M_VIP1="M_VIP1",t.MONSTER_DEAD="mst_dead",t.MM_CAT_UPD="mm_cat_upd",t.M_SHIPIN="M_SHIPIN",t.HALO_UPD="halo_upd",t.SHOP_LB="shop_lb",t.MCJ_TASK="mcj_task",t.QD_HDLIST="qd_hdlist",t.ZLB_UPD="zlb_upd",t.ADD_SCENERY="add_scenery",t.YCKJ_TRANCE="yckj_trance",t.JZT_GRID_UPD="jztgupd",t.JZT_RANDOM="jztrand",t.JZT_ALIVE="jztalive",t.BATTLE_FAILE_C="bfc",t
}();__reflect(EventType.prototype,"EventType");var ActionAlertBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return this._instace||(this._instace=new e),this._instace},e.prototype.setType=function(t){this._type=t},e.prototype.updateBox=function(e){t.prototype.updateBox.call(this,e,"Confirm",this.onOk,this,null)},e.prototype.onOk=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_TOAST_AW),this.okBtn.enabled=!1,1==this._type&&"undefined"!=typeof restartGame&&setTimeout(function(){restartGame()},1e3)},e}(AlertBox);__reflect(ActionAlertBox.prototype,"ActionAlertBox");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?s(o):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var AlertBox2=function(t){function e(){return t.call(this,"AlertBoxSkin2")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.addEvts=function(){t.prototype.addEvts.call(this),this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){t.prototype.rmEvts.call(this),this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onClose=function(){MsgBox.alert2Release(this)},e}(AlertBox);__reflect(AlertBox2.prototype,"AlertBox2");var GmGlobal=function(){function t(){}return t.init=function(){t.VERSION=window.VERSION||1,t.HTTP=window.HTTP||"https:",t.VF_VERSION=window.VF_VERSION||"1",t.IS_DEBUG=window.IS_DEBUG||!1,t.RESCFG_V=Number(window.RESCFG_V||0),void 0!=window.SCALE_SCENE&&(t.SCALE_SCENE=window.SCALE_SCENE)},t.setServerTime=function(e){t._serverTime=e||Math.ceil((new Date).getTime()/1e3),t._differTime=Math.ceil((new Date).getTime()-1e3*t._serverTime),t.cc.dataCtl.ajaxReq("/time/zoneoffset",this.onUtcOffset,this)},t.onUtcOffset=function(e){t.serverUtcOffset=e.data},t.getServerLocalTime=function(){var e=t.getServerTime(),i=new Date;i.setTime(1e3*e);var s=60*i.getTimezoneOffset(),o=e+s+t.serverUtcOffset;return o},t.getServerTime=function(){return Math.ceil(((new Date).getTime()-t._differTime)/1e3)},t.getServerMSTime=function(){return Math.ceil((new Date).getTime()-t._differTime)},t.RESCFG_V=0,t.GAME_HIDDEN=!1,t.IS_DEBUG=!1,t.isResInit=!1,t.isDataInit=!1,t.isNewPlayer=!1,t.gameState=0,t.isGameReport=!0,t.SCALE_SCENE=!1,t.serverUtcOffset=28800,t}();__reflect(GmGlobal.prototype,"GmGlobal");var RuntimeType=function(){function t(){}return t.WEB="web",t.NATIVE="native",t}();__reflect(RuntimeType.prototype,"RuntimeType");var GmConst=function(){function t(){}return t.MODEL_DIR="resource/model/",t.TOUSHI_DIR="resource/toushi/",t.BAOWU_DIR="resource/bwicon/",t.EFFECT_DIR="resource/effect/",t.ITEM_DIR="resource/ui/item/",t.SKILL_DIR="resource/skillicon/",t.TASKICON_DIR="resource/ticon/",t.MAP_DIR="resource/map/",t.MODEL_ICON_DIR="resource/micon/",t.TITLE_ICON_DIR="resource/chenghicon/",t.GAME_WIDTH=720,t.GAME_HEIGHT=1560,t.IS_FULLSCENE=!1,t.TOP_SPACE=60,t.BOTTOM_SPACE=60,t.UI_FREE_Y=170,t.WORLD_CHAT_INTERVAL=3e3,t.GH_CHAT_INTERVAL=3e3,t.RANK_CACHE_TIME=36e5,t.ROLE_SPEED=240,t.EQP_COLOR=[1,8,9,10,4,6,7,2,3,5],t.EQP_NAME=["Weapon","Shield","Helmet","Armor","Shawl","Pants","Boots","Necklace","Ring(L)","Ring(R)"],t.SKILL_TYPE=["Passive Skill","Support Skill","Active Skill"],t.PET_TYPE=["Active","Passive"],t.EFFECT_POS=[[1,-1],[-1,0],[0,-1],[0,1],[1,0],[-1,-1],[-1,1],[1,1],[2,0],[-2,0],[2,-1],[-2,1],[2,1],[-2,-1]],t.DROP_ITEM_GRID=[[0,0],[-1,1],[1,-1],[0,1],[1,0],[-1,0],[0,-1],[0,1],[-1,-1],[2,0],[-2,0],[-2,1],[2,-1],[-2,-1],[2,-1]],t}();__reflect(GmConst.prototype,"GmConst");var Colors=function(){function t(){}return t.WHILE=16777215,t.GREEN=2476300,t.BLUE=2140138,t.PURPLE=16734954,t.ORANGE=15634731,t.GOLDEN=14569811,t.RED=16711680,t.UI_NUM_COLOR=6632740,t.QUNXIA=766202,t.HAOHAN=15614783,t}();__reflect(Colors.prototype,"Colors");var InputBox=function(t){function e(){var e=t.call(this,"InputBoxSkin")||this;return e._txt="",e}return __extends(e,t),e.prototype.updatePos=function(){this.x=Math.round((GmGlobal.stageWidth-this.width)/2),this.y=Math.round((GmGlobal.stageHeight-this.height)/2)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.cancelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.updateBox=function(t,e,i,s,o,n){this._txt=t,this._okBtnTxt=e,this._cancelBtnTxt=i,this._okCallBack=s,this._cancelCallBack=o,this._thisObj=n,this.updateInfo()},e.prototype.updateInfo=function(){var t=this.txt.chackFlowWordWrap(this._txt,this.txt.width);this.txt.textFlow=TextFormat.parser.parse(t),this.okBtn.label=this._okBtnTxt||MsgBox.OK,this.cancelBtn.label=this._cancelBtnTxt||MsgBox.CANCEL,this.inputTxt.text=""},e.prototype.onOk=function(t){this._okCallBack&&this._okCallBack.call(this._thisObj,this.inputTxt.text),this.close()},e.prototype.onCancel=function(t){this._cancelCallBack&&this._cancelCallBack.call(this._thisObj),this.close()},e.prototype.close=function(){this._okCallBack=null,this._cancelCallBack=null,this._thisObj=null,t.prototype.close.call(this)},e}(UIBase);__reflect(InputBox.prototype,"InputBox");var MsgBox=function(){function t(){}return t.alert=function(e,i,s,o){return void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),GmGlobal.isResInit?(t._alert||(t._alert=new AlertBox),t._alert.updateBox(e,o,i,s),t._alert.show(GmGlobal.vmc.uiLayer),t._alert):void 0},t.closeAlert=function(){t._alert&&t._alert.close()},t.confirm=function(e,i,s,o,n,r){void 0===n&&(n=null),void 0===r&&(r=null);for(var h=[],a=6;a<arguments.length;a++)h[a-6]=arguments[a];if(GmGlobal.isResInit){return t._confirm||(t._confirm=new ConfirmBox),(l=t._confirm).updateBox.apply(l,[e,n,r,i,s,o].concat(h)),t._confirm.show(GmGlobal.vmc.uiLayer),t._confirm;var l}},t.confirm2=function(e,i,s,o,n,r){void 0===n&&(n=null),void 0===r&&(r=null);for(var h=[],a=6;a<arguments.length;a++)h[a-6]=arguments[a];if(GmGlobal.isResInit){return t._confirm||(t._confirm=new ConfirmBox),(l=t._confirm).updateBox.apply(l,[e,n,r,i,s,o].concat(h)),t._confirm.show(GmGlobal.vmc.uiLayer2),t._confirm;var l}},t.closeConfirm=function(){t._confirm&&t._confirm.close()},t.input=function(e,i,s,o,n,r){void 0===n&&(n=null),void 0===r&&(r=null),GmGlobal.isResInit&&(t._inputBox||(t._inputBox=new InputBox),t._inputBox.show(GmGlobal.vmc.uiLayer,!0),t._inputBox.updateBox(e,n,r,i,s,o))},t.prompt=function(e,i){void 0===i&&(i=1500),GmGlobal.isResInit&&e&&(t._prompt||(t._prompt=new PromptBox),t._prompt.updateBox(e),t._prompt.showText(GmGlobal.vmc.noticeLayer,i))},t.alert2=function(t,e,i,s,o){void 0===o&&(o=null);var n=this._alert2Pool.pop();n||(n=new AlertBox2),n.updateBox(t,o,e,i,s),n.show(GmGlobal.vmc.uiLayer)},t.alert2Release=function(t){t&&(t.close(),-1==this._alert2Pool.indexOf(t)&&this._alert2Pool.push(t))},t.OK="Confirm",t.CANCEL="Cancel",t._alert2Pool=[],t}();__reflect(MsgBox.prototype,"MsgBox");var PromptBox=function(t){function e(){var e=t.call(this,"PromptBoxSkin")||this;return e._txt="",e._timeId=0,e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.txt.lineSpacing=6,this.updateInfo()},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.updatePos=function(){this.x=Math.round(GmGlobal.stageWidth/2),this.y=Math.round(GmGlobal.stageHeight/2)+80},e.prototype.showText=function(t,e){void 0===e&&(e=1500),this.show(t),this.clear(),this._timeId=egret.setTimeout(this.showHideEffect,this,e),this.scaleX=0,this.scaleY=0,egret.Tween.get(this).to({scaleX:1,scaleY:1},500,egret.Ease.backOut)},e.prototype.show=function(e){this.parent||t.prototype.show.call(this,e),this.isInit&&this.updateInfo()},e.prototype.showHideEffect=function(){this._timeId>0&&(egret.clearTimeout(this._timeId),this._timeId=0),egret.Tween.get(this).to({alpha:0},500).call(this.close,this)},e.prototype.clear=function(){this._timeId>0&&(egret.clearTimeout(this._timeId),this._timeId=0),egret.Tween.removeTweens(this),this.alpha=1},e.prototype.updateBox=function(t){this._txt=t,this.isShow&&this.updateInfo()},e.prototype.updateInfo=function(){this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(this._txt,this.txt.width)),this.height=this.txt.textHeight+22,this.bg.width=this.txt.textWidth+200,this.bg.x=Math.round((this.width-this.bg.width)/2)},e}(UIBase);__reflect(PromptBox.prototype,"PromptBox");var ServerConfirmBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.setData=function(t){this.show(GmGlobal.vmc.uiLayer),this.updateBox(t.msg,t.ok,t.cancel,null,null,null)},e.prototype.onOk=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_TOAST_AW,[1]),t.prototype.close.call(this)},e.prototype.onCancel=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_TOAST_AW,[0]),t.prototype.close.call(this)},e}(ConfirmBox);__reflect(ServerConfirmBox.prototype,"ServerConfirmBox");var MsgID=function(){function t(){}return t.RET_CODE=1,t.UPD_OFFLINE=10,t.UPD_JDATA=11,t.UPD_ROLE_LIST=12,t.UPD_ROLE_DATAS=13,t.UPD_RINFO=101,t.UPD_ITEM=102,t.UPD_MLIST=259,t.UPD_LVFUBEN_INFO=260,t.UPD_M_INFO=701,t.UPD_M_COUNT=702,t.UPD_RANK_DATA=711,t.UPD_MY_RANK_DATA=712,t.UPD_ROLE_RANKS=713,t.UPD_CHAT_MSG=721,t.UPD_CHATCODE=722,t.DEL_CHATMSG=723,t.REQ_LOGIN_GAME=1001,t.REQ_CREATE_ROLE=1002,t.REQ_GET_AWARD=1010,t.RET_GET_AWARD=2010,t.REQ_DO_ACTION=1011,t.RET_DO_ACTION=2011,t.REQ_ROLE_INFO=1012,t.RET_ROLE_INFO=2012,t.REQ_RNAME=1021,t.GET_SHARE=1015,t.SET_SHARE=1016,t.KR=1014,t.REPORT_GAMEDATA=1017,t.REQ_CHAIN=1024,t.RET_CHAIN=2024,t.SET_CHAIN=1025,t.REQ_GETCDK=5033,t.RET_GETCDK=6033,t.REQ_RANK_DATA=5022,t.RET_RANK_DATA=6022,t.REQ_S_LIST=5042,t.RET_S_LIST=6042,t.REQ_CHECK_LOGIN=5041,t.RET_CHECK_LOGIN=6041,t.REQ_SERVER_INFO=5043,t.RET_SERVER_INFO=6043,t.REQ_RAND_NAME=5032,t.RET_RAND_NAME=6032,t.REQ_CHAT_SEND=5061,t.REQ_CHAT_LOG=5062,t.RET_CHAT_LOG=6062,t.REQ_PCHAT_SEND=5063,t.RET_PCHAT_SEND=6063,t.REQ_PCHAT_LOG=5064,t.RET_PCHAT_LOG=6064,t.REQ_PCHAT_TIME=5065,t.RET_PCHAT_TIME=6065,t.REQ_GET_RANK_DATA=5021,t.REQ_RANKING_DATA=5023,t.RET_RANKING_DATA=6023,t.REQ_BUY_ITEM=5031,t.REQ_HERO_GEM_ONOFF=1305,t.REQ_HERO_CARD_ONOFF=1306,t.REQ_PG_MAIL_LIST=5001,t.RET_PG_MAIL_LIST=6001,t.REQ_READ_MAIL=5002,t.RET_READ_MAIL=6002,t.REQ_RECV_MAIL_AFFIX=5003,t.REQ_MDEL_MAIL=5005,t.REQ_MRECV_MAIL_AFFIX=5006,t.REQ_HEARTBEAT=5e3,t.REQ_HEADURL=1023,t.REQ_UID_BY_ACCOUNT=5034,t.REQ_JDATA=1013,t.REQ_ROLEID=5035,t.RET_ROLEID=6035,t.REQ_RANK_MAXNUM=5024,t.RET_RANK_MAXNUM=6024,t.AJAX_REQUEST=1999,t.AJAX_RETURN=2999,t.PB_REQUEST=1009,t.PB_REQUEST_RET=2009,t.PB_DATA=9,t.UNIT_WALK=730,t.UNIT_STAND=731,t.UNIT_ENTER=732,t.UNIT_LEAVE=733,t.UNIT_DEAD=734,t.UNIT_ATTACK=735,t.UNIT_SKILL=736,t.UNIT_EFFECT=737,t.ENTER_SCENE=738,t.BATTLE_SB=739,t.BATTLE_S_HURT=740,t.BATTLE_N_HURT=741,t.BATTLE_FT_HURT=742,t.UNIT_SPEED=743,t}();__reflect(MsgID.prototype,"MsgID");var MsgStruct=function(){function t(){}return t.initMsg=function(){this._isInit||(this._isInit=!0,this._msgs[6002]=msg.PbMsgRetReadMail,this._msgs[6001]=msg.PbMsgRetGetRoleMailInfoList,this._msgs[2015]=msg.PbMsgRetShareById,this._msgs[2011]=msg.PbMsgRetDoActionById,this._msgs[2010]=msg.PbMsgRetGetAwardById,this._msgs[2013]=msg.PbMsgRetJsonById,this._msgs[2012]=msg.PbMsgRetAiInfo,this._msgs[5065]=msg.PbMsgChatSingleTime,this._msgs[11]=msg.PbMsgUpdateJson,this._msgs[5061]=msg.PbMsgChatSend,this._msgs[5063]=msg.PbMsgChatSingle,this._msgs[5062]=msg.PbMsgChatLog,this._msgs[713]=msg.PbMsgUpdateRoleMRankingLevel,this._msgs[712]=msg.PbMsgUpdateRoleRankingLevel,this._msgs[711]=msg.PbMsgUpdateRankingData,this._msgs[2999]=msg.PbMsgRetAjax,this._msgs[701]=msg.PbMsgMailInfo,this._msgs[702]=msg.PbMsgUpdateMailCountToClient,this._msgs[6064]=msg.PbMsgRetChatSingleLog,this._msgs[6065]=msg.PbMsgRetChatSingleTime,this._msgs[6062]=msg.PbMsgRetChatLog,this._msgs[6063]=msg.PbMsgRetChatSingle,this._msgs[1014]=msg.PbMsgKillRole,this._msgs[1015]=msg.PbMsgGetShareById,this._msgs[1016]=msg.PbMsgSetShareById,this._msgs[1017]=msg.PbMsgReportData,this._msgs[1010]=msg.PbMsgGetAwardById,this._msgs[1011]=msg.PbMsgDoActionById,this._msgs[1012]=msg.PbMsgGetAiInfo,this._msgs[1013]=msg.PbMsgGetJsonById,this._msgs[5003]=msg.PbMsgRecvMailAppendix,this._msgs[5002]=msg.PbMsgReadMail,this._msgs[5001]=msg.PbMsgGetRoleMailInfoList,this._msgs[5e3]=msg.PbMsgHeartBeat,this._msgs[5006]=msg.PbMsgMultiRecvMailAppendix,this._msgs[5005]=msg.PbMsgMultiDelMail,this._msgs[5004]=msg.PbMsgDelMail,this._msgs[3961]=msg.PbMsgAdminCommand,this._msgs[102]=msg.PbMsgItemInfo,this._msgs[101]=msg.PbMsgRoleInfo,this._msgs[1009]=msg.PbMsgRequest,this._msgs[1002]=msg.PbMsgCreateRole,this._msgs[1001]=msg.PbMsgEnterGame,this._msgs[5034]=msg.PbMsgGetRoleIdsByUserIds,this._msgs[5035]=msg.PbMsgGetRoleIdsByName,this._msgs[5031]=msg.PbMsgBuyItem,this._msgs[731]=msg.PbMsgSceneStand,this._msgs[6043]=msg.PbMsgLoginRetServerList,this._msgs[6042]=msg.PbMsgLoginRetServerInfo,this._msgs[730]=msg.PbMsgSceneWalk,this._msgs[733]=msg.PbMsgSceneLeave,this._msgs[732]=msg.PbMsgSceneEnter,this._msgs[735]=msg.PbMsgSceneAtkNormal,this._msgs[734]=msg.PbMsgSceneDie,this._msgs[737]=msg.PbMsgSceneEffect,this._msgs[736]=msg.PbMsgSceneAtkSkill,this._msgs[739]=msg.PbMsgSceneBattleSB,this._msgs[738]=msg.PbMsgSceneRoleInfo,this._msgs[5021]=msg.PbMsgGetRankingData,this._msgs[5023]=msg.PbMsgGetRankingDataByRankList,this._msgs[5022]=msg.PbMsgGetRankingDataByRoleList,this._msgs[5024]=msg.PbMsgGetRankingMaxNum,this._msgs[1025]=msg.PbMsgSetChain,this._msgs[1024]=msg.PbMsgGetChain,this._msgs[13]=msg.PbMsgUpdateJsonList,this._msgs[12]=msg.PbMsgUpdateRoleList,this._msgs[1021]=msg.PbMsgSetName,this._msgs[1999]=msg.PbMsgAjax,this._msgs[2024]=msg.PbMsgRetChain,this._msgs[722]=msg.PbMsgUpdateChatRetcode,this._msgs[723]=msg.PbMsgCleanChatLog,this._msgs[721]=msg.PbMsgUpdateChatMessage,this._msgs[740]=msg.PbMsgSceneBattleDamageSkill,this._msgs[741]=msg.PbMsgSceneBattleDamageNormal,this._msgs[742]=msg.PbMsgSceneBattleDamageFantan,this._msgs[743]=msg.PbMsgSceneSetWalkSpeed,this._msgs[5064]=msg.PbMsgChatSingleLog,this._msgs[6041]=msg.PbMsgLoginRetCheck,this._msgs[1]=msg.PbMsgRetCode,this._msgs[9]=msg.PbMsgNotify,this._msgs[6022]=msg.PbMsgRetRankingDataByRoleList,this._msgs[6023]=msg.PbMsgRetRankingDataByRankList,this._msgs[6024]=msg.PbMsgRetRankingMaxNum,this._msgs[10]=msg.PbMsgUpdateOffline,this._msgs[5043]=msg.PbMsgLoginGetServerList,this._msgs[5042]=msg.PbMsgLoginGetServerInfo,this._msgs[5041]=msg.PbMsgLoginCheck,this._msgs[2009]=msg.PbMsgRetRequest,this._msgs[6035]=msg.PbMsgRetRoleIdsByName,this._msgs[6034]=msg.PbMsgRetRoleIdsByUserIds)},t.getMsg=function(t){var e=this._msgs[t];return null==e?null:new e},t.getMsgClass=function(t){var e=this._msgs[t];return null==e?null:e},t._msgs={},t._isInit=!1,t}();__reflect(MsgStruct.prototype,"MsgStruct");var Server=function(){function t(t){this._sNo=0,this.sName=t,this._updateCbs={},this._serialCbs={},this._recvByteArray=new egret.ByteArray,this._recvByteArray.endian=egret.Endian.LITTLE_ENDIAN,this._sendByteArray=new egret.ByteArray,this._sendByteArray.endian=egret.Endian.LITTLE_ENDIAN,this._sendYihuoArray=new egret.ByteArray}return t.prototype.regUpdCb=function(t,e,i){this._updateCbs[t]=new CallBack(e,i)},t.prototype.isConnected=function(){return this._socket?this._socket.connected:!1},t.prototype.close=function(){this._updateCbs=null,this._serialCbs=null,this._socket&&(this._socket.close(),this._socket=null)},t.prototype.connect=function(t,e,i,s){this.initSerialNoInfo(),this._host=t,this._port=e,this._connectCb=i,this._cbTarget=s,this._socket||(this._socket=new egret.WebSocket),this._socket.type=egret.WebSocket.TYPE_BINARY,this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRcvMsg,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketConnect,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketIOError,this);var o,n,o=GmGlobal.HTTP||window.location.protocol;if("http:"==o)var n="ws://"+t;else n="wss://"+t;console.log("connect:"+n),this._socket.connectByUrl(n)},t.prototype.initSerialNoInfo=function(){this._sNo=0,this._serialRandomNumer=[];for(var t=0;20>t;t++)this._serialRandomNumer.push(Math.floor(255*Math.random()))},t.prototype.onSocketConnect=function(){console.log("socketConnect host:"+this._host),this._connectCb.call(this._cbTarget)},t.prototype.onRcvMsg=function(){if(this._updateCbs&&this._serialCbs){var t=this._recvByteArray;t.clear(),this._socket.readBytes(t);var e=t.readShort(),i=t.readInt(),s=MsgStruct.getMsgClass(e);if(s){var o=new egret.ByteArray;t.readBytes(o);var n=s.decode(o.bytes);if(0==i){var r=this._updateCbs[e];r&&r.cb.call(r.target,n)}else{var h=this._serialCbs[i];h&&(delete this._serialCbs[i],h(n,i),h=null)}}}},t.prototype.onSocketClose=function(){console.log("SocketClose host:"+this._host),this._serialCbs={},this._socket=null,"gameServer"==this.sName&&EventBus.dispatchEvt(EventType.S_CLOSE)},t.prototype.onSocketIOError=function(){console.log("SocketIOError host:"+this._host),this._socket&&this._socket.close(),EventBus.dispatchEvt(EventType.S_ERROR)},t.prototype.sendMsg=function(t,e,i){if(void 0===i&&(i=null),this._socket&&this._socket.connected){this._sNo++,i&&(this._serialCbs[this._sNo]=i);var s=this._recvByteArray;s.clear(),s.writeShort(t),s.writeInt(this._sNo);var o=MsgStruct.getMsgClass(t),n=new egret.ByteArray(o.encode(e).finish());s.writeBytes(n),this._sendYihuoArray.clear();var r=this._serialRandomNumer[this._sNo%20];this._sendYihuoArray.writeByte(r),s.position=0;for(var h=0;h<s.length;h++)this._sendYihuoArray.writeByte(s.readUnsignedByte()^r);return this._socket.writeBytes(this._sendYihuoArray,0,this._sendYihuoArray.bytesAvailable),this._socket.flush(),s=null,n=null,e=null,this._sNo}},t.prototype.clearSerialCallbak=function(t){delete this._serialCbs[t]},t.prototype.hasSerialCallback=function(t){return this._serialCbs[t]},t}();__reflect(Server.prototype,"Server");var ProgressInfo=function(){function t(){this.current=0,this.total=1}return t}();__reflect(ProgressInfo.prototype,"ProgressInfo");var SequenceOperation=function(){function t(){this._finished=[],this._noFinish=[],this._progressInfo=new ProgressInfo,this._isStop=!1}return t.prototype.execute=function(t,e,i,s){void 0===i&&(i=null),this._isStop||(this._onProgress=t,this._onComplete=e,this._onError=i,this._thisObj=s,this.executeNext())},t.prototype.stop=function(){this._noFinish.length>0&&this._noFinish[0].stop(),this._isStop=!0},t.prototype.addOperation=function(t){this._noFinish.push(t)},t.prototype.executeNext=function(){if(!this._isStop)if(this._progressInfo.current=this._finished.length,this._progressInfo.total=this._finished.length+this._noFinish.length,this._progressInfo.childProgress=null,null!=this._onProgress&&this._onProgress.call(this._thisObj,this._progressInfo),this._noFinish.length>0)this._currentOperation=this._noFinish[0],this._currentOperation.execute(this.childOperationProgress,this.childOperationComplete,this.onChildError,this);else{this._isStop=!0,this._currentOperation=null;var t=this;setTimeout(function(){null!=t._onComplete&&t._onComplete.call(t._thisObj,t)},100)}},t.prototype.childOperationComplete=function(t){-1==this._finished.indexOf(t)&&(this._finished.push(this._noFinish.shift()),this.executeNext())},t.prototype.childOperationProgress=function(t){this._progressInfo.childProgress=t,null!=this._onProgress&&this._onProgress.call(this._thisObj,this._progressInfo)},t.prototype.onChildError=function(t,e){this._finished.push(this._noFinish.shift()),this.executeNext()},Object.defineProperty(t.prototype,"isStop",{get:function(){return this._isStop},set:function(t){this._isStop=t},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._finished=[],this._noFinish=[],this._onProgress=null,this._onComplete=null,this._onError=null,this._thisObj=null},t.prototype.isEmpty=function(){return 0==this._noFinish.length&&0==this._finished.length?!0:!1},Object.defineProperty(t.prototype,"currentOperation",{get:function(){return this._currentOperation},enumerable:!0,configurable:!0}),t}();__reflect(SequenceOperation.prototype,"SequenceOperation",["IOperation"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stage.stageHeight<=1280&&(this.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT);new Game(this).run()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var GameVersionController=function(){function t(){}return t.prototype.init=function(){return new Promise(function(t,e){console.log("RES Init"),t()})},t.prototype.getVirtualUrl=function(t){if(GmGlobal.res.isLocalFile(t))return t;var e=GmGlobal.res.getVersion(t);return e>1?PFConst.RES_ROOT+t+"."+e:PFConst.RES_ROOT+t},t}();__reflect(GameVersionController.prototype,"GameVersionController",["RES.IVersionController"]);var MCBitmap=function(t){function e(){var e=t.call(this)||this;return e._interval=0,e._index=0,e}return __extends(e,t),e.create=function(t,i){void 0===i&&(i=!1);var s=ObjectPool.pop("mcbitmap");return s||(s=new e),s.resId=t,s.useSceneTick=i,s},e.release=function(t){t.parent&&t.parent.removeChild(t),ObjectPool.push(t,"mcbitmap")},e.prototype.play=function(t,e,i,s,o){void 0===t&&(t=null),void 0===e&&(e=125),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),t&&(this._frameList=t),this._frameList&&(this._interval=e/1e3,this._cb=i,this._onFrame=o,this._thisObj=s,this._index=0,this.updateFrame(),(this._frameList.length>1||1==this._frameList.length&&i)&&(this._isStop=!1,this._t=0,this._preTime=egret.getTimer(),egret.startTick(this.onTick,this)))},e.prototype.stop=function(){this._isStop=!0,egret.stopTick(this.onTick,this)},e.prototype.onTick=function(t){var e=(t-this._preTime)/1e3;return this._preTime=t,e>.1?!0:(this.onTime(e),!0)},e.prototype.onTime=function(t){this._isStop||(this._t+=t,this._t<this._interval||(this._t=this._t-this._interval,this._index++,this.updateFrame(),0==this._index&&this._cb&&this._thisObj&&this._cb.call(this._thisObj,this)))},e.prototype.updateFrame=function(){this._index>=this._frameList.length&&(this._index=0),this.texture=RES.getRes(this._frameList[this._index]),this._onFrame&&this._onFrame.call(this._thisObj,this._index)},e.prototype.reuse=function(){this.anchorOffsetX=0,this.anchorOffsetY=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.rotation=0,this.x=this.y=0},e.prototype.unuse=function(){this.stop(),this._cb=null,this._onFrame=null,this._thisObj=null,this._index=0,this._frameList=null},e.prototype.clear=function(){this.unuse()},e}(egret.Bitmap);__reflect(MCBitmap.prototype,"MCBitmap",["IObject"]);var McDataFactory=function(){function t(t,e,i){this._mcDataFactory=t,this.resId=e,this.dir=i,this.ref=0}return Object.defineProperty(t.prototype,"mcDataFactory",{get:function(){return this.ref++,this._mcDataFactory},enumerable:!0,configurable:!0}),t.prototype.release=function(){this.ref--,this.ref<0&&(this.ref=0)},t.prototype.destroy=function(){RES.destroyRes(this.dir+this.resId+".json"),RES.destroyRes(this.dir+this.resId+".png"),this._mcDataFactory=null,this.resId=null,this.dir=null},t}();__reflect(McDataFactory.prototype,"McDataFactory");var MovieClipDataLoader=function(){function t(t,e,i,s){this.resId=t,this.dir=e,this.loadedCb=i,this.loadedObj=s,this.cbs=[],RES.getResByUrl(e+t+".json",this.onJsonLoaded,this,RES.ResourceItem.TYPE_JSON),RES.getResByUrl(e+t+".png",this.onPngLoaded,this,RES.ResourceItem.TYPE_IMAGE)}return t.prototype.bingCb=function(t,e){-1==this.indexOf(t,e)&&(this.cbs?this.cbs.push({cb:t,obj:e}):this.cbs=[{cb:t,obj:e}])},t.prototype.unbindCb=function(t,e){var i=this.indexOf(t,e);-1!=i&&this.cbs.splice(i,1)},t.prototype.cbLength=function(){return this.cbs?this.cbs.length:0},t.prototype.indexOf=function(t,e){if(!this.cbs)return-1;for(var i=0;i<this.cbs.length;i++){var s=this.cbs[i];if(s.cb==t&&s.obj==e)return i}return-1},t.prototype.doCb=function(t){if(this.cbs)for(var e=0;e<this.cbs.length;e++){var i=this.cbs[e];i.cb.call(i.obj,t.mcDataFactory,this.resId)}},t.prototype.onPngLoaded=function(t){this.txtr=t,this.checkComplete()},t.prototype.onJsonLoaded=function(t){this.data=t,this.checkComplete()},t.prototype.checkComplete=function(){this.txtr&&this.data&&this.loadedCb&&this.loadedCb.call(this.loadedObj,this)},t.prototype.clear=function(){this.cbs=null,this.resId=null,this.dir=null,this.loadedCb=null,this.loadedObj=null},t}();__reflect(MovieClipDataLoader.prototype,"MovieClipDataLoader");var PFConst=function(){function t(){}return t.init=function(){t.RUNTIME=window.RUNTIME||"web",t.CONTACTUS=window.CONTACTUS||"",t.COPYRIGHTINFO=window.COPYRIGHTINFO||null,t.RES_ROOT=window.RES_ROOT||"",t.CHECK_MSG=window.CHECK_MSG||!1,t.IS_WX_GAME=window.IS_WX_GAME||!1,t.LUPING=window.LUPING||!1,t.SHOW_INIT=window.SHOW_INIT||!1,t.LOGO_IMG=window.LOGO_IMG||"loading_bg",t.L_LOGO_IMG=window.L_LOGO_IMG||"",t.IS_NOPAY=window.IS_NOPAY||!1,t.HAS_AD=window.HAS_AD||!1,t.SERVER_TYPE=window.SERVER_TYPE||1,t.PF_KEFU=window.PF_KEFU||!1,t.PF_RP_INIT=window.PF_RP_INIT||!1,t.SHOW_JQ=window.SHOW_JQ||!1,t.SHOW_AGREEMENT=window.SHOW_AGREEMENT||!1,t.SHOW_USERAGR=window.SHOW_USERAGR||!1,t.FORCE_SHOW_UA=window.FORCE_SHOW_UA||!1,t.IS_360WD=window.IS_360WD||!1,t.PF_NAME=window.PF_NAME||"",t.RESTART=window.RESTART||!1,t.S_ACCOUNT=window.S_ACCOUNT||!1,t.IS_IOS_AUDIT=window.IS_IOS_AUDIT||!1,t.HAS_CDK=window.HAS_CDK||!0,t.CID=window.GAME_CID||"",void 0!=window.AGREEMENT_YS_FILE&&(t.AGREEMENT_YS_FILE=window.AGREEMENT_YS_FILE),void 0!=window.AGREEMENT_YH_FILE&&(t.AGREEMENT_YH_FILE=window.AGREEMENT_YH_FILE),void 0!=window.AGE_FILE&&(t.AGE_FILE=window.AGE_FILE),void 0!=window.AGE_FILE&&(t.AGE_FILE=window.AGE_FILE),void 0!=window.AGE_ICON&&(t.AGE_ICON=window.AGE_ICON),void 0!=window.HTTP_HOST&&(t.HTTP_HOST=window.HTTP_HOST),void 0!=window.SHOW_LOGIN_WAITING&&(t.SHOW_LOGIN_WAITING=window.SHOW_LOGIN_WAITING),void 0!=window.HAS_HELP&&(t.HAS_HELP=window.HAS_HELP),"iOS"==egret.Capabilities.os?(t.SHARE_MODULE=window.IOS_SHARE_MODULE||!1,t.CFG_FILE=window.IOS_CFG_FILE||"cfg.zz",t.LOGFILE=window.IOS_LOGFILE||"log_ios.json"):(t.SHARE_MODULE=window.SHARE_MODULE||!1,t.CFG_FILE=window.CFG_FILE||"cfg.zz",t.LOGFILE=window.LOGFILE||"log.json")},t.IS_WX_GAME=!1,t.LUPING=!1,t.SHOW_INIT=!1,t.SERVER_TYPE=1,t.PF_KEFU=!1,t.RESTART=!1,t.S_ACCOUNT=!1,t.PF_RP_INIT=!1,t.SHOW_JQ=!1,t.SHOW_AGREEMENT=!1,t.SHOW_USERAGR=!1,t.FORCE_SHOW_UA=!1,t.IS_360WD=!1,t.PF_NAME="",t.IS_IOS_AUDIT=!1,t.HAS_CDK=!0,t.SHOW_LOGIN_WAITING=!0,t.HAS_HELP=!1,t.CID="",t}();__reflect(PFConst.prototype,"PFConst");var ResManager=function(){function t(){this._versions=Object,this._mcDataFts={},this._mcDataLds={},this._mapRefer={},this._urlRefer={}}return t.prototype.initVersionConfig=function(t){this._versions=t||[]},t.prototype.initLocalConfig=function(t){t&&(this._localRes=t)},t.prototype.getVersion=function(t){var e=this._versions[t];return e||0},t.prototype.isLocalFile=function(t){return this._localRes&&-1==this._localRes.indexOf(t)?-1!=t.indexOf("http")?!0:!1:!0},t.prototype.getUrl=function(t){return this._localRes&&this._localRes.indexOf(t)?t:PFConst.RES_ROOT+t},t.prototype.getMovieClipData=function(t,e,i,s){var o=this._mcDataFts[e];if(o)i.call(s,o.mcDataFactory,e);else{var n=this._mcDataLds[e];n||(n=new MovieClipDataLoader(e,t,this.movieClipDataLoaded,this),this._mcDataLds[e]=n),n.bingCb(i,s)}},t.prototype.getMoveiClipDataSync=function(t,e){var i=this._mcDataFts[e];return i?i.mcDataFactory:null},t.prototype.retainMCData=function(t){var e=this._mcDataFts[t];e&&(e.ref=1e5)},t.prototype.releaseMCData=function(t,e,i,s){void 0===e&&(e=!0);var o=this._mcDataFts[t];return o?(o.release(),void(e&&0==o.ref&&(o.destroy(),delete this._mcDataFts[t]))):void this.stopMovieClipLoad(t,i,s)},t.prototype.destroyUnuseMCData=function(){for(var t in this._mcDataFts){var e=this._mcDataFts[t];e&&0==e.ref&&(e.destroy(),delete this._mcDataFts[t])}},t.prototype.getUnuseMcDataNum=function(){var t=0;for(var e in this._mcDataFts){var i=this._mcDataFts[e];i&&0==i.ref&&t++}return t},t.prototype.stopMovieClipLoad=function(t,e,i){var s=this._mcDataLds[t];s&&(s.unbindCb(e,i),0==s.cbLength()&&(s.clear(),delete this._mcDataLds[t],s=null))},t.prototype.movieClipDataLoaded=function(t){var e=this._mcDataFts[t.resId];if(!e){var i=new egret.MovieClipDataFactory(t.data,t.txtr);e=new McDataFactory(i,t.resId,t.dir),this._mcDataFts[e.resId]=e}t.doCb(e),delete this._mcDataLds[t.resId],t.clear(),t=null},t}();__reflect(ResManager.prototype,"ResManager");var HorizontalText=function(t){function e(){var e=t.call(this)||this;return e._width=640,e._height=0,e._y=140,e._speed=5,e._color=2383770,e._size=26,e._isInit=!1,e._timeId=0,e.MARGIN=8,e.ROUND_ANGLE=2,e.MAX_TEMP_NUM=5,e._textFields=[],e._texts=[],e._freeTextFields=[],e._height=e._size+2*e.MARGIN,e}return __extends(e,t),e.prototype.init=function(){this.touchEnabled=!1,this.touchChildren=!1,this._bg=new egret.Bitmap(RES.getRes("com_json.bg_htxt")),this._bg.fillMode=egret.BitmapFillMode.SCALE,this._bg.scale9Grid=new egret.Rectangle(134,3,1,3),this._bg.width=this._width+80,this._bg.height=this._height,this._bg.x=-40,this.addChildAt(this._bg,0),this.x=Math.round(.5*(GmGlobal.stageWidth-this._width)),GmConst.IS_FULLSCENE?this.y=this._y+GmConst.TOP_SPACE:this.y=this._y,this._textCon=new egret.DisplayObjectContainer,this.addChild(this._textCon),this._viewRect=new egret.Rectangle(this.ROUND_ANGLE,this.MARGIN,this._width-2*this.ROUND_ANGLE,this._height),this._textCon.scrollRect=this._viewRect,this._isInit=!0},e.prototype.addText=function(t,e){this.parent||(e.addChild(this),0==this._timeId&&(this._timeId=egret.setInterval(this.onFrame,this,33))),this._isInit||this.init(),this._lastTextField?this._lastTextField.x+this._lastTextField.textWidth<this._viewRect.right-50?this.addTextField(t):(this._texts.push(t),this._texts.length>this.MAX_TEMP_NUM&&this._texts.shift()):this.addTextField(t)},e.prototype.onFrame=function(t){for(var e=this,i=e._textFields.length,s=i-1;s>=0;s--){var o=e._textFields[s];o.x=o.x-e._speed,o.x+o.width<e._viewRect.left&&(e._freeTextFields.push(o),e._textFields.shift(),e._textCon.removeChild(o))}e._texts.length>0&&e._lastTextField&&e._lastTextField.x+e._lastTextField.textWidth<e._viewRect.right-50&&e.addTextField(e._texts.shift()),0==e._textFields.length&&(e._lastTextField=null,0!=this._timeId&&(egret.clearInterval(this._timeId),this._timeId=0),e.parent.removeChild(e))},e.prototype.addTextField=function(t){var e=new egret.TextField;e.size=this._size,e.textColor=this._color,e.textFlow=TextFormat.parser.parse(t),e.x=this._width,e.y=Math.ceil((this._height-e.textHeight)/2)+10,this._textFields.push(e),this._lastTextField=e,this._textCon.addChild(e)},e.prototype.clearText=function(){this._texts=[]},e}(egret.DisplayObjectContainer);__reflect(HorizontalText.prototype,"HorizontalText");var Horselamp=function(){function t(){}return t.init=function(e){t.layer=e,t.horizontalText=new HorizontalText,t.verticalText=new VerticalText(t.layer)},t.showHText=function(e){t.horizontalText.addText(e,t.layer)},t.clearHText=function(){t.horizontalText.clearText()},t.showVText=function(e,i){t.verticalText.addText(e,i)},t.pauseVText=function(){t.verticalText.pause()},t.resumeVText=function(){t.verticalText.resume()},t}();__reflect(Horselamp.prototype,"Horselamp");
var VerticalText=function(){function t(t){this._y=500,this._timer=0,this._isPause=!1,this._layer=t,this._texts=[],this._textFields=[],this._showTxts=[]}return t.prototype.pause=function(){this._isPause=!0,0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0)},t.prototype.resume=function(){this._isPause=!1,this._texts.length>0&&(this._timer=egret.setInterval(this.onTime,this,100))},t.prototype.addText=function(t,e){return this._isPause?void this._texts.push({txt:t,icon:e}):void(0!=this._timer?this._texts.push({txt:t,icon:e}):(this.showText(t,e),this._timer=egret.setInterval(this.onTime,this,100),egret.startTick(this.onTick,this)))},t.prototype.onTime=function(){if(!(this._showTxts.length>15)){var t=this._texts.shift();t&&this.showText(t.txt,t.icon),0==this._texts.length&&(egret.clearInterval(this._timer),this._timer=0)}},t.prototype.showText=function(t,e){var i=this._textFields.pop();i||(i=new VerticalTextElement(this.onMoveComplete,this)),i.x=this._layer.stage.stageWidth/2,i.y=this._layer.stage.stageHeight-300,this._layer.addChild(i),i.setText(t,e),this._showTxts.push(i)},t.prototype.onTick=function(t){var e=this._showTxts.length;if(!(2>e)){for(var i=this._showTxts[e-1],s=e-2;s>=0;s--){var o=this._showTxts[s],n=i.getY(),r=o.getY();42>n-r&&o.setY(n-42),i=o}return!0}},t.prototype.onMoveComplete=function(t){var e=this._showTxts.indexOf(t);-1!=e&&(this._showTxts.splice(e,1),0==this._showTxts.length&&egret.stopTick(this.onTick,this)),t.parent&&(this._layer.removeChild(t),this._textFields.push(t))},t}();__reflect(VerticalText.prototype,"VerticalText");var VerticalTextElement=function(t){function e(e,i){var s=t.call(this)||this;s._size=26,s._color=803449,s.BG_HMARGIN=20,s.BG_VMARGIN=8,s.SPACE=6,s._cb=e,s._cbThis=i;var o=RES.getRes("com_json.bg_vtxt");return s._bg=new egret.Bitmap(o),s._bg.fillMode=egret.BitmapFillMode.SCALE,s._bg.scale9Grid=new egret.Rectangle(12,12,2,2),s._text=new egret.TextField,s._text.size=s._size,s._text.textColor=s._color,s._text.verticalAlign=egret.VerticalAlign.MIDDLE,s._con=new egret.DisplayObjectContainer,s.addChild(s._con),s._con.addChild(s._bg),s._con.addChild(s._text),s.touchEnabled=!1,s.touchChildren=!1,s}return __extends(e,t),e.prototype.getY=function(){return this.y+this._con.y},e.prototype.setY=function(t){this.y=t-this._con.y},e.prototype.setText=function(t,e){void 0===e&&(e=null),this._text.textFlow=TextFormat.parser.parse(t),this._con.y=0,e?(this._icon=e,this._img||(this._img=new eui.Image,this._img.width=this._size,this._img.height=this._size),this._img.parent||this._con.addChild(this._img),this._img.source=e,this._bg.width=this._size+this.SPACE+this._text.textWidth+2*this.BG_HMARGIN,this._img.x=this.BG_HMARGIN,this._img.y=this.BG_VMARGIN,this._text.x=this.BG_HMARGIN+this._size+this.SPACE):(this._img&&this._img.parent&&this._con.removeChild(this._img),this._bg.width=this._text.textWidth+2*this.BG_HMARGIN,this._text.x=this.BG_HMARGIN),this._bg.height=this._text.textHeight+2*this.BG_VMARGIN,this._text.y=(this._bg.height-this._text.textHeight)/2,this._con.anchorOffsetX=this._bg.width/2,this._con.anchorOffsetY=this._bg.height/2,this._con.scaleX=0,this._con.scaleY=0,this._con.alpha=1,egret.Tween.get(this._con).to({y:-200,scaleX:1,scaleY:1},800,egret.Ease.quadOut).call(this.showComplete,this)},e.prototype.showComplete=function(){egret.Tween.get(this._con).to({y:this._con.y-200,alpha:0},800,egret.Ease.quadIn).call(this.onMoveEnd,this)},e.prototype.onMoveEnd=function(){egret.Tween.removeTweens(this),this._cb.call(this._cbThis,this)},e}(egret.DisplayObjectContainer);__reflect(VerticalTextElement.prototype,"VerticalTextElement");var AwardGetTipView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.showAward=function(t,i,s,o,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),void 0===n&&(n="Item Obtained"),egret.getTimer()-e._closeTimne<200?setTimeout(function(){AwardTipView.showAward(t,i,s,o,e,n)},200):AwardTipView.showAward(t,i,s,o,e,n)},e.getAward=function(){e._closeTimne=egret.getTimer(),GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_TOAST_AW)},e.prototype.close=function(){t.prototype.close.call(this),e.getAward()},e._closeTimne=0,e}(AwardTipView);__reflect(AwardGetTipView.prototype,"AwardGetTipView");var AwardPreviewTip=function(t){function e(){return t.call(this,"AwardPreviewTipSkin")||this}return __extends(e,t),e.showAward=function(t,i){void 0===i&&(i=null),this._tip||(this._tip=new e),this._tip.show(GmGlobal.vmc.uiLayer),this._tip.setData(t,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.setData=function(t,e){if(this.tTitle.text=e||"Reward Preview",t&&0!=t.length){this._itemGridCon&&ItemGridCon.release(this._itemGridCon),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,100),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,10,this.itemIconCon,this.itemTextCon,540),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER;var i=Math.ceil(t.length/5);this.itemIconCon.height=10*(i-1)+100*i,this.itemTextCon.height=this.itemIconCon.height,this.height=this.itemIconCon.y+this.itemIconCon.height+130,this.bgCon.height=this.itemIconCon.height+70,this.okBtn.y=this.height-62}},e.prototype.close=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),t.prototype.close.call(this)},e}(UIBase);__reflect(AwardPreviewTip.prototype,"AwardPreviewTip");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function o(t){e.call(s,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(s))}var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(s,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(s,generateEUI2)},r)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var h=t.split("/");h.pop();var a=h.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(s,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(s,generateJSON.paths[t])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(s,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CostButton=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.resetLableWidth()},e.prototype.setSkinName=function(t){this.skinName=t,this.resetLableWidth()},e.prototype.resetLableWidth=function(){var t=this.labelDisplay;if(this.iconDisplay){var e=this.iconDisplay.width||47;t.width=this.width-e-this.iconDisplay.x,t.x=this.iconDisplay.x+e}else t.width=this.width},e}(OneStateButton);__reflect(CostButton.prototype,"CostButton");var ImageButton=function(t){function e(e,i,s){var o=t.call(this,e)||this;return o._scaleX=0,o._scaleY=0,o.anchorOffsetX=i/2,o.anchorOffsetY=s/2,o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,o.onTouchBegin,o),o}return __extends(e,t),e.prototype.onTouchBegin=function(t){this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),(0==this._scaleX||0==this._scaleY)&&(this._scaleX=this.scaleX,this._scaleY=this.scaleY),this.scaleUp(),this.sound&&""!=this.sound&&GmGlobal.sound.playSoundEffect(this.sound)},e.prototype.onTouchEnd=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.scaleDown()},e.prototype.onTouchCancel=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.scaleDown()},e.prototype.scaleUp=function(){this.scaleX=1.1*this._scaleX,this.scaleY=1.1*this._scaleY},e.prototype.scaleDown=function(){this.scaleX=this._scaleX,this.scaleY=this._scaleY},e}(eui.Image);__reflect(ImageButton.prototype,"ImageButton");var ModalWndStruct=function(){function t(t,e,i,s){var o=this;o.p=t,o.child=e,o.clickCb=i,o.alpha=s}return t.prototype.isDoModal=function(t){return t==this.child},t.prototype.clear=function(){this.p=null,this.child=null,this.clickCb=null,this.overlay=null},t}();__reflect(ModalWndStruct.prototype,"ModalWndStruct");var ModalWnd=function(){function t(){}return t.doModal=function(t,e,i,s,o){void 0===i&&(i=null),void 0===s&&(s=.7),void 0===o&&(o=0),null==this.wndStacks&&(this.wndStacks=[]);for(var n=this.wndStacks.length,r=0;n>r;r++){var h=this.wndStacks[r];if(h.isDoModal(e))return}var a=new ModalWndStruct(t,e,i,s);a.overlay=this.getOverlay(t.stage.stageWidth,t.stage.stageHeight),a.overlay.alpha=s,e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onChildRemoved,this),-1==o?this.wndStacks.unshift(a):this.wndStacks.push(a),t.addChild(a.overlay),t.addChild(e),this.updateLayerIndex(),this.updateOverlay()},t.updateLayerIndex=function(){if(this.wndStacks)for(var t=0;t<this.wndStacks.length;t++){var e=this.wndStacks[t],i=0;e.p.parent&&(i=100*(e.p.parent.getChildIndex(e.p)+1)),i+=e.p.getChildIndex(e.child),e.layerIndex=i}},t.getLayerIndex=function(t,e){var i=0;return t.parent&&(i=100*(t.parent.getChildIndex(t)+1)),i+=t.numChildren+2},t.getFloorIndex=function(t){if(!this.wndStacks)return-1;for(var e=0;e<this.wndStacks.length;e++){var i=this.wndStacks[e];if(i.p==t)return t.getChildIndex(i.child)}return-1},t.isFloorView=function(t,e){if(!this.wndStacks)return!0;for(var i=0;i<this.wndStacks.length;i++){var s=this.wndStacks[i];if(s.p==t)return s.child==e?!0:!1}return!0},t.getModalWnd=function(t){for(var e=0;e<this.wndStacks.length;e++){var i=this.wndStacks[e];if(i.child==t)return i}return null},t.getOverlay=function(t,e){this.os||(this.os=[]);var i=this.os.shift();return i?(i.width=t,i.height=e):(i=new eui.Rect(t,e,0),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchOverlay,this)),i},t.updateOverlay=function(){this.sortByLayerIndex();for(var t=-1,e=this.wndStacks.length-1;e>=0;e--){var i=this.wndStacks[e];i.alpha!=t?i.overlay.visible=!0:i.overlay.visible=!1,t=i.alpha}},t.sortByLayerIndex=function(){for(var t=null,e=0;e<this.wndStacks.length;e++)for(var i=e+1;i<this.wndStacks.length;i++){t=this.wndStacks[e];var s=this.wndStacks[i];s.layerIndex<t.layerIndex&&(this.wndStacks[e]=s,this.wndStacks[i]=t)}},t.unDoModal=function(t){if(null!=this.wndStacks&&0!=this.wndStacks.length){for(var e=this.wndStacks.length,i=0;e>i;i++){var s=this.wndStacks[i];if(s.isDoModal(t)){this.wndStacks.splice(i,1),s.child.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onChildRemoved,this),s.overlay.parent&&(s.overlay.parent.removeChild(s.overlay),this.os.push(s.overlay)),s.clear();break}}this.updateOverlay()}},t.onTouchOverlay=function(t){var e=this.wndStacks[this.wndStacks.length-1];e.clickCb&&e.clickCb.call(e.child)},t.onChildRemoved=function(t){var e=t.target;this.unDoModal(e)},t.oColor=0,t.oAlpha=.5,t}();__reflect(ModalWnd.prototype,"ModalWnd");var BitmapNumber=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.create=function(){var t=this._bnumPool.pop();return t||(t=new e),t},e.release=function(t){t&&-1==this._bnumPool.indexOf(t)&&(t.clear(),t.parent&&t.parent.removeChild(t),this._bnumPool.push(t))},e.prototype.setNumber=function(t,i,s){void 0===s&&(s=0),this.clear();for(var o=t.toString(),n=0,r=0,h=0;h<o.length;h++){var a=e._bitmapPool.pop();a||(a=new egret.Bitmap),a.texture=RES.getRes(i+o.charAt(h)),0==r&&(r=a.height),a.x=n,n+=a.width+s,this.addChild(a)}this.width=n-s,this.height=r},e.prototype.clear=function(){for(;this.numChildren>0;){var t=this.removeChildAt(0);t.texture=null,e._bitmapPool.push(t)}},e._bitmapPool=[],e._bnumPool=[],e}(egret.DisplayObjectContainer);__reflect(BitmapNumber.prototype,"BitmapNumber");var PriceButton=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setPrice=function(t,e){this.label="Original: $"+t+"\nCurrent: $"+e,t?(this.iconDisplay.visible=!0,this.iconDisplay.source="com_json.line_r"):this.iconDisplay.visible=!1,this.resetLableWidth()},e.prototype.setLabel=function(t){this.label=t,this.iconDisplay.visible=!1,this.resetLableWidth()},e.prototype.resetLableWidth=function(){var t=this.labelDisplay;t.textAlign="center",t.x=(this.width-t.width)/2,this.resetLine()},e.prototype.resetLine=function(){var t=this.labelDisplay;this.iconDisplay.width=t.width,this.iconDisplay.x=t.x},e}(OneStateButton);__reflect(PriceButton.prototype,"PriceButton");var ReadyView=function(t){function e(){var e=t.call(this)||this;return e._num=3,e._timer=0,e}return __extends(e,t),e.prototype.start=function(t,e,i){this._res=t,this._cb=e,this._cbThis=i,this._text=new BitmapNumber,this.addChild(this._text),this.showCount(this._num),this._timer=egret.setInterval(this.onTimer,this,1e3)},e.prototype.onTimer=function(){this._num--,0==this._num?(egret.clearInterval(this._timer),this._timer=0,this.parent&&this.parent.removeChild(this),this._cb.call(this._cbThis)):this.showCount(this._num)},e.prototype.showCount=function(t){this._text.setNumber(t,this._res),this._text.anchorOffsetX=this._text.width/2,this._text.anchorOffsetY=this._text.height/2,this._text.scaleX=0,this._text.scaleY=0,egret.Tween.get(this._text).to({scaleX:2,scaleY:2},500,egret.Ease.backOut)},e.prototype.clear=function(){0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0),this._text&&egret.Tween.removeTweens(this._text),this.parent&&this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(ReadyView.prototype,"ReadyView");var ResetAtrTipView=function(t){function e(){return t.call(this,"ResetAtrTipSkin")||this}return __extends(e,t),e.showInfo=function(t,i,s,o,n,r){void 0===s&&(s=null),void 0===o&&(o=null),void 0===n&&(n=null),void 0===r&&(r=e),e._instence||(e._instence=new r),e._instence.show(GmGlobal.vmc.uiLayer,!0),e._instence.setInfo(t,i),e._instence.bindCloseCallback(s,o,n)},e.prototype.bindCloseCallback=function(t,e,i){this._cbThis=e,this._sbCb=i,this._closeCB=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.qxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onqxBtn,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.qxBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onqxBtn,this)},e.prototype.setInfo=function(t,e){this.tMs.text=e,this.item.updateIcon(t.id);var i=GmGlobal.mc.itemMgr.getItemNum(t.id);TextFormat.setMoneyStr(this.item.numTxt,i,t.num)},e.prototype.clear=function(){this._closeCB=null,this._sbCb=null,this._cbThis=null},e.prototype.onqxBtn=function(){this._sbCb&&this._sbCb.call(this._cbThis),this.clear(),t.prototype.close.call(this)},e.prototype.close=function(){this._closeCB&&this._closeCB.call(this._cbThis),this.clear(),t.prototype.close.call(this)},e}(UIBase);__reflect(ResetAtrTipView.prototype,"ResetAtrTipView");var CallBack=function(){function t(t,e){this.cb=t,this.target=e}return t}();__reflect(CallBack.prototype,"CallBack");var ControlsCenter=function(){function t(){GmGlobal.server=new Server("gameServer")}return t.prototype.init=function(){this.dataCtl=new DataController,this.pfCtl=new PFController,this.loginCtl=new LoginController,this.roleCtl=new RoleController,this.itemCtl=new ItemController,this.mailCtl=new MailController,this.shareCtl=new ShareController,this.chatCtl=new ChatController,this.lpCtl=new LupingController,this.rankCtl=new RankController,this.guideCtl=new GuideController,this.sceneCtl=new SceneController,this.heroCtl=new HeroController,this.epCtl=new EquipController,this.tradeCtl=new TradeController,this.tsCtl=new TousController,this.skillCtl=new SkillController,this.petCtl=new PetController,this.taskCtl=new TaskController,this.xzCtl=new XingzuoController,this.wfCtl=new WanfaController,this.flCtl=new FuliController,this.shopCtl=new ShopController,this.vipCtl=new VipController,this.firstpayCtl=new FirstpayController,this.onlineCtl=new OnlineController,this.ghCtl=new GonghuiController,this.rwdCtl=new RewardController,this.mvpCtl=new MvpController,this.huobCtl=new HuobanController,this.ycshopCtl=new YcshopController,this.baowuCtl=new BaowuController,this.haoliCtl=new HaoliController,this.yiyuanCtl=new YiyuanController,this.gtaskCtl=new GrowupTaskController,this.day7Ctl=new Day7Controller,this.catCtl=new CatController,this.dgiftCtl=new DayGiftController,this.tujianCtl=new TujianController,this.sweetCtl=new SweethouseController,this.huntCtl=new HuntController,this.titleCtl=new TitleController,this.vip1Ctl=new Vip1Controller,this.shipinCtl=new ShipinController,this.haloCtl=new HaloController,this.mcjCtl=new McjController,this.qdCtl=new QdController},t}();__reflect(ControlsCenter.prototype,"ControlsCenter");var MediatorCenter=function(){function t(){this._destroys=[]}return t.prototype.init=function(){this.initLayers(),this.initMediators(),this.initStatics()},t.prototype.initLayers=function(){this.sceneLayer=new egret.DisplayObjectContainer,this.uiLayer=new egret.DisplayObjectContainer,this.uiLayer.touchEnabled=!1,this.noticeLayer=new egret.DisplayObjectContainer,this.noticeLayer.touchEnabled=!1,this.noticeLayer.touchChildren=!1,this.uiLayer2=new egret.DisplayObjectContainer,this.uiLayer2.touchEnabled=!1,GmGlobal.root.addChild(this.sceneLayer),GmGlobal.root.addChild(this.uiLayer),GmGlobal.root.addChild(this.uiLayer2),GmGlobal.root.addChild(this.noticeLayer)},t.prototype.initMediators=function(){this._mInit=new InitMediator,this._mLogin=new LoginMediator,this.mMui=new MainUIMediator,this._mSet=new SettingMediator,this._mMail=new MailMediator,this._mNotice=new NoticeMediator,this._mRank=new RankMediator,this._mHero=new HeroMediator,this._mBag=new BagMediator,this._mShare=new ShareMediator,this._mRule=new RuleMediator,this._mEqp=new EquipMediator,this._mMTous=new TousMMediator,this._mTous=new TousMediator,this._mSkill=new SkillMediator,this._mPet=new PetMediator,this._mTrade=new TradeMediator,this._mShop=new ShopMediator,this._mChat=new ChatMediator,this._mTask=new TaskMediator,this._mFuli=new FuliMediator,this._mJl=new JingliMediator,this._mVip=new VipMediator,this._mReward=new RewardMediator,this._mXingzuo=new XingzuoMediator,this._mGj=new GuajiMediator,this._mWf=new WanfaMediator,this._mvp=new MvpMediator,this._mGh=new GonghuiMediator,this._mKpl=new KapulaMediator,this._mSc=new FirstpayMediator,this._mHuoban=new HuobanMediator,this._mYcshop=new YcshopMediator,this._mBaowu=new BaowuMediator,this.mHaoli=new HaoliMediator,this.m7day=new Day7Mediator,this.mYiyuan=new YiyuanMediator,this._mGTask=new GrowupTaskMediator,this._mCat=new CatMediator,this._mFriend=new FriendMediator,this._mDGift=new DayGiftMediator,this._mD7Gift=new Day7GiftMediator,this._mTujian=new TujianMediator,this._mSweet=new SweethouseMediator,this._mHunt=new HuntMediator,this._mLjs=new LianjsMediator,this._mWeight=new WeightMediator,this._mTitle=new TitleMediator,this._mVip1=new Vip1Mediator,this._mShipin=new ShipinMediator,this._mHalo=new HaloMediator,this._mMcj=new McjMediator,this._mQd=new QdMediator,this._mZlb=new ZlbMediator,this._mWj=new WenjuanMediator,this._mYckj=new YckjMediator,"360"==PFConst.PF_NAME&&(this._mWdLogin=new WdLoginMediator),PFConst.IS_360WD&&(this._mWeid=new WeidMediator),this._mTishi=new TishiMediator,this.mGuide=new GuideMediator,this.scene=new SceneMediator},t.prototype.initStatics=function(){ActionState.initState(),Horselamp.init(this.noticeLayer)},t.prototype.hasOpenUI=function(){for(var t=0,e=0;e<this.uiLayer.numChildren;e++){var i=this.uiLayer.getChildAt(e);i.isShow&&t++}return t>2},t.prototype.regDelayDestroy=function(t){-1==this._destroys.indexOf(t)&&this._destroys.push(t)},t.prototype.unregDelayDestroy=function(t){var e=this._destroys.indexOf(t);-1!=e&&this._destroys.splice(e,1)},t.prototype.onCheckDestroy=function(){for(var t=0;t<this._destroys.length;t++){var e=this._destroys[t];e.destroy()&&(this._destroys.splice(t,1),t--)}},t.prototype.clearLoginView=function(){this._mLogin.clear()},t.prototype.startInitGame=function(){this._mInit.start(this.onInited,this)},t.prototype.onInited=function(){GmGlobal.cc.pfCtl.pfCheckPay(GmGlobal.mc.role.lv,this.checkPayRet,this)},t.prototype.checkPayRet=function(t){PFConst.init(),PFConst.IS_NOPAY=!t,this.gmInited()},t.prototype.gmInited=function(){var t=GmGlobal.mc;GmGlobal.cc.pfCtl.pfReport(PfReportType.LOGIN),GmGlobal.cc.pfCtl.pfInitGame(t.loginMgr.gamePlatServer,t.role.roleId),this.scene.init(),t.sceneMgr.mapId&&CmdBus.doCmd(CmdType.ENTER_CS,t.sceneMgr.mapId),GmGlobal.cc.pfCtl.pfGameReport(16),EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this)},t.prototype.startJuqing=function(){this.mJq=new JuqingMediator,this.mJq.start(this.onJuqingEnd,this)},t.prototype.onJuqingEnd=function(){this.mJq.clear(),this.mJq=null,this._mInit.onJqEnd()},t.prototype.onEnterScene=function(){EventBus.rmListener(EventType.ENTER_SCENE,this.onEnterScene,this),EventBus.dispatchEvt(EventType.GAME_READY,!1),GmGlobal.cc.pfCtl.pfGameReport(17),this._mInit.clear(),egret.setInterval(this.onCheckDestroy,this,2e3),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.ENTERSCENE)},t}();__reflect(MediatorCenter.prototype,"MediatorCenter");var ModelCenter=function(){function t(){this._unzipList=[]}return t.prototype.init=function(){this.role=new Role,this.dataMgr=new DataManger,this.pfMgr=new PFManager,this.setMgr=new SettingManager,this.loginMgr=new LoginManager,this.itemMgr=new ItemManager,this.muiMgr=new MainUIManager,this.mailMgr=new MailManager,this.chatMgr=new ChatManager,this.rankMgr=new RankManager,this.heroMgr=new HeroManager,this.bagMgr=new BagManager,this.shareMgr=new ShareManager,this.guideMgr=new GuideManager,this.giftMgr=new GiftManager,this.txtMgr=new TextManager,this.mapMgr=new MapManager,this.sceneMgr=new SceneManager,this.equipMgr=new EquipManager,this.tradeMgr=new TradeManager,this.tsMgr=new TousManager,this.skillMgr=new SkillManager,this.petMgr=new PetManager,this.taskMgr=new TaskManager,this.npcMgr=new NpcManager,this.btMgr=new BattleManager,this.xzMgr=new XingzuoManager,this.wfMgr=new WanfaManager,this.flMgr=new FuliManager,this.shopMgr=new ShopManager,this.vipMgr=new VipManager,this.firstpayMgr=new FirstpayManager,this.onlineMgr=new OnlineManager,this.jinliMgr=new JingliManager,this.ghMgr=new GonghuiManager,this.rwdMgr=new RewardManager,this.gjMgr=new GuajiManager,this.tishiMgr=new TishiManager,this.mvpMgr=new MvpManager,this.jqMgr=new JuqingManager,this.huobMgr=new HuobanManager,this.ycshopMgr=new YcshopManager,this.baowuMgr=new BaowuManager,this.haoliMgr=new HaoliManager,this.yiyuanMgr=new YiyuanManager,this.gtaskMgr=new GrowupTaskManager,this.day7Mgr=new Day7Manager,this.catMgr=new CatManager,this.dgiftMgr=new DayGiftManager,this.tjMgr=new TujianManager,this.shMgr=new SweethouseManager,this.ljsMgr=new LianjsManager,this.huntMgr=new HuntManager,this.titleMgr=new TitleManager,this.vip1Mgr=new Vip1Manager,this.shipinMgr=new ShipinManager,this.haloMgr=new HaloManager,this.mcjMgr=new McjManager,this.qdMgr=new QdManager,this.zlbMgr=new ZlbManager,this.yckjMgr=new YckjManager},t.prototype.initSoundState=function(){var t=egret.localStorage.getItem("musicstate"),e=egret.localStorage.getItem("soundstate");if(null!=t&&""!=t){var i=Number(t)>0?!0:!1;GmGlobal.mc.setMgr.bgmState=i,GmGlobal.sound.bgmSwitch(i)}if(null!=e&&""!=e){var i=Number(e)>0?!0:!1;GmGlobal.mc.setMgr.soundState=i,GmGlobal.sound.sEffectSwitch(i)}},t.prototype.regUnzipCfg=function(t,e,i){this._unzipList.push({f:t,c:e,thisObj:i})},t.prototype.initConfig=function(t){if(this._unzipList){for(var e=0,i=this._unzipList;e<i.length;e++){var s=i[e],o=t.file(s.f);o&&s.c.call(s.thisObj,JSON.parse(o.asText()))}this._unzipList=null}},t}();__reflect(ModelCenter.prototype,"ModelCenter");var WdLoginAwView=function(t){function e(){return t.call(this,"WdLoginAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDown,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDown,this)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.giftMgr.getOnceConfig(OncegiftType.WDLOGIN);this._itemGridCon&&ItemGridCon.release(this._itemGridCon),i&&(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(i.award,100),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,10,this.itemCon,this.textCon,540),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER),this.updateBtn()},e.prototype.updateBtn=function(){if(PFConst.IS_360WD){var t=GmGlobal.mc.dataMgr.getGiftValue(OncegiftType.WDLOGIN,2);0==t?this.bDown.label="Claim Reward":(this.bDown.label="Claimed",Utils.setBtnEnable(this.bDown,!1))}else this.bDown.label="Download APP"},e.prototype.onDown=function(){PFConst.IS_360WD?GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_GIFT,[OncegiftType.WDLOGIN,1],this.updateBtn,this):"undefined"!=typeof downloadWd&&downloadWd()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_WDLOGIN)},e.prototype.close=function(){this._itemGridCon&&ItemGridCon.release(this._itemGridCon),t.prototype.close.call(this)},e}(UIBase);__reflect(WdLoginAwView.prototype,"WdLoginAwView");var WdLoginMediator=function(){function t(){this._timer=0,CmdBus.adListener(CmdType.O_WDLOGIN,this.onOpen,this),CmdBus.adListener(CmdType.C_WDLOGIN,this.onClose,this),GmGlobal.mc.muiMgr.regCmd(ModelID.WDLOGIN,CmdType.O_WDLOGIN),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this);var t=GmGlobal.mc.dataMgr.getGiftValue(OncegiftType.WDLOGIN,2);if("360"==PFConst.PF_NAME&&0==t)PFConst.IS_360WD||(this._timer=egret.setTimeout(this.onIntervalOpen,this,6e5));else{var e=GmGlobal.vmc.mMui.getMainUI().getBtnByID(ModelID.WDLOGIN);e&&e.parent&&e.parent.removeChild(e)}},t.prototype.onIntervalOpen=function(){this._view&&this._view.isShow||this.onOpen()},t.prototype.clearTimer=function(){0!=this._timer&&(egret.clearTimeout(this._timer),this._timer=0)},t.prototype.onOpen=function(){this.clearTimer(),this._view||(this._view=new WdLoginAwView),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer)},t.prototype.onClose=function(){this._view&&(this._view.close(),this._view=null),PFConst.IS_360WD||(this.clearTimer(),this._timer=egret.setTimeout(this.onIntervalOpen,this,6e5))},t}();__reflect(WdLoginMediator.prototype,"WdLoginMediator");var Day7Controller=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_DAY7,this.onUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_DAY7_TZ,this.onUpdTz,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_DAY7GIFT,this.onUpdCnt,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.day7Mgr;i.endtime=e.et||0,i.tzTime=i.endtime-604800+i.cdCfg,EventBus.dispatchEvt(EventType.M_DAY7)},t.prototype.onUpdTz=function(t){var e=t.data.data,i=GmGlobal.mc.day7Mgr;i.tzInfos=e||{},this.updateRedDot(),EventBus.dispatchEvt(EventType.M_DAY7_TZ)},t.prototype.onUpdCnt=function(t){var e=t.data.data,i=GmGlobal.mc.day7Mgr;i.d7Giftcnts=e||{},EventBus.dispatchEvt(EventType.M_DAY7_GIFT)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.day7Mgr,e=t.redDot.childs[1],i=t.tzCfgs,s=0;s<i.length;s++){var o=(i[s],t.tzInfos[s+1]||{}),n=0;if(1==o.s)for(var r=7-o.cnt,h=t.endtime-GmGlobal.getServerTime(),a=6-Math.floor(h/3600/24),l=0;7>l;l++)l>=r&&a>=l&&(n=1);this.setItemRD(e,s,n)}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t}();__reflect(Day7Controller.prototype,"Day7Controller");var Day7Manager=function(){function t(){this.giftCfgs=[],this.endtime=0,this.tzInfos={},this.d7Giftcnts={},GmGlobal.mc.regUnzipCfg("c_day7.json",this.initCfg,this);var t={0:0,1:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.DAY7,this.redDot)}return t.prototype.initCfg=function(t){this.rankCfgs=t.rankCfgs,this.tzCfgs=t.tzCfgs,this.rule=t.rule,this.cdCfg=t.tztime,this.giftCfgs=t.gift},t.prototype.getRankIdList=function(t){for(var e=this.rankCfgs[t],i=e.rankList,s=[],o=0;o<i.length;o++){var n=i[o];n.rankto?s.push(n.rankto):s.push(n.rank)}return s},t}();__reflect(Day7Manager.prototype,"Day7Manager");var Day7Mediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.DAY7,CmdType.O_7DAY),CmdBus.adListener(CmdType.O_7DAY,this.onOpenView,this),CmdBus.adListener(CmdType.C_7DAY,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.onUpdate=function(t){GmGlobal.mc.muiMgr.isInited&&this.updateIcon()},t.prototype.updateIcon=function(){if(!PFConst.IS_NOPAY){var t=Math.max(GmGlobal.mc.day7Mgr.tzTime-GmGlobal.getServerTime(),0);t>0?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.DAY7,"mui_json.mui_b_day7"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.DAY7)}},t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t,e){void 0===e&&(e=0),this._showIndex=t||0,this._tIdx=e,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new Day7View),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._showIndex,this._tIdx)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(Day7Mediator.prototype,"Day7Mediator",["IMediator"]);var Day7RankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tRank.text=this.data.cfg.des||"";var t=[];if(this.data.cfg.cItems){var e=GmGlobal.mc.heroMgr.getHeroCfg(GmGlobal.mc.role.careerId);t=this.data.cfg.cItems[e.career-1]}t=t.concat(this.data.cfg.items),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(Day7RankItem.prototype,"Day7RankItem");var Day7TzItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tnum.text="D"+this.data.idx;var t=this.data.state;1==t?(this.okBtn.visible=!0,Utils.setBtnEnable(this.okBtn,!0),this.iylq.visible=!1):2==t?(this.okBtn.visible=!1,this.iylq.visible=!0):(this.okBtn.visible=!0,Utils.setBtnEnable(this.okBtn,!1),this.iylq.visible=!1),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign="center"
},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(Day7TzItem.prototype,"Day7TzItem");var Day7View=function(t){function e(){var e=t.call(this,"Day7Skin")||this;return e._sNo=0,e._tabIndex=-1,e._typeIndex=-1,e._viewIndex=1,e._reqNum=10,e.MAX_NUM=100,e._rTab=[RankID.ZHANLI,RankID.PAY,RankID.QIANGHUA,RankID.PET,RankID.LEVEL,RankID.ARENA,RankID.CHUANBAO],e._cmd=[CmdType.O_HAOLI,CmdType.O_SHOP,CmdType.O_DAY7_GIFT,CmdType.O_DAY7_GIFT,CmdType.O_DAY7_GIFT,CmdType.O_DAY7_GIFT,CmdType.O_DAY7_GIFT],e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this.rScoll.verticalScrollBar&&(this.rScoll.verticalScrollBar.autoVisibility=!1),this.rScoll.horizontalScrollBar&&(this.rScoll.horizontalScrollBar.autoVisibility=!1),this.tzScoll.verticalScrollBar&&(this.tzScoll.verticalScrollBar.autoVisibility=!1),this.tzScoll.horizontalScrollBar&&(this.tzScoll.horizontalScrollBar.autoVisibility=!1),this._rArray=new eui.ArrayCollection,this.rItemList.dataProvider=this._rArray,this.rItemList.itemRendererSkinName="Day7RankItemSkin",this.rItemList.itemRenderer=Day7RankItem,this._tzArray=new eui.ArrayCollection,this.tzItemList.dataProvider=this._tzArray,this.tzItemList.itemRendererSkinName="Day7TzItemSkin",this.tzItemList.itemRenderer=Day7TzItem,this.initTzLst(),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.tabCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTab,this),this.tzItemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchLst,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bJj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJj,this),EventBus.addListener(EventType.M_DAY7_TZ,this.updTz,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.tabCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTab,this),this.tzItemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchLst,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bJj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJj,this),EventBus.rmListener(EventType.M_DAY7_TZ,this.updTz,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow()},e.prototype.initTzLst=function(){for(var t=0;7>t;t++){var e={items:[],state:0,idx:t+1};this._tzArray.addItem(e)}},e.prototype.onTouchLst=function(t){if(t.target.parent.parent==this.tzItemList&&"btn"==t.target.name){var e=t.target.parent;this._cc.dataCtl.doAction(ServerActionId.DAY7_AWD,[this._typeIndex+1,e.data.idx])}},e.prototype.onSelTab=function(t){if(t.target.parent==this.tabCon){var e=this.tabCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t,e){if(void 0===e&&(e=0),t!=this._tabIndex){if(-1!=this._tabIndex){var i=this.tabCon.getChildAt(this._tabIndex);i.filters=[]}var s=this.tabCon.getChildAt(t);if(s.filters=FilterUtils.seleteFilter3(),this._tabIndex=t,this._typeIndex=-1,this.rScoll.stopAnimation(),this.rScoll.viewport.scrollV=0,0==this._tabIndex?(this.rScoll.visible=!0,this.tzScoll.visible=!1,this.tTzms.visible=!1,this.bBuy.visible=!1,this.bJj.visible=!0):(this.rScoll.visible=!1,this.tzScoll.visible=!0,this.tTzms.visible=!0,this.bBuy.visible=!0,this.bJj.visible=!1),this.updTab(),e){var o=120*e;o>=this.tableBgCon.width-590&&(o=this.tableBgCon.width-590),this.scoll.viewport.scrollH=o,this.selTypeTab(e)}else if(0==t){var n=this._mc.day7Mgr.endtime-GmGlobal.getServerTime(),r=Math.min(6-Math.floor(n/3600/24),6),o=120*r;o>=this.tableBgCon.width-590&&(o=this.tableBgCon.width-590),this.scoll.viewport.scrollH=o,this.selTypeTab(r)}else this.selTypeTab(0);this.updRedDot()}},e.prototype.updTab=function(){var t=this._mc.day7Mgr.rankCfgs;this._tabIndex&&(t=this._mc.day7Mgr.tzCfgs),this.tableBgCon.removeChildren(),this.tableTxtCon.removeChildren(),this.scoll.stopAnimation(),this.scoll.viewport.scrollH=0;var e=120;1==this._tabIndex&&(e=160);for(var i=0;i<t.length;i++){var s=t[i],o=new eui.Image("com_json.tab_ui0");o.scale9Grid=new egret.Rectangle(11,0,2,60);var n=new eui.Label(s.tab);o.width=e,o.height=50,n.width=e,n.height=50,n.textAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.size=26,n.touchEnabled=!1,n.stroke=2,n.strokeColor=10534624,n.textColor=16777215,n.bold=!0,this.tableBgCon.addChild(o),this.tableTxtCon.addChild(n)}this.tableBgCon.width=e*t.length+10*(t.length-1),this.tableTxtCon.width=this.tableBgCon.width,RedDotView.removeRedDotByGroup("day7_tab")},e.prototype.updCd=function(){if(0==this._tabIndex){CDText.getInstence().rmCD(this.tms);var t=this._mc.day7Mgr.endtime-GmGlobal.getServerTime(),e=6-Math.floor(t/3600/24);if(Utils.setBtnEnable(this.bJj,!0),this._typeIndex<e)this.tms.text="Reward list settled",Utils.setBtnEnable(this.bJj,!1);else if(this._typeIndex>e)this.tms.text="Reward list event unavailable";else{var i=this._mc.day7Mgr.endtime-24*(6-e)*3600,s=i-GmGlobal.getServerTime();s>0?CDText.getInstence().addCD(this.tms,s,"Reward list settlement time：","DD h:m:s","",this.onRTime,this):this.onRTime()}}else{CDText.getInstence().rmCD(this.tms);var o=this._mc.day7Mgr.tzTime-GmGlobal.getServerTime();o>0?CDText.getInstence().addCD(this.tms,o,"Settlement Countdown：","DD h:m:s","",this.onTimeOut,this):this.onTimeOut()}},e.prototype.onRTime=function(){CDText.getInstence().rmCD(this.tms),this.tms.text="Reward list settled",Utils.setBtnEnable(this.bJj,!1)},e.prototype.onTimeOut=function(){CDText.getInstence().rmCD(this.tms),this.tms.text="Event ended"},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._typeIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTypeTab(e)}},e.prototype.selTypeTab=function(t){if(t!=this._typeIndex){if(-1!=this._typeIndex){var e=this.tableBgCon.getChildAt(this._typeIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._typeIndex=t,this.rScoll.stopAnimation(),this.rScoll.viewport.scrollV=0,0==this._tabIndex?this.setRankType(t):this.updTz(),this.updCd()}},e.prototype.updTz=function(){if(0!=this._tabIndex){var t=this._mc.day7Mgr.tzCfgs[this._typeIndex];this.tTzms.textFlow=TextFormat.parser.parse("Limited-Time Fund("+TextFormat.setColor(t.tab,14567872)+")\nInvest "+TextFormat.setColor(t[ItemID.DIAMOND],14567872)+" Diamond and claim "+TextFormat.setColor(t[ItemID.SHUIJING],14567872)+" Crystals on day 7.\nLimited time only, don't miss out.");var e=this._mc.day7Mgr.tzInfos[this._typeIndex+1]||{};void 0!=e.cnt?(Utils.setBtnEnable(this.bBuy,!1),this.bBuy.label="Funded"):(Utils.setBtnEnable(this.bBuy,!0),this.bBuy.label="Invest");for(var i=0;i<this._tzArray.length;i++){var s=this._tzArray.getItemAt(i),o=t.awds[i];s.items=o;var n=this._mc.day7Mgr.endtime-GmGlobal.getServerTime(),r=6-Math.floor(n/3600/24),h=7-e.cnt;h>i?s.state=2:i>=h&&r>=i?s.state=1:s.state=0,this._tzArray.itemUpdated(s)}this.updRedDot()}},e.prototype.setRankType=function(t){void 0===t&&(t=0);var e=this._rTab[t],i=this._mc.day7Mgr.endtime-GmGlobal.getServerTime(),s=6-Math.floor(i/3600/24);this._typeIndex<s&&(e+=1e3),this._rArray.removeAll(),this.updateList();var o=this._mc.day7Mgr.rankCfgs[this._typeIndex];this.bJj.label=o.btxt},e.prototype.updateList=function(){for(var t=(GmGlobal.mc,this._rTab[this._typeIndex],this._mc.day7Mgr.rankCfgs[this._typeIndex]),e=t.rankList,i=0;i<e.length;i++){var s=e[i],o={cfg:s,name:t.titMs,rname:"",roleid:0,jf:0};s.rankto>0?s.rankto:s.rank;null!=this._rArray.getItemAt(i)?this._rArray.replaceItemAt(o,i):this._rArray.addItem(o)}},e.prototype.updPayRankLst=function(t){for(var e=this._mc.day7Mgr.rankCfgs[this._typeIndex],i=e.rankList,s=1,o=-1,n=0;10>n;n++){var r=t.getDataByRank(s);3>n&&r&&r.data>=500?(r.roleId==GmGlobal.mc.role.roleId&&(o=n),s++):n>=3&&r&&r.data>=200&&(r.roleId==GmGlobal.mc.role.roleId&&(o=n),s++)}for(var n=10;n<i.length&&50>n;n++){var r=t.getDataByRank(s);r&&(r.roleId==GmGlobal.mc.role.roleId&&(o=n),s++)}s=1;for(var n=0;10>n;n++){var h=i[n],a={cfg:h,name:e.titMs,rname:"",roleid:0,jf:0},r=t.getDataByRank(s);3>n&&r&&r.data>=500?((n==o||n==o-1)&&(a.jf=r.data),a.rname=r.name,a.roleid=r.roleId,s++):n>=3&&r&&r.data>=200&&((n==o||n==o-1)&&(a.jf=r.data),a.rname=r.name,a.roleid=r.roleId,s++),null!=this._rArray.getItemAt(n)?this._rArray.replaceItemAt(a,n):this._rArray.addItem(a)}for(var n=10;n<i.length&&50>n;n++){var h=i[n],a={cfg:h,name:e.titMs,rname:"",roleid:0,jf:0},r=t.getDataByRank(s);r&&((n==o||n==o-1)&&(a.jf=r.data),a.rname=r.name,a.roleid=r.roleId,s++),null!=this._rArray.getItemAt(n)?this._rArray.replaceItemAt(a,n):this._rArray.addItem(a)}},e.prototype.updRedDot=function(){var t=this._mc.day7Mgr.redDot.childs[1],e=this.tabCon.getChildAt(1);if(t.state){var i=this.getRDPoint(e);RedDotView.addRedDot(e,this.redDotCon,"day7",i.x,i.y,"com_json.com_rdd")}else RedDotView.removeRedDot(e);if(1==this._tabIndex){if(!t.childs)return;for(var s=0;s<this._mc.day7Mgr.tzCfgs.length;s++){var o=t.childs[s],n=this.tableBgCon.getChildAt(s);if(1==o.state){var r=this.scoll.x+this.tableBgCon.x+130*(s+1)+10*s-20;RedDotView.addRedDot(n,this.redDotCon,"day7_tab",r,this.scoll.y+this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(n)}}},e.prototype.getRDPoint=function(t){var e=t.parent.localToGlobal(t.x,t.y);return e.x-=this.x-t.width+40,e.y-=this.y+5,e},e.prototype.clearItems=function(){for(var t=0;t<this.rItemList.numChildren;t++){var e=this.rItemList.getChildAt(t);e.clearItems()}this._rArray.removeAll()},e.prototype.onBuy=function(){this._cc.dataCtl.doAction(ServerActionId.DAY7_TZ,[this._typeIndex+1])},e.prototype.onJj=function(){for(var t=0,e=0;e<this._rTab.length;e++){if(0==this._typeIndex){t=0;break}if(1==this._typeIndex){t=0;break}if(e>=1&&6>=e){t=this._rTab[this._typeIndex];break}}CmdBus.doCmd(this._cmd[this._typeIndex],t,this._rTab[this._typeIndex]),this.onClose()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.day7Mgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_7DAY)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tabCon.getChildAt(this._tabIndex);e.filters=[]}if(this._tabIndex=-1,-1!=this._typeIndex){var e=this.tableBgCon.getChildAt(this._typeIndex);e.source="com_json.tab_ui0"}this._typeIndex=-1,this.clearItems(),RedDotView.removeRedDotByGroup("day7"),RedDotView.removeRedDotByGroup("day7_tab"),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("7day_json")},e}(UIBase);__reflect(Day7View.prototype,"Day7View");var Day7GiftController=function(){function t(){var t=GmGlobal.cc.dataCtl;t.regPbCb(PbMsgId.YCSHOP_AW,this.onUpdAwd,this)}return t.prototype.onUpdAwd=function(t){var e=GmGlobal.mc.ycshopMgr;e.price=t.price,e.awards=[];for(var i in t.award){var s=new Item(Number(i),t.award[i]);e.awards.push(s)}EventBus.dispatchEvt(EventType.M_YCSHOP_AW)},t}();__reflect(Day7GiftController.prototype,"Day7GiftController");var Day7GiftManager=function(){function t(){this.price=0,this.awards=[]}return t}();__reflect(Day7GiftManager.prototype,"Day7GiftManager");var Day7GiftMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.D7GIFT,CmdType.O_DAY7_GIFT),CmdBus.adListener(CmdType.O_DAY7_GIFT,this.onOpenView,this),CmdBus.adListener(CmdType.C_DAY7_GIFT,this.onCloseView,this)}return t.prototype.onOpenView=function(t){PFConst.IS_NOPAY||(this._rid=t,this.doOpenView())},t.prototype.doOpenView=function(){this._view||(this._view=new Day7GiftView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.setRid(this._rid)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(Day7GiftMediator.prototype,"Day7GiftMediator",["IMediator"]);var Day7GiftView=function(t){function e(){var e=t.call(this,"Day7GiftSkin")||this;return e._rTab=[RankID.QIANGHUA,RankID.PET,RankID.LEVEL,RankID.ARENA,RankID.CHUANBAO],e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),EventBus.addListener(EventType.M_DAY7_GIFT,this.updUI,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),EventBus.rmListener(EventType.M_DAY7_GIFT,this.updUI,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow()},e.prototype.setRid=function(t){this._rid=t,this.updUI()},e.prototype.updUI=function(){var t=this._rTab.indexOf(this._rid),e=this._mc.day7Mgr.giftCfgs[t],i=e.price,s=e.items;this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(s,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0)),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,this.okBtn.label="$"+i+" Offer";var o=this._mc.day7Mgr.d7Giftcnts[this._rid];0==o?(this.txt.text="Limit reached",Utils.setBtnEnable(this.okBtn,!1)):(o||(o=e.cnt),this.txt.text="Purchases left："+o,Utils.setBtnEnable(this.okBtn,!0))},e.prototype.onOkBtn=function(){var t=this._rTab.indexOf(this._rid),e=this._mc.day7Mgr.giftCfgs[t],i=e.price;t=4==t?11+t:10+t,this._cc.pfCtl.Pay(100*i,t)},e.prototype.clearItem=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_DAY7_GIFT);var t=this._rTab.indexOf(this._rid);CmdBus.doCmd(CmdType.O_7DAY,0,t+2)},e.prototype.close=function(){this.clearItem(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("bg_lb_jpg")},e}(UIBase);__reflect(Day7GiftView.prototype,"Day7GiftView");var BagFjView=function(t){function e(){var e=t.call(this,"BagFjSkin")||this;return e._sMvp=!1,e._efts=[],e._selList=[],e._selImg={},e._selQId=[1,2,3],e._selImgPool=[],e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.micon.source=this._mc.itemMgr.getItemIcon(ItemID.STONE_1),this.mvpicon.source=this._mc.itemMgr.getItemIcon(ItemID.STONE_TL),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(e.ONE_PAGE_NUM,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.sq1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.smvp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchMvp,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRonglian,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.sq1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.sq5.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchQImg,this),this.smvp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchMvp,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRonglian,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.setMvpState(this._sMvp),this.updateQSelState(),this.updatePage(),this.checkGuide()},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP],2),i=0;i<e.length;i++){var s=e[i],o=this._mc.itemMgr.getItemCfg(s.num),n=this._mc.equipMgr.isJlOrCard(s.id);n||(this._sMvp?t.push(s):o.isBoss||t.push(s))}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);for(var s=[],o=t;i>o;o++){var n=this._itemList[o];s.push(n)}this._itemGridCon.setItems(s)}},e.prototype.onTouchItemGrid=function(t){this.setItemSelState(t,!this.isSel(t.uid)),this.updateRlAward()},e.prototype.onTouchMvp=function(t){this.setMvpState(!this._sMvp)},e.prototype.setMvpState=function(t){this._sMvp=t,this._sMvp?(this.smvp.source="fenj_json.gx_2",this.mvpicon.visible=!0,this.tmvp.visible=!0):(this.smvp.source="fenj_json.gx_bg",this.mvpicon.visible=!1,this.tmvp.visible=!1),this.clearSelList(),this.updateLst()},e.prototype.onTouchQImg=function(t){var e=0;t.target==this.sq1?e=1:t.target==this.sq2?e=2:t.target==this.sq3?e=3:t.target==this.sq4?e=4:t.target==this.sq5&&(e=5);var i=this._selQId.indexOf(e);-1==i?this._selQId.push(e):this._selQId.splice(i,1),this.updateQSelState(),this.updateItemSelState()},e.prototype.updateQSelState=function(){for(var t=1;5>=t;t++)this.setQstate(t,this._selQId.indexOf(t)>=0)},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t],s=GmGlobal.mc.itemMgr.getItemCfg(i.itemId);s&&this._selQId.indexOf(s.quality)>=0?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}this.updateRlAward()},e.prototype.setItemSelState=function(t,e){var i=this._selList.indexOf(t.uid);if(e){if(i>=0)return;this._selList.push(t.uid);var s=this.getSelImg();s.x=t.icon.x+t.icon.width-31,s.y=t.icon.y-10,this.selCon.addChild(s),this._selImg[t.uid]=s}else{if(-1==i)return;this._selList.splice(i,1);var s=this._selImg[t.uid];this.selCon.removeChild(s),this._selImgPool.push(s),delete this._selImg[t.uid]}},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._selImg[i];s&&(this._selImgPool.push(s),delete this._selImg[i],this.selCon.removeChild(s))}this._selList=[]},e.prototype.setQstate=function(t,e){switch(t){case 1:e?this.sq1.source="fenj_json.gx_1":this.sq1.source="fenj_json.gx_bg";break;case 2:e?this.sq2.source="fenj_json.gx_1":this.sq2.source="fenj_json.gx_bg";break;case 3:e?this.sq3.source="fenj_json.gx_1":this.sq3.source="fenj_json.gx_bg";break;case 4:e?this.sq4.source="fenj_json.gx_1":this.sq4.source="fenj_json.gx_bg";break;case 5:e?this.sq5.source="fenj_json.gx_1":this.sq5.source="fenj_json.gx_bg"}},e.prototype.updateRlAward=function(){for(var t=0,e=0,i=0,s=this._itemGridCon.grids;i<s.length;i++){var o=s[i];if(o.itemId>0&&this.isSel(o.uid)){var n=GmGlobal.mc.equipMgr.getEqpCfg(o.itemId);n.qlv<=5?t+=n.qhstone:e+=n.qhstone}}this.mtxt.text=t.toString(),this.tmvp.text=e.toString()},e.prototype.onRonglian=function(){0!=this._selList.length&&(this.hasHighQuality()?MsgBox.confirm("High rarity gear found，Continue or not?",this.doRonglian,null,this):this.doRonglian(),GmGlobal.vmc.mGuide.triggerTarget(this.bfj))},e.prototype.hasHighQuality=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._mc.itemMgr.getItem(i);if(s){var o=GmGlobal.mc.itemMgr.getItemCfg(s.num);if(o&&o.quality>=5)return!0}}return!1},e.prototype.doRonglian=function(){for(var t=[1],e=0,i=this._selList;e<i.length;e++){var s=i[e];t.push(s)}GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_FJ,t,this.addRlEffects,this)},e.prototype.addRlEffects=function(){var t=!0;this._efts=[],this.bfj.touchEnabled=!1;for(var e in this._selImg)this.addEffect(e,t),t=!1},e.prototype.addEffect=function(t,e){void 0===e&&(e=!1);var i=this._selImg[t];if(i){var s="zhuangbeifj",o=ObjectPool.pop(s);o||(o=new MovieClipEx(s)),i.parent.addChild(o),this._efts.push(o);var n=this.itemCon.x+i.x-70,r=this.itemCon.y+i.y-50;o.x=n,o.y=r,e?o.play(1,this.onRlOk,this):o.play(1)}},e.prototype.onRlOk=function(){this.clearSelList(),this.updatePage(),this.updateLst(),this.clearEfts(!1),this.bfj.touchEnabled=!0},e.prototype.clearEfts=function(t){if(void 0===t&&(t=!0),this._efts){for(var e=0;e<this._efts.length;e++){var i=this._efts[e];i&&i.clear(t)}this._efts=[]}},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.clearSelList(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.clearSelList(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.EQUIP_FENJIE&&(t.bindTarget(GuideTargetId.FJ_FJ_BTN,this.bfj,this.bfj.parent.localToGlobal(this.bfj.x,this.bfj.y)),t.bindTarget(GuideTargetId.CLOSE_BTN2,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y)))},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_BAG_FJ)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.close=function(){this._page=1,this._maxPage=1,this.clearSelList(),this.clearEfts(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearItems()},e.ONE_PAGE_NUM=35,e}(UIBase);__reflect(BagFjView.prototype,"BagFjView");var BagHcView=function(t){function e(){var e=t.call(this,"BagHcSkin")||this;return e._hecId=-1,e._selList=[],e._selImgPool=[],e._selImg={},e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.bfj.label="Fuse",this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(20,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.addListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.rmListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updSelItems(),this.updateLst(),this.checkGuide()},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP],2),i={},s=0;s<e.length;s++){var o=e[s],n=this._mc.itemMgr.getItemCfg(o.num),r=this._mc.equipMgr.isJlOrCard(o.id);!r&&n.quality<5&&(i[o.num]?i[o.num]++:i[o.num]=1,t.push(o))}for(var s=0;s<t.length;s++){var o=t[s],h=i[o.num];3>h&&(t.splice(s,1),s--)}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.onTouchItemGrid=function(t){if(0==t.index?GmGlobal.vmc.mGuide.triggerTargetByID(GuideTargetId.HC_SEL1):1==t.index?GmGlobal.vmc.mGuide.triggerTargetByID(GuideTargetId.HC_SEL2):2==t.index&&GmGlobal.vmc.mGuide.triggerTargetByID(GuideTargetId.HC_SEL3),this._selList.length>=3&&-1==this._selList.indexOf(t.uid))return void MsgBox.prompt("Selected 3 Item(s)，Fuse available!");if(!this._selList||this._selList.length<=0)this.setItemSelState(t,!this.isSel(t.uid));else{var e=this._selList[0],i=this._mc.itemMgr.getItem(e);t.itemId==i.num?this.setItemSelState(t,!this.isSel(t.uid)):MsgBox.prompt("Please fuse the gear with the same rarity and name")}},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]);for(var o in this._selImg){var n=this._selImg[o];n&&(n.visible=!1)}for(var r=t;i>r;r++){var h=this._itemList[r];s.push(h);var n=this._selImg[h.id];n&&(n.visible=!0)}this._itemGridCon.setItems(s)}},e.prototype.updSelItems=function(){for(var t=0;3>t;t++){var e=this._selList[t],i=this["item"+t];if(e){var s=this._mc.itemMgr.getItem(e);i.setItem(new Item(s.num,1))}else i.setItem(null)}if(this._selList.length>=3){Utils.setBtnEnable(this.bfj,!0);var o=this._selList[0],n=this._mc.itemMgr.getItem(o),r=this._mc.equipMgr.getHcCfg(n.num);this.item3.setItem(new Item(r.toid,0));var h=r.cost;this.micon.source=this._mc.itemMgr.getItemSicon(h.id),this.mtxt.text=h.num}else Utils.setBtnEnable(this.bfj,!1),this.item3.setItem(null),this.micon.source=this._mc.itemMgr.getItemSicon(ItemID.GOLD),this.mtxt.text="0"},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t];this._selList.length>0&&-1!=this._selList.indexOf(i.uid)?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}},e.prototype.setItemSelState=function(t,e){var i=this._selList.indexOf(t.uid);if(e){if(i>=0)return;this._selList.push(t.uid);var s=this.getSelImg();s.x=t.icon.x+t.icon.width-31,s.y=t.icon.y-10,this.selCon.addChild(s),this._selImg[t.uid]=s}else{if(-1==i)return;this._selList.splice(i,1);var s=this._selImg[t.uid];this.selCon.removeChild(s),this._selImgPool.push(s),delete this._selImg[t.uid]}this.updSelItems()},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._selImg[i];s&&(s.visible=!0,this._selImgPool.push(s),delete this._selImg[i],this.selCon.removeChild(s))}this._selList=[]},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onFj=function(){this.bfj.touchEnabled=!1,this.showQhEft(),GmGlobal.vmc.mGuide.clearFinger()},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("zhuangbeihc"),this._eft.x=this.item3.x+Math.floor(this.item3.width/2)+15,this._eft.y=this.item3.y+Math.floor(this.item3.height/2)-5),this._eft.parent||this.addChild(this._eft),this._eft.visible=!0,this._eft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._eft.visible=!1,this._cc.dataCtl.doAction(ServerActionId.CARD_HC,[2,this._selList[0],this._selList[1],this._selList[2]],this.hcOk,this),this.bfj.touchEnabled=!0,GmGlobal.vmc.mGuide.triggerTarget(this.bfj)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.equipMgr.hcRule)},e.prototype.hcOk=function(){this.clearSelList(),this.updSelItems()},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.EQUIP_HC){var e=this._itemGridCon.grids[0];if(e.itemId){var i=this.itemCon.parent.localToGlobal(this.itemCon.x,this.itemCon.y);t.bindTargetRect(GuideTargetId.HC_SEL1,new egret.Rectangle(i.x,i.y,115,115),null),t.bindTargetRect(GuideTargetId.HC_SEL2,new egret.Rectangle(i.x+130,i.y,115,115),null),t.bindTargetRect(GuideTargetId.HC_SEL3,new egret.Rectangle(i.x+260,i.y,115,115),null),t.bindTarget(GuideTargetId.HC_HC_BTN,this.bfj,this.bfj.parent.localToGlobal(this.bfj.x,this.bfj.y)),t.bindTarget(GuideTargetId.CLOSE_BTN2,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}else t.clearGuide()}},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_BAG_HC)},e.prototype.close=function(){this._eft&&(this._eft.clear(),this._eft=null),this._page=1,this._maxPage=1,this.clearSelList(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(BagHcView.prototype,"BagHcView");var BagManager=function(){function t(){var t={0:0,1:0,2:0,3:0,4:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.BAG,this.redDot)}return t.prototype.getCardLst=function(){for(var t=GmGlobal.mc.itemMgr.getItemListByType([ItemType.CARD]),e=[],i=0;i<t.length;i++){for(var s=t[i],o=GmGlobal.mc.equipMgr.getCardCfg(s.id),n=0;n<e.length;n++){var r=e[n],h=GmGlobal.mc.equipMgr.getCardCfg(r.id);if(o.type<h.type)break}e.splice(n,0,s)}return e},t}();__reflect(BagManager.prototype,"BagManager");var BagMediator=function(){function t(){this._idx=0,GmGlobal.mc.muiMgr.regCmd(ModelID.BAG,CmdType.O_BAG),CmdBus.adListener(CmdType.O_BAG,this.onOpenView,this),CmdBus.adListener(CmdType.C_BAG,this.onCloseView,this),CmdBus.adListener(CmdType.O_BAG_FJ,this.onOpenFjView,this),CmdBus.adListener(CmdType.C_BAG_FJ,this.onCloseFjView,this),CmdBus.adListener(CmdType.O_BAG_HC,this.onOpenHcView,this),CmdBus.adListener(CmdType.C_BAG_HC,this.onCloseHcView,this),CmdBus.adListener(CmdType.O_BAG_ZX,this.onOpenZxView,this),CmdBus.adListener(CmdType.C_BAG_ZX,this.onCloseZxView,this),EventBus.addListener(EventType.M_UPD_CON,this.updateRedDot,this)}return t.prototype.updateRedDot=function(){this.updEqpRedDot(),this.updCardRedDot()
},t.prototype.updCardRedDot=function(){for(var t=GmGlobal.mc.bagMgr,e=t.redDot.childs[4],i=GmGlobal.mc.bagMgr.getCardLst(),s=0;s<i.length;s++){var o=i[s],n=GmGlobal.mc.equipMgr.getCardCfg(o.id);if(2==n.type){var r=o.num>=n.num?1:0;this.setItemRD(e,o.id,r)}}this.checkItemRD(e.childs)},t.prototype.checkItemRD=function(t){for(var e in t){var i=Number(e),s=t[e];0==GmGlobal.mc.itemMgr.getItemNum(i)&&(s.state=0)}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t.prototype.updEqpRedDot=function(){var t=GmGlobal.mc.bagMgr,e=t.redDot.childs[0],i=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP]);i.length>=100?e.state=1:e.state=0},t.prototype.onOpenView=function(t){void 0===t&&(t=0),this._idx=t,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new BagView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._idx)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenFjView=function(){this._fjView||(this._fjView=new BagFjView),this._fjView.isShow||(this._fjView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseFjView=function(){this._fjView&&this._fjView.isShow&&this._fjView.close()},t.prototype.onOpenHcView=function(){this._hcView||(this._hcView=new BagHcView),this._hcView.isShow||(this._hcView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseHcView=function(){this._hcView&&this._hcView.isShow&&this._hcView.close()},t.prototype.onOpenZxView=function(t){this._zxView||(this._zxView=new ZixuanView),this._zxView.isShow||(this._zxView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._zxView.setId(t)},t.prototype.onCloseZxView=function(){this._zxView&&this._zxView.isShow&&this._zxView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._fjView&&(this._fjView.destroy(),this._fjView=null),this._hcView&&(this._hcView.destroy(),this._hcView=null),this._zxView&&!this._zxView.isShow&&(this._zxView.destroy(),this._zxView=null),!0):!1:!0},t}();__reflect(BagMediator.prototype,"BagMediator",["IMediator"]);var BagView=function(t){function e(){var e=t.call(this,"BagViewSkin")||this;return e._tabIndex=-1,e._page=1,e.ONE_PAGE_NUM=40,e._maxPage=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bPageUp.sound="ui_fenye",this.bPageDown.sound="ui_fenye",this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(this.ONE_PAGE_NUM,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.modelId=ModelID.BAG},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),this.bhc.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),EventBus.addListener(EventType.M_UPD_CON,this.onContainerUpdate,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),this.bhc.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),EventBus.rmListener(EventType.M_UPD_CON,this.onContainerUpdate,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.checkGuide()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(void 0===t&&(t=0),t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t,this._page=1,this.updatePage(),this.onContainerUpdate()}},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onContainerUpdate=function(){0==this._tabIndex?this._itemList=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP]):1==this._tabIndex?this._itemList=GmGlobal.mc.itemMgr.getItemListByType([ItemType.QH,ItemType.XINGSHI]):2==this._tabIndex?this._itemList=GmGlobal.mc.itemMgr.getItemListByType([ItemType.XIAOH,ItemType.SHENGJI]):3==this._tabIndex?this._itemList=GmGlobal.mc.itemMgr.getItemListByType([ItemType.CIAOL]):4==this._tabIndex&&(this._itemList=GmGlobal.mc.bagMgr.getCardLst()),this._maxPage=Math.max(Math.ceil(this._itemList.length/this.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.bfj.visible=0==this._tabIndex?!0:!1,this.bhc.visible=0==this._tabIndex?!0:!1,this.updatePage(),this.updateGrids(),this.updateRedDot(),this.validateNow()},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*this.ONE_PAGE_NUM,e=t+this.ONE_PAGE_NUM;e>=this._itemList.length&&(e=this._itemList.length);for(var i=GmGlobal.mc.itemMgr.getContainer(),s=[],o=[],n=t;e>n;n++){var r=this._itemList[n];if(s.push(i.items[r.id]),0==this._tabIndex){var h=GmGlobal.mc.equipMgr.getJlLv(r.id);o.push(h)}}this._itemGridCon.setItems(s,!1,"",o),this.updItemRedDot()}},e.prototype.updItemRedDot=function(){for(var t=GmGlobal.mc.bagMgr.redDot.childs[4],e=0,i=this._itemGridCon.grids;e<i.length;e++){var s=i[e];if(t.childs){var o=t.childs[s.itemId];if(o&&1==o.state){var n=this.getRDPoint(s.icon);RedDotView.addRedDot(s.icon,this.redDotCon,"bag",n.x,n.y,"com_json.com_rdd")}else RedDotView.removeRedDot(s.icon)}else RedDotView.removeRedDot(s.icon)}},e.prototype.updateRedDot=function(){for(var t=0;5>t;t++){var e=GmGlobal.mc.bagMgr.redDot.childs[t],i=this.tableBgCon.getChildAt(t);if(1==e.state){var s=this.tableBgCon.x+110*(t+1)+5*t-20;RedDotView.addRedDot(i,this.redDotCon,"bag",s,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(i)}},e.prototype.getRDPoint=function(t){var e=t.parent.localToGlobal(t.x,t.y);return e.x-=this.x-t.width+20,e.y-=this.y+5,e},e.prototype.onFj=function(){GmGlobal.vmc.mGuide.triggerTarget(this.bfj),CmdBus.doCmd(CmdType.O_BAG_FJ)},e.prototype.onHc=function(){GmGlobal.vmc.mGuide.triggerTarget(this.bhc),CmdBus.doCmd(CmdType.O_BAG_HC)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&(t.guideData.id==GuideID.EQUIP_HC&&(t.bindTarget(GuideTargetId.BAG_HC_BTN,this.bhc,this.bhc.parent.localToGlobal(this.bhc.x,this.bhc.y)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))),t.guideData.id==GuideID.EQUIP_FENJIE&&(t.bindTarget(GuideTargetId.BAG_FJ_BTN,this.bfj,this.bfj.parent.localToGlobal(this.bfj.x,this.bfj.y)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))))},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_BAG)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,RedDotView.removeRedDotByGroup("bag"),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("fenj_json")},e}(UIBase);__reflect(BagView.prototype,"BagView");var ItemHcView=function(t){function e(){var e=t.call(this,"ItemHcSkin")||this;e._jlIds=[],e._num=1,e._maxNum=1,e._jlIds=[];for(var i=0;5>i;i++)e._jlIds.push(10201+i);return e}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.numTxt.restrict="0-9"},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bJia.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJia,this),this.bJian.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJian,this),this.bCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.numTxt.addEventListener(egret.Event.CHANGE,this.onNumChange,this)},e.prototype.rmEvts=function(){this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bJia.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJia,this),this.bJian.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJian,this),this.bCancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.numTxt.removeEventListener(egret.Event.CHANGE,this.onNumChange,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.setItem=function(t){this._item=t;var e=GmGlobal.mc.itemMgr;this._maxNum=e.getItemNum(t)||1;var i=GmGlobal.mc.itemMgr.getItemCfg(t);4==i.enabled?(this.itemName.text="Fuse quantity",this.bBuy.label="Fuse",-1==this._jlIds.indexOf(t)?this._maxNum=Math.floor(this._maxNum/2)||1:this._maxNum=Math.floor(this._maxNum/5)||1):i.type==ItemType.XINGSHI&&(this.itemName.text="Disassemble Quantity",this.bBuy.label="Disassemble"),this._num=this._maxNum,this.updateNumTxt()},e.prototype.onJia=function(){GmGlobal.vmc.mGuide.triggerTarget(this.bJia),this._num++,this._num>this._maxNum&&(this._num=this._maxNum),this.updateNumTxt()},e.prototype.onJian=function(){this._num--,this._num<1&&(this._num=1),this.updateNumTxt()},e.prototype.onNumChange=function(){this._num=Number(this.numTxt.text),0==this._num?(this._num=1,this.numTxt.text=this._num.toString()):this._num>this._maxNum&&(this._num=this._maxNum,this.numTxt.text=this._num.toString())},e.prototype.updateNumTxt=function(){this.numTxt.text=this._num.toString()},e.prototype.onCs=function(){var t=GmGlobal.mc.itemMgr.getItemCfg(this._item);4==t.enabled?GmGlobal.cc.dataCtl.doAction(ServerActionId.CARD_HC,[1,this._item,this._num],this.close,this,this.close):t.type==ItemType.XINGSHI&&GmGlobal.cc.dataCtl.doAction(ServerActionId.XINGSHI_FJ,[this._item,this._num],this.close,this,this.close)},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(ItemHcView.prototype,"ItemHcView");var CDText=function(){function t(){this._timerId=0,this._cds=[]}return t.getInstence=function(){return this._instence||(this._instence=new t),this._instence},t.prototype.addCD=function(t,e,i,s,o,n,r){void 0===i&&(i=""),void 0===s&&(s=null),void 0===o&&(o=""),void 0===n&&(n=null),void 0===r&&(r=null),t.text=i+Utils.formatTime(e,s||"h:m:s")+o;for(var h=0;h<this._cds.length;h++){var a=this._cds[h];if(a.txt==t)return void(a.t=egret.getTimer()+1e3*e)}this._cds.push({txt:t,t:egret.getTimer()+1e3*e,c:n,ct:r,fmt:s,pstr:i,lstr:o}),1==this._cds.length&&this.startTimer()},t.prototype.rmCD=function(t){for(var e=0;e<this._cds.length;e++){var i=this._cds[e];if(i.txt==t)return void this._cds.splice(e,1)}},t.prototype.startTimer=function(){0==this._timerId&&(this._timerId=egret.setInterval(this.onTimer,this,100))},t.prototype.onTimer=function(){for(var t=egret.getTimer(),e=0,i=0;i<this._cds.length;i++){var s=this._cds[i];e=Math.ceil((s.t-t)/1e3),0>e&&(e=0),s.txt.text=s.pstr+Utils.formatTime(e,s.fmt||"h:m:s")+s.lstr,0==e&&(this._cds.splice(i,1),i--,s.c&&s.ct&&s.c.call(s.ct))}0==this._cds.length&&this.stopTimer()},t.prototype.stopTimer=function(){0!=this._timerId&&(egret.clearInterval(this._timerId),this._timerId=0)},t}();__reflect(CDText.prototype,"CDText");var ZixuanItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.index=this.data.idx,this.icon.setItem(this.data.item),this.icon.enableTip(!0),this.isel.source=this.data.state?"com_json.sel_1":"com_json.sel_0"},e}(eui.ItemRenderer);__reflect(ZixuanItem.prototype,"ZixuanItem");var ZixuanView=function(t){function e(){var e=t.call(this,"ZixuanSkin")||this;return e._sidx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ZixuanItemSkin",this.itemList.itemRenderer=ZixuanItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setId=function(t){var e=this._mc.equipMgr.getZxCfg(t);if(e){this._id=t,1==e.type?this.tTit.text="Card Selection":2==e.type?this.tTit.text="Gear Selection":4==e.type?this.tTit.text="Head Selection":this.tTit.text="Item Selection",this._array.removeAll(),this.scroll.stopAnimation(),this.scroll.viewport.scrollV=0;for(var i=e.ids,s=0;s<i.length;s++){var o=(this._array.getItemAt(s),i[s]),n={item:new Item(o.id,o.num),state:!1,idx:s+1};this._array.addItem(n)}this.selGrid(0)}},e.prototype.selGrid=function(t){if(t!=this._sidx){if(-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.state=!1,this._array.itemUpdated(e)}var i=this._array.getItemAt(t);i.state=!0,this._array.itemUpdated(i),this._sidx=t}},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent,i=e.index-1;if(i==this._sidx)return;this.selGrid(i)}},e.prototype.onOk=function(){var t=this._array.getItemAt(this._sidx);this._cc.dataCtl.doAction(ServerActionId.CARD_HC,[7,this._id,t.item.id],this.onZxOk,this)},e.prototype.onZxOk=function(){var t=this._mc.itemMgr.getItemNum(this._id);0>=t&&this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_BAG_ZX)},e.prototype.close=function(){if(-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.state=!1,this._array.itemUpdated(e)}this._sidx=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(ZixuanView.prototype,"ZixuanView");var BaowuAtrView=function(t){function e(){var e=t.call(this,"BaowuAtrSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.bLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),EventBus.addListener(EventType.M_BAOWU,this.updUi,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.bLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),EventBus.rmListener(EventType.M_BAOWU,this.updUi,this)},e.prototype.setData=function(t){this._qid=t[0];var e=t[1];this._idx=this._mc.baowuMgr.getIdx(e),this.updUi()},e.prototype.updUi=function(){var t=this._mc.baowuMgr.getLstId(this._qid,this._idx),e=this._mc.baowuMgr.getInfo(t);if(e){var i=this._mc.baowuMgr.getCfgById(e.id);this.txt.text=i.name,this.tlv.text="+"+e.lv,this.idz.source="baowu_json.bw_dz"+(3-i.qid),this.icon.source=this._mc.baowuMgr.getBwIcon(e.id);for(var s=0;15>s;s++){var o=this["ix"+s];s<e.slv?o.source="com_json.bw_x1":o.source="com_json.bw_x0"}this.tts.textFlow=TextFormat.parser.parse(i.txt),this.tdes.textFlow=TextFormat.parser.parse(i.des);var n=i.upCfgs[e.lv-1];n||(n=i.upCfgs[e.lv]);var r=i.upCfgs[e.lv];r||(r=i.upCfgs[e.lv-1]);var h="";for(var a in n.atrs){var l=this._mc.heroMgr.isAddJia(a);h+=l?this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  +"+n.atrs[a],2844323)+"\n":this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  "+n.atrs[a],2844323)+"\n"}var c=this.tatr0;c.textFlow=TextFormat.parser.parser(h);var d="";for(var a in r.atrs){var l=this._mc.heroMgr.isAddJia(a);d+=l?this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  +"+r.atrs[a],2844323)+"\n":this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  "+r.atrs[a],2844323)+"\n"}var p=this.tatr1;p.textFlow=TextFormat.parser.parser(d);var u=i.starCfgs[e.slv],m=i.starCfgs[e.slv+1];m||(m=i.starCfgs[e.slv]);var _="";for(var a in u.atrs){var l=this._mc.heroMgr.isAddJia(a);_+=l?this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  +"+u.atrs[a]+"%",2844323)+"\n":this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  "+u.atrs[a]+"%",2844323)+"\n"}var g=this.txatr0;g.textFlow=TextFormat.parser.parser(_);var f="";for(var a in m.atrs){var l=this._mc.heroMgr.isAddJia(a);f+=l?this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  +"+m.atrs[a]+"%",2844323)+"\n":this._mc.heroMgr.getAtrName(a)+TextFormat.setColor("  "+m.atrs[a]+"%",2844323)+"\n"}var v=this.txatr1;v.textFlow=TextFormat.parser.parser(f);var y=n.items;e.lv%10!=0?(this.bup.skinName="ComBtnSkinY",this.bup.label="LV UP",Utils.setBtnEnable(this.bup,!0)):e.slv>=15?(this.bup.skinName="ComBtnSkinB",this.bup.label="Max Stars",Utils.setBtnEnable(this.bup,!1)):(Utils.setBtnEnable(this.bup,!0),Math.floor(e.lv/10)==e.slv?(this.bup.skinName="ComBtnSkinY",this.bup.label="LV UP"):(this.bup.skinName="ComBtnSkinB",this.bup.label="Star up",y=u.items)),this._itemGridCon&&this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(y.length,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,this._itemGridCon.setItems(y,!0)}this.setBtnState()},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onLeft=function(){if(this._idx--,this._idx<0)if(this._qid>=3)this._qid=3,this._idx=0;else{this._qid++;var t=this._mc.baowuMgr.getQInfos(this._qid);this._idx=t.length-1}var e=this._mc.baowuMgr.hasLJhItem(this._qid,this._idx+1);this._idx=e.idx,this._qid=e.qid,this.updUi()},e.prototype.onRight=function(){this._idx++;var t=this._mc.baowuMgr.getQInfos(this._qid);this._idx>=t.length&&(this._qid<=1?(this._qid=1,this._idx=t.length-1):(this._qid--,this._idx=0));var e=this._mc.baowuMgr.hasRJhItem(this._qid,this._idx-1);this._idx=e.idx,this._qid=e.qid,this.updUi()},e.prototype.setBtnState=function(){var t=this._mc.baowuMgr.hasLJhItem(this._qid,this._idx);Utils.setBtnEnable(this.bLeft,t);var e=this._mc.baowuMgr.hasRJhItem(this._qid,this._idx);Utils.setBtnEnable(this.bRight,e)},e.prototype.onUp=function(){this.bup.touchEnabled=!1,this.showUpEft()},e.prototype.showUpEft=function(){this._eft||(this._eft=new MovieClipEx("chuanbao"),this._eft.x=this.idz.x+Math.floor(this.idz.width/2),this._eft.y=this.idz.y+Math.floor(this.idz.height/2)),this._eft.parent||this.addChildAt(this._eft,this.idz.parent.getChildIndex(this.idz)),this._eft.visible=!0,this._eft.play(1,this.upOk,this)},e.prototype.upOk=function(){this._eft.visible=!1;var t=this._mc.baowuMgr.getLstId(this._qid,this._idx),e=this._mc.baowuMgr.getInfo(t),i=0;e.lv%10==0&&Math.floor(e.lv/10)!=e.slv&&(i=1),this._cc.dataCtl.doAction(ServerActionId.BAOWU_UP,[i,e.id]),this.bup.touchEnabled=!0},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_BAOWU_ATR)},e.prototype.close=function(){t.prototype.close.call(this),this.clearItems(),this._eft&&this._eft.clear()},e}(UIBase);__reflect(BaowuAtrView.prototype,"BaowuAtrView");var BaowuController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_BAOWU_INFO,this.onUpdOne,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_BAOWU_INFOS,this.onUpdLst,this)}return t.prototype.onUpdOne=function(t){var e=t.data.data,i=GmGlobal.mc.baowuMgr,s=new BaowuData;s.id=e.id,s.lv=e.lv,s.slv=e.slv,i.updData(s);var o=i.getCfgById(e.id);EventBus.dispatchEvt(EventType.M_BAOWU,o.qid)},t.prototype.onUpdLst=function(t){var e=GmGlobal.mc.baowuMgr,i=t.data.data;for(var s in i)e.updData(i[s]);EventBus.dispatchEvt(EventType.M_BAOWU)},t}();__reflect(BaowuController.prototype,"BaowuController");var BaowuData=function(){function t(){this.lv=0,this.slv=0}return t}();__reflect(BaowuData.prototype,"BaowuData");var BaowuItem=function(t){function e(){var e=t.call(this)||this;return e.stars=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data,e=GmGlobal.mc.baowuMgr,i=e.getCfgById(t.id);if(this.txt.text=i.name,this.tlv.text="+"+t.lv,t.lv)this.tlv.visible=!0,this.bjh.visible=!1;else{this.tlv.visible=!1,this.bjh.visible=!0;var s=i.hcItem,o=GmGlobal.mc.itemMgr.getItemNum(s.id),n=o>=s.num?!0:!1;Utils.setBtnEnable(this.bjh,n)}this.idz.source="baowu_json.bw_dz"+(3-i.qid),this.icon.source=e.getBwIcon(t.id);for(var r=0;15>r;r++){var h=this["ix"+r];t.lv?h.visible=!0:h.visible=!1,r<t.slv?h.source="com_json.bw_x1":h.source="com_json.bw_x0"}var a=e.redDot,l=a.childs[t.id];this.rd.visible=1==l.state?!0:!1},e}(eui.ItemRenderer);__reflect(BaowuItem.prototype,"BaowuItem");var BaowuJhView=function(t){function e(){var e=t.call(this,"HuobanJhSkin")||this;return e.touchEnabled=!1,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),egret.startTick(this.onTick,this)},e.prototype.setId=function(t){var e=GmGlobal.mc.baowuMgr.getCfgById(t);e&&(this.iconK.source="item_json.q_"+(e.qid+2),this.icon.source=GmGlobal.mc.baowuMgr.getBwIcon(t))},e.prototype.onTick=function(t){return this.lightCon.rotation+=1,!0},e.prototype.close=function(){egret.stopTick(this.onTick,this),t.prototype.close.call(this)},e}(UIBase);__reflect(BaowuJhView.prototype,"BaowuJhView");var BaowuLstItem=function(t){function e(){var e=t.call(this)||this;return e._hei=325,e._lNum=3,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._array=new eui.ArrayCollection,this.itemCon.dataProvider=this._array,this.itemCon.itemRendererSkinName="BaowuItemSkin",this.itemCon.itemRenderer=BaowuItem},e.prototype.dataChanged=function(){var t=GmGlobal.mc.baowuMgr;this.idx=this.data.idx;var e=this.data.lst,i=GmGlobal.mc.baowuMgr.getJhNum(4-this.idx);this.txt.text="LV."+t.names[3-this.idx]+"("+i+"/"+t.nums[3-this.idx]+")";var s=Math.ceil(e.length/this._lNum);this.itemCon.height=this._hei*s+10*(s-1),this._array.replaceAll(e),this.itemCon.validateNow(),this.height=this.itemCon.height+40},e}(eui.ItemRenderer);__reflect(BaowuLstItem.prototype,"BaowuLstItem");var BaowuManager=function(){function t(){this._cfg={},this.names=[],this.nums=[],this.infos={},GmGlobal.mc.regUnzipCfg("c_baowu.json",this.initCfg,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.CHUANBAO,this.redDot)}return t.prototype.initCfg=function(t){this._cfg=t.cfg,this.names=t.names,this.nums=t.nums},t.prototype.getCfgById=function(t){return this._cfg[t]},t.prototype.updData=function(t){this.infos[t.id]=t},t.prototype.getQInfos=function(t){for(var e=this.getIdsByQid(t),i=[],s=0;s<e.length;s++){var o=e[s],n=this.getInfo(o.id);o.lv=n.lv||0,o.slv=n.slv||0,i.push(o)}return i},t.prototype.getIdx=function(t){for(var e=this.getCfgById(t),i=this.getQInfos(e.qid),s=-1,o=0;o<i.length;o++){var n=i[o];if(t==n.id){s=o;break}}return s},t.prototype.getInfo=function(t){return this.infos[t]||{}},t.prototype.getIdBySpId=function(t){var e=0;for(var i in this._cfg){var s=this._cfg[i],o=s.hcItem;o.id==t&&(e=Number(i))}return e},t.prototype.getBwIcon=function(t){var e=this.getCfgById(t);return GmConst.BAOWU_DIR+e.icon+".png"},t.prototype.getIdsByQid=function(t){var e=[];for(var i in this._cfg){var s=this._cfg[i];if(t==s.qid){var o=new BaowuData;o.id=s.id,e.push(o)}}return e},t.prototype.getJhNum=function(t){for(var e=0,i=this.getIdsByQid(t),s=0;s<i.length;s++){var o=this.getInfo(i[s].id);o.lv>0&&e++}return e},t.prototype.getLstId=function(t,e){var i=this.getIdsByQid(t),s=i[e].id;return s},t.prototype.hasLJhItem=function(t,e){for(var i=this.getQInfos(t),s=e-1;s>=0;s--){var o=i[s];if(o.lv>0)return{qid:t,idx:s}}for(var s=t;3>s;s++)for(var n=this.getQInfos(s+1),r=n.length-1;r>=0;r--){var o=n[r];if(o.lv>0)return{qid:s+1,idx:r}}return null},t.prototype.hasRJhItem=function(t,e){for(var i=this.getQInfos(t),s=e+1;s<i.length;s++){var o=i[s];if(o.lv>0)return{qid:t,idx:s}}for(var s=t-1;s>0;s--)for(var n=this.getQInfos(s),r=0;r<n.length;r++){var o=n[r];if(o.lv>0)return{qid:s,idx:r}}return null},t}();__reflect(BaowuManager.prototype,"BaowuManager");var BaowuMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.CHUANBAO,CmdType.O_BAOWU),CmdBus.adListener(CmdType.O_BAOWU,this.onOpenView,this),CmdBus.adListener(CmdType.C_BAOWU,this.onCloseView,this),CmdBus.adListener(CmdType.O_BAOWU_ATR,this.onOpenZrView,this),CmdBus.adListener(CmdType.C_BAOWU_ATR,this.onCloseZrView,this),CmdBus.adListener(CmdType.O_BAOWU_JH,this.onOpenJhView,this),CmdBus.adListener(CmdType.C_BAOWU_JH,this.onCloseJhView,this),EventBus.addListener(EventType.M_UPD_CON,this.updateRedDot,this),EventBus.addListener(EventType.M_BAOWU,this.updateRedDot,this)}return t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.baowuMgr,e=t.redDot,i=0;3>i;i++){var s=t.getQInfos(3-i);if(s&&!Utils.isEmptyObj(s))for(var o=0;o<s.length;o++){var n=s[o],r=t.getCfgById(n.id),h=1;if(n.lv<=0){var a=r.hcItem,l=GmGlobal.mc.itemMgr.getItemNum(a.id);l<a.num&&(h=0)}else if(n.slv>=15)h=0;else{var c=r.upCfgs[n.lv-1];c||(c=r.upCfgs[n.lv]);var d=r.starCfgs[n.slv],p=c.items;n.lv%10==0&&Math.floor(n.lv/10)!=n.slv&&d&&(p=d.items);for(var u=0;u<p.length;u++){var m=p[u],_=GmGlobal.mc.itemMgr.getItemNum(m.id);if(_<m.num){h=0;break}}}this.setItemRD(e,r.id,h)}}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t.prototype.onOpenView=function(){GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.CHUANBAO,!0)&&this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new BaowuView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenZrView=function(t){this._atrview||(this._atrview=new BaowuAtrView),this._atrview.isShow||(this._atrview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._atrview.setData(t)},t.prototype.onCloseZrView=function(){this._atrview&&this._atrview.isShow&&this._atrview.close()},t.prototype.onOpenJhView=function(t){this._jhview||(this._jhview=new BaowuJhView),this._jhview.isShow||(this._jhview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._jhview.setId(t)},t.prototype.onCloseJhView=function(){this._jhview&&this._jhview.isShow&&this._jhview.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._atrview&&(this._atrview.destroy(),this._atrview=null),!0):!1:!0},t}();__reflect(BaowuMediator.prototype,"BaowuMediator",["IMediator"]);var BaowuView=function(t){function e(){var e=t.call(this,"BaowuSkin")||this;return e._jhId=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_BAOWU,this.updOne,this),EventBus.addListener(EventType.M_UPD_CON,this.updLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_BAOWU,this.updOne,this),EventBus.rmListener(EventType.M_UPD_CON,this.updLst,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="BaowuLstItemSkin",this.itemList.itemRenderer=BaowuLstItem,this.initLst()},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updLst(),this.scoll.viewport.scrollV=0,this.itemList.validateNow()},e.prototype.initLst=function(){for(var t=0;3>t;t++){var e=this._mc.baowuMgr.getIdsByQid(3-t),i={lst:e,idx:t+1};this._array.addItem(i)}},e.prototype.updLst=function(){for(var t=0;3>t;t++){var e=this._array.getItemAt(t),i=this._mc.baowuMgr.getQInfos(3-t);e.lst=i,this._array.itemUpdated(e)}},e.prototype.updOne=function(t){var e=t.data;if(e){var i=this._array.getItemAt(3-e),s=this._mc.baowuMgr.getQInfos(e);i.lst=s,this._array.itemUpdated(i)}},e.prototype.onTouchList=function(t){if(t.target.parent.parent.parent.parent==this.itemList){var e=t.target.parent.parent.parent,i=t.target.parent,s=e.data.idx,o=i.data;if("icon"==t.target.name){if(o.lv<=0)return;CmdBus.doCmd(CmdType.O_BAOWU_ATR,[4-s,o.id])}else if("btn"==t.target.name){this._jhId=o.id;var n=this._mc.baowuMgr.getCfgById(o.id);GmGlobal.cc.dataCtl.doAction(ServerActionId.CARD_HC,[3,n.hcItem.id],this.BwHcOk,this)}}},e.prototype.BwHcOk=function(){this._jhId&&CmdBus.doCmd(CmdType.O_BAOWU_JH,this._jhId)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_BAOWU)},e.prototype.close=function(){t.prototype.close.call(this),this._jhId=0},e.prototype.destroy=function(){RES.destroyRes("bw_bg_jpg"),RES.destroyRes("baowu_json"),t.prototype.destroy.call(this)},e}(UIBase);__reflect(BaowuView.prototype,"BaowuView");var CatController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_CAT,this.onUpdInfo,this)}return t.prototype.onUpdInfo=function(t){var e=t.data.data,i=GmGlobal.mc.catMgr;i.cnt=e.c||0,EventBus.dispatchEvt(EventType.M_CAT)},t}();__reflect(CatController.prototype,"CatController");var CatItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CatItemSkin",e}return __extends(e,t),e}(eui.Component);__reflect(CatItem.prototype,"CatItem");var CatManager=function(){function t(){this.rCd=0,this.cnt=0,GmGlobal.mc.regUnzipCfg("c_cat.json",this.initCfg,this)
}return t.prototype.initCfg=function(t){this.cfg=t},t}();__reflect(CatManager.prototype,"CatManager");var CatMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.CAT,CmdType.O_CAT),CmdBus.adListener(CmdType.O_CAT,this.onOpenView,this),CmdBus.adListener(CmdType.C_CAT,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.updateIcon=function(){CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.CAT,"mui_json.mui_b_zcm",1,6)},t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new CatView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(CatMediator.prototype,"CatMediator",["IMediator"]);var CatView=function(t){function e(){var e=t.call(this,"CatSkin")||this;return e._oneAwd=[],e._reqOne=-1,e._efts=[],e._space=.5,e._iTimer=0,e._time=0,e._type=0,e._index=0,e._timer=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.iScoll.horizontalScrollBar&&(this.iScoll.horizontalScrollBar.autoVisibility=!1),this.tWeight.textFlow=new Array({text:"Chance",style:{underline:!0,textColor:15657314}})},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bOne.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.bTen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTen,this),this.tWeight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onWeight,this),EventBus.addListener(EventType.M_CAT,this.updMs,this),EventBus.addListener(EventType.S_CLOSE,this.onClose,this),EventBus.addListener(EventType.M_CHATMSG_UPD,this.updTxt,this),this._cc.itemCtl.bindItemCallback(10091,this.updatePrice,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bOne.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.bTen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTen,this),this.tWeight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onWeight,this),EventBus.rmListener(EventType.M_CAT,this.updMs,this),EventBus.rmListener(EventType.S_CLOSE,this.onClose,this),EventBus.rmListener(EventType.M_CHATMSG_UPD,this.updTxt,this),this._cc.itemCtl.removeItemCallback(10091,this.updatePrice,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=this._mc.catMgr.rCd-GmGlobal.getServerTime();0>=i?GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.CAT_LST,null,this.onCatRet,this):this.updui(),this.num0.text=this._mc.catMgr.cfg.oneprice,this.num1.text=this._mc.catMgr.cfg.tenprice,this.updMs(),this.allItemUnvis(),this.updTxt(null),this.updItems(),this.alphaShow(),this.updatePrice()},e.prototype.updatePrice=function(){var t=this._mc.catMgr.cfg,e=this._mc.itemMgr.getItemNum(10091);e>=t.catscroll1?(this.icon0.source=this._mc.itemMgr.getItemSicon(10091),this.num0.text=t.catscroll1):(this.icon0.source=this._mc.itemMgr.getItemSicon(ItemID.SHUIJING),this.num0.text=t.oneprice),e>=t.catscroll10?(this.icon1.source=this._mc.itemMgr.getItemSicon(10091),this.num1.text=t.catscroll10):(this.icon1.source=this._mc.itemMgr.getItemSicon(ItemID.SHUIJING),this.num1.text=t.tenprice)},e.prototype.updItems=function(){var t=this._mc.catMgr.cfg.items;t=t.concat(t.slice(0,5));for(var e=[],i=0;i<t.length;i++){var s=new Item(t[i],0);e.push(s)}this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(e,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.itemCon),this.itemCon.width=115*e.length+10*(e.length-1),this._iTimer||(this._iTimer=egret.setInterval(this.onScoll,this,0))},e.prototype.onScoll=function(){this.itemCon.x-=this._space,this.itemCon.x<=-this.itemCon.width+this.iScoll.width&&(this.itemCon.x=0)},e.prototype.updMs=function(){var t=this._mc.catMgr.cfg.num;this.tms.textFlow=TextFormat.parser.parser("Make "+TextFormat.setColor(t,15657314)+" draws to get the rare item of the round:"+TextFormat.setColor(this._mc.catMgr.cnt.toString(),15657314)+"/"+t)},e.prototype.onCatRet=function(t){this._mc.catMgr.infos=[];for(var e in t)this._mc.catMgr.infos.push(t[e]);this._mc.catMgr.rCd=GmGlobal.getServerTime()+Utils.getDayHasTime()%3600,this.updui()},e.prototype.updTxt=function(t){if(t){var e=t.data;if(e.ch!=ChatChannel.CAT)return}var i=GmGlobal.mc.chatMgr,s=i.getChatMsg(ChatChannel.CAT),o="";for(var n in s){var r=s[n];o+=r.content+"\n"}o=Utils.replaceColorCode(o),this.txt.textFlow=TextFormat.parser.parser(o),this.txt.height>=this.scoll.height&&(this.scoll.viewport.scrollV=this.txt.height-this.scoll.height)},e.prototype.updui=function(){var t=this._mc.catMgr.infos;this.clearEfts();for(var e=0;e<t.length;e++){var i=t[e],s=this["item"+e];if(s.icon.setItem(new Item(i.id,i.num)),s.itag.visible=1==i.good?!0:!1,s.icon.enableTip(!0),i.good){var o=new MovieClipEx("daojutx");s.parent.addChild(o),o.x=s.x+Math.floor(s.width/2),o.y=s.y+Math.floor(s.height/2)-5,o.play(),this._efts.push(o)}}var n=this._mc.catMgr.rCd-GmGlobal.getServerTime();n>0?(this.tcd.visible=!0,CDText.getInstence().addCD(this.tcd,n,"Treasure Refresh Countdown：","m:s","",this.onTimeOut,this)):this.onTimeOut()},e.prototype.clearEfts=function(){for(var t=0;t<this._efts.length;t++){var e=this._efts[t];e&&e.clear()}this._efts=[]},e.prototype.onTimeOut=function(){GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.CAT_LST,null,this.onCatRet,this)},e.prototype.onOne=function(){this._type=0,this._reqOne=-1,this._index=0,this.reqCj()},e.prototype.onTen=function(){this._type=1,this.reqCj()},e.prototype.reqCj=function(){var t=this._mc.catMgr.cfg,e=this._mc.itemMgr.getItemNum(10091),i=0;this._type?e<t.catscroll10&&(i=this._mc.catMgr.cfg.tenprice):e<t.catscroll1&&(i=this._mc.catMgr.cfg.oneprice);var s=this._mc.itemMgr.getItemNum(ItemID.SHUIJING);i>s?ItemLackTips.instance().shuijTips():(this.setBtnTouch(!1),this._time=0,this._timer||(this._timer=egret.setInterval(this.onTimer,this,150)))},e.prototype.onTimer=function(){this._time++,0==this._type?(this.oneItemVis(this._index),this._index++,this._index>=12&&(this._index=0)):this.someItemVis(this._time);var t=1,e=12;if(this._type&&(e=12,t=10),this._time>=e)if(this._type)egret.clearInterval(this._timer),this._timer=0,this._time=0,this.setBtnTouch(!0),this.allItemUnvis(),this._cc.dataCtl.reqJsonData(JsonReqId.CAT_CJ,[t],this.onCjRet,this);else if(-1==this._reqOne&&(this._reqOne=-2,this._cc.dataCtl.reqJsonData(JsonReqId.CAT_CJ,[t],this.onOneCjRet,this)),this._index==this._reqOne&&this._reqOne>=0){egret.clearInterval(this._timer),this.oneItemVis(this._index),this._timer=0;var i=this;setTimeout(function(){i.showAwd()},500)}},e.prototype.showAwd=function(){this.setBtnTouch(!0),this.allItemUnvis(),this._time=0,AwardTipView.showAward(this._oneAwd)},e.prototype.onOneCjRet=function(t){this._oneAwd=[];for(var e in t){var i=t[e];for(var s in i){var o=new Item(Number(s),i[s]);this._oneAwd.push(o)}}for(var n=0;n<this._mc.catMgr.infos.length;n++){var i=this._mc.catMgr.infos[n],o=this._oneAwd[0];if(o.id==i.id&&o.num==i.num){this._reqOne=n;break}}-2==this._reqOne&&(this._reqOne=0,this.onTimeOut())},e.prototype.onCjRet=function(t){var e=[];for(var i in t){var s=t[i];for(var o in s){var n=new Item(Number(o),s[o]);e.push(n)}}AwardTipView.showAward(e)},e.prototype.oneItemVis=function(t){for(var e=0;12>e;e++){var i=this["item"+e];e==t?i.ixzk.visible=!0:i.ixzk.visible=!1}},e.prototype.someItemVis=function(t){for(var e=0;12>e;e++){var i=e%2,s=this["item"+e],o=t%2==0?!0:!1;i?s.ixzk.visible=o:s.ixzk.visible=!o}},e.prototype.allItemUnvis=function(){for(var t=0;12>t;t++){var e=this["item"+t];e.ixzk.visible=!1}},e.prototype.setBtnTouch=function(t){Utils.setBtnEnable(this.bOne,t),Utils.setBtnEnable(this.bTen,t)},e.prototype.clearItem=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onWeight=function(){CmdBus.doCmd(CmdType.O_WEIGHT,this._mc.catMgr.infos)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_CAT)},e.prototype.close=function(){this.clearItem(),this.clearEfts(),this._timer&&(egret.clearInterval(this._timer),this._timer=0,this._time=0),this._iTimer&&(egret.clearInterval(this._iTimer),this._iTimer=0),CDText.getInstence().rmCD(this.tcd),this.setBtnTouch(!0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("cat_bg_jpg"),RES.destroyRes("cat_tag_png")},e}(UIBase);__reflect(CatView.prototype,"CatView");var ChainType;!function(t){t[t.LAHEI=1]="LAHEI"}(ChainType||(ChainType={}));var ChatChannel=function(){function t(){}return t.WORLD=104,t.LABA=102,t.PROMPT=99,t.HUOD_CJ=103,t.CAT=105,t.KUAFU=100,t.LHJ_QD_LOG=106,t.LHJ_KFQD_LOG=107,t.SYS=1e3,t.ALL=1001,t}();__reflect(ChatChannel.prototype,"ChatChannel");var ChatController=function(){function t(){this._worldSendTime=0,this._kuafuSendTime=0,this._msgCheckNum=0;var t=GmGlobal.server;t.regUpdCb(MsgID.UPD_CHAT_MSG,this.onUpdateMsg,this),t.regUpdCb(MsgID.UPD_CHATCODE,this.onUpdateCode,this),t.regUpdCb(MsgID.DEL_CHATMSG,this.onDelMsg,this),EventBus.addListener(EventType.GAME_READY,this.gameReady,this)}return t.prototype.gameReady=function(){EventBus.rmListener(EventType.GAME_READY,this.gameReady,this),GmGlobal.cc.dataCtl.ajaxReq("/black/list",this.onHmdReqOk,this),this.reqPriveteChatTime()},t.prototype.onHmdReqOk=function(t){if(0==t.ret){var e=[];for(var i in t.data){var s=Number(i);e.push(s)}GmGlobal.mc.chatMgr.hmdList=e}this.reqChatLog(GmGlobal.mc.chatMgr.MY_GH_CH,10),this.reqChatLog(ChatChannel.KUAFU,10),this.reqChatLog(ChatChannel.CAT,10),this.reqChatLog(ChatChannel.WORLD,10)},t.prototype.onUpdateMsg=function(t){var e=GmGlobal.mc.chatMgr;if(!e.isLahei(t.srcRoleId)){var i=ChatMsg.create();i.ch=t.channel,t.content=t.content.replace(/\\s/g," "),i.content=Utils.replaceColorCode(t.content),i.roleId=t.srcRoleId,i.name=t.srcRoleName,t.appendContent&&(i.ex=JSON.parse(t.appendContent)),0==i.ch?(e.addPrivateMsg(i.roleId,i),this.setPrivateChatDot(i.roleId,1)):(e.addChatMsg(i),(i.ch==ChatChannel.WORLD||i.ch==ChatChannel.KUAFU||i.ch==e.MY_GH_CH||i.ch==ChatChannel.SYS)&&e.appendAllMsg(i)),i.content&&""!=i.content&&(t.channel==ChatChannel.LABA?Horselamp.showHText(Utils.formatSysMsg(i.content)):t.channel==ChatChannel.PROMPT&&MsgBox.prompt(i.content,3e3),EventBus.dispatchEvt(EventType.M_CHATMSG_UPD,i))}},t.prototype.onUpdateCode=function(t){var e=GmGlobal.mc.txtMgr.getRetCode(t.retcode,t.content);if(e){var i=ChatMsg.create();i.ch=t.channel,i.content=e,t.channel==ChatChannel.LABA?541==t.retcode?setTimeout(function(){Horselamp.showHText(Utils.formatSysMsg(i.content))},3e3):Horselamp.showHText(Utils.formatSysMsg(i.content)):t.channel==ChatChannel.PROMPT&&MsgBox.prompt(i.content,3e3),GmGlobal.mc.chatMgr.addChatMsg(i),i.ch==ChatChannel.SYS&&GmGlobal.mc.chatMgr.appendAllMsg(i),EventBus.dispatchEvt(EventType.M_CHATMSG_UPD,i)}},t.prototype.onDelMsg=function(t){GmGlobal.mc.chatMgr.rmMsgByRoleId(t.roleId),EventBus.dispatchEvt(EventType.M_CHATMAG_ALLUPD)},t.prototype.reqChatLog=function(t,e,i){void 0===i&&(i=null);var s=MsgStruct.getMsg(MsgID.REQ_CHAT_LOG);if(s){s.channel=t,s.num=e;var o=GmGlobal.mc.chatMgr;GmGlobal.server.sendMsg(MsgID.REQ_CHAT_LOG,s,function(e){for(var i=e.data,s=i.length-1;s>=0;--s){var n=i[s];if(!o.isLahei(n.srcRoleId)){var r=ChatMsg.create();r.ch=t,n.content=n.content.replace(/\\s/g," "),r.content=n.content,r.roleId=n.srcRoleId,r.name=n.srcRoleName,n.appendContent&&(r.ex=JSON.parse(n.appendContent)),o.addChatMsg(r),0!=s||t!=ChatChannel.WORLD&&t!=ChatChannel.KUAFU&&t!=o.MY_GH_CH||o.appendAllMsg(r)}}EventBus.dispatchEvt(EventType.M_CHATMSG_INIT,t)}),s=null}},t.prototype.addTishi=function(t,e){var i=ChatMsg.create();i.ch=e,i.content=t,i.roleId=0,i.name=null,i.ex={ts:1};var s=GmGlobal.mc.chatMgr;s.addChatMsg(i),s.appendAllMsg(i),EventBus.dispatchEvt(EventType.M_CHATMSG_UPD,i)},t.prototype.addMsg=function(t,e){var i=ChatMsg.create();i.ch=e,i.content=t,i.roleId=0,i.name=null;var s=GmGlobal.mc.chatMgr;s.addChatMsg(i),s.appendAllMsg(i),EventBus.dispatchEvt(EventType.M_CHATMSG_UPD,i)},t.prototype.jxgcTeamInvite=function(t,e){void 0===e&&(e=ChatChannel.WORLD);var i=GmGlobal.mc,s={s:i.role.serverId,h:i.role.careerId,txk:i.setMgr.getSelTxk(),jxteam:t};this.sengChatMsg(e,"x",s,!1,1),CmdBus.doCmd(CmdType.O_CHAT,e)},t.prototype.mkTeamInvite=function(t,e){void 0===e&&(e=ChatChannel.WORLD);var i=GmGlobal.mc,s={s:i.role.serverId,h:i.role.careerId,txk:i.setMgr.getSelTxk(),mkteam:t};this.sengChatMsg(e,"x",s,!1,1),CmdBus.doCmd(CmdType.O_CHAT,e)},t.prototype.sxTeamInvite=function(t,e){void 0===e&&(e=ChatChannel.WORLD);var i=GmGlobal.mc,s={s:i.role.serverId,h:i.role.careerId,txk:i.setMgr.getSelTxk(),sxteam:t};this.sengChatMsg(e,"x",s,!1,1),CmdBus.doCmd(CmdType.O_CHAT,e)},t.prototype.yckjTeamInvite=function(t,e,i){void 0===i&&(i=ChatChannel.WORLD);var s=GmGlobal.mc,o={s:s.role.serverId,h:s.role.careerId,txk:s.setMgr.getSelTxk(),yckj:t,fbId:e};this.sengChatMsg(i,"x",o,!1,1),CmdBus.doCmd(CmdType.O_CHAT,i)},t.prototype.tradeZs=function(t){var e=GmGlobal.mc,i={s:e.role.serverId,h:e.role.careerId,txk:e.setMgr.getSelTxk(),tradeId:t};this.sengChatMsg(ChatChannel.WORLD,"x",i,!1,1),CmdBus.doCmd(CmdType.O_CHAT)},t.prototype.ybTishi=function(t){var e={bcq:t};this.sengChatMsg(ChatChannel.WORLD,"x",e,!1,1)},t.prototype.sengChatMsg=function(t,e,i,s,o){if(void 0===i&&(i=null),void 0===s&&(s=!0),void 0===o&&(o=0),e=e.replace(/ /g,"\\s"),s){var n=GmGlobal.mc.role.lv;if(10>n)return void MsgBox.prompt("Chat unlocks at LV.10");var r=egret.getTimer();if(t==ChatChannel.WORLD||t==GmGlobal.mc.chatMgr.MY_GH_CH){if(r-this._worldSendTime<GmConst.WORLD_CHAT_INTERVAL)return void MsgBox.prompt("Chat too often，Please wait");this._worldSendTime=r}}var h=MsgStruct.getMsg(MsgID.REQ_CHAT_SEND);if(h){i&&(i.time=GmGlobal.getServerTime()),h.channel=t,h.type=1,h.appendContent=JSON.stringify(i),h.nolog=o,h.content=e;PFConst.CHECK_MSG&&void 0!=checkMsg&&this._msgCheckNum<6?(this._msgCheckNum++,checkMsg(e,function(t){return 0!=t?void MsgBox.prompt("Sensitive words detected in msg"):(GmGlobal.server.sendMsg(MsgID.REQ_CHAT_SEND,h,function(t){0!=t.retCode&&GmGlobal.mc.txtMgr.showRetCode(t.retCode)}),void(h=null))})):(GmGlobal.server.sendMsg(MsgID.REQ_CHAT_SEND,h,function(t){0!=t.retCode&&GmGlobal.mc.txtMgr.showRetCode(t.retCode)}),h=null)}},t.prototype.replaceMaskWord=function(t){var e=GmGlobal.mc.chatMgr.maskwords;if(e)for(var i,s=e.length,o=0;s>o;o++)if(i=e[o],-1!=t.indexOf(i)){t=t.replace(i,"***");break}return t},t.prototype.reqChain=function(t,e,i,s){void 0===e&&(e=0),void 0===i&&(i=300);var o=MsgStruct.getMsg(MsgID.REQ_CHAIN);if(o){o.type=t,o.bIndex=e,o.num=i;GmGlobal.server.sendMsg(MsgID.REQ_CHAIN,o,function(t){for(var e=t.type,i=GmGlobal.mc.chatMgr.getChainList(e),o=0;o<t.roleid.length;o++){var n=t.roleid[o];-1==i.indexOf(n)&&i.push(n)}s&&s()})}},t.prototype.setChain=function(t,e,i){var s=MsgStruct.getMsg(MsgID.SET_CHAIN);if(s){s.type=t,s.roleId=e,s.action=i;GmGlobal.server.sendMsg(MsgID.SET_CHAIN,s);var o=GmGlobal.mc.chatMgr.getChainList(t),n=o.indexOf(e);0==i?-1==n&&o.push(e):-1!=n&&o.splice(n,1)}},t.prototype.checkName=function(t,e){PFConst.CHECK_MSG&&void 0!=checkMsg?checkMsg(t,function(t){0!=t&&MsgBox.prompt("Sensitive words found in name"),e(t)}):e(0)},t.prototype.sendPrivateMsg=function(t,e,i){void 0===i&&(i=null);var s=MsgStruct.getMsg(MsgID.REQ_PCHAT_SEND);s&&(s.targetId=t,s.content=e,s.appendContent=JSON.stringify(i),GmGlobal.server.sendMsg(MsgID.REQ_PCHAT_SEND,s,function(e){if(0!=e.retCode)MsgBox.prompt(GmGlobal.mc.txtMgr.getRetCode(e.retCode));else{var s=ChatMsg.create();s.ch=0,s.roleId=GmGlobal.mc.role.roleId,s.content=e.content,s.ex=i,GmGlobal.mc.chatMgr.addPrivateMsg(t,s),EventBus.dispatchEvt(EventType.M_MY_PCHAT,{roleId:t,msg:s})}}))},t.prototype.reqPrivateLog=function(t,e){var i=MsgStruct.getMsg(MsgID.REQ_PCHAT_LOG);if(i){i.targetId=t,i.num=e;GmGlobal.server.sendMsg(MsgID.REQ_PCHAT_LOG,i,function(e){var i=e.data,s=GmGlobal.mc.chatMgr;s.initPrivateMsg(t);for(var o=i.length-1;o>=0;--o){var n=i[o];if(!s.isLahei(n.srcRoleId)){var r=ChatMsg.create();r.ch=0,r.content=n.content,r.roleId=n.roleId,r.name="",n.appendContent&&(r.ex=JSON.parse(n.appendContent)),s.addPrivateMsg(t,r)}}EventBus.dispatchEvt(EventType.PCHAT_LOG,t)})}},t.prototype.reqPriveteChatTime=function(){var t=MsgStruct.getMsg(MsgID.REQ_PCHAT_TIME);if(t){var e=GmGlobal.mc.chatMgr.pchatTime,i=egret.localStorage.getItem("chattime"+GmGlobal.mc.role.roleId);i&&""!=i&&(e=JSON.parse(i));var s=this;GmGlobal.server.sendMsg(MsgID.REQ_PCHAT_TIME,t,function(t){for(var i=0;i<t.data.length;i++){var o=t.data[i],n=e[o.roleId]||0;-2==n?delete e[o.roleId]:n<o.time&&(s.setPrivateChatDot(o.roleId,1),e[o.roleId]=-1)}for(var r in e)t.data[r]||(-1==e[r]?s.setPrivateChatDot(Number(r),1):delete e[r]);GmGlobal.mc.chatMgr.pchatTime=e,s.cachePriveteTime()})}},t.prototype.setPrivateChatDot=function(t,e){var i=GmGlobal.mc.chatMgr.pchatDot,s=i.getChild(t.toString());s||(s=new RedDot(t.toString(),i)),s.state=e},t.prototype.clearPriveteTime=function(t,e){void 0===e&&(e=!1);var i=GmGlobal.mc.chatMgr.pchatTime;e?i[t]=-2:i[t]=GmGlobal.getServerTime(),this.setPrivateChatDot(t,0),this.cachePriveteTime()},t.prototype.cachePriveteTime=function(){egret.localStorage.setItem("chattime"+GmGlobal.mc.role.roleId,JSON.stringify(GmGlobal.mc.chatMgr.pchatTime))},t}();__reflect(ChatController.prototype,"ChatController");var ChatEmojiView=function(t){function e(){return t.call(this,"ChatEmojiSkin")||this}return __extends(e,t),e.prototype.bindCallback=function(t,e){this._cb=t,this._thisObj=e},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=GmGlobal.mc.chatMgr.faceCfgs;this._faceList=e;for(var i=0,s=e;i<s.length;i++){var o=s[i],n=new eui.Image("emoji_json."+o.faceRes);n.width=n.height=50,this.itemCon.addChild(n)}},e.prototype.updatePos=function(){},e.prototype.addEvts=function(){this.itemCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchFace,this)},e.prototype.rmEvts=function(){this.itemCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchFace,this)},e.prototype.onTouchFace=function(t){if(t.target.parent==this.itemCon){var e=this.itemCon.getChildIndex(t.target),i=this._faceList[e];this._cb&&this._thisObj&&this._cb.call(this._thisObj,i)}},e.prototype.destroy=function(){this._cb=null,this._thisObj=null,t.prototype.destroy.call(this)},e}(UIBase);__reflect(ChatEmojiView.prototype,"ChatEmojiView");var ChatItemView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data,e=!1,i=GmGlobal.mc;if(this.setStrStyle(!1),t.ch==ChatChannel.SYS){this.icon.source="com_json.chat_sys",this.txk.visible=!1,this.txt.visible=!0;var s=Utils.formatChatSysMsg(t.content);this.txt.textFlow=s,s.length>1&&(e=!0),this.nameTxt.visible=!1,this.txtBg.height=this.txt.height+20,this.txtBg.width=this.txt.textWidth+20,this.timeTxt.visible=!1,this.face.visible=!1,this.vip.visible=!1,this.txtBg.y=10,this.txt.y=this.txtBg.y+10,this.height=Math.max(this.txtBg.y+this.txtBg.height+10,94)}else if(t.ex&&t.ex.time&&(this.timeTxt.text=Utils.formatDate(Utils.getServerTime(t.ex.time),"M.D h:m"),this.timeTxt.visible=!0),!t.ex||1!=t.ex.cmd&&-1!=t.ex.cmd)if(t.ex&&t.ex.ts)this.setStrStyle(!0),this.txt.visible=!0,this.txt.textFlow=TextFormat.parser.parse("Tips: "+t.content),this.txt.y=42,this.height=this.txt.textHeight+62;else if(t.ex&&t.ex.bcq){this.setStrStyle(!0),this.txt.visible=!0;var o=TextFormat.setColor(t.name,Colors.RED)+" is escorting his "+TextFormat.setColor(i.wfMgr.getBcName(t.ex.bcq),i.wfMgr.getBcQColor(t.ex.bcq))+"on the way.",s=TextFormat.parser.parse(o);s.push({text:"I'll join",style:{href:"event:"+t.ex.bcq,underline:!0,textColor:Colors.GREEN}}),this.txt.textFlow=s,e=!0,this.txt.y=42,this.height=this.txt.textHeight+62}else{if(this.txk.visible=!0,this.nameTxt.visible=!0,this.nameTxt.textColor=t.roleId==i.role.roleId?15045434:4605510,2==PFConst.SERVER_TYPE&&t.ex.s?this.nameTxt.text="s"+t.ex.s+" "+t.name:this.nameTxt.text=t.name,this.timeTxt.x=this.nameTxt.x+this.nameTxt.width+10,t.ex.h?this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+t.ex.h+".png":this.icon.source=null,t.ex.txk){var n=i.setMgr.getXkCfg(t.ex.txk);n?(this.txk.source="txk_json."+n.icon,this.getChildIndex(this.txk)<this.getChildIndex(this.icon)&&this.setChildIndex(this.txk,this.getChildIndex(this.icon))):(this.txk.source="txk_json.txk",this.getChildIndex(this.txk)>this.getChildIndex(this.icon)&&this.setChildIndex(this.txk,this.getChildIndex(this.icon)-1))}else this.txk.source="txk_json.txk",this.getChildIndex(this.txk)>this.getChildIndex(this.icon)&&this.setChildIndex(this.txk,this.getChildIndex(this.icon)-1);if(this.vip.visible=!1,t.ex&&t.ex.face)this.txt.visible=!1,this.face.visible=!0,this.face.source="emoji_json."+t.ex.face,this.txtBg.height=82,this.txtBg.width=82;else{this.txt.visible=!0,this.face.visible=!1;var r=i.itemMgr.getItemCfg(t.ex.i);if(r){var h=r.quality==ItemQuality.WHILE?7437190:Utils.getQualityColor(r.quality),a=t.ex.i;t.ex.uid&&(a+="_"+t.ex.uid+"_"+t.roleId),this.txt.textFlow=new Array({text:r.name,style:{href:"event:"+a,underline:!0,textColor:h}}),e=!0}else if(t.ex.jxteam){var o="invites you to a "+TextFormat.setColor("Mech Factory ",Colors.RED)+"raid.  ",s=TextFormat.parser.parse(o);s.push({text:"Apply to join",style:{href:"event:"+t.ex.jxteam,underline:!0,textColor:Colors.GREEN}}),this.txt.textFlow=s,e=!0}else if(t.ex.mkteam){var o="invites you to a "+TextFormat.setColor("Den Adventure ",16724940)+"raid.  ",s=TextFormat.parser.parse(o);s.push({text:"Apply to join",style:{href:"event:"+t.ex.mkteam,underline:!0,textColor:Colors.GREEN}}),this.txt.textFlow=s,e=!0}else if(t.ex.sxteam){var o="invites you to a "+TextFormat.setColor("Statue Defense ",16724940)+"raid.  ",s=TextFormat.parser.parse(o);s.push({text:"Apply to join",style:{href:"event:"+t.ex.sxteam,underline:!0,textColor:Colors.GREEN}}),this.txt.textFlow=s,e=!0}else if(t.ex.yckj){var o="invites you to a "+TextFormat.setColor("Altverse ",16724940)+"raid.   ",s=TextFormat.parser.parse(o);s.push({text:"Apply to join",style:{href:"event:"+t.ex.yckj,underline:!0,textColor:Colors.GREEN}}),this.txt.textFlow=s,e=!0}else if(t.ex.tradeId){var o="Shop Open，Welcome to my shop  ",s=TextFormat.parser.parse(o);s.push({text:"Enter Shop",style:{href:"event:"+t.ex.tradeId,underline:!0,textColor:Colors.GREEN}}),this.txt.textFlow=s,e=!0}else try{this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(t.content,this.txt.width))}catch(l){this.txt.text=t.content}this.txtBg.height=this.txt.height+20,this.txtBg.width=this.txt.textWidth+20}this.txtBg.y=45,this.txt.y=this.txtBg.y+10,this.height=Math.max(this.txtBg.y+this.txtBg.height+10,94)}else this.setStrStyle(!0),this.txt.visible=!0,this.txt.textFlow=TextFormat.parser.parse(TextFormat.setColor(t.content,1==t.ex.cmd?Colors.GREEN:8355711)),this.txt.y=5,this.height=this.txt.height+this.txt.y;e?this.txt.addEventListener(egret.TextEvent.LINK,this.onTouchText,this):this.txt.removeEventListener(egret.TextEvent.LINK,this.onTouchText,this),this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchIcon,this)},e.prototype.setStrStyle=function(t){this.nameTxt.visible=!t,this.icon.visible=!t,this.txtBg.visible=!t,this.txk.visible=!t,this.face.visible=!1,this.vip.visible=!t,t&&(this.timeTxt.x=this.txt.x)},e.prototype.onTouchText=function(t){var e=GmGlobal.mc;if(this.data.ex){if(this.data.ex.i){var i=this.localToGlobal(this.txt.x+this.txt.textWidth,this.txt.y);this.data.ex.uid?EquipTips.show(this.data.ex.uid,i.x,i.y,0,GmGlobal.vmc.uiLayer2,this.data.roleId):ItemTips.show(this.data.ex.i,i.x,i.y,0,GmGlobal.vmc.uiLayer2)}else if(this.data.ex.jxteam){if(!e.guideMgr.isModeuleOpen(ModelID.JXGC,!0))return;if(this.data.ch==ChatChannel.KUAFU&&!this.checkLv())return;if(this.checkFuben())return;this.data.ex.jxteam!=e.role.roleId&&(e.wfMgr.hasTeamXz(this.data.ex.jxteam)?this.showTeamXz():GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ZY,[this.data.ex.jxteam,FubenType.JXGC],this.onJxgcZyOk,this))}else if(this.data.ex.mkteam){if(!e.guideMgr.isModeuleOpen(ModelID.MOKU,!0))return;if(this.data.ch==ChatChannel.KUAFU&&!this.checkLv())return;if(this.checkFuben())return;this.data.ex.mkteam!=e.role.roleId&&(e.wfMgr.hasTeamXz(this.data.ex.mkteam)?this.showTeamXz():GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ZY,[this.data.ex.mkteam,FubenType.MK01],this.onMkZyOk,this))}else if(this.data.ex.sxteam){if(!e.guideMgr.isModeuleOpen(ModelID.SWSX,!0))return;if(this.data.ch==ChatChannel.KUAFU&&!this.checkLv())return;if(this.checkFuben())return;this.data.ex.sxteam!=e.role.roleId&&(e.wfMgr.hasTeamXz(this.data.ex.sxteam)?this.showTeamXz():GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ZY,[this.data.ex.sxteam,FubenType.SWSX],this.onSxZyOk,this))}else if(this.data.ex.yckj){if(!e.guideMgr.isModeuleOpen(ModelID.YCKJ,!0))return;if(this.data.ch==ChatChannel.KUAFU&&!this.checkLv())return;if(this.checkFuben())return;this.data.ex.yckj!=e.role.roleId&&(e.wfMgr.hasTeamXz(this.data.ex.yckj)?this.showTeamXz():GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ZY,[this.data.ex.yckj,this.data.ex.fbId],this.onYckjOk,this))}else if(this.data.ex.bcq){if(!e.guideMgr.isModeuleOpen(ModelID.WANFA,!0))return;if(this.checkFuben())return;this.data.roleId!=e.role.roleId&&(CmdBus.doCmd(CmdType.O_WANFA,2),CmdBus.doCmd(CmdType.C_CHAT))}else if(this.data.ex.tradeId){if(!e.guideMgr.isModeuleOpen(ModelID.TRADE,!0))return;CmdBus.doCmd(CmdType.O_TRADE_ZS,this.data.ex.tradeId)}}else{var s=Number(t.text);if(GmGlobal.mc.itemMgr.getItemCfg(s)){var i=this.localToGlobal(this.txt.x+this.txt.textWidth,this.txt.y);ItemTips.show(s,i.x,i.y,0,GmGlobal.vmc.uiLayer2)}}},e.prototype.showTeamXz=function(){MsgBox.prompt("Unable to join the team, try again 10s later")},e.prototype.checkLv=function(){return GmGlobal.mc.role.lv<80?(MsgBox.prompt("Cross-server team available at Lv. 80."),!1):!0},e.prototype.checkFuben=function(){var t=GmGlobal.mc.sceneMgr;return t.mapType==SceneType.FUBEN?(MsgBox.prompt("Currently in dungeon"),!0):!1},e.prototype.onJxgcZyOk=function(){CmdBus.doCmd(CmdType.O_WANFA,5),CmdBus.doCmd(CmdType.C_CHAT)},e.prototype.onMkZyOk=function(){CmdBus.doCmd(CmdType.O_WANFA,10),CmdBus.doCmd(CmdType.C_CHAT)},e.prototype.onSxZyOk=function(){CmdBus.doCmd(CmdType.O_WANFA,12),CmdBus.doCmd(CmdType.C_CHAT)},e.prototype.onYckjOk=function(){CmdBus.doCmd(CmdType.O_YCKJ),CmdBus.doCmd(CmdType.C_CHAT)},e.prototype.onTouchIcon=function(t){var e=this.data.ch;if(e!=ChatChannel.SYS&&this.data.roleId!=GmGlobal.mc.role.roleId){var i=ChatVInfo.getInstance();i.show(GmGlobal.vmc.uiLayer),i.setRole(this.data.roleId,this.data.name,t.stageX,t.stageY)}},e.prototype.clear=function(){this.icon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchIcon,this),this.txt.removeEventListener(egret.TextEvent.LINK,this.onTouchText,this)},e}(eui.ItemRenderer);__reflect(ChatItemView.prototype,"ChatItemView");var ChatManager=function(){function t(){this.useBubble=0,this.MY_GH_CH=-1,this.currenCh=ChatChannel.WORLD,this.pasteNum=0,this._messages={},this._pmsgs={},this.pchatTime={},this._chainLists={},this.faceNameToResCfg={},this.faceResToName={},GmGlobal.mc.regUnzipCfg("c_chatface.json",this.initFaceCfg,this),this.pchatDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.FRIEND,this.pchatDot)}return t.prototype.initFaceCfg=function(t){if(t){this.faceCfgs=t;for(var e=0,i=t;e<i.length;e++){var s=i[e];this.faceNameToResCfg[s.faceName]=s.faceRes,this.faceResToName[s.faceRes]=s.faceName}}},t.prototype.addChatMsg=function(t){if(t){var e=t.ch;(e==ChatChannel.LABA||100>e)&&(e=ChatChannel.SYS,t.ch=e);var i=this._messages[e];i||(i=[],this._messages[e]=i),t.refNum++,i.push(t);var s=this.getMaxNum(t.ch);i.length>s&&ChatMsg.release(i.shift())}},t.prototype.appendAllMsg=function(t){var e=this._messages[ChatChannel.ALL];e||(e=[],this._messages[ChatChannel.ALL]=e),t.refNum++,e.push(t);var i=this.getMaxNum(ChatChannel.ALL);e.length>i&&ChatMsg.release(e.shift())},t.prototype.initPrivateMsg=function(t){var e=this._pmsgs[t];e||(e=[],this._pmsgs[t]=e)},t.prototype.addPrivateMsg=function(t,e){var i=this._pmsgs[t];if(i){e.refNum++,i.push(e);var s=this.getMaxNum(e.ch);i.length>s&&ChatMsg.release(i.shift())}},t.prototype.getMaxNum=function(t){switch(t){case ChatChannel.HUOD_CJ:return 20;case ChatChannel.ALL:return 4;default:return 100}},t.prototype.getChatMsg=function(t){return this._messages[t]},t.prototype.getPrivateChatMsg=function(t){return this._pmsgs[t]?this._pmsgs[t]:null},t.prototype.rmMsgByRoleId=function(t){for(var e in this._messages)for(var i=this._messages[e],s=0;s<i.length;s++){var o=i[s];o.roleId==t&&(i.splice(s,1),s--)}},t.prototype.isLahei=function(t){return this.hmdList&&-1!=this.hmdList.indexOf(t)?!0:!1},t.prototype.getChainList=function(t){var e=this._chainLists[t];return e||(e=[],this._chainLists[t]=e),e},t}();__reflect(ChatManager.prototype,"ChatManager");var ChatMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.CHAT,CmdType.O_CHAT),CmdBus.adListener(CmdType.O_CHAT,this.doOpen,this),CmdBus.adListener(CmdType.C_CHAT,this.closeChatView,this)}return t.prototype.doOpen=function(t){void 0===t&&(t=0),this._chatView||(this._chatView=new ChatView),this._chatView.isShow||this._chatView.show(GmGlobal.vmc.uiLayer);var e=this.chToTab(t);this._chatView.selTab(e)},t.prototype.chToTab=function(t){switch(t){case ChatChannel.KUAFU:return 1;case GmGlobal.mc.chatMgr.MY_GH_CH:return 2;case ChatChannel.SYS:return 3;default:return 0}},t.prototype.closeChatView=function(){this._chatView&&this._chatView.isShow&&this._chatView.tweenClose()},t}();__reflect(ChatMediator.prototype,"ChatMediator");var ChatMsg=function(){function t(){this.refNum=0}return t.create=function(){var e=t._infoPool.pop();return e||(e=new t),e},t.release=function(e){e&&(e.refNum--,e.refNum>0||-1==t._infoPool.indexOf(e)&&(e.ch=0,e.content=null,e.ex=null,e.roleId=0,e.name=null,t._infoPool.push(e)))},t._infoPool=[],t}();__reflect(ChatMsg.prototype,"ChatMsg");var ChatView=function(t){function e(){var e=t.call(this,"ChatViewSkin")||this;return e._selTab=-1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._arrayCollection=new eui.ArrayCollection,this.itemList.dataProvider=this._arrayCollection,this.itemList.itemRenderer=ChatItemView,this.itemList.itemRendererSkinName="ChatItemSkin"},e.prototype.updatePos=function(){},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSend,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.tabCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this),this.bEmoji.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showEmoji,this),EventBus.addListener(EventType.M_CHATMSG_UPD,this.onUpdateMsg,this),EventBus.addListener(EventType.M_CHATMAG_ALLUPD,this.onUpdateAll,this),EventBus.addListener(EventType.M_GUILD,this.updateBtnState,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bSend.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSend,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.tabCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this),this.bEmoji.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showEmoji,this),EventBus.rmListener(EventType.M_CHATMSG_UPD,this.onUpdateMsg,this),EventBus.rmListener(EventType.M_CHATMAG_ALLUPD,this.onUpdateAll,this),EventBus.rmListener(EventType.M_GUILD,this.updateBtnState,this)
},e.prototype.onTab=function(t){if(t.target.parent==this.tabCon){var e=this.tabCon.getChildIndex(t.target);this._selTab!=e&&GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.show=function(e){t.prototype.show.call(this,e,!1,!1),this.x=(GmGlobal.stageWidth-this.width)/2,this.y=GmGlobal.stageHeight,egret.Tween.removeTweens(this);GmGlobal.stageHeight-this.height-(GmConst.IS_FULLSCENE?GmConst.BOTTOM_SPACE:0);egret.Tween.get(this).to({y:GmGlobal.stageHeight-this.height},300)},e.prototype.selTab=function(t){if(this._selTab!=t){-1!=this._selTab&&(this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.clearChatItems());this.tabCon.getChildAt(t);this._selTab=t,this.scoll.viewport.scrollV=0,this.updateBtnState(),this.updateSelState(),this.updateChatList()}},e.prototype.updateBtnState=function(){3==this._selTab||2==this._selTab&&-1==GmGlobal.mc.chatMgr.MY_GH_CH?(Utils.setBtnEnable(this.bSend,!1),this.bEmoji.visible=!1):(Utils.setBtnEnable(this.bSend,!0),this.bEmoji.visible=!0)},e.prototype.updateSelState=function(){for(var t=0;4>t;t++){var e=this.tabCon.getChildAt(t),i=this.tabTxtCon.getChildAt(t);t==this._selTab?(e.source="com_json.tab2_1",i.textColor=12022832):(e.source="com_json.tab2_0",i.textColor=10395294)}},e.prototype.onTouch=function(t){},e.prototype.updateChatList=function(){var t=this.getChatChannel(this._selTab);if(-1!=t){t!=ChatChannel.SYS&&(GmGlobal.mc.chatMgr.currenCh=t);var e=GmGlobal.mc.chatMgr.getChatMsg(t);if(e)for(var i=0;i<e.length;i++){var s=e[i];s.refNum++,this._arrayCollection.addItemAt(s,0)}}},e.prototype.onUpdateAll=function(){-1!=this._selTab&&(this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.clearChatItems()),this.updateChatList()},e.prototype.onUpdateMsg=function(t){if(t.data){var e=this.getChatChannel(this._selTab),i=t.data;if(e==i.ch&&(i.refNum++,this._arrayCollection.addItemAt(i,0),0!=this.scoll.viewport.scrollV)){var s=this.itemList.getChildAt(0);this.scoll.viewport.scrollV+=s.height}}},e.prototype.updateXiezhuMsg=function(t){for(var e=0;e<this._arrayCollection.length;e++){var i=this._arrayCollection.getItemAt(e);i.roleId==t.ex.bds&&i.ex.ds==t.ex.ds&&(i.ex.yzok=1,this._arrayCollection.replaceItemAt(i,e))}},e.prototype.getChatChannel=function(t){switch(t){case 0:return ChatChannel.WORLD;case 1:return ChatChannel.KUAFU;case 2:return GmGlobal.mc.chatMgr.MY_GH_CH;case 3:return ChatChannel.SYS;default:return-1}},e.prototype.onSend=function(){this.sendMsg(this.inputTxt.text),this.inputTxt.text=""},e.prototype.sendMsg=function(t,e){if(void 0===e&&(e=null),t=t.trim(),""!=t){var i=this.getChatChannel(this._selTab);if(-1!=i){var s=GmGlobal.mc,o={s:s.role.serverId,txk:s.setMgr.getSelTxk(),h:s.role.careerId};e&&(o.face=e),GmGlobal.cc.chatCtl.sengChatMsg(i,t,o)}}},e.prototype.showEmoji=function(){this._emojiView||(this._emojiView=new ChatEmojiView,this._emojiView.bindCallback(this.onSelEmoji,this)),this._emojiView.x=this.x+50,this._emojiView.y=this.y+this.bEmoji.y-this._emojiView.height-20,this._emojiView.show(this.parent,!0,!0,.01)},e.prototype.onSelEmoji=function(t){this.sendMsg("f",t.faceRes),this._emojiView.close()},e.prototype.clearChatItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clear()}for(var t=0;t<this._arrayCollection.length;t++){var i=this._arrayCollection.getItemAt(t);ChatMsg.release(i)}this._arrayCollection.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_CHAT)},e.prototype.tweenClose=function(){egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:GmGlobal.stageHeight},300).call(this.close,this)},e.prototype.close=function(){-1!=this._selTab&&(this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.clearChatItems(),this._selTab=-1),t.prototype.close.call(this)},e.prototype.destroy=function(){this._emojiView&&(this._emojiView.close(),this._emojiView.destroy(),this._emojiView=null),t.prototype.destroy.call(this)},e}(UIBase);__reflect(ChatView.prototype,"ChatView");var ChatVInfo=function(t){function e(){return t.call(this,"ChatVInfoSkin")||this}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.updatePos=function(){},e.prototype.addEvts=function(){this.bAddF.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bHmd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddToHmd,this)},e.prototype.rmEvts=function(){this.bAddF.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bHmd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddToHmd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0,.01)},e.prototype.setRole=function(t,e,i,s){this._roleId=t,this.nameTxt.text=e,this.x=i,this.y=s},e.prototype.onAdd=function(){return GmGlobal.mc.role.lv<65?void MsgBox.prompt("Friend unlocks at LV.65"):void GmGlobal.cc.dataCtl.doAction(ServerActionId.F_ADD,[this._roleId],this.onAddOk,this)},e.prototype.onAddOk=function(){MsgBox.prompt("Request sent"),e.release()},e.prototype.onAddToHmd=function(){GmGlobal.cc.dataCtl.ajaxReq("/black/add/"+this._roleId,this.onHmdAddOk,this)},e.prototype.onHmdAddOk=function(t){if(0==t.ret){var i=GmGlobal.mc.chatMgr.hmdList;i&&-1==i.indexOf(t.data)?i.push(t.data):i=[t.data]}e.release()},e}(UIBase);__reflect(ChatVInfo.prototype,"ChatVInfo");var GroupLoading=function(){function t(){this._timer=0,this._autoStep=0}return t.getInstence=function(){return this._instence||(this._instence=new t),this._instence},t.prototype.start=function(t,e,i,s){return RES.isGroupLoaded(t)?void(i&&i.call(s)):(this._progress=e,this._complate=i,this._thisObj=s,this._loadingView||(this._loadingView=UILoadingView.getInstence()),this._loadingView.show(),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResLoadProgress,this),RES.loadGroup(t),void(this._timer=egret.setInterval(this.onAutoProgress,this,0)))},t.prototype.onAutoProgress=function(){this._autoStep++,this._autoStep>=100&&(this._autoStep=100,this.stopTimer()),this.onProgress()},t.prototype.stopTimer=function(){egret.clearInterval(this._timer),this._timer=0},t.prototype.onProgress=function(){this._progress&&this._progress.call(this._thisObj,this._autoStep,100),this._loadingView.setPercent(this._autoStep)},t.prototype.onResLoadProgress=function(t){this._autoStep<100*t.itemsLoaded&&(this._autoStep=100*t.itemsLoaded),t.itemsLoaded==t.itemsTotal&&(this._autoStep=100,this.stopTimer()),this.onProgress()},t.prototype.onResLoadComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResLoadProgress,this);var e=this;setTimeout(function(){e.doCallBack()},100)},t.prototype.doCallBack=function(){this._complate&&this._complate.call(this._thisObj),this._progress=null,this._complate=null,this._thisObj=null,this.close()},t.prototype.onResLoadError=function(t){console.warn("Group: "+t.groupName+" load failed"),this.onResLoadComplete(null)},t.prototype.onItemLoadError=function(t){console.warn("url: "+t.resItem.url+" load failed"),this.onResLoadComplete(null)},t.prototype.close=function(){this.stopTimer(),this._autoStep=0,this._loadingView&&this._loadingView.close()},t}();__reflect(GroupLoading.prototype,"GroupLoading");var ItemLackTips=function(){function t(){this._buyItemId=0,this._itemUseNum=0}return t.instance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.setItemUse=function(t,e){this._buyItemId=t,this._itemUseNum=e},t.prototype.diamondTips=function(){PFConst.IS_NOPAY?PFConst.HAS_AD?MsgBox.confirm("Insufficient diamonds, Go get it?",this.openZzs,null,this):MsgBox.alert("Insufficient diamonds"):MsgBox.confirm("Insufficient diamonds, Go get it?",this.openPay,null,this)},t.prototype.openZzs=function(){CmdBus.doCmd(CmdType.O_LZS)},t.prototype.openPay=function(){CmdBus.doCmd(CmdType.O_SHOP)},t.prototype.copperCashTips=function(){MsgBox.confirm("Insufficient gold, Go purchase?",this.openCopperBuy,null,this)},t.prototype.openCopperBuy=function(){},t.prototype.ybTips=function(){CmdBus.doCmd(CmdType.O_EXCHANGE,"Redeem with Crystals",ItemID.GOLD,ItemID.SHUIJING,500,100)},t.prototype.shuijTips=function(){CmdBus.doCmd(CmdType.O_EXCHANGE,"Redeem with Diamonds",ItemID.SHUIJING,ItemID.DIAMOND,10,10)},t.prototype.tiliTips=function(){MsgBox.confirm("STA low, Go purchase?",this.onBuyTili,null,this)},t.prototype.onBuyTili=function(){},t.prototype.itemsTips=function(){this._buyItemId==ItemID.GOLD?this.ybTips():this._buyItemId==ItemID.SHUIJING?this.shuijTips():this._buyItemId==ItemID.DIAMOND?this.diamondTips():MsgBox.confirm("Insufficient items, Go purchase?",this.onBuyItems,null,this),this._buyItemId=0},t.prototype.onBuyItems=function(){CmdBus.doCmd(CmdType.O_SHOP,1)},t.prototype.qhTips=function(){MsgBox.confirm("Insufficient Enhance Stones,Purchase in the Mall?",this.openShop,null,this)},t.prototype.jlTips=function(){MsgBox.confirm("Insufficient Orichalcum,Purchase in the Mall?",this.openShop,null,this)},t.prototype.dzTips=function(){MsgBox.confirm("Insufficient Forge Stones,Purchase in the Mall?",this.openShop,null,this)},t.prototype.huobanTips=function(){MsgBox.alert("Not enough items. Source: Abyss Phantom and relvant events.")},t.prototype.openShop=function(){CmdBus.doCmd(CmdType.O_SHOP,2)},t}();__reflect(ItemLackTips.prototype,"ItemLackTips");var JsonData=function(){function t(t,e){this.id=t,this.data=e}return t}();__reflect(JsonData.prototype,"JsonData");var ModelID=function(){function t(){}return t.HERO=1,t.BAG=2,t.SHOP=3,t.TASK=4,t.CHAT=5,t.MAIL=6,t.SET=7,t.NOTICE=8,t.RANK=9,t.SHARE=10,t.PAY=11,t.FULI=12,t.SKILL=13,t.PET=14,t.MVP=15,t.TOUSHI=16,t.EQUIP=17,t.TOUSHI_M=18,t.TRADE=19,t.XUSHANG=20,t.VIP=21,t.JINLI=22,t.XINGZUO=23,t.WANFA=24,t.GUAJI=25,t.GONGHUI=26,t.KAPULA=27,t.SHOUCHONG=28,t.HUOBAN=29,t.CHUANBAO=30,t.YCSHOP=31,t.JXGC=32,t.SYHY=33,t.BRDC=34,t.HAOLI=35,t.DAY7=36,t.YIYUAN=37,t.GTASK=38,t.CAT=39,t.FRIEND=40,t.DGIFT=41,t.D7GIFT=42,t.MOKU=43,t.TUJIAN=44,t.SWEET_HOUSE=45,t.HUNT=46,t.LIANJS=47,t.WEID=48,t.TITLE=49,t.WDLOGIN=50,t.VIP1=51,t.MAOMAO=52,t.SWSX=53,t.SHIPIN=54,t.PAY_TEST=55,t.HALO=56,t.MCJ=57,t.TILIAN=58,t.HLQD=59,t.KFQD=60,t.ZLB=62,t.WENJUAN=63,t.YCKJ=64,t.JZTXB=65,t}();__reflect(ModelID.prototype,"ModelID");var RedDot=function(t){function e(e,i){var s=t.call(this)||this;return s._state=0,i&&(s.parent=i,s.parent.childs||(s.parent.childs={}),s.parent.childs[e]=s),s}return __extends(e,t),e.prototype.bindChangeCB=function(t,e){this._cbs||(this._cbs=[]),-1==this.getCBIndex(t,e)&&this._cbs.push(new CallBack(t,e))},e.prototype.getCBIndex=function(t,e){for(var i=0;i<this._cbs.length;i++){var s=this._cbs[i];if(s.cb==t&&s.target==e)return i}return-1},e.prototype.unbindChangeCB=function(t,e){if(this._cbs){var i=this.getCBIndex(t,e);-1!=i&&this._cbs.splice(i,1),0==this._cbs.length&&(this._cbs=null)}},e.prototype.doChangeCB=function(){if(this._cbs)for(var t=0,e=this._cbs;t<e.length;t++){var i=e[t];i.cb.call(i.target,this)}},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){if(t!=this._state){var e=t!=this._state;if(this._state=t,0==t&&this.childs)for(var i in this.childs){var s=this.childs[i];if(1==s.state){this._state=1;break}}this.parent&&(this.parent.state=this._state),e&&this.doChangeCB()}},enumerable:!0,configurable:!0}),e.prototype.getChild=function(t){return this.childs?this.childs[t]:null},e.prototype.removeChild=function(t){this.childs&&(delete this.childs[t],this.state=0)},e.initRedDot=function(t){var i=new e("0",null);return t&&e.initRedDotChild(i,t),i},e.initRedDotChild=function(t,i){for(var s in i){var o=new e(s,t);0!=i[s]&&e.initRedDotChild(o,i[s])}},e}(egret.HashObject);__reflect(RedDot.prototype,"RedDot");var RedDotView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.addRedDot=function(t,i,s,o,n,r){if(void 0===o&&(o=0),void 0===n&&(n=0),void 0===r&&(r="com_json.com_rdd"),e._dotViews[t.hashCode])return null;var h=e._pool.pop();return h||(h=new e),h.texture=RES.getRes(r),i.addChild(h),h.visible=t.visible,h.group=s,h.x=o,h.y=n,e._dotViews[t.hashCode]=h,h},e.removeRedDot=function(t){var i=e._dotViews[t.hashCode];return i&&(i.parent&&i.parent.removeChild(i),e._pool.push(i),delete e._dotViews[t.hashCode]),i},e.removeRedDotByGroup=function(t){var i=e._dotViews;for(var s in i){var o=i[s];o&&o.group==t&&(o.parent&&o.parent.removeChild(o),e._pool.push(o),delete i[s])}},e.getRedDot=function(t){var i=e._dotViews[t.hashCode];return i},e._dotViews={},e._pool=[],e}(egret.Bitmap);__reflect(RedDotView.prototype,"RedDotView");var WaitData=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t,t._instance.initWaitTyps()),t._instance},t.prototype.startWait=function(t,e){this._cb=t,this._thisObj=e},t.prototype.initWaitTyps=function(){this._waitTyps=[],this._waitTyps.push(t.JSONDATA_END),EventBus.addListener(EventType.M_JUPD+JsonID.JSON_END,this.onJsonData,this)},t.prototype.onJsonData=function(e){EventBus.rmListener(EventType.M_JUPD+JsonID.JSON_END,this.onJsonData,this),this.dataReceived(t.JSONDATA_END)},t.prototype.dataReceived=function(t){var e=this._waitTyps.indexOf(t);-1!=e&&this._waitTyps.splice(e,1),0==this._waitTyps.length&&this._cb&&(this._cb.call(this._thisObj),this._cb=null,this._thisObj=null)},t.prototype.isComplete=function(){return this._waitTyps.length>0?!1:!0},t.ZJ_DATA=1,t.JSONDATA_END=4,t}();__reflect(WaitData.prototype,"WaitData");var WaitingView=function(t){function e(){var e=t.call(this,"WaitingViewSkin")||this;return e._timer=0,e}return __extends(e,t),e.showWaiting=function(t){this._instance||(this._instance=new e),this._instance.setTxt(t),this._instance.show(GmGlobal.vmc.uiLayer)},e.hideWaiting=function(){this._instance&&this._instance.close()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(e){t.prototype.show.call(this,e),this.visible=!1,0==this._timer&&(this._timer=egret.setInterval(this.onTimer,this,0))},e.prototype.setTxt=function(t){this.txt.text=t,this.height=131+this.txt.textHeight+30},e.prototype.onTimer=function(){this.visible||(this.visible=!0),this.quan.rotation+=4},e.prototype.close=function(){0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0),t.prototype.close.call(this)},e}(UIBase);__reflect(WaitingView.prototype,"WaitingView");var DayGiftController=function(){function t(){this._isReady=!1,EventBus.addListener(EventType.M_JUPD+JsonID.DGIFT_LC,this.lcUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.LOGIN_DAY,this.reqLcId,this),EventBus.addListener(EventType.M_JUPD+JsonID.DGIFT_XS,this.onXs,this),EventBus.addListener(EventType.M_JUPD+JsonID.DGIFT_LB,this.onLb,this),EventBus.addListener(EventType.M_MUI_READY,this.onReady,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_FL_LIANC,this.onLiancUpd,this)}return t.prototype.onReady=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onReady,this),this._isReady=!0,this.reqLcId();var t=GmGlobal.mc.dgiftMgr.redDot.childs[5];1==t.state?setTimeout(function(){CmdBus.doCmd(CmdType.O_DGIFT,5)},1200):GmGlobal.mc.guideMgr.hasTask()||setTimeout(function(){CmdBus.doCmd(CmdType.O_DGIFT)},1e3)},t.prototype.reqLcId=function(){this._isReady&&GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.DGIFT_LC,[],this.onLc,this)},t.prototype.onLc=function(t){var e=GmGlobal.mc.dgiftMgr;e.lcId=t,e.lcEndTime=Utils.getNextDatTime(),this.updateLcReddot(),EventBus.dispatchEvt(EventType.DGIFT_LC_UPD)},t.prototype.lcUpdate=function(t){this.updateLcReddot(),EventBus.dispatchEvt(EventType.DGIFT_LC_UPD)},t.prototype.onXs=function(t){var e=t.data.data,i=GmGlobal.mc,s=i.dgiftMgr.redDot.childs[5],o=i.dgiftMgr.getXsAwCfg(e.id);if(o){var n=e.time+o.time,r=GmGlobal.getServerTime();if(n>r){var h=s.state;return s.state=1,void(0==h&&this._isReady&&CmdBus.doCmd(CmdType.O_DGIFT,5))}}s.state=0},t.prototype.onLb=function(){this.updateGiftRedDot(),EventBus.dispatchEvt(EventType.DGIFT_LB)},t.prototype.onLiancUpd=function(t){var e=t.data.data,i=GmGlobal.mc.flMgr;i.liancStates=e.s,i.isPayToday=1==e.c?!0:!1,i.liancDay=e.d||0,this.updateLcRedDot(),EventBus.dispatchEvt(EventType.M_FL_LIANC)},t.prototype.updateLcReddot=function(){var t=GmGlobal.mc;if(t.dgiftMgr.lcId){var e=t.dataMgr.getJData(JsonID.DGIFT_LC).data,i=t.dgiftMgr.getLcCfg(t.dgiftMgr.lcId);if(i){var s=t.dgiftMgr.redDot.childs[3];for(var o in i){var n=Number(o),r=0;if(e.state&&e.state[o]?r=e.state[o]:e.paynum>=n&&(r=1),1==r)return void(s.state=1)}s.state=0}}},t.prototype.updateLcRedDot=function(){var t=GmGlobal.mc,e=GmGlobal.mc.flMgr,i=t.dgiftMgr.redDot.childs[4];i.state=0;for(var s=e.liancCfgs,o=e.liancStates,n=(Utils.getObjectLength(o),0);n<s.length;n++){var r=s[n],h=o[r.day];if(1==h){i.state=1;break}}},t.prototype.updateGiftRedDot=function(){var t=GmGlobal.mc,e=(GmGlobal.mc.flMgr,t.dataMgr.getJData(JsonID.DGIFT_LB).data),i=t.dgiftMgr.redDot.childs[0];1==e.state?i.state=1:i.state=0},t}();__reflect(DayGiftController.prototype,"DayGiftController");var DayGiftLcItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tName.text="Daily Recharge Total "+this.data.id,this.data.num>=this.data.id?this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.num)+"/"+Utils.formatNum(this.data.id),Colors.GREEN)):this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.num)+"/"+Utils.formatNum(this.data.id),Colors.RED)),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,90,!1,!0,!0),this._itemGridCon.addToParent(5,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0),2==this.data.state?(this.bLq.visible=!1,this.ywc.visible=!0,this.tJd.visible=!1):1==this.data.state?(this.ywc.visible=!1,this.bLq.visible=!0,this.bLq.filters=[],this.tJd.visible=!0):(this.ywc.visible=!1,this.bLq.visible=!0,this.bLq.filters=FilterUtils.disabled(),this.tJd.visible=!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(DayGiftLcItem.prototype,"DayGiftLcItem");var DayGiftManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_dgift.json",this.initCfg,this);var t={0:0,1:0,2:0,3:0,4:0,5:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.DGIFT,this.redDot)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.getBuyCfg=function(){return this._cfg.buy},t.prototype.getBuyAw=function(t){return this._cfg.buy[t]},t.prototype.getLcCfg=function(t){return this._cfg.lc[t]},t.prototype.getXsAwCfg=function(t){return this._cfg.xs[t+1]},t.prototype.getGift=function(t){return this._cfg.gift[t]},t}();__reflect(DayGiftManager.prototype,"DayGiftManager");var DayGiftMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.DGIFT,CmdType.O_DGIFT),CmdBus.adListener(CmdType.O_DGIFT,this.onOpenView,this),CmdBus.adListener(CmdType.C_DGIFT,this.onCloseView,this)}return t.prototype.onOpenView=function(t){this._showIndex=t||0,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new DayGiftView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._showIndex)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(DayGiftMediator.prototype,"DayGiftMediator",["IMediator"]);var DayGiftView=function(t){function e(){var e=t.call(this,"DayGiftSkin")||this;return e._tabIndex=-1,e._xsPrice=0,e._xsId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this._buyList=[];var e=GmGlobal.mc.dgiftMgr.getBuyCfg();for(var i in e){var s=Number(i);this._buyList.push(s)}for(var o=1;o<=this._buyList.length&&o<this.tableBgCon.numChildren-1;o++){var n=this.tableTxtCon.getChildAt(o);n.text="$"+this._buyList[o-1]}this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this.liancScoll.verticalScrollBar&&(this.liancScoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="DayGiftLcItemSkin",this.itemList.itemRenderer=DayGiftLcItem,this._liancArray=new eui.ArrayCollection,this.lcitemList.dataProvider=this._liancArray,this.lcitemList.itemRendererSkinName="FuliLcListItemSkin",this.lcitemList.itemRenderer=FuliLcListItem,this.initLiancLst()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemList,this),this.lcitemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.DGIFT_LC_UPD,this.updateLc,this),EventBus.addListener(EventType.M_JUPD+JsonID.DGIFT_XS,this.onXs,this),EventBus.addListener(EventType.M_JUPD+JsonID.DGIFT_LB,this.onXs,this),EventBus.addListener(EventType.DGIFT_LB,this.onLbUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.DGIFT,this.onPayUpd,this),EventBus.addListener(EventType.M_FL_LIANC,this.updLiancLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemList,this),this.lcitemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.DGIFT_LC_UPD,this.updateLc,this),EventBus.rmListener(EventType.M_JUPD+JsonID.DGIFT_XS,this.onXs,this),EventBus.rmListener(EventType.M_JUPD+JsonID.DGIFT_LB,this.onXs,this),EventBus.rmListener(EventType.DGIFT_LB,this.onLbUpd,this),EventBus.rmListener(EventType.M_JUPD+JsonID.DGIFT,this.onPayUpd,this),EventBus.rmListener(EventType.M_FL_LIANC,this.updLiancLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.updateXsTab(),this.updateTabRedDot(),this.bindRedDotCb()},e.prototype.onXs=function(){var t=this.updateXsTab(),e=GmGlobal.mc,i=e.dataMgr.getJData(JsonID.DGIFT_XS).data,s=i.id||0;s!=this._xsId&&this._tabIndex>this._buyList.length&&(t?this.setPage():this.selTab(this._buyList.length)),t&&this.updateTabRedDot()},e.prototype.updateXsTab=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.DGIFT_XS).data,i=t.dgiftMgr.getXsAwCfg(e.id),s=!1;if(i){var o=e.time+i.time,n=GmGlobal.getServerTime();o>n&&(s=!0)}var r=this.tableBgCon.getChildAt(5),h=this.tableTxtCon.getChildAt(5);return r.visible=s,h.visible=s,s},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;t<this.tableBgCon.numChildren;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.onLbUpd=function(){0==this._tabIndex&&this.setPage()},e.prototype.onPayUpd=function(){(1==this._tabIndex||2==this._tabIndex)&&this.setPage()},e.prototype.setPage=function(){this.clearItems();var t=GmGlobal.mc.dgiftMgr;if(0==this._tabIndex){this.payCon.visible=!0,this.lcCon.visible=!1,this.lpayCon.visible=!1,this.tCd.visible=!0,this.ylq.visible=!0,CDText.getInstence().rmCD(this.tCd),this.tCd.text="Top up any Diamonds (Diamonds from Packs not counted) in Mall to claim a daily pack for free.";var e=GmGlobal.mc.dataMgr.getJData(JsonID.DGIFT_LB).data;this.bBuy.label="Claim",Utils.setBtnEnable(this.bBuy,1==e.state?!0:!1),2==e.state?(this.bBuy.visible=!1,this.ylq.visible=!0):(this.bBuy.visible=!0,this.ylq.visible=!1);var i=t.getGift(e.giftid);i&&(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(i.items,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.txtCon,595),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign="center")}else if(this._tabIndex<=this._buyList.length){this.payCon.visible=!0,this.lcCon.visible=!1,this.lpayCon.visible=!1,this.tCd.visible=!0,this.ylq.visible=!1,CDText.getInstence().rmCD(this.tCd);var s=this._buyList[this._tabIndex-1],o=t.getBuyAw(s);this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(o.items,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.txtCon,595),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign="center",this.bBuy.visible=!0,this.bBuy.label="$"+this._buyList[this._tabIndex-1],this._xsPrice=0;var e=GmGlobal.mc.dataMgr.getJData(JsonID.DGIFT).data,n=e[o.giftid]||0,r=o.daynum-n;this.tCd.text="Daily remaining purchases："+r,Utils.setBtnEnable(this.bBuy,r>0?!0:!1)}else if(this._tabIndex==this._buyList.length+1)this.payCon.visible=!1,this.lcCon.visible=!0,this.tCd.visible=!1,this.lpayCon.visible=!1,this.scoll.viewport.scrollV=0,!t.lcId||t.lcEndTime<GmGlobal.getServerTime()?GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.DGIFT_LC,[],this.onLcUpd,this):this.updateLc();else if(this._tabIndex==this._buyList.length+2)this.payCon.visible=!1,this.lcCon.visible=!1,this.tCd.visible=!1,this.lpayCon.visible=!0,this.liancScoll.viewport.scrollV=0,this.updLiancLst();else{this.payCon.visible=!0,this.lcCon.visible=!1,this.lpayCon.visible=!1,this.tCd.visible=!0,this.ylq.visible=!1;var e=GmGlobal.mc.dataMgr.getJData(JsonID.DGIFT_XS).data,h=t.getXsAwCfg(e.id);this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(h.items,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.txtCon,595),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign="center",this.bBuy.label="$"+h.price;var a=e.time+h.time,l=GmGlobal.getServerTime(),c=a-l;c>0&&(this.tCd.visible=!0,CDText.getInstence().addCD(this.tCd,c,"Ends in: ","h:m:s","",this.onXsTimeOut,this)),this._xsPrice=h.price,this._xsId=e.id}},e.prototype.onXsTimeOut=function(){this.updateXsTab()},e.prototype.initLiancLst=function(){for(var t=GmGlobal.mc,e=t.flMgr.liancCfgs,i=0;i<e.length;i++){var s=e[i],o={items:s.items,state:0,txt:"Total recharge "+s.day+" day(s) to obtain",index:i+1};this._liancArray.addItem(o)}},e.prototype.updLiancLst=function(){for(var t=GmGlobal.mc,e=t.flMgr.liancCfgs,i=t.flMgr.liancStates,s=(Utils.getObjectLength(i),-1),o=-1,n=0;n<this._liancArray.length;n++){var r=this._liancArray.getItemAt(n),h=e[n],a=i[h.day];a||(a=0),r.state=a,this._liancArray.itemUpdated(r),-1==s&&1==a&&(s=n),-1==o&&0==a&&(o=n)}var l=0;-1!=s?l=s:-1!=o&&(l=o);var c=166*l,d=160*this._liancArray.length+6*(this._liancArray.length-1);c+this.liancScoll.height>d&&(c=d-this.liancScoll.height),this.liancScoll.viewport.scrollV=c},e.prototype.onTouchList=function(t){var e=GmGlobal.mc;if(t.target.parent.parent==this.lcitemList&&"btn"==t.target.name){var i=t.target.parent,s=e.flMgr.liancCfgs[i.index-1];GmGlobal.cc.dataCtl.doAction(ServerActionId.FL_LIANC,[s.day])}},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onBuy=function(){0==this._tabIndex?GmGlobal.cc.dataCtl.doAction(ServerActionId.DGIFT_GIFT):(this._xsPrice>0?GmGlobal.cc.pfCtl.Pay(100*this._xsPrice,17):GmGlobal.cc.pfCtl.Pay(100*this._buyList[this._tabIndex-1],9),Utils.lockBtn(this.bBuy,2e3))},e.prototype.onLcUpd=function(t){var e=GmGlobal.mc.dgiftMgr;e.lcId=t,e.lcEndTime=Utils.getNextDatTime(),this.updateLc()},e.prototype.updateLc=function(){var t=GmGlobal.mc;if(t.dgiftMgr.lcId){var e=t.dataMgr.getJData(JsonID.DGIFT_LC).data,i=t.dgiftMgr.getLcCfg(t.dgiftMgr.lcId);if(i){for(var s=this.sortList(i,e),o=0;o<s.length;o++){var n=s[o];this._array.length>o?this._array.replaceItemAt(n,o):this._array.addItem(n)}for(;this._array.length>o;)this._array.removeItemAt(o)}}},e.prototype.sortList=function(t,e){var i=[],s=[],o=[];for(var n in t){var r=t[n],h={id:Number(n),num:e.paynum||0,items:r,state:0};e.state&&e.state[n]?h.state=e.state[n]:e.paynum>=h.id&&(h.state=1),1==h.state?i.push(h):2==h.state?s.push(h):o.push(h)}return i.concat(o,s)},e.prototype.onItemList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;e&&1==e.state&&GmGlobal.cc.dataCtl.doAction(ServerActionId.DGIFT_LC,[100*e.id])}},e.prototype.updateTabRedDot=function(){for(var t=GmGlobal.mc.dgiftMgr.redDot,e=0,i=0;6>i;i++){var s=t.childs[i],o=this.tableBgCon.getChildAt(i);e+=0==i||4==i?160:3==i?210:120,1==s.state?RedDotView.addRedDot(o,this.tableBgCon,"dgift",e-20,-4):RedDotView.removeRedDot(o)}},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.dgiftMgr.redDot,e=0;6>e;e++){var i=t.childs[e];i.bindChangeCB(this.updateTabRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.dgiftMgr.redDot,e=0;6>e;e++){var i=t.childs[e];i.unbindChangeCB(this.updateTabRedDot,this)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_DGIFT)},e.prototype.close=function(){RedDotView.removeRedDotByGroup("dgift"),this.unbindRedDotCb(),this._tabIndex=-1,CDText.getInstence().rmCD(this.tCd),t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("fuli_bg_2_jpg"),RES.destroyRes("daygift_bg_jpg")},e}(UIBase);__reflect(DayGiftView.prototype,"DayGiftView");var EqpItem=function(){function t(){}return t}();__reflect(EqpItem.prototype,"EqpItem");var Equip=function(){function t(){}return t}();__reflect(Equip.prototype,"Equip");var EquipController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_EQUIP,this.onUpdateEquip,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EQUIPS,this.onUpdateMEquip,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EQP_CARD,this.onUpdCardUp,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EQP_JL_C,this.onUpdEQPUid,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EITEM,this.onUpdEItem,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EITEMS,this.onUpdEItems,this)}return t.prototype.onUpdateEquip=function(t){var e=t.data.data;GmGlobal.mc.equipMgr.updEqps(e.equipId-1,e),EventBus.dispatchEvt(EventType.M_EQUIP_UPD,e.equipId-1)},t.prototype.onUpdateMEquip=function(t){var e=t.data.data;for(var i in e){var s=e[i],o=Number(i)-1;GmGlobal.mc.equipMgr.updEqps(o,s)}EventBus.dispatchEvt(EventType.M_ELIST_UPD)},t.prototype.onUpdCardUp=function(t){var e=t.data.data,i=GmGlobal.mc.equipMgr;i.cId=e.id-1||0,i.cAtrs=e.attrlst,EventBus.dispatchEvt(EventType.M_ECARD_UPD)},t.prototype.onUpdEQPUid=function(t){var e=t.data.data,i=GmGlobal.mc.equipMgr;i.jlEqpUids={};for(var s in e)i.addJlEqps(Number(s),e[s])},t.prototype.onUpdEItem=function(t){var e=t.data.data,i=GmGlobal.mc.equipMgr;i.updEItems(e.uid,e.data),EventBus.dispatchEvt(EventType.M_EATRS_UPD,e.uid)},t.prototype.onUpdEItems=function(t){var e=t.data.data,i=GmGlobal.mc.equipMgr;for(var s in e)i.updEItems(Number(s),e[s]);EventBus.dispatchEvt(EventType.M_EATRS_UPD)},t}();__reflect(EquipController.prototype,"EquipController");
var EquipJcView=function(t){function e(){var e=t.call(this,"EquipJcSkin")||this;return e._eid=0,e._hecId=-1,e._selList=[],e._selImgPool=[],e._selImg={},e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bfj.label="Inherit",this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(e.ONE_PAGE_NUM,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setEid=function(t){this._eid=t;var e=this._mc.equipMgr.getEqp(this._eid),i=this._mc.equipMgr.getEItem(e.uid);this.micon.source=this._mc.itemMgr.getItemSicon(ItemID.SHUIJING);var s=this._mc.equipMgr.getUpCfg(this._eid),o=s.jlCfg[i.jl-1];this.mtxt.text=o.jccostnum,this.item0.setItem(new Item(e.itemId,1),!1,"",i.jl,e.uid),this.item0.enableTip(!0),this.updSelItems(),this.updateLst()},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP],2),i=this._mc.equipMgr.getEqp(this._eid),s=this._mc.equipMgr.getEqpCfg(i.itemId),o=0;o<e.length;o++){var n=e[o],r=(this._mc.itemMgr.getItemCfg(n.num),this._mc.equipMgr.getEqpCfg(n.num)),h=this._mc.equipMgr.isJlOrCard(n.id);h||r.eid!=s.eid||t.push(n)}if(s.career){for(var a=[],o=0;o<t.length;o++){var n=t[o],r=this._mc.equipMgr.getEqpCfg(n.num);if(r.career)for(var l=0;l<s.career.length;l++){var c=s.career[l];if(-1!=r.career.indexOf(c)){a.push(n);break}}else a.push(n)}return a}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.onTouchItemGrid=function(t){return this._selList.length>=1&&-1==this._selList.indexOf(t.uid)?void MsgBox.prompt("Selected items"):void(!this._selList||this._selList.length<=0?this.setItemSelState(t,!this.isSel(t.uid)):this.setItemSelState(t,!this.isSel(t.uid)))},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]);for(var o in this._selImg){var n=this._selImg[o];n&&(n.visible=!1)}for(var r=t;i>r;r++){var h=this._itemList[r];s.push(h);var n=this._selImg[h.id];n&&(n.visible=!0)}this._itemGridCon.setItems(s)}},e.prototype.updSelItems=function(){if(this._selList.length>=1){Utils.setBtnEnable(this.bfj,!0);var t=this._selList[0],e=this._mc.itemMgr.getItem(t),i=this._mc.equipMgr.getEqp(this._eid),s=this._mc.equipMgr.getEItem(i.uid);this.item1.setItem(new Item(e.num,1),!1,"",s.jl,t),this.item1.enableTip(!0)}else Utils.setBtnEnable(this.bfj,!1),this.item1.setItem(null),this.item1.enableTip(!1)},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t];this._selList.length>0&&-1!=this._selList.indexOf(i.uid)?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}},e.prototype.setItemSelState=function(t,e){var i=this._selList.indexOf(t.uid);if(e){if(i>=0)return;this._selList.push(t.uid);var s=this.getSelImg();s.x=t.icon.x+t.icon.width-31,s.y=t.icon.y-10,this.selCon.addChild(s),this._selImg[t.uid]=s}else{if(-1==i)return;this._selList.splice(i,1);var s=this._selImg[t.uid];this.selCon.removeChild(s),this._selImgPool.push(s),delete this._selImg[t.uid]}this.updSelItems()},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._selImg[i];s&&(s.visible=!0,this._selImgPool.push(s),delete this._selImg[i],this.selCon.removeChild(s))}this._selList=[]},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onFj=function(){this.bfj.touchEnabled=!1,this.showQhEft()},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("yingzijl"),this.addChild(this._eft),this._eft.x=this.item1.x+Math.floor(this.item1.width/2),this._eft.y=this.item1.y+Math.floor(this.item1.height/2)),this._eft.visible=!0,this._eft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._eft.visible=!1,this._cc.dataCtl.doAction(ServerActionId.EQP_JC,[this._eid+1,this._selList[0]],this.hcOk,this),this.bfj.touchEnabled=!0},e.prototype.hcOk=function(){var t=this._mc.equipMgr.getEItem(this._selList[0]),e=this._mc.itemMgr.getItem(this._selList[0]);AwardTipView.showAward([e],null,null,null,null,"Gear inherited",[t.jl]),this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_EQUIP_JC)},e.prototype.close=function(){this._eft&&(this._eft.clear(),this._eft=null),this._page=1,this._maxPage=1,this.clearSelList(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=10,e}(UIBase);__reflect(EquipJcView.prototype,"EquipJcView");var EquipManager=function(){function t(){this._eqpItems={},this.jlEqpUids={},this._zxCfgs={},this.tlRule="",this.tlCfgs={},this.hcRule="",this.rule="",this.equips=[],this.cards=[],this.cId=0,this.clickIdx=0,this.clickCid=0,GmGlobal.mc.regUnzipCfg("c_equip.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_equip_up.json",this.initUpCfg,this),GmGlobal.mc.regUnzipCfg("c_equip_hc.json",this.initHcCfg,this),GmGlobal.mc.regUnzipCfg("c_equip_tl.json",this.initTlCfg,this),GmGlobal.mc.regUnzipCfg("c_equip_zx.json",this.initZxCfg,this),GmGlobal.mc.regUnzipCfg("c_tz.json",this.initTzCfg,this),this._equips={},this._eqpItems={},this.jlEqpUids={}}return t.prototype.initCfg=function(t){this._eqpCfgs=t.equips,this._cardCfgs=t.cards},t.prototype.initUpCfg=function(t){this.rule=t.shuoming,this._upCfgs=t.upCfg,this._cardUpCfgs=t.cardCfg},t.prototype.initHcCfg=function(t){this._eqpHcCfgs=t.equips,this.hcRule=t.rule},t.prototype.initTlCfg=function(t){this.tlRule=t.rule,this.tlCfgs=t.xhItems,this.tlCost=t.pttlcost},t.prototype.initZxCfg=function(t){this._zxCfgs=t},t.prototype.getZxCfg=function(t){return this._zxCfgs[t]},t.prototype.getTlXhItems=function(t){return this.tlCfgs[t]},t.prototype.getHcCfg=function(t){return this._eqpHcCfgs[t]},t.prototype.getCardCfg=function(t){return this._cardCfgs[t]},t.prototype.getCardUpCfgs=function(t){return this._cardUpCfgs[t]},t.prototype.getEqpCfg=function(t){return this._eqpCfgs[t]},t.prototype.getUpCfg=function(t){return this._upCfgs[t]},t.prototype.getTzCfg=function(t){return this._tzCfg[t]},t.prototype.initTzCfg=function(t){this._tzCfg=t},t.prototype.updEqps=function(t,e){var i=this.getEqp(t);i||(i=new Equip),i.dzattrlst=e.dzattrlst,i.grid=t||0,i.itemId=e.itemid,i.qhLv=e.qh||0,i.uid=e.uid,this._equips[t]=i},t.prototype.getEqpByUid=function(t){var e;for(var i in this._equips){var s=this._equips[i];if(s.uid==t){e=s;break}}return e},t.prototype.getEqp=function(t){return this._equips[t]},t.prototype.updEItems=function(t,e){if(e.owner&&e.owner!=GmGlobal.mc.role.roleId)return this.otherEItem||(this.otherEItem=new EqpItem),this.otherEItem.battr=e.battr,this.otherEItem.qattr=e.qattr,this.otherEItem.qattrTemp=e.qattr1,this.otherEItem.jl=e.jl||0,this.otherEItem.cardlst=e.cardlst,this.otherEItem.uid=t,this.otherEItem.id=e.id,void(this.otherEItem.owner=e.owner);var i=this.getEItem(t);i||(i=new EqpItem),i.battr=e.battr,i.qattr=e.qattr,i.qattrTemp=e.qattr1,i.jl=e.jl||0,i.cardlst=e.cardlst,i.uid=t,i.id=e.id,this._eqpItems[t]=i},t.prototype.getEItem=function(t){return this._eqpItems[t]},t.prototype.getEqpListByEid=function(t,e){var i=GmGlobal.mc.itemMgr.getItemListByType([t]),s=[];10==e&&(e=9);for(var o=0;o<i.length;o++){var n=i[o],r=this._eqpCfgs[n.num],h=GmGlobal.mc.role.careerId;e==r.eid&&(r.career?-1!=r.career.indexOf(h)&&s.push(n):s.push(n))}return s},t.prototype.getCardListByEid=function(t,e){var i=GmGlobal.mc.itemMgr.getItemListByType([t]),s=[];10==e&&(e=9);for(var o=0;o<i.length;o++){var n=i[o],r=this._cardCfgs[n.id];r&&1==r.type&&(r.eid?e==r.eid&&s.push(n):s.push(n))}return s},t.prototype.getEqpZl=function(t){var e=0;return e},t.prototype.getIdxByUid=function(t){var e=-1;for(var i in this._equips.length){var s=this._equips[i];if(s.uid==t){e=s.grid;break}}return e},t.prototype.addJlEqps=function(t,e){e?this.jlEqpUids[t]=e:this.jlEqpUids[t]=-1},t.prototype.isJlOrCard=function(t){var e=this.getEItem(t);return e?e.cardlst&&!Utils.isEmptyObj(e.cardlst)?-1:e.jl:this.jlEqpUids[t]},t.prototype.getJlLv=function(t){var e=0,i=GmGlobal.mc.equipMgr.getEItem(t);if(i&&!Utils.isEmptyObj(i))e=i.jl||0;else{var s=this.jlEqpUids[t];s&&s>0&&(e=s)}return e},t.prototype.getQlvStr=function(t){switch(t){case 1:return"1";case 2:return"2";case 3:return"3";case 4:return"4";case 5:return"5";case 6:return"6";case 7:return"7";case 8:return"8";case 9:return"9";case 10:return"10";case 11:return"Brave";case 12:return"Dark Knight";case 13:return"Holy War";default:return""}},t.prototype.getTzList=function(t){var e=[];for(var i in this._eqpCfgs){var s=this._eqpCfgs[i];s.tz==t&&e.push(s.id)}return e},t.prototype.getTzEquips=function(t){var e=[];for(var i in this._equips){var s=this._equips[i],o=this._eqpCfgs[s.itemId];o&&o.tz==t&&e.push(s.itemId)}return e},t}();__reflect(EquipManager.prototype,"EquipManager");var EquipMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.EQUIP,CmdType.O_EQUIP),CmdBus.adListener(CmdType.O_EQUIP,this.onOpenView,this),CmdBus.adListener(CmdType.C_EQUIP,this.onCloseView,this),CmdBus.adListener(CmdType.O_EQUIP_JC,this.onOpenTipView,this),CmdBus.adListener(CmdType.C_EQUIP_JC,this.onCloseTipView,this)}return t.prototype.onOpenView=function(t){void 0===t&&(t=0),this._idx=t,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new EquipView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._idx)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenEqpView=function(t,e,i){this._eqpUi||(this._eqpUi=new EquipWearlView),this._eqpUi.isShow||(this._eqpUi.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._eqpUi.setIdx(t,e,i)},t.prototype.onCloseEqpView=function(){this._eqpUi&&this._eqpUi.isShow&&this._eqpUi.close()},t.prototype.onOpenTipView=function(t){this._jcUi||(this._jcUi=new EquipJcView),this._jcUi.isShow||(this._jcUi.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._jcUi.setEid(t)},t.prototype.onCloseTipView=function(){this._jcUi&&this._jcUi.isShow&&this._jcUi.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._eqpUi&&(this._eqpUi.destroy(),this._eqpUi=null),this._jcUi&&(this._jcUi.destroy(),this._jcUi=null),!0):!1:!0},t}();__reflect(EquipMediator.prototype,"EquipMediator",["IMediator"]);var EquipTlView=function(t){function e(){var e=t.call(this,"EquipTlSkin")||this;return e._xhIds=[ItemID.GOLD,ItemID.STONE_GJTL,ItemID.STONE_TL],e._hecId=-1,e._selImg={},e._page=1,e._maxPage=1,e._isGjTl=!1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(20,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){this.x=35,this.y=100},e.prototype.addEvts=function(){this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.btl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTl,this),this.bSwitch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.bSave.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSave,this);for(var t=0;5>=t;t++)this["lock"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLock,this);EventBus.addListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.rmEvts=function(){this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.btl.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTl,this),this.bSwitch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.bSave.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSave,this);for(var t=0;5>=t;t++)this["lock"+t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLock,this);EventBus.rmListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),Utils.setBtnEnable(this.bSave,!1),this.updateLst(),this.resetLockState(),this._isGjTl=!1,this.updSelItems(),this.clearTlAttr()},e.prototype.updateTlSBtn=function(){this._isGjTl?this.bSwitch.label="Premium":this.bSwitch.label="Normal"},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP]),i=0;i<e.length;i++){var s=e[i],o=this._mc.equipMgr.tlCfgs[s.num];o&&t.push(s)}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.onTouchItemGrid=function(t){return this._selUid==t.uid?void this.setItemSelState(t,!1):(this._isGjTl||this.clearSaveData(),void this.selGrid(t))},e.prototype.selGrid=function(t){if(this._selUid){var e=this.getGridByUid(this._selUid);this.setItemSelState(e,!1)}this.setItemSelState(t,!0)},e.prototype.getGridByUid=function(t){for(var e=0,i=this._itemGridCon.grids;e<i.length;e++){var s=i[e];if(t==s.uid)return s}},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]),o=[];for(var n in this._selImg){var r=this._selImg[n];r&&(r.visible=!1)}for(var h=t;i>h;h++){var a=this._itemList[h],l=GmGlobal.mc.equipMgr.getJlLv(a.id);o.push(l),s.push(a);var r=this._selImg[a.id];r&&(r.visible=!0)}this._itemGridCon.setItems(s,!1,"",o)}},e.prototype.onLock=function(t){this._lockState||(this._lockState={});var e=0;t.target==this.lock0?e=0:t.target==this.lock1?e=1:t.target==this.lock2?e=2:t.target==this.lock3?e=3:t.target==this.lock4?e=4:t.target==this.lock5&&(e=5),this._lockState[e]?(this._lockState[e]=0,this["lock"+e].source="com_json.unlock"):(this._lockState[e]=1,this["lock"+e].source="com_json.lock");var i=this._mc.itemMgr.getItem(this._selUid),s=this._mc.equipMgr.getTlXhItems(i.num),o=this.getCostScale();this.item0.setItem(new Item(s[0],Math.ceil(s[1]*o)),!0),this.item0.enableTip(!0),this.item2.setItem(new Item(s[2],Math.ceil(s[3]*o)),!0),this.item2.enableTip(!0),this.updatePtTlBtnState()},e.prototype.updatePtTlBtnState=function(){for(var t=!0,e=0;5>=e;e++){var i=this["lock"+e];if(i.visible&&!this._lockState[e]){t=!1;break}}Utils.setBtnEnable(this.btl,!t)},e.prototype.resetLockState=function(){this._lockState={};for(var t=0;5>=t;t++)this["lock"+t].source="com_json.unlock"},e.prototype.updPtTl=function(){if(this.qCon.visible=!0,this.item1.visible=!1,this.bSave.visible=!0,this.jt.visible=!1,this.item.x=266,this.item.y=5,this.item0.x=370,this.item0.y=115,this.item2.x=162,this.item2.y=115,this.btl.x=431,this.btl.y=463,this._selUid){var t=this._mc.itemMgr.getItem(this._selUid),e=this._mc.equipMgr.getTlXhItems(t.num);this.item.setItem(new Item(t.num,1),!1,"",null,this._selUid),this.item.enableTip(!0);var i=this.getCostScale();this.item0.setItem(new Item(e[0],Math.ceil(e[1]*i)),!0),this.item0.enableTip(!0),this.item2.setItem(new Item(e[2],Math.ceil(e[3]*i)),!0),this.item2.enableTip(!0);var s=this._mc.equipMgr.getEItem(this._selUid);s?this.updCQAttr():this._cc.dataCtl.doAction(ServerActionId.EQP_REQ_ATR,[this._mc.role.roleId,this._selUid],this.updCQAttr,this)}else this.item.setItem(null),this.item.enableTip(!1),this.item0.setItem(null),this.item0.enableTip(!1),this.item2.setItem(null),this.item2.enableTip(!1),this.qCon.visible=!1},e.prototype.getCostScale=function(){var t=1,e=0;if(this._lockState)for(var i in this._lockState)this._lockState[i]&&e++;if(e){var s=this._mc.equipMgr.tlCost;t=s[e]}return t},e.prototype.updCQAttr=function(){this.qCon.visible=!0;var t=this._mc.equipMgr.getEItem(this._selUid),e=0;if(t){var i=t.qattr;if(i&&!Utils.isEmptyObj(i)){i.ele?(this.cys.text=Utils.getWx(i.ele),this.lock5.visible=!0):(this.cys.text="",this.lock5.visible=!1);for(var s in i){var o=GmGlobal.mc.heroMgr.getAtrName(s),n=GmGlobal.mc.heroMgr.isAddJia(s),r=GmGlobal.mc.heroMgr.isNdPre(s);if("ele"!=s){var h=o;n&&(h+="+"),h+=i[s],r&&(h+="%"),this["cattr"+e].text=h,this["cbg"+e].visible=!0,this["cbg"+e].width=this["cattr"+e].width+10,this["lock"+e].visible=!0,e++}}}}for(e;5>e;e++)this["cattr"+e].text="",this["cbg"+e].visible=!1,this["lock"+e].visible=!1},e.prototype.updTlQAttr=function(){var t=this._mc.equipMgr.getEItem(this._selUid),e=0;if(t){var i=t.qattrTemp;if(i&&!Utils.isEmptyObj(i)){i.ele?this.nys.text=Utils.getWx(i.ele):this.nys.text="";var s=[],o=[],n=t.qattr,r=Object.keys(n),h=r.indexOf("ele");-1!=h&&r.splice(h,1);for(var a=0;a<r.length;a++)if(this._lockState[a]){var l=r[a];s.push(a),o.push(l),this.setNItem(a,l,i[l])}var c=r.length;for(e=0;c>e;e++)if(-1==s.indexOf(e))for(var d in i)if("ele"!=d&&-1==o.indexOf(d)){s.push(e),o.push(d),this.setNItem(e,d,i[d]);break}}else Utils.setBtnEnable(this.bSave,!1)}for(e;5>e;e++)this["nattr"+e].text="",this["nbg"+e].visible=!1},e.prototype.setNItem=function(t,e,i){var s=GmGlobal.mc.heroMgr.getAtrName(e),o=GmGlobal.mc.heroMgr.isAddJia(e),n=GmGlobal.mc.heroMgr.isNdPre(e),r=s;o&&(r+="+"),r+=i,n&&(r+="%"),this["nattr"+t].text=r,this["nbg"+t].visible=!0,this["nbg"+t].width=this["nattr"+t].width+10},e.prototype.clearTlAttr=function(){for(var t=0;5>t;t++)this["nattr"+t].text="",this["nbg"+t].visible=!1;this.nys.text=""},e.prototype.updGjTl=function(){if(this.qCon.visible=!1,this.item1.visible=!0,this.bSave.visible=!1,this.jt.visible=!0,this.item.x=131,this.item.y=63,this.item0.x=352,this.item0.y=228,this.item2.x=184,this.item2.y=228,this.btl.x=325,this.btl.y=427,this._selUid){var t=this._mc.itemMgr.getItem(this._selUid),e=this._mc.equipMgr.getTlXhItems(t.num);this.item.setItem(new Item(t.num,1),!1,"",null,this._selUid),this.item.enableTip(!0),this.item0.setItem(new Item(e[4],e[5]),!0),this.item0.enableTip(!0),this.item2.setItem(new Item(e[6],e[7]),!0),this.item2.enableTip(!0),this.item1.setItem(new Item(e[8],1),!1),this.item1.enableTip(!0)}else this.item.setItem(null),this.item.enableTip(!1),this.item0.setItem(null),this.item0.enableTip(!1),this.item2.setItem(null),this.item2.enableTip(!1)},e.prototype.updSelItems=function(){var t=this._selUid;if(t){var e=this._mc.itemMgr.getItem(t),i=this._mc.equipMgr.getTlXhItems(e.num);0==i[8]&&(this._isGjTl=!1,this.updateTlSBtn())}this._isGjTl?(this.updGjTl(),Utils.setBtnEnable(this.btl,!0)):(this.updPtTl(),this.updatePtTlBtnState())},e.prototype.updateItemSelState=function(){if(this._selUid){var t=this.getGridByUid(this._selUid);t?this.setItemSelState(t,!0):this.isel.visible=!1}else this.isel.visible=!1},e.prototype.setItemSelState=function(t,e){e?(this._selUid=t.uid,this.isel.x=t.icon.x+t.icon.width-31+this.itemCon.x,this.isel.y=t.icon.y-10+this.itemCon.y,this.isel.visible=!0):(this._selUid=0,this.isel.visible=!1),this.updSelItems()},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onTl=function(){this._selUid&&(this.btl.touchEnabled=!1,this.showQhEft())},e.prototype.onSwitch=function(){this._isGjTl=!this._isGjTl,this.updateTlSBtn(),this.updSelItems()},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("yingzijl"),this.addChild(this._eft)),this._eft.x=this.item.x+Math.floor(this.item.width/2),this._eft.y=this.item.y+Math.floor(this.item.height/2),this._eft.visible=!0,this._eft.play(1,this.doTl,this)},e.prototype.getLockArgs=function(){var t=[],e=this._mc.equipMgr.getEItem(this._selUid);if(e){var i=e.qattr;if(i&&!Utils.isEmptyObj(i)){i.ele&&this._lockState[5]&&t.push(15);var s=Object.keys(i),o=s.indexOf("ele");-1!=o&&s.splice(o,1);for(var n=0;n<s.length;n++)if(this._lockState[n]){var r=this._mc.heroMgr.getIdByAtr(s[n])+1;t.push(r)}}}return t},e.prototype.doTl=function(){this._eft.visible=!1;var t=[5,this._selUid,this._isGjTl?1:0,1];if(!this._isGjTl){var e=this.getLockArgs();t=t.concat(e)}this._cc.dataCtl.doAction(ServerActionId.CARD_HC,t,this.tlOk,this),this.btl.touchEnabled=!0;this._selUid},e.prototype.tlOk=function(){this._isGjTl?this.clearSaveData():(Utils.setBtnEnable(this.bSave,!0),this.updTlQAttr()),this.updSelItems()},e.prototype.onSave=function(){this._cc.dataCtl.doAction(ServerActionId.EQP_TL_S,[this._selUid],this.clearSaveData,this)},e.prototype.clearSaveData=function(){Utils.setBtnEnable(this.bSave,!1),this.clearTlAttr(),this.resetLockState(),this.updPtTl(),this.updatePtTlBtnState()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.equipMgr.tlRule)},e.prototype.close=function(){if(t.prototype.close.call(this),this._page=1,this._maxPage=1,this._selUid){var e=this.getGridByUid(this._selUid);this.setItemSelState(e,!1)}this._selUid=0},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(EquipTlView.prototype,"EquipTlView");var EquipView=function(t){function e(){var e=t.call(this,"EquipViewSkin")||this;return e._gxState=!0,e._qhNum=0,e._dzLv=0,e._pDzLv=0,e._dzIdx=0,e._bTxts=[],e._tabIndex=-1,e._gIdx=0,e._cIdx=0,e._cSelIdx=0,e._cNums=[4,6,8],e._cY=[648,616,585],e._cH=[106,169,232],e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e._bTxts=["Enhance","Refine","Forge"],e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBEqp,this),this.dzCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDz,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bQh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQh,this),this.bQhTen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQhTen,this),this.bUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.bLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.bgAtrsCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCardAtrs,this),this.stone.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGx,this),EventBus.addListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.addListener(EventType.M_HERO_UPD,this.updateHeroInfo,this),EventBus.addListener(EventType.M_ECARD_UPD,this.updCardPanel,this),EventBus.addListener(EventType.M_EQUIP_UPD,this.updOneEqp,this),EventBus.addListener(EventType.M_UPD_CON,this.updItems,this),EventBus.addListener(EventType.M_EATRS_UPD,this.updOneEqpItem,this),EventBus.addListener(EventType.M_R_Z_UPD,this.onZhanliUp,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBEqp,this),this.dzCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDz,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bQh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQh,this),this.bQhTen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQhTen,this),this.bUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.bLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.bgAtrsCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCardAtrs,this),this.stone.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGx,this),EventBus.rmListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.rmListener(EventType.M_HERO_UPD,this.updateHeroInfo,this),EventBus.rmListener(EventType.M_ECARD_UPD,this.updCardPanel,this),EventBus.rmListener(EventType.M_EQUIP_UPD,this.updOneEqp,this),EventBus.rmListener(EventType.M_UPD_CON,this.updItems,this),EventBus.rmListener(EventType.M_EATRS_UPD,this.updOneEqpItem,this),EventBus.rmListener(EventType.M_R_Z_UPD,this.onZhanliUp,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null;for(var e=0;10>e;e++){var i=this.itemCon.getChildAt(e);9==e?i.iItem.source="hero_json.hero_item8":i.iItem.source="hero_json.hero_item"+e}},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this._gxState=!0,this.updateRoleInfo(),this.updEqps(),this.updateHeroInfo();var i=this.getGirdIdx();this.selGird(i),egret.setTimeout(this.checkGuide,this,100),this.onZhanliUp(),this.alphaShow()},e.prototype.onZhanliUp=function(){var t=this._mc.heroMgr.getAtrValue("z");this.tZl.text="Power："+t},e.prototype.updItems=function(){this.updGrid(),this.updCardPanel()},e.prototype.getGirdIdx=function(){for(var t=0,e=0;10>e;e++){var i=this._mc.equipMgr.getEqp(e);if(i&&i.itemId){t=e;break}}return t},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData)if(t.guideData.id==GuideID.EQUIPE_STRONG)GmGlobal.mc.guideMgr.isSimpleGuide()?t.clearGuide():(t.bindTarget(GuideTargetId.EQUIP_QH,this.bQh,this.bQh.parent.localToGlobal(this.bQh.x,this.bQh.y)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y)));else if(t.guideData.id==GuideID.EQUIPE_JL){var e=this.tableBgCon.getChildAt(1),i=this.x+this.tableBgCon.x+120,s=this.y+this.tableBgCon.y;t.bindTarget(GuideTargetId.TAB_SEL,e,new egret.Point(i,s))}else if(t.guideData.id==GuideID.EQUIPE_DZ){var e=this.tableBgCon.getChildAt(2),i=this.x+this.tableBgCon.x+240,s=this.y+this.tableBgCon.y;t.bindTarget(GuideTargetId.TAB_SEL,e,new egret.Point(i,s))}},e.prototype.bindBtnGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&(t.guideData.id==GuideID.EQUIPE_JL?t.bindTarget(GuideTargetId.JL_BTN,this.bQh,this.bQh.parent.localToGlobal(this.bQh.x,this.bQh.y)):t.guideData.id==GuideID.EQUIPE_DZ&&t.bindTarget(GuideTargetId.DZ_BTN,this.bQh,this.bQh.parent.localToGlobal(this.bQh.x,this.bQh.y)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y)))},e.prototype.updateRoleInfo=function(){var t=GmGlobal.mc.role;this.tName.text=t.name,this.iHero.source=this._mc.heroMgr.getHeroUIModel2(t.careerId)},e.prototype.updOneEqp=function(t){var e=t.data,i=this.itemCon.getChildAt(e),s=this._mc.equipMgr.getEqp(e);if(s){s.uid?(i.iItem.source=this._mc.itemMgr.getItemIcon(s.itemId),i.iItemk.source=this._mc.itemMgr.getItemIconK(s.itemId),i.tQh.text=s.qhLv.toString()):(i.iItemk.source=this._mc.itemMgr.getItemIconK(0),9==e?i.iItem.source="hero_json.hero_item8":i.iItem.source="hero_json.hero_item"+e),s.qhLv?i.tQh.visible=!0:i.tQh.visible=!1;var o=this._mc.itemMgr.getItemCfg(s.itemId);o?i.star.visible=o.isBoss:i.star.visible=!1}this.updEqps(),this.updGrid()},e.prototype.updEqps=function(){for(var t=0;10>t;t++){var e=this.itemCon.getChildAt(t),i=this._mc.equipMgr.getEqp(t);if(i){if(i.uid){var s=this._mc.equipMgr.getEItem(i.uid);e.iItem.source=this._mc.itemMgr.getItemIcon(i.itemId),e.iItemk.source=this._mc.itemMgr.getItemIconK(i.itemId),e.tQh.text=i.qhLv.toString(),s&&s.jl?(e.tJl.visible=!0,e.tJl.text="+"+s.jl):e.tJl.visible=!1}else e.iItemk.source=this._mc.itemMgr.getItemIconK(0),9==t?e.iItem.source="hero_json.hero_item8":e.iItem.source="hero_json.hero_item"+t,e.tJl.visible=!1;i.qhLv?(e.tQh.visible=!0,e.tQh.text=i.qhLv.toString()):e.tQh.visible=!1;var o=this._mc.itemMgr.getItemCfg(i.itemId);o?e.star.visible=o.isBoss:e.star.visible=!1}else e.iItemk.source=this._mc.itemMgr.getItemIconK(0),9==t?e.iItem.source="hero_json.hero_item8":e.iItem.source="hero_json.hero_item"+t,e.tJl.visible=!1,e.tQh.visible=!1,e.star.visible=!1}},e.prototype.updOneEqpItem=function(t){var e=t.data;if(e){var i=this._mc.equipMgr.getEItem(e),s=this._mc.equipMgr.getEqpByUid(e);if(s){var o=this.itemCon.getChildAt(s.grid);i&&i.jl?(o.tJl.text="+"+i.jl,o.tJl.visible=!0):o.tJl.visible=!1,this.updGrid()}}},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e);var i=GmGlobal.vmc.mGuide;i.guideData&&(GmGlobal.vmc.mGuide.triggerTarget(t.target),i.guideData.id==GuideID.EQUIPE_JL?GmGlobal.mc.guideMgr.isSimpleGuide()?i.clearGuide():this.bindBtnGuide():i.guideData.id==GuideID.EQUIPE_DZ&&(GmGlobal.mc.guideMgr.isSimpleGuide()?i.clearGuide():this.bindBtnGuide()))}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t,this.bQh.label=this._bTxts[t],3==t?(this.cardCon.visible=!0,this.eqpCon.visible=!1,this.itemCon.visible=!1,this.iHero.visible=!1,this.tName.visible=!1,this.bgName.visible=!1,this.iSel.visible=!1,this.bQhTen.visible=!1,this._cIdx=this._mc.equipMgr.cId,this._cIdx>2&&(this._cIdx=2),this.updCardPanel(),this.tZl.visible=!1,this._tlView&&this._tlView.close()):4==t?(this.cardCon.visible=!1,this.eqpCon.visible=!1,this.itemCon.visible=!1,this.iHero.visible=!1,this.tName.visible=!1,this.bgName.visible=!1,this.iSel.visible=!1,this.bQhTen.visible=!1,this.tZl.visible=!1,this._tlView?this._tlView.show(this):(this._tlView=new EquipTlView,this._tlView.show(this))):(this.cardCon.visible=!1,this.eqpCon.visible=!0,this.itemCon.visible=!0,this.iHero.visible=!0,this.tName.visible=!0,this.bgName.visible=!0,this.iSel.visible=!0,this.stone.visible=1==t?!0:!1,this.gx.visible=1==t?!0:!1,2==t?(this.dzCon.visible=!0,this.qhCon.visible=!1):(this.dzCon.visible=!1,this.qhCon.visible=!0),0==t?(this.bQhTen.visible=!0,this.bQh.y=410,this.bQhTen.label="Enhance 10 Times"):1==t?(this.bQh.y=410,this.bQhTen.label="Inherit",this._mc.role.lv>=55?this.bQhTen.visible=!0:this.bQhTen.visible=!1):(this.bQhTen.visible=!1,this.bQh.y=440),this.updGrid(),this.tZl.visible=!0,this._tlView&&this._tlView.close())
}},e.prototype.updateHeroInfo=function(){var t=this._mc.role;this._mc.heroMgr.getHeroLvAtr(t.lv)},e.prototype.onBEqp=function(t){var e=t.target.parent;if(e.parent==this.itemCon){var i=this.itemCon.getChildIndex(e);if(this.selGird(i),"icon"==t.target.name){var s=this._mc.equipMgr.getEqp(i);s.uid?(this._mc.equipMgr.clickIdx=i,EquipTips.show(s.uid,this.x+150,this.y+160,ModelID.EQUIP,null,null,null,1)):CmdBus.doCmd(CmdType.O_HERO_EQP,0,i)}}},e.prototype.onDz=function(t){var e=t.target,i=Utils.getNameIndex(e.name);-1!=i&&this.selDzTab(i)},e.prototype.selDzTab=function(t){if(t!=this._dzIdx){this._dzIdx=t;var e=this["bgDz"+t];this.xzk.x=e.x-5,this.xzk.y=e.y-5,this.updGrid()}},e.prototype.selGird=function(t){if(t!=this._gIdx){this._gIdx=t;var e=this.itemCon.getChildAt(t);this.iSel.x=e.x+40,this.iSel.y=e.y+100,this.updGrid()}},e.prototype.updGrid=function(){var t=this._mc.equipMgr.getEqp(this._gIdx);if(this.initAtr(),t){var e=this._mc.equipMgr.getEItem(t.uid);this.item.visible=!0,this.tIname.visible=!0,this.tOkNum.visible=!0,Utils.setBtnEnable(this.bQh,!0),Utils.setBtnEnable(this.bQhTen,!0);var i=this._mc.equipMgr.getUpCfg(this._gIdx);if(t.itemId){this.itemIconCon.visible=!0,this.itemTextCon.visible=!0,this.item.iItem.source=this._mc.itemMgr.getItemIcon(t.itemId),this.item.iItemk.source=this._mc.itemMgr.getItemIconK(t.itemId);var s=this._mc.itemMgr.getItemCfg(t.itemId);this.item.star.visible=s.isBoss,this.tIname.text=s.name,e&&e.jl?(this.item.tJl.visible=!0,this.item.tJl.text="+"+e.jl):this.item.tJl.visible=!1;var o=i.jlCfg[e.jl];o||(o=i.jlCfg[e.jl-1],1==this._tabIndex&&(Utils.setBtnEnable(this.bQh,!1),Utils.setBtnEnable(this.bQhTen,!1))),e.jl<1&&1==this._tabIndex&&Utils.setBtnEnable(this.bQhTen,!1);var n=0;e.jl>0&&(n=e.jl-1);var r=i.jlCfg[n];if(1==this._tabIndex){this.bgTit.width=300,this.tOkNum.width=300,this.bgTit.x=45,this.tOkNum.x=45;var h=o.atrs[s.quality-1],a=r.atrs[s.quality-1],l=0;for(var c in h){var d=this._mc.heroMgr.getAtrName(c),p=this["tMs"+l],u=this["tMs"+(l+2)];p.text=d,u.text=d;var m=this["tMsNum"+l],_=this["tMsNum"+(l+2)];e.jl?m.text="+"+a[c]+"%":m.text="+0%",_.text="+"+h[c]+"%",p.visible=!0,u.visible=!0,m.visible=!0,_.visible=!0,p.x+p.width>=130?(m.x=p.x+p.width+10,_.x=p.x+p.width+10):(m.x=135,_.x=135),l++}var g=this.tMs0,f=this.tMsNum0,v=this.tMs2,y=this.tMsNum2;if(2>l?(g.y=60,f.y=60,v.y=285,y.y=285):(g.y=35,f.y=35,v.y=260,y.y=260),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(o.items.length,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTextCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.setItems(o.items,!0),o.protectstone){this.stone.visible=!0,this.gx.visible=!0,this.stone.setItem(new Item(ItemID.STONE_JL,o.protectstone),!0);var C=this._mc.itemMgr.getItemNum(ItemID.STONE_JL);C<o.protectstone,this.gx.source=1==this._gxState?"com_json.sel_1":"com_json.sel_0"}else this.stone.visible=!1,this.gx.visible=!1;var T="Success Rate "+o.ms[0]+"  \nBreak Rate "+o.ms[1];this._gxState&&(T="Success Rate "+o.ms[0]+"  \nBreak Rate: None"),this.tOkNum.text=T}}else this.item.visible=!1,this.tIname.visible=!1,this.tOkNum.visible=!1,this.itemIconCon.visible=!1,this.itemTextCon.visible=!1,Utils.setBtnEnable(this.bQh,!1),Utils.setBtnEnable(this.bQhTen,!1),this.gx.visible=!1,this.stone.visible=!1;this.item.tQh.text=t.qhLv.toString(),t.qhLv?this.item.tQh.visible=!0:this.item.tQh.visible=!1;var b=i.qhCfg[t.qhLv];b||(b=i.qhCfg[t.qhLv-1],0==this._tabIndex&&(Utils.setBtnEnable(this.bQh,!1),Utils.setBtnEnable(this.bQhTen,!1)));var I=0;t.qhLv>0&&(I=t.qhLv-1);var E=i.qhCfg[I];if(0==this._tabIndex){this.tOkNum.text="Success Rate \n"+b.rate+"%",this.tOkNum.width=180,this.bgTit.width=180,this.bgTit.x=105,this.tOkNum.x=105;var h=b.atrs,a=E.atrs,l=0;for(var c in h){var d=this._mc.heroMgr.getAtrName(c),p=this["tMs"+l],u=this["tMs"+(l+2)];p.visible=!0,u.visible=!0,p.text=d,u.text=d;var m=this["tMsNum"+l],_=this["tMsNum"+(l+2)];m.visible=!0,_.visible=!0,t.qhLv?m.text="+"+a[c]:m.text="+0",_.text="+"+h[c],p.x+p.width>=130?(m.x=p.x+p.width+10,_.x=p.x+p.width+10):(m.x=135,_.x=135),l++}var g=this.tMs0,f=this.tMsNum0,v=this.tMs2,y=this.tMsNum2;2>l?(g.y=60,f.y=60,v.y=285,y.y=285):(g.y=35,f.y=35,v.y=260,y.y=260),this.itemIconCon.visible&&(this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(b.items.length,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTextCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.setItems(b.items,!0))}else if(2==this._tabIndex){for(var l=0;3>l;l++){var p=this["DzNum"+l],G=t.dzattrlst[l+1];if(G&&!Utils.isEmptyObj(G)){var d=this._mc.heroMgr.getAtrName(G.aid),w=this._mc.heroMgr.isAddJia(G.aid),S=this._mc.heroMgr.isNdPre(G.aid);G.atype?(w&&(d+="+"),d=d+G.aval+"%",S&&(d+="%"),p.textFlow=TextFormat.parser.parser("LV."+G.lv+":"+TextFormat.setColor(d,16075150))):(w&&(d+="+"),d+=G.aval,S&&(d+="%"),p.textFlow=TextFormat.parser.parser("LV."+G.lv+":"+TextFormat.setColor(d,16075150)))}else p.text="No forge"}this.tEqpName.text=GmConst.EQP_NAME[this._gIdx];var L=t.dzattrlst[this._dzIdx+1];this.bgTit.width=300,this.tOkNum.width=300,this.bgTit.x=45,this.tOkNum.x=45;var M=0;L&&L.lv&&(M=L.lv);var A=i.dzCfg[M];A||(A=i.dzCfg[M-1]),this.tOkNum.text="Boost Rate  "+A.ms,this._dzLv=M,this.itemIconCon.visible&&(this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(A.items.length,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTextCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.setItems(A.items,!0))}}else{this.item.visible=!1,this.tIname.visible=!1,this.tOkNum.visible=!1,this.itemIconCon.visible=!1,this.itemTextCon.visible=!1,Utils.setBtnEnable(this.bQh,!1),Utils.setBtnEnable(this.bQhTen,!1);for(var l=0;3>l;l++){var p=this["DzNum"+l];p.text="No forge"}this.tEqpName.text=GmConst.EQP_NAME[this._gIdx],this.gx.visible=!1,this.stone.visible=!1}},e.prototype.onGx=function(){if(!this._gxState){var t=this.stone.num,e=this._mc.itemMgr.getItemNum(ItemID.STONE_JL),i=this._mc.itemMgr.getItemCfg(ItemID.STONE_JL);if(t>e)return void MsgBox.prompt("Insufficient "+TextFormat.setColor(i.name,16075150)+", Can't select")}this._gxState=!this._gxState,this.updGrid()},e.prototype.initAtr=function(){for(var t=0;4>t;t++){var e=this["tMsNum"+t],i=this["tMs"+t];e.visible=!1,i.visible=!1}},e.prototype.updCardPanel=function(){this.iCard.source="equip_json.eqp_card_"+this._cIdx,this._cIdx<1?this.bLeft.visible=!1:this.bLeft.visible=!0,this._cIdx>1||this._cIdx>=this._mc.equipMgr.cId?this.bRight.visible=!1:this.bRight.visible=!0;for(var t=this._mc.equipMgr.getCardUpCfgs(this._cIdx),e=t.atrs.length,i=0;8>i;i++){var s=this.bgAtrsCon.getChildAt(i),o=this.txtAtrsCon.getChildAt(i),n=this._mc.equipMgr.cAtrs;if(e>i){s.visible=!0,o.visible=!0;var r=this._mc.heroMgr.getAtrName(t.atrs[i]),h=this._mc.heroMgr.isAddJia(t.atrs[i]),a=this._mc.heroMgr.isNdPre(t.atrs[i]),l=0;if(this._cIdx==this._mc.equipMgr.cId)if(n&&(l=n[i+1]||0),l){var c=t.lv[l-1];c||(c=t.lv[l-1]);c.attr&&(h?r=r+"+"+c.attr[i]:r+=c.attr[i])}else{l=0;var c=t.lv[l];c.attr&&(r+=h?"+0":"0")}else if(this._cIdx>=this._mc.equipMgr.cId){l=0;var c=t.lv[l];c.attr&&(r+=h?"+0":"0")}else{l=t.lv.length;var c=t.lv[l-1];c.attr&&(h?r=r+"+"+c.attr[i]:r+=c.attr[i])}a&&(r+="%"),o.textFlow=TextFormat.parser.parser("LV."+l+":"+TextFormat.setColor(r,16075150))}else s.visible=!1,o.visible=!1}var d=this._cY[this._cIdx];this.bgAtrsCon.y=d,this.txtAtrsCon.y=d;var p=this._cH[this._cIdx];this.bgAtrsCon.height=p,this.txtAtrsCon.height=p,this._cIdx==this._mc.equipMgr.cId?(this.cXzk.visible=!0,Utils.setBtnEnable(this.bUp,!0),this.itemIconCon0.visible=!0,this.itemTextCon0.visible=!0,this.tCgNum.visible=!0,this.tCgBg.visible=!0,this.bUp.visible=!0,this.tmj.visible=!1,this.selCardAtr(this._cSelIdx)):(this.cXzk.visible=!1,Utils.setBtnEnable(this.bUp,!1),this.bUp.visible=!1,this.tCgBg.visible=!1,this.itemIconCon0.visible=!1,this.itemTextCon0.visible=!1,this.tCgNum.visible=!1,this.tmj.visible=!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.clearCardItems=function(){this._cardGridCon&&(ItemGridCon.release(this._cardGridCon),this._cardGridCon=null)},e.prototype.onLeft=function(){this._cIdx--,this._cIdx<0&&(this._cIdx=0),this._cSelIdx=0,this.updCardPanel()},e.prototype.onRight=function(){this._cIdx++,this._cIdx>2&&(this._cIdx=2),this._cSelIdx=0,this.updCardPanel()},e.prototype.onCardAtrs=function(t){var e=t.target;if(e.parent==this.bgAtrsCon){var i=this.bgAtrsCon.getChildIndex(e);if(this._cIdx!=this._mc.equipMgr.cId)return;if(i==this._cSelIdx)return;this.selCardAtr(i)}},e.prototype.selCardAtr=function(t){this._cSelIdx=t,this.cXzk.x=this.bgAtrsCon.x-5+300*(t%2),this.cXzk.y=this.bgAtrsCon.y-5+63*Math.floor(t/2);var e=this._mc.equipMgr.getCardUpCfgs(this._cIdx),i=this._mc.equipMgr.cAtrs,s=0;i&&(s=i[this._cSelIdx+1]||0);var o=e.lv[s];o?Utils.setBtnEnable(this.bUp,!0):(o=e.lv[s-1],Utils.setBtnEnable(this.bUp,!1)),this.tCgNum.text="Success Rate "+o.rate+"%",this.clearCardItems(),this._cardGridCon=ItemGridCon.create(),this._cardGridCon.initGridsByNum(o.items.length,115,!1,!0,!0),this._cardGridCon.addToParent(10,0,this.itemIconCon0,this.itemTextCon0),this._cardGridCon.setTouchCb(!0),this._cardGridCon.setItems(o.items,!0)},e.prototype.onUp=function(){3==this._tabIndex&&(this.bUp.touchEnabled=!1,this.showUpEft())},e.prototype.showUpEft=function(){this._eft||(this._eft=new MovieClipEx("kacesj"),this.addChild(this._eft),this._eft.x=this.iCard.x+Math.floor(this.iCard.width/2)+15,this._eft.y=this.iCard.y+Math.floor(this.iCard.height/2)+100),this._eft.visible=!0,this._eft.play(1,this.upOk,this)},e.prototype.upOk=function(){this._eft.visible=!1,GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_CARD_UP,[this._cIdx+1,this._cSelIdx+1],this.onUpOk,this),this.bUp.touchEnabled=!0},e.prototype.onUpOk=function(){this._cIdx==this._mc.equipMgr.cId-1&&2!=this._cIdx&&(this.bRight.scaleX=0,this.bRight.scaleY=0,egret.Tween.get(this.bRight).to({scaleX:-1,scaleY:1},400,egret.Ease.backOut))},e.prototype.onQhTen=function(){0==this._tabIndex?(this.bQh.touchEnabled=!1,this.showQhEft(10)):1==this._tabIndex&&CmdBus.doCmd(CmdType.O_EQUIP_JC,this._gIdx)},e.prototype.onQh=function(){0==this._tabIndex?(this.bQh.touchEnabled=!1,this.showQhEft()):1==this._tabIndex?(this.bQh.touchEnabled=!1,this._JlOkEft?this.showJlEft():GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,"jinglian",this.addJlEft,this)):2==this._tabIndex&&(GmGlobal.vmc.mGuide.triggerTarget(this.bQh),this.bQh.touchEnabled=!1,this._pDzLv=this._dzLv,GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_DZ,[this._gIdx+1,this._dzIdx+1],this.dzOk,this,this.dzFail))},e.prototype.dzFail=function(){this.bQh.touchEnabled=!0},e.prototype.dzOk=function(){this._pDzLv>=this._dzLv?this.showDzzhEft():this.showDzsjEft()},e.prototype.showDzsjEft=function(){this._dzsjEft||(this._dzsjEft=new MovieClipEx("duanzaosj"),this.dzCon.addChild(this._dzsjEft)),this._dzsjEft.x=this.xzk.x+Math.floor(this.xzk.width/2)+2,this._dzsjEft.y=this.xzk.y+Math.floor(this.xzk.height/2),this._dzsjEft.visible=!0,this._dzsjEft.play(1,this.sjOk,this)},e.prototype.sjOk=function(){this._dzsjEft.visible=!1,this.bQh.touchEnabled=!0},e.prototype.showDzzhEft=function(){this._dzzhEft||(this._dzzhEft=new MovieClipEx("duanzaozh")),this._dzzhEft.parent||this.dzCon.addChild(this._dzzhEft),this._dzzhEft.x=this.xzk.x+Math.floor(this.xzk.width/2)+2,this._dzzhEft.y=this.xzk.y+Math.floor(this.xzk.height/2),this._dzzhEft.visible=!0,this._dzzhEft.play(1,this.zhOk,this)},e.prototype.zhOk=function(){this._dzzhEft.visible=!1,this.bQh.touchEnabled=!0},e.prototype.showQhEft=function(t){void 0===t&&(t=0),this._qhEft||(this._qhEft=new MovieClipEx("qianghua"),this._qhEft.x=this.ibg.x-2,this._qhEft.y=this.ibg.y-17),this._qhEft.parent||this.eqpCon.addChild(this._qhEft),this._qhEft.visible=!0,this._qhNum=t,this._qhEft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._qhEft.visible=!1,GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_QH,[this._gIdx+1,this._qhNum]),this.bQh.touchEnabled=!0,GmGlobal.vmc.mGuide.triggerTarget(this.bQh)},e.prototype.addJlEft=function(t){this._JlOkEft||(this._JlOkEft=new egret.MovieClip(t.generateMovieClipData("jinglian")),this.eqpCon.addChild(this._JlOkEft),this._JlOkEft.x=this.ibg.x-2,this._JlOkEft.y=this.ibg.y-17),this.showJlEft()},e.prototype.showJlEft=function(){this._JlOkEft&&(this._JlOkEft.visible=!0,this._JlOkEft.gotoAndPlay("jinglianty",1),this._JlOkEft.addEventListener(egret.MovieClipEvent.COMPLETE,this.onComplete,this))},e.prototype.onComplete=function(){this._JlOkEft.removeEventListener(egret.MovieClipEvent.COMPLETE,this.onComplete,this);var t=1==this._gxState?1:0;GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_JL,[this._gIdx+1,t],this.onJlOk,this,this.onJlFail),GmGlobal.vmc.mGuide.triggerTarget(this.bQh)},e.prototype.onJlOk=function(){this._JlOkEft.gotoAndPlay("jingliantycg",1),this._JlOkEft.addEventListener(egret.MovieClipEvent.COMPLETE,this.onJlComplete,this)},e.prototype.onJlFail=function(t){214==t?this._JlOkEft.gotoAndPlay("jingliantysb",1):this._JlOkEft.gotoAndPlay("jingliantycg",1),this._JlOkEft.addEventListener(egret.MovieClipEvent.COMPLETE,this.onJlComplete,this)},e.prototype.onJlComplete=function(){this._JlOkEft.removeEventListener(egret.MovieClipEvent.COMPLETE,this.onJlComplete,this),this.bQh.touchEnabled=!0,this._JlOkEft.visible=!1},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.equipMgr.rule)},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_EQUIP)},e.prototype.clearJlEft=function(t){void 0===t&&(t=!0),GmGlobal.res.releaseMCData("jinglian",t,this.addJlEft,this),this._JlOkEft&&(this._JlOkEft.stop(),this.eqpCon.removeChild(this._JlOkEft),this._JlOkEft=null)},e.prototype.close=function(){if(RedDotView.removeRedDotByGroup("equip"),-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,this._qhEft&&(this._qhEft.clear(),this._qhEft=null),this._dzsjEft&&(this._dzsjEft.clear(),this._dzsjEft=null),this._dzzhEft&&(this._dzzhEft.clear(),this._dzzhEft=null),this._JlOkEft&&this.clearJlEft(),this._tlView&&this._tlView.close(),this.clearItems(),this.clearCardItems(),t.prototype.close.call(this)},e.prototype.destroy=function(){this._tlView&&this._tlView.destroy(),RES.destroyRes("equip_json")},e}(UIBase);__reflect(EquipView.prototype,"EquipView");var FirstpayController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_FIRSTPAY,this.onUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.firstpayMgr;i.info=e,this.updateRedDot(),EventBus.dispatchEvt(EventType.M_FIRSTPAY)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.firstpayMgr,e=t.cfgs,i=0;i<e.length;i++){var s=t.redDot.childs[i];s.state=0;var o=e[i],n=t.info[o.id],r=0;n&&!Utils.isEmptyObj(n)&&(r=n.s||0),s.state=1==r?1:0}},t}();__reflect(FirstpayController.prototype,"FirstpayController");var FirstpayItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.awds,e=this.data.isget;this.index=this.data.index,e?(this.iylq.visible=!0,this.okBtn.visible=!1,this.tnum.visible=!1):(this.iylq.visible=!1,this.okBtn.visible=!0,this.tnum.visible=!0),this.tnum.text="D"+this.index.toString(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,115,!1,!0,!1),this._itemGridCon.initGridsByItems(t,115,!1,!0,!1),this._itemGridCon.addToParent(5,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0)),this._itemGridCon.setItems(t)},e.prototype.clear=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(FirstpayItem.prototype,"FirstpayItem");var FirstpayManager=function(){function t(){this.cfgs={},this.info={},GmGlobal.mc.regUnzipCfg("c_firstpay.json",this.initCfg,this);var t={0:0,1:0,2:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.SHOUCHONG,this.redDot)}return t.prototype.initCfg=function(t){this.cfgs=t},t.prototype.isGetAwd=function(){var t=!0;(!this.info||Utils.isEmptyObj(this.info))&&(t=!1);for(var e in this.info){var i=this.info[e];if(i.cnt>0){t=!1;break}}return t},t}();__reflect(FirstpayManager.prototype,"FirstpayManager");var FirstpayMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SHOUCHONG,CmdType.O_FIRSTPAY),CmdBus.adListener(CmdType.O_FIRSTPAY,this.onOpenView,this),CmdBus.adListener(CmdType.C_FIRSTPAY,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new FirstpayView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(FirstpayMediator.prototype,"FirstpayMediator",["IMediator"]);var FirstpayView=function(t){function e(){var e=t.call(this,"FirstpaySkin")||this;return e._tabIndex=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="FirstpayItemSkin",this.itemList.itemRenderer=FirstpayItem;for(var e=0;3>e;e++){var i={awds:[],isget:!1,index:e+1};this._array.addItem(i)}},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.addListener(EventType.M_FIRSTPAY,this.updui,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.rmListener(EventType.M_FIRSTPAY,this.updui,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),this.selTab(0),this.alphaShow()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t,this.updui()}},e.prototype.updui=function(){var t=this._mc.firstpayMgr.cfgs[this._tabIndex],e=this._mc.firstpayMgr.info[t.id],i=0,s=0;e&&!Utils.isEmptyObj(e)?(i=e.cnt||0,s=e.s||0):i=this._array.length;for(var o=this._array.length-i,n=0;n<this._array.length;n++){var r=this._array.getItemAt(n),h=t.day[n],a=[];if(h.cItems){var l=this._mc.heroMgr.getHeroCfg(this._mc.role.careerId);a=h.cItems[l.career]}a=a.concat(h.items),r.awds=a,r.isget=o>n?!0:!1,this._array.itemUpdated(r)}2==s?(Utils.setBtnEnable(this.bBuy,!1),this.bBuy.label="Claimed"):1==s?(Utils.setBtnEnable(this.bBuy,!0),this.bBuy.label="Claimable"):(Utils.setBtnEnable(this.bBuy,!0),this.bBuy.label="$"+t.id),this.bBuy.visible=o>=this._array.length?!1:!0,this.updateRedDot()},e.prototype.clearItems=function(){for(var t=0;t<this._array.length;t++){var e=this.itemList.getChildAt(t);e.clear()}},e.prototype.onBuy=function(){var t=this._mc.firstpayMgr.cfgs[this._tabIndex],e=this._mc.firstpayMgr.info[t.id],i=0,s=0;e&&(i=e.cnt||0,s=e.s||0),1==s?this._cc.dataCtl.doAction(ServerActionId.FIRSTPAY,[100*t.id,this._array.length-i+1]):this._cc.pfCtl.Pay(100*t.id,ItemID.DIAMOND)},e.prototype.updateRedDot=function(){for(var t=0;3>t;t++){var e=this._mc.firstpayMgr.redDot.childs[t],i=this.tableBgCon.getChildAt(t);if(1==e.state){var s=this.tableBgCon.x+116*(t+1)+10*t-20;RedDotView.addRedDot(i,this.redDotCon,"firstpay",s,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(i)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_FIRSTPAY)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,RedDotView.removeRedDotByGroup("firstpay"),t.prototype.close.call(this)},e.prototype.destroy=function(){this.clearItems(),RES.destroyRes("firstpay_json")},e}(UIBase);__reflect(FirstpayView.prototype,"FirstpayView");var FriendChatItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.msg;if(this.nameTxt.textColor=t.roleId==GmGlobal.mc.role.roleId?15045434:4605510,this.nameTxt.text=this.data.name,t.ex&&t.ex.face)this.txt.visible=!1,this.face.visible=!0,this.face.source="emoji_json."+t.ex.face,this.txtBg.height=70,this.txtBg.width=70,this.face.x=t.roleId==GmGlobal.mc.role.roleId?580-this.face.width:20;else{this.txt.visible=!0,this.face.visible=!1,t.content=t.content.replace(/\\s/g," ");try{this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(t.content,this.txt.width))}catch(e){this.txt.text=t.content}this.txtBg.height=this.txt.height+20,this.txtBg.width=this.txt.textWidth+20}this.txt.x=t.roleId==GmGlobal.mc.role.roleId?580-this.txt.textWidth:20,this.nameTxt.textAlign=t.roleId==GmGlobal.mc.role.roleId?"right":"left",t.ex&&t.ex.time&&(t.roleId==GmGlobal.mc.role.roleId?this.nameTxt.text=Utils.formatDate(Utils.getServerTime(t.ex.time),"M.D h:m")+"  "+this.nameTxt.text:this.nameTxt.text=this.nameTxt.text+"  "+Utils.formatDate(Utils.getServerTime(t.ex.time),"M.D h:m")),this.txtBg.scaleX=t.roleId==GmGlobal.mc.role.roleId?-1:1,this.txtBg.x=t.roleId==GmGlobal.mc.role.roleId?590:10,this.txtBg.y=45,this.txt.y=this.txtBg.y+10,this.height=Math.max(this.txtBg.y+this.txtBg.height+10,94)},e}(eui.ItemRenderer);__reflect(FriendChatItem.prototype,"FriendChatItem");var FriendChatView=function(t){function e(){var e=t.call(this,"FriendChatSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRenderer=FriendChatItem,this.itemList.itemRendererSkinName="FriendChatItemSkin"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bSend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSend,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bEmoji.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showEmoji,this),EventBus.addListener(EventType.M_CHATMSG_UPD,this.onUpdateMsg,this,10),EventBus.addListener(EventType.M_MY_PCHAT,this.onUpdateMyMsg,this),EventBus.addListener(EventType.PCHAT_LOG,this.updateChatList,this),EventBus.addListener(EventType.M_FRIEND_DEL,this.onDel,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bSend.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSend,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bEmoji.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showEmoji,this),EventBus.rmListener(EventType.M_CHATMSG_UPD,this.onUpdateMsg,this),EventBus.rmListener(EventType.M_MY_PCHAT,this.onUpdateMyMsg,this),EventBus.rmListener(EventType.PCHAT_LOG,this.updateChatList,this),EventBus.rmListener(EventType.M_FRIEND_DEL,this.onDel,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.onDel=function(t){for(var e=t.data,i=0;i<e.length;i++){var s=Number(e[i]);if(s==this._data.roleId){this.onClose();break}}},e.prototype.setRoleData=function(t){this.tName.textFlow=TextFormat.parser.parse("Talking with "+TextFormat.setColor(t.roleName,14050935)),this._data=t,this.getPChatMsg()},e.prototype.getPChatMsg=function(){var t=this._mc.chatMgr.getPrivateChatMsg(this._data.roleId);!t||t.length<1?this._cc.chatCtl.reqPrivateLog(this._data.roleId,10):this.updList(t)},e.prototype.updateChatList=function(t){GmGlobal.cc.chatCtl.setPrivateChatDot(this._data.roleId,0);var e=t.data,i=this._mc.chatMgr.getPrivateChatMsg(e);!i||i.length<1||this.updList(i)},e.prototype.updList=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.roleId==this._data.roleId){i.refNum++;var s={msg:i,name:this._data.roleName};this._array.addItem(s)}else if(i.roleId==this._mc.role.roleId){i.refNum++;var s={msg:i,name:this._mc.role.name};this._array.addItem(s)}this.scollToLast()}},e.prototype.onUpdateMyMsg=function(t){if(t.data){var e=t.data.msg,i=t.data.roleId;if(i==this._data.roleId){e.refNum++;var s={msg:e,name:this._mc.role.name};this._array.addItem(s)}this.scollToLast()}},e.prototype.onUpdateMsg=function(t){if(t.data){GmGlobal.cc.chatCtl.setPrivateChatDot(this._data.roleId,0);var e=t.data;if(0==e.ch&&e.roleId==this._data.roleId){e.refNum++;var i={msg:e,name:this._data.roleName};if(this._array.addItem(i),0!=this.scoll.viewport.scrollV){var s=this.itemList.getChildAt(0);this.scoll.viewport.scrollV+=s.height}}}},e.prototype.scollToLast=function(){this.itemList.validateNow(),this.scoll.viewport.scrollV=this.itemList.contentHeight-this.scoll.height},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList){t.target.parent}},e.prototype.onSend=function(){this.sendMsg(this.inputTxt.text),this.inputTxt.text=""},e.prototype.sendMsg=function(t,e){if(void 0===e&&(e=null),t=t.trim(),""!=t){t=t.replace(/ /g,"\\s");var i=null;e&&(i={face:e,time:GmGlobal.getServerTime()});var s=this;GmGlobal.cc.pfCtl.checkMsg(t,function(e){0==e&&GmGlobal.cc.chatCtl.sendPrivateMsg(s._data.roleId,t,i)})}},e.prototype.showEmoji=function(){this._emojiView||(this._emojiView=new ChatEmojiView,this._emojiView.bindCallback(this.onSelEmoji,this)),this._emojiView.x=this.x+50,this._emojiView.y=this.y+this.bEmoji.y-this._emojiView.height-20,this._emojiView.show(this.parent,!0,!0,.01)},e.prototype.onSelEmoji=function(t){this.sendMsg(t.faceName,t.faceRes),this._emojiView.close()},e.prototype.clearChatItems=function(){for(var t=0;t<this._array.length;t++){var e=this._array.getItemAt(t);ChatMsg.release(e.msg)}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_FRIEND_CHAT,CmdType.O_FRIEND)},e.prototype.close=function(){GmGlobal.cc.chatCtl.clearPriveteTime(this._data.roleId),this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.clearChatItems(),t.prototype.close.call(this)},e.prototype.destroy=function(){this._emojiView&&(this._emojiView.close(),this._emojiView.destroy(),this._emojiView=null),t.prototype.destroy.call(this)},e}(UIBase);__reflect(FriendChatView.prototype,"FriendChatView");var FriendItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data&&this.data.d){this.tts.visible=!1,this.icon.visible=!0,this.iconBg.visible=!0,this.iconBg2.visible=!0,this.tlv.visible=!0,this.tzl.visible=!0,this.tname.visible=!0,this.tonline.visible=!1,this.bdel.visible=!0,this.bsl.visible=!0,this.topBtn.visible=!0,this.tname.text="【s"+this.data.d.serverid+"】"+this.data.d.roleName,this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+this.data.d.data[2]+".png",this.tlv.text="LV："+this.data.d.data[0],this.tzl.text="Power："+this.data.d.data[1];var t=GmGlobal.mc.chatMgr.pchatDot,e=t.getChild(this.data.d.roleId);if(e&&1==e.state?this.ird.visible=!0:this.ird.visible=!1,this.data.isHmd)this.bdel.visible=!1,this.bsl.visible=!1,this.bJc.visible=!0,this.topBtn.visible=!1;else{if(this.bJc.visible=!1,this.data.teamId)this.topBtn.visible=!1,this.bdel.visible=!1,this.bsl.label="Invite",!this.data.isKfIv&&this.data.isKfF?Utils.setBtnEnable(this.bsl,!1):Utils.setBtnEnable(this.bsl,!0);else{this.bdel.visible=!0,this.bsl.label="PM",Utils.setBtnEnable(this.bsl,!0),this.topBtn.visible=!0;var i=Number(egret.localStorage.getItem("xjtop"+this.data.d.roleId));this.topBtn.source=i?"com_json.fd_top":"com_json.fd_untop"}this.data.isKfF?this.kfFlag.visible=!0:this.kfFlag.visible=!1}}else this.tts.visible=!0,this.icon.visible=!1,this.iconBg.visible=!1,this.iconBg2.visible=!1,this.tlv.visible=!1,this.tzl.visible=!1,this.tname.visible=!1,this.tonline.visible=!1,this.bdel.visible=!1,this.bsl.visible=!1,this.ird.visible=!1,this.bJc.visible=!1,this.kfFlag.visible=!1,this.topBtn.visible=!1},e}(eui.ItemRenderer);__reflect(FriendItem.prototype,"FriendItem");var FriendMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.FRIEND,CmdType.O_FRIEND),CmdBus.adListener(CmdType.O_FRIEND,this.doOpenView,this),CmdBus.adListener(CmdType.C_FRIEND,this.onCloseView,this),CmdBus.adListener(CmdType.O_FRIEND_CHAT,this.doOpenCView,this),CmdBus.adListener(CmdType.C_FRIEND_CHAT,this.onCloseCView,this)}return t.prototype.updateRedDot=function(){},t.prototype.doOpenView=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=!1),GmGlobal.mc.role.lv<65?void MsgBox.prompt("Friend unlocks at LV.65"):(this._view||(this._view=new FriendView),this._view.setInvateData(t,e,i),void(this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.close(),t>=0&&CmdBus.doCmd(t)},t.prototype.doOpenCView=function(t){this._cview||(this._cview=new FriendChatView),this._cview.isShow||(this._cview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._cview.setRoleData(t)},t.prototype.onCloseCView=function(t){this._cview&&this._cview.isShow&&this._cview.close(),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._cview&&!this._cview.isShow&&(this._cview.destroy(),this._cview=null),!0):!1:!0},t}();__reflect(FriendMediator.prototype,"FriendMediator",["IMediator"]);var FriendView=function(t){function e(){var e=t.call(this,"FriendSkin")||this;return e._yqTime={},e._tabIndex=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.hyscoll.verticalScrollBar&&(this.hyscoll.verticalScrollBar.autoVisibility=!1),this._hyArray=new eui.ArrayCollection,this.hyitemList.dataProvider=this._hyArray,this.hyitemList.itemRenderer=FriendItem,this.hyitemList.itemRendererSkinName="FriendItemSkin"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.hyitemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bInvite.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onInviteAll,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.addListener(EventType.M_FRIEND_DEL,this.reqLst,this),EventBus.addListener(EventType.M_FRIEND_ADD,this.reqLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.hyitemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bInvite.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onInviteAll,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.rmListener(EventType.M_FRIEND_DEL,this.reqLst,this),EventBus.rmListener(EventType.M_FRIEND_ADD,this.reqLst,this)
},e.prototype.setInvateData=function(t,e,i){void 0===i&&(i=!1),this._teamId=t,this._fbId=e,this._isKfIv=i},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this._teamId?(this.bInvite.visible=!0,this.tableBgCon.visible=!1,this.tableTxtCon.visible=!1):(this.bInvite.visible=!1,this.tableBgCon.visible=!0,this.tableTxtCon.visible=!0),this.selTab(0)},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;2>t;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){this.hyscoll.stopAnimation(),this._hyArray.removeAll(),this.hyscoll.viewport.scrollV=0,0==this._tabIndex?this.ckReqList():this.reqHmd()},e.prototype.ckReqList=function(){GmGlobal.mc.chatMgr.hfIdData?this.reqLst():this.reqHfId()},e.prototype.reqHfId=function(){this._cc.dataCtl.ajaxReq("/server/hefu/"+GmGlobal.mc.role.hefuId,this.onHfId,this)},e.prototype.onHfId=function(t){0==t.ret?(GmGlobal.mc.chatMgr.hfIdData=t.data,this.reqLst()):(console.log("reqhfid "+t.data),this.reqLst())},e.prototype.reqLst=function(){this._cc.dataCtl.ajaxReq("/friend/list",this.reqOk,this)},e.prototype.reqOk=function(t){var e=t.ret,i=t.data;this._roleIds=[];var s=[],o=[],n=GmGlobal.mc.chatMgr.pchatDot;if(0==e)for(var r in i){var h=Number(r),a=n.getChild(r);a&&1==a.state?s.push(h):o.push(h),this._roleIds=s.concat(o)}this._roleIds.length<1?this._hyArray.addItem(null):this._cc.roleCtl.getRoleInfo(this._roleIds,[RoleAttrId.LEVEL,RoleAttrId.ZHANLI,RoleAttrId.CAREER],this.updLst,this)},e.prototype.updLst=function(t){if(0==this._tabIndex){var e=this._mc.chatMgr.hfIdData;this._datas={};for(var i in t){var s=t[i],o=void 0;o=e&&s.serverid>=e.b&&s.serverid<=e.e?!1:!0,this._datas[s.roleId]={d:s,teamId:this._teamId,fbId:this._fbId,isKfIv:this._isKfIv,isKfF:o}}this.updateFList()}},e.prototype.updateFList=function(){this.sortByTop(this._roleIds);for(var t=this._hyArray.length,e=0;e<this._roleIds.length;e++){var i=this._datas[this._roleIds[e]];this._hyArray.length>e?this._hyArray.replaceItemAt(i,e):this._hyArray.addItem(i)}if(this._roleIds.length<t)for(var e=this._roleIds.length;t>e;e++)this._hyArray.removeItemAt(e)},e.prototype.sortByTop=function(t){for(var e,i,s,o=0;o<t.length;o++){i=Number(egret.localStorage.getItem("xjtop"+t[o]));for(var n=o+1;n<t.length;n++)s=Number(egret.localStorage.getItem("xjtop"+t[n])),s>i&&(e=t[o],t[o]=t[n],t[n]=e)}},e.prototype.reqHmd=function(){this._cc.dataCtl.ajaxReq("/black/list",this.onHmdReqOk,this)},e.prototype.onHmdReqOk=function(t){if(0==t.ret){var e=t.data;this._roleIds=[];for(var i in e){var s=Number(i);this._roleIds.push(s)}GmGlobal.mc.chatMgr.hmdList=this._roleIds,this._roleIds.length>0&&this._cc.roleCtl.getRoleInfo(this._roleIds,[RoleAttrId.LEVEL,RoleAttrId.ZHANLI,RoleAttrId.CAREER],this.updateHmd,this)}},e.prototype.updateHmd=function(t){if(1==this._tabIndex){this._datas={};for(var e in t){var i=t[e];this._datas[i.roleId]={d:i,teamId:this._teamId,fbId:this._fbId,isHmd:!0}}for(var s=this._hyArray.length,o=0;o<this._roleIds.length;o++){var i=this._datas[this._roleIds[o]];this._hyArray.length>o?this._hyArray.replaceItemAt(i,o):this._hyArray.addItem(i)}if(this._roleIds.length<s)for(var o=this._roleIds.length;s>o;o++)this._hyArray.removeItemAt(o)}},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.hyitemList){var e=t.target.parent,i=e.data.d;if("del"==t.target.name){var s="Delete friend "+TextFormat.setColor(i.roleName,14050935)+" ?";MsgBox.confirm(s,this.onOk,null,this,null,null,i)}else if("sl"==t.target.name)if(this._teamId){var o=this._yqTime[i.roleId]||0,n=GmGlobal.getServerTime();if(10>n-o)return void MsgBox.prompt("Too frequent");this._yqTime[i.roleId]=n,this._cc.dataCtl.doAction(ServerActionId.FB_I_FRIEND,[this._teamId,this._fbId,i.roleId])}else CmdBus.doCmd(CmdType.O_FRIEND_CHAT,i),this.onClose();else if("jc"==t.target.name)GmGlobal.cc.dataCtl.ajaxReq("/black/del/"+i.roleId,this.onHmdDelOk,this);else if("top"==t.target.name){var r=Number(egret.localStorage.getItem("xjtop"+i.roleId));r?egret.localStorage.setItem("xjtop"+i.roleId,"0"):egret.localStorage.setItem("xjtop"+i.roleId,(new Date).getTime().toString()),this.updateFList()}}},e.prototype.onOk=function(t){this._delId=t.roleId,this._cc.dataCtl.doAction(ServerActionId.F_DEL,[t.roleId],this.delOk,this)},e.prototype.delOk=function(){GmGlobal.cc.chatCtl.clearPriveteTime(this._delId,!0),this.reqLst()},e.prototype.onHmdDelOk=function(t){if(0==t.ret){var e=GmGlobal.mc.chatMgr.hmdList;if(e){var i=e.indexOf(t.data);-1!=i&&e.splice(i,1)}for(var s=0;s<this._hyArray.length;s++){var o=this._hyArray.getItemAt(s);if(o.d.role==o.data){this._hyArray.removeItemAt(s);break}}}},e.prototype.onInviteAll=function(){var t=this._yqTime[1]||0,e=GmGlobal.getServerTime();if(10>e-t)return void MsgBox.prompt("Too frequent");this._yqTime[1]=e;var i=[this._teamId,this._fbId];for(var s in this._datas){var o=this._datas[s];(this._isKfIv||!o.isKfF)&&i.push(o.d.roleId)}i.length<=2||this._cc.dataCtl.doAction(ServerActionId.FB_I_FRIEND,i)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_FRIEND)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(FriendView.prototype,"FriendView");var FuliController=function(){function t(){this._timerId=0,this._sTime=0,this._cd=0,EventBus.addListener(EventType.M_JUPD+JsonID.U_FL_QD,this.onQdUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_WD_QD,this.onWdQdUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_FL_LB,this.onlbUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_FL_Lc,this.onlcUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_FL_ND,this.onndUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.FULI_TZ,this.onTzUpd,this)}return t.prototype.onQdUpd=function(t){var e=t.data.data,i=GmGlobal.mc.flMgr;i.signday=e.signday||0,i.isSign=1==e.todaysign?!0:!1,this.updateQdRedDot(),EventBus.dispatchEvt(EventType.M_FL_QD)},t.prototype.onWdQdUpd=function(t){var e=t.data.data,i=GmGlobal.mc.flMgr;i.signdayWd=e.signday||0,i.isSignWd=1==e.todaysign?!0:!1,EventBus.dispatchEvt(EventType.M_WD_QD)},t.prototype.onlbUpd=function(t){var e=t.data.data,i=GmGlobal.mc.flMgr;i.lbIdxs=[];for(var s in e.lst)i.lbIdxs.push(e.lst[s]);i.isLbBuy=1==e.buy?!0:!1,EventBus.dispatchEvt(EventType.M_FL_LB)},t.prototype.onlcUpd=function(t){var e=t.data.data,i=GmGlobal.mc.flMgr;i.lcStates=e.state,i.lcNum=e.paynum||1,this.updateLjcRedDot(),EventBus.dispatchEvt(EventType.M_FL_LC)},t.prototype.onndUpd=function(t){var e=t.data.data,i=GmGlobal.mc.flMgr;i.ndcnt=e.c||0,EventBus.dispatchEvt(EventType.M_FL_ND)},t.prototype.onTzUpd=function(t){this.updateTzRedDot(),EventBus.dispatchEvt(EventType.M_FL_TZ)},t.prototype.updateQdRedDot=function(){var t=GmGlobal.mc.flMgr,e=t.redDot.childs[0];e.state=0,t.isSign||(e.state=1)},t.prototype.updateLjcRedDot=function(){var t=GmGlobal.mc.flMgr,e=t.redDot.childs[2];e.state=0;for(var i=t.leicCfgs,s=t.lcStates,o=(Utils.getObjectLength(s),0);o<i.length;o++){var n=i[o],r=s[n.price];if(1==r){e.state=1;break}}},t.prototype.updateTzRedDot=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.FULI_TZ).data.a,i=t.flMgr.redDot.childs[4],s=GmGlobal.getServerTime(),o=0;for(var n in e){var r=e[n],h=Math.max(r.et-s,0);h>0&&21600>h&&(this._sTime=egret.getTimer(),this._cd=h,this.setTzTimeOut(h)),s>=r.et&&(o=1)}i.state=o},t.prototype.setTzTimeOut=function(t){var e=t-(egret.getTimer()-this._sTime);e>t&&this._timerId&&(egret.clearTimeout(this._timerId),this._timerId=0),this._timerId||(this._timerId=egret.setTimeout(this.onTzTimeOut,this,t))},t.prototype.onTzTimeOut=function(){this._timerId=0,this._cd=0,this.updateTzRedDot()},t}();__reflect(FuliController.prototype,"FuliController");var FuliLcListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.items,e=this.data.state;this.index=this.data.index,this.titTxt.text=this.data.txt,0==e?(this.iylq.visible=!1,this.okBtn.visible=!0,Utils.setBtnEnable(this.okBtn,!1)):1==e?(this.iylq.visible=!1,this.okBtn.visible=!0,Utils.setBtnEnable(this.okBtn,!0)):(this.iylq.visible=!0,this.okBtn.visible=!1),this._itemGridCon&&this.clear(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,115,!1,!0,!1),this._itemGridCon.addToParent(5,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clear=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(FuliLcListItem.prototype,"FuliLcListItem");var FuliManager=function(){function t(){this.qdCfgs=[],this.wdQdCfgs=[],this.liancCfgs=[],this.leicCfgs=[],this.ndCfgs={},this.signday=0,this.isSign=!1,this.signdayWd=0,this.isSignWd=!1,this.lbIdxs=[],this.isLbBuy=!1,this.liancStates={},this.isPayToday=!1,this.liancDay=0,this.lcStates={},this.lcNum=0,this.ndcnt=0,this.ndawds=[],GmGlobal.mc.regUnzipCfg("c_fuli.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_signtotal2.json",this.initWeidCfg,this),GmGlobal.mc.regUnzipCfg("c_investbank.json",this.initTzCfg,this);var t={0:0,1:0,2:0,3:0,4:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.FULI,this.redDot);var e=this.redDot.childs[0];e.state=1}return t.prototype.initCfg=function(t){this.qdCfgs=t.sign,this.lbCfgs=t.libao,this.liancCfgs=t.lianc,this.leicCfgs=t.leic,this.ndCfgs=t.nd},t.prototype.initWeidCfg=function(t){this.wdQdCfgs=t},t.prototype.initTzCfg=function(t){this.tzCfgs=t},t}();__reflect(FuliManager.prototype,"FuliManager");var FuliMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.FULI,CmdType.O_FULI),CmdBus.adListener(CmdType.O_FULI,this.onOpenView,this),CmdBus.adListener(CmdType.C_FULI,this.onCloseView,this),CmdBus.adListener(CmdType.O_FULI_LST,this.onOpenLstView,this),CmdBus.adListener(CmdType.C_FULI_LST,this.onCloseLstView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t){this._showIndex=t||0,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new FuliView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._showIndex)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenLstView=function(t){void 0===t&&(t=0),this._lstview||(this._lstview=new FuliNdItemsView),this._lstview.isShow||(this._lstview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._lstview.setIdx(t)},t.prototype.onCloseLstView=function(t){this._lstview&&this._lstview.isShow&&this._lstview.close(),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._lstview&&(this._lstview.destroy(),this._lstview=null),!0):!1:!0},t}();__reflect(FuliMediator.prototype,"FuliMediator",["IMediator"]);var FuliNdItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.clearCon(),this._itemCon||(this._itemCon=ItemGridCon.create(),this._itemCon.initGridsByItems(this.data,115,!1,!0,!0),this._itemCon.addToParent(10,0,this.itemCon),this._itemCon.setTouchCb(!0),this._itemCon.textAlign=egret.HorizontalAlign.LEFT)},e.prototype.clearCon=function(){this._itemCon&&(ItemGridCon.release(this._itemCon),this._itemCon=null)},e}(eui.ItemRenderer);__reflect(FuliNdItem.prototype,"FuliNdItem");var FuliNdItemsView=function(t){function e(){var e=t.call(this,"FuliNdItemsSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="FuliNdItemSkin",this.itemList.itemRenderer=FuliNdItem},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),EventBus.addListener(EventType.M_UPD_CON,this.updList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),EventBus.rmListener(EventType.M_UPD_CON,this.updList,this)},e.prototype.setIdx=function(t){1==t?this.tTit.text="Card Gacha":2==t?this.tTit.text="Head Gacha":this.tTit.text="Gear Gacha",this._idx=t,this.updList()},e.prototype.updList=function(){this.scoll.viewport.scrollV=0;var t=this.getLst();this._array.replaceAll(t),this.itemList.validateNow()},e.prototype.getLst=function(){for(var t=this._mc.flMgr.ndCfgs.types[this._idx],e=t.items,i=Math.ceil(e.length/5),s=[],o=0;i>o;o++){var n=this.getOneLine(5*o);s.push(n)}return s},e.prototype.getOneLine=function(t){var e=[],i=this._mc.flMgr.ndCfgs.types[this._idx],s=i.items,o=t+5;return o>=s.length&&(o=s.length),e=s.slice(t,o)},e.prototype.clearItems=function(){for(var t=0;t<this._array.length;t++){var e=this.itemList.getChildAt(t);e&&e.clearCon()}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_FULI_LST)},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(FuliNdItemsView.prototype,"FuliNdItemsView");var FuliQdItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.iYqd.touchEnabled=!1,this.iKq.touchEnabled=!1,this.tKq.touchEnabled=!1},e.prototype.dataChanged=function(){this.index=this.data.index,this.icon.setItem(this.data.item);var t=this.data.state;this.iYqd.visible=2==t?!0:!1,this.iKq.visible=1==t?!0:!1,this.tKq.visible=1==t?!0:!1,this.icon.enableTip(!0)},e}(eui.ItemRenderer);__reflect(FuliQdItem.prototype,"FuliQdItem");var FuliTzItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tName.text=this.data.cfg.day+"-day Fund";var t="";if(t+=this.data.num?"Fund Crystal: "+this.data.num:"Crystal Range: "+this.data.cfg.within[0]+"-"+this.data.cfg.within[1],t+="\nReturn Rate: "+this.data.cfg.payback+"%",t+="\nGet Crystal: ",this.data.num){t+=Math.ceil(this.data.num*(100+this.data.cfg.payback)/100),this.bTz.label="Claim";var e=Math.max(this.data.endTime-GmGlobal.getServerTime(),0);CDText.getInstence().addCD(this.tTime,e,this.tName.text+" Countdown：","DD h:m:s","",this.onTimeOut,this),this.bTz.skinName="ComBtnSkinB"}else t+="No Fund",this.bTz.label="Fund",this.bTz.skinName="ComBtnSkinY",this.tTime.text=this.tName.text+"Countdown：No Fund",this.clearCD();this.tDes.text=t,this.box.source="wanfa_json.yybx_"+(this.data.id+1)},e.prototype.onTimeOut=function(){var t=GmGlobal.mc.flMgr,e=t.redDot.childs[4];e.state=1},e.prototype.clearCD=function(){CDText.getInstence().rmCD(this.tTime)},e}(eui.ItemRenderer);__reflect(FuliTzItem.prototype,"FuliTzItem");var FuliView=function(t){function e(){var e=t.call(this,"FuliSkin")||this;return e._txts=["Gear","Card","Head"],e._ndIdx=0,e._price=0,e._tabIndex=-1,e._cjNum=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.qdScoll.verticalScrollBar&&(this.qdScoll.verticalScrollBar.autoVisibility=!1),this.lbScoll.verticalScrollBar&&(this.lbScoll.verticalScrollBar.autoVisibility=!1),this.lcScoll.verticalScrollBar&&(this.lcScoll.verticalScrollBar.autoVisibility=!1),this.tzScall.verticalScrollBar&&(this.tzScall.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="FuliQdItemSkin",this.itemList.itemRenderer=FuliQdItem,this._lcArray=new eui.ArrayCollection,this.lcitemList0.dataProvider=this._lcArray,this.lcitemList0.itemRendererSkinName="FuliLcListItemSkin",this.lcitemList0.itemRenderer=FuliLcListItem,this._tzArray=new eui.ArrayCollection,this.tzList.dataProvider=this._tzArray,this.tzList.itemRendererSkinName="FuliTzItemSkin",this.tzList.itemRenderer=FuliTzItem,this.initQdLst(),this.initLbLst(),this.initLcLst(),this.tWeight.textFlow=new Array({text:"Chance",style:{underline:!0,textColor:14050935}})},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bqd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQd,this),this.bqd2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQd2,this),this.bgm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bgm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bNr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNr,this),this.tbtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNd0,this),this.tbtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNd1,this),this.tbtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNd2,this),this.bOne.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.bTen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTen,this),this.lcitemList0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchLcList,this),this.tzList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTzList,this),this.tWeight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onWeight,this),EventBus.addListener(EventType.M_FL_QD,this.updQdLst,this),EventBus.addListener(EventType.M_FL_LB,this.updLb,this),EventBus.addListener(EventType.M_FL_LC,this.updLcLst,this),EventBus.addListener(EventType.M_FL_ND,this.updNdCnt,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_FL_ND_AWARD,this.showAward,this),EventBus.addListener(EventType.M_UPD_CON,this.updNdXh,this),EventBus.addListener(EventType.M_FL_TZ,this.updTz,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bqd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQd,this),this.bqd2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQd2,this),this.bgm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bNr.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNr,this),this.tbtn0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNd0,this),this.tbtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNd1,this),this.tbtn2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNd2,this),this.bOne.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.bTen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTen,this),this.tzList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTzList,this),this.tWeight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onWeight,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.lcitemList0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchLcList,this),EventBus.rmListener(EventType.M_FL_QD,this.updQdLst,this),EventBus.rmListener(EventType.M_FL_LB,this.updLb,this),EventBus.rmListener(EventType.M_FL_LC,this.updLcLst,this),EventBus.rmListener(EventType.M_FL_ND,this.updNdCnt,this),EventBus.rmListener(EventType.M_JUPD+JsonID.U_FL_ND_AWARD,this.showAward,this),EventBus.rmListener(EventType.M_UPD_CON,this.updNdXh,this),EventBus.rmListener(EventType.M_FL_TZ,this.updTz,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selTab(0),this.alphaShow(),this.checkGuide()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.vmc.mGuide.triggerTarget(t.target),GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t,this.showPanel()}},e.prototype.showPanel=function(){var t=this._tabIndex;if(-1!=t)for(var e=0;e<this.tableBgCon.numChildren;e++){var i=this["con_"+e];i.visible=t==e?!0:!1}3==t?NiuDanEffect.getInstance().show(this,125,253,233,20,2,this.doCj,this):NiuDanEffect.getInstance().clear(),0==this._tabIndex?this.updQdLst():1==t?this.updLb():2==t?this.updLcLst():3==t?this.updNd():4==t&&this.updTz()},e.prototype.initQdLst=function(){var t=this._mc.flMgr.qdCfgs;this._array.removeAll(),this.qdScoll.viewport.scrollV=0;for(var e=0;e<t.length;e++){var i=t[e],s={state:0,item:i.award,index:e+1};this._array.addItem(s)}this.sicon.source=this._mc.itemMgr.getItemSicon(ItemID.SHUIJING)},e.prototype.updQdLst=function(){var t=this._mc.flMgr.signday;this._mc.flMgr.isSign||t++;for(var e=0;e<this._array.length;e++){var i=this._array.getItemAt(e);t>e?(i.state=2,this._mc.flMgr.isSign||e!=t-1||(i.state=1)):i.state=0,this._array.itemUpdated(i)}var s=this._mc.flMgr.qdCfgs[t-1];s||(s=this._mc.flMgr.qdCfgs[0]),this.tnum.text=s.price,this._mc.flMgr.isSign?(Utils.setBtnEnable(this.bqd,!1),Utils.setBtnEnable(this.bqd2,!1)):(Utils.setBtnEnable(this.bqd,!0),Utils.setBtnEnable(this.bqd2,!0)),this.updateRedDot()},e.prototype.initLbLst=function(){var t=this._mc.flMgr.lbCfgs.showItems;this._itemCon=ItemGridCon.create(),this._itemCon.initGridsByItems(t,115,!1,!1,!0),this._itemCon.addToParent(10,10,this.lbitemCon),this._itemCon.setTouchCb(!0)},e.prototype.updLb=function(){for(var t=this._mc.flMgr.lbIdxs,e=[],i=0,s=0;s<t.length;s++){var o=t[s],n=this._mc.flMgr.lbCfgs.items[o-1],r=n.award;e.push(r),i+=n.score}this._itemGridsCon||(this._itemGridsCon=ItemGridCon.create(),this._itemGridsCon.initGridsByItems(e,115,!1,!0,!0),this._itemGridsCon.addToParent(10,0,this.itemCon),this._itemGridsCon.setTouchCb(!0),this._itemGridsCon.textAlign=egret.HorizontalAlign.CENTER),this._itemGridsCon.setItems(e),Utils.setBtnEnable(this.bgm,!this._mc.flMgr.isLbBuy);var h=this.getlbPrice(i);this.bgm.setPrice(h.oprice,h.price),this._price=h.price},e.prototype.clearCon=function(){this._itemGridsCon&&(ItemGridCon.release(this._itemGridsCon),this._itemGridsCon=null)},e.prototype.getlbPrice=function(t){for(var e=this._mc.flMgr.lbCfgs.prices,i=e[0],s=0;s<e.length;s++){var o=e[s];if(t>=o.score[0]&&t<=o.score[1]){i=o;break}}return i},e.prototype.initLcLst=function(){for(var t=this._mc.flMgr.leicCfgs,e=0;e<t.length;e++){var i=t[e],s={items:i.items,state:0,txt:"Recharge a total of $"+i.price,index:e+1};this._lcArray.addItem(s)}},e.prototype.updLcLst=function(){for(var t=this._mc.flMgr.leicCfgs,e=this._mc.flMgr.lcStates,i=(Utils.getObjectLength(e),0);i<this._lcArray.length;i++){var s=this._lcArray.getItemAt(i),o=t[i],n=e[o.price];n||(n=0),s.state=n,this._lcArray.itemUpdated(s)}this.updateRedDot()},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.lcitemList&&"btn"==t.target.name){var e=t.target.parent,i=this._mc.flMgr.liancCfgs[e.index-1];this._cc.dataCtl.doAction(ServerActionId.FL_LIANC,[i.day])}},e.prototype.onTouchLcList=function(t){if(t.target.parent.parent==this.lcitemList0&&"btn"==t.target.name){var e=t.target.parent,i=this._mc.flMgr.leicCfgs[e.index-1];this._cc.dataCtl.doAction(ServerActionId.FL_LC,[i.price])}},e.prototype.updNd=function(){this.updNdXh(),this.updNdCnt(),this.itype.source="fuli_json.fuli_nd"+this._ndIdx,this.tType.text=this._txts[this._ndIdx]+" Gacha",this.tbtn0.filters=0==this._ndIdx?FilterUtils.seleteFilter():[],this.tbtn1.filters=1==this._ndIdx?FilterUtils.seleteFilter():[],this.tbtn2.filters=2==this._ndIdx?FilterUtils.seleteFilter():[]},e.prototype.updNdXh=function(){var t=this._mc.flMgr.ndCfgs,e=t.types[this._ndIdx].cjXh,i=e[1],s=e[10],o=this.getXhItem(i);this.sicon0.source=this._mc.itemMgr.getItemSicon(o.id),this.tnum0.text=o.num.toString();var n=this.getXhItem(s);this.sicon1.source=this._mc.itemMgr.getItemSicon(n.id),this.tnum1.text=n.num.toString(),this.sicon2.source=this._mc.itemMgr.getItemSicon(o.id),this.hbNum.text=this._mc.itemMgr.getItemNum(o.id).toString()},e.prototype.getXhItem=function(t){var e=t[0],i=this._mc.itemMgr.getItemNum(e.id);return i>=e.num?e:t[1]},e.prototype.updNdCnt=function(){},e.prototype.updTz=function(){var t=this._mc.flMgr.tzCfgs,e=this._mc.dataMgr.getJData(JsonID.FULI_TZ).data,i=0;for(var s in t){var o={id:Number(s),num:0,endTime:0,cfg:t[s]};if(e.a&&e.a[s]){var n=e.a[s];o.num=n.num,o.endTime=n.et||0}this._tzArray.length>i?this._tzArray.replaceItemAt(o,i):this._tzArray.addItem(o),i++}},e.prototype.onTzList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;if(this._tzData=e,e.num){var i=GmGlobal.getServerTime();i<e.endTime?MsgBox.confirm("Fund returns can’t be claimed before the term is reached. Claiming now will only return the base Fund Crystals. Claim?",this.onTzGet,null,this,"Claim"):this.onTzGet()}else MsgBox.input("Enter the Fund rage\n"+e.cfg.within[0]+"-"+e.cfg.within[1],this.onTz,null,this,"Fund")}},e.prototype.onTzCancel=function(){this._tzData=null},e.prototype.onTz=function(t){var e=Number(t);e<this._tzData.cfg.within[0]||e>this._tzData.cfg.within[1]?MsgBox.alert("Not in the range"):this._cc.dataCtl.doAction(ServerActionId.FULI_TZ,[this._tzData.id,e]),this._tzData=null},e.prototype.onTzGet=function(){this._cc.dataCtl.reqAward(AwardId.FULI_TZ_AW,[this._tzData.id],this.onShowTzAw,this),this._tzData=null},e.prototype.onShowTzAw=function(t,e){e&&e.length>0&&AwardTipView.showAward(e)},e.prototype.updateRedDot=function(){for(var t=0;4>=t;t++){var e=t,i=this._mc.flMgr.redDot.childs[e],s=this.tableBgCon.getChildAt(e);if(1==i.state){var o=this.tableBgCon.x+116*(e+1)+4*e-20;RedDotView.addRedDot(s,this.redDotCon,"fuli",o,this.tableBgCon.y-10,"com_json.com_rdd")}else RedDotView.removeRedDot(s)}},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.flMgr.redDot,e=0;5>e;e++){var i=t.childs[e];i.bindChangeCB(this.updateRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.flMgr.redDot,e=0;5>e;e++){var i=t.childs[e];i.unbindChangeCB(this.updateRedDot,this)}},e.prototype.onQd=function(){this._mc.flMgr.isSign||this._cc.dataCtl.doAction(ServerActionId.SIGNIN,[0])},e.prototype.onQd2=function(){this._mc.flMgr.isSign||this._cc.dataCtl.doAction(ServerActionId.SIGNIN,[1])},e.prototype.onBuy=function(){this._mc.flMgr.isLbBuy||GmGlobal.cc.pfCtl.Pay(100*this._price,1)},e.prototype.onNr=function(){CmdBus.doCmd(CmdType.O_FULI_LST,this._ndIdx)},e.prototype.onNd0=function(){this._ndIdx=0,this.updNd()},e.prototype.onNd1=function(){this._ndIdx=1,this.updNd()},e.prototype.onNd2=function(){this._ndIdx=2,this.updNd()},e.prototype.checkNdCost=function(t){var e=this._mc.flMgr.ndCfgs,i=e.types[this._ndIdx].cjXh,s=i[t];if(!s)return!1;var o=this.getXhItem(s),n=this._mc.itemMgr.getItemNum(o.id);return o.id==ItemID.SHUIJING&&n<o.num?(ItemLackTips.instance().setItemUse(o.id,o.num),ItemLackTips.instance().itemsTips(),!1):!0},e.prototype.onOne=function(){GmGlobal.vmc.mGuide.triggerTarget(this.bOne),this._cjNum=1,this.checkNdCost(this._cjNum)&&(NiuDanEffect.getInstance().start(),Utils.setBtnEnable(this.bOne,!1),Utils.setBtnEnable(this.bTen,!1),this.tbtn0.touchEnabled=!1,this.tbtn1.touchEnabled=!1,this.tbtn2.touchEnabled=!1)},e.prototype.onTen=function(){this._cjNum=10,this.checkNdCost(this._cjNum)&&(NiuDanEffect.getInstance().start(),Utils.setBtnEnable(this.bOne,!1),Utils.setBtnEnable(this.bTen,!1),this.tbtn0.touchEnabled=!1,this.tbtn1.touchEnabled=!1,this.tbtn2.touchEnabled=!1)},e.prototype.doCj=function(){this._cc.dataCtl.doAction(ServerActionId.FL_ND,[this._ndIdx+1,this._cjNum]),Utils.setBtnEnable(this.bOne,!0),Utils.setBtnEnable(this.bTen,!0),this.tbtn0.touchEnabled=!0,this.tbtn1.touchEnabled=!0,this.tbtn2.touchEnabled=!0},e.prototype.showAward=function(){var t=this._mc.flMgr.ndCfgs,e=t.types[this._ndIdx],i=this._mc.dataMgr.getJData(JsonID.U_FL_ND_AWARD),s=[];for(var o in i.data)for(var n=Number(o),r=i.data[o],h=0;r>h;h++)s.push(e.items[n-1]);s.length>0&&AwardTipView.showAward(s)},e.prototype.addEft=function(t){void 0===t&&(t=0),t?Utils.setBtnEnable(this.bTen,!1):Utils.setBtnEnable(this.bOne,!1)},e.prototype.addRandBall=function(){for(var t=0;10>t;t++){var e=100*Math.random(),i=0;e>=20&&40>e?i=1:e>=40&&60>e?i=2:e>=60&&80>e?i=3:e>=80&&(i=4);var s="fuli_json.fuli_q_"+i,o=new eui.Image(s);this.ballCon.addChild(o),o.anchorOffsetX=Math.floor(o.width/2),o.anchorOffsetY=Math.floor(o.height/2)}},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.NIUDIANJI){var e=PFConst.IS_NOPAY?1:3,i=this.tableBgCon.getChildAt(e),s=this.x+this.tableBgCon.x+120*e,o=this.y+this.tableBgCon.y;t.bindTarget(GuideTargetId.TAB_SEL,i,new egret.Point(s,o)),t.bindTarget(GuideTargetId.ND_DC,this.bOne,this.bOne.parent.localToGlobal(this.bOne.x,this.bOne.y))}},e.prototype.onWeight=function(){var t=this._mc.flMgr.ndCfgs.types[this._ndIdx],e=t.items;CmdBus.doCmd(CmdType.O_WEIGHT,e)},e.prototype.clearTzItem=function(){for(var t=0;t<this._tzArray.length;t++){var e=this.tzList.getChildAt(t);e.clearCD()}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_FULI)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,this.clearCon(),this.unbindRedDotCb(),RedDotView.removeRedDotByGroup("fuli"),NiuDanEffect.getInstance().clear(),Utils.setBtnEnable(this.bOne,!0),Utils.setBtnEnable(this.bTen,!0),this.tbtn0.touchEnabled=!0,this.tbtn1.touchEnabled=!0,this.tbtn2.touchEnabled=!0,this.clearTzItem(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("fuli_json"),RES.destroyRes("fuli_bg_1_jpg"),RES.destroyRes("fuli_bg_3_jpg"),RES.destroyRes("fuli_bg_4_jpg")},e}(UIBase);__reflect(FuliView.prototype,"FuliView");var NiuDanEffect=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.show=function(t,e,i,s,o,n,r,h){t.addChild(this),this.x=e,this.y=i,this._t=n,this._num=o,this._cx=s,this._cy=s,this._r=s,this._cb=r,this._cbThis=h,this._bs||this.initBubbles(o,s)},e.prototype.initBubbles=function(t,e){this._bs=[];for(var i=0;t>i;i++){var s=Utils.random(-20,-170),o=s*Math.PI/180,n=new NiuDanEffectBubble;n.radian=o;var r=Utils.random(45,135),h=r*Math.PI/180,a=this._cx+(e-n.r)*Math.cos(h),l=this._cy+(e-n.r)*Math.sin(h);n.x=a,n.y=l,n.dtime=.02*Math.floor(i/3),n.texture=RES.getRes("fuli_json.fuli_q_"+Utils.random(0,4)),this.addChild(n),this._bs.push(n)}},e.prototype.start=function(){this._bs&&(this._ct=this._t,GameTick.instence().bindTick(this.onTime,this))},e.prototype.onTime=function(t){for(var e=1e3*t,i=0,s=this._bs;i<s.length;i++){var o=s[i];o.dtime-=t,o.dtime<0&&(o.x+=e*Math.cos(o.radian),o.y+=e*Math.sin(o.radian),this.checkBorder(o))}this._ct-=t,this._ct<=0&&this._cb&&(this._cb.call(this._cbThis),this.clearItems(),GameTick.instence().unbindTick(this.onTime,this),this.initBubbles(this._num,this._r))},e.prototype.checkBorder=function(t){var e=Utils.distence(this._cx,this._cy,t.x,t.y),i=this._r-t.r;if(e>i){var s=Math.atan2(t.y-this._cy,t.x-this._cx);t.x=this._cx+i*Math.cos(s),t.y=this._cy+i*Math.sin(s);var o=s-t.radian,n=s+o;n>0?t.radian=n-Math.PI:t.radian=n+Math.PI}},e.prototype.clearItems=function(){if(this._bs){for(var t=0,e=this._bs;t<e.length;t++){var i=e[t];i.parent&&this.removeChild(i)}this._bs=null}},e.prototype.clear=function(){GameTick.instence().unbindTick(this.onTime,this),this.clearItems(),this._cb=null,this._cbThis=null,this.parent&&this.parent.removeChild(this)
},e}(egret.DisplayObjectContainer);__reflect(NiuDanEffect.prototype,"NiuDanEffect");var NiuDanEffectBubble=function(t){function e(){var e=t.call(this)||this;return e.r=32,e.dtime=0,e.anchorOffsetX=e.anchorOffsetY=32,e}return __extends(e,t),e}(egret.Bitmap);__reflect(NiuDanEffectBubble.prototype,"NiuDanEffectBubble");var WeidMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.WEID,CmdType.O_WEID),CmdBus.adListener(CmdType.O_WEID,this.onOpenView,this),CmdBus.adListener(CmdType.C_WEID,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new WeidSignView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(WeidMediator.prototype,"WeidMediator",["IMediator"]);var WeidSignView=function(t){function e(){var e=t.call(this,"WeidSignSkin")||this;return e._price=0,e._tabIndex=-1,e._cjNum=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.qdScoll.verticalScrollBar&&(this.qdScoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="FuliQdItemSkin",this.itemList.itemRenderer=FuliQdItem,this.initQdLst()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bqd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQd,this),EventBus.addListener(EventType.M_WD_QD,this.updQdLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bqd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQd,this),EventBus.rmListener(EventType.M_WD_QD,this.updQdLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.qdScoll.viewport.scrollV=0,this.updQdLst()},e.prototype.initQdLst=function(){var t=this._mc.flMgr.wdQdCfgs;this._array.removeAll(),this.qdScoll.viewport.scrollV=0;for(var e=0;e<t.length;e++){var i=t[e],s={state:0,item:i.award,index:e+1};this._array.addItem(s)}},e.prototype.updQdLst=function(){var t=this._mc.flMgr.signdayWd;this._mc.flMgr.isSignWd||t++;for(var e=0;e<this._array.length;e++){var i=this._array.getItemAt(e);t>e?(i.state=2,this._mc.flMgr.isSignWd||e!=t-1||(i.state=1)):i.state=0,this._array.itemUpdated(i)}var s=this._mc.flMgr.wdQdCfgs[t-1];s||(s=this._mc.flMgr.wdQdCfgs[0]),this._mc.flMgr.isSignWd?Utils.setBtnEnable(this.bqd,!1):Utils.setBtnEnable(this.bqd,!0)},e.prototype.onQd=function(){this._mc.flMgr.isSignWd||this._cc.dataCtl.doAction(ServerActionId.SIGNIN_WD,[0])},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_WEID)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(WeidSignView.prototype,"WeidSignView");var GiftManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_gift.json",this.initConfig,this)}return t.prototype.initConfig=function(t){this._dayCfgs=t.day,this._onceCfgs=t.one},t.prototype.getDayConfig=function(t){return this._dayCfgs[t]},t.prototype.getOnceConfig=function(t){return this._onceCfgs[t]},t}();__reflect(GiftManager.prototype,"GiftManager");var GiftType=function(){function t(){}return t.LUPING=1,t.SHOPGIFT_FREE=2,t}();__reflect(GiftType.prototype,"GiftType");var OncegiftType=function(){function t(){}return t.WDLOGIN=1,t}();__reflect(OncegiftType.prototype,"OncegiftType");var GonghuiCItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.tname.text=t.name,this.thy.text=t.hyd,this.trname.text=t.hname,this.tnum.text=t.nums+"/"+GmGlobal.mc.ghMgr.member;var e=!1;t.endtime&&t.endtime-GmGlobal.getServerTime()>=0&&(e=!0),e?this.okBtn.label="Applied":this.okBtn.label="Apply",Utils.setBtnEnable(this.okBtn,!e),this.data.nums<GmGlobal.mc.ghMgr.member?this.okBtn.visible=!0:this.okBtn.visible=!1},e}(eui.ItemRenderer);__reflect(GonghuiCItem.prototype,"GonghuiCItem");var GonghuiController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD,this.onUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_SQ_LST,this.onUpdsqLst,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_M_LST,this.onUpdMLst,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_FL,this.onUpdFl,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_DD,this.onUpdDd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_FL_ITEM,this.onUpdFlItems,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_HZ,this.onUpdHz,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GUILD_HZ_TIME,this.onUpdHzTime,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.id=e.id,i.name=e.name,i.pos=e.pos||0,i.hyd=e.hyd,i.isGx=1==e.am?!0:!1,GmGlobal.mc.chatMgr.MY_GH_CH=i.id?1999+i.id:-1,EventBus.dispatchEvt(EventType.M_GUILD)},t.prototype.onUpdsqLst=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.sqLst=[];for(var s in e)i.sqLst.push(e[s]);EventBus.dispatchEvt(EventType.M_GUILD_SQ_LST)},t.prototype.onUpdMLst=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.ghMLst=[];for(var s in e)i.updGhMLst(Number(s)-1,e[s]);EventBus.dispatchEvt(EventType.M_GUILD_M_LST)},t.prototype.onUpdFl=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.flInfo=e||{},EventBus.dispatchEvt(EventType.M_GUILD_FL)},t.prototype.onUpdFlItems=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.flItems=e||{},EventBus.dispatchEvt(EventType.M_GUILD_FL_ITEM)},t.prototype.onUpdDd=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.ddStates=e.state||{},i.ddNum=e.ordernum||0,i.ddPlst=e.qlst||{};var s=e.time||GmGlobal.getServerTime();i.ddCd.setTime(s-GmGlobal.getServerTime()),i.tor=e.tor||0,EventBus.dispatchEvt(EventType.M_GUILD_DD)},t.prototype.onUpdHz=function(t){var e=t.data.data,i=GmGlobal.mc.ghMgr;i.cnt=e.cnt||0,EventBus.dispatchEvt(EventType.M_GUILD_HZ)},t.prototype.onUpdHzTime=function(t){t.data.data,GmGlobal.mc.ghMgr;EventBus.dispatchEvt(EventType.M_GUILD_HZ_TIME)},t}();__reflect(GonghuiController.prototype,"GonghuiController");var GonghuiCreateView=function(t){function e(){var e=t.call(this,"GonghuiCreateSkin")||this;return e._maxPage=1,e._num=14,e._page=1,e._sidx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GonghuiCItemSkin",this.itemList.itemRenderer=GonghuiCItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bCj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCj,this),this.bsq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSq,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),EventBus.addListener(EventType.M_GUILD_LST,this.updOneLst,this),EventBus.addListener(EventType.M_GUILD,this.updView,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bCj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCj,this),this.bsq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSq,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),EventBus.rmListener(EventType.M_GUILD_LST,this.updOneLst,this),EventBus.rmListener(EventType.M_GUILD,this.updView,this)},e.prototype.updView=function(){this._mc.ghMgr.id&&(this.onClose(),CmdBus.doCmd(CmdType.O_GONGHUI))},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this._page=1,this.reqInfo()},e.prototype.reqInfo=function(){var t=(this._page-1)*this._num+1;this._cc.dataCtl.pbReq(PbReqId.GUILD_REQ,[t,GmGlobal.mc.role.hefuId],null,this.reqOk,this)},e.prototype.reqOk=function(t,e){if(0==t){var i=GmGlobal.mc.ghMgr,s=e.npage;s?Utils.setBtnEnable(this.bPageDown,!0):Utils.setBtnEnable(this.bPageDown,!1);var o=e.lst;this._mc.ghMgr.ghLst=[];for(var n in o)i.updGhLst(Number(n)-1,o[n])}this.updOneLst()},e.prototype.updOneLst=function(){var t=this._mc.ghMgr.ghLst;t&&!Utils.isEmptyObj(t)?(this.bg.visible=!1,this.ghCon.visible=!0):(this.bg.visible=!0,this.ghCon.visible=!1),this._array.replaceAll(t),this._page<=1?Utils.setBtnEnable(this.bPageUp,!1):Utils.setBtnEnable(this.bPageUp,!0)},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent,i=e.data;this._sidx=this.itemList.getChildIndex(e),this._cc.dataCtl.doAction(ServerActionId.GUILD_JOIN,[1,i.id],this.sqOk,this,this.sqOk)}},e.prototype.sqOk=function(){if(-1!=this._sidx){var t=this._array.getItemAt(this._sidx);t.endtime=GmGlobal.getServerTime()+100,this._array.itemUpdated(t)}},e.prototype.sqAllOk=function(){for(var t=0;t<this._array.length;t++){var e=this._array.getItemAt(t);e.endtime=GmGlobal.getServerTime()+100,this._array.itemUpdated(e)}},e.prototype.onCj=function(){MsgBox.input("Cost "+this._mc.ghMgr.cCost+" Crystal(s) to create a guild",this.onCjOk,null,this,"Create","Cancel")},e.prototype.onSq=function(){var t=this._mc.ghMgr.ghLst,e=[1];for(var i in t){var s=t[i],o=!1;s.endtime&&s.endtime-GmGlobal.getServerTime()>=0&&(o=!0),o||e.push(s.id)}this._cc.dataCtl.doAction(ServerActionId.GUILD_JOIN,e,this.sqAllOk,this)},e.prototype.onCjOk=function(t){if(""==t)return void MsgBox.prompt("Enter guild name");if(t.length>6)return void MsgBox.prompt("Name can't exceed 6 Character(s)");var e=this._mc.loginMgr.account,i={userid:e,name:t};GmGlobal.cc.pfCtl.checkMsg(t,function(t){0==t&&GmGlobal.cc.dataCtl.pbReq(PbReqId.GUILD_CREATE,[1],i)})},e.prototype.onPageUp=function(){return 1==this._page?void Utils.setBtnEnable(this.bPageUp,!1):(Utils.setBtnEnable(this.bPageUp,!0),this._page--,void this.reqInfo())},e.prototype.onPageDown=function(){this._page++,this.reqInfo()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_GONGHUI_C)},e.prototype.close=function(){this._page=1,this._maxPage=1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("gh_bg1_jpg")},e}(UIBase);__reflect(GonghuiCreateView.prototype,"GonghuiCreateView");var GonghuiDdItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GonghuiDdItemSkin",e}return __extends(e,t),e}(eui.Component);__reflect(GonghuiDdItem.prototype,"GonghuiDdItem");var GonghuiDdListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.cfg,e=this.data.state;this.index=this.data.idx,this.tTit.text="Total Weekly Guild Order completed "+GmGlobal.mc.ghMgr.tor+"/"+t.num,this._itemGridCon&&this.clear(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t.items,115,!1,!0,!1),this._itemGridCon.addToParent(5,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0),GmGlobal.mc.ghMgr.tor<t.num?(Utils.setBtnEnable(this.blq,!1),this.blq.label="Claim"):2==e?(Utils.setBtnEnable(this.blq,!1),this.blq.label="Claimed"):(Utils.setBtnEnable(this.blq,!0),this.blq.label="Claim")},e.prototype.clear=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(GonghuiDdListItem.prototype,"GonghuiDdListItem");var GonghuiDdView=function(t){function e(){var e=t.call(this,"GonghuiDdSkin")||this;return e._sidx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GonghuiDdListItemSkin",this.itemList.itemRenderer=GonghuiDdListItem,this.bref.iconDisplay.source=this._mc.itemMgr.getItemSicon(ItemID.SHUIJING),this.bref.label=this._mc.ghMgr.refDd+" Refresh",this.ihb.source=this._mc.itemMgr.getItemSicon(ItemID.GUILD_HB),this.initAwdLst()},e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.addEvts=function(){this.btj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTj,this),this.bref.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRef,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.itemCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCon,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQBuy,this),EventBus.addListener(EventType.M_GUILD_DD,this.updUi,this),EventBus.addListener(EventType.M_UPD_CON,this.updHb,this)},e.prototype.rmEvts=function(){this.btj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTj,this),this.bref.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRef,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.itemCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCon,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQBuy,this),EventBus.rmListener(EventType.M_GUILD_DD,this.updUi,this),EventBus.rmListener(EventType.M_UPD_CON,this.updHb,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updHb(),this.updUi(),this.selLst(0),this._cc.dataCtl.doAction(ServerActionId.GUILD_DD_CX),this._mc.ghMgr.ddCd.cd<=0&&this.onRef()},e.prototype.updDdLst=function(){for(var t=this._mc.ghMgr.ddInfo,e=this._mc.ghMgr.ddPlst,i=0;6>i;i++){var s=this["item"+i];s.ixz.visible=i==this._sidx?!0:!1;var o=e[i+1],n=0,r=0,h=!1;o&&!Utils.isEmptyObj(o)&&(n=o.qid-1,r=o.idx-1,h=1==o.s?!0:!1),0==n?(s.bg.source="com_json.colorbg_5",s.tname.textColor=7895160,s.tnum.textColor=7895160,s.thbnum.textColor=7895160):(s.bg.source="com_json.colorbg_"+(n+1),s.tname.textColor=16777215,s.tnum.textColor=16777215,s.thbnum.textColor=16777215);var a=t[n][r];s.item.setItem(new Item(a.id,0)),s.item.enableTip(!0,null,ModelID.GONGHUI);var l=this._mc.itemMgr.getItemCfg(a.id);s.tname.text=l.name,s.icon.source=this._mc.itemMgr.getItemSicon(ItemID.GUILD_HB),s.thbnum.text=a.anum;var c=this._mc.itemMgr.getItemNum(a.id);if(s.tnum.text=c+"/"+a.num,s.iYwc.visible=h,i==this._sidx)if(h)this.btj.visible=!0,this.bBuy.visible=!1,Utils.setBtnEnable(this.btj,!1);else if(c>=a.num)this.btj.visible=!0,this.bBuy.visible=!1,Utils.setBtnEnable(this.btj,!0);else{var d=this._mc.shopMgr.getKapulaItemCfg(a.id);d?(this.btj.visible=!1,this.bBuy.visible=!0,this._qitem=a.id,this._qnum=a.num-c):(this.btj.visible=!0,this.bBuy.visible=!1,Utils.setBtnEnable(this.btj,!1))}}this._mc.ghMgr.ddCd.cd>0&&(this.tcd.visible=!0,CDText.getInstence().addCD(this.tcd,this._mc.ghMgr.ddCd.cd,"","h:m:s"," Auto Refresh",this.onCDEnd,this)),this._mc.ghMgr.ddNum>=this._mc.ghMgr.daycnt&&(CDText.getInstence().rmCD(this.tcd),this.tcd.visible=!1)},e.prototype.onCDEnd=function(){this.onRef()},e.prototype.initAwdLst=function(){for(var t=this._mc.ghMgr.ddAwd,e=0;e<t.length;e++){var i={cfg:t[e],state:!1,idx:e+1};this._array.addItem(i)}},e.prototype.updAwdLst=function(){for(var t=this._mc.ghMgr.ddStates,e=this._mc.ghMgr.ddAwd,i=0;i<e.length;i++){var s=e[i],o=this._array.getItemAt(i);o.state=t[s.num]||0,this._array.itemUpdated(o)}},e.prototype.updUi=function(){this.tddnum.text=this._mc.ghMgr.ddNum+"/"+this._mc.ghMgr.daycnt,this.updAwdLst(),this.updDdLst()},e.prototype.updHb=function(){this.thbnum.text=this._mc.itemMgr.getItemNum(ItemID.GUILD_HB).toString(),this.updDdLst()},e.prototype.onTouchCon=function(t){if(t.target.parent.parent==this.itemCon){var e=t.target.parent,i=this.itemCon.getChildIndex(e);this.selLst(i)}},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList){var e=t.target.parent,i=e.data;"btn"==t.target.name&&this._cc.dataCtl.doAction(ServerActionId.GUILD_DD_AWD,[i.cfg.num])}},e.prototype.selLst=function(t){if(t!=this._sidx){if(-1!=this._sidx){var e=this["item"+this._sidx];e.ixz.visible=!1}var i=this["item"+t];i.ixz.visible=!0,this._sidx=t,this.updDdLst()}},e.prototype.onQBuy=function(){var t=this._mc.shopMgr.getKapulaItemCfg(this._qitem),e=ItemSellView.getInstance();e.setItem(t.item.id,2*t.cost.num,t.cost.id,this._qnum,!0),e.show(GmGlobal.vmc.uiLayer)},e.prototype.onTj=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_DD_TJ,[this._sidx+1])},e.prototype.onRef=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_DD_REF)},e.prototype.close=function(){if(-1!=this._sidx){var e=this["item"+this._sidx];e.ixz.visible=!1}this._sidx=-1,t.prototype.close.call(this),CDText.getInstence().rmCD(this.tcd)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(GonghuiDdView.prototype,"GonghuiDdView");var GonghuiFlItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GonghuiFlItemSkin",e.touchChildren=!1,e}return __extends(e,t),e}(eui.Component);__reflect(GonghuiFlItem.prototype,"GonghuiFlItem");var GonghuiFlLstItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchChildren=!1},e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.state;this.iYqd.visible=1==t?!0:!1,this.ixz.visible=this.data.isSell;var e=this.data.cfg;this.icon.setItem(e.item),this.icon.enableTip(!0)},e}(eui.ItemRenderer);__reflect(GonghuiFlLstItem.prototype,"GonghuiFlLstItem");var GonghuiFlView=function(t){function e(){var e=t.call(this,"GonghuiFlSkin")||this;return e._sNo=0,e._idx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GonghuiFlLstSkin",this.itemList.itemRenderer=GonghuiFlLstItem,this.initLst()},e.prototype.initLst=function(){for(var t=0;10>t;t++){var e={state:0,cfg:{},isSell:!1,index:t+1};this._array.addItem(e)}},e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updHb(),this.updAtrs(),this.updLst(),this.selGrid(0)},e.prototype.addEvts=function(){this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_UPD_CON,this.updHb,this),EventBus.addListener(EventType.M_GUILD_FL,this.updAtrs,this),EventBus.addListener(EventType.M_GUILD_FL_ITEM,this.updLst,this)},e.prototype.rmEvts=function(){this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_UPD_CON,this.updHb,this),EventBus.rmListener(EventType.M_GUILD_FL,this.updAtrs,this),EventBus.rmListener(EventType.M_GUILD_FL_ITEM,this.updLst,this)},e.prototype.updHb=function(){this.tnum.text=this._mc.itemMgr.getItemNum(ItemID.GUILD_HB).toString()},e.prototype.updAtrs=function(){for(var t=0;8>t;t++){var e=this["item"+t],i=this._mc.ghMgr.flInfo[t+1],s=this._mc.ghMgr.flCfg[t],o=0,n=0;i&&!Utils.isEmptyObj(i)&&(o=i.lv,n=i.exp);var r=this._mc.heroMgr.getAtrName(s.name);e.tname.text=r,e.icon.source="gonghui_json.gh_icon"+t;var h=s.lvInfo[o];e.tlv.text="LV."+o,o>=s.lvInfo.length-1?(h=s.lvInfo[s.lvInfo.length-1],e.tlv.text="LV."+o,e.tbar.text="Max LV",e.bar.maximum=h.exp,e.bar.value=h.exp):(e.tbar.text=n+"/"+h.exp,e.bar.maximum=h.exp,e.bar.value=n),e.tms.text=s.des.replace("%x",h.num)}},e.prototype.updLst=function(){for(var t=0;t<this._array.length;t++){var e=this._array.getItemAt(t),i=this._mc.ghMgr.flItems[t+1],s=1,o=0;i&&!Utils.isEmptyObj(i)&&(s=i.idx,o=i.s);var n=this._mc.shopMgr.ghCfgs[s-1];if(e.cfg=n,e.state=o,this._array.itemUpdated(e),t==this._idx){var r=1==o?!1:!0;Utils.setBtnEnable(this.bBuy,r)}}},e.prototype.onTouchList=function(t){if(t.target.parent==this.itemList){var e=t.target,i=this.itemList.getChildIndex(e);this.selGrid(i)}},e.prototype.selGrid=function(t){if(t!=this._idx){if(-1!=this._idx){var e=this._array.getItemAt(this._idx);e.isSell=!1,this._array.itemUpdated(e)}var i=this._array.getItemAt(t);i.isSell=!0,this._array.itemUpdated(i),this._idx=t;var s=i.cfg,o=this._mc.itemMgr.getItemCfg(s.item.id);this.tname.text=o.name,this.tms.text=o.des,this.icon0.source=this._mc.itemMgr.getItemSicon(s.cost.id),this.thb.text=s.cost.num;var n=1==i.state?!1:!0;Utils.setBtnEnable(this.bBuy,n)}},e.prototype.onBuy=function(){var t=this;0!=this._sNo&&GmGlobal.server.clearSerialCallbak(this._sNo);var e=this._array.getItemAt(this._idx),i=e.cfg,s=this._mc.itemMgr.getItemCfg(i.item.id),o=s.guildattr;if(o){var n=this.getAtrIdx(o),r=this._mc.ghMgr.flInfo[n+1],h=this._mc.ghMgr.flCfg[n],a=0,l=0;if(r&&!Utils.isEmptyObj(r)&&(a=r.lv,l=r.exp),a>=h.lvInfo.length-1){var c=this._mc.heroMgr.getAtrName(o);MsgBox.prompt(c+" Max LV")}else this._sNo=this._cc.itemCtl.reqBuyItem(i.item.id,i.item.num,i.cost.id,function(e){t._sNo=0})}else this._sNo=this._cc.itemCtl.reqBuyItem(i.item.id,i.item.num,i.cost.id,function(e){t._sNo=0})},e.prototype.getAtrIdx=function(t){for(var e=-1,i=0;8>i;i++){var s=this._mc.ghMgr.flCfg[i];if(s.name==t){e=i;break}}return e},e.prototype.close=function(){this._idx=-1,0!=this._sNo&&GmGlobal.server.clearSerialCallbak(this._sNo),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(GonghuiFlView.prototype,"GonghuiFlView");var GonghuiHdView=function(t){function e(){var e=t.call(this,"GonghuiHdSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null},e.prototype.addEvts=function(){this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bTz.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTz,this),EventBus.addListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this)},e.prototype.rmEvts=function(){this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bTz.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTz,this),EventBus.rmListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateState()},e.prototype.onHdStateUpd=function(t){var e=t.data;e==FubenType.GH_BOSS&&this.updateState()},e.prototype.updateState=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.GH_BOSS),i=GmGlobal.getServerTime();if(e.startTime&&i<e.endTime){Utils.setBtnEnable(this.bTz,!0),this.bTz.label="Enter";var s=e.endTime-i;CDText.getInstence().addCD(this.tTime,s,"Event in progress, Left ","h:m:s","",this.onTimeOut,this)}else this.setNoOpenState()},e.prototype.setNoOpenState=function(){this.tTime.text=this._mc.ghMgr.oTime,this.bTz.label="Unavailable",Utils.setBtnEnable(this.bTz,!1)},e.prototype.onTimeOut=function(){this.setNoOpenState()},e.prototype.onTz=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_HD_TZ,null,this.tzOk,this)},e.prototype.tzOk=function(){CmdBus.doCmd(CmdType.C_GONGHUI)},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_GONGHUI_RANK)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.ghMgr.bossRule)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("gh_bg0_jpg")},e}(UIBase);__reflect(GonghuiHdView.prototype,"GonghuiHdView");var GonghuiHzItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.idx;var t=this.data.info,e=this.data.ismy;if(this.ttag.text=this.index.toString(),t&&!Utils.isEmptyObj(t)){this.bgtag.visible=!1,this.ttag.visible=!1,this.bcj.visible=!1,this.bg1.visible=!0,this.bg2.visible=!0,this.icon.visible=!0,this.tname.visible=!0,this.tnum.visible=!0,this.thy.visible=!0,this.btc.visible=e,this.updateHeroIcon(),this.tname.text=t.name;var i=GmGlobal.mc.heroMgr.getHeroCfg(t.career),s=GmGlobal.mc.heroMgr.getCareerCfg(i.career);this.thy.text=s.name,this.tnum.text=t.lv}else this.bgtag.visible=!0,this.ttag.visible=!0,this.bcj.visible=!0,this.bg1.visible=!1,this.bg2.visible=!1,this.icon.visible=!1,this.tname.visible=!1,this.tnum.visible=!1,this.thy.visible=!1,this.btc.visible=!1,Utils.setBtnEnable(this.bcj,!e)},e.prototype.updateHeroIcon=function(){var t=GmGlobal.mc,e=t.loginMgr.headurl;if(e)if(-1!=e.indexOf("http"))this.icon.source=e;else{var i=this;egret.BitmapData.create("base64",e,function(t){var e=new egret.Texture;e.bitmapData=t,i.icon.source=e})}else this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+t.role.careerId+".png"},e}(eui.ItemRenderer);__reflect(GonghuiHzItem.prototype,"GonghuiHzItem");var GonghuiHzView=function(t){function e(){var e=t.call(this,"GonghuiHzSkin")||this;return e._sNo=0,e._jsNo=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.clearItems();var e=this._mc.ghMgr.boxItems;this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(e,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.addEvts=function(){this.bgh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGh,this),this.bjf.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJf,this),this.bjr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.addListener(EventType.M_GUILD_HZ,this.updHz,this)},e.prototype.rmEvts=function(){this.bgh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGh,this),this.bjf.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJf,this),this.bjr.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.rmListener(EventType.M_GUILD_HZ,this.updHz,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updHz(),this.tTime.text=this._mc.ghMgr.hzDes;var i=GmGlobal.mc;this._cc.dataCtl.pbReq(PbReqId.GUILD_B_DATA,[i.role.kfFlag,i.ghMgr.id],null,this.onRoleJfInfo,this)},e.prototype.onRoleJfInfo=function(t,e){e.role_rank?this.tjfRank.text=e.role_rank:this.tjfRank.text="Unranked",this.tgrjf.text=e.role_score||0,e.guild_rank?this.tghRank.text=e.guild_rank:this.tghRank.text="Unranked",this.tzjf.text=e.guild_score||0},e.prototype.updHz=function(){this.tnum.text=this._mc.ghMgr.cnt+"/"+this._mc.ghMgr.boxAwd},e.prototype.onEnter=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_HZ_PP,[],this.onOk,this)},e.prototype.onOk=function(){CmdBus.doCmd(CmdType.C_GONGHUI)},e.prototype.onGh=function(){CmdBus.doCmd(CmdType.O_GONGHUI_RANK,1)},e.prototype.onJf=function(){CmdBus.doCmd(CmdType.O_GONGHUI_RANK,2)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.ghMgr.btRule)},e.prototype.close=function(){0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),0!=this._jsNo&&(GmGlobal.server.clearSerialCallbak(this._jsNo),this._jsNo=0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearItems(),RES.destroyRes("gh_bg2_jpg")},e}(UIBase);__reflect(GonghuiHzView.prototype,"GonghuiHzView");var GonghuiManager=function(){function t(){this.rule="",this.cCost=0,this.member=0,this.posName=[],this.daycnt=0,this.refDd=0,this.ddInfo=[],this.ddAwd=[],this.bossRule="",this.oTime="",this.rankAwd=[],this.btRule="",this.fhPrice=0,this.enterLv=0,this.boxAwd=0,this.btTime=0,this.fhCd=0,this.boxItems=[],this.guildRAwd=[],this.jfRAwd=[],this.hzDes="",this.flCfg=[],this.id=0,this.pos=0,this.hyd=0,this.sqLst=[],this.ddNum=0,this.ddStates={},this.ordernum=0,this.ddPlst={},this.tor=0,this.ghLst=[],this.ghMLst=[],this.flInfo={},this.flItems={},this.cnt=0,this.isGx=!0,GmGlobal.mc.regUnzipCfg("c_guild.json",this.initCfg,this),this.ddCd=new GameTime(0)}return t.prototype.initCfg=function(t){this.rule=t.rules,this.cCost=t.createCost,this.member=t.members,this.posName=t.posname,this.daycnt=t.daycnt,this.refDd=t.refDd,this.ddInfo=t.ddInfo,this.ddAwd=t.ddAwd,this.bossRule=t.bossRule,this.oTime=t.oTime,this.rankAwd=t.rankAwd,this.btRule=t.btRule,this.fhPrice=t.fhPrice,this.enterLv=t.enterLv,this.boxAwd=t.boxAwd,this.btTime=t.btTime,this.fhCd=t.fhCd,this.boxItems=t.boxItems,this.guildRAwd=t.guildRAwd,this.jfRAwd=t.jfRAwd,this.flCfg=t.fl,this.hzDes=t.hzdes||""},t.prototype.getRankAwList=function(t){void 0===t&&(t=1);var e=this.rankAwd;return 3==t?e=this.guildRAwd:2==t&&(e=this.jfRAwd),e},t.prototype.getRankIdList=function(t){void 0===t&&(t=1);var e=this.rankAwd;3==t?e=this.guildRAwd:2==t&&(e=this.jfRAwd);for(var i=[],s=0;s<e.length;s++){var o=e[s];o.rankto?o.rankto>10&&i.push(o.rankto):o.rank>10&&i.push(o.rank)}return i},t.prototype.getMyRankAwd=function(t,e){void 0===e&&(e=1);var i=[],s=this.rankAwd;3==e?s=this.guildRAwd:2==e&&(s=this.jfRAwd);for(var o=0;o<s.length;o++){var n=s[o];if(t==n.rank&&0==n.rankto){i=s[t-1].items;break}if(t>n.rank&&t<=n.rankto){i=n.items;break}}return i},t.prototype.updGhLst=function(t,e){this.ghLst[t]=e},t.prototype.updGhMLst=function(t,e){this.ghMLst[t]=e},t}();__reflect(GonghuiManager.prototype,"GonghuiManager");var GonghuiMediator=function(){function t(){this._isOpen=!0,GmGlobal.mc.muiMgr.regCmd(ModelID.GONGHUI,CmdType.O_GONGHUI),CmdBus.adListener(CmdType.O_GONGHUI,this.onOpenView,this),CmdBus.adListener(CmdType.C_GONGHUI,this.onCloseView,this),CmdBus.adListener(CmdType.O_GONGHUI_C,this.onOpenCView,this),CmdBus.adListener(CmdType.C_GONGHUI_C,this.onCloseCView,this),CmdBus.adListener(CmdType.O_GONGHUI_XXCY,this.onOpenXxView,this),CmdBus.adListener(CmdType.C_GONGHUI_XXCY,this.onCloseXxView,this),CmdBus.adListener(CmdType.O_GONGHUI_RANK,this.onOpenRankView,this),CmdBus.adListener(CmdType.C_GONGHUI_RANK,this.onCloseRankView,this),CmdBus.adListener(CmdType.O_GONGHUI_SQ_TIP,this.onOpenSqTip,this),CmdBus.adListener(CmdType.C_GONGHUI_SQ_TIP,this.onCloseSqTip,this),EventBus.addListener(EventType.M_MUI_READY,this.onMuiReady,this),EventBus.addListener(EventType.M_GUILD_SQ_LST,this.onGhSq,this)}return t.prototype.onGhSq=function(){GmGlobal.mc.ghMgr.sqLst&&GmGlobal.mc.ghMgr.sqLst.length>0?CmdBus.doCmd(CmdType.O_GONGHUI_SQ_TIP):CmdBus.doCmd(CmdType.C_GONGHUI_SQ_TIP)},t.prototype.onMuiReady=function(){GmGlobal.cc
},t.prototype.onBossRet=function(t){var e=GmGlobal.mc.wfMgr,i=e.getWfData(FubenType.GH_BOSS);i.startTime=t.begintime,i.endTime=t.endtime,EventBus.dispatchEvt(EventType.HD_STATE_UPD,FubenType.GH_BOSS)},t.prototype.onHzRet=function(t){var e=GmGlobal.mc.wfMgr,i=e.getWfData(FubenType.GHZ);i.startTime=t.begintime,i.endTime=t.endtime,EventBus.dispatchEvt(EventType.HD_STATE_UPD,FubenType.GHZ)},t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t){void 0===t&&(t=0),this._showIndex=t||0,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new GonghuiView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._showIndex)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenCView=function(){this.doOpenCView()},t.prototype.doOpenCView=function(){this._cview||(this._cview=new GonghuiCreateView),this._cview.isShow||(this._cview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseCView=function(t){this._cview&&this._cview.isShow&&(this._cview.alphaClose(this._cview.close,this._cview),this._cview=null),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenXxView=function(t,e){this._xxview||(this._xxview=new GonghuiXxCyView),this._xxview.isShow||(this._xxview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseXxView=function(){this._xxview&&this._xxview.isShow&&this._xxview.close()},t.prototype.onOpenRankView=function(t){void 0===t&&(t=0),this._rankview||(this._rankview=new GonghuiRankView),this._rankview.isShow||(this._rankview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._rankview.setRankType(t)},t.prototype.onCloseRankView=function(){this._rankview&&this._rankview.isShow&&this._rankview.close()},t.prototype.onOpenSqTip=function(){this._sqTip||(this._sqTip=new GonghuiSqTip),this._sqTip.isShow||(this._sqTip.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseSqTip=function(){this._sqTip&&this._sqTip.isShow&&this._sqTip.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._xxview&&(this._xxview.destroy(),this._xxview=null),this._rankview&&(this._rankview.destroy(),this._rankview=null),!0):!1:!0},t}();__reflect(GonghuiMediator.prototype,"GonghuiMediator",["IMediator"]);var GonghuiRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data.cfg.rankto?this.tRank.text=this.data.cfg.rank+"-"+this.data.cfg.rankto:this.tRank.text=this.data.cfg.rank,this.data.cfg.rank<=10?(this.rName.visible=!0,this.rName.text=this.data.rname):this.rName.visible=!1,0==this.data.jf?this.tJf.text="None":this.data.cfg.rank<=10?this.tJf.text=this.data.jf:this.tJf.text="Above "+this.data.jf,this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.cfg.items,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(GonghuiRankItem.prototype,"GonghuiRankItem");var GonghuiRankView=function(t){function e(){var e=t.call(this,"GonghuiRankSkin")||this;return e._sNo=0,e._msNo=0,e._rankId=RankID.GUILD_HURT,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GonghuiRankItemSkin",this.itemList.itemRenderer=GonghuiRankItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0)},e.prototype.setRankType=function(t){void 0===t&&(t=0);var e=GmGlobal.mc,i=GmGlobal.cc,s=[e.role.kfFlag];if(1==t){this._type=3,this.tTit.text="Guild Ranking",this.tMtit.text="My Guild",this.txt1.text="Guild Name",this.txt2.text="Total Points",s.push(e.ghMgr.id);var o=GmGlobal.mc.ghMgr.getRankIdList(3);s=s.concat(o),i.dataCtl.pbReq(PbReqId.GUILD_GHJF,s,null,this.onRankData2,this)}else if(2==t){this._type=2,this.tTit.text="Points Ranking",this.tMtit.text="My Points",this.txt1.text="Player Name",this.txt2.text="Points";var o=GmGlobal.mc.ghMgr.getRankIdList(2);s=s.concat(o),i.dataCtl.pbReq(PbReqId.GUILD_JF,s,null,this.onRankData,this)}else{this._type=1,this.tTit.text="DMG Ranking",this.tMtit.text="My Ranking",this.txt1.text="Player Name",this.txt2.text="DMG";var o=GmGlobal.mc.ghMgr.getRankIdList(1);s=s.concat(o),i.dataCtl.pbReq(PbReqId.GUILD_BOSS_JF,s,null,this.onRankData,this)}this.scoll.viewport.scrollV=0},e.prototype.onRankData=function(t,e){var i=[];for(var s in e.rank)i.push(e.rank[s].rid);this._cc.rankCtl.getRoleData(i,e,[RoleAttrId.CAREER],this.updateList,this)},e.prototype.onRankData2=function(t,e){this.updateList(e)},e.prototype.updateList=function(t){for(var e=GmGlobal.mc,i=e.ghMgr.getRankAwList(this._type),s=0;s<i.length;s++){var o=i[s],n={cfg:o,rname:"",jf:0},r=o.rankto>0?o.rankto:o.rank,h=t.rank[r];if(h)if(n.jf=h.data,h.rid){var a=e.rankMgr.getRoleData(h.rid);n&&(n.rname=a.name)}else n.rname=h.name;null!=this._array.getItemAt(s)?this._array.replaceItemAt(n,s):this._array.addItem(n)}this.clearMItems(),this.tJf.text="0";var l=this.getMyRank(t.rank);l?this.tRank.text=l.toString():this.tRank.text="Unranked";var c=this._mc.ghMgr.getMyRankAwd(l,this._type);this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(c,115,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.getMyRank=function(t){var e=GmGlobal.mc;for(var i in t){var s=t[i];if(3==this._type){if(s.gid==e.ghMgr.id)return this.tJf.text=s.data,Number(i)}else if(s.rid==e.role.roleId)return this.tJf.text=s.data,Number(i)}return 0},e.prototype.clearMItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onClose=function(){},e.prototype.close=function(){this.clearMItems(),this.clearItems(),0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),0!=this._msNo&&(GmGlobal.server.clearSerialCallbak(this._msNo),this._msNo=0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(GonghuiRankView.prototype,"GonghuiRankView");var GonghuiSqTip=function(t){function e(){var e=t.call(this,"GonghuiSqTipSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){this.x=0,this.y=Math.floor((GmGlobal.stageHeight-this.height)/3*2)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCk,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCk,this)},e.prototype.onCk=function(){CmdBus.doCmd(CmdType.O_GONGHUI_XXCY)},e}(UIBase);__reflect(GonghuiSqTip.prototype,"GonghuiSqTip");var GonghuiView=function(t){function e(){var e=t.call(this,"GonghuiSkin")||this;return e._tabIndex=-1,e._pageClass={0:GonghuiXxView,1:GonghuiDdView,2:GonghuiHdView,3:GonghuiHzView,4:GonghuiFlView},e._pageInstence={},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;t<this.tableBgCon.numChildren;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){for(var t=this.tableBgCon.numChildren,e=0;t>e;e++)e==this._tabIndex?this.showPage(e):this.closePage(e)},e.prototype.showPage=function(t){var e=this._pageInstence[t];if(e)e.show(this);else if(this._pageClass[t]){var i=this._pageClass[t];e=new i,e.show(this),this._pageInstence[t]=e}},e.prototype.closePage=function(t){var e=this._pageInstence[t];e&&e.close()},e.prototype.clearPages=function(){for(var t in this._pageInstence){var e=this._pageInstence[t];e&&(e.close(),e.destroy(),delete this._pageInstence[t])}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_GONGHUI)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearPages(),RES.destroyRes("gh_bg0_jpg"),RES.destroyRes("gonghui_json")},e}(UIBase);__reflect(GonghuiView.prototype,"GonghuiView");var GonghuiXxCyItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.tname.text=t.name,this.tnum.text=t.lv;var e=GmGlobal.mc.heroMgr.getHeroCfg(t.career),i=GmGlobal.mc.heroMgr.getCareerCfg(e.career);this.tzy.text=i.name},e}(eui.ItemRenderer);__reflect(GonghuiXxCyItem.prototype,"GonghuiXxCyItem");var GonghuiXxCyView=function(t){function e(){var e=t.call(this,"GonghuiXxCySkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GonghuiXxCyItemSkin",this.itemList.itemRenderer=GonghuiXxCyItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.ballTg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTg,this),this.ballJj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJj,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_GUILD_SQ_LST,this.updLst,this)},e.prototype.rmEvts=function(){this.ballTg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTg,this),this.ballJj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJj,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_GUILD_SQ_LST,this.updLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),this.updLst()},e.prototype.updLst=function(){this._array.replaceAll(this._mc.ghMgr.sqLst),this._mc.ghMgr.sqLst.length>0?(Utils.setBtnEnable(this.ballJj,!0),Utils.setBtnEnable(this.ballTg,!0)):(Utils.setBtnEnable(this.ballJj,!1),Utils.setBtnEnable(this.ballTg,!1))},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&("tg"==t.target.name||"jj"==t.target.name)){var e=t.target.parent,i=(e.data,"tg"==t.target.name?1:0),s=this.itemList.getChildIndex(e);this._cc.dataCtl.doAction(ServerActionId.GUILD_IS_JOIN,[s+1,i])}},e.prototype.onJj=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_IS_JOIN,[0,0],this.close,this)},e.prototype.onTg=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_IS_JOIN,[0,1],this.close,this)},e.prototype.reqOk=function(t,e){if(0==t){var i=GmGlobal.mc.ghMgr;i.ghMLst=[];for(var s in e)i.updGhMLst(Number(s)-1,e[s])}EventBus.dispatchEvt(EventType.M_GUILD_M_LST)},e.prototype.close=function(){this._cc.dataCtl.pbReq(PbReqId.GUILD_M_REQ,[],null,this.reqOk,this),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(GonghuiXxCyView.prototype,"GonghuiXxCyView");var GonghuiXxItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchChildren=!1},e.prototype.dataChanged=function(){var t=this.data;this.tname.text=t.rolename,this.tnum.text=t.level,this.thy.text=t.hyd;var e=GmGlobal.mc.heroMgr.getHeroCfg(t.career),i=GmGlobal.mc.heroMgr.getCareerCfg(e.career);this.tzy.text=i.name;var s=0;t.pos&&(s=t.pos-1);var o=GmGlobal.mc.ghMgr.posName[s];this.ttag.text=o,s>2?(this.itag.visible=!1,this.ttag.visible=!1):(this.itag.visible=!0,this.ttag.visible=!0,this.itag.source="com_json.bg_eqp"+(2-s))},e}(eui.ItemRenderer);__reflect(GonghuiXxItem.prototype,"GonghuiXxItem");var GonghuiXxView=function(t){function e(){var e=t.call(this,"GonghuiXxSkin")||this;return e._tId=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GonghuiXxItemSkin",this.itemList.itemRenderer=GonghuiXxItem},e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.addEvts=function(){this.bsq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSq,this),this.bexit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.isel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSel,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_GUILD_M_LST,this.updLst,this),EventBus.addListener(EventType.M_GUILD,this.updView,this)},e.prototype.rmEvts=function(){this.bsq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSq,this),this.bexit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.isel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSel,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_GUILD_M_LST,this.updLst,this),EventBus.rmListener(EventType.M_GUILD,this.updView,this)},e.prototype.updView=function(){this._mc.ghMgr.id?this._cc.dataCtl.pbReq(PbReqId.GUILD_M_REQ,[],null,this.reqOk,this):(CmdBus.doCmd(CmdType.C_GONGHUI),CmdBus.doCmd(CmdType.O_GONGHUI_C))},e.prototype.show=function(e){t.prototype.show.call(this,e),this._cc.dataCtl.pbReq(PbReqId.GUILD_M_REQ,[],null,this.reqOk,this)},e.prototype.reqOk=function(t,e){if(0==t){var i=GmGlobal.mc.ghMgr;i.ghMLst=[];for(var s in e)i.updGhMLst(Number(s)-1,e[s])}this.updLst(),this.setGxState(this._mc.ghMgr.isGx)},e.prototype.updBtnPos=function(){1==this._mc.ghMgr.pos?(this.bsq.visible=!0,this.isel.visible=!0,this.tsel.visible=!0,this.bexit.x=220):(this.bsq.visible=!1,this.isel.visible=!1,this.tsel.visible=!1,this.bexit.x=Math.floor(this.width/2))},e.prototype.setGxState=function(t){Utils.setBtnEnable(this.bsq,!t),t?(this.isel.source="com_json.sel_1",CmdBus.doCmd(CmdType.C_GONGHUI_SQ_TIP)):this.isel.source="com_json.sel_0"},e.prototype.updLst=function(){var t=this._mc.ghMgr.ghMLst;t&&!Utils.isEmptyObj(t)&&this._array.replaceAll(t),this.pageTxt.text=t.length+"/"+this._mc.ghMgr.member,this.updBtnPos()},e.prototype.onTouchList=function(t){if(t.target.parent==this.itemList){var e=t.target,i=e.data;if(this._tId=i.roleid,1!=this._mc.ghMgr.pos)return;if(i.roleid==this._mc.role.roleId)return;var s="Remove "+TextFormat.setColor(i.rolename,2844323)+" from the guild?";MsgBox.confirm(s,this.tcOk,null,this)}},e.prototype.tcOk=function(){this._tId&&this._cc.dataCtl.doAction(ServerActionId.GUILD_OUT,[this._tId],this.ok,this)},e.prototype.ok=function(){this._cc.dataCtl.pbReq(PbReqId.GUILD_M_REQ,[],null,this.reqOk,this),this._tId=0},e.prototype.onSel=function(){this.setGxState(!this._mc.ghMgr.isGx),this._cc.dataCtl.doAction(ServerActionId.GUILD_GX)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.ghMgr.rule)},e.prototype.onSq=function(){this._mc.ghMgr.sqLst.length<1?MsgBox.prompt("No application yet"):CmdBus.doCmd(CmdType.O_GONGHUI_XXCY)},e.prototype.onExit=function(){MsgBox.confirm("Confirm to leave?",this.exitOk,null,this)},e.prototype.exitOk=function(){this._cc.dataCtl.doAction(ServerActionId.GUILD_JOIN,[0])},e.prototype.close=function(){t.prototype.close.call(this),this._tId=0},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(GonghuiXxView.prototype,"GonghuiXxView");var DoubleGetView=function(t){function e(){return t.call(this,"DoubleGetViewSkin")||this}return __extends(e,t),e.instence=function(){return this._instence||(this._instence=new e),this._instence},e.close=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.oneBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.dBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDouble,this)},e.prototype.rmEvts=function(){this.oneBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.dBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDouble,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.setData=function(t,e,i,s,o){this._cb=s,this._cbThis=o,this.cicon.source=GmGlobal.mc.itemMgr.getItemSicon(e),this.ctxt.text=i.toString(),this._itemGridCon&&ItemGridCon.release(this._itemGridCon),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,100),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,10,this.iconCon,this.txtCon,540),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER},e.prototype.onOne=function(){this._cb&&this._cb.call(this._cbThis,1)},e.prototype.onDouble=function(){this._cb&&this._cb.call(this._cbThis,2)},e.prototype.close=function(){this._itemGridCon&&ItemGridCon.release(this._itemGridCon),t.prototype.close.call(this)},e}(UIBase);__reflect(DoubleGetView.prototype,"DoubleGetView");var GrowupTaskController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.GTASK,this.onUpdate,this)}return t.prototype.onUpdate=function(t){var e=t.data.data;this.updateRedDot(e),EventBus.dispatchEvt(EventType.GTASK_UPD),e.finish&&CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.GTASK,2)},t.prototype.updateRedDot=function(t){var e=GmGlobal.mc.gtaskMgr,i=e.redDot,s=e.getDaysCfg(),o=GmGlobal.mc.dataMgr.getJData(JsonID.LOGIN_DAY).data;for(var n in s){i.childs[n].state=0;var r=Number(n);if(!(r>o.totalnum)){for(var h=s[n],a=0,l=0;l<h.tlst.length;l++){var c=h.tlst[l],d=0;if(t.task&&(21==c.id?t.task[c.id]>0&&t.task[c.id]<=c.num&&(d=1):t.task[c.id]>=c.num&&(d=1)),t.award&&t.award[c.uid]&&(d=2,a++),1==d){i.childs[n].state=1;break}}a==h.tlst.length&&t.toaward&&!t.toaward[n]&&(i.childs[n].state=1)}}},t}();__reflect(GrowupTaskController.prototype,"GrowupTaskController");var GrowupTaskItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.bar.slideDuration=0},e.prototype.dataChanged=function(){var t=GmGlobal.mc.gtaskMgr,e=this.data.cfg,i=t.getTaskText(e.id);this.txt.text=i.replace("%x",e.num),21==e.id?(this.bar.maximum=1,this.bar.value=this.data.state>0?1:0):(this.bar.maximum=e.num,this.bar.value=this.data.num||0),2==this.data.state?(this.bLq.visible=!1,this.ywc.visible=!0):1==this.data.state?(this.ywc.visible=!1,this.bLq.visible=!0,this.bLq.label="Claim",this.bLq.skinName="ComBtnSkinY"):(this.ywc.visible=!1,this.data.gotoCmd?(this.bLq.visible=!0,this.bLq.label="Go",this.bLq.skinName="ComBtnSkinB"):this.bLq.visible=!1),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(e.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.txtCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(GrowupTaskItem.prototype,"GrowupTaskItem");var GrowupTaskManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_growup.json",this.updateCfg,this)}return t.prototype.updateCfg=function(t){this._cfgs=t;var e={};for(var i in t.days)e[i]=0;this.redDot=RedDot.initRedDot(e),GmGlobal.mc.muiMgr.regRedDot(ModelID.GTASK,this.redDot)},t.prototype.getDaysCfg=function(){return this._cfgs.days},t.prototype.getTaskText=function(t){return this._cfgs.tasks[t]},t.prototype.getDayCfg=function(t){return this._cfgs.days[t]},t.prototype.getGotoCmd=function(t){var e=null;switch(t){case 1:e={map:1};break;case 2:e={map:1};break;case 3:e={npc:6701,a:0,m:ModelID.EQUIP};break;case 4:e={npc:6701,a:2,m:ModelID.EQUIP};break;case 5:e={npc:6701,a:1,m:ModelID.EQUIP};break;case 6:e={map:1};break;case 7:e={cmd:CmdType.O_SHOP,a:1,m:ModelID.SHOP};break;case 8:e={cmd:CmdType.O_FULI,a:3,m:ModelID.FULI};break;case 9:e={npc:6702,a:0,m:ModelID.TOUSHI_M};break;case 11:e={cmd:CmdType.O_WANFA,a:1,m:ModelID.WANFA};break;case 12:e={cmd:CmdType.O_MVP,m:ModelID.MVP};break;case 13:e={npc:6705,a:1,m:ModelID.GONGHUI};break;case 14:e={cmd:CmdType.O_WANFA,a:0,m:ModelID.WANFA};break;case 15:e={cmd:CmdType.O_WANFA,a:2,m:ModelID.WANFA};break;case 17:e={cmd:CmdType.O_PET,a:0,m:ModelID.PET};break;case 18:e={cmd:CmdType.O_XINGZUO,a:0,m:ModelID.XINGZUO};break;case 20:e={cmd:CmdType.O_WANFA,a:1,m:ModelID.WANFA};break;case 21:e={cmd:CmdType.O_WANFA,a:0,m:ModelID.WANFA};break;case 22:e={cmd:CmdType.O_WANFA,a:2,m:ModelID.WANFA};break;case 24:e={cmd:CmdType.O_MVP,m:ModelID.MVP};break;case 25:e={npc:6705,a:3,m:ModelID.GONGHUI};break;case 26:e={cmd:CmdType.O_TOUSHI,m:ModelID.TOUSHI};break;case 27:e={cmd:CmdType.O_BAOWU,m:ModelID.CHUANBAO};break;case 28:e={cmd:CmdType.O_HUOBAN,m:ModelID.HUOBAN}}return e},t}();__reflect(GrowupTaskManager.prototype,"GrowupTaskManager");var GrowupTaskMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.GTASK,CmdType.O_GTASK),CmdBus.adListener(CmdType.O_GTASK,this.onOpenView,this),CmdBus.adListener(CmdType.C_GTASK,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMuiReady,this)}return t.prototype.onMuiReady=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMuiReady,this);var t=GmGlobal.mc.dataMgr.getJData(JsonID.GTASK).data;t.finish&&CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.GTASK,2)},t.prototype.onOpenView=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.LOGIN_DAY).data;this._showIndex=t.totalnum-1,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new GrowupTaskView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),this._view.selTab(this._showIndex),this._view.setTabScloll(this._showIndex),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(GrowupTaskMediator.prototype,"GrowupTaskMediator",["IMediator"]);var GrowupTaskView=function(t){function e(){var e=t.call(this,"GrowupTaskSkin")||this;return e._tabIndex=-1,e.tabNum=7,e._openDay=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="GrowupTaskItemSkin",this.itemList.itemRenderer=GrowupTaskItem;var e=GmGlobal.mc.gtaskMgr.getDaysCfg();this.tabNum=Utils.getObjectLength(e);for(var i=1;i<=this.tabNum;i++){var s=new eui.Image("com_json.tab_ui0");s.width=110,s.height=55,s.scale9Grid=new egret.Rectangle(11,0,2,60),this.tableBgCon.addChild(s);var o=new eui.Label;o.width=110,o.height=55,o.size=22,o.textAlign="center",o.verticalAlign="middle",o.strokeColor=10534624,o.stroke=2,o.text="Day "+i,this.tableTxtCon.addChild(o)}this.tableTxtCon.width=this.tableBgCon.width=110*this.tabNum+10*(this.tabNum-1)+20},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemList,this),this.bLq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLq,this),EventBus.addListener(EventType.GTASK_UPD,this.onUpdate,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemList,this),this.bLq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLq,this),EventBus.rmListener(EventType.GTASK_UPD,this.onUpdate,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),GmGlobal.cc.dataCtl.doAction(ServerActionId.GTASK_R)},e.prototype.onUpdate=function(t){this.updateList()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t>this.tabNum-1&&(t=this.tabNum-1),t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.setTabScloll=function(t){t>this.tabNum-1&&(t=this.tabNum-1);var e=120*t+110;t==this.tabNum-1&&(e+=20);var i=e-this.tabScoll.width;i>0&&(this.tabScoll.viewport.scrollH=i);for(var s=0;s<this.tabNum;s++){var o=this.tableBgCon.getChildAt(s);t>=s?(o.touchEnabled=!0,o.filters=[]):(o.touchEnabled=!1,o.filters=FilterUtils.disabled())}this._openDay=t+1,this.updateTabRedDot(),this.bindRedDotCb()},e.prototype.updateSelState=function(){for(var t=0;t<this.tabNum;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.setTotalAw(),this.updateList()},e.prototype.setTotalAw=function(){this._totalAwCon||(this._totalAwCon=ItemGridCon.create(),this._totalAwCon.initGridsByNum(2,100),this._totalAwCon.setTouchCb(!0),this._totalAwCon.addToParent(10,0,this.iconCon,this.txtCon,210));var t=GmGlobal.mc.gtaskMgr.getDayCfg(this._tabIndex+1);this._totalAwCon.setItems(t.taw.items)},e.prototype.updateList=function(){var t=GmGlobal.mc,e=this._tabIndex+1,i=t.dataMgr.getJData(JsonID.GTASK).data;if(i.finish)return this.bLq.label="Claimed",void Utils.setBtnEnable(this.bLq,!1);for(var s=t.gtaskMgr.getDayCfg(e),o=0,n=0,r=this.sortList(s.tlst,i),h=0;h<r.length;h++){var a=r[h];o++;var l={cfg:a,num:0,state:0,gotoCmd:t.gtaskMgr.getGotoCmd(a.id)},c=0;i.task&&(l.num=i.task[a.id]||0,21==a.id?l.num>0&&l.num<=a.num&&(c=1):l.num>=a.num&&(c=1)),i.award&&i.award[a.uid]&&(c=2),l.state=c,2==c&&n++,this._array.length>h?this._array.replaceItemAt(l,h):this._array.addItem(l)}for(;this._array.length>h;)this._array.removeItemAt(h);this.totalBar.maximum=o,this.totalBar.value=n,o>n?(this.bLq.label="Claim",Utils.setBtnEnable(this.bLq,!1)):i.toaward&&i.toaward[e]?(this.bLq.label="Claimed",Utils.setBtnEnable(this.bLq,!1)):(this.bLq.label="Claim",Utils.setBtnEnable(this.bLq,!0))},e.prototype.sortList=function(t,e){for(var i=[],s=[],o=[],n=0;n<t.length;n++){var r=t[n],h=0;e.task&&(21==r.id?e.task[r.id]>0&&e.task[r.id]<=r.num&&(h=1):e.task[r.id]>=r.num&&(h=1)),e.award&&e.award[r.uid]&&(h=2),1==h?i.push(r):2==h?s.push(r):o.push(r)}return i.concat(o,s)},e.prototype.onItemList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;if(e)if(1==e.state)GmGlobal.cc.dataCtl.doAction(ServerActionId.GTASK_GET,[e.cfg.uid]);else if(0==e.state&&e.gotoCmd){if(e.m&&!GmGlobal.mc.guideMgr.isModeuleOpen(e.m,!0))return;if(CmdBus.doCmd(CmdType.C_GTASK),e.gotoCmd.npc)TaskGo.getInstance().start(e.gotoCmd.npc,e.gotoCmd.a);else if(1==e.gotoCmd.map){var i=GmGlobal.mc.mapMgr.getLastOpenMap();GmGlobal.cc.sceneCtl.reqWildScne(i)}else e.gotoCmd.cmd==CmdType.O_FULI&&PFConst.IS_NOPAY&&(e.gotoCmd.a=1),CmdBus.doCmd(e.gotoCmd.cmd,e.gotoCmd.a)}}},e.prototype.onLq=function(){var t=GmGlobal.mc.gtaskMgr.getDayCfg(this._tabIndex+1),e=DoubleGetView.instence();e.show(GmGlobal.vmc.uiLayer),e.setData(t.taw.items,t.taw.cost.id,t.taw.cost.num,this.doLq,this)},e.prototype.doLq=function(t){DoubleGetView.close(),GmGlobal.cc.dataCtl.doAction(ServerActionId.GTASK_TGET,[this._tabIndex+1,t>1?1:0])},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.gtaskMgr.redDot,e=1;e<=this.tabNum;e++){var i=t.childs[e];i.bindChangeCB(this.updateTabRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.gtaskMgr.redDot,e=1;e<=this.tabNum;e++){var i=t.childs[e];i.unbindChangeCB(this.updateTabRedDot,this)}},e.prototype.updateTabRedDot=function(){for(var t=GmGlobal.mc.gtaskMgr.redDot,e=0;e<this._openDay;e++){var i=t.childs[e+1],s=this.tableBgCon.getChildAt(e);if(1==i.state){var o=110*(e+1)+10*e-20;RedDotView.addRedDot(s,this.tableTxtCon,"gtask",o,-4)}else RedDotView.removeRedDot(s)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_GTASK)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}},e.prototype.close=function(){this.clearItems(),RedDotView.removeRedDotByGroup("gtask"),this.unbindRedDotCb(),ItemGridCon.release(this._totalAwCon),this._totalAwCon=null,this._tabIndex=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("gtask_bg_jpg")},e}(UIBase);__reflect(GrowupTaskView.prototype,"GrowupTaskView");var GuajiManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_guaji.json",this.initCfg,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.GUAJI,this.redDot)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.getGjRule=function(){return this._cfg.rule},t.prototype.getGjTimes=function(){return this._cfg.gjTime},t}();__reflect(GuajiManager.prototype,"GuajiManager");var GuajiMediator=function(){function t(){CmdBus.adListener(CmdType.O_GUAJI,this.doOpenView,this),CmdBus.adListener(CmdType.C_GUAJI,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUI,this)}return t.prototype.onMainUI=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUI,this);var t=GmGlobal.mc.dataMgr.getJData(JsonID.GJ_UPD).data;t&&Utils.getObjectLength(t)>0&&(t.jc&&Utils.getObjectLength(t.jc)>0||t.ew&&Utils.getObjectLength(t.ew)>0)&&(GmGlobal.mc.gjMgr.redDot.state=1,this.doOpenView())},t.prototype.doOpenView=function(){this._view||(this._view=new GuajiView),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&(this._view.alphaClose(this._view.closeAndDestroy,this._view),this._view=null)},t}();__reflect(GuajiMediator.prototype,"GuajiMediator");var GuajiView=function(t){function e(){return t.call(this,"GuajiSkin")||this
}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bGj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGj,this),EventBus.addListener(EventType.M_JUPD+JsonID.GJ_UPD,this.updateUI,this)},e.prototype.rmEvts=function(){this.bGj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGj,this),EventBus.rmListener(EventType.M_JUPD+JsonID.GJ_UPD,this.updateUI,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.updateUI(),this.scoll.viewport.scrollV=0},e.prototype.updateUI=function(){var t=GmGlobal.mc;this.tRule.text=t.gjMgr.getGjRule();var e=t.dataMgr.getJData(JsonID.GJ_UPD).data,i=e.t||0;this.tTime.text=Utils.formatTime(i,"h:m:s");var s=e;if(i>=10&&s&&Utils.getObjectLength(s)){var o="",n=s.jc;if(Utils.getObjectLength(n)>0){o=TextFormat.setColor("Basic Reward: ",7041918);for(var r in n){var h=t.itemMgr.getItemCfg(Number(r));h&&(o+=h.name+"*"+n[r]+"  ")}}var a=s.ew;if(Utils.getObjectLength(a)){o+="\n\n"+TextFormat.setColor("Bonus Reward: ",7041918);for(var r in a){var h=t.itemMgr.getItemCfg(Number(r));h&&(o+=h.name+"*"+a[r]+"  ")}}this.tAw.textFlow=TextFormat.parser.parse(this.tAw.chackFlowWordWrap(o,this.tAw.width)),Utils.setBtnEnable(this.bGj,!0)}else this.tAw.text="",Utils.setBtnEnable(this.bGj,!1)},e.prototype.onGj=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.GUAJI,[3],this.onGjOk,this)},e.prototype.onGjOk=function(){this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_GUAJI)},e}(UIBase);__reflect(GuajiView.prototype,"GuajiView");var HaloController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.HALO,this.onUpdate,this)}return t.prototype.onUpdate=function(t){EventBus.dispatchEvt(EventType.HALO_UPD)},t}();__reflect(HaloController.prototype,"HaloController");var HaloManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_halo.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.getHaloList=function(){return this._cfg.halos},t.prototype.getSkillCfg=function(t){return this._cfg.skills[t]},t.prototype.getHaloCfg=function(t){return this._cfg[t]},t.prototype.getHalpRes=function(t){for(var e=0;e<this._cfg.halos.length;e++){var i=this._cfg.halos[e];if(i.id==t)return i.res}return null},t.prototype.getRule=function(){return this._cfg.rule},t}();__reflect(HaloManager.prototype,"HaloManager");var HaloMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.HALO,CmdType.O_HALO),CmdBus.adListener(CmdType.O_HALO,this.openView,this),CmdBus.adListener(CmdType.C_HALO,this.closeView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUI,this)}return t.prototype.onMainUI=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUI,this),EventBus.addListener(EventType.M_RLV_UPD,this.checkOpen,this),this.checkOpen()},t.prototype.checkOpen=function(){if(PFConst.IS_NOPAY||!GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.HALO)){var t=GmGlobal.vmc.mMui.getMainUI().getBtnByID(ModelID.HALO);t&&t.parent&&t.parent.removeChild(t)}else GmGlobal.vmc.mMui.getMainUI().addDownBtn(ModelID.HALO)},t.prototype.openView=function(){this._view||(this._view=new HaloView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.closeView=function(){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(HaloMediator.prototype,"HaloMediator",["IMediator"]);var HaloSkillItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.sName.text=this.data.skCfg.name,this.icon.source="resource/ghskill/"+this.data.skCfg.icon+".jpg",this.lv.text="LV."+this.data.lv;var t=this.data.lvCfg[this.data.lv];this.sAtr.text=this.data.skCfg.attr.replace("%x",t.v),TextFormat.setMoneyStr(this.num,GmGlobal.mc.itemMgr.getItemNum(10071),t.c,!0),this.data.lv>=this.data.lvCfg.length-1?(this.costCon.visible=!0,this.bUp.label="Max LV",TextFormat.setMoneyStr(this.num,GmGlobal.mc.itemMgr.getItemNum(10071),0,!0),Utils.setBtnEnable(this.bUp,!1)):(this.bUp.label="LV UP",this.data.isJh?(Utils.setBtnEnable(this.bUp,!0),this.costCon.visible=!0):this.costCon.visible=!1)},e}(eui.ItemRenderer);__reflect(HaloSkillItem.prototype,"HaloSkillItem");var HaloView=function(t){function e(){var e=t.call(this,"HaloViewSkin")||this;return e._idx=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){if(t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",!this._body){this._body=UnitViewCreator.instence().createHeroUIModel(GmGlobal.mc.role.careerId);var e=GmGlobal.mc,i=e.sceneMgr.getTsRes(e.role.careerId,e.tsMgr.bid);this._body.setToushi(i),this.bodyCon.addChild(this._body),this.bodyCon.scaleX=1.4,this.bodyCon.scaleY=1.4}this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HaloSkillItemSkin",this.itemList.itemRenderer=HaloSkillItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),this.bLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bHh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHuanhua,this),EventBus.addListener(EventType.HALO_UPD,this.updateHalo,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),this.bLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bHh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHuanhua,this),EventBus.rmListener(EventType.HALO_UPD,this.updateHalo,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this._lists=GmGlobal.mc.haloMgr.getHaloList(),this._idx=this.getCzIdx(this._lists),this.updateHalo(),this.updateBtnState()},e.prototype.getCzIdx=function(t){var e=GmGlobal.mc.dataMgr.getJData(JsonID.HALO).data,i=0;for(var s in e)if(e[s].s){i=Number(s);break}for(var o=0;o<this._lists.length;o++)if(this._lists[o].id==i)return o;return 0},e.prototype.updateHalo=function(){var t=this._lists[this._idx];this.haloName.text=t.name,this._body.setHalo(t.res),this.t2.text=t.tx,this._haloId=t.id;var e=GmGlobal.mc.dataMgr.getJData(JsonID.HALO).data,i=!1;if(e[t.id]){var s=e[t.id];i=!0,this.btn.visible=!0,this.bHh.visible=!0,this.tUnlock.visible=!1,s.s?(this.btn.label="Unequip",this.btn.skinName="ComBtnSkinB"):(this.btn.label="Equip",this.btn.skinName="ComBtnSkinY"),Utils.setBtnEnable(this.bHh,s.hs?!1:!0)}else this.btn.visible=!1,this.bHh.visible=!1,this.tUnlock.visible=!0,this.tUnlock.text="Unlock the conditions："+t.jh;this.updateSkill(t,i,i?e[t.id].skill:null)},e.prototype.updateSkill=function(t,e,i){var s=0;for(var o in t.skill){var n=Number(o),r={id:n,isJh:e,skCfg:GmGlobal.mc.haloMgr.getSkillCfg(n),lvCfg:t.skill[o],lv:i?i[o]||0:0};this._array.length>s?this._array.replaceItemAt(r,s):this._array.addItem(r),s++}},e.prototype.onLeft=function(){this._idx--,this._idx<0&&(this._idx=0),this.updateHalo(),this.updateBtnState()},e.prototype.onRight=function(){this._idx++,this._idx>=this._lists.length&&(this._idx=this._lists.length-1),this.updateHalo(),this.updateBtnState()},e.prototype.updateBtnState=function(){this.bLeft.visible=0==this._idx?!1:!0,this.bRight.visible=this._idx==this._lists.length-1?!1:!0},e.prototype.onBtn=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.HALO_EQUIP,[this._haloId])},e.prototype.onHuanhua=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.HALO_EQUIP,[this._haloId,1])},e.prototype.onList=function(t){if("btn"==t.target.name){var e=t.target.parent.parent.data.id;GmGlobal.cc.dataCtl.doAction(ServerActionId.HALO_SKUP,[this._haloId,e])}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.haloMgr.getRule())},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HALO)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._body&&(this._body.unuse(),this._body.clear(),this._body=null),RES.destroyRes("gh_bg_jpg")},e}(UIBase);__reflect(HaloView.prototype,"HaloView");var FingerView=function(t){function e(e){var i=t.call(this)||this;return i._fingerScale=1,i._scaleSpeed=-.01,i._fingerOffset=0,i._mSpeed=.01,i._quanScale=1,i._quanScaleSpeed=.08,i._quanAlphaSpeed=-.06,i._quanAlpha=1,i._parent=e,i.touchEnabled=!1,i.touchChildren=!1,i.init(),i}return __extends(e,t),e.prototype.init=function(){this._quanImg=new eui.Image,this._quanImg.source="guide_json.guide_figer_quan",this._quanImg.anchorOffsetX=55,this._quanImg.anchorOffsetY=55,this.addChild(this._quanImg),this._fingerImg=new eui.Image,this._fingerImg.source="guide_json.guide_figer_img",this._fingerImg.anchorOffsetX=10,this._fingerImg.anchorOffsetY=10,this.addChild(this._fingerImg),this._guideRect=new egret.Rectangle},e.prototype.guideTo=function(t,e){void 0===e&&(e=!0),this._fingerScale=1,this._fingerImg.scaleX=1,this._fingerImg.scaleY=1,this._scaleSpeed=.04,this._fingerOffset=0,this._mSpeed=-.7,this._quanImg.scaleX=1,this._quanImg.scaleY=1,this._quanImg.alpha=1,this._quanAlpha=1,this._quanScale=1,this._guideRect=t,this.parent&&e?(this._quanImg.parent&&this.removeChild(this._quanImg),this.removeEventListener(egret.Event.ENTER_FRAME,this.onFrame,this),egret.Tween.get(this).to({x:this._guideRect.x+this._guideRect.width/2,y:this._guideRect.y+this._guideRect.height/2},500).call(this.fingerMoveEnd,this)):(this._parent.addChild(this),this.x=this._guideRect.x+this._guideRect.width/2,this.y=this._guideRect.y+this._guideRect.height/2,this.addEventListener(egret.Event.ENTER_FRAME,this.onFrame,this),this._quanImg.parent||this.addChildAt(this._quanImg,0))},e.prototype.hide=function(){this.parent&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.onFrame,this),this._parent.removeChild(this))},e.prototype.fingerMoveEnd=function(){this.addChildAt(this._quanImg,0),this.addEventListener(egret.Event.ENTER_FRAME,this.onFrame,this)},e.prototype.onFrame=function(){this._fingerScale+=this._scaleSpeed,this._fingerOffset+=this._mSpeed,(this._fingerScale>1.3||this._fingerScale<1)&&(this._scaleSpeed=-this._scaleSpeed,this._mSpeed=-this._mSpeed),this._fingerScale<=1&&(this._quanScale=1,this._quanAlpha=1),this._fingerImg.scaleX=this._fingerScale,this._fingerImg.scaleY=this._fingerScale,this._fingerImg.x=this._fingerOffset,this._fingerImg.y=this._fingerOffset,this._quanScale+=this._quanScaleSpeed,this._quanAlpha+=this._quanAlphaSpeed,this._quanImg.scaleX=this._quanScale,this._quanImg.scaleY=this._quanScale,this._quanImg.alpha=this._quanAlpha},e}(egret.DisplayObjectContainer);__reflect(FingerView.prototype,"FingerView");var GuideController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.GUIDE_TASK,this.onTaskUpdate,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),GmGlobal.mc.guideMgr.hasTask()},t.prototype.onTaskUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.guideMgr.getGuideTask(),s=i.idx;if(i.clear(),i.idx=e.taskid,i.cnt=e.cnt||0,i.state=e.state||0,i.state){var o=GmGlobal.vmc.mGuide;if(o.guideData&&o.guideData.id!=GuideID.EXIT_CT){var n=o.getCurrentStep();(!n||n.id!=GuideTargetId.CLOSE_BTN&&n.id!=GuideTargetId.CLOSE_BTN2)&&o.clearGuide()}}GmGlobal.mc.guideMgr.updateGuideEndList(i.idx),EventBus.dispatchEvt(EventType.GUIDE_TASK_UPD),0==s||GmGlobal.mc.guideMgr.getTaskInfoByIdx(i.idx)||GmGlobal.cc.pfCtl.pfReport(PfReportType.TASK_CMPL)},t}();__reflect(GuideController.prototype,"GuideController");var GuideData=function(){function t(t,e,i){this.setData(t,e,i)}return t.prototype.setData=function(t,e,i){this.id=t,this.step=0,this.triggerPoint=e,this.steps=[];for(var s=0;s<i.length;s+=2)this.steps.push(GuideTarget.create(i[s],i[s+1]))},t.prototype.getGuideTargetById=function(t){for(var e,i=this.step;i<this.steps.length;i++)if(e=this.steps[i],e.id==t)return e;return null},t.prototype.getGuideTarget=function(t){for(var e,i=0;i<this.steps.length;i++)if(e=this.steps[i],e.target==t)return e;return null},t.create=function(e,i,s){var o=t._pool.pop();return o?o.setData(e,i,s):o=new t(e,i,s),o},t.release=function(e){if(e&&-1==t._pool.indexOf(e)&&(e.id=0,e.triggerPoint=null,e.step=0,e.steps)){for(var i=0,s=e.steps;i<s.length;i++){var o=s[i];GuideTarget.release(o)}e.steps=null}},t._pool=[],t}();__reflect(GuideData.prototype,"GuideData");var GuideDialog=function(t){function e(){var e=t.call(this,"GuideDialogSkin")||this;return e._index=0,e._timerId=-1,e}return __extends(e,t),e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0,.01),this.y=GmGlobal.stageHeight,this.alpha=0,egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:GmGlobal.stageHeight-this.height-10,alpha:1},400)},e.prototype.setDialog=function(t,e,i){this._txts=t,this._cb=e,this._thisObj=i,this._index=0,this.showNext()},e.prototype.showNext=function(){if(-1!=this._timerId&&(egret.clearTimeout(this._timerId),this._timerId=-1),this._index>=this._txts.length)return void this.tweenHide();var t=this._txts[this._index];this.tName.text=t.n+":",this.txt.text="       "+t.t,this._index++,this._timerId=egret.setTimeout(this.onTimeout,this,5e3)},e.prototype.onTimeout=function(){this._timerId=-1,this.showNext()},e.prototype.onTouch=function(){this.showNext()},e.prototype.maskClose=function(){this.onTouch()},e.prototype.tweenHide=function(){egret.Tween.get(this).to({y:GmGlobal.stageHeight,alpha:0},400).call(this.onTweenHideEnd,this)},e.prototype.onTweenHideEnd=function(){var t=this._cb,e=this._thisObj;this.close(),t&&t.call(e)},e.prototype.close=function(){-1!=this._timerId&&(egret.clearTimeout(this._timerId),this._timerId=-1),egret.Tween.removeTweens(this),this._txts=null,this._cb=null,this._thisObj=null,t.prototype.close.call(this)},e}(UIBase);__reflect(GuideDialog.prototype,"GuideDialog");var GuideTargetId;!function(t){t[t.MAINUI_GUIDE_TASK=0]="MAINUI_GUIDE_TASK",t[t.MAINUI_TBTN=1]="MAINUI_TBTN",t[t.MAINUI_HCBTN=2]="MAINUI_HCBTN",t[t.MAP_SEL=3]="MAP_SEL",t[t.MAINUI_ICON=4]="MAINUI_ICON",t[t.HOER_EQUIP_R=5]="HOER_EQUIP_R",t[t.HOER_EQUIP_R2=6]="HOER_EQUIP_R2",t[t.HOER_EQUIP_R3=7]="HOER_EQUIP_R3",t[t.REPLACE_RBTN=8]="REPLACE_RBTN",t[t.SKILL_ADD=9]="SKILL_ADD",t[t.SKILL_EQUIP=10]="SKILL_EQUIP",t[t.SKILL_SEL=11]="SKILL_SEL",t[t.SEL_ITEM=12]="SEL_ITEM",t[t.BAG_HC_BTN=13]="BAG_HC_BTN",t[t.BAG_FJ_BTN=14]="BAG_FJ_BTN",t[t.HC_HC_BTN=15]="HC_HC_BTN",t[t.TIP_FJ=16]="TIP_FJ",t[t.MOVE_TO=17]="MOVE_TO",t[t.EQUIP_QH=18]="EQUIP_QH",t[t.KPL_BTN=19]="KPL_BTN",t[t.SHOP_ADD=20]="SHOP_ADD",t[t.SHOP_BUY=21]="SHOP_BUY",t[t.HC_SEL1=22]="HC_SEL1",t[t.HC_SEL2=23]="HC_SEL2",t[t.HC_SEL3=24]="HC_SEL3",t[t.FJ_FJ_BTN=25]="FJ_FJ_BTN",t[t.TAB_SEL=26]="TAB_SEL",t[t.GRID_SEL=27]="GRID_SEL",t[t.JL_BTN=28]="JL_BTN",t[t.PET_ZB_BTN=29]="PET_ZB_BTN",t[t.ND_DC=30]="ND_DC",t[t.MVP_TZ_BTN=31]="MVP_TZ_BTN",t[t.TIAOZHAN=32]="TIAOZHAN",t[t.SJ_BTN=33]="SJ_BTN",t[t.DZ_BTN=34]="DZ_BTN",t[t.ATTR_ADD_BTN=35]="ATTR_ADD_BTN",t[t.CLOSE_BTN=36]="CLOSE_BTN",t[t.CLOSE_BTN2=37]="CLOSE_BTN2"}(GuideTargetId||(GuideTargetId={}));var GuideID=function(){function t(){}return t.KILL_MONSTER=1,t.EQUIPE_DRESS=2,t.SKILL_DRESS=3,t.EQUIPE_STRONG=4,t.EQUIPE_JL=5,t.EQUIPE_DZ=6,t.CARD_XQ=7,t.EQUIP_FENJIE=8,t.EQUIP_HC=9,t.PET_ZB=10,t.XZ_SJ=11,t.KQL_GM=12,t.TOUSHI_ZZ=13,t.JIAOYI=14,t.NIUDIANJI=16,t.LEVEL=17,t.ARENA=18,t.TOWER=19,t.MVP=20,t.JOIN_GH=21,t.KILL_MONSTER2=22,t.SKILL_LEARN=23,t.ATTR_ADD=24,t.ARENA2=25,t.GTASK=28,t.OPEN_VIP=29,t.OPEN_VIP1=30,t.EXIT_CT=100,t}();__reflect(GuideID.prototype,"GuideID");var GuideManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_guidance_config.json",this.initGuideTaskConfig,this)}return t.prototype.initGuideTaskConfig=function(t){this._guideTasks=t.guideTask,this._guideList=t.guidelist,this._moduleOpenLvs=t.modelOpen,this.newPlayerTip=t.newplayer},t.prototype.getGuideTask=function(){return this._guideTask||(this._guideTask=new GuideTaskStruct),this._guideTask},t.prototype.hasTask=function(){return this._guideTask&&this._guideTask.idx>0&&this._guideList[this._guideTask.idx]?!0:!1},t.prototype.isSimpleGuide=function(){return this._guideTask&&this._guideTask.idx>=25?!0:!1},t.prototype.canShowNotice=function(){if(this._guideTask){var t=GmGlobal.mc.guideMgr.getTaskListInfo(this._guideTask.idx);if(t&&t.id!=GuideID.LEVEL)return!1}return!0},t.prototype.getTaskList=function(){return this._guideTasks},t.prototype.getTaskInfo=function(t){for(var e=0,i=this._guideTasks;e<i.length;e++){var s=i[e];if(s.taskId==t)return s}return null},t.prototype.getTaskInfoByIdx=function(t){var e=this._guideList[t];return e?this.getTaskInfo(e.id):null},t.prototype.getTaskListInfo=function(t){return this._guideList[t]},t.prototype.getTaskListLen=function(){return Utils.getObjectLength(this._guideList)},t.prototype.getModuleOpenInfo=function(t){return this._moduleOpenLvs[t]},t.prototype.getModuleOpenLV=function(t){var e=this.getModuleOpenInfo(t);return e?e.openlv:0},t.prototype.isModeuleOpen=function(t,e){void 0===e&&(e=!1),!GmGlobal.IS_DEBUG;var i=this.getModuleOpenInfo(t);return i?this._guideTask?i.openTask<this._guideTask.idx?this.checkOpenLv(i,e):(e&&MsgBox.prompt("Complete Novice Quest "+i.openTask+" to unlock"),!1):this.checkOpenLv(i,e):!0},t.prototype.checkOpenLv=function(t,e){void 0===e&&(e=!1);var i=GmGlobal.mc.role.lv;return t.openlv<=i?!0:(e&&MsgBox.prompt("Unlocks at LV."+t.openlv),!1)},t.prototype.updateGuideEndList=function(t){this.guideEndIds=[];for(var e in this._guideList){var i=Number(e);if(t>i){var s=this._guideList[e];-1==this.guideEndIds.indexOf(s.id)&&this.guideEndIds.push(s.id)}}},t.prototype.getPreFightMap=function(t){for(var e=t;e>0;e--){var i=this._guideList[e];if(i&&22==i.id)return i.mapid}return-1},t.prototype.getNpcId=function(t){switch(t){case GuideID.EQUIPE_STRONG:case GuideID.EQUIPE_JL:case GuideID.EQUIPE_DZ:return 6701;case GuideID.KQL_GM:return 6704;case GuideID.TOUSHI_ZZ:return 6702;case GuideID.JIAOYI:return 6703;case GuideID.JOIN_GH:return 6705;default:return-1}},t}();__reflect(GuideManager.prototype,"GuideManager");var GuideMask=function(t){function e(){var e=t.call(this)||this,i=new eui.Rect(GmGlobal.stageWidth,GmGlobal.stageHeight,0);return i.alpha=.01,i.width=GmGlobal.stageWidth,i.height=GmGlobal.stageHeight,e.addChild(i),e}return __extends(e,t),e.prototype.updateRect=function(t){this._guideRect=t},e.prototype.$hitTest=function(t,e){var i=this.parent.globalToLocal(t,e);return this._guideRect.contains(i.x,i.y)?null:this},e}(egret.DisplayObjectContainer);__reflect(GuideMask.prototype,"GuideMask");var GuideMediator=function(){function t(){this._checkTimer=0,this._maskCNum=3,this._mCenter=GmGlobal.mc,this._noticeLayer=GmGlobal.vmc.uiLayer2}return t.prototype.triggerGuide=function(t,e,i,s){this.guideData&&this.guideData.id!=t&&this.clearGuide(),this.guideData=this.getGuideData(t,e,i,s),this.guideData&&(EventBus.dispatchEvt(EventType.TRIGGER_GUIDE,t),this._guideRect||(this._guideRect=new egret.Rectangle),this.checkNextTarget())},t.prototype.hasGuide=function(t){return this.guideData&&this.guideData.id==t?!0:!1},t.prototype.getGuideTarget=function(){if(this.guideData){var t=this.guideData.steps[this.guideData.step];return t.target}return null},t.prototype.clearGuide=function(){this.clearFinger(),GuideData.release(this.guideData),this.guideData=null,EventBus.dispatchEvt(EventType.GUIDE_FINISH)},t.prototype.setIdxToTop=function(){this._mask&&this._mask.parent&&this._noticeLayer.addChild(this._mask),this._fingerView&&this._fingerView.parent&&this._noticeLayer.addChild(this._fingerView)},t.prototype.clearFinger=function(){0!=this._checkTimer&&(egret.clearInterval(this._checkTimer),this._checkTimer=0),this._fingerView&&this._fingerView.hide(),this.hideMask()},t.prototype.onClickMask=function(t){this._maskCNum<=0?this.clearGuide():this._maskCNum--},t.prototype.showMask=function(){this._mask||(this._mask=new GuideMask,this._mask.touchEnabled=!0,this._mask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickMask,this)),this._mask.updateRect(this._guideRect),this._mask.parent||this._noticeLayer.addChild(this._mask),this._maskCNum=3},t.prototype.hideMask=function(){this._mask&&this._mask.parent&&this._noticeLayer.removeChild(this._mask)},t.prototype.checkNextTarget=function(){if(this.guideData){var t=this.guideData.step;if(this.guideData.step>=this.guideData.steps.length){var e=GmGlobal.mc.guideMgr.getTaskInfo(this.guideData.id);return e&&1==e.isTouch&&GmGlobal.cc.dataCtl.doAction(ServerActionId.GUIDE_CP),void this.clearGuide()}var i=this.guideData.steps[t];if(i.id==GuideTargetId.MOVE_TO)return void this.clearFinger();if(i.guideNum<1&&(this.skipStep(),this.checkNextTarget()),i.target||i.targetRect)0!=this._checkTimer&&(egret.clearInterval(this._checkTimer),this._checkTimer=0),this._fingerView||(this._fingerView=new FingerView(this._noticeLayer)),0==t&&this.guideData.triggerPoint&&(this._fingerView.x=this.guideData.triggerPoint.x,this._fingerView.y=this.guideData.triggerPoint.y),i.target?(this._guideRect.x=i.pos.x-i.target.anchorOffsetX*i.target.scaleX,this._guideRect.y=i.pos.y-i.target.anchorOffsetY*i.target.scaleY,this._guideRect.width=i.target.width*i.target.scaleX,this._guideRect.height=i.target.height*i.target.scaleY):(this._guideRect.x=i.targetRect.x,this._guideRect.y=i.targetRect.y,this._guideRect.width=i.targetRect.width,this._guideRect.height=i.targetRect.height),this.showMask(),0==t&&this.guideData.triggerPoint&&this._noticeLayer.addChild(this._fingerView),this._fingerView.guideTo(this._guideRect);else{if(i.isSkip)return this.guideData.step++,void this.checkNextTarget();i.showFinger?0==this._checkTimer&&(this._checkTimer=egret.setInterval(this.checkNextTarget,this,100)):(this._mask&&this._mask.parent&&this._noticeLayer.removeChild(this._mask),this._fingerView&&this._fingerView.hide())}}},t.prototype.getGuideData=function(t,e,i,s){var o=null;if(t==GuideID.KILL_MONSTER)o=GuideData.create(t,e,[GuideTargetId.MAINUI_TBTN,1,GuideTargetId.MAP_SEL,1]);else if(t==GuideID.KILL_MONSTER2)o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MAINUI_TBTN,1,GuideTargetId.MAP_SEL,1,GuideTargetId.MOVE_TO,1]);else if(t==GuideID.EQUIPE_DRESS){var n=null;n=1==s?[GuideTargetId.MAINUI_ICON,1,GuideTargetId.HOER_EQUIP_R,1,GuideTargetId.SEL_ITEM,1,GuideTargetId.REPLACE_RBTN,1,GuideTargetId.CLOSE_BTN,1]:10>s?[GuideTargetId.MAINUI_ICON,1,GuideTargetId.HOER_EQUIP_R,1,GuideTargetId.SEL_ITEM,1,GuideTargetId.REPLACE_RBTN,1,GuideTargetId.HOER_EQUIP_R2,1,GuideTargetId.SEL_ITEM,1,GuideTargetId.REPLACE_RBTN,1,GuideTargetId.HOER_EQUIP_R3,1,GuideTargetId.SEL_ITEM,1,GuideTargetId.REPLACE_RBTN,1,GuideTargetId.CLOSE_BTN,1]:[GuideTargetId.MAINUI_ICON,1],o=GuideData.create(t,e,n)}else t==GuideID.SKILL_DRESS?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.SKILL_SEL,1,GuideTargetId.SKILL_ADD,3,GuideTargetId.SKILL_EQUIP,1,GuideTargetId.CLOSE_BTN,1]):t==GuideID.SKILL_LEARN?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.SKILL_ADD,1]):t==GuideID.EQUIP_FENJIE?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.BAG_FJ_BTN,1,GuideTargetId.FJ_FJ_BTN,1,GuideTargetId.CLOSE_BTN2,1,GuideTargetId.CLOSE_BTN,1]):t==GuideID.EQUIPE_STRONG?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MOVE_TO,1,GuideTargetId.EQUIP_QH,i,GuideTargetId.CLOSE_BTN,1]):t==GuideID.KQL_GM?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MOVE_TO,1,GuideTargetId.KPL_BTN,1,GuideTargetId.SHOP_ADD,i-1,GuideTargetId.SHOP_BUY,1,GuideTargetId.CLOSE_BTN2,1,GuideTargetId.CLOSE_BTN,1]):t==GuideID.EQUIP_HC?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.BAG_HC_BTN,1,GuideTargetId.HC_SEL1,1,GuideTargetId.HC_SEL2,1,GuideTargetId.HC_SEL3,1,GuideTargetId.HC_HC_BTN,1,GuideTargetId.CLOSE_BTN2,1,GuideTargetId.CLOSE_BTN,1]):t==GuideID.CARD_XQ?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.TAB_SEL,1,GuideTargetId.GRID_SEL,1,GuideTargetId.SEL_ITEM,1,GuideTargetId.CLOSE_BTN2,1,GuideTargetId.CLOSE_BTN,1]):t==GuideID.EQUIPE_JL?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MOVE_TO,1,GuideTargetId.TAB_SEL,1,GuideTargetId.JL_BTN,i,GuideTargetId.CLOSE_BTN,1]):t==GuideID.PET_ZB?o=GuideData.create(t,e,[GuideTargetId.MAINUI_TBTN,1,GuideTargetId.MAP_SEL,1,GuideTargetId.PET_ZB_BTN,1]):t==GuideID.NIUDIANJI?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.TAB_SEL,1,GuideTargetId.ND_DC,1]):t==GuideID.MVP?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.MVP_TZ_BTN,1]):t==GuideID.ARENA?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.TAB_SEL,1,GuideTargetId.TIAOZHAN,1]):t==GuideID.ARENA2?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.TAB_SEL,1]):t==GuideID.TOWER?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.TAB_SEL,1,GuideTargetId.TIAOZHAN,1,GuideTargetId.MAINUI_HCBTN,1]):t==GuideID.EXIT_CT?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1]):t==GuideID.XZ_SJ?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.SJ_BTN,i]):t==GuideID.TOUSHI_ZZ||t==GuideID.JIAOYI?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MOVE_TO,1]):t==GuideID.JOIN_GH?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MOVE_TO,1]):t==GuideID.EQUIPE_DZ?o=GuideData.create(t,e,[GuideTargetId.MAINUI_HCBTN,1,GuideTargetId.MOVE_TO,1,GuideTargetId.TAB_SEL,1,GuideTargetId.DZ_BTN,i,GuideTargetId.CLOSE_BTN,1]):t==GuideID.ATTR_ADD?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1,GuideTargetId.ATTR_ADD_BTN,i,GuideTargetId.CLOSE_BTN,1]):t==GuideID.GTASK?o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1]):(t==GuideID.OPEN_VIP||t==GuideID.OPEN_VIP1)&&(o=GuideData.create(t,e,[GuideTargetId.MAINUI_ICON,1]));return o},t.prototype.bindTarget=function(t,e,i){if(this.guideData){var s=this.guideData.getGuideTargetById(t);s&&(s.target=e,s.pos=i)}},t.prototype.bindTargetRect=function(t,e,i){if(this.guideData){var s=this.guideData.getGuideTargetById(t);s&&(s.targetRect=e,s.pos=i)}},t.prototype.triggerTarget=function(t){if(this.guideData){var e=this.guideData.steps[this.guideData.step];e&&e.target==t&&this.onTriggerTarget(e)}},t.prototype.triggerTargetByID=function(t){if(this.guideData){var e=this.guideData.steps[this.guideData.step];e&&e.id==t&&this.onTriggerTarget(e)}},t.prototype.getCurrentStep=function(){if(this.guideData){var t=this.guideData.steps[this.guideData.step];return t}},t.prototype.getGuideTargetByIndex=function(t){return this.guideData?this.guideData.steps[t]:null},t.prototype.skipStep=function(){this.guideData&&this.guideData.step++},t.prototype.onTriggerTarget=function(t){t.guideNum--,this.guideData.id==GuideID.ATTR_ADD&&t.id==GuideTargetId.ATTR_ADD_BTN&&(t.guideNum=0),t.guideNum<=0&&(this.guideData.step++,this.checkNextTarget())},t}();__reflect(GuideMediator.prototype,"GuideMediator");var GuideTarget=function(){function t(t,e){void 0===e&&(e=1),this.id=t,this.guideNum=e,this.showFinger=!0,this.isSkip=!1}return t.create=function(e,i){void 0===i&&(i=1);var s=t._pool.pop();return s?(s.id=e,s.guideNum=i):s=new t(e,i),s},t.release=function(e){-1==t._pool.indexOf(e)&&(e.id=0,e.target=null,e.targetRect=null,e.pos=null,e.guideNum=0,e.showFinger=!0,e.isSkip=!1,t._pool.push(e))},t._pool=[],t}();__reflect(GuideTarget.prototype,"GuideTarget");var GuideTaskStruct=function(){function t(){this.idx=0,this.cnt=0,this.state=0}return t.prototype.clear=function(){this.state=0},t}();__reflect(GuideTaskStruct.prototype,"GuideTaskStruct");var HaoliController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_HAOLI,this.onUpdInfo,this)}return t.prototype.onUpdInfo=function(t){var e=t.data.data,i=GmGlobal.mc.haoliMgr;i.infos=e||{},EventBus.dispatchEvt(EventType.M_HAOLI)},t}();__reflect(HaoliController.prototype,"HaoliController");var HaoliManager=function(){function t(){this.infos={},GmGlobal.mc.regUnzipCfg("c_haoli.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this.cfgs=t},t.prototype.isOver=function(){var t=!0;for(var e in this.infos){var i=this.infos[e];if(GmGlobal.getServerTime()<=i.et){t=!1;break}}return t},t}();__reflect(HaoliManager.prototype,"HaoliManager");var HaoliMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.HAOLI,CmdType.O_HAOLI),CmdBus.adListener(CmdType.O_HAOLI,this.onOpenView,this),CmdBus.adListener(CmdType.C_HAOLI,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_HAOLI,this.onUpdate,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.onUpdate=function(t){GmGlobal.mc.muiMgr.isInited&&this.updateIcon()},t.prototype.updateIcon=function(){PFConst.IS_NOPAY||GmGlobal.mc.haoliMgr.isOver()&&CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.HAOLI,2)},t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),PFConst.IS_NOPAY||(this._idx=t,this._cmd=e,this.doOpenView())},t.prototype.doOpenView=function(){this._view||(this._view=new HaoliView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.setTab(this._idx,this._cmd)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(HaoliMediator.prototype,"HaoliMediator",["IMediator"]);var HaoliView=function(t){function e(){var e=t.call(this,"HaoliSkin")||this;return e._cmd=0,e._tabIdx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.addListener(EventType.M_HAOLI,this.updUi,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.rmListener(EventType.M_HAOLI,this.updUi,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow()},e.prototype.setTab=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.selTab(t),this._cmd=e},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIdx)return;
GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIdx){if(-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIdx=t,this.bg.source="haoli0"+(t+1)+"_jpg",this.updUi()}},e.prototype.updUi=function(){var t=this._mc.haoliMgr.cfgs[this._tabIdx],e=this._mc.haoliMgr.infos[t.id];this.okBtn.setPrice(t.oprice,t.price);var i=t.items;if(0==this._tabIdx){var s=this._mc.role.careerId,o=this._mc.heroMgr.getHeroCfg(s),n=o.career,r=t.cItem[n-1];i=[],i.push(r),i=i.concat(t.items)}this._itemGridCon&&this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(i,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER;var h=GmGlobal.getServerTime();h<e.st?(this.timeTxt.text="Event unavailable",Utils.setBtnEnable(this.okBtn,!1),CDText.getInstence().rmCD(this.timeTxt)):h>=e.et?(this.timeTxt.text="Event ended",Utils.setBtnEnable(this.okBtn,!1),CDText.getInstence().rmCD(this.timeTxt)):(CDText.getInstence().addCD(this.timeTxt,e.et-h,"Event Countdown：","DD h:m:s","",this.updUi,this),e.cnt?Utils.setBtnEnable(this.okBtn,!0):(Utils.setBtnEnable(this.okBtn,!1),this.okBtn.setLabel("Purchased"))),this.timeBg.width=this.timeTxt.width+40},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onOkBtn=function(){var t=this._mc.haoliMgr.cfgs[this._tabIdx];GmGlobal.cc.pfCtl.Pay(100*t.price,7)},e.prototype.onClose=function(){if(this._cmd){var t=0;this._cmd==RankID.CHUANBAO&&(t=6),CmdBus.doCmd(CmdType.O_7DAY,0,t)}CmdBus.doCmd(CmdType.C_HAOLI)},e.prototype.close=function(){if(-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}this._tabIdx=-1,this.clearItems(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("haoli01_jpg"),RES.destroyRes("haoli02_jpg"),RES.destroyRes("haoli03_jpg"),RES.destroyRes("haoli04_jpg")},e}(UIBase);__reflect(HaoliView.prototype,"HaoliView");var CardWearView=function(t){function e(){var e=t.call(this,"CardWearViewSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.eqpCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onXiez,this),EventBus.addListener(EventType.M_UPD_CON,this.updList,this),EventBus.addListener(EventType.M_EQUIP_UPD,this.updItems,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.eqpCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onXiez,this),EventBus.rmListener(EventType.M_UPD_CON,this.updList,this),EventBus.rmListener(EventType.M_EQUIP_UPD,this.updItems,this)},e.prototype.setIdx=function(t){this._eid=t+1,this._mc.equipMgr.clickIdx=t,this.tTit.text="Card",this._idx=5,this.scroll.viewport.scrollV=0,this.updList(),this.updItems();var e=this;setTimeout(function(){e.checkGuide()},100)},e.prototype.updItems=function(){var t=this._mc.equipMgr.getEqp(this._eid-1),e=this._mc.equipMgr.getEItem(t.uid),i={};e&&e.cardlst&&(i=e.cardlst);var s=GmConst.EQP_NAME[this._eid-1];this.tname.text=s;var o=GmGlobal.mc.equipMgr.getEqpCfg(t.itemId);if(this._cid=-1,o)for(var n=0;4>n;n++){var r=this["item"+n];r.numTxt.visible=!1;var h=o.slot||0;if(h>n)if(r.icon.visible=!0,i&&i[n+1]){var a=i[n+1];r.setItem(new Item(a,0))}else r.setItem(null),r.icon.source="hero_json.hero_jia",r.iconK.source="item_json.item_com0",r.star.visible=!1,this._cid<0&&(this._cid=n+1);else r.setItem(null),r.icon.visible=!1,r.iconK.source="item_json.item_com1",r.star.visible=!1}else for(var n=0;4>n;n++){var r=this["item"+n];r.setItem(null),r.numTxt.visible=!1,r.icon.visible=!1,r.iconK.source="item_json.item_com1",r.star.visible=!1}-1==this._cid&&this._itemGridCon.setTouchCb(!0)},e.prototype.updList=function(){var t=this._mc.equipMgr.getCardListByEid(this._idx,this._eid);this.clearGrids(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,115,!1,!1,!0),this._itemGridCon.addToParent(10,10,this.itemCon,null,this.scroll.width),this._itemGridCon.setTouchCb(!1,this.onTouchItem,this)},e.prototype.clearGrids=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onXiez=function(t){if(t.target.parent==this.eqpCon){var e=this._mc.equipMgr.getEqp(this._eid-1),i=this.eqpCon.getChildIndex(t.target),s=i+1,o=GmGlobal.mc.equipMgr.getEqpCfg(e.itemId),n=o.slot||0;if(s>n)return;if(e&&e.uid){var r=this._mc.equipMgr.getEItem(e.uid);r&&!Utils.isEmptyObj(r.cardlst)&&r.cardlst[s]?GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP_CARD,[this._eid,s,0]):MsgBox.prompt("Card slot empty")}}},e.prototype.onOk=function(){this.onClose()},e.prototype.onTouchItem=function(t){if(-1==this._cid)return MsgBox.prompt("Card slot full"),void this._itemGridCon.setTouchCb(!0);GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP_CARD,[this._eid,this._cid,t.itemId]),this._cid=-1;var e=GmGlobal.vmc.mGuide;e.guideData&&e.guideData.id==GuideID.CARD_XQ&&e.triggerTargetByID(GuideTargetId.SEL_ITEM)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.CARD_XQ)if(0==this._itemGridCon.grids.length)t.clearGuide();else{var e=this.itemCon.localToGlobal(58,58);t.bindTargetRect(GuideTargetId.SEL_ITEM,new egret.Rectangle(e.x-58,e.y-58,115,115),e),t.bindTarget(GuideTargetId.CLOSE_BTN2,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_HERO_CARD)},e.prototype.close=function(){this.clearGrids(),t.prototype.close.call(this)},e}(UIBase);__reflect(CardWearView.prototype,"CardWearView");var EquipWearlView=function(t){function e(){var e=t.call(this,"EquipWearlViewSkin")||this;return e._eLst=[],e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.xiez.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onXiez,this),EventBus.addListener(EventType.M_UPD_CON,this.updList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.xiez.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onXiez,this),EventBus.rmListener(EventType.M_UPD_CON,this.updList,this)},e.prototype.setIdx=function(t,e,i){void 0===i&&(i=0),this._eid=e+1,this._cid=i,this._mc.equipMgr.clickIdx=e,this._mc.equipMgr.clickCid=i,t?(this.tTit.text="Card",this._idx=5):(this.tTit.text="Gear",this._idx=4),this.scroll.viewport.scrollV=0,this.updList(),this.xiez.visible=0==t?!1:!0;var s=this;setTimeout(function(){s.checkGuide()},100)},e.prototype.updList=function(){var t=[];if(t=4==this._idx?this._mc.equipMgr.getEqpListByEid(this._idx,this._eid):this._mc.equipMgr.getCardListByEid(this._idx,this._eid),this._eLst=t,this.clearGrids(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.modelId=-1,this._itemGridCon.initGridsByItems(t,115,!1,!1,!0),this._itemGridCon.addToParent(5,5,this.itemCon,null,this.scroll.width),this._itemGridCon.setTouchCb(!0,this.onTouchItem,this),4==this._idx){for(var e=[],i=0;i<t.length;i++){var s=t[i],o=GmGlobal.mc.equipMgr.getJlLv(s.id);e.push(o)}this._itemGridCon.setItems(t,!1,"",e)}},e.prototype.clearGrids=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onEqp=function(t){},e.prototype.onXiez=function(){var t=this._mc.equipMgr.getEqp(this._eid-1);if(4==this._idx)t&&t.uid?GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP,[this._eid,0]):MsgBox.prompt("Gear not equipped！");else if(t&&t.uid){var e=this._mc.equipMgr.getEItem(t.uid);e&&!Utils.isEmptyObj(e.cardlst)&&e.cardlst[this._cid]?GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP_CARD,[this._eid,this._cid,0],this.onOk,this):MsgBox.prompt("Card slot empty！")}else MsgBox.prompt("Card slot empty！")},e.prototype.onOk=function(){this.onClose()},e.prototype.onTouchItem=function(t){var e=GmGlobal.vmc.mGuide;e.guideData&&e.guideData.id==GuideID.EQUIPE_DRESS&&e.triggerTargetByID(GuideTargetId.SEL_ITEM)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.EQUIPE_DRESS)if(0==this._itemGridCon.grids.length)t.clearGuide();else{var e=this.itemCon.localToGlobal(58,58);t.bindTargetRect(GuideTargetId.SEL_ITEM,new egret.Rectangle(e.x-58,e.y-58,115,115),e)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HERO_EQP)},e.prototype.close=function(){this.clearGrids(),this._eLst=[],this.btnCon.removeChildren(),t.prototype.close.call(this)},e}(UIBase);__reflect(EquipWearlView.prototype,"EquipWearlView");var EquipWearlView1=function(t){function e(){var e=t.call(this,"EquipWearlViewSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.xiez.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onXiez,this),EventBus.addListener(EventType.M_UPD_CON,this.updList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.xiez.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onXiez,this),EventBus.rmListener(EventType.M_UPD_CON,this.updList,this)},e.prototype.setIdx=function(t,e,i){void 0===i&&(i=0),this._eid=e+1,this._cid=i,t?(this.tTit.text="Card",this._idx=5):(this.tTit.text="Gear",this._idx=4),this.updList()},e.prototype.updList=function(){var t=[];if(t=4==this._idx?this._mc.equipMgr.getEqpListByEid(this._idx,this._eid):this._mc.equipMgr.getCardListByEid(this._idx,this._eid),this._conAry=[],this._itemConAry=[],t.length<=4)this._conAry=t,this._itemCon?this._itemCon.grids.length!=t.length&&this._itemCon.resetGridNum(t.length):(this._itemCon=ItemGridCon.create(),this._itemCon.initGridsByNum(t.length,115,!1,!1,!0),this._itemCon.addToParent(5,5,this.con,null,this.scroll.width),this._itemCon.setTouchCb(!1,this.onEqp,this)),this._itemGridCon&&this._itemGridCon.grids.length>0&&this._itemGridCon.resetGridNum(0),this._itemCon.setItems(t);else{for(var e=0;e<t.length;e++)4>e?this._conAry.push(t[e]):this._itemConAry.push(t[e]);this._itemCon?4!=this._itemCon.grids.length&&this._itemCon.resetGridNum(4):(this._itemCon=ItemGridCon.create(),this._itemCon.initGridsByNum(4,115,!1,!1,!0),this._itemCon.addToParent(5,5,this.con,null,this.scroll.width),this._itemCon.setTouchCb(!1,this.onEqp,this)),this._itemCon.setItems(this._conAry),this._itemGridCon?this._itemGridCon.grids.length!=this._itemConAry.length&&this._itemGridCon.resetGridNum(this._itemConAry.length):(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(t.length-4,115,!1,!1,!0),this._itemGridCon.addToParent(5,5,this.itemCon,null,this.scroll.width),this._itemGridCon.setTouchCb(!1,this.onEqp,this)),this._itemGridCon.setItems(this._itemConAry)}},e.prototype.onEqp=function(t){4==this._idx?GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP,[this._eid,t.uid],this.onClose,this):GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP_CARD,[this._eid,this._cid,t.itemId],this.onOk,this)},e.prototype.onXiez=function(){var t=this._mc.equipMgr.getEqp(this._eid-1);if(4==this._idx)t&&t.uid?GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP,[this._eid,0]):MsgBox.prompt("Gear not equipped！");else if(t&&t.uid){var e=this._mc.equipMgr.getEItem(t.uid);e&&!Utils.isEmptyObj(e.cardlst)?GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP_CARD,[this._eid,this._cid,0],this.onOk,this):MsgBox.prompt("Card slot empty！")}else MsgBox.prompt("Card slot empty！")},e.prototype.onOk=function(){this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HERO_EQP)},e.prototype.close=function(){this._conAry=[],this._itemConAry=[],t.prototype.close.call(this)},e}(UIBase);__reflect(EquipWearlView1.prototype,"EquipWearlView1");var HeroAtrTipItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.index=this.data.index,this.tTit.text=this.data.tit,this.tDes.text=this.data.des,this.bg.width=this.tTit.width+25,this.tDes.x=this.tTit.x+this.tTit.width+25,this.tDes.width=this.width-this.tDes.x-4},e}(eui.ItemRenderer);__reflect(HeroAtrTipItem.prototype,"HeroAtrTipItem");var HeroAtrTipView=function(t){function e(){var e=t.call(this,"HeroAtrTipSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HeroAtrTipItemSkin",this.itemList.itemRenderer=HeroAtrTipItem;var e=this._mc.heroMgr.getAtrs(),i=0;for(var s in e){var o=e[s],n={des:o.des,tit:o.name,index:i+1};this._array.addItem(n),i++}},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HERO_TIP)},e}(UIBase);__reflect(HeroAtrTipView.prototype,"HeroAtrTipView");var HeroCardItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.info,e=GmConst.EQP_NAME[this.index-1];this.tTit.text=e;var i=GmGlobal.mc.equipMgr.getEqpCfg(this.data.itemid);if(i)for(var s=0;4>s;s++){var o=this["item"+s];o.numTxt.visible=!1;var n=i.slot||0;if(n>s)if(o.icon.visible=!0,t&&t[s+1]){var r=t[s+1];o.setItem(new Item(r,0))}else o.setItem(null),o.icon.source="hero_json.hero_jia",o.iconK.source="item_json.item_com0",o.star.visible=!1;else o.setItem(null),o.icon.visible=!1,o.iconK.source="item_json.item_com1",o.star.visible=!1}else for(var s=0;4>s;s++){var o=this["item"+s];o.setItem(null),o.numTxt.visible=!1,o.icon.visible=!1,o.iconK.source="item_json.item_com1",o.star.visible=!1}},e.prototype.getFirstItem=function(){return this.item0},e}(eui.ItemRenderer);__reflect(HeroCardItem.prototype,"HeroCardItem");var HeroController=function(){function t(){this._preZl=0,EventBus.addListener(EventType.M_JUPD+JsonID.U_HERO,this.onUpdInfo,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EQUIPS_YZ,this.onUpdYzEqps,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_EQUIP_YZ,this.onUpdYzEqp,this),EventBus.addListener(EventType.M_JUPD+JsonID.MOSHI,this.onUpdMsEquips,this),EventBus.addListener(EventType.M_JUPD+JsonID.MOSHI_ONE,this.onUpdMsOne,this)}return t.prototype.updateRadDot=function(){var t=GmGlobal.mc.heroMgr;t.redDot.state=t.anum>0?1:0},t.prototype.onUpdInfo=function(t){var e=t.data.data,i=GmGlobal.mc.heroMgr;i.anum=e.anum||0,i.atrs=[],i.alst=[];for(var s=0;6>s;s++){var o=i.getAtrByid(s+1),n=e[o]||0,r=e.alst[s+1];i.atrs.push(n),i.alst.push(r)}i.bAtrs=[];for(var s=0;10>s;s++){var o=i.getAtrByid(s+7),n=e[o]||0;i.bAtrs.push(n)}i.updData(e),EventBus.dispatchEvt(EventType.M_HERO_UPD),e.z!=this._preZl&&(EventBus.dispatchEvt(EventType.M_R_Z_UPD,this._preZl),this._preZl=e.z),this.updateRadDot()},t.prototype.onUpdYzEqps=function(t){var e=t.data.data,i=GmGlobal.mc.heroMgr;i.yzItems={};for(var s in e){var o=e[s];i.yzItems[o.equipId]=o}EventBus.dispatchEvt(EventType.M_EQUIP_YZ_UPD)},t.prototype.onUpdYzEqp=function(t){var e=t.data.data,i=GmGlobal.mc.heroMgr;i.yzItems[e.equipId]=e,EventBus.dispatchEvt(EventType.M_EQUIP_YZ_UPD,e.equipId-1)},t.prototype.onUpdMsEquips=function(t){var e=t.data.data,i=GmGlobal.mc.heroMgr;i.msItems={};for(var s in e){var o=e[s];i.msItems[o.equipId]=o}EventBus.dispatchEvt(EventType.M_EQUIP_MS_UPD)},t.prototype.onUpdMsOne=function(t){var e=t.data.data,i=GmGlobal.mc.heroMgr;i.msItems||(i.msItems={}),i.msItems[e.equipId]=e,EventBus.dispatchEvt(EventType.M_EQUIP_MS_UPD,e.equipId)},t}();__reflect(HeroController.prototype,"HeroController");var HeroDuanzItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.info,e=GmConst.EQP_COLOR[this.index-1],i=GmConst.EQP_NAME[e-1];this.tTit.text=i,this.index<=4?this.bgTit.source="com_json.bg_eqp2":this.index>4&&this.index<8?this.bgTit.source="com_json.bg_eqp1":this.bgTit.source="com_json.bg_eqp0";for(var s=0;3>s;s++){var o=this["tNum"+s],n=t[s+1];if(n&&!Utils.isEmptyObj(n)){var r=GmGlobal.mc.heroMgr.getAtrName(n.aid),h=GmGlobal.mc.heroMgr.isAddJia(n.aid),a=GmGlobal.mc.heroMgr.isNdPre(n.aid),l=r+"+"+n.aval;h||(l=r+n.aval),(1==n.atype||a)&&(l+="%"),o.text=l}else o.text="No forge"}},e}(eui.ItemRenderer);__reflect(HeroDuanzItem.prototype,"HeroDuanzItem");var HeroItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroItemSkin",e}return __extends(e,t),e}(eui.Component);__reflect(HeroItem.prototype,"HeroItem");var HeroJjAtrTipItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroJjAtrTipItemSkin",e}return __extends(e,t),e}(eui.Component);__reflect(HeroJjAtrTipItem.prototype,"HeroJjAtrTipItem");var HeroJjAtrTipView=function(t){function e(){var e=t.call(this,"HeroJjAtrTipSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tkz.text=this._mc.heroMgr.kzDes,this.tit0.y=this.tkz.y+this.tkz.height+15,this.con0.y=this.tit0.y+35,this._cc.dataCtl.reqJsonData(JsonReqId.HERO_JJ_ATR,[],this.updAtrs,this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.updAtrs=function(t){for(var e=t,i=this._mc.heroMgr.atrTypes,s=0;s<i.length;s++){var o=i[s],n=this["tit"+s],r=this["con"+s];n.text=o.name+"：";var h=this.getAtrLst(e,o.atrs);r.removeChildren();for(var a=0;a<h.length;a++){var l=h[a];if(l){var c=new HeroJjAtrTipItem;r.addChild(c);var d=this._mc.heroMgr.getAtrName(l.aid),p=this._mc.heroMgr.isAddJia(l.aid),u=this._mc.heroMgr.isNdPre(l.aid);p&&(d+="+"),c.tTit.text=d,c.bg.width=c.tTit.width+25;var m=l.num;u&&(m+="%"),c.tDes.text=m,c.tDes.x=c.bg.x+c.bg.width+5}}var _=Math.ceil(h.length/2);r.height=40*_+5*(_-1),s>0&&(n.y=this["con"+(s-1)].y+this["con"+(s-1)].height+10,r.y=n.y+35)}},e.prototype.getAtrLst=function(t,e){for(var i=[],s=0;s<e.length;s++){var o=e[s];if(t[o]){var n={aid:o,num:t[o]};i.push(n)}}return i},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HERO_JJ_TIP)},e}(UIBase);__reflect(HeroJjAtrTipView.prototype,"HeroJjAtrTipView");var HeroManager=function(){function t(){this.jlAtrDes=[],this.bAtrDes=[],this.anum=0,this.alst=[],this.atrs=[],this.bAtrs=[],this.kzDes="",this.atrTypes=[],GmGlobal.mc.regUnzipCfg("c_hero.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_equip_yz.json",this.initYzCfg,this),GmGlobal.mc.regUnzipCfg("c_equip_ms.json",this.initMsCfg,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.HERO,this.redDot)}return t.prototype.initCfg=function(t){this._cfg=t,this.kzDes=t.kzDes,this.atrTypes=t.atrTypes},t.prototype.initYzCfg=function(t){this._yzItemCfgs=t.itemCfgs,this.jlAtrDes=t.jlAtrDes,this.bAtrDes=t.bAtrDes,this.tzCfgs=t.tzCfgs,this.yzRule=t.rule},t.prototype.initMsCfg=function(t){this._msCfg=t},t.prototype.getYzCfg=function(t){return this._yzItemCfgs[t]},t.prototype.getHeroCfgs=function(){return this._cfg.heros},t.prototype.getHeroCfg=function(t){for(var e=0,i=this._cfg.heros;e<i.length;e++){var s=i[e];if(s.id==t)return s}return null},t.prototype.getCareers=function(){return this._cfg.careers},t.prototype.getCareerCfg=function(t){return this._cfg.careers[t]},t.prototype.getHeroCfgByCareer=function(t,e){for(var i=this._cfg.heros,s=0,o=i;s<o.length;s++){var n=o[s];if(n.sex==e&&n.career==t)return n}return null},t.prototype.getHeroLvAtr=function(t){var e=this._cfg.heroAtrs;return e[t]},t.prototype.getAtrByid=function(t){return this._cfg.atrId[t-1]},t.prototype.getIdByAtr=function(t){var e=-1;return e=this._cfg.atrId.indexOf(t)},t.prototype.getAtrName=function(t){var e="",i=this._cfg.atrs[t];return i&&i.name&&(e=i.name),e},t.prototype.isNdPre=function(t){var e=!1,i=this._cfg.atrs[t];return i&&i.p&&(e=1==i.p?!0:!1),e},t.prototype.updData=function(t){this._data=t},t.prototype.getAtrValue=function(t){return this._data?this._data[t]||0:0},t.prototype.getAtrNameByid=function(t){var e=this._cfg.atrId[t-1],i="";return e&&("a"==e?i="STR":"i"==e?i="INT":"p"==e?i="STA":"q"==e?i="AGI":"d"==e?i="DEX":"l"==e?i="LUK":"pa"==e?i="PHY ATK":"ma"==e?i="MAG ATK":"hm"==e?i="MAX HP":"mm"==e?i="MAX MP":"fy"==e?i="DEF":"bj"==e?i="CRIT":"sb"==e?i="EVA":"mz"==e?i="HIT":"as"==e?i="Basic ATK SPD":"ic"==e&&(i="SP Heal")),i},t.prototype.getAtrs=function(){return this._cfg.atrs},t.prototype.getHeroUIModel=function(t){return"mui_"+t+"_json.mui_"+t},t.prototype.getHeroUIModel2=function(t){return"mui2_"+t+"_json.mui2_"+t},t.prototype.isAddJia=function(t){var e=!0,i=this.getAtrName(t);return i?(-1!=i.indexOf("+")?e=!1:-1!=i.indexOf("-")&&(e=!1),e):!1},t.prototype.getRNameCost=function(t){var e=this._cfg.cname;return t>=e.length&&(t=e.length-1),e[t]},t.prototype.getYzInfoByIdx=function(t){return this.yzItems[t]},t.prototype.getYzIdxById=function(t){var e=-1;for(var i in this.yzItems){var s=this.yzItems[i];if(t==s.itemId){e=Number(i);break}}return e},t.prototype.getYzCdNum=function(t){var e=1,i=this.getYzCfg(t);for(var s in this.yzItems){var o=this.yzItems[s],n=o.itemId;if(n&&n!=t){var r=this.getYzCfg(n);i.tzid==r.tzid&&e++}}return e},t.prototype.getYzJlNum=function(t){var e=this.getYzCfg(t),i=e.jllv;for(var s in this.yzItems){var o=this.yzItems[s],n=o.itemId;if(n&&n!=t){var r=this.getYzCfg(n);e.tzid==r.tzid&&(i+=r.jllv)}}return i},t.prototype.getMsInfoById=function(t){for(var e in this.msItems){var i=this.msItems[e];if(t==i.itemId)return i}return null},t.prototype.getMsInfoByIdx=function(t){return this.msItems?this.msItems[t]:null},t.prototype.getMsItem=function(t){return this._msCfg.items[t]},t.prototype.getMsIdxById=function(t){for(var e in this.msItems){var i=this.msItems[e];if(t==i.itemId)return Number(e)}return-1},t.prototype.getMsRule=function(){return this._msCfg.rule},t.prototype.getMsMinJd=function(){var t=-1,e=0;for(var i in this.msItems){var s=this.msItems[i];if(s&&s.itemId){var o=this._msCfg.items[s.itemId];4==o.jw&&(e++,(-1==t||o.jd<t)&&(t=o.jd))}}return 8>e&&(t=0),t},t.prototype.getMsGmIdx=function(t){for(var e=0;e<this._msCfg.gzcfg.length;e++){var i=this._msCfg.gzcfg[e];if(t<i.jd){e--;break}}var s=e;return 0>s?s=0:s>=this._msCfg.gzcfg.length&&(s=this._msCfg.gzcfg.length-1),s},t.prototype.getMsGmData=function(t){return this._msCfg.gzcfg.length>t?this._msCfg.gzcfg[t]:null},t}();__reflect(HeroManager.prototype,"HeroManager");var HeroMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.HERO,CmdType.O_HERO),CmdBus.adListener(CmdType.O_HERO,this.onOpenView,this),CmdBus.adListener(CmdType.C_HERO,this.onCloseView,this),CmdBus.adListener(CmdType.O_HERO_EQP,this.onOpenEqpView,this),CmdBus.adListener(CmdType.C_HERO_EQP,this.onCloseEqpView,this),CmdBus.adListener(CmdType.O_HERO_CARD,this.onOpenCardView,this),CmdBus.adListener(CmdType.C_HERO_CARD,this.onCloseCardView,this),CmdBus.adListener(CmdType.O_HERO_TIP,this.onOpenTipView,this),CmdBus.adListener(CmdType.C_HERO_TIP,this.onCloseTipView,this),CmdBus.adListener(CmdType.O_HERO_JJ_TIP,this.onOpenJjTipView,this),CmdBus.adListener(CmdType.C_HERO_JJ_TIP,this.onCloseJjTipView,this),CmdBus.adListener(CmdType.O_HERO_YZ_JL,this.onOpenYzjlView,this),CmdBus.adListener(CmdType.C_HERO_YZ_JL,this.onCloseYzjlView,this),CmdBus.adListener(CmdType.O_HERO_YZ_ZH,this.onOpenYzZhView,this),CmdBus.adListener(CmdType.C_HERO_YZ_ZH,this.onCloseYzZhView,this),CmdBus.adListener(CmdType.O_MS_HC,this.onOpenMsHcView,this),CmdBus.adListener(CmdType.C_MS_HC,this.onCloseMsHcView,this)}return t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new HeroView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenEqpView=function(t,e,i){this._eqpUi||(this._eqpUi=new EquipWearlView),this._eqpUi.isShow||(this._eqpUi.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._eqpUi.setIdx(t,e,i)},t.prototype.onCloseEqpView=function(){this._eqpUi&&this._eqpUi.isShow&&this._eqpUi.close()},t.prototype.onOpenCardView=function(t){this._cardUi||(this._cardUi=new CardWearView),this._cardUi.isShow||(this._cardUi.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._cardUi.setIdx(t)},t.prototype.onCloseCardView=function(){this._cardUi&&this._cardUi.isShow&&this._cardUi.close()},t.prototype.onOpenTipView=function(){this._atrTip||(this._atrTip=new HeroAtrTipView),this._atrTip.isShow||(this._atrTip.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseTipView=function(){this._atrTip&&this._atrTip.isShow&&this._atrTip.close()},t.prototype.onOpenJjTipView=function(){this._atrJjTip||(this._atrJjTip=new HeroJjAtrTipView),this._atrJjTip.isShow||(this._atrJjTip.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseJjTipView=function(){this._atrJjTip&&this._atrJjTip.isShow&&this._atrJjTip.close()},t.prototype.onOpenYzjlView=function(t){this._yzjl||(this._yzjl=new HeroYzJlView),this._yzjl.isShow||(this._yzjl.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._yzjl.setIdx(t)},t.prototype.onCloseYzjlView=function(){this._yzjl&&this._yzjl.isShow&&this._yzjl.close()},t.prototype.onOpenYzZhView=function(t){this._yzZh||(this._yzZh=new HeroYzZhView),this._yzZh.isShow||this._yzZh.show(GmGlobal.vmc.uiLayer),this._yzZh.setItem(t)},t.prototype.onCloseYzZhView=function(){this._yzZh&&this._yzZh.isShow&&this._yzZh.close()},t.prototype.onOpenMsHcView=function(t){this._msHc||(this._msHc=new HeroMsHc),this._msHc.isShow||this._msHc.show(GmGlobal.vmc.uiLayer),this._msHc.setId(t)},t.prototype.onCloseMsHcView=function(){this._msHc&&this._msHc.isShow&&this._msHc.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._eqpUi&&(this._eqpUi.destroy(),this._eqpUi=null),this._atrTip&&(this._atrTip.destroy(),this._atrTip=null),this._cardUi&&(this._cardUi.destroy(),this._cardUi=null),this._atrJjTip&&(this._atrJjTip.destroy(),this._atrJjTip=null),this._yzjl&&(this._yzjl.destroy(),this._yzjl=null),this._yzZh=null,this._msHc&&(this._msHc.destroy(),this._msHc=null),!0):!1:!0},t}();__reflect(HeroMediator.prototype,"HeroMediator",["IMediator"]);var HeroMsHc=function(t){function e(){var e=t.call(this,"HeroMsHcSkin")||this;return e._addExp=0,e._selList=[],e._selImgPool=[],e._selImg={},e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(20,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bHc.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this),EventBus.addListener(EventType.M_EQUIP_MS_UPD,this.updateHcData,this),EventBus.addListener(EventType.M_UPD_CON,this.onConUpd,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bHc.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this),EventBus.rmListener(EventType.M_EQUIP_MS_UPD,this.updateHcData,this),EventBus.rmListener(EventType.M_UPD_CON,this.onConUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setId=function(t){this._id=t,this._idx=this._mc.heroMgr.getMsIdxById(t),this.updateHcData(),this.updateLst()},e.prototype.updateHcData=function(){var t=this._mc.heroMgr.getMsInfoByIdx(this._idx),e=this._mc.heroMgr.getMsItem(t.itemId);this.item3.setItem(new Item(t.itemId,0),!1,null,e.jd),this.item3.enableTip(!0,0,ModelID.HERO),e.jw<4&&10==e.jd?(this._aType=2,this.item3.y=150,this.item3.x=170,this.hcCon.visible=!1,this.jjCon.visible=!0,this.bHc.label="Evolve",this.item0.setItem(e.jhCost[0],!0),this.item1.setItem(e.jhCost[1],!0),this.item2.setItem(e.jhCost[2],!0),this.item4.setItem({id:e.jhtoitem,num:1},!1),this.item0.enableTip(!0,0,ModelID.HERO),this.item1.enableTip(!0,0,ModelID.HERO),this.item2.enableTip(!0,0,ModelID.HERO),this.item4.enableTip(!0,0,ModelID.HERO)):(this._aType=1,this.item3.y=200,this.item3.x=303,this.hcCon.visible=!0,this.jjCon.visible=!1,this.bHc.label="Fuse",this.bar.maximum=e.hcExp,this.bar.value=t.exp||0,this.jTxt.text="Rank "+e.jd),this.updateBtnState(),this.updateAddExp()},e.prototype.updateBtnState=function(){if(1==this._aType)0==this._selList.length?Utils.setBtnEnable(this.bHc,!1):Utils.setBtnEnable(this.bHc,!0);else if(2==this._aType){for(var t=this._mc.heroMgr.getMsItem(this.item3.itemId),e=0;e<t.jhCost.length;e++){var i=t.jhCost[e],s=this._mc.itemMgr.getItemNum(i.id);if(s<i.num)return void Utils.setBtnEnable(this.bHc,!1)}Utils.setBtnEnable(this.bHc,!0)}},e.prototype.updateAddExp=function(){for(var t=0,e=0;e<this._selList.length;e++){var i=this._selList[e],s=this._mc.heroMgr.getMsItem(i),o=this._mc.itemMgr.getItemNum(i);
t+=s.exp*o}var n=this._mc.heroMgr.getMsInfoByIdx(this._idx),r=this._mc.heroMgr.getMsItem(n.itemId);t>0?(this.expTxt.textFlow=TextFormat.parser.parse(n.exp+TextFormat.setColor("+"+t,246019)+" / "+r.hcExp),this.bar.value=n.exp+t):(this.expTxt.text=n.exp+" / "+r.hcExp,this.bar.value=n.exp),this._addExp=t},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.MOSHI]),i=0;i<e.length;i++){var s=e[i];t.push(s)}return t},e.prototype.onConUpd=function(){this.updateLst(),this.updateBtnState()},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]),o=[];for(var n in this._selImg){var r=this._selImg[n];r&&r.parent&&r.parent.removeChild(r)}for(var h=t;i>h;h++){var a=this._itemList[h];s.push(a);var r=this._selImg[a.id];r&&!r.parent&&this.selCon.addChild(r);var l=this._mc.heroMgr.getMsItem(a.id);o.push(l.jd)}this._itemGridCon.setItems(s,!1,"",o)}},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updSelItems=function(){},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t];this._selList.length>0&&-1!=this._selList.indexOf(i.itemId)?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}},e.prototype.setItemSelState=function(t,e){var i=this._selList.indexOf(t.itemId);if(e){var s=void 0;i>=0?s=this._selImg[t.itemId]:(this._selList.push(t.itemId),s=this.getSelImg(),this._selImg[t.itemId]=s),s.parent||this.selCon.addChild(s),s.x=t.icon.x+t.icon.width-31,s.y=t.icon.y-10}else{if(-1==i)return;this._selList.splice(i,1);var s=this._selImg[t.itemId];s.parent&&(this.selCon.removeChild(s),this._selImgPool.push(s),delete this._selImg[t.itemId])}this.updSelItems()},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.onTouchItemGrid=function(t){if(2!=this._aType){if(this._selList.length>=20)return void MsgBox.prompt("Select up to 20");this.setItemSelState(t,!this.isSel(t.itemId)),this.updateBtnState(),this.updateAddExp()}},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.heroMgr.getMsRule())},e.prototype.onHc=function(){this.bHc.touchEnabled=!1,2==this._aType||this._addExp+this.bar.value>=this.bar.maximum?this.showQhEft():this.doHc()},e.prototype.doHc=function(){var t=[this._idx];1==this._aType?(t=t.concat(this._selList),this._cc.dataCtl.doAction(ServerActionId.MS_HC,t,this.onHcOk,this)):this._cc.dataCtl.doAction(ServerActionId.MS_JH,t),this._eft&&(this._eft.visible=!1),this._jheft&&(this._jheft.visible=!1),this.bHc.touchEnabled=!0},e.prototype.showQhEft=function(){1==this._aType?(this._eft||(this._eft=new MovieClipEx("yingzijl"),this.addChild(this._eft)),this._eft.visible=!0,this._eft.x=this.item3.x+Math.floor(this.item3.width/2),this._eft.y=this.item3.y+Math.floor(this.item3.height/2),this._eft.play(1,this.doHc,this)):(this._jheft||(this._jheft=new MovieClipEx("cw_hc"),this.addChild(this._jheft)),this._jheft.visible=!0,this._jheft.x=this.jjCon.x+this.item4.x+Math.floor(this.item4.width/2),this._jheft.y=this.jjCon.y+this.item4.y+Math.floor(this.item4.height/2),this._jheft.play(1,this.doHc,this))},e.prototype.onHcOk=function(){this.clearSelList(),this.updateBtnState(),this.updateAddExp()},e.prototype.clearSelList=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._selImg[i];s&&(s.visible=!0,this._selImgPool.push(s),delete this._selImg[i],s.parent&&this.selCon.removeChild(s))}this._selList=[]},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MS_HC)},e.prototype.close=function(){this._eft&&(this._eft.clear(),this._eft=null),this._jheft&&(this._jheft.clear(),this._jheft=null),this.clearSelList(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,this._cc=null},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(HeroMsHc.prototype,"HeroMsHc");var HeroView=function(t){function e(){var e=t.call(this,"HeroViewSkin")||this;return e._page=1,e._maxPage=1,e._gid=-1,e._tabIndex=-1,e._addIdx=-1,e._addNum=1,e._paddIdx=-1,e._ljNum=0,e._pageNum=15,e._cardFIndex=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bReset.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReset,this),this.bJj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJj,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBEqp,this),this.yzICon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYzEqp,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._timer.addEventListener(egret.TimerEvent.TIMER,this.refreshNum,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),EventBus.addListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.addListener(EventType.M_HERO_UPD,this.updateHeroInfo,this),EventBus.addListener(EventType.M_EATRS_UPD,this.updOneEqpItem,this),EventBus.addListener(EventType.M_EQUIP_UPD,this.updOneEqp,this),EventBus.addListener(EventType.M_R_Z_UPD,this.onZhanliUp,this),EventBus.addListener(EventType.M_UPD_CON,this.onConUpd,this),EventBus.addListener(EventType.M_EQUIP_YZ_UPD,this.updOneYzEqp,this),EventBus.addListener(EventType.M_EQUIP_MS_UPD,this.updateOneMsEquip,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bReset.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReset,this),this.bJj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJj,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBEqp,this),this.yzICon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onYzEqp,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.refreshNum,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),EventBus.rmListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.rmListener(EventType.M_HERO_UPD,this.updateHeroInfo,this),EventBus.rmListener(EventType.M_EATRS_UPD,this.updOneEqpItem,this),EventBus.rmListener(EventType.M_EQUIP_UPD,this.updOneEqp,this),EventBus.rmListener(EventType.M_R_Z_UPD,this.onZhanliUp,this),EventBus.rmListener(EventType.M_UPD_CON,this.onConUpd,this),EventBus.rmListener(EventType.M_EQUIP_YZ_UPD,this.updOneYzEqp,this),EventBus.rmListener(EventType.M_EQUIP_MS_UPD,this.updateOneMsEquip,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bClose.sound="ui_guanbi";for(var e=0;6>e;e++){var i=this["badd"+e];i.sound="ui_jiajian"}this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1);for(var e=0;10>e;e++){var s=this.itemCon.getChildAt(e);9==e?s.iItem.source="hero_json.hero_item8":s.iItem.source="hero_json.hero_item"+e}for(var e=0;8>e;e++){var s=this.yzICon.getChildAt(e);9==e?s.iItem.source="hero_json.hero_item8":s.iItem.source="hero_json.hero_item"+e}this.initQhPanel(),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this._timer=new egret.Timer(500,0),this.initYzGrids()},e.prototype.initQhPanel=function(){for(var t=0;6>t;t++){var e=this["tAtr"+t];e.text=this._mc.heroMgr.getAtrNameByid(t+1)}for(var i=0;10>i;i++){var e=this["tBAtr"+i];e.text=this._mc.heroMgr.getAtrNameByid(i+7)+":"}},e.prototype.initYzGrids=function(){this._itemCon=ItemGridCon.create(),this._itemCon.initGridsByNum(this._pageNum,115,!1,!1,!0),this._itemCon.addToParent(10,10,this.yzItemCon),this._itemCon.setTouchCb(!1,this.onTip,this)},e.prototype.onTip=function(t,e,i){3==this._tabIndex?YzEquipTips.show(t.itemId,e,i,ModelID.HERO,null,1):4==this._tabIndex&&MsEquipTips.show(t.itemId,e,i,ModelID.HERO,null,1)},e.prototype.clearYzGrids=function(){this._itemCon&&(ItemGridCon.release(this._itemCon),this._itemCon=null)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selTab(0),this.updateRoleInfo(),this.updEqps(),this.updateHeroInfo(),egret.setTimeout(this.checkGuide,this,100),this.onZhanliUp(),this.alphaShow(),this._cc.dataCtl.doAction(ServerActionId.HERO_INFO_REF,[])},e.prototype.onZhanliUp=function(){var t=this._mc.heroMgr.getAtrValue("z");this.tZl.text="Power："+t},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData)if(t.guideData.id==GuideID.EQUIPE_DRESS)if(5==t.guideData.steps.length){var e=this._mc.equipMgr.getEqp(0);if(e&&e.uid)t.clearGuide();else{var i=this.itemCon.getChildAt(0),s=i.iItem.parent.localToGlobal(i.iItem.x,i.iItem.y);t.bindTarget(GuideTargetId.HOER_EQUIP_R,i.iItem,s),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}}else{var e=this._mc.equipMgr.getEqp(1);if(e&&e.uid)return void t.clearGuide();var i=this.itemCon.getChildAt(1),s=i.iItem.parent.localToGlobal(i.iItem.x,i.iItem.y);t.bindTarget(GuideTargetId.HOER_EQUIP_R,i.iItem,s),i=this.itemCon.getChildAt(3),s=i.iItem.parent.localToGlobal(i.iItem.x,i.iItem.y),t.bindTarget(GuideTargetId.HOER_EQUIP_R2,i.iItem,s),i=this.itemCon.getChildAt(5),s=i.iItem.parent.localToGlobal(i.iItem.x,i.iItem.y),t.bindTarget(GuideTargetId.HOER_EQUIP_R3,i.iItem,s),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}else if(t.guideData.id==GuideID.CARD_XQ){var o=this.tableBgCon.getChildAt(2),n=this.x+this.tableBgCon.x+240,r=this.y+this.tableBgCon.y;t.bindTarget(GuideTargetId.TAB_SEL,o,new egret.Point(n,r)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}else if(t.guideData.id==GuideID.ATTR_ADD){var h=GmGlobal.mc.role.careerId<=1004?0:1,a=this["badd"+h];t.bindTarget(GuideTargetId.ATTR_ADD_BTN,a,a.parent.localToGlobal(a.x,a.y)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}},e.prototype.checkCardGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData)if(-1!=this._mc.guideMgr.guideEndIds.indexOf(GuideID.CARD_XQ)||-1==this._cardFIndex)t.clearGuide();else{this.scollToCardFirst();var e=this.getItemByIdx(this._cardFIndex+1);e||t.clearGuide();var i=e.getFirstItem(),s=i.parent.localToGlobal(i.x,i.y);t.bindTarget(GuideTargetId.GRID_SEL,i,s)}},e.prototype.getItemByIdx=function(t){for(var e=0;e<this.itemList.numChildren;e++){var i=this.itemList.getChildAt(e);if(i.data.index==t)return i}return null},e.prototype.updateRoleInfo=function(){var t=GmGlobal.mc.role;this.tLv.text="LV."+t.lv,this.tName.text=t.name,this.iHero.source=this._mc.heroMgr.getHeroUIModel2(t.careerId);var e=this._mc.heroMgr.getHeroLvAtr(t.lv);this.bar.maximum=e.expMax,this.bar.value=t.exp,this.tBar.text=t.exp+"/"+e.expMax,this.bRule.x=this.tLv.x+this.tLv.width+Math.floor(this.bRule.width/2)},e.prototype.updOneEqp=function(t){var e=t.data,i=this.itemCon.getChildAt(e),s=this._mc.equipMgr.getEqp(e);if(s){if(s.uid?(i.iItem.source=this._mc.itemMgr.getItemIcon(s.itemId),i.iItemk.source=this._mc.itemMgr.getItemIconK(s.itemId),i.tQh.text=s.qhLv.toString()):(i.iItemk.source=this._mc.itemMgr.getItemIconK(0),9==e?i.iItem.source="hero_json.hero_item8":i.iItem.source="hero_json.hero_item"+e),s.qhLv?i.tQh.visible=!0:i.tQh.visible=!1,1==this._tabIndex){var o=this._array.getItemAt(e);o.info=s.dzattrlst,this._array.itemUpdated(o)}var n=this._mc.itemMgr.getItemCfg(s.itemId);n?i.star.visible=n.isBoss:i.star.visible=!1}this.updLst(),this.updEqps()},e.prototype.updEqps=function(){for(var t=0;10>t;t++){var e=this.itemCon.getChildAt(t),i=this._mc.equipMgr.getEqp(t);if(i){if(i.uid){var s=this._mc.equipMgr.getEItem(i.uid);e.iItem.source=this._mc.itemMgr.getItemIcon(i.itemId),e.iItemk.source=this._mc.itemMgr.getItemIconK(i.itemId),e.tQh.text=i.qhLv.toString(),s&&s.jl?(e.tJl.visible=!0,e.tJl.text="+"+s.jl):e.tJl.visible=!1}else e.iItemk.source=this._mc.itemMgr.getItemIconK(0),9==t?e.iItem.source="hero_json.hero_item8":e.iItem.source="hero_json.hero_item"+t,e.tJl.visible=!1;i.qhLv?(e.tQh.visible=!0,e.tQh.text=i.qhLv.toString()):e.tQh.visible=!1;var o=this._mc.itemMgr.getItemCfg(i.itemId);o?e.star.visible=o.isBoss:e.star.visible=!1}else e.iItemk.source=this._mc.itemMgr.getItemIconK(0),9==t?e.iItem.source="hero_json.hero_item8":e.iItem.source="hero_json.hero_item"+t,e.tJl.visible=!1,e.tQh.visible=!1,e.star.visible=!1}},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.vmc.mGuide.triggerTarget(t.target),GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e),2==e&&this.checkCardGuide()}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t,0==t?(this.itemCon.visible=!0,this.eqpCon.visible=!0,this.cardCon.visible=!1,this.yzICon.visible=!1,this.yzCon.visible=!1):3==t?(this.itemCon.visible=!1,this.eqpCon.visible=!1,this.cardCon.visible=!1,this.yzICon.visible=!0,this.yzCon.visible=!0,this.updYzEqps(),this.onConUpd()):4==t?(this.itemCon.visible=!1,this.eqpCon.visible=!1,this.cardCon.visible=!1,this.yzICon.visible=!0,this.yzCon.visible=!0,this.updateMsEquips(),this.onConUpd()):(this.itemCon.visible=!0,this.yzICon.visible=!1,this.eqpCon.visible=!1,this.cardCon.visible=!0,this.yzCon.visible=!1,this.scoll.stopAnimation(),this._array.removeAll(),this.scoll.viewport.scrollV=0,1==t?(this.tCardTit.text="Forge Stats",this.itemList.itemRendererSkinName="HeroDuanzItemSkin",this.itemList.itemRenderer=HeroDuanzItem):(this.tCardTit.text="Card Gear",this.itemList.itemRendererSkinName="HeroCardItemSkin",this.itemList.itemRenderer=HeroCardItem,this._cardFIndex=-1),this.updLst())}},e.prototype.onConUpd=function(){(3==this._tabIndex||4==this._tabIndex)&&(3==this._tabIndex?this._equipList=GmGlobal.mc.itemMgr.getItemListByType([ItemType.YINGZI]):4==this._tabIndex&&(this._equipList=GmGlobal.mc.itemMgr.getItemListByType([ItemType.MOSHI])),this._maxPage=Math.max(Math.ceil(this._equipList.length/this._pageNum),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updatePage(),this.updYzGrids(),this.validateNow())},e.prototype.updYzEqps=function(){if(3==this._tabIndex)for(var t=0;8>t;t++){var e=this.yzICon.getChildAt(t),i=this._mc.heroMgr.getYzInfoByIdx(t+1);if(i&&i.itemId){var s=i.itemId;e.iItem.source=this._mc.itemMgr.getItemIcon(s),e.iItemk.source=this._mc.itemMgr.getItemIconK(s);var o=this._mc.heroMgr.getYzCfg(s),n=o.jllv;n?(e.tJl.text="+"+n,e.tJl.visible=!0):e.tJl.visible=!1}else e.iItemk.source=this._mc.itemMgr.getItemIconK(0),e.iItem.source="hero_json.hero_item"+t,e.tJl.visible=!1;e.tQh.visible=!1,e.star.visible=!1}},e.prototype.updOneYzEqp=function(t){var e=t.data,i=this.yzICon.getChildAt(e),s=this._mc.heroMgr.getYzInfoByIdx(e+1);if(s&&s.itemId){var o=s.itemId;i.iItem.source=this._mc.itemMgr.getItemIcon(o),i.iItemk.source=this._mc.itemMgr.getItemIconK(o);var n=this._mc.heroMgr.getYzCfg(o),r=n.jllv;r?(i.tJl.text="+"+r,i.tJl.visible=!0):i.tJl.visible=!1}else i.iItemk.source=this._mc.itemMgr.getItemIconK(0),i.iItem.source="hero_json.hero_item"+e,i.tJl.visible=!1},e.prototype.updYzGrids=function(){if(this._equipList){var t=(this._page-1)*this._pageNum,e=t+this._pageNum;e>=this._equipList.length&&(e=this._equipList.length);for(var i=GmGlobal.mc.itemMgr.getContainer(),s=[],o=[],n=t;e>n;n++){var r=this._equipList[n];if(3==this._tabIndex){var h=this._mc.heroMgr.getYzCfg(r.id),a=h.jllv;o.push(a)}else if(4==this._tabIndex){var l=this._mc.heroMgr.getMsItem(r.id);o.push(l.jd)}s.push(i.items[r.id])}this._itemCon.setItems(s,!1,"",o)}},e.prototype.updateMsEquips=function(){if(4==this._tabIndex)for(var t=0;8>t;t++){var e=this.yzICon.getChildAt(t),i=this._mc.heroMgr.getMsInfoByIdx(t+1);if(i&&i.itemId){var s=i.itemId;e.iItem.source=this._mc.itemMgr.getItemIcon(s),e.iItemk.source=this._mc.itemMgr.getItemIconK(s);var o=this._mc.heroMgr.getMsItem(s);o.jd?(e.tJl.text="+"+o.jd,e.tJl.visible=!0):e.tJl.visible=!1}else e.iItemk.source=this._mc.itemMgr.getItemIconK(0),e.iItem.source="hero_json.hero_item"+t,e.tJl.visible=!1;e.tQh.visible=!1,e.star.visible=!1}},e.prototype.updateOneMsEquip=function(t){if(4==this._tabIndex&&t.data){var e=t.data-1,i=this.yzICon.getChildAt(e),s=this._mc.heroMgr.getMsInfoByIdx(e+1);if(s&&s.itemId){var o=s.itemId;i.iItem.source=this._mc.itemMgr.getItemIcon(o),i.iItemk.source=this._mc.itemMgr.getItemIconK(o);var n=this._mc.heroMgr.getMsItem(o);n.jd?(i.tJl.text="+"+n.jd,i.tJl.visible=!0):i.tJl.visible=!1}else i.iItemk.source=this._mc.itemMgr.getItemIconK(0),i.iItem.source="hero_json.hero_item"+e,i.tJl.visible=!1}},e.prototype.updLst=function(){for(var t=0;10>t;t++)if(1==this._tabIndex){var e=GmConst.EQP_COLOR[t],i=this._mc.equipMgr.getEqp(e-1),s={info:i.dzattrlst,index:t+1};this._array.getItemAt(t)?this._array.replaceItemAt(s,t):this._array.addItem(s)}else if(2==this._tabIndex){var i=this._mc.equipMgr.getEqp(t),o=this._mc.equipMgr.getEItem(i.uid),n={};if(o&&o.cardlst){n=o.cardlst;var r=GmGlobal.mc.equipMgr.getEqpCfg(i.itemId);r&&r.slot&&-1==this._cardFIndex&&(this._cardFIndex=t)}var s={info:n,itemid:i.itemId,index:t+1};this._array.getItemAt(t)?this._array.replaceItemAt(s,t):this._array.addItem(s)}},e.prototype.scollToCardFirst=function(){var t=126*(this._cardFIndex+1)-this.scoll.height,e=1254-this.scoll.height;0>t?t=0:t>e&&(t=e),this.scoll.viewport.scrollV=t,this.validateNow()},e.prototype.updOneEqpItem=function(t){var e=t.data;if(e){var i=this._mc.equipMgr.getEItem(e),s=this._mc.equipMgr.getEqpByUid(e);if(s){var o=this.itemCon.getChildAt(s.grid);if(i&&i.jl?(o.tJl.text="+"+i.jl,o.tJl.visible=!0):o.tJl.visible=!1,2==this._tabIndex){var n=this._array.getItemAt(s.grid),r={};i&&i.cardlst&&(r=i.cardlst),n.info=r,this._array.itemUpdated(n)}}}},e.prototype.updateHeroInfo=function(){this.tLeft.text=this._mc.heroMgr.anum.toString(),this.bReset.x=this.tLeft.x+this.tLeft.width+Math.floor(this.bReset.width/2)+10;for(var t=this._mc.role,e=(this._mc.heroMgr.getHeroLvAtr(t.lv),0);6>e;e++){var i=this["tAtrNum"+e],s=this._mc.heroMgr.atrs[e]||0,o=this._mc.heroMgr.alst[e]||0;if(o>0&&s>=o){s-=o;var n=" + "+o;i.textFlow=TextFormat.parser.parser(s+TextFormat.setColor(n,16615680))}else i.text=s.toString()}for(var r=0;10>r;r++){var i=this["tBAtrNum"+r],h=this._mc.heroMgr.bAtrs[r]||0;i.text=h.toString()}},e.prototype.onList=function(t){if(t.target.parent.parent==this.itemList&&2==this._tabIndex){var e=t.target.parent.data,i=GmGlobal.mc.equipMgr.getEqpCfg(e.itemid);if(!i)return;var s=t.target.name,o=Utils.getNameIndex(s);if(-1==o)return;var n=i.slot||0;if(o>=n)return;var r=e.info,h=r[o+1];h?h&&(GmGlobal.mc.equipMgr.clickIdx=e.index-1,GmGlobal.mc.equipMgr.clickCid=o+1,ItemTips.show(h,t.stageX,t.stageY,null,null,null,null,1)):(GmGlobal.vmc.mGuide.triggerTarget(t.target),CmdBus.doCmd(CmdType.O_HERO_CARD,e.index-1))}},e.prototype.refreshNum=function(t){t.target.currentCount<2||this._isAdd&&(this._addNum=10,this.addNum())},e.prototype.onTouchEnd=function(t){var e=t.target;e.parent==this.atrCon&&"btn"==e.name&&(this._isAdd=!1,this._timer.currentCount<2&&(this._paddIdx==this._addIdx?this._ljNum++:this._ljNum=0,this._ljNum>=4&&MsgBox.prompt("Hold to quick add"),this._addNum=1,this.addNum(),GmGlobal.vmc.mGuide.triggerTarget(t.target)))},e.prototype.onTouchMove=function(t){var e=t.target;e.parent==this.atrCon&&"btn"==e.name&&(this._isAdd=!1)},e.prototype.onTouchBegin=function(t){var e=t.target;this._paddIdx=this._addIdx,this._addIdx=this.atrCon.getChildIndex(e)%6,e.parent==this.atrCon&&"btn"==e.name&&(this._isAdd=!0,this._timer.reset(),this._timer.start())},e.prototype.addNum=function(){var t=this._addNum,e=GmGlobal.vmc.mGuide;if(e.guideData&&e.guideData.id==GuideID.ATTR_ADD){var i=GmGlobal.mc.guideMgr.getGuideTask();if(i){var s=GmGlobal.mc.guideMgr.getTaskListInfo(i.idx);if(s){var o=GmGlobal.mc.role.careerId<=1004?this._mc.heroMgr.atrs[0]:this._mc.heroMgr.atrs[1];t=s.x-(o||0),0>t&&(t=1)}}GmGlobal.mc.guideMgr.isSimpleGuide()&&e.clearGuide()}GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_ADD,[this._addIdx+1,t])},e.prototype.onBEqp=function(t){var e=t.target.parent;if(e.parent==this.itemCon){var i=this.itemCon.getChildIndex(e);if("icon"==t.target.name){var s=this._mc.equipMgr.getEqp(i);s.uid?(this._mc.equipMgr.clickIdx=i,EquipTips.show(s.uid,this.x+150,this.y+160,ModelID.EQUIP,null,null,null,1)):(GmGlobal.vmc.mGuide.triggerTarget(t.target),CmdBus.doCmd(CmdType.O_HERO_EQP,0,i))}}},e.prototype.onYzEqp=function(t){var e=t.target.parent;if(e.parent==this.yzICon){var i=this.yzICon.getChildIndex(e);if("icon"==t.target.name)if(3==this._tabIndex){var s=this._mc.heroMgr.getYzInfoByIdx(i+1);s&&s.itemId&&YzEquipTips.show(s.itemId,this.x+150,this.y+160,ModelID.HERO)}else if(4==this._tabIndex){var s=this._mc.heroMgr.getMsInfoByIdx(i+1);s&&s.itemId&&MsEquipTips.show(s.itemId,this.x+150,this.y+160,ModelID.HERO)}}},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updYzGrids())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updYzGrids())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onReset=function(){var t=new Item(ItemID.RESETATR,1);ResetAtrTipView.showInfo(t,"Reset your stats by consuming the following items?",this.resetAtr,this)},e.prototype.resetAtr=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_ATR_RESET,[ItemID.RESETATR])},e.prototype.onJj=function(){CmdBus.doCmd(CmdType.O_HERO_JJ_TIP)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_HERO_TIP)},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_HERO)},e.prototype.close=function(){if(RedDotView.removeRedDotByGroup("hero"),-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._addNum=1,this._tabIndex=-1,this._paddIdx=-1,this._ljNum=0,this._timer.stop(),t.prototype.close.call(this)},e.prototype.destroy=function(){},e}(UIBase);__reflect(HeroView.prototype,"HeroView");var HeroYzJlView=function(t){function e(){var e=t.call(this,"HeroYzJlSkin")||this;return e._isZs=0,e._hecId=-1,e._selList=[],e._selImgPool=[],e._selImg={},e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.bfj.label="Refine",this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(20,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),this.bzsjl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZsjl,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.addListener(EventType.M_UPD_CON,this.updateLst,this),EventBus.addListener(EventType.M_EQUIP_YZ_UPD,this.updBar,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),this.bzsjl.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZsjl,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.rmListener(EventType.M_UPD_CON,this.updateLst,this),EventBus.rmListener(EventType.M_EQUIP_YZ_UPD,this.updBar,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setIdx=function(t){this._idx=t;var e=this._mc.heroMgr.getYzInfoByIdx(this._idx+1);this._id=e.itemId;var i=this._mc.heroMgr.getYzCfg(this._id);this.item3.setItem(new Item(this._id,0),null,null,i.jllv),i.jlrate?this.mtxt.text="Success Rate "+i.jlrate+"%":this.mtxt.text="Max Refine LV reached",this.tnum.text=i.diamondjl,this.updSelItems(),this.updateLst(),this.updBar()},e.prototype.updBar=function(){var t=this._mc.heroMgr.getYzInfoByIdx(this._idx+1);this._id=t.itemId;var e=this._mc.heroMgr.getYzCfg(this._id);e.jlexp?(this.bar.visible=!0,this.bar.value=t.exp,this.bar.maximum=e.jlexp):this.bar.visible=!1},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.YINGZI]),i=0;i<e.length;i++){var s=e[i],o=this._mc.heroMgr.getYzCfg(s.id);o.jllv<1&&t.push(s)}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.onTouchItemGrid=function(t){return this._selList.length>=3&&-1==this._selList.indexOf(t.itemId)?void MsgBox.prompt("Selected 3 items, Refine available！"):void this.setItemSelState(t,!this.isSel(t.itemId))},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]);for(var o in this._selImg){var n=this._selImg[o];n&&(n.visible=!1)}for(var r=t;i>r;r++){var h=this._itemList[r];s.push(h);var n=this._selImg[h.id];n&&(n.visible=!0)}if(this._itemGridCon.setItems(s),this.clearSelList(),s.length>=3)for(var r=0;3>r;r++){var a=this._itemGridCon.grids[r];this.setItemSelState(a,!this.isSel(a.itemId))}}},e.prototype.updSelItems=function(){for(var t=0;3>t;t++){var e=this._selList[t],i=this["item"+t];e?i.setItem(new Item(e,0)):i.setItem(null)}this._selList.length>=3?(Utils.setBtnEnable(this.bfj,!0),Utils.setBtnEnable(this.bzsjl,!0)):(Utils.setBtnEnable(this.bfj,!1),Utils.setBtnEnable(this.bzsjl,!1))},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t];this._selList.length>0&&-1!=this._selList.indexOf(i.itemId)?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}},e.prototype.setItemSelState=function(t,e){var i=this._selList.indexOf(t.itemId);if(e){if(i>=0)return;this._selList.push(t.itemId);var s=this.getSelImg();s.x=t.icon.x+t.icon.width-31,s.y=t.icon.y-10,this.selCon.addChild(s),this._selImg[t.itemId]=s}else{if(-1==i)return;this._selList.splice(i,1);var s=this._selImg[t.itemId];this.selCon.removeChild(s),this._selImgPool.push(s),delete this._selImg[t.itemId]}this.updSelItems()},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._selImg[i];s&&(s.visible=!0,this._selImgPool.push(s),delete this._selImg[i],this.selCon.removeChild(s))}this._selList=[]},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onFj=function(){this.bfj.touchEnabled=!1,this.bzsjl.touchEnabled=!1,this._isZs=0,this.showQhEft()},e.prototype.onZsjl=function(){this.bfj.touchEnabled=!1,this.bzsjl.touchEnabled=!1,this._isZs=1,this.showQhEft()},e.prototype.jlOk=function(){this.clearSelList(),this.updSelItems(),this.setIdx(this._idx)},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("yingzijl"),this.addChild(this._eft),this._eft.x=this.item3.x+Math.floor(this.item3.width/2),this._eft.y=this.item3.y+Math.floor(this.item3.height/2)),this._eft.visible=!0,this._eft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._eft.visible=!1;var t=[this._idx+1];t=t.concat(this._selList),t.push(this._isZs),this._cc.dataCtl.doAction(ServerActionId.YZ_EQP_JL,t,this.jlOk,this,this.jlOk),this.bfj.touchEnabled=!0,this.bzsjl.touchEnabled=!0},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.heroMgr.yzRule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HERO_YZ_JL)},e.prototype.close=function(){this._eft&&(this._eft.clear(),this._eft=null),this._page=1,this._maxPage=1,this.clearSelList(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(HeroYzJlView.prototype,"HeroYzJlView");var HeroYzZhView=function(t){function e(){return t.call(this,"HeroYzZhSkin")||this}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bzh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZh,this),this.item0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.item1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.item2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bzh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZh,this),this.item0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.item1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.item2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.unSel()},e.prototype.setItem=function(t){this._itemId=t;var e=GmGlobal.mc,i=e.heroMgr.getYzCfg(t);this.tnum.text=i.excprice,this.item.setItem(new Item(t,0),null,null,i.jllv);for(var s=this.getZhList(t),o=0;3>o;o++){var n=s[o],r=this["item"+o],h=e.heroMgr.getYzCfg(n);r.setItem(new Item(n,0),null,null,h.jllv)}},e.prototype.getZhList=function(t){var e=[8e4,81e3,82e3,83e3],i=1e3*Math.floor(t/1e3),s=e.indexOf(i);
-1!=s&&e.splice(s,1);for(var o=0;o<e.length;o++)e[o]=e[o]+t-i;return e},e.prototype.onItem=function(t){this._toItemId==t.target.itemId?this.unSel():(this._toItemId=t.target.itemId,this.selImg.visible=!0,this.selImg.x=t.target.x+t.target.width-31,this.selImg.y=t.target.y-10,Utils.setBtnEnable(this.bzh,!0))},e.prototype.unSel=function(){this._toItemId=0,this.selImg.visible=!1,Utils.setBtnEnable(this.bzh,!1)},e.prototype.onZh=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.YZ_ZH,[GmGlobal.mc.heroMgr.getYzIdxById(this._itemId),this._toItemId],this.onClose,this)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HERO_YZ_ZH)},e}(UIBase);__reflect(HeroYzZhView.prototype,"HeroYzZhView");var AwardRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tRank.text=this.data.rank,this.tJf.text=this.data.jf||"",!this.data.jf&&this.data.name&&(this.tJf.text="0"),this.tName.text=this.data.name||"",this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(AwardRankItem.prototype,"AwardRankItem");var QdChizhi=function(t){function e(){var e=t.call(this,"chuizi")||this;return e._timer=0,e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.show=function(t,e,i,s,o,n){this._endCb=o,this._hitCb=s,this._cbThis=n,this.x=t,this.y=e,this.parent||i.addChild(this),egret.Tween.removeTweens(this),this.alpha=1,this.play(1,this.onPlayEnd,this),this._timer=egret.setTimeout(this.onHit,this,250)},e.prototype.onHit=function(){this._timer=0,this._hitCb&&this._hitCb.call(this._cbThis,this)},e.prototype.isPlaying=function(){return this._endCb?!0:!1},e.prototype.onPlayEnd=function(){egret.Tween.get(this).to({alpha:0},200).call(this.hideEnd,this)},e.prototype.hideEnd=function(t){void 0===t&&(t=!0),t&&this._endCb&&(this._endCb.call(this._cbThis,this),this._hitCb=null,this._endCb=null,this._cbThis=null),this.parent&&this.parent.removeChild(this)},e.prototype.clear=function(){egret.Tween.removeTweens(this),0!=this._timer&&(egret.clearTimeout(this._timer),this._timer=0),this.hideEnd(!1)},e}(MovieClipEx);__reflect(QdChizhi.prototype,"QdChizhi");var QdComPageItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)),this.dhBtn.label="Claim";var t;t=this.data.hnum>=this.data.cfg.num?TextFormat.setColor(this.data.cfg.num+"/"+this.data.cfg.num,Colors.GREEN):TextFormat.setColor(this.data.hnum+"/"+this.data.cfg.num,Colors.RED),this.ttit.textFlow=TextFormat.parser.parse(this.data.des.replace("%x",t)),3==this.data.state?(this.dhBtn.visible=!1,this.iyld.visible=!0):(this.dhBtn.visible=!0,this.iyld.visible=!1,2==this.data.state?this.data.hdId==QdID.DBCZ?(this.dhBtn.label="Recharge",this.dhBtn.skinName="ComBtnSkinY",Utils.setBtnEnable(this.dhBtn,!0)):Utils.setBtnEnable(this.dhBtn,!1):(this.dhBtn.skinName="ComBtnSkinB",Utils.setBtnEnable(this.dhBtn,!0)))},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(QdComPageItem.prototype,"QdComPageItem");var QdComPageItem2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)),this.dhBtn.label="Redeem",this.itemIcon.source=GmGlobal.mc.itemMgr.getItemSicon(this.data.costItem);var t;t=this.data.hnum>=this.data.cfg.num?this.data.hdId!=QdID.DHSD?TextFormat.setColor(this.data.cfg.num+"/"+this.data.cfg.num,Colors.GREEN):TextFormat.setColor(this.data.hnum+"/"+this.data.cfg.num,Colors.GREEN):TextFormat.setColor(this.data.hnum+"/"+this.data.cfg.num,Colors.RED),this.ttit.textFlow=TextFormat.parser.parse(t);var e=this.data.cnt||0,i=this.data.cfg.cnt-e;this.tcnt.text="Remaining chances:"+i,i>0?Utils.setBtnEnable(this.dhBtn,1==this.data.state?!0:!1):Utils.setBtnEnable(this.dhBtn,!1)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(QdComPageItem2.prototype,"QdComPageItem2");var QdComPageView=function(t){function e(){var e=t.call(this,"QdComPageSkin")||this;return e._hdId=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuntItemSkin",this.itemList.itemRenderer=QdComPageItem},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bPay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this),this._cc.itemCtl.bindItemCallback(10085,this.onJyUpd,this)},e.prototype.rmEvts=function(){this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bPay.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this),this._cc.itemCtl.removeItemCallback(10085,this.onJyUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e)},e.prototype.setHdId=function(t){this._hdId=t;var e=this._mc.qdMgr.getJsonDataId(this._mc.qdMgr.hdType,t);e!=this._jsonId&&this._jsonId>0&&EventBus.rmListener(EventType.M_JUPD+this._jsonId,this.updateList,this),this._jsonId=e,EventBus.addListener(EventType.M_JUPD+this._jsonId,this.updateList,this),t!=QdID.DHSD?(this.itemList.itemRendererSkinName="HuntItemSkin",this.itemList.itemRenderer=QdComPageItem):(this.itemList.itemRendererSkinName="QdComItemSkin",this.itemList.itemRenderer=QdComPageItem2),this._array.removeAll(),this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.setSetBg(),this.setCD(),this.updateList()},e.prototype.setSetBg=function(){var t="hlqd0"+this._hdId+"_jpg";this._bgRes||(this._bgRes=[]),-1==this._bgRes.indexOf(t)&&this._bgRes.push(t),this.bg.source=t},e.prototype.setCD=function(){var t=this._mc.dataMgr.getJData(this._jsonId);if(t){var e=t.data.t-GmGlobal.getServerTime();e>0?CDText.getInstence().addCD(this.tTime,e,"Time Left: ","DD h:m:s","",this.onTimeout,this):this.onTimeout()}},e.prototype.onTimeout=function(){this.tTime.text="Event ended"},e.prototype.onJyUpd=function(){this._hdId==QdID.DHSD&&this.updateList()},e.prototype.updateList=function(){var t=[],e=this._mc.qdMgr.getHdCfg(this._hdId),i=null;i=this._hdId==QdID.DHSD||this._hdId==QdID.LXDL?this._mc.qdMgr.hdType==QdType.KFQD?e.aw1:e.aw2:e.aws;for(var s=this._mc.dataMgr.getJData(this._jsonId).data,o=0;o<i.length;o++){var n=i[o],r={des:e.des,cfg:n,hdId:this._hdId,hnum:s.num||0,state:2};this._hdId==QdID.DHSD?(r.hnum=this._mc.itemMgr.getItemNum(e.itemid),r.items=n.items,r.costItem=e.itemid):this._hdId==QdID.LXDL?r.items=n.items:r.items=this._mc.qdMgr.hdType==QdType.KFQD?n.items1:n.items2,s.lst&&s.lst[n.id]?this._hdId==QdID.DHSD?(r.cnt=s.lst[n.id],r.hnum>=n.num&&(r.state=1)):2==s.lst[n.id]?(r.state=3,this._hdId==QdID.DBCZ&&(r.hnum=n.num)):1==s.lst[n.id]&&(r.state=1,this._hdId==QdID.DBCZ&&(r.hnum=n.num)):r.hnum>=n.num&&(r.state=1),t.push(r)}t.sort(function(t,e){return t.state-e.state});for(var o=0;o<t.length;o++)o<this._array.length?this._array.replaceItemAt(t[o],o):this._array.addItem(t[o])},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;if(2==e.state)e.hdId==QdID.DBCZ&&this._cc.pfCtl.pfPay(100*e.cfg.num);else{var i=this._mc.qdMgr.getActionId(this._mc.qdMgr.hdType,this._hdId);if(i){var s=e.cfg.id;this._hdId==QdID.DBCZ&&(s=100*s),GmGlobal.cc.dataCtl.doAction(i,[s])}}}},e.prototype.onPay=function(){CmdBus.doCmd(CmdType.O_SHOP)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){this.clearItems(),CDText.getInstence().rmCD(this.tTime),this._jsonId&&(EventBus.rmListener(EventType.M_JUPD+this._jsonId,this.updateList,this),this._jsonId=0),t.prototype.close.call(this)},e.prototype.destroy=function(){if(t.prototype.destroy.call(this),this._mc=null,this._cc=null,this._bgRes){for(var e=0,i=this._bgRes;e<i.length;e++){var s=i[e];RES.destroyRes(s)}this._bgRes=null}},e}(UIBase);__reflect(QdComPageView.prototype,"QdComPageView");var QdController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.QD_LJXH,this.onLjxh,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_LJXH,this.onLjxh,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_LJCZ,this.onLjcz,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_LJCZ,this.onLjcz,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_LXDL,this.onLxdl,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_LXDL,this.onLxdl,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_DBCZ,this.onDbcz,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_DBCZ,this.onDbcz,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_DHSD,this.onDhsd,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_DHSD,this.onDhsd,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_DDS,this.onDds,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_DDS_D,this.onQdDdsData,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_DDS_D,this.onKfQdDdsData,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_SMSD,this.onSmsd,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_SMSD_LST,this.onQdSmsdList,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_SMSD_LST,this.onKfQdSmsdList,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_ZCD,this.onZcd,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_ZCD,this.onZcd,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_LHJ,this.onLhj,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_LHJ,this.onLhj,this),EventBus.addListener(EventType.M_JUPD+JsonID.QD_LHJ_JFAW,this.onLhjJf,this),EventBus.addListener(EventType.M_JUPD+JsonID.KFQD_LHJ_JFAW,this.onLhjJf,this),GmGlobal.cc.itemCtl.bindItemCallback(10085,this.onJyUpd,this),GmGlobal.cc.itemCtl.bindItemCallback(10086,this.onMgUpd,this),GmGlobal.cc.itemCtl.bindItemCallback(10087,this.updateZcdRdotByItem,this)}return t.prototype.onJyUpd=function(){var t=GmGlobal.mc;t.qdMgr.hdType==QdType.KFQD?this.updateComRedDot(QdID.DHSD,t.dataMgr.getJData(JsonID.KFQD_DHSD).data,QdType.KFQD):this.updateComRedDot(QdID.DHSD,t.dataMgr.getJData(JsonID.QD_DHSD).data,QdType.HLQD)},t.prototype.onMgUpd=function(){var t=GmGlobal.mc;t.qdMgr.hdType==QdType.KFQD?this.updateSmsdReddot(t.dataMgr.getJData(JsonID.KFQD_SMSD_LST).data,QdType.KFQD):this.updateSmsdReddot(t.dataMgr.getJData(JsonID.QD_SMSD_LST).data,QdType.HLQD)},t.prototype.onLjxh=function(t){var e=t.data;e.id==JsonID.QD_LJXH?(this.updateHdList(),this.updateComRedDot(QdID.LJXH,e.data,QdType.HLQD)):(this.updateKFHdList(),this.updateComRedDot(QdID.LJXH,e.data,QdType.KFQD))},t.prototype.onLjcz=function(t){var e=t.data;e.id==JsonID.QD_LJCZ?(this.updateHdList(),this.updateComRedDot(QdID.LJCZ,e.data,QdType.HLQD)):(this.updateKFHdList(),this.updateComRedDot(QdID.LJCZ,e.data,QdType.KFQD))},t.prototype.onLxdl=function(t){var e=t.data;e.id==JsonID.QD_LXDL?(this.updateHdList(),this.updateComRedDot(QdID.LXDL,e.data,QdType.HLQD)):(this.updateKFHdList(),this.updateComRedDot(QdID.LXDL,e.data,QdType.KFQD))},t.prototype.onDbcz=function(t){var e=t.data;e.id==JsonID.QD_DBCZ?(this.updateHdList(),this.updateComRedDot(QdID.DBCZ,e.data,QdType.HLQD)):(this.updateKFHdList(),this.updateComRedDot(QdID.DBCZ,e.data,QdType.KFQD))},t.prototype.onDhsd=function(t){var e=t.data;e.id==JsonID.QD_DHSD?(this.updateHdList(),this.updateComRedDot(QdID.DHSD,e.data,QdType.HLQD)):(this.updateKFHdList(),this.updateComRedDot(QdID.DHSD,e.data,QdType.KFQD))},t.prototype.onDds=function(t){var e=t.data;e.id==JsonID.QD_DHSD?this.updateHdList():this.updateKFHdList()},t.prototype.onSmsd=function(t){var e=t.data;e.id==JsonID.QD_DHSD?this.updateHdList():this.updateKFHdList()},t.prototype.onZcd=function(t){var e=t.data;e.id==JsonID.QD_DHSD?(this.updateHdList(),this.updateZcdReddot(e.data,QdType.HLQD)):(this.updateKFHdList(),this.updateZcdReddot(e.data,QdType.KFQD))},t.prototype.onLhj=function(t){var e=t.data;e.id==JsonID.QD_DHSD?this.updateHdList():this.updateKFHdList()},t.prototype.onLhjJf=function(t){var e=t.data;e.id==JsonID.QD_LHJ_JFAW?this.updateLhjRdot(e.data,QdType.HLQD):this.updateLhjRdot(e.data,QdType.KFQD)},t.prototype.onQdSmsdList=function(t){this.updateSmsdReddot(t.data.data,QdType.HLQD)},t.prototype.onKfQdSmsdList=function(t){this.updateSmsdReddot(t.data.data,QdType.KFQD)},t.prototype.onQdDdsData=function(t){this.updateDdsReddot(t.data.data,QdType.HLQD)},t.prototype.onKfQdDdsData=function(t){this.updateDdsReddot(t.data.data,QdType.KFQD)},t.prototype.updateHdList=function(t){void 0===t&&(t=!0);for(var e=GmGlobal.mc,i=[],s=1;9>=s;s++){var o=e.qdMgr.getJsonDataId(QdType.HLQD,s);if(o){var n=e.dataMgr.getJData(o).data;this.isOpen(n)&&i.push(s)}}e.qdMgr.hdList=i,e.qdMgr.hdType!=QdType.KFQD&&i.length>0&&(e.qdMgr.hdType=QdType.HLQD),t&&EventBus.dispatchEvt(EventType.QD_HDLIST)},t.prototype.updateKFHdList=function(t){void 0===t&&(t=!0);for(var e=GmGlobal.mc,i=[],s=1;9>=s;s++){var o=e.qdMgr.getJsonDataId(QdType.KFQD,s);if(o){var n=e.dataMgr.getJData(o).data;this.isOpen(n)&&i.push(s)}}e.qdMgr.kfhdList=i,i.length>0&&(e.qdMgr.hdType=QdType.KFQD),t&&EventBus.dispatchEvt(EventType.QD_HDLIST)},t.prototype.isOpen=function(t){var e=GmGlobal.getServerTime();return t.t&&t.t>e?!0:!1},t.prototype.updateComRedDot=function(t,e,i){var s=GmGlobal.mc,o=s.qdMgr.getHdCfg(t),n=i==QdType.HLQD?s.qdMgr.redDot:s.qdMgr.kfredDot,r=null;r=t==QdID.DHSD||t==QdID.LXDL?i==QdType.KFQD?o.aw1:o.aw2:o.aws;for(var h=n.getChild(t.toString()),a=0;a<r.length;a++){var l=r[a];if(t==QdID.DBCZ){if(e.lst&&e.lst[l.id]&&1==e.lst[l.id])return void(h.state=1)}else if(t==QdID.DHSD){var c=0;e.lst&&e.lst[l.id]&&(c=e.lst[l.id]);var d=s.itemMgr.getItemNum(o.itemid);if(d>=l.num&&c<l.cnt)return void(h.state=1)}else if(e.num>=l.num&&(!e.lst||!e.lst[l.id]||2!=e.lst[l.id]))return void(h.state=1)}h.state=0},t.prototype.updateSmsdReddot=function(t,e){var i=GmGlobal.mc,s=e==QdType.HLQD?i.qdMgr.redDot:i.qdMgr.kfredDot,o=s.getChild(QdID.SMSD.toString()),n=i.itemMgr.getItemNum(10086),r=i.qdMgr.hdType==QdType.HLQD?i.shopMgr.smsd2:i.shopMgr.smsd1;for(var h in t){var a=t[h],l=r[a.idx-1];if(l&&n>=l.cost.num)return void(o.state=1)}o.state=0},t.prototype.updateDdsReddot=function(t,e){var i=GmGlobal.mc,s=e==QdType.HLQD?i.qdMgr.redDot:i.qdMgr.kfredDot,o=s.getChild(QdID.DDS.toString()),n=t.cnt||0;n?o.state=1:o.state=0},t.prototype.updateZcdReddot=function(t,e){var i=GmGlobal.mc,s=e==QdType.HLQD?i.qdMgr.redDot:i.qdMgr.kfredDot,o=s.getChild(QdID.ZCD.toString()),n=i.qdMgr.getHdCfg(QdID.ZCD);for(var r in t.task){var h=t.task[r];for(var a in h){var l=h[a];n.tasks[a];if(2!=l.s&&0==l.num)return void(o.state=1)}}o.state=0,this.updateZcdRdotByItem()},t.prototype.updateZcdRdotByItem=function(){var t=GmGlobal.mc,e=t.qdMgr.redDot.getChild(QdID.ZCD.toString()),i=t.qdMgr.kfredDot.getChild(QdID.ZCD.toString()),s=t.itemMgr.getItemNum(ItemID.CHUIZI),o=t.qdMgr.getHdCfg(QdID.ZCD),n=o.egglist[1];s>=n.num?(e.state=1,i.state=1):(e.state=0,i.state=0)},t.prototype.updateLhjRdot=function(t,e){for(var i=GmGlobal.mc,s=e==QdType.HLQD?i.qdMgr.redDot:i.qdMgr.kfredDot,o=s.getChild(QdID.LHJ.toString()),n=i.qdMgr.getHdCfg(QdID.LHJ),r=i.qdMgr.hdType==QdType.KFQD?n.jifen1:n.jifen2,h=(t.c||0)*n.cntscore,a=0;a<r.length;a++){var l=r[a];if(h>=l.jf&&(!t.lst||2!=t.lst[l.id]))return void(o.state=1)}o.state=0},t}();__reflect(QdController.prototype,"QdController");var QdDdsJfRankView=function(t){function e(){var e=t.call(this,"AwardRankSkin")||this;return e._reqTimer=0,e._mc=GmGlobal.mc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="AwardRankItemSkin",this.itemList.itemRenderer=AwardRankItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.scoll.addEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.scoll.removeEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this)},e.prototype.setRankData=function(t,e){this._rankId=t,this._listCfg=e,this.tYq.visible=!0;var i=t==RankID.QD_DDS||t==RankID.KFQD_DDS?200:500;this.tYq.text="Listing Requirement: Points ≥ "+i;var s=0;if(t==RankID.QD_LHJ?s=JsonID.QD_LHJ:t==RankID.KFQD_LHJ&&(s=JsonID.KFQD_LHJ),s){this.endTime.visible=!0;var o=GmGlobal.mc.dataMgr.getJData(s).data;this.endTime.text="Settlement Time："+Utils.formatDate(o.t,"M-D h:m:s")}else this.endTime.visible=!1},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=this._mc.rankMgr.getRank(this._rankId),s=(new Date).getTime();s-6e3>i.cacheTime&&i.clearCache(),i.myRank?this.tMyRank.text=i.myRank.toString():this.tMyRank.text="Unranked",this.updateList(),this.itemList.validateNow(),this.updateRankList()},e.prototype.onScrollChangeEnd=function(t){0!=this._reqTimer&&egret.clearTimeout(this._reqTimer),this._reqTimer=egret.setTimeout(this.updateRankList,this,1e3)},e.prototype.updateRankList=function(){this._reqTimer=0;for(var t=this._mc.rankMgr.getRank(this._rankId),e=[],i=0;i<this.itemList.numChildren;i++){var s=this.itemList.getChildAt(i),o=s.data;if(!o.jf){var n=t.getDataByRank(o.rank);n?(o.jf=n.data,o.name=n.name,this._array.replaceItemAt(o,o.rank-1)):e.push(s.data.rank)}}e.length>0&&GmGlobal.cc.rankCtl.getRankDataBuyList(this._rankId,e,null,this.onRankRet,this)},e.prototype.onRankRet=function(t){for(var e=0;e<this.itemList.numChildren;e++){var i=this.itemList.getChildAt(e),s=i.data;if(!s.jf){var o=t.getDataByRank(s.rank);o&&(s.jf=o.data,s.name=o.name,this._array.replaceItemAt(s,s.rank-1))}}},e.prototype.updateList=function(){for(var t=0;t<this._listCfg.length;t++){var e={rank:t+1,jf:0,items:this._listCfg[t]};null!=this._array.getItemAt(t)?this._array.replaceItemAt(e,t):this._array.addItem(e)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_DDS_AW)},e.prototype.close=function(){this.clearItems(),0!=this._reqTimer&&(egret.clearTimeout(this._reqTimer),this._reqTimer=0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null},e}(UIBase);__reflect(QdDdsJfRankView.prototype,"QdDdsJfRankView");var QdDdsModel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(t,e){this._cb=t,this._cbThis=e,this.touchEnabled=!1,this.alpha=0,this.scaleX=this.scaleY=.1,egret.Tween.get(this).to({alpha:1,scaleX:1,scaleY:1},100).call(this.onShowEnd,this),this._timerId=egret.setTimeout(this.onTimeOut,this,this.t)},e.prototype.onShowEnd=function(){this.touchEnabled=!0},e.prototype.onTimeOut=function(){this._timerId=0,this.hide()},e.prototype.hide=function(){this.touchEnabled=!1,this.stopTimer(),egret.Tween.get(this).to({alpha:0,scaleX:.1,scaleY:.1},100).call(this.onHideEnd,this)},e.prototype.onHideEnd=function(){this._cb&&this._cb.call(this._cbThis,this),this._cb=null,this._cbThis=null},e.prototype.hitRemove=function(){this.touchEnabled=!1,this._hitFlyAction||(this._hitFlyAction=HitFlyAction.create());var t=Math.random()*Math.PI*(Math.random()>=.5?1:-1);this._hitFlyAction.fly(this,t,this.onHitFlyEnd,this)},e.prototype.onHitFlyEnd=function(){this.stopHitFly(),this.onHideEnd()},e.prototype.stopHitFly=function(){this._hitFlyAction&&(this._hitFlyAction.isEnd||this._hitFlyAction.stop(),HitFlyAction.release(this._hitFlyAction),this._hitFlyAction=null,this.rotation=0)},e.prototype.stopTimer=function(){0!=this._timerId&&(egret.clearTimeout(this._timerId),this._timerId=0)},e.prototype.clear=function(){this.stopTimer(),egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this)},e}(eui.Image);__reflect(QdDdsModel.prototype,"QdDdsModel");var QdDdsView=function(t){function e(){var e=t.call(this,"QdDdsSkin")||this;return e._isPlaying=!1,e._cd=0,e._dCd=0,e._cdTimer=0,e._isBomb=!1,e._models={},e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._cfg=this._mc.qdMgr.getHdCfg(QdID.DDS),this.bBuy.iconDisplay.source="sicon_json.sicon_10001",this._jsonId=this._mc.qdMgr.getJsonDataId(this._mc.qdMgr.hdType,QdID.DDS),this._mc.qdMgr.hdType==QdType.HLQD?(this._dataJId=JsonID.QD_DDS_D,this._playdJId=JsonID.QD_DDS_GD,this._hitAction=JsonReqId.QD_DDS,this._leaveAction=JsonReqId.QD_DDS_LEAVE):(this._dataJId=JsonID.KFQD_DDS_D,this._playdJId=JsonID.KFQD_DDS_GD,this._hitAction=JsonReqId.KFQD_DDS,this._leaveAction=JsonReqId.KFQD_DDS_LEAVE)},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),EventBus.addListener(EventType.M_JUPD+this._dataJId,this.onUpd,this),EventBus.addListener(EventType.M_JUPD+this._playdJId,this.onPlay,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.bStart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),EventBus.rmListener(EventType.M_JUPD+this._dataJId,this.onUpd,this),EventBus.rmListener(EventType.M_JUPD+this._playdJId,this.onPlay,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.setPlayState(!1),this.setCD(),this.updateCnt()},e.prototype.setPlayState=function(t){this._isPlaying=t,t?(this.tCD.visible=!0,this.cdBar.visible=!0,this.btnCon.visible=!1,this.tCJf.text="Points：0"):(this.tCD.visible=!1,this.cdBar.visible=!1,this.btnCon.visible=!0,this.tCJf.text="")},e.prototype.onUpd=function(){this.updateCnt()},e.prototype.updateCnt=function(){var t=this._mc.dataMgr.getJData(this._dataJId).data;if(t){var e=t.cnt||0;this.czNum.text=t.cnt||0;var i=t.b||0;0==e&&i<this._cfg.bprice.length?(this.bBuy.visible=!0,this.bBuy.label=this.getBuyCost(i,this._cfg.bprice)+" Purchase"):this.bBuy.visible=!1;var s=this._mc.rankMgr.getRank(this._mc.qdMgr.hdType==QdType.HLQD?RankID.QD_DDS:RankID.KFQD_DDS);s.myRank?this.tRank.text=s.myRank.toString():this.tRank.text="Unranked",this.tJf.text=t.s||0,this._isPlaying?this.tCJf.text="Points："+(t.rs||0):this.tCJf.text=""}},e.prototype.getBuyCost=function(t,e){return t<e.length?e[t]:e[e.length-1]},e.prototype.setCD=function(){var t=this._mc.dataMgr.getJData(this._jsonId);if(t){var e=t.data.t-GmGlobal.getServerTime();e>0?CDText.getInstence().addCD(this.tHdCd,e,"Time Left: ","DD h:m:s","",this.onTimeout,this):this.onTimeout()}else this.onTimeout()},e.prototype.onTimeout=function(){this.tHdCd.text="Event ended"},e.prototype.onPlay=function(){var t=this._mc.dataMgr.getJData(this._playdJId).data;0!=Utils.getObjectLength(t)&&(this.setPlayState(!0),this._dCd=this._cd=this._cfg.oncetime,this.tCD.text=this._cfg.oncetime+"s",this.cdBar.value=this.cdBar.maximum=this._cfg.oncetime,this.showReady())},e.prototype.showReady=function(){this._readView||(this._readView=new ReadyView,this._readView.x=this.width/2,this._readView.y=this.height/2),this._readView.parent||this.addChild(this._readView),this._readView.start("mui_json.zl_",this.doPlay,this)},e.prototype.doPlay=function(){this._readView.clear(),this._readView=null,this._preData=null,this._payData=this._mc.dataMgr.getJData(this._playdJId).data,this._cdTimer=egret.setInterval(this.onTimer,this,1e3),this.checkShowData()},e.prototype.onTimer=function(){this._cd--,this._cd<0&&(this._cd=0),this._dCd--,this.tCD.text=this._cd+"s",this.cdBar.value=this._cd,this._cd<=0?(egret.clearInterval(this._cdTimer),this._cdTimer=0,this.onEnd()):this.checkShowData()},e.prototype.checkShowData=function(){var t=this._payData[this._dCd];t&&this.showItems(this._dCd,t)},e.prototype.showItems=function(t,e){for(var i in e){var s=Number(i);if(!this._models[s]){var o=e[i],n=this.getPos(s),r=new QdDdsModel;r.idx=s,r.sTime=t,r.type=o.mid,r.hCnt=o.hcnt,r.t=o.t,n&&(r.x=n[0],r.y=n[1]),r.source=this.getModelRes(o.mid);var h=this.getModelOffset(o.mid);h&&(r.anchorOffsetX=h[0],r.anchorOffsetY=h[1]),this.addChild(r),this._models[s]=r,r.show(this.onModelHide,this),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchModel,this)}}},e.prototype.getModelView=function(){return this._modelPool&&this._modelPool.length>0?this._modelPool.pop():new QdDdsModel},e.prototype.onModelHide=function(t){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchModel,this),t.parent&&t.parent.removeChild(t),delete this._models[t.idx],this._modelPool?this._modelPool.push(t):this._modelPool=[t]},e.prototype.getCz=function(){return this._czPool&&this._czPool.length>0?this._czPool.pop():new QdChizhi},e.prototype.pushCz=function(t){this._czPool?this._czPool.push(t):this._czPool=[t]},e.prototype.onTouchModel=function(t){if(this._isPlaying){var e=t.target,i=this.getCz();i.target=e,i.show(e.x,e.y-40,this,this.onHit,this.onCzPlayEnd,this)}},e.prototype.onHit=function(t){var e=t.target;if(e.parent&&!(e.hCnt<=0)&&e.hCnt>0){e.hCnt--,0==e.hCnt&&(this._cc.dataCtl.reqJsonData(this._hitAction,[e.sTime,e.idx],this.onHitModelRet,this),4!=e.type&&e.hitRemove());var i=this._cfg.maward[e.type].cd||0;if(this._cd+=i,0>i&&Horselamp.showVText(TextFormat.setColor("CD ",16777215)+i,null),4==e.type){this.clearTimer(),this.removeAllModel(),this._isBomb=!0;var s=this.getBombEffect();s.x=e.x,s.y=e.y,this.addChild(s),s.play(1,this.onBombEnd,this)}}},e.prototype.onCzPlayEnd=function(t){this.pushCz(t)},e.prototype.onHitModelRet=function(t){for(var e in t){var i=t[e];if(this._preData&&this._preData[e]&&(i-=this._preData[e]),0!=i)if("0"==e)Horselamp.showVText(TextFormat.setColor("Points ",16777215)+(i>0?"+":"")+i,null);else{var s=Number(e),o=GmGlobal.mc.itemMgr.getItemCfg(s);if(o){var n=TextFormat.setColor(o.name,Utils.getQualityColor(o.quality))+" *"+i,r=GmGlobal.mc.itemMgr.getItemIcon(s);Horselamp.showVText(n,r)}}}this._preData=t},e.prototype.onBombEnd=function(){this._bombEffect.parent.removeChild(this._bombEffect),this._isBomb=!1,this.onEnd()},e.prototype.removeAllModel=function(){for(var t in this._models){var e=this._models[t];e.hide()}},e.prototype.getPos=function(t){switch(t){case 1:return[123,495];case 2:return[330,495];case 3:return[540,495];case 4:return[123,668];case 5:return[330,668];case 6:return[540,668];case 7:return[123,845];case 8:return[330,845];case 9:return[540,845];default:return null}},e.prototype.getModelRes=function(t){switch(t){case 1:return"hlqd_json.dds_m1";case 2:return"hlqd_json.dds_m2";case 3:return"hlqd_json.dds_bx";case 4:return"hlqd_json.dds_zd";default:return null}},e.prototype.getModelOffset=function(t){switch(t){case 1:return[32,50];case 2:return[37,68];case 3:return[55,90];case 4:return[36,65];default:return null}},e.prototype.getBombEffect=function(){return this._bombEffect||(this._bombEffect=new MovieClipEx("zhadan")),this._bombEffect},e.prototype.onEnd=function(){this._isPlaying=!1,this._isBomb||this._cc.dataCtl.reqJsonData(this._hitAction,[0],this.onEndRet,this)},e.prototype.onEndRet=function(t){var e=[];for(var i in t)"0"!=i&&e.push({id:Number(i),num:t[i]});if(e.length>0){var s=BattleWinView.getInstence();s.updateList(e,-1),s.show(GmGlobal.vmc.uiLayer)}this.setPlayState(!1)},e.prototype.onRule=function(){var t=this._mc.qdMgr.getHdCfg(QdID.DDS);CmdBus.doCmd(CmdType.O_RULE,t.rule)},e.prototype.onAw=function(){var t=this._mc.qdMgr.getHdCfg(QdID.DDS);CmdBus.doCmd(CmdType.O_DDS_AW,this._mc.qdMgr.hdType==QdType.HLQD?RankID.QD_DDS:RankID.KFQD_DDS,this._mc.qdMgr.hdType==QdType.HLQD?t.rankaw2:t.rankaw1)},e.prototype.onBuy=function(){this._cc.dataCtl.doAction(this._mc.qdMgr.hdType==QdType.HLQD?ServerActionId.QD_DDS_BUY:ServerActionId.KFQD_DDS_BUY,null,this.onBuyOk,this)},e.prototype.onBuyOk=function(){},e.prototype.onStart=function(){this._cc.dataCtl.doAction(this._mc.qdMgr.hdType==QdType.HLQD?ServerActionId.QD_DDS_START:ServerActionId.KFQD_DDS_START,null,this.onStartOk,this)},e.prototype.onStartOk=function(){},e.prototype.clearTimer=function(){0!=this._cdTimer&&(egret.clearInterval(this._cdTimer),this._cdTimer=0)},e.prototype.clearModels=function(){for(var t in this._models){var e=this._models[t];e.clear(),delete this._models[t]}if(this._modelPool){for(var i=0,s=this._modelPool;i<s.length;i++){var e=s[i];e.clear()}this._modelPool=null}},e.prototype.clearCz=function(){if(this._czList){for(var t=0,e=this._czList;t<e.length;t++){var i=e[t];i.clear()}this._czList=null}if(this._czPool){for(var s=0,o=this._czPool;s<o.length;s++){var i=o[s];i.clear()}this._czPool=null}},e.prototype.close=function(){CDText.getInstence().rmCD(this.tHdCd),this._readView&&(this._readView.clear(),this._readView=null),this.clearTimer(),this.clearModels(),this._isPlaying&&(this._isPlaying=!1,this._cc.dataCtl.reqJsonData(this._leaveAction,null)),this._bombEffect&&(this._bombEffect.clear(),this._bombEffect=null),this.clearCz(),this._isBomb=!1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._cfg=null,this._mc=null,this._cc=null,RES.destroyRes("ddsbg_jpg")},e}(UIBase);__reflect(QdDdsView.prototype,"QdDdsView");var QdLhjDhView=function(t){function e(){return t.call(this,"QdLhjDhSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="QdSmsdItemSkin",this.itemList.itemRenderer=QdSmsdItem,this._jsonId=GmGlobal.mc.qdMgr.hdType==QdType.HLQD?JsonID.QD_LHJ_DH:JsonID.KFQD_LHJ_DH},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bCg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),GmGlobal.cc.itemCtl.bindItemCallback(10088,this.updateCnt,this),EventBus.addListener(EventType.M_JUPD+this._jsonId,this.updateList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bCg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),GmGlobal.cc.itemCtl.removeItemCallback(10088,this.updateCnt,this),EventBus.rmListener(EventType.M_JUPD+this._jsonId,this.updateList,this)
},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateCnt(),this.updateList()},e.prototype.updateCnt=function(){this.tNum.text=GmGlobal.mc.itemMgr.getItemNum(10088).toString()},e.prototype.updateList=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(t.qdMgr.hdType==QdType.HLQD?JsonID.QD_LHJ_DH:JsonID.KFQD_LHJ_DH).data,i=t.qdMgr.hdType==QdType.HLQD?t.shopMgr.lhjDh2:t.shopMgr.lhjDh1,s=0;for(var o in e){var n=e[o],r={cfg:i[n.idx-1],cnt:n.cnt};s<this._array.length?this._array.replaceItemAt(r,s):this._array.addItem(r),s++}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;if(0==e.cnt)return void MsgBox.prompt("Sold out");e.cfg&&GmGlobal.cc.itemCtl.reqBuyItem(e.cfg.item.id,e.cfg.item.num,e.cfg.cost.id,null)}},e.prototype.onChange=function(){var t=GmGlobal.mc.qdMgr.getHdCfg(QdID.LHJ);MsgBox.confirm("Spend "+t.rprice+" Crystals to refresh rewards?",this.onOk,null,this)},e.prototype.onOk=function(){var t=GmGlobal.mc;GmGlobal.cc.dataCtl.doAction(t.qdMgr.hdType==QdType.HLQD?ServerActionId.QD_LHJ_RDH:ServerActionId.KFQD_LHJ_RDH),Utils.lockBtn(this.bCg,5e3,!0)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LHJ_DH)},e}(UIBase);__reflect(QdLhjDhView.prototype,"QdLhjDhView");var QdLhjJfAw=function(t){function e(){return t.call(this,"ArenaJfAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="JifenAwItemSkin",this.itemList.itemRenderer=JifenAwItem,this.tTit.text="Points Reward",this.jfTitle.text="My Points:",this._jsonId=GmGlobal.mc.qdMgr.hdType==QdType.HLQD?JsonID.QD_LHJ_JFAW:JsonID.KFQD_LHJ_JFAW},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_JUPD+this._jsonId,this.updateAwList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_JUPD+this._jsonId,this.updateAwList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.updateAwList()},e.prototype.updateAwList=function(){var t=GmGlobal.mc,e=t.qdMgr.getHdCfg(QdID.LHJ),i=t.dataMgr.getJData(t.qdMgr.hdType==QdType.KFQD?JsonID.KFQD_LHJ_JFAW:JsonID.QD_LHJ_JFAW).data,s=(i.c||0)*e.cntscore;this.tJifen.text=s.toString();for(var o=t.qdMgr.hdType==QdType.KFQD?e.jifen1:e.jifen2,n=0;n<o.length;n++){var r=o[n],h={idx:r.id,cfg:r,state:r.jf>s?0:i.lst&&i.lst[r.id]>0?2:1,isLast:n==o.length-1?!0:!1};null!=this._array.getItemAt(n)?this._array.replaceItemAt(h,n):this._array.addItem(h)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data.idx;GmGlobal.cc.dataCtl.doAction(GmGlobal.mc.qdMgr.hdType==QdType.KFQD?ServerActionId.KFQD_LHJ_JFAW:ServerActionId.QD_LHJ_JFAW,[e])}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LHJ_JFAW)},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(QdLhjJfAw.prototype,"QdLhjJfAw");var QdLhjRule=function(t){function e(){return t.call(this,"QdLhjRuleSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="QdLhjRuleItemSkin",this.itemList.itemRenderer=QdLhjRuleItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);for(var i=GmGlobal.mc,s=i.qdMgr.getHdCfg(QdID.LHJ),o=i.qdMgr.hdType==QdType.HLQD?s.rule2:s.rule1,n=0;n<o.length;n++)n<this._array.length?this._array.replaceItemAt(o[n],n):this._array.addItem(o[n]);this.tSm.text="Extra "+s.cntscore+" points per draw"},e.prototype.onTouchList=function(t){if("icon"==t.target.name){var e=t.target.parent.data;ItemTips.show(e.items[0].id,t.stageX,t.stageY)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LHJ_RULE)},e}(UIBase);__reflect(QdLhjRule.prototype,"QdLhjRule");var QdLhjRuleItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=GmGlobal.mc;this.icon.source=t.itemMgr.getItemIcon(this.data.items[0].id),this.iconK.source=t.itemMgr.getItemIconK(this.data.items[0].id),this.numTxt.text=this.data.items[0].num;for(var e=1,i=1;3>=i;i++){var s=this.data.n[i]||0;if(s)for(var o=0;s>o;o++)this["t"+e].source="hlqd_json.lhj_t_"+i,e++}},e}(eui.ItemRenderer);__reflect(QdLhjRuleItem.prototype,"QdLhjRuleItem");var QdLhjView=function(t){function e(){var e=t.call(this,"QdLhjSkin")||this;return e._isUp=!1,e._isShowResult=!0,e._pIdx=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._ch=this._mc.qdMgr.hdType==QdType.HLQD?ChatChannel.LHJ_QD_LOG:ChatChannel.LHJ_KFQD_LOG;for(var e=1;3>=e;e++){var i=new eui.Rect(this.con1.width,this.con1.height,0);this.conGroup.addChild(i);var s=this["con"+e];i.x=s.x,i.y=s.y,s.mask=i,this.initItems(s)}this._tween1={y:0},this._tween2={y:0},this._tween3={y:0}},e.prototype.initItems=function(t){for(var e=0;5>e;e++){var i=e%3+1,s=new eui.Image("hlqd_json.lhj_t_"+i);s.y=166*-e+30,t.addChild(s)}},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bJf.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJfAw,this),this.bDh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDh,this),this.bBd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJfRank,this),this.bOnce.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOnceBegin,this),this.bTen.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTenBegin,this),this.bOnce.addEventListener(egret.TouchEvent.TOUCH_END,this.onOnceEnd,this),this.bTen.addEventListener(egret.TouchEvent.TOUCH_END,this.onTenEnd,this),EventBus.addListener(EventType.M_CHATMSG_UPD,this.updTxt,this),EventBus.addListener(EventType.M_CHATMSG_INIT,this.onLogInit,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bJf.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJfAw,this),this.bDh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDh,this),this.bBd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJfRank,this),this.bOnce.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOnceBegin,this),this.bTen.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTenBegin,this),this.bOnce.removeEventListener(egret.TouchEvent.TOUCH_END,this.onOnceEnd,this),this.bTen.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTenEnd,this),EventBus.rmListener(EventType.M_CHATMSG_UPD,this.updTxt,this),EventBus.rmListener(EventType.M_CHATMSG_INIT,this.onLogInit,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.setCD();var i=this._mc.qdMgr.getHdCfg(QdID.LHJ);this.onePrice.text=i.oneprice,this.tenPrice.text=i.tenprice,this._mc.qdMgr.isLogInit?this.updTxt(null):this._cc.chatCtl.reqChatLog(this._ch,10),this.randomShow()},e.prototype.randomShow=function(){for(var t=1;3>=t;t++){var e=Math.floor(3*Math.random()),i=this["con"+t];i.y=166*e}},e.prototype.setCD=function(){var t=this._mc.qdMgr.getJsonDataId(this._mc.qdMgr.hdType,QdID.LHJ),e=this._mc.dataMgr.getJData(t);if(e){var i=e.data.t-GmGlobal.getServerTime();i>0?CDText.getInstence().addCD(this.tHdCd,i,"Time Left: ","DD h:m:s","",this.onTimeout,this):this.onTimeout()}else this.onTimeout()},e.prototype.onTimeout=function(){this.tHdCd.text="Event ended"},e.prototype.onLogInit=function(t){var e=t.data;e==this._ch&&(this._mc.qdMgr.isLogInit=!0,this.updTxt(null))},e.prototype.updTxt=function(t){if(void 0===t&&(t=null),this._isShowResult){if(t){var e=t.data;if(e.ch!=this._ch)return}var i=this._mc.chatMgr.getChatMsg(this._ch),s="";for(var o in i){var n=i[o];""!=s&&(s+="\n"),s+=n.content}s=Utils.replaceColorCode(s),this.txt.textFlow=TextFormat.parser.parser(s),this.txt.height>=this.scoll.height&&(this.scoll.viewport.scrollV=this.txt.height-this.scoll.height+5)}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_LHJ_RULE)},e.prototype.onJfAw=function(){CmdBus.doCmd(CmdType.O_LHJ_JFAW)},e.prototype.onDh=function(){CmdBus.doCmd(CmdType.O_LHJ_DH)},e.prototype.onJfRank=function(){var t=this._mc.qdMgr.getHdCfg(QdID.LHJ);CmdBus.doCmd(CmdType.O_DDS_AW,this._mc.qdMgr.hdType==QdType.HLQD?RankID.QD_LHJ:RankID.KFQD_LHJ,this._mc.qdMgr.hdType==QdType.HLQD?t.rankaw2:t.rankaw1)},e.prototype.checkCost=function(t){var e=this._mc.qdMgr.getHdCfg(QdID.LHJ),i=this._mc.itemMgr.getItemNum(ItemID.DIAMOND);return 1==t?i>=e.oneprice:i>=e.tenprice},e.prototype.onOnceBegin=function(){return this.checkCost(1)?(this.bOnce.source="hlqd_json.lhj_b1",this.tOne.y=759,this._isUp=!1,this._cjData=null,void this.onCj()):void ItemLackTips.instance().diamondTips()},e.prototype.onTenBegin=function(){return this.checkCost(10)?(this.bTen.source="hlqd_json.lhj_b1",this.tTen.y=759,this._isUp=!1,this._cjData=null,void this.onCj(10)):void ItemLackTips.instance().diamondTips()},e.prototype.onOnceEnd=function(){this.bOnce.source="hlqd_json.lhj_b2",this.tOne.y=751,this._isUp=!0,this.checkData()},e.prototype.onTenEnd=function(){this.bTen.source="hlqd_json.lhj_b2",this.tTen.y=751,this._isUp=!0,this.checkData()},e.prototype.onCj=function(t){void 0===t&&(t=1),this._isShowResult=!1;var e=this._mc.qdMgr.hdType==QdType.HLQD?JsonReqId.QD_LHJ_CJ:JsonReqId.KFQD_LHJ_CJ;this._cc.dataCtl.reqJsonData(e,[t],this.onCjRet,this)},e.prototype.onCjRet=function(t){this._cjData=t,this.checkData()},e.prototype.checkData=function(){this._isUp&&this._cjData&&(this.updateResult(),this._pIdx=0,this.parent.touchEnabled=!1,this.parent.touchChildren=!1,this.showIdx())},e.prototype.showIdx=function(){this._cResult=this._resultList[this._pIdx],this.sTween1(),egret.setTimeout(this.sTween2,this,200),egret.setTimeout(this.sTween3,this,400)},e.prototype.updateResult=function(){var t=[];for(var e in this._cjData){var i=Number(e),s=(this._cjData[e],this.getAwCfgByItem(i-1));if(s){for(var o=[],n=1;3>=n;n++){var r=s.n[n]||0;if(r)for(var h=0;r>h;h++)o.push(n)}for(var a=Utils.getRandomIndexArray(3),l=[],c=0;c<a.length;c++)l.push(o[a[c]]);t.push(l)}}for(var d=Utils.getRandomIndexArray(t.length),p=[],c=0;c<d.length;c++)p.push(t[d[c]]);this._resultList=p},e.prototype.sTween1=function(){this._tween1.y=this.con1.y;var t=this.getTweenPos(this._tween1.y,this._cResult[0]),e=Math.floor(3/1494*t*1e3);egret.Tween.get(this._tween1,{onChange:this.onTween1Change,onChangeObj:this}).to({y:t},e,egret.Ease.quartInOut)},e.prototype.sTween2=function(){this._tween2.y=this.con2.y;var t=this.getTweenPos(this._tween2.y,this._cResult[1]),e=Math.floor(3/1494*t*1e3);egret.Tween.get(this._tween2,{onChange:this.onTween2Change,onChangeObj:this}).to({y:t},e,egret.Ease.quartInOut)},e.prototype.sTween3=function(){this._tween3.y=this.con3.y;var t=this.getTweenPos(this._tween3.y,this._cResult[2]),e=Math.floor(3/1494*t*1e3);egret.Tween.get(this._tween3,{onChange:this.onTween3Change,onChangeObj:this}).to({y:t},e,egret.Ease.quartInOut).call(this.onTweeComplate,this)},e.prototype.getTweenPos=function(t,e){var i=t+1494,s=Math.floor(i%498/166),o=e-1;return o>s?i+=166*(o-s):s>o&&(i+=166*(3-s+o)),i},e.prototype.onTween1Change=function(){this.con1.y=this._tween1.y%498},e.prototype.onTween2Change=function(){this.con2.y=this._tween2.y%498},e.prototype.onTween3Change=function(){this.con3.y=this._tween3.y%498},e.prototype.onTweeComplate=function(){this._pIdx++,egret.setTimeout(this.showResult,this,1e3)},e.prototype.showResult=function(){this._isShowResult=!0,this.parent.touchEnabled=!0,this.parent.touchChildren=!0,this.showAw(),this.updTxt(null)},e.prototype.getAwCfgByItem=function(t){var e=this._mc.qdMgr.getHdCfg(QdID.LHJ),i=this._mc.qdMgr.hdType==QdType.HLQD?e.rule2:e.rule1;return t<i.length?i[t]:null},e.prototype.showAw=function(){var t=[];for(var e in this._cjData){var i=Number(e),s=this._cjData[e],o=this.getAwCfgByItem(i-1);if(o)for(var n=o.items[0].num,r=0;s>r;r++)t.push({id:o.items[0].id,num:n})}if(t.length>0){var h=BattleWinView.getInstence();h.updateList(t,-1),h.show(GmGlobal.vmc.uiLayer)}},e.prototype.close=function(){CDText.getInstence().rmCD(this.tHdCd),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,this._cc=null,RES.destroyRes("qd_lhj_bg_jpg")},e}(UIBase);__reflect(QdLhjView.prototype,"QdLhjView");var QdID;!function(t){t[t.LJXH=1]="LJXH",t[t.LJCZ=2]="LJCZ",t[t.LXDL=3]="LXDL",t[t.DBCZ=4]="DBCZ",t[t.DHSD=5]="DHSD",t[t.DDS=6]="DDS",t[t.ZCD=7]="ZCD",t[t.SMSD=8]="SMSD",t[t.LHJ=9]="LHJ"}(QdID||(QdID={}));var QdType;!function(t){t[t.KFQD=1]="KFQD",t[t.HLQD=2]="HLQD"}(QdType||(QdType={}));var QdManager=function(){function t(){this.hdType=0,this.isLogInit=!1,GmGlobal.mc.regUnzipCfg("c_happycelebration.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this.cfg=t;var e={};for(var i in t)e[i]=0;this.redDot=RedDot.initRedDot(e),GmGlobal.mc.muiMgr.regRedDot(ModelID.HLQD,this.redDot),this.kfredDot=RedDot.initRedDot(e),GmGlobal.mc.muiMgr.regRedDot(ModelID.KFQD,this.kfredDot)},t.prototype.getHdList=function(){return this.hdType==QdType.KFQD?this.kfhdList:this.hdList},t.prototype.getRedDot=function(){return this.hdType==QdType.KFQD?this.kfredDot:this.redDot},t.prototype.getHdCfg=function(t){return this.cfg[t]},t.prototype.getJsonDataId=function(t,e){if(t==QdType.HLQD)switch(e){case QdID.LJXH:return JsonID.QD_LJXH;case QdID.LJCZ:return JsonID.QD_LJCZ;case QdID.LXDL:return JsonID.QD_LXDL;case QdID.DBCZ:return JsonID.QD_DBCZ;case QdID.DHSD:return JsonID.QD_DHSD;case QdID.DDS:return JsonID.QD_DDS;case QdID.SMSD:return JsonID.QD_SMSD;case QdID.ZCD:return JsonID.QD_ZCD;case QdID.LHJ:return JsonID.QD_LHJ;default:return 0}else switch(e){case QdID.LJXH:return JsonID.KFQD_LJXH;case QdID.LJCZ:return JsonID.KFQD_LJCZ;case QdID.LXDL:return JsonID.KFQD_LXDL;case QdID.DBCZ:return JsonID.KFQD_DBCZ;case QdID.DHSD:return JsonID.KFQD_DHSD;case QdID.DDS:return JsonID.KFQD_DDS;case QdID.SMSD:return JsonID.KFQD_SMSD;case QdID.ZCD:return JsonID.KFQD_ZCD;case QdID.LHJ:return JsonID.KFQD_LHJ;default:return 0}},t.prototype.getActionId=function(t,e){if(t==QdType.HLQD)switch(e){case QdID.LJXH:return ServerActionId.QD_LJXH;case QdID.LJCZ:return ServerActionId.QD_LJCZ;case QdID.LXDL:return ServerActionId.QD_LXDL;case QdID.DBCZ:return ServerActionId.QD_DBCZ;case QdID.DHSD:return ServerActionId.QD_DHSD;default:return 0}else switch(e){case QdID.LJXH:return ServerActionId.KFQD_LJXH;case QdID.LJCZ:return ServerActionId.KFQD_LJCZ;case QdID.LXDL:return ServerActionId.KFQD_LXDL;case QdID.DBCZ:return ServerActionId.KFQD_DBCZ;case QdID.DHSD:return ServerActionId.KFQD_DHSD;default:return 0}},t}();__reflect(QdManager.prototype,"QdManager");var QdMediator=function(){function t(){this._isMainUI=!1,GmGlobal.mc.muiMgr.regCmd(ModelID.HLQD,CmdType.O_HLQD),GmGlobal.mc.muiMgr.regCmd(ModelID.KFQD,CmdType.O_HLQD),CmdBus.adListener(CmdType.O_HLQD,this.onOpenView,this),CmdBus.adListener(CmdType.C_HLQD,this.onCloseView,this),CmdBus.adListener(CmdType.O_DDS_AW,this.onOpenDdsAw,this),CmdBus.adListener(CmdType.C_DDS_AW,this.onCloseDdsAw,this),CmdBus.adListener(CmdType.O_ZCD_AW,this.onOpenZcdAw,this),CmdBus.adListener(CmdType.C_ZCD_AW,this.onCloseZcdAw,this),CmdBus.adListener(CmdType.O_LHJ_JFAW,this.onOpenLhjJfAw,this),CmdBus.adListener(CmdType.C_LHJ_JFAW,this.onCloseLhjJfAw,this),CmdBus.adListener(CmdType.O_LHJ_DH,this.onOpenLhjDh,this),CmdBus.adListener(CmdType.C_LHJ_DH,this.onCloseLhjDh,this),CmdBus.adListener(CmdType.O_LHJ_RULE,this.onOpenLhjRule,this),CmdBus.adListener(CmdType.C_LHJ_RULE,this.onCloseLhjRule,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.QD_HDLIST,this.updateIcon,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this._isMainUI=!0,GmGlobal.cc.qdCtl.updateHdList(!1),GmGlobal.cc.qdCtl.updateKFHdList(!1),this.updateIcon()},t.prototype.updateIcon=function(){if(!PFConst.IS_NOPAY){var t=GmGlobal.mc.qdMgr.hdType;t==QdType.KFQD?(CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.KFQD,"mui_json.mui_b_kfqd"),CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.HLQD)):t==QdType.HLQD&&(CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.HLQD,"mui_json.mui_b_hlqd"),CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.KFQD))}},t.prototype.onOpenView=function(){this._view||(this._view=new QdView),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer),this._view.selTab(0)},t.prototype.onCloseView=function(){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.onOpenDdsAw=function(t,e){this._ddsAwView||(this._ddsAwView=new QdDdsJfRankView),this._ddsAwView.setRankData(t,e),this._ddsAwView.isShow||this._ddsAwView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseDdsAw=function(){this._ddsAwView&&this._ddsAwView.isShow&&this._ddsAwView.close()},t.prototype.onOpenZcdAw=function(){this._zcdAwView||(this._zcdAwView=new QdZcdAwView),this._zcdAwView.isShow||this._zcdAwView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseZcdAw=function(){this._zcdAwView&&this._zcdAwView.isShow&&this._zcdAwView.close()},t.prototype.onOpenLhjJfAw=function(){this._lhjJfAw||(this._lhjJfAw=new QdLhjJfAw),this._lhjJfAw.isShow||this._lhjJfAw.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseLhjJfAw=function(){this._lhjJfAw&&this._lhjJfAw.isShow&&this._lhjJfAw.close()},t.prototype.onOpenLhjDh=function(){this._lhjDh||(this._lhjDh=new QdLhjDhView),this._lhjDh.isShow||this._lhjDh.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseLhjDh=function(){this._lhjDh&&this._lhjDh.isShow&&this._lhjDh.close()},t.prototype.onOpenLhjRule=function(){this._lhjRule||(this._lhjRule=new QdLhjRule),this._lhjRule.isShow||this._lhjRule.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseLhjRule=function(){this._lhjRule&&this._lhjRule.isShow&&this._lhjRule.close()},t.prototype.destroy=function(){return this._view?void(this._view&&this._view.isDestroy()&&(this._view.destroy(),this._view=null,this._ddsAwView=null,this._zcdAwView=null,this._lhjJfAw=null,this._lhjDh=null,this._lhjRule=null)):!0},t}();__reflect(QdMediator.prototype,"QdMediator",["IMediator"]);var QdSmsdItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.cfg){var t=GmGlobal.mc.itemMgr;this.bBuy.iconDisplay.source=t.getItemSicon(this.data.cfg.cost.id),this.bBuy.label=this.data.cfg.cost.num,this.item.setItem(this.data.cfg.item),this.item.enableTip(!0)}else this.bBuy.label="0",this.item.setItem(null);this.tCnt.text="Remaining chances："+this.data.cnt,Utils.setBtnEnable(this.bBuy,this.data.cnt>0?!0:!1)},e}(eui.ItemRenderer);__reflect(QdSmsdItem.prototype,"QdSmsdItem");var QdSmsdView=function(t){function e(){var e=t.call(this,"QdSmsdViewSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._jsonId=this._mc.qdMgr.getJsonDataId(this._mc.qdMgr.hdType,QdID.SMSD),this._mc.qdMgr.hdType==QdType.HLQD?this._lstJId=JsonID.QD_SMSD_LST:this._lstJId=JsonID.KFQD_SMSD_LST,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="QdSmsdItemSkin",this.itemList.itemRenderer=QdSmsdItem},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bPay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.addListener(EventType.M_JUPD+this._lstJId,this.updateList,this),this._cc.itemCtl.bindItemCallback(10086,this.updateCnt,this)},e.prototype.rmEvts=function(){this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bPay.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this._cc.itemCtl.removeItemCallback(10086,this.updateCnt,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.setCD(),this.updateCnt(),this.updateList()},e.prototype.setCD=function(){var t=this._mc.dataMgr.getJData(this._jsonId);if(t){var e=t.data.t-GmGlobal.getServerTime();e>0?CDText.getInstence().addCD(this.tTime,e,"Time Left: ","DD h:m:s","",this.onTimeout,this):this.onTimeout()}else this.onTimeout()},e.prototype.onTimeout=function(){this.tTime.text="Event ended"},e.prototype.updateCnt=function(){this.tNum.text=this._mc.itemMgr.getItemNum(10086).toString()},e.prototype.updateList=function(){var t=this._mc.dataMgr.getJData(this._lstJId).data,e=this._mc.qdMgr.hdType==QdType.HLQD?this._mc.shopMgr.smsd2:this._mc.shopMgr.smsd1,i=0;for(var s in t){var o=t[s],n={cfg:e[o.idx-1],cnt:o.cnt};i<this._array.length?this._array.replaceItemAt(n,i):this._array.addItem(n),i++}},e.prototype.onPay=function(){CmdBus.doCmd(CmdType.O_SHOP)},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;e.cfg&&this._cc.itemCtl.reqBuyItem(e.cfg.item.id,e.cfg.item.num,e.cfg.cost.id,null)}},e.prototype.onRule=function(){var t=this._mc.qdMgr.getHdCfg(QdID.SMSD);CmdBus.doCmd(CmdType.O_RULE,t.rule)},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,this._cc=null,RES.destroyRes("qd_smsd_bg_jpg")},e}(UIBase);__reflect(QdSmsdView.prototype,"QdSmsdView");var QdView=function(t){function e(){var e=t.call(this,"QdViewSkin")||this;return e._tabIndex=-1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this._mc=GmGlobal.mc,this._cc=GmGlobal.cc,this._views={}},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.updateTab(),this.tTitle.text=this._mc.qdMgr.hdType==QdType.KFQD?"Server Opening Festival":"Joyful Celebration",this.updateTabRedDot(),this.bindRedDotCb()},e.prototype.updateTab=function(){var t=this._mc.qdMgr.getHdList();this._hdList=t,this._tabNum=t.length;for(var e=0;e<t.length;e++){var i=this._mc.qdMgr.getHdCfg(t[e]);if(i){var s=void 0;this.tableBgCon.numChildren<=e&&(s=new eui.Image("com_json.tab_ui0"),s.width=140,s.height=55,s.scale9Grid=new egret.Rectangle(11,0,2,60),this.tableBgCon.addChild(s));var o=void 0;this.tableTxtCon.numChildren>e?o=this.tableTxtCon.getChildAt(e):(o=new eui.Label,o.width=140,o.height=55,o.size=22,o.textAlign="center",o.verticalAlign="middle",o.strokeColor=10534624,o.stroke=2,this.tableTxtCon.addChild(o)),o.text=i.name}}if(this._tabNum<this.tableBgCon.numChildren)for(;this.tableBgCon.numChildren>this._tabNum;)this.tableBgCon.removeChildAt(this._tabNum),this.tableTxtCon.removeChildAt(this._tabNum);this.tableTxtCon.width=this.tableBgCon.width=140*this._tabNum+10*(this._tabNum-1)+20},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){-1!=this._tabIndex&&this.closePage();this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;t<this._tabNum;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){var t=this._hdList[this._tabIndex];if(t>=1&&5>=t){var e=this._views[1];e||(e=new QdComPageView,this._views[1]=e),e.isShow||e.show(this),e.setHdId(t),this._showView=e}else if(6==t){var e=this._views[t];e||(e=new QdDdsView,this._views[t]=e),e.isShow||e.show(this),this._showView=e}else if(7==t){var e=this._views[t];e||(e=new QdZcdView,this._views[t]=e),e.isShow||e.show(this),this._showView=e}else if(8==t){var e=this._views[t];e||(e=new QdSmsdView,this._views[t]=e),e.isShow||e.show(this),this._showView=e}else if(9==t){var e=this._views[t];e||(e=new QdLhjView,this._views[t]=e),e.isShow||e.show(this),this._showView=e}},e.prototype.closePage=function(){var t=this._hdList[this._tabIndex];if(t>=1&&5>=t){var e=this._views[1];e&&e.close()}else{var e=this._views[t];e&&e.close()}},e.prototype.bindRedDotCb=function(){for(var t=this._mc.qdMgr.getRedDot(),e=0;e<this._tabNum;e++){var i=t.childs[this._hdList[e]];i.bindChangeCB(this.updateTabRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=this._mc.qdMgr.getRedDot(),e=0;e<this._tabNum;e++){var i=t.childs[this._hdList[e]];i.unbindChangeCB(this.updateTabRedDot,this)}},e.prototype.updateTabRedDot=function(){for(var t=this._mc.qdMgr.getRedDot(),e=0;e<this._tabNum;e++){var i=t.childs[this._hdList[e]],s=this.tableBgCon.getChildAt(e);if(1==i.state){var o=140*(e+1)+10*e-20;RedDotView.addRedDot(s,this.tableTxtCon,"hlqd",o,-4)}else RedDotView.removeRedDot(s)}},e.prototype.clearAllPage=function(){for(var t in this._views){var e=this._views[t];e.close(),e.destroy()}this._views=null},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HLQD)},e.prototype.close=function(){RedDotView.removeRedDotByGroup("hlqd"),this.unbindRedDotCb(),this._showView&&this._showView.close(),this._tabIndex=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearAllPage()},e}(UIBase);__reflect(QdView.prototype,"QdView");var QdZcdAwItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!1,!0),this._itemGridCon.addToParent(10,10,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)),this.egg.source="hlqd_json.cd_"+this.data.egg},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(QdZcdAwItem.prototype,"QdZcdAwItem");var QdZcdAwView=function(t){function e(){return t.call(this,"QdZcdAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="QdZcdAwItemSkin",this.itemList.itemRenderer=QdZcdAwItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateList()},e.prototype.updateList=function(){var t=GmGlobal.mc.qdMgr,e=t.getHdCfg(QdID.ZCD),i=0;for(var s in e.egglist){var o=e.egglist[s],n={items:t.hdType==QdType.KFQD?o.items1:o.items2,egg:Number(s)};i<this._array.length?this._array.replaceItemAt(n,i):this._array.addItem(n),i++}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_ZCD_AW)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(QdZcdAwView.prototype,"QdZcdAwView");var QdZcdBuyView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCs=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.QD_CZ_BUY,[this.getCostId(),this.getNum()],this.close,this)},e}(ItemSellView);__reflect(QdZcdBuyView.prototype,"QdZcdBuyView");var QdZcdItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0));var t;t=this.data.hnum>=this.data.num?TextFormat.setColor(this.data.num+"/"+this.data.num,Colors.GREEN):TextFormat.setColor(this.data.hnum+"/"+this.data.num,Colors.RED),this.ttit.textFlow=TextFormat.parser.parse(this.data.des.replace("%x",t)),3==this.data.state?(this.dhBtn.visible=!1,this.iyld.visible=!0):(this.dhBtn.visible=!0,this.iyld.visible=!1,2==this.data.state?Utils.setBtnEnable(this.dhBtn,!1):Utils.setBtnEnable(this.dhBtn,!0))},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(QdZcdItem.prototype,"QdZcdItem");var QdZcdView=function(t){function e(){var e=t.call(this,"QdZcdSkin")||this;return e._playNum=0,e._eggIdx=1,e._activteNum=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._jsonId=this._mc.qdMgr.getJsonDataId(this._mc.qdMgr.hdType,QdID.ZCD),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="QdZcdItemSkin",this.itemList.itemRenderer=QdZcdItem,this.bZd.iconDisplay.source="sicon_json.sicon_10087"},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bZd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZd,this),EventBus.addListener(EventType.M_JUPD+this._jsonId,this.updateList,this),this._cc.itemCtl.bindItemCallback(10087,this.updCnt,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bZd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZd,this),EventBus.rmListener(EventType.M_JUPD+this._jsonId,this.updateList,this),this._cc.itemCtl.removeItemCallback(10087,this.updCnt,this)
},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updCnt(),this.setCD(),this.updateList(),this.updateBtnState(),this.updateBtnCnt()},e.prototype.setCD=function(){var t=this._mc.dataMgr.getJData(this._jsonId);if(t){var e=t.data.t-GmGlobal.getServerTime();e>0?CDText.getInstence().addCD(this.tHdCd,e,"Time Left: ","DD h:m:s","",this.onTimeout,this):this.onTimeout()}else this.onTimeout()},e.prototype.onTimeout=function(){this.tHdCd.text="Event ended"},e.prototype.updCnt=function(){this.tNum.text=this._mc.itemMgr.getItemNum(10087).toString()},e.prototype.updateList=function(){var t=this._mc.dataMgr.getJData(this._jsonId).data;if(t){var e=t.task[this._eggIdx],i=this._mc.qdMgr.getHdCfg(QdID.ZCD),s=0;for(var o in e){var n=e[o],r=i.tasks[o],h={id:Number(o),des:r.des,num:r.num,hnum:Math.max(r.num-n.num,0),items:this._mc.qdMgr.hdType==QdType.KFQD?r.item1:r.item2,state:2};2==n.s?h.state=3:h.hnum>=h.num&&(h.state=1),s<this._array.length?this._array.replaceItemAt(h,s):this._array.addItem(h),s++}for(;this._array.length>s;)this._array.removeItemAt(s);this._activteNum=t.pid||1,this.updateBtnState()}},e.prototype.onLeft=function(){this._eggIdx>1&&(this._eggIdx--,this.updateBtnCnt(),this.updateBtnState(),this.updateList())},e.prototype.onRight=function(){this._eggIdx<this._activteNum&&(this._eggIdx++,this.updateBtnCnt(),this.updateBtnState(),this.updateList())},e.prototype.updateBtnCnt=function(){var t=this._mc.qdMgr.getHdCfg(QdID.ZCD),e=t.egglist[this._eggIdx];e?(this.bZd.label=e.num+" Smash Egg",this._costNum=e.num):this._costNum=1,this.eggIcon.source="hlqd_json.cd_"+this._eggIdx},e.prototype.updateBtnState=function(){this.bLeft.visible=1==this._eggIdx?!1:!0,this.bRight.visible=this._eggIdx==this._activteNum?!1:!0},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_ZCD_AW)},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data,i=this._mc.qdMgr.hdType==QdType.KFQD?ServerActionId.KFQD_ZCD_T:ServerActionId.QD_ZJD_T;this._cc.dataCtl.doAction(i,[e.id,this._eggIdx])}},e.prototype.onZd=function(){var t=this._mc.itemMgr.getItemNum(10087);if(t<this._costNum){this._buyView||(this._buyView=new QdZcdBuyView);var e=this._mc.qdMgr.getHdCfg(QdID.ZCD);return this._buyView.setItem(10087,e.czprice,ItemID.DIAMOND,999),void this._buyView.show(GmGlobal.vmc.uiLayer)}this._czEffect||(this._czEffect=new MovieClipEx("chuizi")),this._czEffect.parent||this.addChild(this._czEffect),this._playNum=0,this.randomAndPaly()},e.prototype.randomAndPaly=function(){var t=this.eggIcon.x+Math.round(3*Math.random())*(Math.random()>=.5?20:-20),e=this.eggIcon.y+Math.round(3*Math.random())*(Math.random()>=.5?20:-20);this._czEffect.x=t,this._czEffect.y=e-30,this._czEffect.play(1,this.onCzPlayEnd,this)},e.prototype.onCzPlayEnd=function(){this._jitter||(this._jitter=new Jitter),this._jitter.start(this.eggIcon,1,0,4,.4),this._playNum++,this._playNum<3?this.randomAndPaly():(this._czEffect.parent.removeChild(this._czEffect),this.doZd())},e.prototype.doZd=function(){var t=this._mc.qdMgr.hdType==QdType.KFQD?JsonReqId.KFQD_ZCD:JsonReqId.QD_ZCD;this._cc.dataCtl.reqJsonData(t,[this._eggIdx],this.onRet,this)},e.prototype.onRet=function(t){var e=[];for(var i in t)"0"!=i&&e.push({id:Number(i),num:t[i]});if(e.length>0){var s=BattleWinView.getInstence();s.updateList(e,-1),s.show(GmGlobal.vmc.uiLayer)}},e.prototype.onRule=function(){var t=this._mc.qdMgr.getHdCfg(QdID.ZCD);CmdBus.doCmd(CmdType.O_RULE,t.rule)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){this.clearItems(),CDText.getInstence().rmCD(this.tHdCd),this._czEffect&&(this._czEffect.clear(),this._czEffect=null),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,this._cc=null,this._buyView&&(this._buyView.close(),this._buyView=null),RES.destroyRes("qd_zcd_bg_jpg")},e}(UIBase);__reflect(QdZcdView.prototype,"QdZcdView");var HuntBuyCkItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.index,this.data.itemDate.award?(this.data.isAward?this.winTxt.text="Winner："+this.data.itemDate.award+"    Won":this.winTxt.text="Winner："+this.data.itemDate.award+"    Lost",this.winTxt.textColor=Colors.GREEN):(this.winTxt.textColor=Colors.RED,this.winTxt.text="Winner：Not drawn"),this.buyTxt.text="Purchase #："+this.data.numStr,this.buyTxt.y+this.buyTxt.height>=260?this.height=this.buyTxt.y+this.buyTxt.height+5:this.height=260},e}(eui.ItemRenderer);__reflect(HuntBuyCkItem.prototype,"HuntBuyCkItem");var HuntBuyCkView=function(t){function e(){var e=t.call(this,"HuntBuyCkSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.viewport=this.itemList,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuntBuyCkItemSkin",this.itemList.itemRenderer=HuntBuyCkItem},e.prototype.updateInfo=function(t){this._index=t,this.refreshUi()},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.refreshUi=function(){var t=this._mc.huntMgr.getPmLogInfos();this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this._array.removeAll();for(var e=0;e<t.length;e++){var i=t[t.length-e-1];if(this._index==i.id&&i){var s="",o=!1;for(var n in i.buy)!o&&i.award>0&&i.award==i.buy[n]&&(o=!0),s+=" "+i.buy[n];var r={itemDate:i,isAward:o,numStr:s};this._array.addItem(r)}}},e.prototype.clearList=function(){this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HUNT_PM_CK)},e.prototype.close=function(){this.clearList(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(HuntBuyCkView.prototype,"HuntBuyCkView");var HuntController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.HUNT_AWD_UPD,this.onUpdInfo,this),EventBus.addListener(EventType.M_JUPD+JsonID.HUNT_PAY,this.onUpdPay,this),EventBus.addListener(EventType.M_JUPD+JsonID.HUNT_TIME_LOG,this.onUpdTimeLog,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.HUNT_TIME_INFO,this.onUpdTimeInfo,this)}return t.prototype.onUpdInfo=function(t){var e=t.data.data,i=GmGlobal.mc.huntMgr;i.awdIds=[];for(var s in e)i.awdIds.push(Number(s));EventBus.dispatchEvt(EventType.HUNT_UPD)},t.prototype.onUpdPay=function(t){var e=t.data.data,i=GmGlobal.mc.huntMgr;i.payInfos=e,EventBus.dispatchEvt(EventType.HUNT_PAY_UPD)},t.prototype.onUpdTimeLog=function(t){var e=t.data.data;GmGlobal.mc.huntMgr.updPmLogInfo(e),EventBus.dispatchEvt(EventType.HUNT_TIME_LOG)},t.prototype.onUpdTimeInfo=function(t){GmGlobal.mc.huntMgr.updPmInfo(t.lst),EventBus.dispatchEvt(EventType.HUNT_TIME_LOG)},t}();__reflect(HuntController.prototype,"HuntController");var HuntItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.cfg.aw,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0));var t=this.data.state;Utils.setBtnEnable(this.dhBtn,!1),this.dhBtn.label="Claim",this.dhBtn.visible=!0,this.iyld.visible=!1;var e=GmGlobal.mc.huntMgr.getDes(),i=this.data.num+"/"+this.data.cfg.id,s=Colors.GREEN;1==t?Utils.setBtnEnable(this.dhBtn,!0):2==t&&(this.dhBtn.label="Claimed",this.iyld.visible=!0,this.dhBtn.visible=!1,i=this.data.cfg.id+"/"+this.data.cfg.id),this.data.num<this.data.cfg.id&&2!=t&&(s=Colors.RED),this.ttit.textFlow=TextFormat.parser.parse(e+TextFormat.setColor(i,s))},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(HuntItem.prototype,"HuntItem");var HuntManager=function(){function t(){this._pmInfos=[],this._pmLogInfos=[],this._pmItemIds=[],GmGlobal.mc.regUnzipCfg("c_hunt.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_hunt_pm.json",this.initPmCfg,this)}return t.prototype.initCfg=function(t){this.rule=t.rule,this.dayMaxNum=t.medaldaynum,this._cfg=t.cfgs},t.prototype.initPmCfg=function(t){this._recharge=t.recharge,this._buyingConfig=t.buy},t.prototype.getDes=function(){return this._cfg.des},t.prototype.getKillLst=function(t){return this._cfg[t]},t.prototype.getRechargeCfgs=function(){return this._recharge},t.prototype.getPmCfg=function(){return this._buyingConfig},t.prototype.updPmInfo=function(t){this._pmInfos=[],this._pmItemIds=[];for(var e in t)this._pmInfos.push(t[e]),this._pmItemIds.push(t[e].id)},t.prototype.getPmInfos=function(){return this._pmInfos},t.prototype.getPmItemIds=function(){return this._pmItemIds},t.prototype.updPmLogInfo=function(t){this._pmLogInfos=[];for(var e in t)this._pmLogInfos.push(t[e])},t.prototype.getPmLogInfos=function(){return this._pmLogInfos},t.prototype.getPmNumById=function(t){for(var e=[],i=0;i<this._pmLogInfos.length;i++){var s=this._pmLogInfos[i];if(s&&t==s.id){var o=s.award;if(!o)for(var n in s.buy)e.push(s.buy[n])}}return e.length},t.prototype.getPmCd=function(){var t=Utils.getTodaySecond()-this._buyingConfig.stime;return new GameTime(this._buyingConfig.backcount-t%this._buyingConfig.backcount)},t}();__reflect(HuntManager.prototype,"HuntManager");var HuntMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.HUNT,CmdType.O_HUNT),CmdBus.adListener(CmdType.O_HUNT,this.onOpenView,this),CmdBus.adListener(CmdType.C_HUNT,this.onCloseView,this),CmdBus.adListener(CmdType.O_HUNT_PM,this.openPm,this),CmdBus.adListener(CmdType.C_HUNT_PM,this.closePm,this),CmdBus.adListener(CmdType.O_HUNT_PAY,this.openPay,this),CmdBus.adListener(CmdType.C_HUNT_PAY,this.closePay,this),CmdBus.adListener(CmdType.O_HUNT_PM_CK,this.openPayCk,this),CmdBus.adListener(CmdType.C_HUNT_PM_CK,this.closePayCk,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.HUNT_UPD,this.updateIcon,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.updateIcon=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.HUNT_UPD).data,e=t.et||0;e-GmGlobal.getServerTime()>0?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.HUNT,"mui_json.mui_b_slj"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.HUNT)},t.prototype.onOpenView=function(t){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new HuntView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.openPm=function(){this._pmView||(this._pmView=new HuntPmView),this._pmView.isShow||this._pmView.show(GmGlobal.vmc.uiLayer)},t.prototype.closePm=function(){this._pmView&&this._pmView.close()},t.prototype.openPay=function(){this._payView||(this._payView=new HuntPayView),this._payView.isShow||this._payView.show(GmGlobal.vmc.uiLayer)},t.prototype.closePay=function(){this._payView&&this._payView.close()},t.prototype.openPayCk=function(t){this._pmLogView||(this._pmLogView=new HuntBuyCkView),this._pmLogView.isShow||this._pmLogView.show(GmGlobal.vmc.uiLayer),this._pmLogView.updateInfo(t)},t.prototype.closePayCk=function(){this._pmLogView&&this._pmLogView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._pmView=null,this._payView=null,this._pmLogView=null,!0):!1:!0},t}();__reflect(HuntMediator.prototype,"HuntMediator",["IMediator"]);var HuntPayItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.cfg;this.icon.source="zsicon_json."+t.icon,this.titTxt.text="Recharge "+t.diamond+" diamonds",this.smTxt.text="Claim "+t.num+" diamond pack x1",1==this.data.stateInfo?(this.bPay.skinName="ComBtnSkinB",this.bPay.label="Claim"):(this.bPay.skinName="ComBtnSkinY",this.bPay.label="Recharge")},e}(eui.ItemRenderer);__reflect(HuntPayItem.prototype,"HuntPayItem");var HuntPayView=function(t){function e(){var e=t.call(this,"HuntPaySkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.viewport=this.itemList,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuntPayItemSkin",this.itemList.itemRenderer=HuntPayItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.updateList()},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),EventBus.addListener(EventType.HUNT_PAY_UPD,this.updateList,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),EventBus.rmListener(EventType.HUNT_PAY_UPD,this.updateList,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){var e=t.target;if(e.parent.parent==this.itemList){var i=e.parent,s=this._mc.huntMgr.getRechargeCfgs(),o=this._mc.huntMgr.payInfos;if(i.index&&"btn"==e.name){var n=s[i.index-1].price,r=s[i.index-1].num,h=Math.round(100*n);o&&null!=o[n]?2==o[n]?this._cc.pfCtl.pfPay(h,r):this._cc.dataCtl.doAction(ServerActionId.HUNT_PAY,[h]):this._cc.pfCtl.pfPay(h,r)}}},e.prototype.updateList=function(){for(var t=this._mc.huntMgr.payInfos,e=this._mc.huntMgr.getRechargeCfgs(),i=0;i<e.length;i++){var s=e[i],o=s.price,n=t?t[o]:0,r={cfg:s,stateInfo:n,index:i+1},h=this._array.getItemAt(i);h?this._array.replaceItemAt(r,i):this._array.addItem(r)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HUNT_PAY)},e.prototype.clearList=function(){this._array.removeAll()},e.prototype.close=function(){this.clearList(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(HuntPayView.prototype,"HuntPayView");var HuntPmItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.index=this.data.index,this.buyTxt.text="Your Purchases: "+this.data.times,this.allTxt.text="Total Purchases:"+this.data.cnt+"/"+this.data.max;var t=GmGlobal.mc.huntMgr.getPmCfg(),e=this.data.price/t.medaltodiamond,i=GmGlobal.mc.itemMgr.getItemNum(ItemID.MVP_MEDAL);i>=e?(this.buyBtn.label=e+" Purchase",this.buyBtn.iconDisplay.source=GmGlobal.mc.itemMgr.getItemSicon(ItemID.MVP_MEDAL)):(this.buyBtn.label=this.data.price+" Purchase",this.buyBtn.iconDisplay.source=GmGlobal.mc.itemMgr.getItemSicon(ItemID.DIAMOND)),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(1,115,!1),this._itemGridCon.addToParent(5,5,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0));new Item(this.data.id,this.data.num);this._itemGridCon.setItems([{id:this.data.id,num:this.data.num}])},e.prototype.clear=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(HuntPmItem.prototype,"HuntPmItem");var HuntPmView=function(t){function e(){var e=t.call(this,"HuntPmSkin")||this;return e._timer=0,e._delayTimer=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuntPmItemSkin",this.itemList.itemRenderer=HuntPmItem,PFConst.IS_NOPAY&&(this.payBg.visible=!1,this.bbuy.visible=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bbuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.HUNT_TIME_LOG,this.refreshUi,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bbuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.HUNT_TIME_LOG,this.refreshUi,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.onDelayReqList(),this.scoll.viewport.scrollV=0},e.prototype.delayReqList=function(t){void 0===t&&(t=1e3),this.clearDelayReqTimer(),this._delayTimer=egret.setInterval(this.onDelayReqList,this,t)},e.prototype.onDelayReqList=function(){var t=this;GmGlobal.cc.dataCtl.pbReq(PbReqId.HUNT_PM_REQ,[],null,function(e,i){GmGlobal.mc.huntMgr.updPmInfo(i.lst),t.refreshUi()})},e.prototype.clearDelayReqTimer=function(){0!=this._delayTimer&&(egret.clearInterval(this._delayTimer),this._delayTimer=0)},e.prototype.onTouchList=function(t){var e=t.target;if(e.parent.parent==this.itemList){var i=e.parent;if(i.index&&"bBuy"==e.name){var s=this._mc.huntMgr.getPmNumById(i.index),o=this._mc.huntMgr.getPmInfos(),n=o[i.index-1];if(!n)return;s>=n.max&&MsgBox.prompt("Limit reached");var r=ItemSellView.getInstance();r.setPmItem(n.price,n.max-n.cnt,i.index),r.show(GmGlobal.vmc.uiLayer)}else i.index&&"bLook"==e.name&&CmdBus.doCmd(CmdType.O_HUNT_PM_CK,[i.index])}},e.prototype.refreshUi=function(){var t=this._mc.huntMgr.getPmInfos();if(t){for(var e=this._mc.huntMgr.getPmCfg().itemNum,i=0;e>i;i++){var s=t[i];if(s){var o=this._mc.huntMgr.getPmNumById(i+1),n=o>=s.max?!1:!0,r={times:o,cnt:s.cnt,max:s.max,price:s.price,id:s.id,num:s.num,isTouch:n,index:i+1},h=this._array.getItemAt(i);h?this._array.replaceItemAt(r,i):this._array.addItem(r)}}this.countDownTimeUi()}},e.prototype.countDownTimeUi=function(){this.clearTimer(),this._countDownTime&&0!=this._countDownTime.cd||(this._countDownTime=this._mc.huntMgr.getPmCd()),this._timer=egret.setInterval(this.onTimer,this,1e3),this.onTimer()},e.prototype.onTimer=function(){this.numTxt.text="Auction Countdown："+Utils.formatTime(this._countDownTime.cd,"h:m:s"),0==this._countDownTime.cd&&(this._countDownTime=this._mc.huntMgr.getPmCd())},e.prototype.clearTimer=function(){0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0)},e.prototype.clearList=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clear()}this._array.removeAll()},e.prototype.onBuy=function(){CmdBus.doCmd(CmdType.O_HUNT_PAY)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HUNT_PM)},e.prototype.close=function(){this.clearTimer(),this.clearList(),this.clearDelayReqTimer(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("hunt_json")},e}(UIBase);__reflect(HuntPmView.prototype,"HuntPmView");var HuntView=function(t){function e(){var e=t.call(this,"HuntSkin")||this;return e._pmState=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuntItemSkin",this.itemList.itemRenderer=HuntItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bpm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPm,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.HUNT_UPD,this.updlst,this),GmGlobal.cc.itemCtl.bindItemCallback(10056,this.updlst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bpm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPm,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.HUNT_UPD,this.updlst,this),GmGlobal.cc.itemCtl.removeItemCallback(10056,this.updlst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.alphaShow(),this.updlst(),this.updateBuyState(),this.updCd()},e.prototype.updCd=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.HUNT_UPD).data,e=t.et||0,i=Math.max(e-GmGlobal.getServerTime(),0);if(i>0){this.tTime.visible=!0;var s="Event Countdown: ";CDText.getInstence().addCD(this.tTime,i,s,i>86400?"DD h:m:s":"h:m:s")}else this.tTime.visible=!1},e.prototype.updlst=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.HUNT_UPD).data,e=GmGlobal.mc.huntMgr.getKillLst(t.id);if(e){var i=GmGlobal.mc.huntMgr.awdIds||[],s=this._mc.itemMgr.getItemNum(ItemID.MVP_MEDAL);this.tnum.text=s.toString();var o=t.medal||0;this.tupNum.text=o+"/"+this._mc.huntMgr.dayMaxNum;for(var n=0;n<e.length;n++){var r=e[n],h=0;-1!=i.indexOf(r.id)?h=2:s>=r.id&&(h=1);var a={cfg:r,num:s,state:h,idx:n+1},l=this._array.getItemAt(n);l?this._array.replaceItemAt(a,n):this._array.addItem(a)}}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data,i=e.cfg.id;this._cc.dataCtl.doAction(ServerActionId.HUNT_AWD,[i])}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.updateBuyState=function(){var t=Utils.getServerTodaySecond(),e=this._mc.huntMgr.getPmCfg();if(t>=e.stime&&t<=e.etime)this._pmState=1,this._pmEedTime||(this._pmEedTime=egret.setTimeout(this.onEndBuyingTime,this,1e3*(e.etime-t)));else{this._pmState=0;var i=void 0;i=t<e.stime?e.stime-t:86400-t+e.stime,this._pmSTime||(this._pmSTime=egret.setTimeout(this.onStartBuyingTime,this,1e3*i))}},e.prototype.onStartBuyingTime=function(){this.clearStartBuyTimer(),this._pmState=1;var t=Utils.getServerTodaySecond(),e=this._mc.huntMgr.getPmCfg();this._pmEedTime||(this._pmEedTime=egret.setTimeout(this.onEndBuyingTime,this,1e3*(e.etime-t)))},e.prototype.onEndBuyingTime=function(){this.clearEndBuyTimer();var t=Utils.getServerTodaySecond(),e=this._mc.huntMgr.getPmCfg();this._pmState=0;var i;i=t<e.stime?e.stime-t:86400-t+e.stime,this._pmSTime||(this._pmSTime=egret.setTimeout(this.onStartBuyingTime,this,1e3*i))},e.prototype.clearStartBuyTimer=function(){0!=this._pmSTime&&(egret.clearTimeout(this._pmSTime),this._pmSTime=0)},e.prototype.clearEndBuyTimer=function(){0!=this._pmEedTime&&(egret.clearTimeout(this._pmEedTime),this._pmEedTime=0)},e.prototype.onPm=function(){if(this._pmState)CmdBus.doCmd(CmdType.O_HUNT_PM);else{var t=this._mc.huntMgr.getPmCfg();MsgBox.prompt("Auction ends in "+Utils.formatTime(t.stime,"h:m")+"-"+Utils.formatTime(t.etime,"h:m")+" Available")}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.huntMgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HUNT)},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),this.clearItems(),this.clearStartBuyTimer(),this.clearEndBuyTimer(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("hunt_json")},e}(UIBase);__reflect(HuntView.prototype,"HuntView");var HuobanController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_HUOB_INFOS,this.onUpdInfos,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_HUOB_INFO,this.onUpdInfo,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_HUOB_ZR,this.onUpdZr,this)}return t.prototype.onUpdInfos=function(t){var e=t.data.data,i=GmGlobal.mc.huobMgr;for(var s in e){var o=e[s],n=Number(s)-1;i.updHbData(n,o)}EventBus.dispatchEvt(EventType.M_HUOB_LST)},t.prototype.onUpdInfo=function(t){var e=t.data.data,i=GmGlobal.mc.huobMgr,s=i.getHbIdx(e.id);i.updHbData(s,e),EventBus.dispatchEvt(EventType.M_HUOB_INFO,s)},t.prototype.onUpdZr=function(t){var e=t.data.data,i=GmGlobal.mc.huobMgr;i.poss=e,EventBus.dispatchEvt(EventType.M_HUOB_ZR)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.huobMgr,e=t.redDot.childs[0],i=0;12>i;i++){var s=t.getHbData(i);if(s&&!Utils.isEmptyObj(s)){var o=t.getCfgById(s.id),n=GmGlobal.mc.itemMgr.getItemNum(o.upid),r=o.upCfgs[s.lv];this.setItemRD(e,o.id,n>=r.num?1:0)}}this.checkItemRD(e.childs)},t.prototype.checkItemRD=function(t){for(var e in t){var i=Number(e),s=t[e];0==GmGlobal.mc.itemMgr.getItemNum(i)&&(s.state=0)}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t}();__reflect(HuobanController.prototype,"HuobanController");var HuobanIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchChildren=!1},e.prototype.dataChanged=function(){this.index=this.data.idx,this.ilk.visible=this.data.sel;var t=GmGlobal.mc.huobMgr.getCfgById(this.data.id);this.iconK.source="item_json.q_"+t.qid,this.icon.source="huobIcon_json."+t.icon;var e=this.data.lv,i=t.upCfgs[e];i||(i=t.upCfgs[e-1]);var s=GmGlobal.mc.itemMgr.getItemNum(t.upid);TextFormat.setMoneyStr(this.numTxt,s,i.num),e?(this.icon.filters=[],this.iconK.filters=[]):(this.icon.filters=FilterUtils.disabled(),this.iconK.filters=FilterUtils.disabled()),this.numTxt.visible=!this.data.isZr},e}(eui.ItemRenderer);__reflect(HuobanIcon.prototype,"HuobanIcon");var HuobanItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="HuobanIconSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchChildren=!1},e}(eui.Component);__reflect(HuobanItem.prototype,"HuobanItem");var HuobanJhView=function(t){function e(){var e=t.call(this,"HuobanJhSkin")||this;return e.touchEnabled=!1,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),egret.startTick(this.onTick,this)},e.prototype.setId=function(t){var e=GmGlobal.mc.huobMgr.getCfgById(t);e&&(this.iconK.source="item_json.q_"+e.qid,this.icon.source="huobIcon_json."+e.icon)},e.prototype.onTick=function(t){return this.lightCon.rotation+=1,!0},e.prototype.close=function(){egret.stopTick(this.onTick,this),t.prototype.close.call(this)},e}(UIBase);__reflect(HuobanJhView.prototype,"HuobanJhView");var HuobanManager=function(){function t(){this.poslst=[],this._infos=[],this.poss={},GmGlobal.mc.regUnzipCfg("c_huoban.json",this.initCfg,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.HUOBAN,this.redDot)}return t.prototype.initCfg=function(t){this.rule=t.rule,this._cfgs=t.cfgs,this.poslst=t.poslst},t.prototype.getCfgById=function(t){return this._cfgs[t]},t.prototype.updHbData=function(t,e){var i=this._infos[t];i||(i=new HuobData),i.id=e.id,i.lv=e.lv,this._infos[t]=i},t.prototype.getHbData=function(t){return this._infos[t]},t.prototype.getHbIdx=function(t){for(var e=0;e<this._infos.length;e++){var i=this._infos[e];if(i.id==t)return e}},t.prototype.isSz=function(t){var e=0;for(var i in this.poss){var s=this.poss[i];if(t==s.id){e=Number(i);break}}return e},t}();__reflect(HuobanManager.prototype,"HuobanManager");var HuobanMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.HUOBAN,CmdType.O_HUOBAN),CmdBus.adListener(CmdType.O_HUOBAN,this.onOpenView,this),CmdBus.adListener(CmdType.C_HUOBAN,this.onCloseView,this),CmdBus.adListener(CmdType.O_HUOBAN_ZR,this.onOpenZrView,this),CmdBus.adListener(CmdType.C_HUOBAN_ZR,this.onCloseZrView,this),CmdBus.adListener(CmdType.O_HUOBAN_JH,this.onOpenJhView,this),CmdBus.adListener(CmdType.C_HUOBAN_JH,this.onCloseJhView,this),EventBus.addListener(EventType.M_HUOB_LST,this.updateRedDot,this),EventBus.addListener(EventType.M_UPD_CON,this.updateRedDot,this)}return t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.huobMgr,e=t.redDot,i=0;12>i;i++){var s=t.getHbData(i);if(s&&!Utils.isEmptyObj(s)){var o=t.getCfgById(s.id),n=GmGlobal.mc.itemMgr.getItemNum(o.upid),r=o.upCfgs[s.lv],h=n>=r.num?1:0;s.lv>=100&&(h=0),this.setItemRD(e,o.id,h)}}this._view&&this._view.isShow&&this._view.updRedDot()},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new HuobanView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenZrView=function(){this._zrview||(this._zrview=new HuobanZrView),this._zrview.isShow||(this._zrview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseZrView=function(){this._zrview&&this._zrview.isShow&&this._zrview.close()},t.prototype.onOpenJhView=function(t){this._jhview||(this._jhview=new HuobanJhView),this._jhview.isShow||(this._jhview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._jhview.setId(t)},t.prototype.onCloseJhView=function(){this._jhview&&this._jhview.isShow&&this._jhview.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._zrview&&(this._zrview.destroy(),this._zrview=null),this._jhview&&(this._jhview.destroy(),this._jhview=null),!0):!1:!0},t}();__reflect(HuobanMediator.prototype,"HuobanMediator",["IMediator"]);var HuobanView=function(t){function e(){var e=t.call(this,"HuobanSkin")||this;return e._sidx=-1,e._pid=0,e._plv=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuobanIconSkin",this.itemList.itemRenderer=HuobanIcon,this.initLst()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bzr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZr,this),this.bjh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJh,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_HUOB_INFO,this.updOneInfo,this),EventBus.addListener(EventType.M_HUOB_LST,this.updLst,this),EventBus.addListener(EventType.M_UPD_CON,this.updLst,this)
},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bzr.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZr,this),this.bjh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJh,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_HUOB_INFO,this.updOneInfo,this),EventBus.rmListener(EventType.M_HUOB_LST,this.updLst,this),EventBus.rmListener(EventType.M_UPD_CON,this.updLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updLst(),this.selGrid(0),this.alphaShow()},e.prototype.initLst=function(){for(var t=0;12>t;t++){var e={id:1,lv:0,sel:!1,isZr:!1,idx:t+1};this._array.addItem(e)}},e.prototype.updLst=function(){for(var t=0;12>t;t++)this.updOne(t)},e.prototype.updOneInfo=function(t){var e=t.data;this.updOne(e)},e.prototype.updOne=function(t){var e=this._mc.huobMgr.getHbData(t),i=this._array.getItemAt(t);e&&!Utils.isEmptyObj(e)&&(i.id=e.id||1,i.lv=e.lv||0,this._array.itemUpdated(i),this.updPanel())},e.prototype.onTouchList=function(t){if(t.target.parent==this.itemList){var e=(t.target,this.itemList.getChildIndex(t.target));if(e==this._sidx)return;this.selGrid(e)}},e.prototype.selGrid=function(t){if(-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.sel=!1,this._array.itemUpdated(e)}var i=this._array.getItemAt(t);i.sel=!0,this._array.itemUpdated(i),this._sidx=t,this.updPanel()},e.prototype.updPanel=function(){if(-1!=this._sidx){var t=this._mc.huobMgr.getHbData(this._sidx),e=this._mc.huobMgr.getCfgById(t.id),i=t.lv||0;i?(this.bjh.label="LV UP",this.bjh.skinName="ComBtnSkinY",Utils.setBtnEnable(this.bjh,!0),this.tlv.text="LV."+i):(this.bjh.label="Enable",this.bjh.skinName="ComBtnSkinB",Utils.setBtnEnable(this.bjh,!0),this.tlv.text="Disabled");var s=e.upCfgs[i];i>=e.upCfgs.length-1&&(s=e.upCfgs[i],this.bjh.label="Max LV",Utils.setBtnEnable(this.bjh,!1)),this.tName.text=e.name;for(var o=0;10>o;o++){var n=this["tBAtr"+o],r=this["tBAtrNum"+o],h=e.atrnames[o];n.text=this._mc.heroMgr.getAtrName(h)+":",r.text=s.atrs[o]}this.img.source="huobImg_json."+e.mode,this.itemList.validateNow(),this.updRedDot()}},e.prototype.updRedDot=function(){var t=this._mc.huobMgr.redDot;if(t.childs)for(var e=0;e<this._array.length;e++){var i=this._mc.huobMgr.getHbData(e),s=t.childs[i.id],o=this.itemList.getChildAt(e);if(s&&1==s.state){var n=this.getRDPoint(o);RedDotView.addRedDot(o,this.redDotCon,"huoban",n.x,n.y,"com_json.com_rdd")}else RedDotView.removeRedDot(o)}},e.prototype.getRDPoint=function(t){var e=t.parent.localToGlobal(t.x,t.y);return e.x-=this.x-t.width+30,e.y-=this.y-5,e},e.prototype.clearModel=function(){},e.prototype.onJh=function(){var t=this._mc.huobMgr.getHbData(this._sidx);this._pid=t.id,this._plv=t.lv,this._cc.dataCtl.doAction(ServerActionId.HUOB_UP,[t.id],this.onOk,this)},e.prototype.onOk=function(){var t=this._mc.huobMgr.getHbIdx(this._pid);this._mc.huobMgr.getHbData(t);this.selGrid(t),this._plv<=0&&CmdBus.doCmd(CmdType.O_HUOBAN_JH,this._pid)},e.prototype.onZr=function(){CmdBus.doCmd(CmdType.O_HUOBAN_ZR)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.huobMgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HUOBAN)},e.prototype.close=function(){if(RedDotView.removeRedDotByGroup("huoban"),-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.sel=!1,this._array.itemUpdated(e)}this._sidx=-1,this._pid=0,this.clearModel(),t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("huob_bg_0_jpg"),RES.destroyRes("huob_bg_1_jpg"),RES.destroyRes("huobIcon_json"),RES.destroyRes("huobImg_json"),t.prototype.destroy.call(this)},e}(UIBase);__reflect(HuobanView.prototype,"HuobanView");var HuobanZrView=function(t){function e(){var e=t.call(this,"HuobanZrSkin")||this;return e._sidx=-1,e._sIidx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuobanIconSkin",this.itemList.itemRenderer=HuobanIcon,this.initLst(),this.initIcon()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bjh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSz,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.iconCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIcons,this),EventBus.addListener(EventType.M_R_UPD,this.updateHeroIcon,this),EventBus.addListener(EventType.M_HUOB_ZR,this.updPanel,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bjh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSz,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.iconCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onIcons,this),EventBus.rmListener(EventType.M_R_UPD,this.updateHeroIcon,this),EventBus.rmListener(EventType.M_HUOB_ZR,this.updPanel,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updLst(),this.selGrid(0)},e.prototype.initLst=function(){for(var t=0;12>t;t++){var e={id:1,lv:0,sel:!1,isZr:!0,idx:t+1};this._array.addItem(e)}},e.prototype.initIcon=function(){for(var t=0;3>t;t++){var e=this.iconCon.getChildAt(t);e.numTxt.visible=!1,e.ilk.visible=!1}this.updateHeroIcon()},e.prototype.updateHeroIcon=function(){var t=GmGlobal.mc,e=t.loginMgr.headurl;if(e)if(-1!=e.indexOf("http"))this.icon.source=e;else{var i=this;egret.BitmapData.create("base64",e,function(t){var e=new egret.Texture;e.bitmapData=t,i.icon.source=e})}else this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+t.role.careerId+".png";this.updPanel()},e.prototype.updLst=function(){for(var t=0;12>t;t++)this.updOne(t)},e.prototype.updOneInfo=function(t){var e=t.data;this.updOne(e)},e.prototype.updOne=function(t){var e=this._mc.huobMgr.getHbData(t),i=this._array.getItemAt(t);e&&!Utils.isEmptyObj(e)&&(i.id=e.id||1,i.lv=e.lv||0,this._array.itemUpdated(i),this.updPanel())},e.prototype.onIcons=function(t){if(t.target.parent==this.iconCon){var e=this.iconCon.getChildIndex(t.target);if(e==this._sIidx)return;var i=this._mc.huobMgr.poslst[e],s=this._mc.huobMgr.poss[e+1];if(!s)return;if(!s.id)return;var o=this._mc.huobMgr.isSz(s.id);if(!o)return;if(this._mc.role.lv<i)return;this.selIcon(e)}},e.prototype.selIcon=function(t){if(-1!=this._sIidx){var e=this.iconCon.getChildAt(this._sIidx);e.ilk.visible=!1}if(-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.sel=!1,this._array.itemUpdated(e),this._sidx=-1}var i=this.iconCon.getChildAt(t);i.ilk.visible=!0,this._sIidx=t,this.updPanel()},e.prototype.onTouchList=function(t){if(t.target.parent==this.itemList){var e=(t.target,this.itemList.getChildIndex(t.target));if(e==this._sidx)return;this.selGrid(e)}},e.prototype.selGrid=function(t){if(-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.sel=!1,this._array.itemUpdated(e)}if(-1!=this._sIidx){var e=this.iconCon.getChildAt(this._sIidx);e.ilk.visible=!1,this._sIidx=-1}var i=this._array.getItemAt(t);i.sel=!0,this._array.itemUpdated(i),this._sidx=t,this.updPanel()},e.prototype.updPanel=function(){if(-1!=this._sidx||-1!=this._sIidx){if(-1!=this._sidx&&-1==this._sIidx){var t=this._mc.huobMgr.getHbData(this._sidx),e=this._mc.huobMgr.getCfgById(t.id);this.tlv.visible=!0;var i=e.upCfgs[t.lv];this.tlv.text="Deploy to increase basic Power："+i.zhanli,this.bjh.label="Deploy",this.bjh.skinName="ComBtnSkinY",Utils.setBtnEnable(this.bjh,!0);var s=this._mc.huobMgr.isSz(t.id);s?(this.bjh.label="Deployed",Utils.setBtnEnable(this.bjh,!1)):t.lv<1&&(this.bjh.label="Deploy",Utils.setBtnEnable(this.bjh,!1))}else-1!=this._sIidx&&-1==this._sidx&&(this.tlv.visible=!1,this.bjh.label="Remove",Utils.setBtnEnable(this.bjh,!0),this.bjh.skinName="ComBtnSkinB");this.updIcons()}},e.prototype.updIcons=function(){for(var t=this._mc.role.lv,e=0;3>e;e++){var i=this.iconCon.getChildAt(e),s=this["tjs"+e],o=this._mc.huobMgr.poslst[e];s.text="Unlocks at LV."+o;var n=this._mc.huobMgr.poss[e+1];if(n&&!Utils.isEmptyObj(n)){s.visible=!1;var r=n.id,h=this._mc.huobMgr.getCfgById(r);i.iconK.source="item_json.q_"+h.qid,i.icon.source="huobIcon_json."+h.icon,i.icon.visible=!0}else t>=o?(s.visible=!1,i.icon.visible=!1,i.iconK.source="item_json.q_1"):(s.visible=!0,i.icon.visible=!1,i.iconK.source="item_json.q_1")}},e.prototype.onSz=function(){if(-1!=this._sidx){var t=this._mc.huobMgr.getHbData(this._sidx);this._cc.dataCtl.doAction(ServerActionId.HUOB_SZ,[t.id])}else{var e=this._mc.huobMgr.poss[this._sIidx+1];this._cc.dataCtl.doAction(ServerActionId.HUOB_SZ,[e.id,this._sIidx],this.onXz,this)}},e.prototype.onXz=function(){if(-1!=this._sIidx){var t=this.iconCon.getChildAt(this._sIidx);t.ilk.visible=!1,this._sIidx=-1}Utils.setBtnEnable(this.bjh,!1)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_HUOBAN_ZR)},e.prototype.close=function(){if(-1!=this._sidx){var e=this._array.getItemAt(this._sidx);e.sel=!1,this._array.itemUpdated(e),this._sidx=-1}if(-1!=this._sIidx){var e=this.iconCon.getChildAt(this._sIidx);e.ilk.visible=!1,this._sIidx=-1}t.prototype.close.call(this)},e}(UIBase);__reflect(HuobanZrView.prototype,"HuobanZrView");var HuobData=function(){function t(){}return t}();__reflect(HuobData.prototype,"HuobData");var CfgLoadOperation=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(e,i,s,o){t.prototype.execute.call(this,e,i,s,o),this._progressInfo.name="Initializing configuration",this.autoProgress(30),RES.getResByUrl("resource/config/"+PFConst.CFG_FILE,this.parseConfig,this,RES.ResourceItem.TYPE_BIN)},e.prototype.parseConfig=function(t){var e=new JSZip(t);GmGlobal.mc.initConfig(e),e=null,this._progressInfo.current=100,this.notifyProgress(),this.notifyComplete()},e.prototype.clear=function(){t.prototype.clear.call(this)},e}(SingleOperation);__reflect(CfgLoadOperation.prototype,"CfgLoadOperation");var FilesLoadOperation=function(t){function e(e,i,s){var o=t.call(this)||this;return o._file=e,o._type=s,o._isKey=i,o._progressInfo.name=e,o}return __extends(e,t),e.prototype.execute=function(e,i,s,o){if(t.prototype.execute.call(this,e,i,s,o),this._isKey)RES.getResAsync(this._file,this.onLoaded,this);else if("model"==this._type)GmGlobal.res.getMovieClipData(GmConst.MODEL_DIR,this._file,this.onLoaded,this);else if("effect"==this._type)GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this._file,this.onLoaded,this);else if("sound"==this._type){var n=new egret.Sound;n.addEventListener(egret.Event.COMPLETE,this.onSoundLoaded,this);var r=RES.getVersionController().getVirtualUrl("resource/sound/"+this._file+".mp3");n.load(r)}else RES.getResByUrl(this._file,this.onLoaded,this,this._type);this.autoProgress(180)},e.prototype.onLoaded=function(t,e){this.isStop||(this.notifyProgress(),this.notifyComplete())},e.prototype.onSoundLoaded=function(t){if(!this.isStop){var e=t.target;GmGlobal.sound.setSound(this._file,e),this.notifyProgress(),this.notifyComplete()}},e.prototype.onIOError=function(){this.notifyProgress(),this.notifyComplete()},e.prototype.clear=function(){t.prototype.clear.call(this),this._file=null},e}(SingleOperation);__reflect(FilesLoadOperation.prototype,"FilesLoadOperation");var InitMediator=function(){function t(){this._isResOk=!1,this._isDataOk=!1,this._bgNum=1}return t.prototype.start=function(t,e){this._initCb=t,this._initObj=e;var i=["loading_bar_png","loading_bar_bg_png"];""!=PFConst.L_LOGO_IMG?this._loadingBg=PFConst.L_LOGO_IMG+"_jpg":this._loadingBg=PFConst.LOGO_IMG+"_jpg",i.push(this._loadingBg),RES.createGroup("init",i,!0),this._initResLoad=new ResLoadOperation("init",""),this._initResLoad.execute(null,this.doStart,this.doStart,this),GmGlobal.cc.pfCtl.pfGameReport(3),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.INITGAME)},t.prototype.doStart=function(){PFConst.SHOW_INIT&&InitView.hide(),"undefined"!=typeof onGameInited&&onGameInited(),this._loadingView=LoadingView.getInstence(),this._loadingView.show(),this._loadingView.setBgImg(this._loadingBg),PFConst.COPYRIGHTINFO&&this._loadingView.setBqInfo(PFConst.COPYRIGHTINFO),this._sequence=new SequenceOperation,this._sequence.addOperation(new ResLoadOperation("preload","Initializing resources")),this._sequence.addOperation(new CfgLoadOperation),this._sequence.addOperation(new InitServerProtoOperation),this._sequence.execute(this.onProgress,this.onComplete,null,this),GmGlobal.cc.pfCtl.pfGameReport(4)},t.prototype.onProgress=function(t){var e;t.childProgress?(e=t.current/t.total+t.childProgress.current/t.childProgress.total/t.total,this._loadingView.setTxt(t.childProgress.name)):e=t.current/t.total,this._loadingView.setPercent(Math.floor(100*e))},t.prototype.onComplete=function(t){if(this._loadingView.setBarVisible(!1),GmGlobal.isResInit=!0,PFConst.SHOW_USERAGR){var e=Number(egret.localStorage.getItem("isshowua"));PFConst.FORCE_SHOW_UA||!e?this.showUserAgr():this.initPf()}else this.initPf()},t.prototype.showUserAgr=function(){this._userAgrView||(this._userAgrView=new UserAgreemnetView),this._userAgrView.show(GmGlobal.vmc.uiLayer),this._userAgrView.setCb(this.initPf,this)},t.prototype.closeUserAgr=function(){this._userAgrView&&(this._userAgrView.close(),this._userAgrView=null)},t.prototype.initPf=function(){this.closeUserAgr(),PFConst.SHOW_LOGIN_WAITING&&WaitingView.showWaiting("Logging in"),GmGlobal.cc.pfCtl.pfLogin(this.onPfLogin,this),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.PFLOGIN)},t.prototype.initPfData=function(t){var e=GmGlobal.mc.loginMgr;e.account=t.userId,t.youke&&(e.accountYk=t.youke),e.host=t.host,e.port=t.port||0,e.time=t.time,e.sig=t.sig,e.platId=t.platid,t.youkePid&&(e.platIdYk=t.youkePid),t.nickname&&(e.nickname=t.nickname),t.city&&(e.city=t.city,e.city.length>5&&(e.city=e.city.substr(0,5))),t.headurl&&(e.headurl=t.headurl),t.invite&&(e.invite=t.invite),t.ext&&(e.ext=t.ext),t.maintainTime&&(e.sOpenTime=t.maintainTime),t.createinfo&&(e.createinfo=t.createinfo),t.pfServerId&&(e.pfloginSid=Number(t.pfServerId))},t.prototype.onPfLogin=function(t){if(WaitingView.hideWaiting(),0==t)return void this.showUserAgr();if(this.closeUserAgr(),GmGlobal.cc.pfCtl.pfGameReport(5),this.initPfData(t),1==PFConst.SERVER_TYPE){if(GmGlobal.mc.loginMgr.sOpenTime>0)return;PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.GETSLIST),WaitingView.showWaiting("Retrieving character list")}else this.getServerList()},t.prototype.onRoleList=function(t){WaitingView.hideWaiting();var e=GmGlobal.mc.loginMgr;e.roleList=t,e.createRoleNum()?(CmdBus.doCmd(CmdType.O_R_SEL),CmdBus.adListener(CmdType.CK_CREATE,this.onCheckCreate,this)):(GmGlobal.isNewPlayer=!0,GmGlobal.vmc.startJuqing()),GmGlobal.cc.pfCtl.pfReport(PfReportType.INIT),EventBus.addListener(EventType.ENTER_GAME,this.onEnterGame,this)},t.prototype.onCheckCreate=function(t){var e=this;GmGlobal.cc.loginCtl.checkLogin(t,function(t){0==t&&e.loginGame()})},t.prototype.onJqEnd=function(){this._loadingView.show(),this._loadingView.setBarVisible(!1),1==PFConst.SERVER_TYPE?this.onCheckCreate(1):CmdBus.doCmd(CmdType.O_R_CREATE,GmGlobal.mc.loginMgr.serverId)},t.prototype.getServerList=function(){PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.GETSLIST),WaitingView.showWaiting("Connecting to server"),GmGlobal.cc.pfCtl.pfGameReport(6);var t=this;GmGlobal.cc.loginCtl.getServerList(function(){WaitingView.hideWaiting(),GmGlobal.cc.pfCtl.pfGameReport(7),t.selServer()},function(){})},t.prototype.getSelServer=function(){var t=GmGlobal.mc.loginMgr;return t.pfloginSid?t.pfloginSid:0},t.prototype.selServer=function(){var t=GmGlobal.mc.loginMgr,e=this.getSelServer();if(e){EventBus.addListener(EventType.ENTER_GAME,this.onEnterGame,this),t.selServerId=e;GmGlobal.cc.loginCtl.checkLogin(t.selServerId,function(e){0==e?EventBus.dispatchEvt(EventType.ENTER_GAME):1==PFConst.SERVER_TYPE?CmdBus.doCmd(CmdType.O_R_CREATE,t.selServerId):(GmGlobal.isNewPlayer=!0,GmGlobal.vmc.startJuqing())})}else EventBus.addListener(EventType.ENTER_GAME,this.onEnterGame,this),CmdBus.doCmd(CmdType.O_SEL_SV),GmGlobal.cc.pfCtl.pfReport(PfReportType.INIT)},t.prototype.onEnterGame=function(t){this.loginGame(t.data)},t.prototype.loginGame=function(t){void 0===t&&(t=!1);var e=this;GmGlobal.cc.loginCtl.loginGame(function(t){0==t?(EventBus.rmListener(EventType.ENTER_GAME,this.onEnterGame,this),GmGlobal.cc.pfCtl.pfGameReport(14),WaitData.getInstance().startWait(e.onDataOk,e),e.loadEnterRes(),GmGlobal.vmc.clearLoginView(),CmdBus.rmListener(CmdType.CK_CREATE,this.onCheckCreate,this)):141==t?1==PFConst.SERVER_TYPE?CmdBus.doCmd(CmdType.O_R_CREATE,GmGlobal.mc.loginMgr.serverId):(GmGlobal.isNewPlayer=!0,GmGlobal.vmc.startJuqing()):GmGlobal.mc.txtMgr.showRetCode(t)})},t.prototype.onDataOk=function(){this._isDataOk=!0,this.checkComplate()},t.prototype.loadEnterRes=function(){this._loadingView.setBarVisible(!0);var t=RES.getGroupByName("enter");t&&t.length>0?(this._enterResLoad=new ResLoadOperation("enter","Loading main screen resources"),this._enterResLoad.execute(this.onProgress,this.onEnterResComplete,this.onEnterResComplete,this)):this.onEnterResComplete(null)},t.prototype.onEnterResComplete=function(t){this._isResOk=!0,this._enterResLoad=null,this.checkComplate()},t.prototype.checkComplate=function(){console.log("resOk:"+this._isResOk+" dataOk:"+this._isDataOk),this._isResOk&&this._isDataOk&&(GmGlobal.cc.pfCtl.pfGameReport(15),this._initCb&&this._initCb.call(this._initObj))},t.prototype.isInitOk=function(){return this._isResOk&&this._isDataOk?!0:!1},t.prototype.clear=function(){this._loadingView&&this._loadingView.close(),this._sequence&&(this._sequence.clear(),this._sequence=null),this._initCb=null,this._initObj=null},t}();__reflect(InitMediator.prototype,"InitMediator");var InitServerProtoOperation=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.execute=function(e,i,s,o){t.prototype.execute.call(this,e,i,s,o),this._progressInfo.name="Initializing resources",this.autoProgress(150),MsgStruct.initMsg(),this._progressInfo.current=100,this.notifyProgress(),this.notifyComplete()},e.prototype.clear=function(){t.prototype.clear.call(this)},e}(SingleOperation);__reflect(InitServerProtoOperation.prototype,"InitServerProtoOperation");var InitView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.show=function(t){this._instence||(this._instence=new e),this._instence.show(t)},e.hide=function(){this._instence&&this._instence.hide()},e.prototype.show=function(t){t.addChild(this),this.bg=new eui.Image("resource/ui/loading/"+PFConst.LOGO_IMG+".jpg"),GmGlobal.stageHeight>1560?(this.bg.y=0,this.bg.height=GmGlobal.stageHeight,this.bg.width=720/1560*GmGlobal.stageHeight):this.bg.y=(GmGlobal.stageHeight-1560)/2,this.addChild(this.bg),this.load=new eui.Image("resource/ui/loading/oploading.png"),this.addChild(this.load),this.load.anchorOffsetX=43,this.load.anchorOffsetY=43,this.load.x=t.stage.stageWidth/2,this.load.y=t.stage.stageHeight/2,egret.startTick(this.onTick,this)},e.prototype.onTick=function(t){return this.load.rotation+=4,!0},e.prototype.hide=function(){egret.stopTick(this.onTick,this),this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(InitView.prototype,"InitView");var LoadingView=function(t){function e(){var e=t.call(this,"LoadingViewSkin")||this;return e.touchChildren=!1,e}return __extends(e,t),e.getInstence=function(){return e._instence||(e._instence=new e),e._instence},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bar.slideDuration=200,this.exitTip.text="If there's no response，Click the screen to stop loading",GmGlobal.stageHeight>1560&&(this.bgImg.height=GmGlobal.stageHeight,this.bgImg.width=720/1560*GmGlobal.stageHeight)},e.prototype.resize=function(){this.height=GmGlobal.stageHeight,GmGlobal.stageWidth/GmGlobal.stageHeight<=1?(this.width=GmGlobal.stageWidth,this.width>720&&(this.bgImg.width=this.width,this.bgImg.height=1560*this.width/720)):(this.x=(GmGlobal.stageWidth-this.width)/2,""!=PFConst.L_LOGO_IMG&&(this.bgImg.width=GmGlobal.stageWidth,this.bgImg.height=GmGlobal.stageHeight));var t=Math.max(this.bqInfo.height+40,200);this.barCon.y=this.height-this.barCon.height-t,this.barCon.x=(this.width-this.barCon.width)/2},e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.addEvts=function(){EventBus.addListener(EventType.RESIZE,this.resize,this)},e.prototype.rmEvts=function(){EventBus.rmListener(EventType.RESIZE,this.resize,this)},e.prototype.show=function(){t.prototype.show.call(this,GmGlobal.vmc.uiLayer,!0),this.exitTip.visible=!1},e.prototype.setBqVisible=function(t){this.bqInfo.visible=t},e.prototype.setBgImg=function(t){this._bgImg=t,this.bgImg.source=t},e.prototype.setPercent=function(t){this.bar.value=t},e.prototype.setBarVisible=function(t){this.barCon.visible=t,t||(this.bar.value=0)},e.prototype.setTxt=function(t){this.txt.text=t},e.prototype.setBqInfo=function(t){this.bqInfo.visible=!0,this.bqInfo.text=""+t,this.bqInfo.y=GmGlobal.stageHeight-this.bqInfo.textHeight-10,this.resize()},e.prototype.showExitTip=function(){this.exitTip.visible=!0},e.prototype.close=function(){this.bar.value=0,this.txt.text="",this.bqInfo.text="",t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes(this._bgImg),RES.destroyRes("loading_bar_png"),RES.destroyRes("loading_bar_bg_png")},e}(UIBase);__reflect(LoadingView.prototype,"LoadingView",["ILoading"]);var ResLoadOperation=function(t){function e(e,i){var s=t.call(this)||this;return s._progressName=i,s._group=e,s}return __extends(e,t),e.prototype.execute=function(e,i,s,o){t.prototype.execute.call(this,e,i,s,o),this._progressInfo.name=this._progressName,this.notifyProgress(),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResLoadProgress,this),RES.loadGroup(this._group)},e.prototype.onResLoadProgress=function(t){this._progressInfo.current=t.itemsLoaded,this._progressInfo.total=t.itemsTotal,this.notifyProgress()},e.prototype.onResLoadComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResLoadProgress,this);var e=this;setTimeout(function(){e.notifyComplete()},200)},e.prototype.onResLoadError=function(t){console.warn("Group: "+t.groupName+" load failed"),this.notifyComplete()},e.prototype.onItemLoadError=function(t){console.warn("url: "+t.resItem.url+" load failed")},e}(SingleOperation);__reflect(ResLoadOperation.prototype,"ResLoadOperation");var UILoadingView=function(t){function e(){return t.call(this,"GroupLoadingSkin")||this}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.loadBar.slideDuration=200},e.prototype.updatePos=function(){this.x=Math.round((GmGlobal.stageWidth-this.width)/2),this.y=Math.round((GmGlobal.stageHeight-this.height)/2)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(){t.prototype.show.call(this,GmGlobal.vmc.uiLayer)},e.prototype.setPercent=function(t){this.loadBar.value=t},e.prototype.setText=function(t){},e.prototype.close=function(){t.prototype.close.call(this),this.loadBar.value=0},e}(UIBase);__reflect(UILoadingView.prototype,"UILoadingView",["ILoading"]);var Container=function(){function t(t){this.roleId=t,this.items={}}return t.prototype.updateItem=function(t,e){var i=this.items[t];return i&&0==e?void delete this.items[t]:void(i?i.num=e:(i=Item.create(t,e),this.items[t]=i))},t}();__reflect(Container.prototype,"Container");var Item=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.id=t,this.num=e}return t.create=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),t.pool||(t.pool=[]);var s=t.pool.pop();return s?(s.id=e,s.num=i):s=new t(e,i),s},t.release=function(e){e&&-1==t.pool.indexOf(e)&&t.pool.push(e)},t}();__reflect(Item.prototype,"Item");var ItemCfg=function(){function t(){this.des="",this.enabled=0,this.getWay="",this.stage=0,this.sell=null,this.exp=0,this.maxNum=1,this.buffitem=0,this.use=null,this.isBoss=!1}return t}();__reflect(ItemCfg.prototype,"ItemCfg");var ItemController=function(){function t(){EventBus.addListener(EventType.S_RECONNECT,this.onReconnection,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_CONTAINER,this.onUpdateContainerinfo,this),this._itemBingCbs={},this._allItemCbs=[],GmGlobal.cc.dataCtl.regPbCb(PbMsgId.EQP_CON,this.onItemTip,this),GmGlobal.server.regUpdCb(MsgID.UPD_ITEM,this.onUpdateProtoItemInfo,this)}return t.prototype.onItemTip=function(t){MsgBox.alert(t.msg)},t.prototype.bindItemCallback=function(t,e,i){if(0==t){if(-1!=this.getCbIndex(this._allItemCbs,e,i))return;this._allItemCbs.push({c:e,t:i})}else{var s=this._itemBingCbs[t];if(s||(this._itemBingCbs[t]=s=[]),-1!=this.getCbIndex(s,e,i))return;s.push({c:e,t:i})}},t.prototype.getCbIndex=function(t,e,i){for(var s=0;s<t.length;s++){var o=t[s];if(o.c==e&&o.t==i)return s}return-1},t.prototype.removeItemCallback=function(t,e,i){if(0==t){var s=this.getCbIndex(this._allItemCbs,e,i);-1!=s&&this._allItemCbs.splice(s,1)}else{var o=this._itemBingCbs[t];if(!o)return;var s=this.getCbIndex(o,e,i);-1!=s&&o.splice(s,1)}},t.prototype.triggerItemCallback=function(t){for(var e=0,i=this._allItemCbs;e<i.length;e++){var s=i[e];s.c.call(s.t)}var o=this._itemBingCbs[t];if(o)for(var n=0,r=o;n<r.length;n++){var s=r[n];s.c.call(s.t)}},t.prototype.onReconnection=function(){GmGlobal.mc.itemMgr.clearContainer()},t.prototype.onUpdateContainerinfo=function(t){var e=GmGlobal.mc.itemMgr.getContainer(),i=t.data.data;for(var s in i)e.updateItem(Number(s),i[s]);for(var o=0,n=this._allItemCbs;o<n.length;o++){var r=n[o];r.c.call(r.t)}EventBus.dispatchEvt(EventType.M_UPD_CON)},t.prototype.onUpdateJSONItemInfo=function(t){var e=t.data.data;this.onUpdateItemInfo(e.id,e.num,e.tip)},t.prototype.onUpdateProtoItemInfo=function(t){this.onUpdateItemInfo(t.itemid,t.itemnum,t.addnum)},t.prototype.onUpdateItemInfo=function(t,e,i){this.updateItem(t,e,i),this.triggerItemCallback(t);var s=GmGlobal.mc.itemMgr.getItemCfg(t);i&&s&&GmGlobal.cc.chatCtl.addMsg("Obtain <item="+t+"></item> *"+i,ChatChannel.SYS),EventBus.dispatchEvt(EventType.M_UPD_CON)},t.prototype.updateItem=function(t,e,i){GmGlobal.mc.itemMgr.updateItem(t,e),i>0&&this.showGetItemTips(t,i,e)},t.prototype.showGetItemTips=function(t,e,i){var s=GmGlobal.mc.itemMgr.getItemCfg(t);if(s){var o=TextFormat.setColor(s.name,Utils.getQualityColor(s.quality))+" *"+e,n=GmGlobal.mc.itemMgr.getItemIcon(t);Horselamp.showVText(o,n)}else{var r=GmGlobal.mc.itemMgr.getItemCfg(i);if(r&&r.type==ItemType.EQUIP){var o=TextFormat.setColor(r.name,Utils.getQualityColor(r.quality))+" *1",n=GmGlobal.mc.itemMgr.getItemIcon(i);Horselamp.showVText(o,n)}}},t.prototype.reqBuyItem=function(t,e,i,s){var o=MsgStruct.getMsg(MsgID.REQ_BUY_ITEM);if(!o)return 0;o.itemid=t,o.num=e,o.money=i;return GmGlobal.server.sendMsg(MsgID.REQ_BUY_ITEM,o,function(t){0!=t.retCode&&(27==t.retCode?ItemLackTips.instance().diamondTips():9==t.retCode?MsgBox.prompt("Insufficient gold"):238==t.retCode?ItemLackTips.instance().ybTips():204==t.retCode?ItemLackTips.instance().shuijTips():GmGlobal.mc.txtMgr.showRetCode(t.retCode)),s&&s(t.retCode)})},t}();__reflect(ItemController.prototype,"ItemController");var ItemGrid=function(){function t(){this._posOffset=0,this._scale=1}return t.prototype.init=function(e,i,s,o,n){void 0===n&&(n=!1),this.index=e,this._scale=o/t.BASE_SIZE,this._showDefult=n,this.icon||(this.icon=new eui.Image,this.icon.touchEnabled=!1),this.qGrid||(this.qGrid=new eui.Image),this.numTxt||(this.numTxt=new eui.Label,this.numTxt.textColor=16777215,this.numTxt.width=90,this.numTxt.height=40,this.numTxt.size=19,this.numTxt.stroke=1,this.numTxt.borderColor=0,this.numTxt.textAlign="right",this.numTxt.verticalAlign="bottom",this.numTxt.touchEnabled=!1),this.jlTxt||(this.jlTxt=new eui.Label,this.jlTxt.textColor=16777215,this.jlTxt.width=90,this.jlTxt.height=20,this.jlTxt.size=19,this.jlTxt.stroke=1,this.jlTxt.borderColor=0,this.jlTxt.textAlign="right",this.jlTxt.verticalAlign="bottom",this.jlTxt.touchEnabled=!1),this.icon.width=o*t.iconScale,this.icon.height=o*t.iconScale,this.qGrid.width=o,this.qGrid.height=o,this.numTxt.scaleX=this.numTxt.scaleY=this._scale,this.jlTxt.scaleX=this.jlTxt.scaleY=this._scale,this._posOffset=o*(1-t.iconScale)/2,this.setItem(i,s)},t.prototype.addTouchCb=function(t,e){this._touchCb=t,this._touchThis=e},Object.defineProperty(t.prototype,"touchEnabled",{set:function(t){this.qGrid&&(t?this.qGrid.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchIcon,this):this.qGrid.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchIcon,this))},enumerable:!0,configurable:!0}),t.prototype.onTouchIcon=function(t){this._touchCb&&this._touchThis?this._touchCb.call(this._touchThis,this,t.stageX,t.stageY):this.showItemTip(t.stageX,t.stageY)},t.prototype.showItemTip=function(t,e,i){void 0===i&&(i=0);var s=GmGlobal.mc.itemMgr.getItemCfg(this.itemId);s&&(s.type==ItemType.EQUIP&&this.uid?EquipTips.show(this.uid,t,e,i):ItemTips.show(this.itemId,t,e,i))},t.prototype.setItem=function(t,e,i,s,o){if(void 0===i&&(i=!1),void 0===s&&(s=""),void 0===o&&(o=0),t>1e4?(this.uid=0,this.itemId=t,this.num=e):(this.uid=t,this.itemId=e,this.num=1),i){this.numTxt.visible=this.num>0?!0:!1;var n=GmGlobal.mc.itemMgr.getItemNum(this.itemId);TextFormat.setMoneyStr(this.numTxt,n,this.num,!0)}else this.numTxt.visible=this.num>0?!0:!1,this.numTxt.text=s+(this.num>=1e5?Utils.formatNum(this.num):String(this.num));this.jlTxt.visible=o>0?!0:!1,this.jlTxt.text="+"+o;var r=GmGlobal.mc.itemMgr.getItemCfg(this.itemId);r?(this.icon.source=GmGlobal.mc.itemMgr.getItemIcon(this.itemId),this.qGrid.source="item_json.q_"+r.quality,this.qGrid&&(this.qGrid.visible=!0)):(this.icon.source=null,this.qGrid.source=this._showDefult?"item_json.item_com0":null,this.numTxt&&(this.numTxt.visible=!1),this.jlTxt&&(this.jlTxt.visible=!1)),this.setBossStar(r),r&&r.type==ItemType.CARD?this.setStageStar(GmGlobal.mc.equipMgr.getCardCfg(r.id)):this.clearStarCon(),this.touchEnabled=this.itemId>0},t.prototype.setBossStar=function(t){t&&t.isBoss?(this.bossStar||(this.bossStar=new eui.Image("com_json.bosxx"),this.bossStar.touchEnabled=!1,this.bossStar.scaleX=this.bossStar.scaleY=this._scale),this.bossStar.parent||this.icon.parent&&(this.icon.parent.addChild(this.bossStar),this.bossStar.x=this.icon.x+2,this.bossStar.y=this.icon.y+2)):this.clearBossStar()},t.prototype.clearBossStar=function(){this.bossStar&&(this.bossStar.parent&&this.bossStar.parent.removeChild(this.bossStar),this.bossStar=null)},t.prototype.setStageStar=function(e){if(e&&e.star){if(this.starCon)this.clearStageStar();else{this.starCon=new eui.Group,this.starCon.width=100;var i=new eui.HorizontalLayout;i.horizontalAlign="center",this.starCon.layout=i,this.starCon.touchEnabled=!1,this.starCon.touchChildren=!1,this.starCon.height=28,this.starCon.scaleX=this.starCon.scaleY=this._scale}for(var s=0;s<e.star;s++){var o=t.createStar();o.x=28*s,this.starCon.addChild(o)}this.icon.parent&&(this.icon.parent.addChildAt(this.starCon,this.icon.parent.getChildIndex(this.icon)+1),this.starCon.x=this.icon.x,this.starCon.y=this.icon.y+(this.icon.height-this.starCon.height*this.starCon.scaleX))
}else this.clearStarCon()},t.prototype.clearStageStar=function(){if(this.starCon)for(;this.starCon.numChildren>0;)t.starPool.push(this.starCon.removeChildAt(0))},t.prototype.clearStarCon=function(){this.starCon&&(this.clearStageStar(),this.starCon.parent&&this.starCon.parent.removeChild(this.starCon),this.starCon=null)},Object.defineProperty(t.prototype,"x",{set:function(t){this.icon.x=t+this._posOffset,this.qGrid.x=t,this.numTxt.x=this.icon.x+(this.icon.width-this.numTxt.width*this.numTxt.scaleX)/2,this.jlTxt.x=this.icon.x+(this.icon.width-this.jlTxt.width*this.numTxt.scaleX)/2,this.starCon&&(this.starCon.x=this.icon.x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{set:function(t){this.icon.y=t+this._posOffset,this.qGrid.y=t,this.jlTxt.y=this.icon.y+1,this.numTxt.y=this.icon.y+(this.icon.height-this.numTxt.height*this.numTxt.scaleY),this.starCon&&(this.starCon.y=this.icon.y+(this.icon.height-this.starCon.height*this.starCon.scaleX))},enumerable:!0,configurable:!0}),t.prototype.disabled=function(t){t?(this.icon&&(this.icon.filters=[]),this.qGrid&&(this.qGrid.filters=[])):(this.icon&&(this.icon.filters=FilterUtils.disabled()),this.qGrid&&(this.qGrid.filters=FilterUtils.disabled()))},t.prototype.addToParent=function(t,e){if(!this.icon)throw new Error("请先调用init初始化道具元素");this.qGrid.parent||(t.addChildAt(this.qGrid,0),t.addChild(this.icon),e.addChild(this.numTxt),e.addChild(this.jlTxt),this.starCon&&t.addChild(this.starCon))},t.prototype.relase=function(){this.icon&&(this.icon.parent&&this.icon.parent.removeChild(this.icon),this.icon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchIcon,this)),this.qGrid&&this.qGrid.parent&&this.qGrid.parent.removeChild(this.qGrid),this.numTxt&&this.numTxt.parent&&this.numTxt.parent.removeChild(this.numTxt),this.jlTxt&&this.jlTxt.parent&&this.jlTxt.parent.removeChild(this.jlTxt),this.clearStarCon(),this.clearBossStar(),this.touchEnabled=!1,this.disabled(!0),this._touchCb=null,this._touchThis=null},t.createStar=function(){t.starPool||(t.starPool=[]);var e=t.starPool.pop();return e||(e=new eui.Image("com_json.bw_x1"),e.width=e.height=28),e},t.create=function(){t.pool||(t.pool=[]);var e=t.pool.pop();return e||(e=new t),e},t.release=function(e){e&&(e.relase(),-1==t.pool.indexOf(e)&&t.pool.push(e))},t.BASE_SIZE=115,t.iconScale=.87,t}();__reflect(ItemGrid.prototype,"ItemGrid");var ItemGridCon=function(){function t(){this.modelId=0,this._textAlign=egret.HorizontalAlign.LEFT,this._isOneLine=!1,this.topSpace=2,this.grids=[]}return t.prototype.initGridsByNum=function(t,e,i,s,o){void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),this._gridSize=e,this._showlv=i,this._showDefult=o,this._isOneLine=s;for(var n=0;t>n;n++)this.createGrid(n,0,0,e,i,o)},t.prototype.initGridsByItems=function(t,e,i,s,o){if(void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),this._gridSize=e,this._isOneLine=s,this._showlv=i,this._showDefult=o,t)for(var n=0;n<t.length;n++){var r=t[n];this.createGrid(n,r.id,r.num,e,i,o)}},t.prototype.resetGridNum=function(t){if(this.grids.length<t){for(var e=this.grids.length;t>e;e++)this.createGrid(e,0,0,this._gridSize,this._showlv,this._showDefult);this._textParent?this.addGrids(this._iconParent,this._textParent):this.addGrids(this._con1,this._con3),this.textAlign=this._textAlign}else if(this.grids.length>t)for(var i=this.grids.length-t,e=0;i>e;e++){var s=this.grids.pop();ItemGrid.release(s)}},t.prototype.setTouchCb=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=null),this._isShowTips=t,this._touchCb=e,this._touchThis=i},t.prototype.onTouchGrid=function(t,e,i){this._isShowTips&&t.showItemTip(e,i,this.modelId),this._touchCb&&this._touchThis&&this._touchCb.call(this._touchThis,t,e,i)},t.prototype.createGrid=function(t,e,i,s,o,n){var r=ItemGrid.create();r.init(t,e,i,s,n),r.addTouchCb(this.onTouchGrid,this),this.grids.push(r)},t.prototype.setItems=function(t,e,i,s){void 0===e&&(e=!1),void 0===i&&(i=""),void 0===s&&(s=[0]);for(var o=0;o<this.grids.length;o++){var n=this.grids[o];n.icon.source=null;var r=s[o];if(o<t.length){var h=t[o];n.setItem(h.id,h.num,e,i,r)}else n.setItem(0,0,e,i,r)}},t.prototype.getNumOfOneline=function(t,e,i,s){if(0==t||this._isOneLine)return this._isOneLine?s:99999;var o=Math.floor(t/(i+e));return t%(i+e)>=i&&o++,o>s?s:o},t.prototype.clearIcon=function(){for(var t=0,e=this.grids;t<e.length;t++){var i=e[t];i.icon.source=null}},t.prototype.addToParent=function(t,e,i,s,o,n){void 0===s&&(s=null),void 0===o&&(o=0),void 0===n&&(n=!0),i&&(this._hSpace=t,this._vSpace=e,this._width=o||i.width,s?(this._iconParent=i,this._textParent=s,s&&(s.touchEnabled=!1,s.touchChildren=!1),n||(s.visible=!1),this.addGrids(i,s)):(this.initCon(i),n||(this._con3.visible=!1),this.addGrids(this._con1,this._con3)),this.textAlign=this._textAlign)},t.prototype.addGrids=function(t,e){void 0===e&&(e=null);for(var i=0,s=this.grids;i<s.length;i++){var o=s[i];o.addToParent(t,e)}},t.prototype.initCon=function(t){this._con1=new eui.Group,this._con3=new eui.Group,this._con3.touchEnabled=!1,this._con3.touchChildren=!1,t.addChild(this._con1),t.addChild(this._con3)},Object.defineProperty(t.prototype,"textAlign",{set:function(t){var e=this.getNumOfOneline(this._width,this._hSpace,this._gridSize,this.grids.length),i=this._width-(e*this._gridSize+(e-1)*this._hSpace),s=0;i>0&&(t==egret.HorizontalAlign.CENTER?s=Math.round(i/2):t==egret.HorizontalAlign.RIGHT&&(s=i));for(var o=0;o<this.grids.length;o++){var n=this.grids[o];n.x=s+o%e*(this._gridSize+this._hSpace),n.y=Math.floor(o/e)*(this._gridSize+this._vSpace)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){var t=this.getNumOfOneline(this._width,this._hSpace,this._gridSize,this.grids.length);return Math.floor(this.grids.length/t)*(this._gridSize+this._vSpace)+this._gridSize},enumerable:!0,configurable:!0}),t.prototype.updateRedDot=function(){},t.prototype.release=function(){for(var t=0,e=this.grids;t<e.length;t++){var i=e[t];ItemGrid.release(i)}this.grids=[],this._con1&&this._con1.parent&&(this._con1.parent.removeChild(this._con1),this._con3.parent.removeChild(this._con3),this._con1=null,this._con3=null),this._iconParent=null,this._textParent&&(this._textParent.visible=!0),this._textParent=null,this.modelId=0,this._touchCb=null,this._touchThis=null},t.create=function(){t.pool||(t.pool=[]);var e=t.pool.pop();return e||(e=new t),e},t.release=function(e){e&&(e.release(),-1==t.pool.indexOf(e)&&t.pool.push(e))},t}();__reflect(ItemGridCon.prototype,"ItemGridCon");var ItemID=function(){function t(){}return t.DIAMOND=10001,t.GOLD=10003,t.SHUIJING=10002,t.GUILD_HB=10005,t.RESETATR=10010,t.RESETSKILL=10011,t.SKILLITEM=10012,t.PETEXP=12002,t.PETHY=12004,t.PETHP=12003,t.DBT_ITEM=10019,t.JYS_ITEM=10020,t.YP_ITEM_0=10006,t.YP_ITEM_1=10007,t.YP_ITEM_2=10008,t.YP_ITEM_3=10009,t.STONE_1=10101,t.HUOYUEDU=10034,t.JIAZI=12001,t.ARENA_JF=10037,t.STONE_JL=10043,t.STONE_TL=10051,t.STONE_GJTL=10042,t.MVP_MEDAL=10056,t.CHUIZI=10087,t}();__reflect(ItemID.prototype,"ItemID");var ItemType;!function(t){t[t.HUOBI=1]="HUOBI",t[t.XIAOH=2]="XIAOH",t[t.QH=3]="QH",t[t.EQUIP=4]="EQUIP",t[t.CARD=5]="CARD",t[t.TOUS=6]="TOUS",t[t.SHENGJI=7]="SHENGJI",t[t.CIAOL=8]="CIAOL",t[t.XINGSHI=12]="XINGSHI",t[t.YINGZI=9]="YINGZI",t[t.MOSHI=13]="MOSHI"}(ItemType||(ItemType={}));var ItemQuality;!function(t){t[t.WHILE=1]="WHILE",t[t.GREEN=2]="GREEN",t[t.BLUE=3]="BLUE",t[t.PURPLE=4]="PURPLE",t[t.ORANGE=5]="ORANGE",t[t.GOLDEN=6]="GOLDEN",t[t.RED=7]="RED"}(ItemQuality||(ItemQuality={}));var ItemManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_item.json",this.initConfig,this)}return t.prototype.initConfig=function(t){if(this._itemCfgs=[],t)for(var e=0,i=t;e<i.length;e++){var s=i[e],o=new ItemCfg;o.id=s.id,o.type=s.type,o.name=s.name,o.icon=s.icon,s.d&&(o.des=s.d),s.gw&&(o.getWay=s.gw),s.enabled&&(o.enabled=s.enabled),s.sell&&(o.sell=s.sell),s.buy&&(o.buy=s.buy),s.maxNum&&(o.maxNum=s.maxNum||1),s.jd&&(o.stage=s.jd),s.exp&&(o.exp=s.exp),s.use&&(o.use=s.use),s.buffitem&&(o.buffitem=s.buffitem),s.bossitem&&(o.isBoss=!0),s.ljexp&&(o.ljExp=s.ljexp),s.guildattr&&(o.guildattr=s.guildattr),o.quality=s.q,this._itemCfgs[o.id]=o}},t.prototype.getItemCfg=function(t){return this._itemCfgs&&this._itemCfgs[t]?this._itemCfgs[t]:null},t.prototype.getContainer=function(){return this._container||(this._container=new Container(GmGlobal.mc.role.roleId)),this._container},t.prototype.getItemList=function(){return this._container?this._container.items:null},t.prototype.clearContainer=function(){if(this._container){for(var t in this._container.items)Item.release(this._container.items[t]);this._container.items={}}},t.prototype.updateItem=function(t,e){var i=this.getContainer();i.updateItem(t,e)},t.prototype.getItem=function(t){return this._container?this._container.items[t]:null},t.prototype.getEqpItem=function(t){if(!this._container)return null;var e=this._container.items;for(var i in e){var s=e[i];if(t==s.num)return s}},t.prototype.getItemNum=function(t){if(this._container){var e=this._container.items[t];return e?e.num:0}return 0},t.prototype.hasItemInType=function(t){var e=this.getContainer();for(var i in e.items){var s=this._container.items[i];if(0!=s.num){var o=this._itemCfgs[i];if(o&&t&&t.indexOf(o.type)>=0)return!0}}return!1},t.prototype.getItemListByType=function(t,e){void 0===t&&(t=null),void 0===e&&(e=1);var i=[],s=this.getContainer();for(var o in s.items){var n=this._container.items[o];if(0!=n.num){var r=void 0;if(r=Number(o)>1e4?this._itemCfgs[o]:this._itemCfgs[n.num],r&&(!t||t.indexOf(r.type)>=0)&&1!=r.type){for(var h=0;h<i.length;h++){var a=i[h],l=void 0;if(l=Number(a.id)>1e4?this._itemCfgs[a.id]:this._itemCfgs[a.num],r.type==ItemType.QH||r.type==ItemType.XINGSHI){if(r.id<l.id)break}else if(1==e){if(r.quality>l.quality||r.quality==l.quality&&r.id>l.id)break}else if(r.quality<l.quality||r.quality==l.quality&&r.id>l.id)break}i.splice(h,0,n)}}}return i},t.prototype.getItemIconK=function(t){var e=this.getItemCfg(t);return e?"item_json.q_"+e.quality:"item_json.item_com0"},t.prototype.getItemIcon=function(t){var e=this.getItemCfg(t);return e?GmConst.ITEM_DIR+e.icon+".png":"item_json.item_com0"},t.prototype.getItemSicon=function(t){var e=this.getItemCfg(t);return e?"sicon_json.sicon_"+t:null},t.prototype.getBossItemQ=function(t){var e=this.getItemCfg(t);return e?"battle_json.qbq_"+e.quality:null},t.prototype.getBossItemL=function(t){var e=this.getItemCfg(t);return e?"battle_json.lq_"+e.quality:null},t.prototype.getItemBuffIcon=function(t){var e=t;return e=10006==t||10007==t?10007:10008==t||10009==t?10009:11002==t||11003==t||11004==t?11001:t,"mui_json.x"+e},t.prototype.getItemBuffEffect=function(t){return 10006==t||10007==t?"jiaxue":10008==t||10009==t?"jialan":null},t}();__reflect(ItemManager.prototype,"ItemManager");var ItemReplaceView=function(t){function e(){return t.call(this,"ItemReplaceSkin")||this}return __extends(e,t),e.instence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.show=function(){t.prototype.show.call(this,GmGlobal.vmc.uiLayer,!0)},e.prototype.setType=function(t,e,i,s,o,n){void 0===n&&(n=0),this.tTit.text=t,this._cb=s,this._cbThis=o,this._mid=n;for(var r=GmGlobal.mc.itemMgr.getItemListByType([e]),h=0;h<r.length;h++){var a=r[h];i&&-1!=i.indexOf(a.id)&&(r.splice(h,1),h--)}r&&r.length>0&&(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(r,115,!1,!1,!0),this._itemGridCon.addToParent(5,5,this.itemCon,null,this.scroll.width,!1),this._itemGridCon.setTouchCb(!1,this.onItem,this))},e.prototype.onItem=function(t,e,i){var s=GmGlobal.mc.itemMgr.getItemCfg(t.itemId);s&&(s.type==ItemType.EQUIP&&t.uid?EquipTips.show(t.uid,e,i):ItemTips.show(t.itemId,e,i,0,null,0,0,this._mid==ModelID.XINGZUO?3:0))},e.prototype.clearGrids=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.close=function(){this._cb=null,this._cbThis=null,this.clearGrids(),t.prototype.close.call(this)},e}(UIBase);__reflect(ItemReplaceView.prototype,"ItemReplaceView");var ItemView=function(t){function e(){var e=t.call(this)||this;return e._showTip=!1,e._modelId=0,e.skinName="ItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.create=function(t,i){var s=ObjectPool.pop("ItemView");s||(s=new e),s.itemId=t,s.num=i,i>=1e6?s.numTxt.text=Utils.formatNum(i,0):0==i?s.numTxt.text="":s.numTxt.text=i.toString(),s.visible=!0;GmGlobal.mc.itemMgr.getItemCfg(t);s.iconK.source=GmGlobal.mc.itemMgr.getItemIconK(t),s.icon.source=GmGlobal.mc.itemMgr.getItemIcon(t);var o=GmGlobal.mc.itemMgr.getItemCfg(t);return o?s.star.visible=o.isBoss:s.star.visible=!1,s.jlTxt.visible=!1,s},e.release=function(t){t&&ObjectPool.push(t,"ItemView")},e.prototype.setItem=function(t,e,i,s,o){if(void 0===e&&(e=!1),void 0===i&&(i=""),void 0===s&&(s=0),void 0===o&&(o=0),t){this.itemId=t.id,this.num=t.num,this.uid=o,this.iconK.source=GmGlobal.mc.itemMgr.getItemIconK(t.id),this.icon.source=GmGlobal.mc.itemMgr.getItemIcon(t.id);var n=GmGlobal.mc.itemMgr.getItemCfg(t.id);if(n?this.star.visible=n.isBoss:this.star.visible=!1,t.num?t.num>=1e5?this.numTxt.text=Utils.formatNum(t.num,0):this.numTxt.text=t.num.toString():this.numTxt.text="",e){this.numTxt.visible=this.num>0?!0:!1;var r=GmGlobal.mc.itemMgr.getItemNum(this.itemId);TextFormat.setMoneyStr(this.numTxt,r,this.num,!0)}else this.numTxt.visible=this.num>0?!0:!1,i&&(this.numTxt.visible=!0),this.numTxt.text=i+(this.num>=1e5?Utils.formatNum(this.num,0):String(this.num));this.jlTxt.visible=s>0?!0:!1,this.jlTxt.text="+"+s,n&&n.type==ItemType.CARD?this.setStageStar(GmGlobal.mc.equipMgr.getCardCfg(n.id)):this.clearStarCon()}else this.iconK.source=GmGlobal.mc.itemMgr.getItemIconK(0),this.icon.source=GmGlobal.mc.itemMgr.getItemIcon(0),this.numTxt.text="",this.jlTxt.visible=!1,this.star.visible=!1,this.clearStarCon()},e.prototype.setStageStar=function(t){if(t&&t.star){this.clearStageStar(),this.starCon.visible=!0;for(var e=0;e<t.star;e++){var i=ItemGrid.createStar();i.x=28*e,this.starCon.addChild(i)}}else this.clearStarCon()},e.prototype.clearStageStar=function(){for(;this.starCon.numChildren>0;)ItemGrid.starPool.push(this.starCon.removeChildAt(0))},e.prototype.clearStarCon=function(){this.clearStageStar(),this.starCon.visible=!1},e.prototype.enableTip=function(t,e,i){void 0===e&&(e=GmGlobal.mc.role.roleId),void 0===i&&(i=0),this._showTip=t,this.roleid=e,this._modelId=i,t?this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this):this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)},e.prototype.onTouchItem=function(t){var e=GmGlobal.mc.itemMgr.getItemCfg(this.itemId);e&&(e.type==ItemType.EQUIP&&this.uid?EquipTips.show(this.uid,t.stageX,t.stageY,this._modelId,null,this.roleid):ItemTips.show(this.itemId,t.stageX,t.stageY,this._modelId))},e.prototype.updateIcon=function(t){this.iconK.source=GmGlobal.mc.itemMgr.getItemIconK(t),this.icon.source=GmGlobal.mc.itemMgr.getItemIcon(t);var e=GmGlobal.mc.itemMgr.getItemCfg(t);e?this.star.visible=e.isBoss:this.star.visible=!1},e.prototype.unuse=function(){this.scaleX=1,this.scaleY=1,this.anchorOffsetX=0,this.anchorOffsetY=0,this.y=0,this.x=0,this.icon.alpha=1,this.name=null,this._modelId=0,this._showTip&&(this._showTip=!1,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)),this.clearStarCon()},e.prototype.reuse=function(){},e.prototype.clear=function(){},e}(eui.Component);__reflect(ItemView.prototype,"ItemView",["IObject"]);var JingliManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_jinli.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.getJinliCfg=function(t){return this._cfg?this._cfg[t]:null},t}();__reflect(JingliManager.prototype,"JingliManager");var JingliMediator=function(){function t(){this._timerId=0,GmGlobal.mc.muiMgr.regCmd(ModelID.JINLI,CmdType.O_JINGLI),CmdBus.adListener(CmdType.O_JINGLI,this.onOpenView,this),CmdBus.adListener(CmdType.C_JINGLI,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.JINLI,this.onUpdate,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon(!0)},t.prototype.onUpdate=function(t){GmGlobal.mc.muiMgr.isInited&&(this._view&&this._view.updateBtnState(t.data.data),this.updateIcon())},t.prototype.updateIcon=function(t){if(void 0===t&&(t=!1),!PFConst.IS_NOPAY){var e=GmGlobal.mc.dataMgr.getJData(JsonID.JINLI).data,i=e.state||0,s=e.time||0,o=Math.max(s-GmGlobal.getServerTime(),0);o>0&&2>i?(CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.JINLI,"mui_json.mui_b_jl"),0!=this._timerId&&egret.clearTimeout(this._timerId),this._timerId=egret.setTimeout(this.onTimeOut,this,1e3*o)):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.JINLI)}},t.prototype.onTimeOut=function(){this._timerId=0,CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.JINLI)},t.prototype.onOpenView=function(t){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new JingliView),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&(this._view.alphaClose(this._view.closeAndDestroy,this._view),this._view=null)},t}();__reflect(JingliMediator.prototype,"JingliMediator");var JingliView=function(t){function e(){var e=t.call(this,"JingliSkin")||this;return e._state=0,e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.update()},e.prototype.update=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.JINLI),i=t.jinliMgr.getJinliCfg(e.data.id);if(this._cfg=i,this._cfg){this._itemGridCon&&ItemGridCon.release(this._itemGridCon),i&&(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(i.items,110),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,10,this.itemCon,this.textCon,630),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER);var s=Math.max(e.data.time-GmGlobal.getServerTime(),0);s>0&&CDText.getInstence().addCD(this.cd,s),this.updateBtnState(e.data)}},e.prototype.updateBtnState=function(t){if(this._cfg){var e=t.state||0;if(2==e||0==e&&1==this._state)return this.buyBtn.visible=!1,this.okBtn.visible=!0,this.okBtn.label="Claimed",void Utils.setBtnEnable(this.okBtn,!1);this._state=e,e?1==e&&(this.buyBtn.visible=!1,this.okBtn.visible=!0,Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="Claim"):(this.buyBtn.visible=!0,this.okBtn.visible=!1,this.buyBtn.setPrice(this._cfg.oprice,this._cfg.price))}},e.prototype.onBuy=function(){if(!this._state){var t=GmGlobal.mc.dataMgr.getJData(JsonID.JINLI),e=t.data.time||0,i=Math.max(e-GmGlobal.getServerTime(),0);if(0==i)return void MsgBox.prompt("Event ended");GmGlobal.cc.pfCtl.Pay(100*this._cfg.price,3)}},e.prototype.onBtn=function(){1==this._state&&GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_JINLI)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_JINGLI)},e.prototype.close=function(){CDText.getInstence().rmCD(this.cd),this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),this._cfg=null,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("jl_bg_jpg")},e}(UIBase);__reflect(JingliView.prototype,"JingliView");var AwardId=function(){function t(){}return t.USE_ITEM=1e3,t.KQ_BOX=1001,t.FULI_TZ_AW=1002,t}();__reflect(AwardId.prototype,"AwardId");var DataController=function(){function t(){this._t=0,this._preT=0,this._reqActions={},this._reqAwards={},this._reqCBs={},this._pbCbs={};var t=GmGlobal.server;t.regUpdCb(MsgID.UPD_JDATA,this.onJsonDataUpdate,this),t.regUpdCb(MsgID.UPD_ROLE_DATAS,this.onUpdateRoleDatas,this),t.regUpdCb(MsgID.PB_DATA,this.onPbData,this),t.regUpdCb(MsgID.RET_CODE,this.onMsgRetCode,this),this.regPbCb(PbMsgId.TIPS,this.onTips,this),this.regPbCb(PbMsgId.RETCODE,this.onRetCode,this)}return t.prototype.replaceMsg=function(t){return t.replace(/\u0000|\u0001|\u0002|\u0003|\u0004|\u0005|\u0006|\u0007|\u0008|\u0009|\u000a|\u000b|\u000c|\u000d|\u000e|\u000f|\u0010|\u0011|\u0012|\u0013|\u0014|\u0015|\u0016|\u0017|\u0018|\u0019|\u001a|\u001b|\u001c|\u001d|\u001e|\u001f|\u007F/g,"")},t.prototype.onJsonDataUpdate=function(t){t.data=this.replaceMsg(t.data);var e=GmGlobal.mc.dataMgr.getJData(t.id);if(e?e.data=JSON.parse(t.data):(e=new JsonData(t.id,JSON.parse(t.data)),GmGlobal.mc.dataMgr.setJData(e)),e.id==JsonID.CACHE);else if(e.id==JsonID.TOAST)if(e.data.award){var i=[];for(var s in e.data.award)i.push(Item.create(Number(s),e.data.award[s]));AwardGetTipView.showAward(i,null,null,null,e.data.msg)}else if(e.data.ok)ServerConfirmBox.getInstence().setData(e.data);else if(e.data.mask){var o=ActionAlertBox.getInstance();o.setType(e.data.mask),o.updateBox(e.data.msg),o.show(GmGlobal.vmc.uiLayer)}else if(MsgBox.alert(e.data.msg,AwardGetTipView.getAward,AwardGetTipView),e.data.evt){var n=e.data.evt,r=n.split(" ");if(r.length>0){var h=r[0];r.splice(0,1),EventBus.dispatchEvt(h,r)}}EventBus.dispatchEvt(EventType.M_JUPD+e.id,e)},t.prototype.onUpdateRoleDatas=function(t){for(var e=0,i=t.datas;e<i.length;e++){var s=i[e];this.onJsonDataUpdate(s)}},t.prototype.onMsgRetCode=function(t){GmGlobal.cc.dataCtl.showLackTips(t.retCode)},t.prototype.onTips=function(t){if(t.pos&&"zmd"==t.pos){var e=Utils.replaceColorCode(t.txt);Horselamp.showHText(e),GmGlobal.cc.chatCtl.addMsg(e,ChatChannel.SYS)}else GmGlobal.cc.chatCtl.addTishi(Utils.replaceColorCode(t.txt),ChatChannel.WORLD)},t.prototype.onRetCode=function(t){var e=[];for(var i in t)"1"!=i&&e.push(t[i]);var s=GmGlobal.mc.txtMgr.getRetCode(t[1],e);MsgBox.prompt(s)},t.prototype.regPbCb=function(t,e,i){this._pbCbs[t]=new CallBack(e,i)},t.prototype.unRegPbCb=function(t){var e=this._pbCbs[t];e&&(e.cb=null,e.target=null,delete this._pbCbs[t])},t.prototype.onPbData=function(t){var e=this._pbCbs[t.url];e&&(t.body?e.cb.call(e.target,JSON.parse(t.body)):e.cb.call(e.target,null))},t.prototype.cacheDataToServer=function(t,e){var i=MsgStruct.getMsg(MsgID.REQ_DO_ACTION);if(i){for(var s=GmGlobal.mc.dataMgr.getJData(JsonID.CACHE),o=[],n=0;n<e.length;n++){var r=t+n,h=e[n];o.push(r),o.push(h),s.data[r]=h}i.id=ServerActionId.SET_CACHEDATA,i.argv=o,GmGlobal.server.sendMsg(MsgID.REQ_DO_ACTION,i,null)}},t.prototype.cacheDayDataToServer=function(t){var e=MsgStruct.getMsg(MsgID.REQ_DO_ACTION);if(e){for(var i=GmGlobal.mc.dataMgr.getJData(JsonID.DAY_CACHE),s=0;s<t.length;s+=2)i.data[t[s]]=t[s+1];e.id=ServerActionId.SET_DAYCACHE,e.argv=t,GmGlobal.server.sendMsg(MsgID.REQ_DO_ACTION,e,null)}},t.prototype.getActionTime=function(){var t=egret.getTimer();return t>this._preT&&(this._t+=t-this._preT),this._preT=t,Math.floor(this._t/1e3)},t.prototype.doAction=function(t,e,i,s,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null);var n=this._reqActions[t];if(n&&GmGlobal.server.hasSerialCallback(n))return MsgBox.prompt(TextConst.AWAIT_SERVER),0;var r=MsgStruct.getMsg(MsgID.REQ_DO_ACTION);if(!r)return 0;var h=this;r.id=t,r.argv=e||[],r.time=this.getActionTime();var a=GmGlobal.server.sendMsg(MsgID.REQ_DO_ACTION,r,function(e,i){if(delete h._reqActions[t],e.datas)for(var s=0,o=e.datas;s<o.length;s++){var n=o[s];h.onJsonDataUpdate(n)}0!=e.retCode&&h.showLackTips(e.retCode),h.doActionCb(i,e.retCode)});return this._reqActions[t]=a,(i||o||s)&&(this._reqCBs[a]={ok:i,fail:o,thisObj:s}),a},t.prototype.doActionCb=function(t,e){var i=this._reqCBs[t];i&&(0==e?i.ok&&i.ok.call(i.thisObj,e):42==e||207==e||210==e||212==e?i.ok&&i.ok.call(i.thisObj,e):i.fail&&i.fail.call(i.thisObj,e),delete this._reqCBs[t])},t.prototype.clearReqCbByThis=function(t){for(var e in this._reqCBs){var i=this._reqCBs[e];if(i&&i.thisObj==t)return void delete this._reqCBs[e]}},t.prototype.doNoCheckAction=function(t,e,i,s,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null);var n=MsgStruct.getMsg(MsgID.REQ_DO_ACTION);if(!n)return 0;var r=this;n.id=t,n.argv=e||[],n.time=this.getActionTime();var h=GmGlobal.server.sendMsg(MsgID.REQ_DO_ACTION,n,function(t){if(t.datas)for(var e=0,i=t.datas;e<i.length;e++){var s=i[e];r.onJsonDataUpdate(s)}0!=t.retCode&&r.showLackTips(t.retCode),r.doActionCb(h,t.retCode)});return s&&(this._reqCBs[h]={ok:i,fail:o,thisObj:s}),h},t.prototype.showLackTips=function(t){switch(t){case 22:ItemLackTips.instance().tiliTips();break;case 27:ItemLackTips.instance().diamondTips();break;case 20:ItemLackTips.instance().itemsTips();break;case 238:ItemLackTips.instance().ybTips();break;case 204:ItemLackTips.instance().shuijTips();break;case 266:ItemLackTips.instance().qhTips();break;case 267:ItemLackTips.instance().jlTips();break;case 268:ItemLackTips.instance().dzTips();break;case 271:ItemLackTips.instance().huobanTips();break;default:GmGlobal.mc.txtMgr.showRetCode(t)}},t.prototype.reqAward=function(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null);var o=this._reqAwards[t];if(o&&GmGlobal.server.hasSerialCallback(o))return void MsgBox.prompt(TextConst.AWAIT_SERVER);var n=MsgStruct.getMsg(MsgID.REQ_GET_AWARD);if(n){n.id=t,e&&e.length>0&&(n.argv=e),n.time=this.getActionTime();var r=this,h=GmGlobal.server.sendMsg(MsgID.REQ_GET_AWARD,n,function(e,i){if(delete r._reqAwards[t],e.datas)for(var s=0,o=e.datas;s<o.length;s++){var n=o[s];r.onJsonDataUpdate(n)}if(0!=e.retCode)r.showLackTips(e.retCode),r.doAwardCb(i,e.retCode);else{for(var h=[],a=0;a<e.award.length;a++){var l=e.award[a],c=Item.create(l.id,l.num);h.push(c)}r.doAwardCb(i,e.retCode,h);for(var d=0,p=h;d<p.length;d++){var c=p[d];Item.release(c)}h=null}});this._reqAwards[t]=h,(i||s)&&(this._reqCBs[h]={ok:i,thisObj:s})}},t.prototype.doAwardCb=function(t,e,i){void 0===i&&(i=null);var s=this._reqCBs[t];s&&(s.ok&&(i?s.ok.call(s.thisObj,e,i):s.ok.call(s.thisObj,e)),delete this._reqCBs[t])},t.prototype.reqJsonData=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null);var o=MsgStruct.getMsg(MsgID.REQ_JDATA);if(!o)return 0;o.id=t,o.argv=e;var n=this;return GmGlobal.server.sendMsg(MsgID.REQ_JDATA,o,function(t){if(0==t.retCode){if(!t.data||""==t.data)return;t.data=n.replaceMsg(t.data);var e=JSON.parse(t.data);i&&s&&i.call(s,e)}else n.showLackTips(t.retCode)})},t.prototype.getShareData=function(t,e){var i=MsgStruct.getMsg(MsgID.GET_SHARE);return i?(i.id=t,GmGlobal.server.sendMsg(MsgID.GET_SHARE,i,function(t){e&&e(t.data)})):0},t.prototype.setShareData=function(t,e){var i=MsgStruct.getMsg(MsgID.SET_SHARE);i&&(i.id=t,i.data=e,GmGlobal.server.sendMsg(MsgID.SET_SHARE,i,null))},t.prototype.reportGameData=function(t,e){void 0===e&&(e=2e3);var i=MsgStruct.getMsg(MsgID.REPORT_GAMEDATA);i&&(i.id=e,i.subid=t,i.num=1,GmGlobal.server.sendMsg(MsgID.REPORT_GAMEDATA,i,null))},t.prototype.ajaxReq=function(t,e,i){var s=egret.localStorage.getItem("xj/"+GmGlobal.mc.role.roleId+t);if(s){var o=JSON.parse(s),n=Math.floor((new Date).getTime()/1e3);if(o.time>n)return void(e&&i&&e.call(i,o.content))}var r=MsgStruct.getMsg(MsgID.AJAX_REQUEST);r&&(r.data=t,GmGlobal.server.sendMsg(MsgID.AJAX_REQUEST,r,function(s){if(200==s.status&&s.content&&""!=s.content){var o=-1!=s.content.indexOf("{")?JSON.parse(s.content):s.content;if(e&&i&&e.call(i,o),s.cachetime){var n=Math.floor((new Date).getTime()/1e3),r='{"time": '+(n+s.cachetime)+', "content": '+s.content+"}";egret.localStorage.setItem("xj/"+GmGlobal.mc.role.roleId+t,r)}}else console.log("ajaxReq status:"+s.status)}))},t.prototype.pbReq=function(t,e,i,s,o){void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null);var n=MsgStruct.getMsg(MsgID.PB_REQUEST);if(n){n.url=t,e&&e.length>0&&(n.header=e),i&&(n.body=this.formatLuaData(i)),n.time=this.getActionTime();var r=this;GmGlobal.server.sendMsg(MsgID.PB_REQUEST,n,function(t){s&&s.call(o,t.retCode,t.body?JSON.parse(t.body):null),0!=t.retCode&&r.showLackTips(t.retCode)})}},t.prototype.formatLuaData=function(t){return JSON.stringify(t)},t.prototype.getCdkAward=function(t,e){var i=MsgStruct.getMsg(MsgID.REQ_GETCDK);if(!i)return 0;i.code=t;return GmGlobal.server.sendMsg(MsgID.REQ_GETCDK,i,function(t){if(0!=t.retCode)GmGlobal.mc.txtMgr.showRetCode(t.retCode);else{for(var i=t.retCode,s=[],o=0;o<t.award.length;o++){var n=t.award[o],r=Item.create(n.id,n.num);s.push(r)}e(i,s)}})},t}();__reflect(DataController.prototype,"DataController");var DataManger=function(){function t(){this._jDatas={}}return t.prototype.setJData=function(t){this._jDatas[t.id]=t},t.prototype.getJData=function(t){var e=this._jDatas[t];return e||(e=new JsonData(t,{}),this._jDatas[t]=e),e},t.prototype.clearData=function(t){delete this._jDatas[t]},t.prototype.getGiftValue=function(t,e){var i=this.getJData(JsonID.GIFT_DATA);if(0==e){if(i.data.d)return i.data.d[t]||0}else if(i.data.g)return i.data.g[t]||0;return 0},t.prototype.getDayCacheValue=function(t){var e=this._jDatas[JsonID.DAY_CACHE];return e?e.data[t]||0:0},t.prototype.getLocalDataValue=function(t){var e=this._jDatas[JsonID.CACHE];return e?e.data[t]||0:0},t.prototype.setDayCacheValue=function(t,e){var i=this._jDatas[JsonID.DAY_CACHE];i||(i=new JsonData(JsonID.DAY_CACHE,{}),this._jDatas[JsonID.DAY_CACHE]=i),i.data[t]=e},t}();__reflect(DataManger.prototype,"DataManger");var FubenType=function(){function t(){}return t.getClientType=function(e){return e==t.TB_BOSS||e==t.TB_XINGZUO||e==t.TB_DATI?t.TB_DATI:e==t.CT_PT||e==t.CT_SY?t.CT_PT:e==t.WANGZUO||e==t.WANGZUO2||e==t.WANGZUO3||e==t.WANGZUO4||e==t.WANGZUO5||e==t.WANGZUO6||e==t.WANGZUO7||e==t.WANGZUO8||e==t.WANGZUO9||e==t.WANGZUO10?t.WANGZUO:e==t.MK01||e==t.MK02||e==t.MK03||e==t.MK04||e==t.MK05||e==t.MK06||e==t.MK07?t.MK01:e>=9351&&9370>=e||e>=9391&&9394>=e?t.YCKJ:e},t.getFubenName=function(e){var i=t.getClientType(e);return i==t.TB_DATI?"Rift Explore":i==t.GHZ?"Guild War":i==t.GH_BOSS?"Guild BOSS":i==t.WANGZUO?"Battle of Throne":i==t.MAOMAO?"Whose Cat":i==t.YCKJ?"Altverse":""},t.getFubenOpenCmd=function(e){var i=t.getClientType(e);return i==t.TB_DATI?{cmd:CmdType.O_WANFA,a:3}:i==t.WANGZUO?{cmd:CmdType.O_WANFA,a:4}:i==t.MK01?{cmd:CmdType.O_WANFA,a:10}:i==t.GH_BOSS?{cmd:CmdType.O_GONGHUI,a:2}:i==t.GHZ?{cmd:CmdType.O_GONGHUI,a:3}:i==t.ARENA?{cmd:CmdType.O_WANFA,a:0}:i==t.SHENY?{cmd:CmdType.O_WANFA,a:6}:i==t.MAOMAO?{cmd:CmdType.O_WANFA,a:11}:i==t.SWSX?{cmd:CmdType.O_WANFA,a:12}:i==t.YCKJ?{cmd:CmdType.O_YCKJ,a:0}:null},t.getFubenModelId=function(e){var i=t.getClientType(e);return i==t.TB_DATI?ModelID.WANFA:i==t.WANGZUO?ModelID.WANFA:i==t.MK01?ModelID.WANFA:i==t.GH_BOSS?ModelID.GONGHUI:i==t.GHZ?ModelID.GONGHUI:i==t.ARENA?ModelID.WANFA:i==t.SHENY?ModelID.WANFA:i==t.SWSX?ModelID.SWSX:-1},t.isNoFightFb=function(e){return e==t.TB_DATI||e==t.TB_XINGZUO||e==t.YABIAO_Y||e==t.YABIAO_J?!0:!1},t.getFubenExitTip=function(e){var i=t.getClientType(e);return e==t.CT_PT||e==t.CT_SY?null:e==t.ARENA||e==t.YABIAO_F?"Battle in progress. Leave?":e==t.JXGC?"Rewards will be settled if you leave. Are you sure?":e==t.MK01||e==t.SWSX?"Dungeon in progress. Leave?":i==t.YCKJ?"You will quit the team if you quit the dungeon.":"Event in progress. Leave?"
},t.isPvpFuben=function(e){var i=t.getClientType(e);return i==t.YABIAO_F||i==t.ARENA||i==t.DAOC||i==t.JZTXB?!0:!1},t.isHdEnd=function(e){if(e==t.TB_DATI||e==t.TB_BOSS||e==t.TB_XINGZUO){var i=GmGlobal.mc.wfMgr.getWfData(t.TB_DATI);return i.isEnd?!0:!1}if(e==t.WANGZUO||e==t.WANGZUO2||e==t.WANGZUO3||e==t.WANGZUO4||e==t.WANGZUO5||e==t.WANGZUO6||e==t.WANGZUO7||e==t.WANGZUO8||e==t.WANGZUO9||e==t.WANGZUO10){var i=GmGlobal.mc.wfMgr.getWfData(t.WANGZUO);return i.isEnd?!0:!1}return!1},t.isNoGoback=function(e){var i=t.getClientType(e);return i==t.YABIAO_F||i==t.ARENA||i==t.CT_PT||i==t.DAOC||i==t.JZTXB?!0:!1},t.isNoTouch=function(e){return e==t.ARENA||e==t.DAOC||e==t.JZTXB?!0:!1},t.isYckjBossMap=function(t){return t>=9391&&9394>=t?!0:!1},t.CITY=9991,t.TB_DATI=9202,t.TB_XINGZUO=9209,t.TB_BOSS=9210,t.CT_PT=9206,t.CT_SY=9208,t.WANGZUO=9203,t.WANGZUO2=9301,t.WANGZUO3=9302,t.WANGZUO4=9304,t.WANGZUO5=9305,t.WANGZUO6=9306,t.WANGZUO7=9307,t.WANGZUO8=9308,t.WANGZUO9=9309,t.WANGZUO10=9310,t.GHZ=9218,t.GH_BOSS=9216,t.YABIAO_Y=9204,t.YABIAO_J=9217,t.YABIAO_F=9207,t.ARENA=9205,t.JXGC=9212,t.SHENY=9213,t.DAOC=9215,t.MK01=9401,t.MK02=9402,t.MK03=9403,t.MK04=9404,t.MK05=9405,t.MK06=9406,t.MK07=9407,t.MK_CD=9408,t.MAOMAO=9219,t.SWSX=9409,t.YCKJ=9351,t.JZTXB=9410,t.JZTXB_W=94100,t}();__reflect(FubenType.prototype,"FubenType");var GameReportType=function(){function t(){}return t}();__reflect(GameReportType.prototype,"GameReportType");var JsonID=function(){function t(){}return t.TOAST=1,t.ONLINE_TIME=2,t.LOGIN_DAY=3,t.GIFT_DATA=6,t.CACHE=7,t.DAY_CACHE=8,t.U_CONTAINER=9,t.ROLE_DATA=11,t.PAY=19,t.U_EQUIPS=26,t.U_EQUIP=27,t.U_EQUIPS_YZ=94,t.U_EQUIP_YZ=93,t.U_EQP_CARD=30,t.U_HERO=23,t.U_EITEM=71,t.U_EITEMS=100,t.U_TOUSHI=31,t.U_TOUSHI_LST=80,t.U_TOUSHI_ONE=81,t.U_TOUSHI_SC=98,t.U_SKILL_LST=25,t.U_SKILL_ONE=24,t.U_SKILL_LEFT=57,t.U_PET=28,t.U_PET_LST=78,t.U_PET_ONE=79,t.PET_AWARD=172,t.PET_CH=165,t.PET_CH_S=166,t.U_GQ_BX=86,t.U_EQP_JL_C=91,t.U_FL_QD=33,t.U_WD_QD=152,t.U_FL_LB=35,t.U_FL_LIANC=85,t.U_FL_Lc=21,t.U_FL_ND=34,t.U_FL_ND_AWARD=92,t.U_SHOP=32,t.U_SHOP_ZS=20,t.U_VIP=65,t.U_FIRSTPAY=87,t.U_TRADE_SELL=58,t.U_TRADE_GZ=59,t.U_TRADE_LOW_PRICE=112,t.U_GUILD=43,t.U_GUILD_SQ_LST=45,t.U_GUILD_LST=47,t.U_GUILD_M_LST=48,t.U_GUILD_FL=49,t.U_GUILD_DD=50,t.U_GUILD_FL_ITEM=61,t.U_GUILD_HZ=53,t.U_GUILD_HZ_TIME=56,t.U_RWD=36,t.U_RWD_RC=37,t.U_RWD_RC_ONE=38,t.U_RWD_TZ=39,t.U_RWD_TZ_ONE=40,t.U_RWD_SJ=41,t.U_RWD_SJ_ONE=42,t.U_MVP_NUM=135,t.U_MVP_NUM_ONE=136,t.U_MVP_LST=115,t.U_MPV_AW=116,t.U_HUOB_INFOS=96,t.U_HUOB_INFO=97,t.U_HUOB_ZR=120,t.U_BAOWU_INFOS=95,t.U_BAOWU_INFO=122,t.U_HAOLI=123,t.U_YIYUAN=127,t.U_DAY7=162,t.U_DAY7_TZ=130,t.U_DAY7GIFT=139,t.U_CAT=126,t.TASK_DAY=14,t.TASK_DAY_ONE=15,t.TASK_GROW=16,t.TASK_GROW_ONE=17,t.TASK_BOX=18,t.GUIDE_TASK=88,t.TASK_LOOP=115,t.TASK_LOOP_D=124,t.TASK_LOOP_ONE=125,t.TASK_WEEK=218,t.JINLI=64,t.XZ_UPD=62,t.XZ_UPD_S=82,t.ARENA_UPD=67,t.ARENA_ZB=68,t.ARENA_JFAW=69,t.ARENA_RTIME=70,t.CT_UPD=76,t.CT_SDAW=111,t.YB_UPD=72,t.FB_OPEN=51,t.FB_CLOSE=52,t.GJ_UPD=89,t.WZ_UPD=29,t.WZ_SH_STATE=56,t.JXGC_UPD=110,t.MK_UPD=142,t.GTASK=131,t.SY_UPD=117,t.DC_UPD=107,t.DC_ZB_UPD=108,t.DC_AW=133,t.DGIFT=137,t.DGIFT_LC=138,t.DGIFT_XS=210,t.DGIFT_LB=211,t.SWEET_UPD=143,t.LJS_UPD=144,t.HUNT_UPD=145,t.HUNT_AWD_UPD=146,t.HUNT_TIME_LOG=147,t.HUNT_PAY=149,t.U_SHARE=150,t.U_TITLE=153,t.U_VIP1=154,t.PILAO=151,t.TAKE_RECORD=157,t.SWSX=160,t.U_SHIPIN=161,t.TXK=163,t.HALO=164,t.SHOP_LB=171,t.MCJ_UPD=167,t.MCJ_TSK=170,t.MCJ_CJ_LST=168,t.MCJ_CJ_AW=169,t.QD_LJXH=174,t.QD_LJCZ=175,t.QD_LXDL=176,t.QD_DBCZ=177,t.QD_DHSD=178,t.QD_DDS=183,t.QD_DDS_D=207,t.QD_DDS_GD=184,t.QD_SMSD=182,t.QD_SMSD_LST=186,t.QD_ZCD=180,t.QD_LHJ=181,t.QD_LHJ_JFAW=203,t.QD_LHJ_DH=202,t.KFQD_LJXH=189,t.KFQD_LJCZ=190,t.KFQD_LXDL=191,t.KFQD_DBCZ=192,t.KFQD_DHSD=193,t.KFQD_DDS=194,t.KFQD_DDS_D=208,t.KFQD_DDS_GD=195,t.KFQD_SMSD=198,t.KFQD_SMSD_LST=199,t.KFQD_ZCD=197,t.KFQD_LHJ=204,t.KFQD_LHJ_JFAW=206,t.KFQD_LHJ_DH=205,t.MONTH_CARD=214,t.WEEK_CARD=215,t.ZLB=216,t.FULI_TZ=217,t.MOSHI=222,t.MOSHI_ONE=221,t.WENJUAN=220,t.JZTXB=224,t.JSON_END=1e3,t}();__reflect(JsonID.prototype,"JsonID");var JsonReqId=function(){function t(){}return t.TB_OPEN_STATE=1001,t.WZ_OPEN_STATE=1002,t.GUILD_BOSS=1003,t.GUILD_HZ=1004,t.CAT_LST=1005,t.CAT_CJ=1006,t.HERO_JJ_ATR=1007,t.DGIFT_LC=1008,t.TUJIAN_KILLNUM=1009,t.TAKE_RECORD=1011,t.MCJ_CJ=1012,t.QD_DDS_LEAVE=1013,t.QD_DDS=1014,t.KFQD_DDS_LEAVE=1015,t.KFQD_DDS=1016,t.QD_ZCD=1019,t.KFQD_ZCD=1020,t.QD_LHJ_CJ=1017,t.KFQD_LHJ_CJ=1018,t}();__reflect(JsonReqId.prototype,"JsonReqId");var LocalDataId=function(){function t(){}return t.LOG_V=1,t.GUIDEID=2,t.GUIDE_STATE=3,t}();__reflect(LocalDataId.prototype,"LocalDataId");var LocalDayDataId=function(){function t(){}return t.TISHI_NUM=1,t}();__reflect(LocalDayDataId.prototype,"LocalDayDataId");var PbMsgId=function(){function t(){}return t.PRELOAD_SCENE="prejumpScene",t.KILLAWARD="scene.killaward",t.UNIT_SP="scene.sp",t.UNIT_HP="scene.hp",t.TB_DT="mj.dati",t.FB_COMPLETE="fubenover",t.BUFF_ICON="buff.icon",t.EQP_CON="container.createequipitem",t.BATTLE_RANK="battle.rank",t.SCORE_RANK="score.rank",t.TOWER_BUFF="tower.monsterbuff",t.TOWER_FLOOR="tower.floorlv",t.FUBEN_AW="receiveaward",t.TOWER_NEXT_MST="tower.monstershow",t.YB_LIST="escortcar.teamcarlst",t.PVP_TIME="pvp.endtime",t.GUILD_LST="guild.guildlst",t.GUILD_M_LST="guild.memberlst",t.YCSHOP_AW="MsgHideShop.AddAward",t.TIPS="tips",t.FB_TEAM="team.list",t.FB_INVITE="team.invite",t.JXGC_BATCH="mfactory.wave",t.JXGC_BOSSSHOW="mfactory.bossshow",t.MVP_ALIVE="mvp.bossalive",t.SY_BATCH="deepmirage.wave",t.SY_TIME="deepmirage.mwave",t.SY_BUFF="deepmirage.monsterbuff",t.MK_SINFO="cave.info",t.MK_S_BOX="cave.box",t.MK_CDBOSS="cave.cbossinfo",t.BOSS_FB="cave.bossfuben",t.HUNT_TIME_INFO="timeauction.refreshItemlst",t.SKILL_CD="skill.cd",t.MM_TIP="whosecat.tips",t.MM_CATNUM="whosecat.catinfo",t.RETCODE="parameterretcode",t.SX_INFO="gstatue.floorinfo",t.KF_FLAG="kfFlag",t.YCKJ_AW="adi.award",t.JZT_FDATA="pyramid.map",t.JZT_RANDOM="pyramid.random",t.JZT_ALIVE="pyramid.alive",t.JZT_RPOS="pyramid.setpos",t}();__reflect(PbMsgId.prototype,"PbMsgId");var PbReqId=function(){function t(){}return t.UNIT_WALK="scene.MsgRole.walk",t.UNIT_ATTACK="scene.MsgRole.atkNormal",t.UNIT_STAND="scene.MsgRole.stand",t.UNIT_SKILL="scene.MsgRole.atkSkill",t.PET_WALK="scene.MsgPet.walk",t.PET_STAND="scene.MsgPet.stand",t.TRADE_RITEM="trade.MsgTradingHouse.refreshItem",t.TRADE_GZITEM="trade.MsgTradingHouse.queryFocusItem",t.TRADE_ZS="trade.MsgTradingHouse.queryRoleItems",t.PET_ATTACK="scene.MsgPet.atkNormal",t.GUILD_CREATE="scene.MsgGuild.createGuild",t.GUILD_REQ="guild.MsgGuild.getGuildList",t.GUILD_M_REQ="guild.MsgGuild.getGuildMemberList",t.GUILD_JF="guildpvp.queryRoleRank",t.GUILD_GHJF="guildpvp.queryGuildRank",t.GUILD_BOSS_JF="guildboss.queryRoleRank",t.GUILD_B_DATA="guildpvp.queryRank",t.TB_DATI="scene.MsgMjDati.dati",t.TB_XINGZUO="scene.MsgMjCircle.dati",t.EXIT_SCENE="scene.MsgRole.exit",t.MVP_LST="mvp.MsgMVP.queryMVPList",t.MVP_JL="mvp.MsgMVP.queryLast",t.WZ_GET_DATA="kingseat.MsgKingSeat.queryKingSeatList",t.JXGC_QAW="scene.MsgMachineFactory.queryAward",t.DC_LIST="hplace.MsgHundredManPlace.querySeatList",t.DC_SET_XY="hplace.MsgHundredManPlace.updateDeclaration",t.REQ_FRIEND_LIST="friend.queryList",t.MK_QAW="scene.MsgCave.queryAward",t.OPENS_S_BOX="scene.MsgBox.open",t.MK_CDBOSS_F="scene.MsgCave.attackColorBoss",t.HUNT_PM_REQ="timeauction.query.buyItemlst",t.TRADE_TAG_REQ="trade.MsgTradingHouse.searchEquipItem",t.SCENE_TRANS="scene.transfer",t.YCKJ_TRANSFER="adi.transfer",t.JZT_MEND="scene.Pyramid.walkend",t.JZT_GETAW="scene.Pyramid.award",t.JZT_RSETPOS="scene.Pyramid.standend",t}();__reflect(PbReqId.prototype,"PbReqId");var ServerActionId=function(){function t(){}return t.GET_GIFT=1002,t.SET_CACHEDATA=1003,t.SET_DAYCACHE=1004,t.GET_TOAST_AW=1005,t.BUY_TILI=1016,t.UP_SHARE=1024,t.UP_SHARE_SP=1023,t.UP_TILI_GET=1041,t.FPAY_AWD=1048,t.T_SCENE=1069,t.MTREE_CJ=1035,t.TILI_BUY=1046,t.DAY_TASK=1007,t.GROW_TASK=1008,t.TASK_BOX=1009,t.LOOP_TASK=1113,t.REQ_DTASK=1149,t.REQ_GTASK=1150,t.LZS=1048,t.INVITE=1148,t.SDAY_AW=1044,t.DPAY_AW=1040,t.YK_AW=1039,t.LC_AW=1041,t.JJ_AW=1043,t.HERO_INFO_REF=1147,t.HERO_ADD=1015,t.HERO_EQP=1024,t.HERO_EQP_CARD=1025,t.EQP_QH=1026,t.EQP_JL=1027,t.EQP_DZ=1028,t.EQP_CARD_UP=1031,t.USE_ATR_RESET=1018,t.USE_SKILL_RESET=1093,t.USE_SKILL_ITEM=1094,t.USE_EXP_ITEM=1097,t.ITEM_SELL=1010,t.CARD_HC=1029,t.EQP_FJ=1036,t.EQP_REQ_ATR=1063,t.XINGSHI_FJ=1126,t.EQP_JC=1135,t.EQP_TL_S=1164,t.PET_BOX=1020,t.TOUS_MADE=1032,t.SKILL_UP=1016,t.SKILL_EQP=1017,t.pet_catch=1019,t.PET_CZ=1021,t.PET_UP=1022,t.PET_SKILL=1023,t.USE_PET_HY=1095,t.USE_PET_HP=1096,t.PET_HC=1132,t.PET_CH=1142,t.SIGNIN=1040,t.SIGNIN_WD=1151,t.FL_LIANC=1030,t.FL_LC=1039,t.FL_ND=1041,t.VIP_GET=1072,t.FIRSTPAY=1033,t.TRADE_SJ=1064,t.TRADE_OP=1065,t.TRADE_BUY=1067,t.TRADE_GZ=1068,t.TRADE_ZS=1123,t.GUILD_CK_ROLE=1047,t.GUILD_JOIN=1050,t.GUILD_IS_JOIN=1051,t.GUILD_OUT=1052,t.GUILD_DD_REF=1053,t.GUILD_DD_TJ=1054,t.GUILD_DD_AWD=1055,t.GUILD_HZ_PP=1057,t.GUILD_HZ_TZ=1058,t.GUILD_DD_CX=1059,t.GUILD_HZ_FH=1060,t.GUILD_HZ_AWD=1062,t.GUILD_HD_TZ=1100,t.GUILD_GX=1112,t.RWD_GET=1042,t.RWD_UP=1043,t.RWD_RC=1044,t.RWD_TZ=1045,t.RWD_SJ=1046,t.RWD_RC_REF=1145,t.RWD_TZ_REF=1146,t.MVP_TZ=1058,t.MVP_ALIVE=1059,t.HUOB_UP=1102,t.HUOB_SZ=1103,t.BAOWU_UP=1101,t.YIYUAN_AWD=1122,t.DAY7_TZ=1124,t.DAY7_AWD=1125,t.YZ_EQP_CD=1104,t.YZ_EQP_JL=1105,t.ZHUABU=1019,t.GET_JINLI=1071,t.XZ_XQ=1070,t.ARENA_BUY=1073,t.ARENA_TZ=1074,t.ARENA_REFERSH=1077,t.ARENA_JFAW=1076,t.CT_TZ=1090,t.CT_SD=1091,t.TB_ENTER=1098,t.TB_CX=1092,t.YB_BUY_YB=1089,t.YB_BUY_JB=1079,t.YB_REFERSH=1082,t.YB_ACTION=1078,t.YB_JS=1086,t.GUAJI=1099,t.WZ_SH=1056,t.WZ_TZ=1092,t.GUIDE_CP=1034,t.GUIDE_AW=1035,t.FB_FUHUO=1062,t.REQ_ENTER_S=1119,t.FB_TEAM_CREATE=1118,t.FB_TEAM_EXIT=1117,t.FB_TEAM_ZY=1115,t.FB_TEAM_ENTER=1116,t.JXGC_BUY=1061,t.MK_BUY=1134,t.GTASK_GET=1127,t.GTASK_TGET=1128,t.GTASK_R=1161,t.SY_ENTER=1120,t.SY_BUY=1114,t.DC_BUY=1110,t.DC_FIGHT=1111,t.DC_GET_AW=1121,t.F_ADD=1129,t.F_DEL=1130,t.DGIFT_LC=1131,t.DGIFT_GIFT=1192,t.SWEET_DH=1136,t.SWEET_ZH=1137,t.LJS_LJ=1138,t.LJS_RL_BUY=1140,t.LJS_ZSLJ=1141,t.HUNT_AWD=1139,t.HUNT_PAY=1144,t.HUNT_PM_BUY=1143,t.TITLE_JH=1152,t.TITLE_CD=1153,t.TITLE_R=1160,t.VIP1_JH=1154,t.MM_ENTER=1155,t.SHIPIN=1156,t.TXK=1006,t.HALO_EQUIP=1157,t.HALO_SKUP=1158,t.MCJ_AW=1163,t.MCJ_CJ=1161,t.MCJ_R=1133,t.TAKEOUT=1162,t.FB_I_FRIEND=1159,t.QD_LJXH=1165,t.QD_LJCZ=1166,t.QD_LXDL=1171,t.QD_DBCZ=1168,t.QD_DHSD=1173,t.QD_DDS_START=1169,t.QD_DDS_BUY=1170,t.QD_ZJD_T=1174,t.QD_LHJ_JFAW=1186,t.QD_LHJ_RDH=1185,t.KFQD_LJXH=1176,t.KFQD_LJCZ=1177,t.KFQD_LXDL=1178,t.KFQD_DBCZ=1179,t.KFQD_DHSD=1180,t.KFQD_DDS_START=1181,t.KFQD_DDS_BUY=1182,t.KFQD_ZCD_T=1183,t.KFQD_LHJ_JFAW=1190,t.KFQD_LHJ_RDH=1189,t.QD_CZ_BUY=1191,t.QUICK_BUY=1193,t.YZ_ZH=1196,t.MONTH_CARD_AW=1197,t.WEEK_CARD_AW=1198,t.ZLB=1199,t.TASK_WEEK_AW=1201,t.FULI_TZ=1200,t.MS_EQUIP=1203,t.MS_HC=1204,t.MS_JH=1205,t.JZT_BUY=1207,t.JZT_F=1208,t}();__reflect(ServerActionId.prototype,"ServerActionId");var ShareDataId=function(){function t(){}return t}();__reflect(ShareDataId.prototype,"ShareDataId");var JuqingManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_jq.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this.jqCfg=t},t}();__reflect(JuqingManager.prototype,"JuqingManager");var JuqingMediator=function(){function t(){}return t.prototype.start=function(t,e){if(PFConst.SHOW_JQ){GmGlobal.cc.pfCtl.pfGameReport(8),this._cb=t,this._cbThis=e;var i=LoadingView.getInstence();i.close();var s=SceneResPreLoad.getInstence();s.show(),s.start(9801,this.onSceneLoaded,this)}else t.call(e)},t.prototype.onSceneLoaded=function(t,e){var i=new JuqingSceneView;i.init(),i.initScene(t,e),i.inited(),this._sceneView=i,GmGlobal.vmc.scene.currenMapView=i,SceneResPreLoad.getInstence().close(),CmdBus.adListener(CmdType.EXIT_JQ,this.onExit,this)},t.prototype.getScene=function(){return this._sceneView},t.prototype.onExit=function(){this._sceneView.clear(),this._sceneView=null,GmGlobal.vmc.scene.currenMapView=null,this._cb&&this._cb.call(this._cbThis)},t.prototype.clear=function(){CmdBus.rmListener(CmdType.EXIT_JQ,this.onExit,this),this._cb=null,this._cbThis=null},t}();__reflect(JuqingMediator.prototype,"JuqingMediator");var JuqingSceneUI=function(t){function e(){return t.call(this,"JuqingSceneUISkin")||this}return __extends(e,t),e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2,GmConst.IS_FULLSCENE?this.exit.y=GmConst.TOP_SPACE+10:this.exit.y=10},e.prototype.addEvts=function(){this.exit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this)},e.prototype.rmEvts=function(){this.exit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this)},e.prototype.onExit=function(){GmGlobal.cc.pfCtl.pfGameReport(9),CmdBus.doCmd(CmdType.EXIT_JQ)},e}(UIBase);__reflect(JuqingSceneUI.prototype,"JuqingSceneUI");var KapulaMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.KAPULA,CmdType.O_KAPULA),CmdBus.adListener(CmdType.O_KAPULA,this.onOpenView,this),CmdBus.adListener(CmdType.C_KAPULA,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new KapulaView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(KapulaMediator.prototype,"KapulaMediator",["IMediator"]);var KapulaView=function(t){function e(){var e=t.call(this,"KapulaSkin")||this;return e._sNo=0,e._tabIdx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ShopItemSkin",this.itemList.itemRenderer=ShopItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),this.selTab(0),this.alphaShow(),this.itemList.validateNow();var i=this;setTimeout(function(){i.checkGuide()},100)},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIdx)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIdx){if(-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIdx=t,this.updLst()}},e.prototype.updLst=function(){var t=this._mc.shopMgr.kplCfgs;this._array.removeAll();for(var e=0;e<t.length;e++){var i=t[e],s="",o=!0,n={cfg:i,str:s,isBuy:o,index:e+1};this._array.addItem(n)}},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent,i=e.data.cfg;if(!e.data.isBuy)return MsgBox.prompt("Purchase limit reached"),void GmGlobal.vmc.mGuide.clearGuide();GmGlobal.vmc.mGuide.triggerTarget(e.btn);var s=ItemSellView.getInstance();s.setItem(i.item.id,i.cost.num,i.cost.id,i.maxNum),s.show(GmGlobal.vmc.uiLayer)}},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.KQL_GM){if(-1!=GmGlobal.mc.guideMgr.guideEndIds.indexOf(GuideID.KQL_GM)){var e=this.itemList.getChildAt(2);t.bindTarget(GuideTargetId.KPL_BTN,e.btn,e.btn.parent.localToGlobal(e.btn.x,e.btn.y))}else{var e=this.itemList.getChildAt(0);t.bindTarget(GuideTargetId.KPL_BTN,e.btn,e.btn.parent.localToGlobal(e.btn.x,e.btn.y))}t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_KAPULA)},e.prototype.close=function(){if(-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}this._tabIdx=-1,0!=this._sNo&&GmGlobal.server.clearSerialCallbak(this._sNo),t.prototype.close.call(this)},e}(UIBase);__reflect(KapulaView.prototype,"KapulaView");var LianjsAwItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.txt.textFlow=TextFormat.parser.parse("Current Max Alchemy "+TextFormat.setColor(this.data.value.toString(),16711680)+"，Reward Trove："),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!1,!0),this._itemGridCon.addToParent(6,6,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0);var t=Math.ceil(this.data.items.length/6);this.height=100*t+6*(t-1)+52},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(LianjsAwItem.prototype,"LianjsAwItem");var LianjsManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_ljs.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_lianjinitem.json",this.initItems,this)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.initItems=function(t){this.ljItems=t},t.prototype.getRule=function(){return this._cfg.rule},t.prototype.getExchangeV=function(){return this._cfg.exchange},t.prototype.getTjCfg=function(t){return this._cfg.aws[t]},t}();__reflect(LianjsManager.prototype,"LianjsManager");var LianjsMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.LIANJS,CmdType.O_LJS),CmdBus.adListener(CmdType.O_LJS,this.onOpenView,this),CmdBus.adListener(CmdType.C_LJS,this.onCloseView,this),CmdBus.adListener(CmdType.O_LJS_TJ,this.openTj,this),CmdBus.adListener(CmdType.C_LJS_TJ,this.closeTj,this),CmdBus.adListener(CmdType.O_LJS_ZSLJ,this.openZslj,this),CmdBus.adListener(CmdType.C_LJS_ZSLJ,this.closeZslj,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.LJS_UPD,this.updateIcon,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.updateIcon=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.LJS_UPD).data,e=t.et||0;e-GmGlobal.getServerTime()>0?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.LIANJS,"mui_json.mui_b_ljs"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.LIANJS)},t.prototype.onOpenView=function(t){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new LianjsView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.openTj=function(){this._tjView||(this._tjView=new LianjsTjView),this._tjView.isShow||this._tjView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeTj=function(){this._tjView&&this._tjView.close()},t.prototype.openZslj=function(){this._zsljView||(this._zsljView=new LianjsZsljView),this._zsljView.isShow||this._zsljView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeZslj=function(){this._zsljView&&this._zsljView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._tjView=null,this._zsljView=null,!0):!1:!0},t}();__reflect(LianjsMediator.prototype,"LianjsMediator",["IMediator"]);var LianjsTjView=function(t){function e(){var e=t.call(this,"LianjsTjViewSkin")||this;return e._buyId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="LianjsAwItemSkin",this.itemList.itemRenderer=LianjsAwItem,this.bBuy.icon=GmGlobal.mc.itemMgr.getItemSicon(ItemID.DIAMOND)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),EventBus.addListener(EventType.M_JUPD+JsonID.LJS_UPD,this.update,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),EventBus.rmListener(EventType.M_JUPD+JsonID.LJS_UPD,this.update,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.mc.dataMgr.getJData(JsonID.LJS_UPD).data,s=GmGlobal.mc.ljsMgr.getTjCfg(i.id);for(var o in s)this._array.addItem(s[o]);this.update()},e.prototype.update=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.LJS_UPD).data,e=GmGlobal.mc.ljsMgr.getTjCfg(t.id),i=t.aid||1,s=e[i];s&&(this.tValue.text="Current Max Alchemy："+s.value),this._buyId=i+1;var o=e[this._buyId];o?(this.bBuy.visible=!0,this.maxTxt.visible=!1,this.bBuy.label=o.price+" Purchase Limit"):(this.bBuy.visible=!1,this.maxTxt.visible=!0)},e.prototype.onBuy=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.LJS_RL_BUY,[this._buyId])},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LJS_TJ)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(LianjsTjView.prototype,"LianjsTjView");var LianjsView=function(t){function e(){var e=t.call(this,"LianjsViewSkin")||this;return e._selImgPool=[],e._selList=[],e._selImg={},e._ljValue=0,e._maxValue=0,e._minValue=0,e._page=1,e._maxPage=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(e.ONE_PAGE_NUM,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bLj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLj,this),this.bTj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTj,this),this.bZslj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZslj,this),EventBus.addListener(EventType.M_JUPD+JsonID.LJS_UPD,this.update,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bLj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLj,this),this.bTj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTj,this),this.bZslj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZslj,this),EventBus.rmListener(EventType.M_JUPD+JsonID.LJS_UPD,this.update,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this._ljValue=0,this._maxValue=0,this._minValue=0,this.update(),this.updateLst(),this.updatePage()},e.prototype.update=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.LJS_UPD).data,e=t.et||0,i=Math.max(e-GmGlobal.getServerTime(),0);if(i>0){this.tTime.visible=!0;var s="Event Countdown: ";CDText.getInstence().addCD(this.tTime,i,s,i>86400?"DD h:m:s":"h:m:s")}else this.tTime.visible=!1;var o=GmGlobal.mc.ljsMgr.getTjCfg(t.id),n=o[t.aid||1];this.maxValue.text="Container Limit:"+n.value,this._maxValue=n.value;var r=o[1];this._minValue=r.value},e.prototype.getItemList=function(){for(var t=[],e=GmGlobal.mc.ljsMgr.ljItems,i=0;i<e.length;i++){var s=e[i],o=GmGlobal.mc.itemMgr.getItem(s);o&&o.num>0&&t.push(o)}return t},e.prototype.updateLst=function(){this._itemList=this.getItemList(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);for(var s=[],o=t;i>o;o++){var n=this._itemList[o];s.push(n)}this._itemGridCon.setItems(s)}},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.clearSelList(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.clearSelList(),this.updateItemSelState())},e.prototype.updateItemLjView=function(){for(var t=GmGlobal.mc.itemMgr,e=0,i=0;i<this._selList.length;i++){var s=this._selList[i],o=t.getItemCfg(s),n=t.getItemNum(s);o.ljExp&&(e+=o.ljExp*n)}this._ljValue=Math.min(e,this._maxValue),this.updateLjValue()},e.prototype.updateLjValue=function(){var t=this._ljValue;t<this._minValue?Utils.setBtnEnable(this.bLj,!1):Utils.setBtnEnable(this.bLj,!0),this.ljValue.text=String(t)},e.prototype.onTouchItemGrid=function(t){var e=this.isSel(t.itemId);return!e&&this._ljValue>=this._maxValue?void MsgBox.prompt("Container limit reached"):(this.setItemSelState(t,!e),void this.updateItemLjView())},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.isInList=function(t){for(var e=0,i=this._itemGridCon.grids;e<i.length;e++){var s=i[e];if(s.itemId==t)return!0}return!1},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t];this.setItemSelState(i,this.isSel(i.itemId))}for(var s=0;s<this._selList.length;s++){var o=this._selList[s];if(!this.isInList(this._selList[s])){this._selList.splice(s,1);var n=this._selImg[o];n&&(this.selCon.removeChild(n),this._selImgPool.push(n),delete this._selImg[o]),s--}}this.updateItemLjView()},e.prototype.setItemSelState=function(t,e){var i=this._selList.indexOf(t.itemId);if(e){-1==i&&this._selList.push(t.itemId);var s=void 0;this._selImg[t.itemId]?s=this._selImg[t.itemId]:(s=this.getSelImg(),this.selCon.addChild(s),this._selImg[t.itemId]=s),s.x=t.icon.x+t.icon.width-31,s.y=t.icon.y-10}else{if(-1==i)return;this._selList.splice(i,1);var s=this._selImg[t.itemId];s&&(this.selCon.removeChild(s),this._selImgPool.push(s),delete this._selImg[t.itemId])}},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t=0,e=this._selList;t<e.length;t++){var i=e[t],s=this._selImg[i];s&&(this._selImgPool.push(s),delete this._selImg[i],this.selCon.removeChild(s))}},e.prototype.onLj=function(){var t=McEffect.create("lianjin");t.show(this,360,340,1,1,0,this.doLj,this),this.bLj.touchEnabled=!1},e.prototype.doLj=function(){for(var t=[],e=GmGlobal.mc.ljsMgr.ljItems,i=0;i<this._selList.length;i++)t.push(e.indexOf(this._selList[i])+1);GmGlobal.cc.dataCtl.doAction(ServerActionId.LJS_LJ,t,this.onLjOk,this),this.bLj.touchEnabled=!0},e.prototype.onLjOk=function(){this.updateLst(),this.updateItemLjView()},e.prototype.onTj=function(){CmdBus.doCmd(CmdType.O_LJS_TJ)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.ljsMgr.getRule())},e.prototype.onZslj=function(){CmdBus.doCmd(CmdType.O_LJS_ZSLJ)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LJS)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),this._page=1,this._maxPage=1,this.clearSelList(),this._selList=[],t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearItems(),RES.destroyRes("ljs")},e.ONE_PAGE_NUM=25,e}(UIBase);__reflect(LianjsView.prototype,"LianjsView");var LianjsZsljView=function(t){function e(){return t.call(this,"LianjsZsljViewSkin")||this}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bSub.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSub,this),this.bAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bLj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLj,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bSub.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSub,this),this.bAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bLj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLj,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.mc.dataMgr.getJData(JsonID.LJS_UPD).data;this._cfg=GmGlobal.mc.ljsMgr.getTjCfg(i.id),this._aid=i.aid||1,this._maxId=this._aid,this.update()},e.prototype.update=function(){var t=this._cfg[this._aid];this.tValue.text=t.value,this._cost=t.value/GmGlobal.mc.ljsMgr.getExchangeV(),this.tCost.text=String(this._cost)},e.prototype.onSub=function(){var t=this._aid-1;this._cfg[t]&&(this._aid=t,this.update())},e.prototype.onAdd=function(){var t=this._aid+1;t<=this._maxId&&(this._aid=t,this.update())},e.prototype.onLj=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.LJS_ZSLJ,[this._aid])},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LJS_ZSLJ)},e.prototype.close=function(){this._cfg=null,t.prototype.close.call(this)},e}(UIBase);__reflect(LianjsZsljView.prototype,"LianjsZsljView");var GameNotice=function(t){function e(){return t.call(this,"GameNoticeSkin")||this}return __extends(e,t),e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.setTxt=function(t){this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(t,this.txt.width))},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_GNOTICE)},e}(UIBase);__reflect(GameNotice.prototype,"GameNotice");var LoginController=function(){function t(){this._isOffline=!1,this._rlTimer=0,this._timerNum=0,GmGlobal.server.regUpdCb(MsgID.UPD_OFFLINE,this.onOffline,this),EventBus.addListener(EventType.S_CLOSE,this.onSClose,this),EventBus.addListener(EventType.S_ERROR,this.onSError,this)}return t.prototype.onOffline=function(t){this._isOffline=!0;var e=GmGlobal.mc.txtMgr.getRetCode(t.retCode);if(52!=t.retCode&&111!=t.retCode||""==PFConst.CONTACTUS||(e+="\nAccount:"+GmGlobal.mc.loginMgr.account+"\n"+PFConst.CONTACTUS),GmGlobal.server.close(),MsgBox.alert(e,this.onReloadGame,this),this.stopHeart(),53==t.retCode){var i=(new Date).getTime()+6e4;
egret.localStorage.setItem("locktime",i.toString())}EventBus.dispatchEvt(EventType.OFFLINE)},t.prototype.onReloadGame=function(){GmGlobal.cc.pfCtl.pfHasLogout()?GmGlobal.cc.pfCtl.pfLogout():window.location.reload(!0)},t.prototype.onSClose=function(){if(!this._isOffline){this.stopHeart();(new Date).getTime()/1e3;0!=this._rlTimer&&(egret.clearTimeout(this._rlTimer),this._rlTimer=0),this.delayConnect(2e3)}},t.prototype.onSError=function(){this._isOffline||(MsgBox.prompt("Failed to connect to the server, please check whether the network is normal!",5e3),0!=this._rlTimer&&(egret.clearTimeout(this._rlTimer),this._rlTimer=0),this.delayConnect(5e3))},t.prototype.delayConnect=function(t){0==this._rlTimer&&(0==GmGlobal.mc.role.roleId?this._rlTimer=egret.setTimeout(this.initServer,this,t):this._rlTimer=egret.setTimeout(this.reConnection,this,t))},t.prototype.startHeart=function(){this._timerId||(this._timerId=new egret.Timer(1e3,1e8),this._timerId.addEventListener(egret.TimerEvent.TIMER,this.onHeart,this)),console.log("heart start time: "+egret.getTimer()),this._timerId.start(),this.doHeart()},t.prototype.stopHeart=function(){this._timerId&&(this._timerId.stop(),this._timerNum=0)},t.prototype.onHeart=function(){this._timerNum++,this._timerNum>=20&&(this._timerNum=0,this.doHeart())},t.prototype.doHeart=function(){console.log("heart t="+egret.getTimer());var t=MsgStruct.getMsg(MsgID.REQ_HEARTBEAT);t&&(t.placeHolder=1,GmGlobal.server.sendMsg(MsgID.REQ_HEARTBEAT,t))},t.prototype.connectServer=function(t){this._connectedCb=t,this.initServer()},t.prototype.initServer=function(){var t=GmGlobal.mc.loginMgr;GmGlobal.server.connect(t.host,t.port,this.onServerConnected,this)},t.prototype.onServerConnected=function(){this.startHeart(),this._connectedCb&&(this._connectedCb(),this._connectedCb=null),this._serverListCb&&this.doGetServerList()},t.prototype.onGameServerConnected=function(){this.startHeart(),this.doLogin()},t.prototype.reConnection=function(){console.log("开始重连 SocketState:"+GmGlobal.server.isConnected()),this.loginGame(this.onReConnectioned)},t.prototype.onReConnectioned=function(){0!=this._rlTimer&&(egret.clearTimeout(this._rlTimer),this._rlTimer=0);(new Date).getTime()/1e3;EventBus.dispatchEvt(EventType.S_RECONNECT)},t.prototype.reConnectServer=function(){var t=GmGlobal.mc.loginMgr;GmGlobal.server.connect(t.host,t.port,this.onGameServerConnected,this)},t.prototype.checkLogin=function(t,e){var i=MsgStruct.getMsg(MsgID.REQ_CHECK_LOGIN);if(i){var s=GmGlobal.mc.loginMgr;s.serverId=t,i.account=s.account,i.serverId=t,i.time=s.time,i.sig=s.sig,i.platid=s.platId,i.inviter=s.invite,s.createinfo&&(i.createinfo=s.createinfo);GmGlobal.server.sendMsg(MsgID.REQ_CHECK_LOGIN,i,function(t){if(0==t.retCode)GmGlobal.mc.role.roleId=Number(t.roleId),s.gameServerTime=t.time,s.gameServerSig=t.sig,s.gameServerGroup=t.groupid,s.gameServerId=t.serverid,s.gamePlatServer=t.platserver;else if(52==t.retCode||111==t.retCode){var i=(new Date).getTime()/1e3,o=t.time-i,n=GmGlobal.mc.txtMgr.getRetCode(t.retCode);Math.floor(o/86400)<290&&(n+="\nTime left: "+Utils.formatTime(o,"DD h:m:s")),n+="\nAccount:"+GmGlobal.mc.loginMgr.account,MsgBox.alert(n)}else GmGlobal.mc.txtMgr.showRetCode(t.retCode);e&&e(t.retCode),t=null}),i=null}},t.prototype.loginGame=function(t){WaitingView.showWaiting("Logging in"),this._loginCb=t,GmGlobal.server.isConnected()?this.doLogin():this.reConnectServer()},t.prototype.doLogin=function(){var t=MsgStruct.getMsg(MsgID.REQ_LOGIN_GAME);if(t){var e=GmGlobal.mc.loginMgr;t.roleId=GmGlobal.mc.role.roleId,t.time=e.gameServerTime,t.userKey=e.gameServerSig,t.groupid=e.gameServerGroup;var i=this;GmGlobal.server.sendMsg(MsgID.REQ_LOGIN_GAME,t,function(t){WaitingView.hideWaiting(),i._loginCb&&(i._loginCb(t.retCode),i._loginCb=null),t=null}),t=null}},t.prototype.createRole=function(t,e,i){if(t=t.replace(/ /g,""),!Utils.checkName(t))return void i(-1);var s=MsgStruct.getMsg(MsgID.REQ_CREATE_ROLE);if(s){var o=GmGlobal.mc.loginMgr;o.createRoleName=t,s.userId=o.account,s.roleId=GmGlobal.mc.role.roleId,s.time=o.gameServerTime,s.userKey=o.gameServerSig,s.serverId=o.gameServerId,s.groupid=o.gameServerGroup,s.platid=o.platId,s.platserver=o.gamePlatServer,s.name=t,s.careerId=e,o.ext&&(s.ext=o.ext),o.headurl&&""!=o.headurl&&-1!=o.headurl.indexOf("http")&&(s.headurl=o.headurl);GmGlobal.server.sendMsg(MsgID.REQ_CREATE_ROLE,s,function(t){0!=t.retCode&&GmGlobal.mc.txtMgr.showRetCode(t.retCode),i(t.retCode)}),s=null}},t.prototype.getRandName=function(t){var e=MsgStruct.getMsg(MsgID.REQ_RAND_NAME);if(e){var i=GmGlobal.mc.loginMgr;e.num=1,GmGlobal.server.sendMsg(MsgID.REQ_RAND_NAME,e,function(e){var s=e.name;i.createRoleName=s[0],t&&t()}),e=null}},t.prototype.getRandNameByHttp=function(t,e){this._randNameCb=t,this._randNameObj=e;var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(PFConst.HTTP_HOST+"/name/rand/mnxj",egret.HttpMethod.GET),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(),i.addEventListener(egret.Event.COMPLETE,this.onRandNameOk,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onRandNameFail,this)},t.prototype.onRandNameOk=function(t){var e=t.currentTarget;this._randNameCb&&(this._randNameCb.call(this._randNameObj,e.response),this._randNameCb=null,this._randNameObj=null)},t.prototype.onRandNameFail=function(t){this._randNameCb&&(this._randNameCb.call(this._randNameObj,null),this._randNameCb=null,this._randNameObj=null)},t.prototype.getServerList=function(t,e){this._serverListCb=t,this._connectedCb=e,GmGlobal.server.isConnected()?this.doGetServerList():this.initServer()},t.prototype.getServerInfo=function(t,e,i){var s=MsgStruct.getMsg(MsgID.REQ_SERVER_INFO);if(s){var o=GmGlobal.mc.loginMgr;s.platid=o.platId,s.beginId=t,s.endId=e;GmGlobal.server.sendMsg(MsgID.REQ_SERVER_INFO,s,function(t){for(var e=0;e<t.data.length;e++){var s=t.data[e];o.serverInfos[s.serverId]=new ServerInfo(s.serverId,s.serverName,s.time)}i&&i()})}},t.prototype.doGetServerList=function(){var t=MsgStruct.getMsg(MsgID.REQ_S_LIST);if(!t)return void(this._serverListCb=null);var e=GmGlobal.mc.loginMgr;t.account=e.account,t.platid=e.platId,e.accountYk&&e.platIdYk&&(t.accountyouke=e.accountYk,t.platidyouke=e.platIdYk);var i=this;GmGlobal.server.sendMsg(MsgID.REQ_S_LIST,t,function(t){e.serverNum=t.serverSize,e.myServers=[];for(var s=0;s<t.myServer.length;++s){var o=t.myServer[s],n=new ServerInfo(o.serverId,o.serverName,o.time);e.myServers.push(n),e.serverInfos[n.id]=n}e.newServer=new ServerInfo(t.newServer.serverId,t.newServer.serverName),e.newServerStart=t.minnewserver,0==e.newServerStart&&e.newServer&&(e.newServerStart=e.newServer.id),e.serverInfos[e.newServer.id]=e.newServer,i._serverListCb(),i._serverListCb=null}),t=null},t}();__reflect(LoginController.prototype,"LoginController");var LoginManager=function(){function t(){this.account="",this.host="",this.port=0,this.serverId=1,this.time=0,this.sig="",this.platId=1,this.platIdYk=0,this.nickname="",this.sex=-1,this.city="",this.headurl="",this.invite=0,this.serverNum=0,this.newServerStart=0,this.selServerId=0,this.serverState=0,this.serverInfos={}}return t.prototype.createRoleNum=function(){if(!this.roleList||!this.roleList.data)return 0;var t=0;for(var e in this.roleList.data){var i=this.roleList.data[e];i.career&&t++}return t},t.prototype.getServerRoleData=function(t){return this.roleList&&this.roleList.data?this.roleList.data[t]:null},t.prototype.getLastServer=function(){return this.roleList?this.roleList.last:0},t.prototype.checkServerInfo=function(t,e){for(var i=1;i<=this.serverNum;i++){var s=this.serverInfos[i];if(!s)return!1}return!0},t.prototype.isNewServer=function(t){return this.newServerStart<=t?!0:!1},t}();__reflect(LoginManager.prototype,"LoginManager");var ServerInfo=function(){function t(t,e,i){void 0===i&&(i=0),this.id=t,this.name=e,this.lTime=i}return t}();__reflect(ServerInfo.prototype,"ServerInfo");var LoginMediator=function(){function t(){CmdBus.adListener(CmdType.O_R_SEL,this.onShowSelView,this),CmdBus.adListener(CmdType.C_R_SEL,this.onCloseSelView,this),CmdBus.adListener(CmdType.O_R_CREATE,this.onShowCreateView,this),CmdBus.adListener(CmdType.C_R_CREATE,this.onCloseCreateView,this),CmdBus.adListener(CmdType.O_SEL_SV,this.onShowServerSel,this),CmdBus.adListener(CmdType.C_SEL_SV,this.onCloseServerSel,this)}return t.prototype.clear=function(){this._selView&&(this._selView.close(),this._selView.destroy(),this._selView=null),this._crateView&&(this._crateView.close(),this._crateView.destroy(),this._crateView=null),this._serverSelView&&(this._serverSelView.close(),this._serverSelView.destroy(),this._serverSelView=null)},t.prototype.onShowSelView=function(){this._selView||(this._selView=new RoleSelView),this._selView.isShow||this._selView.show(GmGlobal.vmc.uiLayer),this.onCloseCreateView()},t.prototype.onCloseSelView=function(){this._selView&&this._selView.close()},t.prototype.onShowCreateView=function(t){0==t&&(t=1),this._crateView||(this._crateView=new RoleCreateView),this._crateView.setServerId(t,this._selView?!0:!1),this._crateView.isShow||this._crateView.show(GmGlobal.vmc.uiLayer),GmGlobal.cc.pfCtl.pfGameReport(11),this.onCloseSelView()},t.prototype.onCloseCreateView=function(){this._crateView&&this._crateView.close()},t.prototype.onShowServerSel=function(){this._serverSelView||(this._serverSelView=new ServerSelView),this._serverSelView.isShow||this._serverSelView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseServerSel=function(){this._serverSelView&&this._serverSelView.close()},t}();__reflect(LoginMediator.prototype,"LoginMediator");var RoleCareerItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleCareerItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.setInfo=function(t,e){this.careerId=t,this.cName.text=e},e.prototype.setSelState=function(t){t?(this.bg.source="login_json.login_sel",this.bg2.source="login_json.login_sel"):(this.bg.source="login_json.login_iconbg",this.bg2.source="login_json.login_iconbg")},e.prototype.setIcon=function(t){this.icon.source=t},e}(eui.Component);__reflect(RoleCareerItem.prototype,"RoleCareerItem");var RoleCreateView=function(t){function e(){var e=t.call(this,"RoleCreateSkin")||this;return e._sid=1,e._selZyIds=[],e._selMdelIds=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.cBtn.sound="ui_chuangjian",this.rBtn.sound=null,GmGlobal.stageHeight>1560&&(this.bg.height=GmGlobal.stageHeight,this.bg.width=720/1560*GmGlobal.stageHeight)},e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.resize=function(){this.height=GmGlobal.stageHeight},e.prototype.addEvts=function(){this.cBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.rBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),this.bBack.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.boy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelBoy,this),this.girl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelGril,this),this.careerCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelCareeer,this),EventBus.addListener(EventType.RESIZE,this.resize,this)},e.prototype.rmEvts=function(){this.cBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.rBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),this.bBack.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.boy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelBoy,this),this.girl.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelGril,this),this.careerCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelCareeer,this),EventBus.rmListener(EventType.RESIZE,this.resize,this)},e.prototype.setServerId=function(t,e){this._sid=t,this._fmSel=e},e.prototype.show=function(e){t.prototype.show.call(this,e),GmGlobal.mc.loginMgr.pfloginSid&&(this.bg.visible=!1,this.selBg.visible=!1,LoadingView.getInstence().setBqVisible(!1)),this._selSex=Utils.random(1,2),this._selCareer=this.randomCareer(),this.initCareers(),this.updateCareerItems(),this.updateSexSelState(),this.updateCareerSelState(),this.updateModel();var i=GmGlobal.mc.loginMgr.nickname;i?this.nameTxt.text=i:(this.nameTxt.text="",this.randomName()),this.bBack.visible=this._fmSel,PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.SHOW_CREATE)},e.prototype.initCareers=function(){var t=GmGlobal.mc.heroMgr.getCareers(),e=0;for(var i in t){var s=t[i],o=new RoleCareerItem;o.setInfo(Number(i),s.name),o.setSelState(0),o.x=168*e,this.careerCon.addChild(o),e++}},e.prototype.randomCareer=function(){var t=GmGlobal.mc.heroMgr.getCareers(),e=Utils.getObjectLength(t),i=Utils.random(1,e),s=1;for(var o in t){if(s==i)return Number(o);s++}return 0},e.prototype.updateCareerItems=function(){for(var t=0;t<this.careerCon.numChildren;t++){var e=this.careerCon.getChildAt(t),i=GmGlobal.mc.heroMgr.getHeroCfgByCareer(e.careerId,this._selSex);i&&(e.setIcon(GmConst.MODEL_ICON_DIR+"cicon_"+i.id+".png"),-1==this._selZyIds.indexOf(i.id)&&this._selZyIds.push(i.id))}},e.prototype.onSelBoy=function(){GmGlobal.sound.playSoundEffect("ui_fenye"),this._selSex=1,this.updateSexSelState(),this.updateCareerItems(),this.updateModel()},e.prototype.onSelGril=function(){GmGlobal.sound.playSoundEffect("ui_fenye"),this._selSex=2,this.updateSexSelState(),this.updateCareerItems(),this.updateModel()},e.prototype.onSelCareeer=function(t){t.target.careerId&&t.target.careerId==this._selCareer||(this._selCareer=t.target.careerId,this.updateCareerSelState(),this.updateModel())},e.prototype.updateCareerSelState=function(){for(var t=0;t<this.careerCon.numChildren;t++){var e=this.careerCon.getChildAt(t);if(e.careerId==this._selCareer){e.setSelState(1),e.y=-20;var i=GmGlobal.mc.heroMgr.getCareerCfg(e.careerId);this.dscTxt.text=i.des}else e.setSelState(0),e.y=0}},e.prototype.updateSexSelState=function(){1==this._selSex?(this.boy.filters=FilterUtils.seleteFilter(),this.girl.filters=[]):(this.boy.filters=[],this.girl.filters=FilterUtils.seleteFilter())},e.prototype.updateModel=function(){var t=GmGlobal.mc.heroMgr.getHeroCfgByCareer(this._selCareer,this._selSex);t&&(this.body.source=GmGlobal.mc.heroMgr.getHeroUIModel(t.id),-1==this._selMdelIds.indexOf(t.id)&&this._selMdelIds.push(t.id))},e.prototype.randomName=function(){GmGlobal.cc.dataCtl.ajaxReq("/name/rand/english",this.onRandomName,this)},e.prototype.onRandomName=function(t){t&&(this.nameTxt.text=t)},e.prototype.onCreate=function(){var t=this.nameTxt.text;if(""==t)return void MsgBox.prompt("Enter character name");this.cBtn.touchEnabled=!1;var e=this;PFConst.CHECK_MSG?GmGlobal.cc.pfCtl.checkMsg(t,function(i){0==i?e.createRole(t):(e.nameTxt.text="",e.cBtn.touchEnabled=!0)}):this.createRole(t),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.CREATE)},e.prototype.createRole=function(t){var e=(GmGlobal.mc.loginMgr,this);GmGlobal.cc.loginCtl.checkLogin(this._sid,function(i){0==i&&e.doCreateRole(t)})},e.prototype.doCreateRole=function(t){var e=GmGlobal.mc.heroMgr.getHeroCfgByCareer(this._selCareer,this._selSex),i=this;GmGlobal.cc.loginCtl.createRole(t,e.id,function(t){0==t?(GmGlobal.cc.pfCtl.pfGameReport(12),EventBus.dispatchEvt(EventType.ENTER_GAME,!0)):(i.cBtn.touchEnabled=!0,GmGlobal.mc.txtMgr.showRetCode(t))})},e.prototype.onBack=function(){CmdBus.doCmd(CmdType.O_R_SEL)},e.prototype.close=function(){GmGlobal.mc.loginMgr.pfloginSid&&LoadingView.getInstence().setBqVisible(!0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0,i=this._selZyIds;e<i.length;e++){var s=i[e];RES.destroyRes(GmConst.MODEL_ICON_DIR+"cicon_"+s+".png")}for(var o=0,n=this._selMdelIds;o<n.length;o++){var s=n[o];RES.destroyRes(GmGlobal.mc.heroMgr.getHeroUIModel(s))}},e}(UIBase);__reflect(RoleCreateView.prototype,"RoleCreateView");var RoleSelItem=function(t){function e(){var e=t.call(this)||this;return e.sid=0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.setRoleData=function(t,e){if(this.data=e,this.sid=t,e){this.skinName="LoginRoleItemSkin",this.rName.text=e.name,this.lv.text="LV."+e.level;var i=GmGlobal.mc.heroMgr.getHeroCfg(e.career);this._modelRes=GmGlobal.mc.heroMgr.getHeroUIModel(i.id),this.model.source=this._modelRes}else this.skinName="LoginRoleNullSkin"},e.prototype.setSelState=function(t){this.data&&(t?(this.bg.source="login_json.login_cjbg1",this.bg2.source="login_json.login_cjbg1"):(this.bg.source="login_json.login_cjbg2",this.bg2.source="login_json.login_cjbg2"))},e.prototype.clear=function(){this._modelRes&&RES.destroyRes(this._modelRes)},e}(eui.Component);__reflect(RoleSelItem.prototype,"RoleSelItem");var RoleSelView=function(t){function e(){var e=t.call(this,"RoleSelSkin")||this;return e._selId=1,e._cNum=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.cBtn.sound="ui_chuangjian",this.eBtn.sound="ui_chuangjian"},e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.resize=function(){this.height=GmGlobal.stageHeight},e.prototype.addEvts=function(){EventBus.addListener(EventType.RESIZE,this.resize,this),this.s1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.s2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.s3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.s4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.cBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.eBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this)},e.prototype.rmEvts=function(){EventBus.rmListener(EventType.RESIZE,this.resize,this),this.s1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.s2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.s3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.s4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelRole,this),this.cBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.eBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateItems(),this._selId=GmGlobal.mc.loginMgr.getLastServer(),this._cNum=GmGlobal.mc.loginMgr.createRoleNum(),this.updateItemSelState(),this._cNum>=4&&Utils.setBtnEnable(this.cBtn,!1)},e.prototype.updateItems=function(){for(var t=1;4>=t;t++){var e=this["s"+t],i=GmGlobal.mc.loginMgr.getServerRoleData(t);i&&i.career?e.setRoleData(t,i):e.setRoleData(t,null)}},e.prototype.onSelRole=function(t){t.target==this.s1?this._selId=1:t.target==this.s2?this._selId=2:t.target==this.s3?this._selId=3:t.target==this.s4&&(this._selId=4),this.updateItemSelState()},e.prototype.updateItemSelState=function(){this.s1.setSelState(this.s1.sid==this._selId?1:0),this.s2.setSelState(this.s2.sid==this._selId?1:0),this.s3.setSelState(this.s3.sid==this._selId?1:0),this.s4.setSelState(this.s4.sid==this._selId?1:0)},e.prototype.onCreate=function(){CmdBus.doCmd(CmdType.CK_CREATE,this._cNum+1)},e.prototype.onEnter=function(){if(!this._selId)return void MsgBox.prompt("No character selected");this.eBtn.touchEnabled=!1;var t=this;GmGlobal.cc.loginCtl.checkLogin(this._selId,function(e){0==e&&(EventBus.dispatchEvt(EventType.ENTER_GAME),t.eBtn.touchEnabled=!0)})},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.s1.clear(),this.s2.clear(),this.s3.clear(),this.s4.clear()},e}(UIBase);__reflect(RoleSelView.prototype,"RoleSelView");var ServerListView=function(t){function e(){var e=t.call(this,"ServerListSkin")||this;return e._tabNum=20,e._selTab=0,e._selIndex=0,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sevScl.verticalScrollBar&&(this.sevScl.verticalScrollBar.autoVisibility=!1),this.optionScl.verticalScrollBar&&(this.optionScl.verticalScrollBar.autoVisibility=!1),this.updateOptionList();var e=GmGlobal.mc.loginMgr;if(0==e.myServers.length){var i=1;this.updateServerList(i),this.optionList.selectedIndex=i}else this.updateServerList(0),this.optionList.selectedIndex=0},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.optionList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchOpList,this),this.sevList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchSList,this),this.bOk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.optionList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchOpList,this),this.sevList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchSList,this),this.bOk.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this)},e.prototype.updateOptionList=function(){for(var t=GmGlobal.mc.loginMgr.serverNum,e=[],i=1;t>=i;i+=this._tabNum)e.unshift({txt:"S"+i+" - S"+(i+this._tabNum-1)});e.unshift({txt:"Previous server"}),this.optionList.dataProvider=new eui.ArrayCollection(e)},e.prototype.updateServerList=function(t){this._selTab=t;var e=null,i=GmGlobal.mc.loginMgr;if(0==t){for(var s=[],o=0;o<i.myServers.length;o++)e=i.myServers[o],s.push({name:e.id,txt:"S"+e.id+" - "+e.name,state:this.getSevIcon(e.id),color:this.getSecStateColor(e.id),sicon:1==GmGlobal.mc.loginMgr.serverState?"com_json.com_gray":"com_json.com_green"});this.updateSevList(s,0)}else{var n=Math.ceil(i.serverNum/this._tabNum)-(t-1),r=(n-1)*this._tabNum+1;1>r&&(r=1);var h=n*this._tabNum;if(h>i.serverNum&&(h=i.serverNum),i.checkServerInfo(r,h))this.updateSevList(this.getListData(r,h));else{var a=this;GmGlobal.cc.loginCtl.getServerInfo(r,h,function(){a.updateSevList(a.getListData(r,h))})}}},e.prototype.getListData=function(t,e){for(var i=[],s=e;s>=t;s--){var o=GmGlobal.mc.loginMgr.serverInfos[s];i.push({name:o.id,txt:"S"+o.id+" - "+o.name,state:this.getSevIcon(o.id),color:this.getSecStateColor(o.id),sicon:1==GmGlobal.mc.loginMgr.serverState?"com_json.com_gray":"com_json.com_green"})}return i},e.prototype.getSevIcon=function(t){return GmGlobal.mc.loginMgr.isNewServer(t)?"New":""},e.prototype.getSecStateColor=function(t){return GmGlobal.mc.loginMgr.isNewServer(t)?"00FF00":"FF0000"},e.prototype.updateSevList=function(t,e){void 0===e&&(e=-1),this.sevList.dataProvider=new eui.ArrayCollection(t),this.sevList.selectedIndex=e,this._selIndex=e},e.prototype.onTouchOpList=function(t){this.updateServerList(this.optionList.selectedIndex)},e.prototype.onTouchSList=function(t){this._selIndex=this.sevList.selectedIndex},e.prototype.onOk=function(){if(-1==this._selIndex)return void this.onClose();var t=Number(this.sevList.dataProvider.getItemAt(this._selIndex).name);0!=t&&(GmGlobal.mc.loginMgr.selServerId=t),this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SLIST)},e}(UIBase);__reflect(ServerListView.prototype,"ServerListView");var ServerSelListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bg.source=this.data.isSel?"com_json.xq_bg_1":null,this.txt.text=this.data.txt,this.state.text=1==this.data.state?"New":(2==this.data.state,""),this.sIcon.filters=1==this.data.open?FilterUtils.disabled():[]},e}(eui.ItemRenderer);__reflect(ServerSelListItem.prototype,"ServerSelListItem");var ServerSelOpItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bg.source=this.data.isSel?"com_json.xq_bg_1":null,this.txt.text=this.data.txt},e}(eui.ItemRenderer);__reflect(ServerSelOpItem.prototype,"ServerSelOpItem");var ServerSelView=function(t){function e(){var e=t.call(this,"ServerSelSkin")||this;return e._noticeTimer=0,e._state=0,e}return __extends(e,t),e.prototype.updatePos=function(){this.height=GmGlobal.stageHeight,UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateSelServer(),PFConst.HAS_HELP||this.bHelp.parent.removeChild(this.bHelp)},e.prototype.addEvts=function(){this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.sBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelServer,this),this.bNotice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNotice,this),this.bHelp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelp,this),CmdBus.adListener(CmdType.C_SLIST,this.onSListClose,this),CmdBus.adListener(CmdType.C_GNOTICE,this.onCloseNotice,this)},e.prototype.rmEvts=function(){this.enterBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.sBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelServer,this),this.bNotice.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNotice,this),this.bHelp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelp,this),CmdBus.rmListener(CmdType.C_SLIST,this.onSListClose,this),CmdBus.rmListener(CmdType.C_GNOTICE,this.onCloseNotice,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.enterBtn.touchEnabled=!1,GmGlobal.cc.dataCtl.ajaxReq("/alert/id/",this.onNoticeId,this)},e.prototype.onNoticeId=function(t){console.log(t),0==t.ret&&t.data&&(1==t.data.fix?(Utils.isInDic(GmGlobal.mc.loginMgr.account,t.data.white)?this._state=0:this._state=1,this._noticeTxt=t.data.content,this._noticeTimer=egret.setTimeout(this.onNotice,this,400)):(this._state=t.data.fix,GmGlobal.cc.dataCtl.ajaxReq("/alert/read/"+t.data.id,this.onNoticeData,this)),GmGlobal.mc.loginMgr.serverState=this._state,Utils.setBtnEnable(this.enterBtn,1==this._state?!1:!0),this.stateIcon.source="com_json.com_"+(1==this._state?"gray":"green"))},e.prototype.onNoticeData=function(t){0==t.ret&&(this._noticeTxt=t.data,this._noticeTimer=egret.setTimeout(this.onNotice,this,400))},e.prototype.onNotice=function(){0!=this._noticeTimer&&(egret.clearTimeout(this._noticeTimer),this._noticeTimer=0),this._noticeTxt&&(this._noticeView||(this._noticeView=new GameNotice),this._noticeView.setTxt(this._noticeTxt.replace(/\\n/g,"\n")),this._noticeView.isShow||this._noticeView.show(GmGlobal.vmc.uiLayer))},e.prototype.onCloseNotice=function(){this._noticeView&&(this._noticeView.close(),this._noticeView=null)},e.prototype.updateSelServer=function(){var t=null,e=GmGlobal.mc.loginMgr;0==e.selServerId?e.myServers&&0!=e.myServers.length?t=e.myServers[0]:e.newServer&&(t=e.newServer):t=e.serverInfos[e.selServerId],t&&t.id>0?(e.selServerId=t.id,this.sTxt.text=t.name):(this.sBtn.touchEnabled=!1,this.sTxt.text="Stay tuned")},e.prototype.onSelServer=function(){this._selServerView||(this._selServerView=new ServerListView),this._selServerView.parent||this._selServerView.show(GmGlobal.vmc.uiLayer)},e.prototype.onEnter=function(){var t=GmGlobal.mc.loginMgr;if(1==this._state)return void this.showMaintainMsg();if(0!=t.selServerId){GmGlobal.cc.pfCtl.pfGameReport(13),this.enterBtn.touchEnabled=!1;var e=this;GmGlobal.cc.loginCtl.checkLogin(t.selServerId,function(i){e.enterBtn.touchEnabled=!0,0==i?(EventBus.dispatchEvt(EventType.ENTER_GAME),CmdBus.doCmd(CmdType.C_SEL_SV)):52==i||111==i||(1==PFConst.SERVER_TYPE?CmdBus.doCmd(CmdType.O_R_CREATE,t.selServerId):(GmGlobal.isNewPlayer=!0,GmGlobal.vmc.startJuqing()))})}},e.prototype.showMaintainMsg=function(){var t="Under maintenance";MsgBox.confirm(t,null,this.onNotice,this,"Confirm","View Notice")},e.prototype.onReloadGame=function(){GmGlobal.cc.pfCtl.pfLogout()},e.prototype.onHelp=function(){GmGlobal.cc.pfCtl.showPfKefu()},e.prototype.onSListClose=function(){this._selServerView&&(this._selServerView.close(),this.updateSelServer())},e.prototype.close=function(){this._selServerView&&(this._selServerView.close(),this._selServerView=null),0!=this._noticeTimer&&(egret.clearTimeout(this._noticeTimer),this._noticeTimer=0),this._noticeView&&(this._noticeView.close(),this._noticeView=null),t.prototype.close.call(this)},e}(UIBase);__reflect(ServerSelView.prototype,"ServerSelView");var Mail=function(){function t(){this.ischk=!1}return t}();__reflect(Mail.prototype,"Mail");var MailController=function(){function t(){this._readSid=0,this._attachmentSid=0,this._onkeyAttackmentSid=0,this._onkeyDelSid=0,GmGlobal.server.regUpdCb(MsgID.UPD_M_COUNT,this.onUpdateMailCount,this)}return t.prototype.onUpdateMailCount=function(t){var e=GmGlobal.mc.mailMgr;e.mailCount=t.count,e.mailUnreadCount=t.unreadCount,e.mailUnreadCount>0?e.redDot.state=1:e.redDot.state=0,EventBus.dispatchEvt(EventType.M_MAIL_UPD)},t.prototype.reqMailList=function(t,e,i){var s=MsgStruct.getMsg(MsgID.REQ_PG_MAIL_LIST);if(!s)return 0;s.flag=t,s.index=e;return GmGlobal.server.sendMsg(MsgID.REQ_PG_MAIL_LIST,s,function(t){if(0!=t.retCode&&GmGlobal.mc.txtMgr.showRetCode(t.retCode),0==t.retCode){for(var e=t.abstractMailList,s=[],o=0;o<e.length;o++){var n=e[o],r=new Mail;r.id=n.mailId,r.subject=n.subiect,r.fromName=n.addresser,r.readFlag=n.readFlag,r.recvFlag=n.recvFlag,r.date=n.date,s.push(r)}GmGlobal.mc.mailMgr.mailList=s}i&&i(t.retCode)})},t.prototype.readMail=function(t,e){if(this._readSid&&GmGlobal.server.hasSerialCallback(this._readSid))return void MsgBox.prompt(TextConst.AWAIT_SERVER);var i=MsgStruct.getMsg(MsgID.REQ_READ_MAIL);if(i){i.mailId=t;var s=this;this._readSid=GmGlobal.server.sendMsg(MsgID.REQ_READ_MAIL,i,function(i){if(s._readSid=0,0!=i.retCode)GmGlobal.mc.txtMgr.showRetCode(i.retCode),e=null;else{var o=i.mailInfo,n=GmGlobal.mc.mailMgr.getMail(t);if(n.content=Utils.replaceColorCode(o.content),n.fromId=o.addresserRoleId,o.appendixList&&o.appendixList.length>0){n.appends=[];for(var r=0,h=o.appendixList;r<h.length;r++){var a=h[r];n.appends.push({id:a.itemId,num:a.count})}}n.readFlag=1,n.recvFlag=o.recvFlag,e&&(e(n),e=null)}})}},t.prototype.clearReadSNo=function(){0!=this._readSid&&(GmGlobal.server.clearSerialCallbak(this._readSid),this._readSid=0)},t.prototype.reqRecvMailAppendix=function(t,e){if(this._attachmentSid&&GmGlobal.server.hasSerialCallback(this._attachmentSid))return void MsgBox.prompt(TextConst.AWAIT_SERVER);var i=MsgStruct.getMsg(MsgID.REQ_RECV_MAIL_AFFIX);if(i){i.mailId=t;var s=this;this._attachmentSid=GmGlobal.server.sendMsg(MsgID.REQ_RECV_MAIL_AFFIX,i,function(t){s._attachmentSid=0,0!=t.retCode&&GmGlobal.mc.txtMgr.showRetCode(t.retCode),e&&e(t.retCode)})}},t.prototype.clearAttachmentSNo=function(){0!=this._attachmentSid&&(GmGlobal.server.clearSerialCallbak(this._attachmentSid),this._attachmentSid=0)},t.prototype.reqMultiDelMail=function(t){if(this._onkeyDelSid&&GmGlobal.server.hasSerialCallback(this._onkeyDelSid))return void MsgBox.prompt(TextConst.AWAIT_SERVER);var e=MsgStruct.getMsg(MsgID.REQ_MDEL_MAIL);if(e){var i=this;this._onkeyDelSid=GmGlobal.server.sendMsg(MsgID.REQ_MDEL_MAIL,e,function(e){i._onkeyDelSid=0,0!=e.retCode&&GmGlobal.mc.txtMgr.showRetCode(e.retCode),t&&t(e.retCode)})}},t.prototype.clearDelSNo=function(){0!=this._onkeyDelSid&&(GmGlobal.server.clearSerialCallbak(this._onkeyDelSid),this._onkeyDelSid=0)},t.prototype.reqRecvAllMailAppendix=function(t){if(this._onkeyAttackmentSid&&GmGlobal.server.hasSerialCallback(this._onkeyAttackmentSid))return void MsgBox.prompt(TextConst.AWAIT_SERVER);var e=MsgStruct.getMsg(MsgID.REQ_MRECV_MAIL_AFFIX);if(e){e.read=1;var i=this;this._onkeyAttackmentSid=GmGlobal.server.sendMsg(MsgID.REQ_MRECV_MAIL_AFFIX,e,function(e){if(i._onkeyAttackmentSid=0,0!=e.retCode&&GmGlobal.mc.txtMgr.showRetCode(e.retCode),t){for(var s=GmGlobal.mc.mailMgr.mailList,o=0,n=s;o<n.length;o++){var r=n[o];r.readFlag=1,r.recvFlag=1}t(e.retCode)}})}},t.prototype.clearOneKeyASNo=function(){0!=this._onkeyAttackmentSid&&(GmGlobal.server.clearSerialCallbak(this._onkeyAttackmentSid),this._onkeyAttackmentSid=0)},t}();__reflect(MailController.prototype,"MailController");var MailHistoryItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)
},e.prototype.dataChanged=function(){var t=GmGlobal.mc.mailMgr.hmails[this.data];t?this.setData(t):(this.title.text="Loading",this.time.text="",GmGlobal.cc.dataCtl.ajaxReq("/mail/read/"+this.data,this.onData,this))},e.prototype.setData=function(t){this.title.textFlow=TextFormat.parser.parse(t.subject),this.time.text=Utils.formatDate(Utils.getServerTime(t.date),"Y-M-D h:m:s")},e.prototype.onData=function(t){if(0==t.ret){var e=t.data,i=e[1];if(i!=this.data)this.dataChanged();else{var s=new Mail;s.id=i,s.readFlag=1,s.recvFlag=1,s.subject=e[2],s.fromName=e[3],s.content=e[4],s.appends=this.formatAppend(e[5]),s.date=e[6],GmGlobal.mc.mailMgr.hmails[this.data]=s,this.setData(s)}}},e.prototype.formatAppend=function(t){var e=t.split(";");if(0==e.length)return null;for(var i=[],s=0;s<e.length;s++){var o=e[s].split(",");i.push({id:o[0],num:o[1]})}return i},e}(eui.ItemRenderer);__reflect(MailHistoryItem.prototype,"MailHistoryItem");var MailHistoryView=function(t){function e(){return t.call(this,"MailHistorySkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="MailHistoryItemSkin",this.itemList.itemRenderer=MailHistoryItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.reqList()},e.prototype.reqList=function(){GmGlobal.cc.dataCtl.ajaxReq("/mail/list/",this.onListRet,this)},e.prototype.onListRet=function(t){if(this._array.removeAll(),0==t.ret)for(var e in t.data)this._array.addItem(t.data[e])},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data,i=GmGlobal.mc.mailMgr.hmails[e];i&&CmdBus.doCmd(CmdType.O_MAILC_V,i)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MAIL_H)},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(MailHistoryView.prototype,"MailHistoryView");var MailItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data;1==t.readFlag?this.icon.source="com_json.mail_open":this.icon.source="com_json.mail_close",this.title.textFlow=TextFormat.parser.parse(this.title.chackFlowWordWrap(t.subject,this.title.width)),this.time.text=Utils.formatDate(Utils.getServerTime(t.date),"Y-M-D h:m:s")},e}(eui.ItemRenderer);__reflect(MailItem.prototype,"MailItem");var MailManager=function(){function t(){this.mailCount=0,this.mailUnreadCount=0,this.hmails={},this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.MAIL,this.redDot),this.mailList=[]}return t.prototype.getMail=function(t){for(var e=0,i=this.mailList;e<i.length;e++){var s=i[e];if(s.id==t)return s}return null},t}();__reflect(MailManager.prototype,"MailManager");var MailMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.MAIL,CmdType.O_MAIL),CmdBus.adListener(CmdType.O_MAIL,this.onOpenView,this),CmdBus.adListener(CmdType.C_MAIL,this.onCloseView,this),CmdBus.adListener(CmdType.O_MAIL_H,this.openHView,this),CmdBus.adListener(CmdType.C_MAIL_H,this.closeHView,this),CmdBus.adListener(CmdType.O_MAILC_V,this.onOpenCView,this),CmdBus.adListener(CmdType.C_MAILC_V,this.onCloseCView,this)}return t.prototype.onOpenView=function(t){this.doOpen()},t.prototype.doOpen=function(){this._uiView||(this._uiView=new MailView),this._uiView.isShow||(this._uiView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._uiView&&this._uiView.isShow&&this._uiView.alphaClose(this._uiView.close,this._uiView)},t.prototype.onOpenCView=function(t){this._uiPView||(this._uiPView=new MailPageView),this._uiPView.isShow||this._uiPView.show(GmGlobal.vmc.uiLayer),this._uiPView.setMail(t)},t.prototype.onCloseCView=function(){this._uiPView&&this._uiPView.isShow&&this._uiPView.close()},t.prototype.openHView=function(){this._hView||(this._hView=new MailHistoryView),this._hView.isShow||this._hView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeHView=function(){this._hView&&this._hView.close()},t.prototype.destroy=function(){return this._uiView?this._uiView&&this._uiView.isDestroy()?(this._uiView.destroy(),this._uiView=null,this._uiPView&&(this._uiPView.destroy(),this._uiPView=null),this._hView=null,!0):!1:!0},t}();__reflect(MailMediator.prototype,"MailMediator",["IMediator"]);var MailPageView=function(t){function e(){var e=t.call(this,"MailPageSkin")||this;return e._reqListSNo=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.iscoll.horizontalScrollBar&&(this.iscoll.horizontalScrollBar.autoVisibility=!1),this.iscoll.verticalScrollBar&&(this.iscoll.verticalScrollBar.autoVisibility=!1),this.contentS.horizontalScrollBar&&(this.contentS.horizontalScrollBar.autoVisibility=!1),this.contentS.verticalScrollBar&&(this.contentS.verticalScrollBar.autoVisibility=!1)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.updatePos=function(){this.x=Math.round(GmGlobal.stageWidth/2),this.y=Math.round(GmGlobal.stageHeight/2),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bLq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageFujian,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bLq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageFujian,this)},e.prototype.onPageFujian=function(){var t=this;GmGlobal.cc.mailCtl.reqRecvMailAppendix(this._mail.id,function(e){0==e&&(t._mail.recvFlag=1,t.updateBtnState())})},e.prototype.updateBtnState=function(){this._mail.appends&&this._mail.appends.length>0?(this.bLq.visible=!0,1==this._mail.recvFlag?(this.bLq.label="Claimed",Utils.setBtnEnable(this.bLq,!1)):(this.bLq.label="Claim",Utils.setBtnEnable(this.bLq,!0))):this.bLq.visible=!1},e.prototype.setMail=function(t){this._mail=t,this.send.text=t.fromName,this.mName.textFlow=TextFormat.parser.parse(this.mName.chackFlowWordWrap(t.subject,this.mName.width)),this.content.textFlow=TextFormat.parser.parse(this.content.chackFlowWordWrap(t.content,this.content.width));var e=1;t.appends&&t.appends.length>0&&(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t.appends,100),this._itemGridCon.addToParent(15,10,this.itemCon,null,560),this._itemGridCon.setTouchCb(!0),this.iscoll.viewport.scrollV=0,e=Math.ceil(t.appends.length/5)),this.sendBg.height=this.sendt.height+20,this.titlet.y=this.sendBg.y+this.sendBg.height+24,this.titleBg.y=this.sendBg.y+this.sendBg.height+14,this.mName.y=this.sendBg.y+this.sendBg.height+24,this.titleBg.height=this.mName.height+20,this.contentt.y=this.titleBg.y+this.titleBg.height+24,this.contentS.y=this.titleBg.y+this.titleBg.height+24,this.contentBg.y=this.titleBg.y+this.titleBg.height+14,this.contentBg.height=this.fjt.y-this.contentBg.y-15,this.contentS.height=this.fjt.y-this.contentBg.y-35;var i=Math.min(10*(e-1)+100*e,430);this.iscoll.height=i,this.txtBg.height=this.iscoll.height+this.iscoll.y+20-this.txtBg.y,this.bLq.y=this.txtBg.y+this.txtBg.height+55,this.bg.height=this.bLq.y+65,this.height=this.bg.height+20,this.bClose.y=this.height-40,this.updatePos(),this.updateBtnState()},e.prototype.onGetFujian=function(){var t=this;GmGlobal.cc.mailCtl.reqRecvAllMailAppendix(function(e){0==e&&(t._mail.recvFlag=1,t.updateBtnState())})},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MAILC_V)},e.prototype.close=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),this._mail=null,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(MailPageView.prototype,"MailPageView");var MailView=function(t){function e(){var e=t.call(this,"MailSkin")||this;return e._items=[],e._reqListSNo=0,e._reqCount=10,e._reqStart=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="MailItemSkin",this.itemList.itemRenderer=MailItem},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this._reqStart=0,this.reqMailList(this._reqStart)},e.prototype.updatePos=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=Math.round(GmGlobal.stageWidth/2),this.y=Math.round(GmGlobal.stageHeight/2)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bLq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetFujian,this),this.bHistory.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHistory,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bLq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetFujian,this),this.bHistory.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHistory,this)},e.prototype.onPageFujian=function(){var t=this;GmGlobal.cc.mailCtl.reqRecvMailAppendix(this._mail.id,function(e){0==e&&t.onOneKeyDel()})},e.prototype.reqMailList=function(t){var e=this;void 0===t&&(t=0);var i=this;this._reqListSNo=GmGlobal.cc.mailCtl.reqMailList(1,t,function(t){e._reqListSNo=0,0==t&&i.updateList()})},e.prototype.updateList=function(){var t=GmGlobal.mc.mailMgr.mailList;0==t.length?(this._array.removeAll(),this.noTipCon.visible=!0,this.tTip.text="Mailbox is empty~\nWaiting for the next mail！",this.bLq.visible=!1,this.bHistory.visible=!0):(this._array.replaceAll(t),this.noTipCon.visible=!1,this.tTip.text="",this.bLq.visible=!0,this.bLq.label="Claim All",this.bHistory.visible=!1)},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent.data;if(!e)return;if(e.content)CmdBus.doCmd(CmdType.O_MAILC_V,e);else{var i=this;GmGlobal.cc.mailCtl.readMail(e.id,function(t){CmdBus.doCmd(CmdType.O_MAILC_V,t),i.updateItemReadState(t)})}}},e.prototype.updateItemReadState=function(t){var e=GmGlobal.mc.mailMgr.mailList,i=e.indexOf(t);-1!=i&&this._array.replaceItemAt(t,i)},e.prototype.onOneKeyDel=function(){var t=this;GmGlobal.cc.mailCtl.reqMultiDelMail(function(e){0==e&&(GmGlobal.mc.mailMgr.mailList=[],t.scoll.viewport.scrollV=0,t.reqMailList())})},e.prototype.onGetFujian=function(){var t=this;GmGlobal.cc.mailCtl.reqRecvAllMailAppendix(function(e){0==e&&t.onOneKeyDel()})},e.prototype.onHistory=function(){CmdBus.doCmd(CmdType.O_MAIL_H)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MAIL)},e.prototype.close=function(){0!=this._reqListSNo&&(GmGlobal.server.clearSerialCallbak(this._reqListSNo),this._reqListSNo=0),GmGlobal.cc.mailCtl.clearReadSNo(),GmGlobal.cc.mailCtl.clearDelSNo(),GmGlobal.cc.mailCtl.clearOneKeyASNo(),GmGlobal.cc.mailCtl.clearAttachmentSNo(),this._mail=null,t.prototype.close.call(this)},e}(UIBase);__reflect(MailView.prototype,"MailView");var AutoRecover=function(){function t(){this._hpTimer=0,this._spTimer=0}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.start=function(){0==this._hpTimer&&(this._hpTimer=egret.setInterval(this.onHp,this,6e3)),0==this._spTimer&&(this._spTimer=egret.setInterval(this.onSp,this,5e3))},t.prototype.stop=function(){0!=this._hpTimer&&(egret.clearInterval(this._hpTimer),this._hpTimer=0),0!=this._spTimer&&(egret.clearInterval(this._spTimer),this._spTimer=0)},t.prototype.onHp=function(){var t=GmGlobal.mc,e=t.heroMgr.getAtrValue("hm"),i=Math.max(Math.floor(.001*e*(t.heroMgr.getAtrValue("hc")/100+1)),1);t.role.hp+i<e&&(t.role.hp=Math.min(t.role.hp+i,e),EventBus.dispatchEvt(EventType.S_HP_CH,i),GmGlobal.cc.sceneCtl.roleHpUpd(t.role.hp))},t.prototype.onSp=function(){var t=GmGlobal.mc,e=t.heroMgr.getAtrValue("mm"),i=Math.max(Math.floor(.001*e)+t.heroMgr.getAtrValue("ic"),1);t.role.sp=Math.min(t.role.sp+i,e),EventBus.dispatchEvt(EventType.S_SP_CH)},t}();__reflect(AutoRecover.prototype,"AutoRecover");var GuideTaskEffect=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.showComplate=function(){this._wcImg||(this._wcImg=new eui.Image("com_json.renwuwancheng"),this.addChild(this._wcImg),this._wcImg.anchorOffsetX=124),this.parent||(GmGlobal.vmc.noticeLayer.addChild(this),this.x=GmGlobal.stageWidth/2,this.y=GmGlobal.stageHeight/2-160),egret.Tween.removeTweens(this._wcImg),this._wcImg.y=100,this._wcImg.x=0,this._wcImg.alpha=0,egret.Tween.get(this._wcImg).to({y:0,alpha:1},300).wait(1e3).to({y:-100,alpha:0},300).call(this.onComplate,this)},e.prototype.onComplate=function(){this.parent&&this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(GuideTaskEffect.prototype,"GuideTaskEffect");var GuideTaskView=function(t){function e(){var e=t.call(this,"GuideTaskSkin")||this;return e._autoTimer=0,e._isAutoGuide=!0,e._isTouch=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.updatePos=function(){GmConst.IS_FULLSCENE?this.y=GmGlobal.stageHeight-390-Math.min(this.height,140)-GmConst.BOTTOM_SPACE:this.y=GmGlobal.stageHeight-390-Math.min(this.height,140);var t=GmGlobal.vmc.scene.currenScene;this.x=Math.min(t.x+t.blockMap.width-this.width-2,GmGlobal.stageWidth-this.width-2)},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAward,this),EventBus.addListener(EventType.GUIDE_TASK_UPD,this.update,this),EventBus.addListener(EventType.RESIZE,this.updatePos,this),EventBus.addListener(EventType.ENTER_SCENE,this.updatePos,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAward,this),EventBus.rmListener(EventType.GUIDE_TASK_UPD,this.update,this),EventBus.rmListener(EventType.RESIZE,this.updatePos,this),EventBus.rmListener(EventType.ENTER_SCENE,this.updatePos,this)},e.prototype.showAt=function(e,i){t.prototype.showAt.call(this,e,i),this._isTouch=!1,this.update(null)},e.prototype.update=function(t){var e=GmGlobal.mc.guideMgr,i=e.getGuideTask();if(!i.idx)return void CmdBus.doCmd(CmdType.C_GUIDE_TASK);var s=e.getTaskListInfo(i.idx);if(!s)return void CmdBus.doCmd(CmdType.C_GUIDE_TASK);if(PFConst.IS_NOPAY&&s.id==GuideID.OPEN_VIP)return void(0==i.state?GmGlobal.cc.dataCtl.doAction(ServerActionId.GUIDE_CP):1==i.state&&GmGlobal.cc.dataCtl.doAction(ServerActionId.GUIDE_AW));var o=e.getTaskInfo(s.id);this.pTxt.text=i.idx+"/"+e.getTaskListLen();var n=o.introduce.replace(/%x/g,s.x>1&&s.id!=GuideID.LEVEL?i.cnt+"/"+s.x:s.x);if(s.y){var r=GmGlobal.mc.npcMgr.getNpcCfg(s.y);n=r?n.replace(/%y/g,r.name):n.replace(/%y/g,s.y)}this.tName.textFlow=TextFormat.parser.parse(TextFormat.setColor(n,i.state?Colors.GREEN:Colors.WHILE));for(var h=TextFormat.setColor("Reward：",4377794),a=0,l=s.items;a<l.length;a++){var c=l[a],d=GmGlobal.mc.itemMgr.getItemCfg(c.id);h+=TextFormat.setColor(d.name,Utils.getQualityColor(d.quality))+"*"+c.num+" "}this.tAw.textFlow=TextFormat.parser.parse(h),this.tAw.y=this.tName.y+this.tName.textHeight+10,this.height=this.tAw.y+this.tAw.textHeight+10,1==i.state?(this.addEffect(),t&&GuideTaskEffect.getInstence().showComplate()):this.clearEffect(),this._isTouch||this.delayShowGuide()},e.prototype.delayShowGuide=function(){if(this._isAutoGuide){var t=GmGlobal.mc.guideMgr.getGuideTask();if(t.idx){var e=GmGlobal.mc.guideMgr.getTaskInfoByIdx(t.idx);e&&(this.clearDelayGuide(),e.fingerTime>0?this._autoTimer=egret.setTimeout(this.onDelayShowGuide,this,1e3*e.fingerTime):this.onDelayShowGuide())}}},e.prototype.clearDelayGuide=function(){0!=this._autoTimer&&(egret.clearTimeout(this._autoTimer),this._autoTimer=0)},e.prototype.onDelayShowGuide=function(){var t=GmGlobal.mc.guideMgr.getGuideTask();if(1!=t.state){this._autoTimer=0;var e=GmGlobal.mc.guideMgr.getTaskListInfo(t.idx);e.id!=GuideID.LEVEL&&this.addFinger()}},e.prototype.onAward=function(){this.clearDelayGuide(),this.rmFinger();var t=GmGlobal.mc.guideMgr.getGuideTask();if(1==t.state)this._isTouch=!1,GmGlobal.cc.dataCtl.doAction(ServerActionId.GUIDE_AW);else{this._isTouch=!0;var e=GmGlobal.mc.guideMgr.getTaskListInfo(t.idx);if(e.id!=GuideID.LEVEL){var i=new egret.Point(this.x,this.y);i.x+=this.width/2,i.y+=this.height/2,GmGlobal.vmc.mGuide.triggerGuide(e.id,i,e.x-t.cnt,e.x),GmGlobal.vmc.mGuide.bindTarget(GuideTargetId.MAINUI_GUIDE_TASK,this,i)}}},e.prototype.addEffect=function(){this.addFinger()},e.prototype.clearEffect=function(){this.rmFinger()},e.prototype.addFinger=function(){this._finger||(this._finger=new FingerView(this)),this._finger.guideTo(new egret.Rectangle(0,0,this.width,this.height),!1)},e.prototype.rmFinger=function(){this._finger&&this._finger.hide()},e.prototype.close=function(){this.clearDelayGuide(),this.clearEffect(),this._finger=null,t.prototype.close.call(this)},e}(UIBase);__reflect(GuideTaskView.prototype,"GuideTaskView");var MainUICdText=function(){function t(t,e,i){this.modelId=t,this.cd=e,this.lable=i}return t.prototype.update=function(){var t=this.cd.cd;return this.lable.text=Utils.formatTime(t,"DD h:m:s"),0==t?!0:!1},t}();__reflect(MainUICdText.prototype,"MainUICdText");var MainUIManager=function(){function t(){this.isInited=!1,this._cmds={},this._redDots={},this.comRDot=new RedDot("0",null),this.comRDot.childs={},GmGlobal.mc.regUnzipCfg("c_pilao.json",this.initPlCfg,this)}return t.prototype.initPlCfg=function(t){this.plCfg=t},t.prototype.regCmd=function(t,e,i){void 0===i&&(i=null),this._cmds[t]={cmd:e,data:i}},t.prototype.unregCmd=function(t){this._cmds[t]=null},t.prototype.getCmdData=function(t){return this._cmds[t]},t.prototype.regRedDot=function(t,e){e&&(this._redDots[t]=e)},t.prototype.getRedDot=function(t){return this._redDots[t]},t.prototype.getRedDots=function(){return this._redDots},t.prototype.getModelIdByRedDot=function(t){for(var e in this._redDots)if(this._redDots[e]==t)return Number(e);return-1},t}();__reflect(MainUIManager.prototype,"MainUIManager");var MainUIMediator=function(){function t(){this._isReady=!1,CmdBus.adListener(CmdType.O_MUI,this.onShowMainUI,this),CmdBus.adListener(CmdType.C_MUI,this.onCloseMainUI,this),CmdBus.adListener(CmdType.C_GUIDE_TASK,this.onCloseTaskGuide,this),CmdBus.adListener(CmdType.C_QUICK_TASK,this.onCloseQuickTask,this),EventBus.addListener(EventType.M_JUPD+JsonID.LOGIN_DAY,this.checkTask,this),EventBus.addListener(EventType.M_R_Z_UPD,this.onZhanliUp,this),EventBus.addListener(EventType.GAME_READY,this.onReady,this),EventBus.addListener(EventType.M_MUI_READY,this.onMReady,this),EventBus.addListener(EventType.BOSSHP_SHOW,this.onBossHpShow,this),EventBus.addListener(EventType.BOSSHP_HIDE,this.onBossHpHide,this),EventBus.addListener(EventType.M_TASK_LOOP,this.onLoopTaskUpd,this)}return t.prototype.onReady=function(t){EventBus.rmListener(EventType.GAME_READY,this.onReady,this),this._isReady=!0,EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this),this.onShowMainUI(),this.checkTask();var e=GmGlobal.mc.flMgr.lcNum||0;!PFConst.IS_NOPAY&&6>e&&ShowcTip.getInstance().start()},t.prototype.onMReady=function(t){var e=GmGlobal.mc.firstpayMgr.isGetAwd();e&&CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.SHOUCHONG)},t.prototype.onEnterScene=function(t){var e=(GmGlobal.mc,GmGlobal.mc.sceneMgr);e.mapType==SceneType.FUBEN?(this._guideTask&&this._guideTask.close(),this._quickTask&&this._quickTask.close()):this.checkTask()},t.prototype.onBossHpShow=function(){var t=(GmGlobal.mc,GmGlobal.mc.sceneMgr);if(t.mapType==SceneType.WILD){this._guideTask&&this._guideTask.close(),this._quickTask&&this._quickTask.close();var e=GmGlobal.vmc.mGuide;if(e){var i=e.getCurrentStep();!i||!i.target||i.target.parent&&i.target.parent.visible||e.clearGuide()}}},t.prototype.onBossHpHide=function(){var t=(GmGlobal.mc,GmGlobal.mc.sceneMgr);t.mapType==SceneType.WILD&&this.checkTask()},t.prototype.getIconPoint=function(t){return this._mainUI?this._mainUI.getIconPoint(t):null},t.prototype.getMainUI=function(){return this._mainUI},t.prototype.onShowMainUI=function(){this._mainUI||(this._mainUI=new MainUIView),this._mainUI.isShow||(this._mainUI.showAt(GmGlobal.vmc.uiLayer,0),GmGlobal.mc.muiMgr.isInited=!0,EventBus.dispatchEvt(EventType.M_MUI_READY))},t.prototype.onCloseMainUI=function(){this._mainUI&&this._mainUI.isShow&&(this._mainUI.close(),this._mainUI=null)},t.prototype.onZhanliUp=function(t){var e=t.data;if(0!=e){var i=GmGlobal.mc.heroMgr,s=i.getAtrValue("z");e>=s||(this._zlUpTips||(this._zlUpTips=new ZhanliAddTips),this._zlUpTips.show(GmGlobal.vmc.uiLayer2),this._zlUpTips.updateZl(s,e))}},t.prototype.checkTask=function(){GmGlobal.mc.guideMgr.hasTask()?this.onShowTaskGuide():this._quickTask?this._quickTask.parent||this._quickTask.showAt(GmGlobal.vmc.uiLayer,1):this.onShowQuickTask()},t.prototype.onShowTaskGuide=function(){this._mainUI&&(this._guideTask||(this._guideTask=new GuideTaskView),this._guideTask.isShow||this._guideTask.showAt(GmGlobal.vmc.uiLayer,1))},t.prototype.onCloseTaskGuide=function(){this._guideTask&&(this._guideTask.close(),this._guideTask=null,this.onShowQuickTask())},t.prototype.onShowQuickTask=function(){this._mainUI&&(this._quickTask||(this._quickTask=new QuickTaskView),this._quickTask.updateTask(!1,!0)?this._quickTask.showAt(GmGlobal.vmc.uiLayer,1):this._quickTask=null)},t.prototype.onCloseQuickTask=function(){this._quickTask&&(this._quickTask.close(),this._quickTask=null)},t.prototype.onLoopTaskUpd=function(){this._quickTask||this.checkTask()},t}();__reflect(MainUIMediator.prototype,"MainUIMediator");var MainUIView=function(t){function e(){var e=t.call(this,"MainUISkin2")||this;return e._cdTimer=0,e._isRedDotInit=!1,e._buffTimer=-1,e._sTimer=0,e.CHATDEFULTCOLOR=16777215,e._isHpWarning=!1,e._isSpWarning=!1,e._iconIds=[],e._touchScaleBtns=[],e._cdTexts=[],e._touchBtn=null,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!1,this.initIconModelId(),this.initTouchScaleBtns(),this._iconEffectList=[ModelID.SHOUCHONG,ModelID.HAOLI,ModelID.YIYUAN,ModelID.DAY7,ModelID.DGIFT],this._iconEffects={},this.bTransfer.sound=null},e.prototype.resize=function(){this.height=GmGlobal.stageHeight,GmConst.IS_FULLSCENE?(this.gTop.y=GmConst.TOP_SPACE,GmGlobal.stageHeight>=1500?(this.gDown.y=GmGlobal.stageHeight-this.gDown.height-GmConst.BOTTOM_SPACE,this.msgBg.height=95+GmConst.BOTTOM_SPACE,this.chatMsg.height=this.msgBg.height-20):(this.gDown.y=GmGlobal.stageHeight-this.gDown.height,this.msgBg.height=95,this.chatMsg.height=this.msgBg.height-20)):(this.gDown.y=GmGlobal.stageHeight-this.gDown.height,this.msgBg.height=95,this.chatMsg.height=this.msgBg.height-20),this.updatePos()},e.prototype.updatePos=function(){if(GmGlobal.stageWidth>=1440){var t=GmGlobal.vmc.scene.currenScene;this.width=t?Math.min(t.blockMap.width,GmGlobal.stageWidth):GmGlobal.stageWidth,this.freeBtnCon2.x=this.freeBtnCon.x=Math.max(720,(this.width-720)/2),this.miniBtnCon.x=this.freeBtnCon.x+5,this.freeBtnCon.y=0,this.freeBtnCon2.y=this.freeBtnCon.y+this.freeBtnCon.height-5,this.miniBtnCon.y=this.freeBtnCon2.y+this.freeBtnCon2.height+10,this.freeBtnCon2.width=this.freeBtnCon.width=this.width-this.freeBtnCon.x}else this.width=720,this.freeBtnCon2.width=this.freeBtnCon.width=720,this.freeBtnCon2.x=this.freeBtnCon.x=0,this.miniBtnCon.x=5,this.freeBtnCon.y=166,this.freeBtnCon2.y=this.freeBtnCon.y+this.freeBtnCon.height-5,this.miniBtnCon.y=this.freeBtnCon2.y+this.freeBtnCon2.height+10;this.x=(GmGlobal.stageWidth-this.width)/2,this.updateFreeBtnPos()},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStateTouchEnd,this),EventBus.addListener(EventType.RESIZE,this.resize,this),EventBus.addListener(EventType.M_UPD_CON,this.updateCurrency,this),EventBus.addListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.addListener(EventType.M_CHATMSG_UPD,this.onUpdateChatMsg,this),EventBus.addListener(EventType.M_CHATMAG_ALLUPD,this.updateChatMsg,this),EventBus.addListener(EventType.M_CHATMSG_INIT,this.onChatMsgInit,this),EventBus.addListener(EventType.GUIDE_FINISH,this.onGuideFinish,this),EventBus.addListener(EventType.M_HERO_UPD,this.updateRoleData,this),EventBus.addListener(EventType.S_HP_CH,this.updateRoleHp,this),EventBus.addListener(EventType.S_SP_CH,this.updateRoleSp,this),EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this),EventBus.addListener(EventType.BUFF_ICON,this.onBuffIconUpd,this),EventBus.addListener(EventType.BUFF_RM,this.onBuffIconRm,this),EventBus.addListener(EventType.BUFF_CLEAR,this.onBuffClear,this),EventBus.addListener(EventType.TRIGGER_GUIDE,this.onTriggerGuide,this,100),EventBus.addListener(EventType.GUIDE_TASK_UPD,this.onGuideTaskUpd,this),EventBus.addListener(EventType.BOSSHP_SHOW,this.hideFreeBtn,this,100),EventBus.addListener(EventType.BOSSHP_HIDE,this.showFreeBtn,this,100),EventBus.addListener(EventType.GUIDE_TASK_UPD,this.updateAutoBtn,this),CmdBus.adListener(CmdType.AD_M_ICON,this.addFreeBtn,this),CmdBus.adListener(CmdType.RM_M_ICON,this.removeFreeBtn,this),CmdBus.adListener(CmdType.RE_M_ICON,this.resetBtnIcon,this),CmdBus.adListener(CmdType.S_ZHUABU,this.setZhabuBtn,this),CmdBus.adListener(CmdType.C_CHAT,this.onChatClose,this),CmdBus.adListener(CmdType.S_M_CD,this.setCountDownTime,this),CmdBus.adListener(CmdType.C_M_CD,this.clearCountDownTime,this),EventBus.addListener(EventType.M_JUPD+JsonID.PILAO,this.updatePlz,this),EventBus.addListener(EventType.M_JUPD+JsonID.TXK,this.updateTxk,this);var t=GmGlobal.cc.itemCtl;t.bindItemCallback(10007,this.updateHpState,this),t.bindItemCallback(10009,this.updateSpState,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStateTouchEnd,this),EventBus.rmListener(EventType.RESIZE,this.resize,this),EventBus.rmListener(EventType.M_UPD_CON,this.updateCurrency,this),EventBus.rmListener(EventType.M_R_UPD,this.updateRoleInfo,this),EventBus.rmListener(EventType.M_CHATMSG_UPD,this.onUpdateChatMsg,this),EventBus.rmListener(EventType.M_CHATMAG_ALLUPD,this.updateChatMsg,this),EventBus.rmListener(EventType.M_CHATMSG_INIT,this.onChatMsgInit,this),EventBus.rmListener(EventType.GUIDE_FINISH,this.onGuideFinish,this),EventBus.rmListener(EventType.M_HERO_UPD,this.updateRoleData,this),EventBus.rmListener(EventType.S_HP_CH,this.updateRoleHp,this),EventBus.rmListener(EventType.S_SP_CH,this.updateRoleSp,this),EventBus.rmListener(EventType.ENTER_SCENE,this.onEnterScene,this),EventBus.rmListener(EventType.BUFF_ICON,this.onBuffIconUpd,this),EventBus.rmListener(EventType.BUFF_RM,this.onBuffIconRm,this),EventBus.rmListener(EventType.BUFF_CLEAR,this.onBuffClear,this),EventBus.rmListener(EventType.TRIGGER_GUIDE,this.onTriggerGuide,this),EventBus.rmListener(EventType.GUIDE_TASK_UPD,this.onGuideTaskUpd,this),EventBus.rmListener(EventType.BOSSHP_SHOW,this.hideFreeBtn,this),EventBus.rmListener(EventType.BOSSHP_HIDE,this.showFreeBtn,this),EventBus.rmListener(EventType.GUIDE_TASK_UPD,this.updateAutoBtn,this),CmdBus.rmListener(CmdType.AD_M_ICON,this.addFreeBtn,this),CmdBus.rmListener(CmdType.RM_M_ICON,this.removeFreeBtn,this),CmdBus.rmListener(CmdType.RE_M_ICON,this.resetBtnIcon,this),CmdBus.rmListener(CmdType.S_ZHUABU,this.setZhabuBtn,this),CmdBus.rmListener(CmdType.C_CHAT,this.onChatClose,this),CmdBus.adListener(CmdType.S_M_CD,this.setCountDownTime,this),CmdBus.adListener(CmdType.C_M_CD,this.clearCountDownTime,this),EventBus.rmListener(EventType.M_JUPD+JsonID.PILAO,this.updatePlz,this),EventBus.rmListener(EventType.M_JUPD+JsonID.TXK,this.updateTxk,this);var t=GmGlobal.cc.itemCtl;t.removeItemCallback(10007,this.updateHpState,this),t.removeItemCallback(10009,this.updateSpState,this)},e.prototype.fpayUnvis=function(){},e.prototype.showSTime=function(){this.onTimeTick(),this._sTimer=egret.setInterval(this.onTimeTick,this,6e4)},e.prototype.onTimeTick=function(){this.sTime.text=Utils.formatDate(GmGlobal.getServerLocalTime(),"Y-M-D h:m")},e.prototype.showAt=function(e,i){t.prototype.showAt.call(this,e,i),this.updateCurrency(),this.updateRoleInfo(),this.updateRoleData(),this.updateRoleHp(),this.updateChatChSel(),this.updatePlz(),PFConst.IS_NOPAY?this.setNoPayBtn():this.openPayBtn(),!GmGlobal.IS_DEBUG,this.initBuffIcons(),this.fpayUnvis(),this.updateBtnState(),this.updateFreeBtnPos(),this.validateNow(),this.onEnterScene(),this._isRedDotInit||(this._isRedDotInit=!0,this.initRedDots()),this.updateHpState(),this.updateSpState(),this.showSTime(),this.updateAutoBtn()},e.prototype.initIconModelId=function(){this._iconIds.push({id:ModelID.SHOP,btn:this.bShop,p:this.freeBtnCon,idx:0}),this._iconIds.push({id:ModelID.VIP1,btn:this.bVip1,p:this.freeBtnCon,idx:1}),this._iconIds.push({id:ModelID.VIP,btn:this.bVip,p:this.freeBtnCon,idx:2}),this._iconIds.push({id:ModelID.FULI,btn:this.bFl,p:this.freeBtnCon,idx:3}),this._iconIds.push({id:ModelID.XUSHANG,btn:this.bXs,p:this.freeBtnCon,idx:4}),this._iconIds.push({id:ModelID.TASK,btn:this.bTask,p:this.freeBtnCon,idx:5}),this._iconIds.push({id:ModelID.DGIFT,btn:this.bDGift,p:this.freeBtnCon,idx:7}),this._iconIds.push({id:ModelID.WANFA,btn:this.bWf,p:this.freeBtnCon2,idx:0}),this._iconIds.push({id:ModelID.MVP,btn:this.bMvp,p:this.freeBtnCon2,idx:1}),this._iconIds.push({id:ModelID.YCKJ,btn:this.bYckj,p:this.freeBtnCon2,idx:2}),this._iconIds.push({id:ModelID.GTASK,btn:this.bCz,p:this.freeBtnCon2,idx:3}),this._iconIds.push({id:ModelID.HAOLI,btn:this.bHaoli,p:this.freeBtnCon2,idx:5}),this._iconIds.push({id:ModelID.SHOUCHONG,btn:this.bShouc,p:this.freeBtnCon2,idx:4}),this._iconIds.push({id:ModelID.TITLE,btn:this.bch}),this._iconIds.push({id:ModelID.MAIL,btn:this.bMail}),this._iconIds.push({id:ModelID.RANK,btn:this.bRank}),this._iconIds.push({id:ModelID.HERO,btn:this.bHero}),this._iconIds.push({id:ModelID.SKILL,btn:this.bSkill}),this._iconIds.push({id:ModelID.TOUSHI,btn:this.bToushi}),this._iconIds.push({id:ModelID.PET,btn:this.bChongwu}),this._iconIds.push({id:ModelID.BAG,btn:this.bBag}),this._iconIds.push({id:ModelID.XINGZUO,btn:this.bXz}),this._iconIds.push({id:ModelID.HUOBAN,btn:this.bHb}),this._iconIds.push({id:ModelID.CHUANBAO,btn:this.bCb}),this._iconIds.push({id:ModelID.FRIEND,btn:this.bFriend}),this._iconIds.push({id:ModelID.TUJIAN,btn:this.bTj}),this._iconIds.push({id:ModelID.HALO,btn:this.bHalo,p:this.downBtnCon}),this.addPayBtns()},e.prototype.addPayBtns=function(){},e.prototype.initTouchScaleBtns=function(){this._touchScaleBtns=[this.bAddZs,this.bAddJs,this.bAddJb,this.bShop,this.bFl,this.bHero,this.bBag,this.bToushi,this.bChongwu,this.bSkill,this.bMvp,this.bTask,this.bTransfer,this.bVip,this.bXs,this.bXz,this.bWf,this.bShouc,this.bHaoli,this.bZhuabu,this.bHb,this.bCb,this.bFriend,this.bDGift,this.bTj,this.bRank,this.bch,this.bVip1,this.bHalo,this.bAi,this.bYckj]
},e.prototype.setNoPayBtn=function(){this.zsAdd.visible=!1,this.bAddZs.touchEnabled=!1,this.freeBtnCon2.removeChild(this.bShouc),this.freeBtnCon2.removeChild(this.bHaoli),this.freeBtnCon.removeChild(this.bVip),this.freeBtnCon.removeChild(this.bXs),this.freeBtnCon.removeChild(this.bDGift),this.freeBtnCon.removeChild(this.bVip1),this.freeBtnCon2.removeChild(this.bCz),this.miniBtnCon.removeChild(this.bch)},e.prototype.openPayBtn=function(){this.zsAdd.visible=!0,this.bAddZs.touchEnabled=!0},e.prototype.getIdByBtn=function(t){for(var e=0,i=this._iconIds;e<i.length;e++){var s=i[e];if(s.btn==t)return s.id}return-1},e.prototype.getIconInfoByBtn=function(t){for(var e=0,i=this._iconIds;e<i.length;e++){var s=i[e];if(s.btn==t)return s}return null},e.prototype.getBtnById=function(t){for(var e=0,i=this._iconIds;e<i.length;e++){var s=i[e];if(s.id==t)return s.btn}return null},e.prototype.rmBtn=function(t){for(var e=0;e<this._iconIds.length;e++){var i=this._iconIds[e];if(i.id==t)return void this._iconIds.splice(e,1)}},e.prototype.rmBtnByIcon=function(t){for(var e=0;e<this._iconIds.length;e++){var i=this._iconIds[e];if(i.btn==t)return t.parent&&t.parent.removeChild(t),void this._iconIds.splice(e,1)}},e.prototype.adBtnByIcon=function(t){for(var e=0;e<this._iconIds.length;e++){var i=this._iconIds[e];if(i.btn==t)return void(i.p&&i.p.addChild(t))}},e.prototype.getIconPoint=function(t){var e=this.getBtnById(t),i=e.parent.localToGlobal(e.x,e.y);return i},e.prototype.addFreeBtn=function(t,e,i,s){void 0===i&&(i=2),void 0===s&&(s=-1);var o=this.getBtnById(t);if(!o){o=new eui.Image,o.source=e,3==i?(o.width=75,o.height=70,o.anchorOffsetX=37,o.anchorOffsetY=35,o.y=35):(o.width=90,o.height=90,o.anchorOffsetX=45,o.anchorOffsetY=45);var n={id:t,btn:o,p:1==i?this.freeBtnCon:3==i?this.miniBtnCon:this.freeBtnCon2};-1!=s&&(n.idx=s),this._iconIds.push(n),this._touchScaleBtns.push(o)}o.parent||(1==i?this.freeBtnCon.addChild(o):3==i?this.miniBtnCon.addChild(o):this.freeBtnCon2.addChild(o),this.checkEffectState(t,o),this.updateFreeBtnPos(),this.addBtnRedDot(t,o),!GmGlobal.mc.guideMgr.isModeuleOpen(t))},e.prototype.removeFreeBtn=function(t,e){void 0===e&&(e=2);var i=this.getBtnById(t);if(!i||!i.parent)return void this.rmBtn(t);1==e?this.freeBtnCon.removeChild(i):3==e?this.miniBtnCon.removeChild(i):this.freeBtnCon2.removeChild(i),this.checkEffectState(t,i),this.updateFreeBtnPos(),RedDotView.removeRedDot(i),this.rmBtn(t);var s=this._touchScaleBtns.indexOf(i);s>=0&&this._touchScaleBtns.splice(s,1)},e.prototype.addDownBtn=function(t){var e=this.getBtnByID(t);e&&!e.parent&&this.downBtnCon.addChild(e)},e.prototype.getBtnByID=function(t){for(var e=0,i=this._iconIds;e<i.length;e++){var s=i[e];if(s.id==t)return s.btn}return null},e.prototype.getFreeBtnIndex=function(t,e,i,s){for(var o=0;s>o;o++){var n=t.getChildAt(o),r=this.getIconInfoByBtn(n);if(void 0==r.idx||i<r.idx)return o}return t.numChildren-1},e.prototype.updateFreeBtnPos=function(){this.resetFreeConBtnPos(this.freeBtnCon,90,Math.floor(this.freeBtnCon.width/90)),this.resetFreeConBtnPos(this.freeBtnCon2,90,Math.floor(this.freeBtnCon.width/90)),this.resetMiniConPos(),this.freeBtnCon2.y=this.freeBtnCon.y+this.freeBtnCon.height-5,this.miniBtnCon.y=this.freeBtnCon2.y+this.freeBtnCon2.height+10,this.updateEffectPos(),this.updateCDPos(),this.updateAllRedDotPos()},e.prototype.updateAllRedDotPos=function(){this.validateNow();for(var t=0,e=this._iconIds;t<e.length;t++){var i=e[t];this.resetBtnDotPos(i.btn)}},e.prototype.resetBtnDotPos=function(t){var e=RedDotView.getRedDot(t);if(e){var i=this.getIconRDPoint(t);e.x=i.x,e.y=i.y}},e.prototype.resetFreeConBtnPos=function(t,e,i,s,o){void 0===e&&(e=90),void 0===i&&(i=8),void 0===s&&(s=45),void 0===o&&(o=45);for(var n=0;n<t.numChildren;n++){var r=t.getChildAt(n),h=this.getIconInfoByBtn(r);if(h&&void 0!=h.idx){var a=this.getFreeBtnIndex(t,r,h.idx,n);n>a&&t.setChildIndex(r,a)}}for(var n=0;n<t.numChildren;n++){var r=t.getChildAt(n);r.x=s+n%i*e;var l=Math.floor(n/i);r.y=o+l*e-5*l;var c=RedDotView.getRedDot(r);if(c){var d=this.getIconRDPoint(r);c.x=d.x,c.y=d.y}}var p=Math.ceil(t.numChildren/i);t.height=p*e},e.prototype.resetMiniConPos=function(){for(var t=0;t<this.miniBtnCon.numChildren;t++){var e=this.miniBtnCon.getChildAt(t);e.x=37+75*t}},e.prototype.updateEffectPos=function(){for(var t in this._iconEffects){var e=this.getBtnById(Number(t)),i=this._iconEffects[t];e&&i&&(i.x=e.parent.x+e.x,i.y=e.parent.y+e.y)}},e.prototype.resetBtnIcon=function(t,e){var i=this.getBtnById(t);i&&(i.source=e)},e.prototype.updateBtnState=function(t){void 0===t&&(t=!0);for(var e=0,i=this._iconIds;e<i.length;e++){var s=i[e],o=s.btn;this.isModuleOpen(s.id)&&(o.filters=[],o.parent&&(t||this.addBtnRedDot(s.id,o),this.checkCDText(s.id),this.checkEffectState(s.id,o)))}},e.prototype.onGuideTaskUpd=function(){this.updateBtnState(!1)},e.prototype.updateAllEffectState=function(){for(var t=0,e=this._iconIds;t<e.length;t++){var i=e[t];this.checkEffectState(i.id,i.btn)}},e.prototype.checkEffectState=function(t,e){if(-1!=this._iconEffectList.indexOf(t))if(e.parent){var i=this._iconEffects[t];if(!i){var s="uitx";(t==ModelID.CAT||t==ModelID.DAY7)&&(s="uitx02"),i=new MovieClipEx(s),this._iconEffects[t]=i}i.parent||(i.x=e.parent.x+e.x,i.y=e.parent.y+e.y,i.scaleX=.9,i.scaleY=.9,this.gTop.addChildAt(i,0),i.play()),0==e.parent.visible?i.visible=!1:i.visible=!0}else{var i=this._iconEffects[t];i&&(i.clear(),delete this._iconEffects[t])}},e.prototype.clearEffects=function(){for(var t in this._iconEffects){var e=this._iconEffects[t];e&&e.clear(!0)}this._iconEffects=null},e.prototype.setZhabuBtn=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.bZhuabu.visible=t,this.jzNum.visible=t,t&&(this.jzNum.text=e.toString(),this.jzNum.textColor=e>0?16777215:16711680),this.updateAutoBtn(i)},e.prototype.isModuleOpen=function(t){return GmGlobal.mc.guideMgr.isModeuleOpen(t)},e.prototype.initRedDots=function(){var t=GmGlobal.mc.muiMgr,e=t.getRedDots();for(var i in e){var s=e[i],o=Number(i),n=this.getBtnById(o);if(n&&n.parent&&this.isModuleOpen(o)&&(s.bindChangeCB(this.onRedDotChange,this),1==s.state)){var r=this.getIconRDPoint(n);RedDotView.addRedDot(n,this.redDotCon,"mui",r.x,r.y,"com_json.com_rdd")}}},e.prototype.getIconRDPoint=function(t){var e;return e=t.parent.localToGlobal(t.x,t.y),e=this.globalToLocal(e.x,e.y),t.anchorOffsetX<40?(e.x+=t.anchorOffsetX-20,e.y-=t.anchorOffsetY+5):(e.x+=t.anchorOffsetX-20,e.y-=t.anchorOffsetY-0),e},e.prototype.getComBtnRDPoint=function(t){return new egret.Point(t.x+t.anchorOffsetX-28,t.y-t.anchorOffsetY+8)},e.prototype.addBtnRedDot=function(t,e){var i=GmGlobal.mc.muiMgr.getRedDot(t);if(i&&(i.bindChangeCB(this.onRedDotChange,this),1==i.state)){var s=this.getIconRDPoint(e);RedDotView.addRedDot(e,this.redDotCon,"mui",s.x,s.y,"com_json.com_rdd")}},e.prototype.onRedDotChange=function(t){var e=GmGlobal.mc.muiMgr.getModelIdByRedDot(t);if(-1!=e){var i=this.getBtnById(e);if(i)if(1==t.state){var s=this.getIconRDPoint(i),o=RedDotView.addRedDot(i,this.redDotCon,"mui",s.x,s.y,"com_json.com_rdd");o&&(i.parent&&!i.parent.visible||!i.visible)&&(o.visible=!1)}else RedDotView.removeRedDot(i)}},e.prototype.clearRedDots=function(){var t=GmGlobal.mc.muiMgr.getRedDots();for(var e in t){var i=t[e];i&&i.unbindChangeCB(this.onRedDotChange,this)}RedDotView.removeRedDotByGroup("mui")},e.prototype.onStateTouchEnd=function(t){null!=this._touchBtn&&(this._touchBtn.scaleX=1,this._touchBtn.scaleY=1,this._touchBtn=null)},e.prototype.onTouchBegin=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),-1!=this._touchScaleBtns.indexOf(t.target)&&(t.target.scaleX=1.1,t.target.scaleY=1.1,this._touchBtn=t.target)},e.prototype.onTouchEnd=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),-1!=this._touchScaleBtns.indexOf(t.target)&&(t.target.scaleX=1,t.target.scaleY=1)},e.prototype.onTouchTap=function(t){var e=GmGlobal.mc,i=this.getIdByBtn(t.target);if(-1!=i)e.guideMgr.isModeuleOpen(i,!0)&&(this.doIconCmd(i),GmGlobal.vmc.mGuide.triggerTarget(t.target)),GmGlobal.sound.playSoundEffect("ui_zhuye");else if(t.target==this.msgBg)CmdBus.doCmd(CmdType.O_CHAT,e.chatMgr.currenCh),this.gDown.visible=!1;else if(t.target==this.bWorld)e.chatMgr.currenCh=ChatChannel.WORLD,this.updateChatChSel(),this.updateChatMsg();else if(t.target==this.bKuafu)e.chatMgr.currenCh=ChatChannel.KUAFU,this.updateChatChSel(),this.updateChatMsg();else if(t.target==this.icon)CmdBus.doCmd(CmdType.O_SET);else if(t.target==this.bAddZs)CmdBus.doCmd(CmdType.O_SHOP),GmGlobal.sound.playSoundEffect("ui_huobi");else if(t.target==this.bTransfer)GmGlobal.sound.playSoundEffect("ui_zhuye"),this.onTransferBtn();else if(t.target==this.bZhuabu){var s=e.itemMgr.getItemNum(ItemID.JIAZI);if(0==s){var o=e.shopMgr.getKapulaItemCfg(ItemID.JIAZI);if(o){var n=ItemSellView.getInstance();n.setItem(o.item.id,o.cost.num,o.cost.id),n.show(GmGlobal.vmc.uiLayer)}}else CmdBus.doCmd(CmdType.DO_ZHUABU),GmGlobal.vmc.mGuide.hasGuide(GuideID.PET_ZB)&&GmGlobal.vmc.mGuide.clearGuide()}else if(t.target==this.bAddJs)ItemLackTips.instance().shuijTips(),GmGlobal.sound.playSoundEffect("ui_huobi");else if(t.target==this.bAddJb)ItemLackTips.instance().ybTips(),GmGlobal.sound.playSoundEffect("ui_huobi");else if(t.target==this.plzTxt)e.muiMgr.plCfg&&CmdBus.doCmd(CmdType.O_RULE,e.muiMgr.plCfg.rule);else if(t.target==this.spIcon){var o=e.shopMgr.getKapulaItemCfg(ItemID.YP_ITEM_3);if(o){var n=ItemSellView.getInstance();n.setItem(o.item.id,o.cost.num,o.cost.id),n.show(GmGlobal.vmc.uiLayer)}}else if(t.target==this.hpIcon){var o=e.shopMgr.getKapulaItemCfg(ItemID.YP_ITEM_1);if(o){var n=ItemSellView.getInstance();n.setItem(o.item.id,o.cost.num,o.cost.id),n.show(GmGlobal.vmc.uiLayer)}}else t.target==this.bAi&&(e.sceneMgr.isAutoAI=!e.sceneMgr.isAutoAI,this.updateAutoBtn())},e.prototype.updateAutoBtn=function(t){void 0===t&&(t=0);var e=GmGlobal.mc,i=FubenType.isPvpFuben(t);e.guideMgr.hasTask()||i?this.bAi.visible=!1:(this.bAi.visible=!0,this.bAi.source=e.sceneMgr.isAutoAI?"mui_json.m_zd":"mui_json.m_sd"),this.bZhuabu.visible?this.bAi.y=-186:this.bAi.y=this.bZhuabu.y},e.prototype.onTransferBtn=function(){var t=GmGlobal.mc.sceneMgr;if(t.mapType==SceneType.CITY)CmdBus.doCmd(CmdType.O_MAPSEL);else if(t.mapType==SceneType.WILD)GmGlobal.cc.sceneCtl.reqExitScene();else{var e=FubenType.isHdEnd(t.mapId);if(e)GmGlobal.cc.sceneCtl.reqExitScene();else{var i=FubenType.getFubenExitTip(t.mapId);i?MsgBox.confirm(i,this.onDoTransfer,null,this):GmGlobal.cc.sceneCtl.reqExitScene()}}GmGlobal.vmc.mGuide.triggerTarget(this.bTransfer)},e.prototype.onDoTransfer=function(){var t=GmGlobal.mc.sceneMgr;this._preMapId=t.mapId,GmGlobal.cc.sceneCtl.reqExitScene(this.onDoTransOk,this)},e.prototype.onDoTransOk=function(t,e){CmdBus.doCmd(CmdType.DO_EXIT_FB,this._preMapId)},e.prototype.onChatClose=function(){this.gDown.visible=!0},e.prototype.doIconCmd=function(t){var e=GmGlobal.mc.muiMgr.getCmdData(t);e&&(e.data?CmdBus.doCmd(e.cmd,e.data):CmdBus.doCmd(e.cmd))},e.prototype.updateCurrency=function(){var t=GmGlobal.mc.itemMgr,e=t.getItemNum(ItemID.DIAMOND);e>=1e9?this.zsTxt.text=Utils.formatNum(e):this.zsTxt.text=e.toString();var i=t.getItemNum(ItemID.SHUIJING);i>=1e9?this.jsTxt.text=Utils.formatNum(i):this.jsTxt.text=i.toString();var s=t.getItemNum(ItemID.GOLD);s>=1e12?this.jbTxt.text=Utils.formatNum(s):this.jbTxt.text=s.toString()},e.prototype.updateRoleInfo=function(){var t=GmGlobal.mc.role;this.lv.text="LV."+t.lv,this.nameTxt.text=t.name,this.nameTxt.x=Math.max(this.icon.x+this.icon.width/2-this.nameTxt.width/2,4),this.expBar.maximum=t.expMax,this.expBar.value=t.exp,this.expP.text=Math.floor(t.exp/t.expMax*100)+"%",this.updateHeroIcon(),this.updateTxk()},e.prototype.updateRoleData=function(){this._zlNumber||(this._zlNumber=BitmapNumber.create(),this._zlNumber.x=this.zlTxt.x+this.zlTxt.width+4,this._zlNumber.y=this.zlTxt.y+2,this.gTop.addChild(this._zlNumber));var t=GmGlobal.mc;this._zlNumber.setNumber(t.heroMgr.getAtrValue("z"),"mui_json.mui_zl_",0),this.hpBar.maximum=t.heroMgr.getAtrValue("hm"),this.spBar.maximum=t.heroMgr.getAtrValue("mm"),this.hpBar.value=t.role.hp,this.spBar.value=t.role.sp},e.prototype.updatePlz=function(){this._plzNumber||(this._plzNumber=BitmapNumber.create(),this._plzNumber.x=this.plzTxt.x+this.plzTxt.width+4,this._plzNumber.y=this.plzTxt.y+2,this.gTop.addChild(this._plzNumber));var t=GmGlobal.mc.dataMgr.getJData(JsonID.PILAO),e=t.data?t.data.fv||0:0;GmGlobal.mc.role.plV=e,this._plzNumber.setNumber(e,"mui_json.mui_zl_",0)},e.prototype.updateRoleHp=function(){var t=GmGlobal.mc.role;this.hpBar.value=t.hp},e.prototype.updateRoleSp=function(){var t=GmGlobal.mc.role;this.spBar.value=t.sp},e.prototype.updateHeroIcon=function(){var t=GmGlobal.mc,e=t.loginMgr.headurl;if(e)if(-1!=e.indexOf("http"))this.icon.source=e;else{var i=this;egret.BitmapData.create("base64",e,function(t){var e=new egret.Texture;e.bitmapData=t,i.icon.source=e})}else this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+t.role.careerId+".png"},e.prototype.updateTxk=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.TXK).data,i=e.head||0,s=t.setMgr.getXkCfg(i);s?(this.txk.source="txk_json."+s.icon,this.gTop.getChildIndex(this.txk)<this.gTop.getChildIndex(this.icon)&&this.gTop.setChildIndex(this.txk,this.gTop.getChildIndex(this.icon))):(this.txk.source="txk_json.txk",this.gTop.getChildIndex(this.txk)>this.gTop.getChildIndex(this.icon)&&this.gTop.setChildIndex(this.txk,this.gTop.getChildIndex(this.icon)-1))},e.prototype.updateHpState=function(){if(GmGlobal.mc.role.lv<50)this.hpIcon.visible=!1,this.hpNum.visible=!1;else{var t=GmGlobal.mc.itemMgr,e=t.getItemNum(10007);10>=e?(this.hpIcon.visible=!0,this.hpNum.visible=!0,this.hpNum.text=e.toString(),this.hpIcon.source=t.getItemIcon(10007),this._isHpWarning||(this._isHpWarning=!0,egret.Tween.get(this.hpIcon,{loop:!0}).to({alpha:.3},1e3).to({alpha:1},1e3))):(this.hpIcon.visible=!1,this.hpNum.visible=!1,this._isHpWarning&&(this._isHpWarning=!1,this.clearHpIconEffect()))}},e.prototype.clearHpIconEffect=function(){egret.Tween.removeTweens(this.hpIcon),this.hpIcon.alpha=1},e.prototype.updateSpState=function(){if(GmGlobal.mc.role.lv<50)this.spIcon.visible=!1,this.spNum.visible=!1;else{var t=GmGlobal.mc.itemMgr,e=t.getItemNum(10009);10>=e?(this.spIcon.visible=!0,this.spNum.visible=!0,this.spNum.text=e.toString(),this.spIcon.source=t.getItemIcon(10009),this._isSpWarning||(this._isSpWarning=!0,egret.Tween.get(this.spIcon,{loop:!0}).to({alpha:.3},1e3).to({alpha:1},1e3))):(this.spIcon.visible=!1,this.spNum.visible=!1,this._isSpWarning&&(this._isSpWarning=!1,this.clearSpIconEffect()))}},e.prototype.clearSpIconEffect=function(){egret.Tween.removeTweens(this.spIcon),this.spIcon.alpha=1},e.prototype.onOpenKpl=function(){TaskGo.getInstance().start(6704,CmdType.O_KAPULA)},e.prototype.onEnterScene=function(){this.updatePos();var t=GmGlobal.mc.sceneMgr;t.mapType==SceneType.FUBEN?(this.freeBtnCon.visible=!1,this.freeBtnCon2.visible=!1,this.miniBtnCon.visible=!1):(this.freeBtnCon.visible=!0,this.freeBtnCon2.visible=!0,this.miniBtnCon.visible=!0),this.updateAllRedDotState(),this.updateAllEffectState(),t.mapType==SceneType.CITY?this.bTransfer.label="Battle":t.mapType==SceneType.WILD?this.bTransfer.label="TP":this.bTransfer.label="Leave"},e.prototype.showFreeBtn=function(){var t=GmGlobal.mc.sceneMgr;t.mapType!=SceneType.FUBEN&&(egret.Tween.removeTweens(this.freeBtnCon),egret.Tween.removeTweens(this.freeBtnCon2),this.freeBtnCon.visible=!0,this.freeBtnCon2.visible=!0,this.miniBtnCon.visible=!0,egret.Tween.get(this.freeBtnCon).to({alpha:1},200).call(this.onShowFreeEnd,this),egret.Tween.get(this.freeBtnCon2).to({alpha:1},200))},e.prototype.onShowFreeEnd=function(){this.updateAllRedDotState(),this.updateAllEffectState()},e.prototype.hideFreeBtn=function(){var t=GmGlobal.mc.sceneMgr;t.mapType!=SceneType.FUBEN&&(egret.Tween.removeTweens(this.freeBtnCon),egret.Tween.removeTweens(this.freeBtnCon2),this.onHideFreeEnd())},e.prototype.onHideFreeEnd=function(){this.freeBtnCon.visible=!1,this.freeBtnCon2.visible=!1,this.miniBtnCon.visible=!1,this.updateAllRedDotState(),this.updateAllEffectState()},e.prototype.updateAllRedDotState=function(){for(var t=0,e=this._iconIds;t<e.length;t++){var i=e[t],s=RedDotView.getRedDot(i.btn);if(s){var o=i.btn.parent;o&&o.visible?s.visible=!0:s.visible=!1}}},e.prototype.setCountDownTime=function(t,e){if(0!=e){var i=this.getCountDownText(t);if(i)return void i.cd.setTime(e);i=new MainUICdText(t,new GameTime(e),this.createCDTimeTxt()),this._cdTexts.push(i),this.checkCDText(t)}},e.prototype.checkCDText=function(t){var e=this.getBtnById(t);if(e&&0!=e.visible){var i=this.getCountDownText(t);i&&(i.lable.x=e.parent.x+e.x-i.lable.width/2,i.lable.y=e.parent.y+e.y+e.anchorOffsetY,i.update(),i.lable.parent||this.addChild(i.lable),this.startCDTime())}},e.prototype.updateCDPos=function(){for(var t=0,e=this._cdTexts;t<e.length;t++){var i=e[t],s=this.getBtnById(i.modelId);s&&s.parent&&(i.lable.x=s.parent.x+s.x-i.lable.width/2,i.lable.y=s.parent.y+s.y+s.anchorOffsetY)}},e.prototype.hideCDText=function(){for(var t=0,e=this._cdTexts;t<e.length;t++){var i=e[t];i.lable.parent&&(i.lable.visible=!1)}},e.prototype.showCDText=function(){for(var t=0,e=this._cdTexts;t<e.length;t++){var i=e[t];i.lable.parent&&(i.lable.visible=!0)}},e.prototype.getCountDownText=function(t){for(var e=0,i=this._cdTexts;e<i.length;e++){var s=i[e];if(s.modelId==t)return s}return null},e.prototype.getCountDownTextIndex=function(t){for(var e=0;e<this._cdTexts.length;e++)if(this._cdTexts[e].modelId==t)return e;return-1},e.prototype.createCDTimeTxt=function(){var t=new eui.Label;return t.textColor=16777215,t.size=20,t.width=110,t.textAlign=egret.HorizontalAlign.CENTER,t.stroke=2,t.strokeColor=0,t},e.prototype.clearCountDownTime=function(t){var e=this.getCountDownTextIndex(t);if(e>=0){var i=this._cdTexts[e];i.lable.parent&&this.removeChild(i.lable),this._cdTexts.splice(e,1)}0==this._cdTexts.length&&this.stopCDTime()},e.prototype.startCDTime=function(){0==this._cdTimer&&(this._cdTimer=egret.setInterval(this.onTime,this,1e3))},e.prototype.stopCDTime=function(){0!=this._cdTimer&&(egret.clearInterval(this._cdTimer),this._cdTimer=0)},e.prototype.onTime=function(){for(var t=0;t<this._cdTexts.length;t++){var e=this._cdTexts[t];e.update()&&(e.lable.parent&&this.removeChild(e.lable),this._cdTexts.splice(t,1),t--)}0==this._cdTexts.length&&this.stopCDTime()},e.prototype.initBuffIcons=function(){var t=GmGlobal.mc.sceneMgr.buffIcons;if(t)for(var e in t)this.addBuffIcon(Number(e))},e.prototype.onBuffClear=function(){if(this._buffIcons)for(this._buffIcons=null;this.buffCon.numChildren;)this.buffCon.removeChildAt(0)},e.prototype.onBuffIconUpd=function(t){var e=t.data;this.addBuffIcon(e)},e.prototype.onBuffIconRm=function(t){var e=t.data;this.rmBuffIcon(e)},e.prototype.addBuffIcon=function(t){this._buffIcons||(this._buffIcons={});var e=this._buffIcons[t];e||(this._buffIcons[t]=e=new eui.Image(GmGlobal.mc.itemMgr.getItemBuffIcon(t)),this.buffCon.addChild(e)),-1==this._buffTimer&&(this._buffTimer=egret.setInterval(this.onBuffTime,this,1e3))},e.prototype.rmBuffIcon=function(t){var e=GmGlobal.mc.sceneMgr.buffIcons;delete e[t];var i=this._buffIcons[t];i&&(i&&i.parent&&i.parent.removeChild(i),delete this._buffIcons[t])},e.prototype.onBuffTime=function(){var t=GmGlobal.mc.sceneMgr.buffIcons,e=0;for(var i in t){var s=t[i],o=this._buffIcons[i],n=s.cd;0==n?(delete t[i],o&&o.parent&&o.parent.removeChild(o),delete this._buffIcons[i]):(o&&5>n&&(o.alpha=n%2==0?.7:1),e++)}0==e&&-1!=this._buffTimer&&this.stopBuffTimer()},e.prototype.stopBuffTimer=function(){-1!=this._buffTimer&&(egret.clearInterval(this._buffTimer),this._buffTimer=-1)},e.prototype.onUpdateChatMsg=function(t){var e=t.data;(e.ch==ChatChannel.KUAFU||e.ch==ChatChannel.WORLD)&&this.updateChatMsg()},e.prototype.onChatMsgInit=function(t){t.data==GmGlobal.mc.chatMgr.currenCh&&this.updateChatMsg()},e.prototype.getMsgChTxt=function(t){switch(t){case ChatChannel.KUAFU:return"【World】";case GmGlobal.mc.chatMgr.MY_GH_CH:return"【Guild】";case ChatChannel.SYS:return"【System】";default:return"【System】"}},e.prototype.getMsgChColor=function(t){switch(t){case ChatChannel.WORLD:return 16777215;case ChatChannel.KUAFU:return 16777215;case ChatChannel.SYS:return 16279074;default:return 16777215}},e.prototype.updateChatChSel=function(){var t=GmGlobal.mc.chatMgr.currenCh;this.bWorld.alpha=.7,this.bKuafu.alpha=.7,t==ChatChannel.WORLD?this.bWorld.alpha=1:t==ChatChannel.KUAFU&&(this.bKuafu.alpha=1)},e.prototype.updateChatMsg=function(){var t=GmGlobal.mc.chatMgr.getChatMsg(GmGlobal.mc.chatMgr.currenCh);if(t){for(var e=!1,i=t.length,s=i>=6?i-6:0,o=[],n=i-1;n>=s;n--){var r=t[n];if(r.ch==ChatChannel.SYS){o.push({text:"System Msg: ",style:{textColor:this.getMsgChColor(r.ch)}});var h=TextFormat.setColor(r.content,this.getMsgChColor(r.ch));o=o.concat(TextFormat.parser.parse(h)),o.push({text:"\n"})}else if(r.ex&&r.ex.ts)o.push({text:"Tips: ",style:{textColor:1501417}}),o=o.concat(TextFormat.parser.parse(TextFormat.setColor(r.content,1501417))),o.push({text:"\n"});else if(r.ex&&r.ex.bcq)o.push({text:r.name,style:{textColor:Colors.RED}}),o.push({text:" is escorting his ",style:{textColor:1501417}}),o.push({text:GmGlobal.mc.wfMgr.getBcName(r.ex.bcq),style:{textColor:GmGlobal.mc.wfMgr.getBcQColor(r.ex.bcq)}}),o.push({text:" on the way.",style:{textColor:1501417}}),o.push({text:"I'll join",style:{textColor:Colors.GREEN,underline:!0}},{text:"\n"});else{var a=r.name;r.ch!=ChatChannel.KUAFU&&r.ch!=GmGlobal.mc.chatMgr.MY_GH_CH||!r.ex.s||2==PFConst.SERVER_TYPE&&(a="s"+r.ex.s+" "+a),o.push({text:a,style:{textColor:15311934}}),o.push({text:": "});var l=GmGlobal.mc.itemMgr.getItemCfg(r.ex.i);if(l){var c=Utils.getQualityColor(l.quality),d=r.ex.i;r.ex.uid&&(d+="_"+r.ex.uid+"_"+r.roleId),o.push({text:l.name,style:{href:"event:"+d,underline:!0,textColor:c}},{text:"\n"}),e=!0}else if(r.ex.jxteam||r.ex.mkteam||r.ex.sxteam)o.push({text:"invites you to a ",style:{textColor:this.getMsgChColor(r.ch)}}),r.ex.mkteam?o.push({text:"Den Adventure ",style:{textColor:Colors.RED}}):r.ex.jxteam?o.push({text:"Mech Factory ",style:{textColor:Colors.RED}}):r.ex.sxteam&&o.push({text:"Statue Defense ",style:{textColor:Colors.RED}}),o.push({text:"raid. ",style:{textColor:this.getMsgChColor(r.ch)}}),o.push({text:"Apply to join",style:{textColor:Colors.GREEN,underline:!0}},{text:"\n"});else if(r.ex.tradeId)o.push({text:"Shop Open，Welcome to my shop  ",style:{textColor:this.getMsgChColor(r.ch)}}),o.push({text:"Enter Shop",style:{href:"event:"+r.ex.tradeId,underline:!0,textColor:Colors.GREEN}},{text:"\n"});else{var p=null;p=r.ex&&r.ex.face?GmGlobal.mc.chatMgr.faceResToName[r.ex.face]:r.content,o.push({text:p,style:{textColor:this.getMsgChColor(r.ch)}},{text:"\n"})}}}this.chatMsg.textFlow=o,e?this.chatMsg.addEventListener(egret.TextEvent.LINK,this.onTouchText,this):this.chatMsg.removeEventListener(egret.TextEvent.LINK,this.onTouchText,this)}else this.chatMsg.text=""},e.prototype.onTouchText=function(t){var e=t.text.split("_"),i=Number(e[0]);if(GmGlobal.mc.itemMgr.getItemCfg(i)){var s=this.gDown.localToGlobal(this.chatMsg.x+this.chatMsg.textWidth,this.chatMsg.y);1==e.length?ItemTips.show(i,s.x,s.y,0,GmGlobal.vmc.uiLayer2):EquipTips.show(Number(e[1]),s.x,s.y,0,GmGlobal.vmc.uiLayer2,Number(e[2]))}},e.prototype.onTriggerGuide=function(t){var e=t.data,i=GmGlobal.vmc.mGuide,s=GmGlobal.mc.sceneMgr;if(e==GuideID.KILL_MONSTER)s.mapType==SceneType.CITY?i.bindTarget(GuideTargetId.MAINUI_TBTN,this.bTransfer,this.transGuidePoint(this.bTransfer)):i.clearGuide();else if(e==GuideID.KILL_MONSTER2){var o=GmGlobal.mc.guideMgr,n=o.getGuideTask();n.idx||i.clearGuide();var r=o.getTaskListInfo(n.idx);r||i.clearGuide(),s.mapType==SceneType.WILD?s.mapId==r.mapid?(i.skipStep(),i.skipStep(),i.skipStep()):(i.bindTarget(GuideTargetId.MAINUI_HCBTN,this.bTransfer,this.transGuidePoint(this.bTransfer)),i.bindTarget(GuideTargetId.MAINUI_TBTN,this.bTransfer,this.transGuidePoint(this.bTransfer))):GmGlobal.mc.sceneMgr.mapType==SceneType.CITY&&(i.skipStep(),i.bindTarget(GuideTargetId.MAINUI_TBTN,this.bTransfer,this.transGuidePoint(this.bTransfer)))}else e==GuideID.PET_ZB?(s.mapType==SceneType.CITY?i.bindTarget(GuideTargetId.MAINUI_TBTN,this.bTransfer,this.transGuidePoint(this.bTransfer)):(i.skipStep(),i.skipStep()),i.bindTarget(GuideTargetId.PET_ZB_BTN,this.bZhuabu,this.transGuidePoint(this.bZhuabu))):e==GuideID.EQUIPE_DRESS||e==GuideID.CARD_XQ||e==GuideID.ATTR_ADD?i.bindTarget(GuideTargetId.MAINUI_ICON,this.bHero,this.transGuidePoint(this.bHero)):e==GuideID.SKILL_DRESS||e==GuideID.SKILL_LEARN?i.bindTarget(GuideTargetId.MAINUI_ICON,this.bSkill,this.transGuidePoint(this.bSkill)):e==GuideID.EQUIPE_STRONG||e==GuideID.KQL_GM||e==GuideID.EQUIPE_JL||e==GuideID.TOUSHI_ZZ||e==GuideID.JOIN_GH||e==GuideID.EQUIPE_DZ||e==GuideID.JIAOYI?s.mapType==SceneType.CITY?i.skipStep():s.mapType==SceneType.WILD&&i.bindTarget(GuideTargetId.MAINUI_HCBTN,this.bTransfer,this.transGuidePoint(this.bTransfer)):e==GuideID.EQUIP_HC||e==GuideID.EQUIP_FENJIE?i.bindTarget(GuideTargetId.MAINUI_ICON,this.bBag,this.transGuidePoint(this.bBag)):e==GuideID.NIUDIANJI?this.checkGuideShow(i,this.bFl)&&i.bindTarget(GuideTargetId.MAINUI_ICON,this.bFl,this.transGuidePoint(this.bFl)):e==GuideID.MVP?this.checkGuideShow(i,this.bMvp)&&i.bindTarget(GuideTargetId.MAINUI_ICON,this.bMvp,this.transGuidePoint(this.bMvp)):e==GuideID.ARENA||e==GuideID.ARENA2||e==GuideID.TOWER?this.checkGuideShow(i,this.bWf)&&i.bindTarget(GuideTargetId.MAINUI_ICON,this.bWf,this.transGuidePoint(this.bWf)):e==GuideID.XZ_SJ?i.bindTarget(GuideTargetId.MAINUI_ICON,this.bXz,this.transGuidePoint(this.bXz)):e==GuideID.GTASK?i.bindTarget(GuideTargetId.MAINUI_ICON,this.bCz,this.transGuidePoint(this.bCz)):e==GuideID.OPEN_VIP?i.bindTarget(GuideTargetId.MAINUI_ICON,this.bVip,this.transGuidePoint(this.bVip)):e==GuideID.OPEN_VIP1&&i.bindTarget(GuideTargetId.MAINUI_ICON,this.bVip1,this.transGuidePoint(this.bVip1))},e.prototype.checkGuideShow=function(t,e){return e.parent&&e.parent.visible?!0:(t.clearGuide(),!1)},e.prototype.bindHcBtnGuide=function(){var t=GmGlobal.vmc.mGuide;t.bindTarget(GuideTargetId.MAINUI_HCBTN,this.bTransfer,this.transGuidePoint(this.bTransfer))},e.prototype.transGuidePoint=function(t){return t.parent.localToGlobal(t.x,t.y)},e.prototype.onGuideFinish=function(t){},e.prototype.close=function(){this.clearRedDots(),this.clearEffects(),this.stopCDTime(),this.stopBuffTimer(),this._isHpWarning&&(this.clearHpIconEffect(),this._isHpWarning=!1),this._isSpWarning&&(this.clearSpIconEffect(),this._isSpWarning=!1),0!=this._sTimer&&(egret.clearInterval(this._sTimer),this._sTimer=0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("mui_json"),RES.destroyRes("mui_bg_jpg")},e}(UIBase);__reflect(MainUIView.prototype,"MainUIView");var QuickDressItem=function(){function t(){}return t}();__reflect(QuickDressItem.prototype,"QuickDressItem");var QuickDressView=function(t){function e(){return t.call(this,"QuickDressSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDress,this),this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.rmEvts=function(){this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDress,this),this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.checkNext=function(){if(0==this._items.length)return void this.close();var t=this._items.shift();this.checkBetter(t)?this.setItem(t):this.checkNext()},e.prototype.setItem=function(t){this._cItem=t,this._itemGrid||(this._itemGrid=new ItemGrid,this._itemGrid.init(0,0,0,100,!1),this._itemGrid.addToParent(this.itemCon,this.itemCon),this._itemGrid.x=0,this._itemGrid.y=0),this._itemGrid.setItem(t.itemId,0)},e.prototype.checkBetter=function(t){return!1},e.prototype.onDress=function(){this.checkBetter(this._cItem),this._itemPool.push(this._cItem),this._cItem=null,this.checkNext()},e}(UIBase);__reflect(QuickDressView.prototype,"QuickDressView");var ShowcTip=function(t){function e(){return t.call(this,"ShowcTipSkin")||this}return __extends(e,t),e.getInstance=function(){return this._instace||(this._instace=new e),this._instace},e.release=function(){this._instace&&(this._instace.close(),this._instace=null)},e.prototype.updatePos=function(){this.x=GmGlobal.stageWidth-this.width-4,GmConst.IS_FULLSCENE?this.y=GmConst.TOP_SPACE+350:this.y=350},e.prototype.start=function(){GmGlobal.mc.role.lv<30?EventBus.addListener(EventType.M_R_UPD,this.onRoleUpd,this):this.delayShow()},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this)},e.prototype.onRoleUpd=function(){GmGlobal.mc.role.lv>=30&&(EventBus.rmListener(EventType.M_R_UPD,this.onRoleUpd,this),this.delayShow())},e.prototype.delayShow=function(){egret.setTimeout(this.onDelayShow,this,1e3)},e.prototype.onDelayShow=function(){var t=GmGlobal.mc.flMgr.lcNum||0;6>t?this.show(GmGlobal.vmc.uiLayer):e.release()},e.prototype.onPay=function(){CmdBus.doCmd(CmdType.O_FIRSTPAY),e.release()},e}(UIBase);__reflect(ShowcTip.prototype,"ShowcTip");var ZhanliAddTips=function(t){function e(){var e=t.call(this,"ZhanliUpSkin")||this;return e.touchEnabled=!1,e.touchChildren=!1,e.cZl=new BitmapNumber,e._zlObj={zl:0},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.cZl=new BitmapNumber;var e=this.tZl.width||110;this.cZl.x=this.tZl.x+e+5,this.cZl.y=this.tZl.y+7,this.addChildAt(this.cZl,1),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.updatePos=function(){this.x=GmGlobal.stageWidth/2,this.y=GmGlobal.stageHeight/2},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.updateZl=function(t,e){egret.Tween.removeTweens(this),egret.Tween.removeTweens(this._zlObj),this._zl=t,this._zlObj.zl=e,this.cZl.setNumber(e,"mui_json.zl_"),this.upImg.x=this.cZl.x+this.cZl.width+20;var i=this.upImg.width||44;this.addNum.x=this.upImg.x+i+2,this.addNum.text=String(t-e),egret.Tween.get(this).to({alpha:1,scaleX:1,scaleY:1},100).call(this.onShowEnd,this)},e.prototype.onShowEnd=function(){egret.Tween.get(this._zlObj,{loop:!1,onChange:this.onUping,onChangeObj:this}).to({zl:this._zl},800,egret.Ease.cubicOut).wait(500).call(this.onUpEnd,this)},e.prototype.onUping=function(){this.cZl.setNumber(Math.floor(this._zlObj.zl),"mui_json.zl_"),this.upImg.x=this.cZl.x+this.cZl.width+20,this.addNum.x=this.upImg.x+this.upImg.width+2},e.prototype.onUpEnd=function(){egret.Tween.get(this).to({alpha:0,scaleX:0,scaleY:0},200).call(this.hideEnd,this)},e.prototype.hideEnd=function(){this.close()},e}(UIBase);__reflect(ZhanliAddTips.prototype,"ZhanliAddTips");var MvpController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_MVP_NUM,this.onUpdJlNum,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_MVP_NUM_ONE,this.onUpdJlNumOne,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_MVP_LST,this.onUpdLst,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.MVP_ALIVE,this.onAlive,this)}return t.prototype.onUpdJlNum=function(t){var e=t.data.data,i=GmGlobal.mc.mvpMgr;i.cnts=[];for(var s in e)i.cnts[Number(s)-1]=e[s];this.updateRedDot(),EventBus.dispatchEvt(EventType.M_MVP_NUMS)},t.prototype.onUpdJlNumOne=function(t){var e=t.data.data,i=GmGlobal.mc.mvpMgr,s=-1;for(var o in e)s=Number(o)-1,i.cnts[s]=e[o];this.updateRedDot(),EventBus.dispatchEvt(EventType.M_MVP_NUM,s)},t.prototype.onUpdLst=function(t){var e=t.data.data,i=GmGlobal.mc.mvpMgr;i.bossLst=[];for(var s in e)i.bossLst[Number(s)-1]=e[s];
EventBus.dispatchEvt(EventType.M_MVP_LST)},t.prototype.updateRedDot=function(){var t=GmGlobal.mc.mvpMgr,e=t.redDot;e.state=0;for(var i in t.cnts){var s=t.cnts[i];for(var o in s){var n=s[i];if(n>0&&Number(i)<5){e.state=1;break}}}},t.prototype.onAlive=function(t){var e=t.alive,i=t.id,s=t.lid;if(e){var o=GmGlobal.mc.mvpMgr.bossCfgs[i];if(o&&GmGlobal.mc.role.lv>=o.lv){var n=GmGlobal.mc.sceneMgr;n.mapType!=SceneType.FUBEN&&(CmdBus.doCmd(CmdType.O_MVP_JOIN,i,s),GmGlobal.mc.mvpMgr.aliveId=i);var r=GmGlobal.mc.npcMgr.getNpcCfg(i),h=GmGlobal.mc.txtMgr.getRetCode(527,[o.lv,r.name]);h&&Horselamp.showHText(h)}}else i&&i==GmGlobal.mc.mvpMgr.aliveId&&CmdBus.doCmd(CmdType.C_MVP_JOIN)},t}();__reflect(MvpController.prototype,"MvpController");var MvpItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getBtn=function(){return this.btz},e.prototype.dataChanged=function(){var t=this.data.cfg;this.index=this.data.index;var e=GmGlobal.mc.npcMgr.getNpcCfg(t.id);this.tname.text=e.name,this.tlv.text="LV."+t.lv,this.icon.source=GmConst.MODEL_ICON_DIR+e.res+".png",this.ixz.visible=this.data.ixz;var i=this.data.cd;GmGlobal.mc.role.lv<this.data.cfg.lv?(this.msBg.source="com_json.bg_eqp2",this.tms.text="Disabled",Utils.setBtnEnable(this.btz,!1),this.tcd.visible=!1,this.tms.y=79,this.msBg.y=72):i.cd>0?(CDText.getInstence().addCD(this.tcd,i.cd,"","h:m:s","",this.onCdTimeOut,this),this.msBg.source="com_json.bg_eqp2",this.tms.text="Unfound",Utils.setBtnEnable(this.btz,!0),this.tcd.visible=!0,this.tms.y=70,this.msBg.y=63):(this.rmCd(),this.msBg.source="com_json.bg_eqp1",this.tms.text="Spawned",Utils.setBtnEnable(this.btz,!0),this.tcd.visible=!1,this.tms.y=79,this.msBg.y=72);for(var s=GmGlobal.mc.mvpMgr.cnts[this.index-1],o=0;4>o;o++){var n=(this["txt"+o],this["num"+o]),r=s[o+1]||0;n.text=r+" Times"}},e.prototype.onCdTimeOut=function(){this.data.cd.cd<=0&&GmGlobal.mc.role.lv>=this.data.cfg.lv?(this.msBg.source="com_json.bg_eqp1",this.tms.text="Spawned",Utils.setBtnEnable(this.btz,!0),this.tcd.visible=!1,this.tms.y=79,this.msBg.y=72,this.rmCd()):(this.msBg.source="com_json.bg_eqp2",this.tms.text="Unfound",Utils.setBtnEnable(this.btz,!1),this.tcd.visible=!0,this.tms.y=70,this.msBg.y=63)},e.prototype.rmCd=function(){CDText.getInstence().rmCD(this.tcd)},e}(eui.ItemRenderer);__reflect(MvpItem.prototype,"MvpItem");var MvpJlItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.rdata;this.trank.text=this.data.idx.toString(),this.tnum.text=t.data.toString();var e=GmGlobal.mc.rankMgr.getRoleData(t.rid);this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+e.career+".png",this.tname.text=e.name},e}(eui.ItemRenderer);__reflect(MvpJlItem.prototype,"MvpJlItem");var Game=function(){function t(t){GmGlobal.root=t,GmGlobal.mc=new ModelCenter,GmGlobal.cc=new ControlsCenter,GmGlobal.vmc=new MediatorCenter,GmGlobal.sound=new SoundManager,GmGlobal.res=new ResManager}return t.prototype.run=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),PFConst.init(),GmGlobal.init(),console.log("VF_VERSION:"+GmGlobal.VF_VERSION),console.log("RES_VERSION:"+GmGlobal.RESCFG_V),this.startInit(),[2]})})},t.prototype.startInit=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return RES.registerVersionController(new GameVersionController),t="resource/default.res.json",GmGlobal.RESCFG_V>1&&(t+="."+GmGlobal.RESCFG_V),[4,RES.loadConfig(t,"resource/")];case 1:return e.sent(),PFConst.SHOW_INIT&&InitView.show(GmGlobal.root),[4,this.loadLocalFileCfg()];case 2:return e.sent(),[4,this.loadVersionCfg()];case 3:e.sent(),e.label=4;case 4:return[3,6];case 5:e.sent(),e.label=6;case 6:return this.initGame(),[2]}})})},t.prototype.onActivate=function(){GmGlobal.GAME_HIDDEN=!1,this.bgStateChange()},t.prototype.onDeActivate=function(){GmGlobal.GAME_HIDDEN=!0,this.bgStateChange()},t.prototype.bgStateChange=function(){EventBus.dispatchEvt(EventType.HIDDE_CHANGE),GmGlobal.GAME_HIDDEN?(GmGlobal.sound.stop(),"iOS"==egret.Capabilities.os&&(GmGlobal.root.stage.frameRate=1e-7)):(GmGlobal.sound.start(),"iOS"==egret.Capabilities.os&&(GmGlobal.root.stage.frameRate=60))},t.prototype.adjustSize=function(t,e){GmGlobal.stageWidth=t,GmGlobal.stageHeight=e,e>1470?GmConst.IS_FULLSCENE=!0:GmConst.IS_FULLSCENE=!1},t.prototype.onResize=function(t){this.adjustSize(GmGlobal.root.stage.stageWidth,GmGlobal.root.stage.stageHeight),EventBus.dispatchEvt(EventType.RESIZE)},t.prototype.loadLocalFileCfg=function(){var t=this;return new Promise(function(e,i){RES.getResByUrl("resource/localcfg.json",function(t){GmGlobal.res.initLocalConfig(t),console.log("localcfg init"),e()},t,RES.ResourceItem.TYPE_JSON)})},t.prototype.loadVersionCfg=function(){var t=this;return new Promise(function(e,i){var s="version"+GmGlobal.VF_VERSION+".json",o=GmGlobal.res.getUrl(s);console.log(o),RES.getResByUrl(o,function(t){GmGlobal.res.initVersionConfig(t),console.log("version init"),e()},t,RES.ResourceItem.TYPE_JSON)})},t.prototype.loadThemeCfg=function(){var t=this;return new Promise(function(e,i){var s=new eui.Theme("resource/default.thm.json",GmGlobal.root.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){console.log("theme init"),e()},t)})},t.prototype.initGame=function(){console.log("run game"),egret.Bitmap.defaultSmoothing=!0,GmGlobal.root.stage.maxTouches=1,egret.TextField.default_wordWrap=!0,GmGlobal.mc.init(),GmGlobal.cc.init(),GmGlobal.vmc.init(),GmGlobal.mc.initSoundState(),this.adjustSize(GmGlobal.root.stage.stageWidth,GmGlobal.root.stage.stageHeight),GmGlobal.vmc.startInitGame(),GmGlobal.root.stage.addEventListener(egret.Event.ACTIVATE,this.onActivate,this),GmGlobal.root.stage.addEventListener(egret.Event.DEACTIVATE,this.onDeActivate,this),GmGlobal.root.stage.addEventListener(egret.Event.RESIZE,this.onResize,this)},t}();__reflect(Game.prototype,"Game");var MvpJoinView=function(t){function e(){var e=t.call(this,"MvpJoinSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){this.x=GmGlobal.stageWidth-this.width,GmConst.IS_FULLSCENE?this.y=GmGlobal.stageHeight-540-this.height-GmConst.BOTTOM_SPACE:this.y=GmGlobal.stageHeight-540-this.height},e.prototype.addEvts=function(){this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.setId=function(t,e){if(t){this._id=t,this._lid=e;var i=this._mc.npcMgr.getNpcCfg(t);this.icon.source=GmConst.MODEL_ICON_DIR+i.res+".png"}},e.prototype.onBtn=function(){this._cc.dataCtl.doAction(ServerActionId.MVP_TZ,[this._lid],this.tzOk,this)},e.prototype.tzOk=function(){var t=GmGlobal.mc.sceneMgr,e=this._mc.mvpMgr.bossCfgs[this._id];t.mapId!=e.mapid?(t.lockType=e.id,t.fx=e.x,t.fy=e.y):GmGlobal.vmc.scene.currenScene.lockUnitType(e.id,e.x,e.y),this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MVP_JOIN)},e}(UIBase);__reflect(MvpJoinView.prototype,"MvpJoinView");var MvpManager=function(){function t(){this.rule="",this.bossLst=[],this.cnts=[],this.aliveId=0,GmGlobal.mc.regUnzipCfg("c_mvp.json",this.initCfg,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.MVP,this.redDot),this.redDot.state=1}return t.prototype.initCfg=function(t){this.rule=t.rule,this.cd=t.cd,this.aprice=t.aprice,this.bossCfgs=t.bossCfgs},t}();__reflect(MvpManager.prototype,"MvpManager");var MvpMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.MVP,CmdType.O_MVP),CmdBus.adListener(CmdType.O_MVP,this.onOpenView,this),CmdBus.adListener(CmdType.C_MVP,this.onCloseView,this),CmdBus.adListener(CmdType.O_MVP_JL,this.onOpenJlView,this),CmdBus.adListener(CmdType.C_MVP_JL,this.onCloseJlView,this),CmdBus.adListener(CmdType.O_MVP_JOIN,this.onOpenTip,this),CmdBus.adListener(CmdType.C_MVP_JOIN,this.onCloseTip,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.MVP){var e=GmGlobal.mc.guideMgr.getGuideTask();if(e){var i=GmGlobal.mc.guideMgr.getTaskListInfo(e.idx);if(i&&i.mapid){var s=GmGlobal.mc.sceneMgr;return s.mapId!=i.mapid?(s.lockType=0,s.fx=i.posx,s.fy=i.posy,GmGlobal.cc.sceneCtl.reqWildScne(i.mapid)):GmGlobal.vmc.scene.currenScene.lockUnitType(0,i.posx,i.posy),void t.clearGuide()}}}this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new MvpView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenJlView=function(t){this._jlview||(this._jlview=new MvpJlView),this._jlview.isShow||(this._jlview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._jlview.setRankType(t)},t.prototype.onCloseJlView=function(){this._jlview&&this._jlview.isShow&&this._jlview.close()},t.prototype.onOpenTip=function(t,e){var i=GmGlobal.mc.sceneMgr;i.mapType!=SceneType.FUBEN&&(this._tip||(this._tip=new MvpJoinView),this._tip.isShow||(this._tip.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._tip.setId(t,e))},t.prototype.onCloseTip=function(){this._tip&&this._tip.isShow&&this._tip.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._jlview&&(this._jlview.destroy(),this._jlview=null),!0):!1:!0},t}();__reflect(MvpMediator.prototype,"MvpMediator",["IMediator"]);var MvpPJlItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.tname.text=t.rolename;var e=t.itemid,i=t.itemnum;this.icon.setItem(new Item(e,i)),this.icon.enableTip(!0)},e}(eui.ItemRenderer);__reflect(MvpPJlItem.prototype,"MvpPJlItem");var MvpView=function(t){function e(){var e=t.call(this,"MvpSkin")||this;return e._sIdx=-1,e._tzCfg=null,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="MvpItemSkin",this.itemList.itemRenderer=MvpItem,this.initBoss()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bjl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJl,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_MVP_LST,this.updLst,this),EventBus.addListener(EventType.M_MVP_NUM,this.updOne,this),EventBus.addListener(EventType.M_MVP_NUMS,this.updNums,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bjl.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJl,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_MVP_LST,this.updLst,this),EventBus.rmListener(EventType.M_MVP_NUM,this.updOne,this),EventBus.rmListener(EventType.M_MVP_NUMS,this.updNums,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selItem(0);var i=GmGlobal.mc.role;this._cc.dataCtl.pbReq(PbReqId.MVP_LST,[i.kfFlag],null,this.askLst,this),this.alphaShow()},e.prototype.askLst=function(t,e){if(0==t&&e){var i=GmGlobal.mc.mvpMgr;i.bossLst=[];for(var s in e)i.bossLst[Number(s)-1]=e[s];this.updLst(),this.checkGuide()}},e.prototype.initBoss=function(){var t=this._mc.mvpMgr.bossCfgs,e=0;for(var i in t){var s=t[i],o={cfg:s,cd:new GameTime(0),state:0,isxz:!1,index:e+1};this._array.addItem(o),e++}},e.prototype.updLst=function(){var t=this._mc.mvpMgr.bossLst,e=this._mc.mvpMgr.bossCfgs,i=0;for(var s in e){var o=this._array.getItemAt(i),n=t[i];if(n&&!Utils.isEmptyObj(n)){var r=this._mc.mvpMgr.bossCfgs[n.id];o.cfg=r;var h=n.show||GmGlobal.getServerTime();o.cd.setTime(h-GmGlobal.getServerTime()),this._array.itemUpdated(o)}i++}this.updJsMs(),this._array.refresh()},e.prototype.updNums=function(){this._array.refresh()},e.prototype.updOne=function(t){var e=t.data,i=this._array.getItemAt(e);i&&this._array.itemUpdated(i)},e.prototype.updJsMs=function(){var t=this._mc.mvpMgr.bossLst[this._sIdx],e="None";t&&t.killer&&(e=t.killer),this.tName.text="Last Kill    "+e},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList){var e=t.target.parent,i=e.data.index-1;this.selItem(i),"btn"==t.target.name&&(this._tzCfg=e.data.cfg,this._cc.dataCtl.doAction(ServerActionId.MVP_TZ,[i+1],this.tzOk,this),GmGlobal.vmc.mGuide.triggerTargetByID(GuideTargetId.MVP_TZ_BTN))}},e.prototype.tzOk=function(){var t=GmGlobal.mc.sceneMgr;t.mapId!=this._tzCfg.mapid?(t.lockType=this._tzCfg.id,t.fx=this._tzCfg.x,t.fy=this._tzCfg.y):GmGlobal.vmc.scene.currenScene.lockUnitType(this._tzCfg.id,this._tzCfg.x,this._tzCfg.y),this.close()},e.prototype.selItem=function(t){if(t!=this._sIdx){if(-1!=this._sIdx){var e=this._array.getItemAt(this._sIdx);e.ixz=!1,this._array.itemUpdated(e)}var i=this._array.getItemAt(t);i.ixz=!0,this._array.itemUpdated(i),this._sIdx=t,this.updItem()}},e.prototype.updItem=function(){var t=this._array.getItemAt(this._sIdx),e=t.cfg,i=e.icon+"_jpg";this._showBgs?-1==this._showBgs.indexOf(i)&&this._showBgs.push(i):this._showBgs=[i],this.icon.source=null,this.icon.source=i,this.clearItems(),this.scroll.stopAnimation(),this.scroll.viewport.scrollH=0,this._itemCon||(this._itemCon=ItemGridCon.create(),this._itemCon.initGridsByItems(e.items,115,!1,!0,!0),this._itemCon.addToParent(10,10,this.itemCon,null,this.scroll.width),this._itemCon.setTouchCb(!0)),this.updJsMs()},e.prototype.clearItems=function(){this._itemCon&&(ItemGridCon.release(this._itemCon),this._itemCon=null)},e.prototype.clearModel=function(){},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.mvpMgr.rule)},e.prototype.onJl=function(){CmdBus.doCmd(CmdType.O_MVP_JL,this._sIdx)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.MVP){var e=this.itemList.getChildAt(0);if(e){var i=e.getBtn(),s=i.parent.localToGlobal(i.x,i.y);t.bindTarget(GuideTargetId.MVP_TZ_BTN,i,s)}}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MVP)},e.prototype.close=function(){if(this.clearItems(),this.clearModel(),-1!=this._sIdx){var e=this._array.getItemAt(this._sIdx);e.ixz=!1,this._array.itemUpdated(e)}this._sIdx=-1,RedDotView.removeRedDotByGroup("mvp"),t.prototype.close.call(this)},e.prototype.destroy=function(){if(t.prototype.destroy.call(this),RES.destroyRes("mvp_json"),this._showBgs){for(var e=0,i=this._showBgs;e<i.length;e++){var s=i[e];RES.destroyRes(s)}this._showBgs=null}},e}(UIBase);__reflect(MvpView.prototype,"MvpView");var NoticeItemView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.title.text="Version "+this.data.vtxt+" Update",this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(this.data.txt,this.txt.width)),this.height=this.txt.height+80},e}(eui.ItemRenderer);__reflect(NoticeItemView.prototype,"NoticeItemView");var NoticeMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.NOTICE,CmdType.O_NOTICE),CmdBus.adListener(CmdType.O_NOTICE,this.onOpenView,this),CmdBus.adListener(CmdType.C_NOTICE,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOK,this)}return t.prototype.onMainUIOK=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOK,this),this.loadLog(this.checkNew)},t.prototype.checkNew=function(){var t=GmGlobal.mc.dataMgr.getLocalDataValue(LocalDataId.LOG_V);if(this._logData&&0!=this._logData.length){var e=Number(this._logData[this._logData.length-1].v);if(e>t){if(!t)return void GmGlobal.cc.dataCtl.cacheDataToServer(LocalDataId.LOG_V,[e]);if(!GmGlobal.mc.guideMgr.canShowNotice())return void GmGlobal.cc.dataCtl.cacheDataToServer(LocalDataId.LOG_V,[e]);var i=this;setTimeout(function(){i.onOpenView()},1e3)}else t>e&&GmGlobal.cc.dataCtl.cacheDataToServer(LocalDataId.LOG_V,[e])}},t.prototype.loadLog=function(t){var e="updatelog/"+PFConst.LOGFILE;"1"!=GmGlobal.VF_VERSION&&(e+="."+GmGlobal.VF_VERSION),RES.getResByUrl(e,this.onLoaded,this,RES.ResourceItem.TYPE_JSON),this._loadedCb=t},t.prototype.onLoaded=function(t){this._logData=t,this._loadedCb()},t.prototype.onOpenView=function(){this._logData?this.doOpen():this.loadLog(this.onOpenView)},t.prototype.doOpen=function(){this._uiView||(this._uiView=new NoticeView),this._uiView.isShow||this._uiView.show(GmGlobal.vmc.uiLayer),this._uiView.setLogData(this._logData)},t.prototype.onCloseView=function(){this._uiView&&(this._uiView.close(),this._uiView=null)},t}();__reflect(NoticeMediator.prototype,"NoticeMediator");var NoticeView=function(t){function e(){return t.call(this,"NoticeSkin")||this}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="NoticeItemSkin",this.itemList.itemRenderer=NoticeItemView},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setLogData=function(t){this._v=Number(t[t.length-1].v),this._array.removeAll();for(var e=t.length-1;e>=0;e--){var i=t[e];this._array.addItem(i)}},e.prototype.onClose=function(){GmGlobal.cc.dataCtl.cacheDataToServer(LocalDataId.LOG_V,[this._v]),CmdBus.doCmd(CmdType.C_NOTICE)},e.prototype.close=function(){this._array.removeAll(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(NoticeView.prototype,"NoticeView");var OnlineController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.ONLINE_TIME,this.onUpdateOnLine,this)}return t.prototype.onUpdateOnLine=function(t){var e=t.data.data,i=GmGlobal.mc.onlineMgr;i.onlineTime.setTime(e.time),i.weekTime.setTime(e.wtime||0)},t}();__reflect(OnlineController.prototype,"OnlineController");var OnlineManager=function(){function t(){this.onlineTime=new GameTime(0),this.weekTime=new GameTime(0)}return t}();__reflect(OnlineManager.prototype,"OnlineManager");var PayController=function(){function t(){EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){},t.prototype.onUpdate=function(t){var e=t.data.data;GmGlobal.mc.payMgr;GmGlobal.mc.payMgr.recharge=e.t||0},t.prototype.onPayStateUpd=function(t){var e=t.data.data;GmGlobal.mc.payMgr.payStates=e,EventBus.dispatchEvt(EventType.M_PAY_UPD)},t}();__reflect(PayController.prototype,"PayController");var PayManager=function(){function t(){this.payList=[],this.payStates={},this.recharge=0,this.fpayState=0,GmGlobal.mc.regUnzipCfg("c_pay.json",this.initConfig,this)}return t.prototype.initConfig=function(t){t&&(this.payList=t.payCfgs)},t}();__reflect(PayManager.prototype,"PayManager");var PayMediator=function(){function t(){CmdBus.adListener(CmdType.O_PAY,this.onOpenView,this),CmdBus.adListener(CmdType.C_PAY,this.onCloseView,this)}return t.prototype.onOpenView=function(){this.doOpen()},t.prototype.doOpen=function(){this._uiView||(this._uiView=new PayView),this._uiView.isShow||(this._uiView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._uiView&&this._uiView.isShow&&this._uiView.close()},t.prototype.destroy=function(){return this._uiView?this._uiView&&this._uiView.isDestroy()?(this._uiView.destroy(),this._uiView=null,!0):!1:!0},t}();__reflect(PayMediator.prototype,"PayMediator",["IMediator"]);var PayView=function(t){function e(){return t.call(this,"PaySkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="PayItemSkin",this.itemList.itemRenderer=PayItem;for(var e=GmGlobal.mc.payMgr.payList,i=0;i<e.length;i++){var s={cfg:e[i],fb:!0,index:i+1};this._array.addItem(s)}},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updPanel()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_PAY_UPD,this.updPanel,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_PAY_UPD,this.updPanel,this)},e.prototype.updPanel=function(){for(var t=0;t<this._array.length;t++){var e=this._array.getItemAt(t),i=e.cfg;e.fb=GmGlobal.mc.payMgr.payStates[10*i.price]?!1:!0,this._array.replaceItemAt(e,t)}},e.prototype.onTouchList=function(t){if(t.target.parent.data){var e=t.target.parent.data;GmGlobal.cc.pfCtl.pfPay(100*e.cfg.price,e.cfg.diamon,e.cfg.name)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_PAY)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("cz"),t.prototype.destroy.call(this)},e}(UIBase);__reflect(PayView.prototype,"PayView");var Pet=function(){function t(){}return t}();__reflect(Pet.prototype,"Pet");var PetChGrid=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data?(this.q.source="item_json.q_"+this.data.d.q,this.icon.source=GmConst.MODEL_ICON_DIR+"t"+this.data.d.id+".png",this.sel.visible=this.data.sel,this.h.visible=this.data.h,this.data.d.lv>1?this.lv.text="Lv."+this.data.d.lv:this.lv.text=""):(this.q.source="item_json.item_com0",this.icon.source="",this.sel.visible=!1,this.h.visible=!1,this.lv.text="")},e}(eui.ItemRenderer);__reflect(PetChGrid.prototype,"PetChGrid");var PetChView=function(t){function e(){var e=t.call(this,"PetChViewSkin")||this;return e._btnState=0,e._uSel=-1,e._dSel=-1,e._gmEffects={},e._mc=GmGlobal.mc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gridScoll.verticalScrollBar&&(this.gridScoll.verticalScrollBar.autoVisibility=!1),this.gridScoll.horizontalScrollBar&&(this.gridScoll.horizontalScrollBar.autoVisibility=!1),this._gridArray=new eui.ArrayCollection,this.gridList.dataProvider=this._gridArray,this.gridList.itemRendererSkinName="PetGridSkin",this.gridList.itemRenderer=PetGrid},e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bZsx.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShowZsx,this),this.gridList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.chCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChTouch,this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),EventBus.addListener(EventType.M_PET_CH_UPD,this.chUpd,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bZsx.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShowZsx,this),this.gridList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.chCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChTouch,this),this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),EventBus.rmListener(EventType.M_PET_CH_UPD,this.chUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.chUpd(),this.setChSel(-1),this.updateBtnState()},e.prototype.chUpd=function(){this.updateList(),this.updateChGrids(),this.updateGmEffect()},e.prototype.updateList=function(){var t=this._mc.petMgr.plst;if(t){var e=[];for(var i in t){var s=t[i];if(s.petidx!=this._mc.petMgr.bidx){var o=this._mc.npcMgr.getNpcCfg(s.id);e.push({d:s,sel:!1,h:this._mc.petMgr.isEquipCh(s.uid),nlv:o.level})}}e.sort(function(t,e){return e.d.q>t.d.q?1:e.d.q==t.d.q?t.nlv-e.nlv:-1});var n=this._mc.petMgr.petnum;this._gridArray.removeAll();for(var r=null,h=1;n>=h;h++)r=h<=e.length?e[h-1]:null,r?(this._dSel==h-1&&(r.sel=!0),this._gridArray.addItem(r)):this._gridArray.addItem(null)}},e.prototype.updateChGrids=function(){for(var t=this._mc.petMgr.chData,e=1;9>=e;e++){var i=t[e];i?this.setChGrid(e,i.uid):this.setChGrid(e,0)}for(var s in t)var i=t[s]},e.prototype.updateGmEffect=function(){this.clearGmEffect();for(var t=this._mc.petMgr.getGmData(),e=1;3>=e;e++){t.lx&&t.lx.tNum>=e&&this.addGmEffect(e,"cw_zhongzu"),t.xt&&t.xt.tNum>=e&&this.addGmEffect(e,"cw_xingti"),t.ys&&t.ys.tNum>=e&&this.addGmEffect(e,"cw_yuansu");var i=0,s=0,o=this.xhq1;1==e?(i=o.x+o.width/2,s=o.y-30):3==e?(i=o.x+o.width+53,s=o.y+o.height/2):2==e&&(i=o.x-53,s=o.y+o.height/2);var n=this._gmEffects[e];if(n&&n.length>0){n.length>1&&(i-=40*(n.length-1)/2);for(var r=0;r<n.length;r++){var h=n[r];h.setPos(i+40*r,s)}}}},e.prototype.clearGmEffect=function(){for(var t in this._gmEffects)for(var e=this._gmEffects[t],i=0;i<e.length;i++)LoopEffect.release(e[i]);this._gmEffects={}},e.prototype.addGmEffect=function(t,e){var i=this._gmEffects[t];i||(i=[],this._gmEffects[t]=i);var s=LoopEffect.create();s.effectId=e,s.show(this.gmECon),i.push(s)},e.prototype.setChGrid=function(t,e){var i=this["xhq"+t],s=this["xh"+t],o=this["lv"+t];if(e){var n=this._mc.petMgr.getPetByUid(e);n?(i.source="item_json.q_"+n.q,s.source=GmConst.MODEL_ICON_DIR+"t"+n.id+".png",n.lv>1?o.text="Lv."+n.lv:o.text=""):(s.source="",i.source="item_json.item_com0",o.text="")}else s.source="",i.source="item_json.item_com0",o.text=""},e.prototype.updateBtnState=function(){if(this._btnState=0,-1==this._uSel)this.btn.visible=!1;else if(-1!=this._uSel&&-1==this._dSel){var t=this._mc.petMgr.chData[this._uSel];t&&t.uid?(this.btn.visible=!0,this.btn.label="Uninstall",this._btnState=2):this.btn.visible=!1}else if(-1!=this._uSel&&-1!=this._dSel){var e=this._gridArray.getItemAt(this._dSel),t=this._mc.petMgr.chData[this._uSel],i=this._mc.petMgr.isEquipCh(e.d.uid);i||t&&t.uid?e.d.uid==t.uid?this.btn.visible=!1:i?this.btn.visible=!1:(this.btn.visible=!0,this.btn.label="Replace",this._btnState=3):(this.btn.visible=!0,this.btn.label="Equip",this._btnState=1)}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.petMgr.chCfg.rule)},e.prototype.onShowZsx=function(){CmdBus.doCmd(CmdType.O_PET_CH_ZSX)},e.prototype.onList=function(t){if(t.target.data){var e=this.getGridIndex(t.target.data.d.petidx);if(-1!=e){var i=this._gridArray.getItemAt(e);if(i){if(-1==this._dSel)i.sel=!0,this._gridArray.replaceItemAt(i,e),this._dSel=e;else{var s=this._gridArray.getItemAt(this._dSel);s.sel=!1,this._gridArray.replaceItemAt(s,this._dSel),this._dSel!=e?(i.sel=!0,this._gridArray.replaceItemAt(i,e),this._dSel=e):this._dSel=-1}this.updateBtnState()}}}},e.prototype.getGridIndex=function(t){for(var e=0;e<this._gridArray.length;e++){var i=this._gridArray.getItemAt(e);if(i&&i.d.petidx==t)return e}return-1},e.prototype.onChTouch=function(t){var e=this.getChGridIdx(t.target);-1!=e&&(-1==this._uSel?(this.setChSel(e),this._uSel=e):this._uSel!=e?(this.setChSel(e),this._uSel=e):(this.setChSel(-1),this._uSel=-1),this.updateBtnState())},e.prototype.setChSel=function(t){if(-1==t)return void(this.chSel.visible=!1);this.chSel.visible=!0;var e=this["xhq"+t];1==t||2==t||5==t||7==t?this.chSel.width=this.chSel.height=115:this.chSel.width=this.chSel.height=90,this.chSel.x=e.x,this.chSel.y=e.y},e.prototype.getChGridIdx=function(t){switch(t){case this.xhq9:return 9;case this.xhq1:return 1;case this.xhq2:return 2;case this.xhq3:return 3;case this.xhq4:return 4;case this.xhq5:return 5;case this.xhq6:return 6;case this.xhq7:return 7;case this.xhq8:return 8;default:return-1}},e.prototype.onBtn=function(){var t=0;if(1==this._btnState||3==this._btnState){var e=this._gridArray.getItemAt(this._dSel);t=e.d.uid}GmGlobal.cc.dataCtl.doAction(ServerActionId.PET_CH,[this._uSel,t],this.onOk,this)},e.prototype.onOk=function(){if(1==this._btnState||3==this._btnState){var t=this._gridArray.getItemAt(this._dSel);t.sel=!1,this._gridArray.replaceItemAt(t,this._dSel),this._dSel=-1}else 2==this._btnState&&(this._uSel=-1,this.setChSel(-1));this.updateBtnState()},e.prototype.clearAllEffects=function(){for(var t in this._gmEffects){var e=this._gmEffects[t];if(e&&e.length>0)for(var i=0;i<e.length;i++)LoopEffect.release(e[i])}},e.prototype.close=function(){this._uSel=-1,this._dSel=-1,this.clearGmEffect(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null},e}(UIBase);__reflect(PetChView.prototype,"PetChView");var PetChZsx=function(t){function e(){var e=t.call(this,"PetChZsxSkin")||this;return e._lvY=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_PET_CH_ZSX)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateLv(),this.updateGm(),this.resetTxtPos()},e.prototype.updateLv=function(){var t=GmGlobal.mc.petMgr,e=t.chData,i=0;for(var s in e){var o=e[s];if(o&&o.uid){var n=t.getPetByUid(o.uid);n&&(i+=n.lv)}}var r=t.chCfg,h=0,a=0;for(var s in r.lvs){var l=Number(s);if(l>i){a=l;break}h=l}h?(this.clvTxt.text="Current Pets total level："+i+" (level bonus stage "+h+")",this.setLvAttr(this.clvAttr,r.lvs[h])):(this.clvTxt.text="",this.clvAttr.text=""),a?(this.nlvTxt.text="Next Pets total level："+a,this.setLvAttr(this.nlvAttr,r.lvs[a])):(this.nlvTxt.text="",this.nlvAttr.text="")},e.prototype.setLvAttr=function(t,e){var i="";for(var s in e){var o=GmGlobal.mc.heroMgr.getAtrs()[s];o&&(i+=o.name+"："+e[s]+"\n")}t.text=i},e.prototype.updateGm=function(){var t=GmGlobal.mc,e=t.petMgr.getGmData(),i=t.petMgr.chCfg,s="",o=t.heroMgr.getAtrs();if(e.lx)for(var n=0;n<e.lx.gml.length;n++){var r=e.lx.gml[n],h=t.npcMgr.getLeixiKey(r.id),a=i.gm[r.q][r.num][h];s+=o[h].name+a+(o[h].p?"%\n":"\n")}if(e.xt)for(var n=0;n<e.xt.gml.length;n++){var r=e.xt.gml[n],h=t.npcMgr.getTxKey(r.id),a=i.gm[r.q][r.num][h];s+=o[h].name+a+(o[h].p?"%\n":"\n")}if(e.ys)for(var n=0;n<e.ys.gml.length;n++){var r=e.ys.gml[n],h=t.npcMgr.getWxKey(r.id),a=i.gm[r.q][r.num][h];
s+=o[h].name+a+(o[h].p?"%\n":"\n")}this.gmAttr.text=s},e.prototype.resetTxtPos=function(){var t=60;""!=this.clvTxt.text&&(this.clvTxt.y=t,t+=this.clvTxt.height+10),""!=this.clvAttr.text&&(this.clvAttr.y=t,t+=this.clvAttr.height+10),""!=this.nlvTxt.text&&(this.nlvTxt.y=t,t+=this.nlvTxt.height+10),""!=this.nlvAttr.text&&(this.nlvAttr.y=t,t+=this.nlvAttr.height+10),this.gmTitle.y=t+10,this.gmsm.y=this.gmTitle.y+this.gmTitle.height+10,this.gmAttr.y=this.gmsm.y+this.gmsm.height+10},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(PetChZsx.prototype,"PetChZsx");var PetController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_PET,this.onUpdPet,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_PET_LST,this.onUpdPetLst,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_PET_ONE,this.onUpdPetOne,this),EventBus.addListener(EventType.M_UPD_CON,this.updateRedDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.PET_AWARD,this.onPetAward,this),EventBus.addListener(EventType.M_JUPD+JsonID.PET_CH,this.onChList,this),EventBus.addListener(EventType.M_JUPD+JsonID.PET_CH_S,this.onChOne,this)}return t.prototype.onUpdPet=function(t){var e=t.data.data,i=GmGlobal.mc.petMgr;i.bid=e.bid,i.bidx=e.bidx||0,EventBus.dispatchEvt(EventType.M_PET_UPD)},t.prototype.onUpdPetLst=function(t){var e=t.data.data,i=GmGlobal.mc.petMgr,s=null;for(var o in e){var n=e[o],r=Number(o);1==n.opt?delete i.plst[r]:-1==r?s=n.d:i.updLst(r,n)}if(this.resetPListIdx(),s){var h=Utils.getObjectLength(i.plst);i.updLst(h+1,s)}this.updateRedDot(),EventBus.dispatchEvt(EventType.M_PET_INFO)},t.prototype.resetPListIdx=function(){var t=GmGlobal.mc.petMgr.plst,e=0;for(var i in t){e++;var s=Number(i);if(s!=e){var o=t[i];o.petidx=e,t[e]=o,delete t[i]}}},t.prototype.onUpdPetOne=function(t){var e=t.data.data,i=GmGlobal.mc.petMgr;i.updLst(e.petidx,e),this.updateRedDot(),EventBus.dispatchEvt(EventType.M_PET_INFO,e.id)},t.prototype.updateRedDot=function(){var t=GmGlobal.mc.petMgr,e=t.redDot.childs[1];e.state=0;for(var i in t.skillCfgs){var s=Number(i),o=GmGlobal.mc.itemMgr.getItemCfg(s),n=GmGlobal.mc.itemMgr.getItemNum(s),r=o.name;if(-1==r.indexOf("Stats")&&n>0){e.state=1;break}}},t.prototype.onPetAward=function(t){var e=t.data.data;for(var i in e)PetGetTipView.showGet(Number(i),e[i])},t.prototype.onChList=function(t){var e=GmGlobal.mc.petMgr.chData,i=t.data.data;for(var s in i)e[s]=i[s];EventBus.dispatchEvt(EventType.M_PET_CH_UPD)},t.prototype.onChOne=function(t){var e=GmGlobal.mc.petMgr.chData,i=t.data.data;e[i.idx]=i,EventBus.dispatchEvt(EventType.M_PET_CH_UPD)},t}();__reflect(PetController.prototype,"PetController");var PetGetTipView=function(t){function e(){return t.call(this,"PetGetTipSkin")||this}return __extends(e,t),e.showGet=function(t,i){this._instance||(this._instance=new e),this._instance.setPetId(t,i),this._instance.show(GmGlobal.vmc.uiLayer,!0)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.setPetId=function(t,e){var i=GmGlobal.mc,s=i.npcMgr.getNpcCfg(t);s&&(this.q.source="item_json.q_"+e,this.icon.source=GmConst.MODEL_ICON_DIR+"t"+t+".png")},e}(UIBase);__reflect(PetGetTipView.prototype,"PetGetTipView");var PetGrid=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data?(this.q.source="item_json.q_"+this.data.d.q,this.icon.source=GmConst.MODEL_ICON_DIR+"t"+this.data.d.id+".png",GmGlobal.mc.petMgr.bid==this.data.d.uid?this.z.visible=!0:this.z.visible=!1,this.h.visible=this.data.h,this.sel.visible=this.data.sel,this.data.d.lv>1?this.lv.text="Lv."+this.data.d.lv:this.lv.text=""):(this.q.source="item_json.item_com0",this.icon.source="",this.sel.visible=!1,this.z.visible=!1,this.h.visible=!1,this.lv.text="")},e}(eui.ItemRenderer);__reflect(PetGrid.prototype,"PetGrid");var PetHcGrid=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data?(this.q.source="item_json.q_"+this.data.d.q,this.icon.source=GmConst.MODEL_ICON_DIR+"t"+this.data.d.id+".png",this.sel.visible=this.data.sel,this.hc.visible=this.data.hc,this.data.d.lv>1?this.lv.text="Lv."+this.data.d.lv:this.lv.text=""):(this.q.source="item_json.item_com0",this.icon.source="",this.sel.visible=!1,this.hc.visible=!1,this.lv.text="")},e}(eui.ItemRenderer);__reflect(PetHcGrid.prototype,"PetHcGrid");var PetHcView=function(t){function e(){var e=t.call(this,"PetHcViewSkin")||this;return e._hcID=0,e._hcIdx=-1,e._mc=GmGlobal.mc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gridScoll.verticalScrollBar&&(this.gridScoll.verticalScrollBar.autoVisibility=!1),this.gridScoll.horizontalScrollBar&&(this.gridScoll.horizontalScrollBar.autoVisibility=!1),this._gridArray=new eui.ArrayCollection,this.gridList.dataProvider=this._gridArray,this.gridList.itemRendererSkinName="PetHcGridSkin",this.gridList.itemRenderer=PetHcGrid},e.prototype.updatePos=function(){this.x=35,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.gridList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bHc.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.gridList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bHc.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateList(),this.unselHcPet()},e.prototype.getClGrids=function(t){switch(t){case 1:return[2];case 2:return[0,1];case 3:return[0,1,2];case 4:return this.xh3.x=this.xhq3.x=179,this.xh3.y=this.xhq3.y=53,this.xh4.x=this.xhq4.x=353,this.xh4.y=this.xhq4.y=53,[0,1,3,4];case 5:return this.xh3.x=this.xhq3.x=145,this.xh3.y=this.xhq3.y=108,this.xh4.x=this.xhq4.x=387,this.xh4.y=this.xhq4.y=108,[0,1,2,3,4];default:return null}},e.prototype.setClGrid=function(t){if(t)for(var e=0;e<t.length;e++)this["xhq"+t[e]].visible=!0},e.prototype.clearClGrid=function(){for(var t=0;5>t;t++)this["xhq"+t].visible=!1,this["xh"+t].source=""},e.prototype.updateList=function(){var t=this._mc.petMgr.plst;if(t){var e=[];for(var i in t){var s=t[i];if(s.petidx!=this._mc.petMgr.bidx&&s.q<5&&s.lv<2&&0==s.exp&&!this._mc.petMgr.isEquipCh(s.uid)){var o=this._mc.npcMgr.getNpcCfg(s.id);e.push({d:s,sel:!1,hc:!1,nlv:o.level})}}e.sort(function(t,e){return e.d.q>t.d.q?1:e.d.q==t.d.q?t.nlv-e.nlv:-1});var n=this._mc.petMgr.petnum;this._gridArray.removeAll();for(var r=null,h=1;n>=h;h++)r=h<=e.length?e[h-1]:null,r?this._gridArray.addItem(r):this._gridArray.addItem(null)}},e.prototype.onTouchList=function(t){if(t.target.data){var e=this.getGridIndex(t.target.data.d.petidx);if(-1!=e){var i=this._gridArray.getItemAt(e);i&&(this._hcID?i.d.uid==this._hcID?this.unselHcPet():this.isSel(i.d.uid)?this.unselHcCl(e,i):this.selHcCl(e,i):this.selHcPet(e,i))}}},e.prototype.getGridIndex=function(t){for(var e=0;e<this._gridArray.length;e++){var i=this._gridArray.getItemAt(e);if(i&&i.d.petidx==t)return e}return-1},e.prototype.isSel=function(t){if(this._clGrids&&this._clGrids.length>0)for(var e=0;e<this._clGrids.length;e++){var i=this._clGrids[e];if(t==i.id)return!0}return!1},e.prototype.selHcPet=function(t,e){var i=this._mc.petMgr,s=this.getClGrids(i.getHcClNum(e.d.q));if(s){this._clGrids=[];for(var o=0;o<s.length;o++)this._clGrids.push({gridIdx:s[o],id:0,idx:-1});this.setClGrid(s),this._hcID=e.d.uid,this._hcIdx=t,this.hcIcon.source=i.getPetIonc(e.d.id);var n=this._gridArray.getItemAt(t);n.hc=!0,this._gridArray.replaceItemAt(n,t),this.updateHcR()}},e.prototype.unselHcPet=function(){if(this._hcID){var t=this._gridArray.getItemAt(this._hcIdx);t.hc=!1,this._gridArray.replaceItemAt(t,this._hcIdx),this._hcID=0,this._hcIdx=-1}if(this._clGrids&&this._clGrids.length>0)for(var e=0;e<this._clGrids.length;e++){var i=this._clGrids[e];if(i&&-1!=i.idx){var s=this._gridArray.getItemAt(i.idx);s&&(s.sel=!1,this._gridArray.replaceItemAt(s,i.idx))}}this.hcIcon.source="",this.clearClGrid(),this._clGrids=null,this.updateHcBtn(),this.updateHcR()},e.prototype.selHcCl=function(t,e){for(var i=this._gridArray.getItemAt(this._hcIdx),s=0;s<this._clGrids.length;s++){var o=this._clGrids[s];if(o&&-1==o.idx){var n=this._gridArray.getItemAt(t);return void(n.d.q>=i.d.q?(o.idx=t,o.id=e.d.uid,n.sel=!0,this._gridArray.replaceItemAt(n,t),this["xh"+o.gridIdx].source=this._mc.petMgr.getPetIonc(e.d.id),this.updateHcBtn(),this.updateHcR()):MsgBox.prompt("Rarity can’t be lower than the Pet to be synthesized."))}}},e.prototype.unselHcCl=function(t,e){for(var i=0;i<this._clGrids.length;i++){var s=this._clGrids[i];if(s&&s.idx==t){s.idx=-1,s.id=0;var o=this._gridArray.getItemAt(t);return o&&(o.sel=!1,this._gridArray.replaceItemAt(o,t)),this["xh"+s.gridIdx].source="",this.updateHcBtn(),void this.updateHcR()}}},e.prototype.updateHcBtn=function(){if(!this._clGrids)return void Utils.setBtnEnable(this.bHc,!1);for(var t=0;t<this._clGrids.length;t++){var e=this._clGrids[t];if(!e||-1==e.idx)return void Utils.setBtnEnable(this.bHc,!1)}Utils.setBtnEnable(this.bHc,!0)},e.prototype.updateHcR=function(){this._qRandom?this._qRandom.q2=this._qRandom.q3=this._qRandom.q4=this._qRandom.q5=0:this._qRandom={q2:0,q3:0,q4:0,q5:0};var t=this._mc.petMgr.hcCfg;if(-1!=this._hcIdx){var e=this._gridArray.getItemAt(this._hcIdx);this.setQRandom(e.d.q+1,t.bei*t.weightval)}if(this._clGrids)for(var i=0;i<this._clGrids.length;i++){var s=this._clGrids[i];if(s){var o=this._gridArray.getItemAt(s.idx);o&&this.setQRandom(o.d.q+1,t.weightval)}}this.rq2.text=this._qRandom.q2,this.rq3.text=this._qRandom.q3,this.rq4.text=this._qRandom.q4,this.rq5.text=this._qRandom.q5,this.rqCon.removeChildren(),this._qRandom.q5>0&&(this.rqCon.addChild(this.rqt5),this.rqCon.addChild(this.rq5)),this._qRandom.q4>0&&(this.rqCon.addChild(this.rqt4),this.rqCon.addChild(this.rq4)),this._qRandom.q3>0&&(this.rqCon.addChild(this.rqt3),this.rqCon.addChild(this.rq3)),this._qRandom.q2>0&&(this.rqCon.addChild(this.rqt2),this.rqCon.addChild(this.rq2))},e.prototype.setQRandom=function(t,e){this._qRandom["q"+t]+=e},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.petMgr.hcCfg.rule)},e.prototype.onHc=function(){this.bHc.touchEnabled=!1,this._hcEffect||(this._hcEffect=new MovieClipEx("cw_hc")),this._hcEffect.parent||this.addChild(this._hcEffect),this._hcEffect.x=this.hcIcon.x+Math.floor(this.hcIcon.width/2),this._hcEffect.y=this.hcIcon.y+Math.floor(this.hcIcon.height/2),this._hcEffect.play(1,this.doHc,this)},e.prototype.doHc=function(){this._hcEffect.clear();var t=[];t.push(this._hcID);for(var e=0;e<this._clGrids.length;e++){var i=this._clGrids[e];i&&t.push(i.id)}GmGlobal.cc.dataCtl.doAction(ServerActionId.PET_HC,t,this.onHcOk,this)},e.prototype.onHcOk=function(){this.bHc.touchEnabled=!0,this.unselHcPet(),this.updateList()},e.prototype.close=function(){this.unselHcPet(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null},e}(UIBase);__reflect(PetHcView.prototype,"PetHcView");var PetItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bar.slideDuration=0},e.prototype.dataChanged=function(){var t=this.data.item,e=this.data.pet,i=GmGlobal.mc.petMgr.skillCfgs[t.id];this.tname.text=i.name;var s=0,o=e.skill;o&&(s=o[t.id]||0);var n=GmGlobal.mc.itemMgr.getItemNum(t.id);this.tnum.text="Owned:"+n;var r=n>0?!0:!1;Utils.setBtnEnable(this.blw,r);var h=GmGlobal.mc.petMgr.eles;-1!=h.indexOf(t.id)?this.blw.skinName="ComBtnSkinG":this.blw.skinName="ComBtnSkinB";var a=GmConst.SKILL_TYPE[i.type-1];this.ttype.text=a;var l=i.des.txt,c=0,d=i.des.exp[s];d||(d=i.des.exp[s-1]),s>0&&(c=i.des.nums[s-1]),l=l.replace("%x",c.toString()),this.tms.text=l,this.icon.setItem(new Item(t.id,s),!1,"LV."),this.icon.enableTip(!1);var p=0;e.skillExp&&(p=e.skillExp[t.id]||0),this.bar.value=p,this.bar.maximum=d,s>=i.des.nums.length?(this.blw.label="Max LV",Utils.setBtnEnable(this.blw,!1),this.bar.value=this.bar.maximum):this.blw.label="Discover"},e}(eui.ItemRenderer);__reflect(PetItem.prototype,"PetItem");var PetManager=function(){function t(){this.skillCfgs={},this.tfNames=[],this.upLvAtrs=[],this.qNames=[],this.uplvs=[],this.eles=[],this.hyd=0,this.chData={},this.plst={},GmGlobal.mc.regUnzipCfg("c_pet.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_pethc.json",this.initHcCfg,this),GmGlobal.mc.regUnzipCfg("c_petch.json",this.initChCfg,this);var t={0:0,1:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.PET,this.redDot)}return t.prototype.initCfg=function(t){this.rule=t.rule,this.inithyd=t.initpethyd,this.petnum=t.petnum,this.tfmaxnum=t.tfmaxnum,this.skillCfgs=t.skillCfgs,this.tfNames=t.tfNames,this.uplvs=t.uplvs,this.upLvAtrs=t.upLvAtrs,this.qNames=t.qNames,this.eles=t.eles,this.hsPrice=t.hsprice},t.prototype.initHcCfg=function(t){this.hcCfg=t},t.prototype.initChCfg=function(t){this.chCfg=t},t.prototype.getPetIonc=function(t){return GmConst.MODEL_ICON_DIR+"t"+t+".png"},t.prototype.getHsPrice=function(t){var e=0;for(var i in this.hsPrice){if(!(t>=Number(i)))break;e=this.hsPrice[i]}return e},t.prototype.getPet=function(t){return this.plst[t]},t.prototype.getPetByUid=function(t){for(var e in this.plst){var i=this.plst[e];if(i.uid==t)return i}return null},t.prototype.getCzPet=function(){return this.plst[this.bidx]},t.prototype.updLst=function(t,e){var i=this.getPet(t);i||(i=new Pet),i.petidx=t,i.id=e.id,i.hp=e.hp||0,i.lv=e.lv||0,i.exp=e.exp||0,i.mapid=e.mapid,i.tf=e.tf,i.q=e.q,i.hyd=e.hyd||0,i.skill=e.skill,i.skillExp=e.skillexp,i.attr=e.attr,i.uid=e.uid,this.plst[t]=i},t.prototype.getSkillSortLst=function(){var t=[],e=[];for(var i in this.skillCfgs)this.insertSkill(t,Number(i),2),this.insertNunSkill(e,Number(i),2);return t=t.concat(e)},t.prototype.getSkillLst=function(){var t=[];for(var e in this.skillCfgs){var i=Number(e),s=(GmGlobal.mc.itemMgr.getItemCfg(i),GmGlobal.mc.itemMgr.getItemNum(i)),o=new Item(i,s);t.push(o)}return t},t.prototype.insertSkill=function(t,e,i){var s=GmGlobal.mc.itemMgr.getItemCfg(e),o=GmGlobal.mc.itemMgr.getItemNum(e);if(o){var n=new Item(e,o);if(0==t.length)return void t.push(n);for(var r=0;r<t.length;r++){var h=t[r],a=GmGlobal.mc.itemMgr.getItemCfg(h.id);if(1==i){if(s.quality>a.quality||s.quality==a.quality&&s.id>a.id)break}else if(s.quality<a.quality||s.quality==a.quality&&s.id<a.id)break}t.splice(r,0,n)}},t.prototype.insertNunSkill=function(t,e,i){var s=GmGlobal.mc.itemMgr.getItemCfg(e),o=GmGlobal.mc.itemMgr.getItemNum(e);if(!o){var n=new Item(e,0);if(0==t.length)return void t.push(n);for(var r=0;r<t.length;r++){var h=t[r],a=GmGlobal.mc.itemMgr.getItemCfg(h.id);if(1==i){if(s.quality>a.quality||s.quality==a.quality&&s.id>a.id)break}else if(s.quality<a.quality||s.quality==a.quality&&s.id<a.id)break}t.splice(r,0,n)}},t.prototype.getHcClNum=function(t){var e=this.hcCfg.hc[t];return e?e.pos:0},t.prototype.isEquipCh=function(t){for(var e in this.chData){var i=this.chData[e];if(i&&i.uid==t)return!0}return!1},t.prototype.getGmData=function(){for(var t=[1,2,5,7],e={},i={},s={},o=0;o<t.length;o++){var n=this.chData[t[o]];if(n&&n.uid){var r=this.getPetByUid(n.uid),h=GmGlobal.mc.npcMgr.getNpcCfg(n.id);if(s[h.eleattrid]){var a=s[h.eleattrid];a.num++,r.q<a.q&&(a.q=r.q)}else s[h.eleattrid]={q:r.q,num:1};if(e[h.shapeattrid]){var a=e[h.shapeattrid];a.num++,r.q<a.q&&(a.q=r.q)}else e[h.shapeattrid]={q:r.q,num:1};if(i[h.raceattrid]){var a=i[h.raceattrid];a.num++,r.q<a.q&&(a.q=r.q)}else i[h.raceattrid]={q:r.q,num:1}}}var l={xt:null,lx:null,ys:null};for(var c in e)e[c].num>1&&(l.xt||(l.xt={tNum:0,gml:[]}),l.xt.tNum+=e[c].num-1,l.xt.gml.push({id:Number(c),num:e[c].num-1,q:e[c].q}));for(var c in i)i[c].num>1&&(l.lx||(l.lx={tNum:0,gml:[]}),l.lx.tNum+=i[c].num-1,l.lx.gml.push({id:Number(c),num:i[c].num-1,q:i[c].q}));for(var c in s)s[c].num>1&&(l.ys||(l.ys={tNum:0,gml:[]}),l.ys.tNum+=s[c].num-1,l.ys.gml.push({id:Number(c),num:s[c].num-1,q:s[c].q}));return l},t.prototype.getPetQStr=function(t){return this.qNames[t-1]},t}();__reflect(PetManager.prototype,"PetManager");var PetMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.PET,CmdType.O_PET),CmdBus.adListener(CmdType.O_PET,this.onOpenView,this),CmdBus.adListener(CmdType.C_PET,this.onCloseView,this),CmdBus.adListener(CmdType.O_PET_USE,this.onOpenUseView,this),CmdBus.adListener(CmdType.C_PET_USE,this.onCloseUseView,this),CmdBus.adListener(CmdType.O_PET_TIP,this.onOpenTip,this),CmdBus.adListener(CmdType.C_PET_TIP,this.onCloseTip,this),CmdBus.adListener(CmdType.O_PET_CH_ZSX,this.onOpenChZsx,this),CmdBus.adListener(CmdType.C_PET_CH_ZSX,this.onCloseChZsx,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new PetView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenUseView=function(t,e){this._useview||(this._useview=new PetUseView),this._useview.isShow||(this._useview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._useview.setId(t,e)},t.prototype.onCloseUseView=function(){this._useview&&this._useview.isShow&&this._useview.close()},t.prototype.onOpenTip=function(t,e,i,s){void 0===i&&(i=1),this._tip||(this._tip=new PetSkillTip),this._tip.isShow||(this._tip.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._tip.setId(t,e,i,s)},t.prototype.onCloseTip=function(){this._tip&&this._tip.isShow&&this._tip.close()},t.prototype.onOpenChZsx=function(){this._chZsx||(this._chZsx=new PetChZsx),this._chZsx.isShow||this._chZsx.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseChZsx=function(){this._chZsx&&this._chZsx.isShow&&this._chZsx.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._useview&&(this._useview.destroy(),this._useview=null),this._tip&&(this._tip.destroy(),this._tip=null),this._chZsx&&(this._chZsx.destroy(),this._chZsx=null),!0):!1:!0},t}();__reflect(PetMediator.prototype,"PetMediator",["IMediator"]);var PetSkillTip=function(t){function e(){var e=t.call(this,"PetSkillTipSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0)},e.prototype.setId=function(t,e,i,s){void 0===i&&(i=1),t&&e&&s&&(this._id=t,this._idx=e,this._lv=i,this._petId=s,this.updUI())},e.prototype.addEvts=function(){this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),EventBus.addListener(EventType.M_UPD_CON,this.updUI,this)},e.prototype.rmEvts=function(){this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),EventBus.rmListener(EventType.M_UPD_CON,this.updUI,this)},e.prototype.updUI=function(){var t=this._mc.petMgr.skillCfgs[this._id],e=GmConst.SKILL_TYPE[t.type-1];if(this.ttype.text=e,this.tname.text=t.name,1==this._idx){var i=this._mc.itemMgr.getItemNum(this._id)||0;this.item.numTxt.text=i.toString(),this.btn.label="Learn"}else this.item.numTxt.text="LV."+this._lv,this.btn.label="Forget";var s=t.des.txt,o=t.des.nums[this._lv-1];s=s.replace("%x",o),this.tms.text=s,this.item.updateIcon(this._id)},e.prototype.onBtn=function(){if(1==this._idx){var t=this.isYxx(this._id);if(t){var e="Skill slot full. Please forget an owned skill before learning new skills!";1==t?(e="Learning the same skill has a chance of increasing the skill's level and effect. If the learning fails, the skill book will be consumed.",MsgBox.confirm(e,this.onOk,this.onClose,this,"Learn","Cancel")):3==t?(e="You can only learn one element at a time. After learning the element, the original element will be replaced.",MsgBox.confirm(e,this.onOk,this.onClose,this,"Learn","Cancel")):MsgBox.alert(e,this.onClose,this,"Cancel")}else this.onOk()}else this.onOk()},e.prototype.onOk=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.PET_SKILL,[this._petId,this._id,this._idx-1]),this.onClose()},e.prototype.isYxx=function(t){var e=0,i=this._mc.petMgr.plst[this._petId],s=0;for(var o in i.skill)t==Number(o)?e=1:-1!=this._mc.petMgr.eles.indexOf(t)&&-1!=this._mc.petMgr.eles.indexOf(Number(o))&&(e=3),s++;return e},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_PET_TIP)},e}(UIBase);__reflect(PetSkillTip.prototype,"PetSkillTip");var PetUseView=function(t){function e(){var e=t.call(this,"PetUseSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0)},e.prototype.setId=function(t,e){t&&e&&(this._id=t,this._idx=e,this.updUI())},e.prototype.updUI=function(){this._id==ItemID.PETEXP?this.tit.text="Do you want to level up the pet using the following items?":this._id==ItemID.PETHY&&(this.tit.text="Do you want to increase the pet's Activity with the following items?"),this.item.updateIcon(this._id);var t=this._mc.itemMgr.getItemNum(this._id)||0;this.item.numTxt.text=t.toString(),this.slider.maximum=t,this.slider.minimum=0,this._max=t,this._num=1,this.slider.value=this._num,this.updateSliderLight(),this.updateNumTxt()},e.prototype.addEvts=function(){this.bUse.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this),this.bJian.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSub,this),this.bJia.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.slider.addEventListener(egret.Event.CHANGE,this.onSliderChange,this),EventBus.addListener(EventType.M_UPD_CON,this.updUI,this)},e.prototype.rmEvts=function(){this.bUse.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this),this.bJian.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSub,this),this.bJia.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.slider.removeEventListener(egret.Event.CHANGE,this.onSliderChange,this),EventBus.rmListener(EventType.M_UPD_CON,this.updUI,this)},e.prototype.onAdd=function(){this._num++,this._num>this._max&&(this._num=this._max),this.slider.value=this._num,this.updateSliderLight(),this.updateNumTxt()},e.prototype.onSub=function(){this._num--,this._num<1&&(this._num=1),this.slider.value=this._num,this.updateSliderLight(),this.updateNumTxt()},e.prototype.onSliderChange=function(){this._num=this.slider.value,this.updateSliderLight(),this.updateNumTxt()},e.prototype.updateSliderLight=function(){this.slider.trackHighlight.width=Math.max(Math.floor((this.slider.width-19)*(this._num/this._max)+19),19)},e.prototype.updateNumTxt=function(){this.uNum.text="Quantity:"+this._num},e.prototype.onUse=function(){this._id==ItemID.PETEXP?GmGlobal.cc.dataCtl.doAction(ServerActionId.PET_UP,[this._idx,this._id,this._num]):this._id==ItemID.PETHY&&GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_PET_HY,[this._idx,this._id,this._num]),this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_PET_USE)},e}(UIBase);__reflect(PetUseView.prototype,"PetUseView");var PetView=function(t){function e(){var e=t.call(this,"PetSkin")||this;return e._col=5,e._minLine=3,e._tabIndex=-1,e._sIdx=-1,e._petIdx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.baddhy.sound="ui_jiajian",this.baddlv.sound="ui_jiajian",this.bRule.sound=null,this.barhy.slideDuration=0,this.barLv.slideDuration=0,this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1),this.gridScoll.verticalScrollBar&&(this.gridScoll.verticalScrollBar.autoVisibility=!1),this.gridScoll.horizontalScrollBar&&(this.gridScoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="PetItemSkin",this.itemList.itemRenderer=PetItem,this._gridArray=new eui.ArrayCollection,this.gridList.dataProvider=this._gridArray,this.gridList.itemRendererSkinName="PetGridSkin",this.gridList.itemRenderer=PetGrid},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bHs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHs,this),this.bZsHs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZsHs,this),this.bCz.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCz,this),this.baddhy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddHy,this),this.baddlv.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddLv,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.gridList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGridList,this),EventBus.addListener(EventType.M_PET_UPD,this.updGrid,this),EventBus.addListener(EventType.M_PET_INFO,this.updPet,this),EventBus.addListener(EventType.M_UPD_CON,this.updCon,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bHs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHs,this),this.bZsHs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZsHs,this),this.bCz.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCz,this),this.baddhy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddHy,this),this.baddlv.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddLv,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.gridList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGridList,this),EventBus.rmListener(EventType.M_PET_UPD,this.updGrid,this),EventBus.rmListener(EventType.M_PET_INFO,this.updPet,this),EventBus.rmListener(EventType.M_UPD_CON,this.updCon,this)},e.prototype.updPet=function(){0==this._tabIndex?this.updIcons():1==this._tabIndex?(this.updGrid(),this.updLst()):this.updIcons()},e.prototype.updCon=function(){1==this._tabIndex&&this.updLst()},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selTab(0),this.alphaShow(),this.updateRedDot()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target),i=this._mc.petMgr.plst;if(!i||Utils.isEmptyObj(i)&&1==e)return void MsgBox.prompt("No pet yet");if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t,0==t?(this.petCon.visible=!0,this.atrCon.visible=!1,this._hcView&&this._hcView.close(),this._chView&&this._chView.close(),this.updIcons()):1==t?(this.petCon.visible=!1,this.atrCon.visible=!0,this._hcView&&this._hcView.close(),this._chView&&this._chView.close(),this.updLst()):2==t?(this.petCon.visible=!1,this.atrCon.visible=!1,this._chView&&this._chView.close(),this._hcView||(this._hcView=new PetHcView),this._hcView.isShow||this._hcView.show(this)):3==t&&(this.petCon.visible=!1,this.atrCon.visible=!1,this._hcView&&this._hcView.close(),this._chView||(this._chView=new PetChView),this._chView.isShow||this._chView.show(this))}},e.prototype.updIcons=function(){var t=this._mc.petMgr.plst;if(t){var e=[];for(var i in t){var s=t[i],o=this._mc.npcMgr.getNpcCfg(s.id);e.push({d:s,sel:!1,h:this._mc.petMgr.isEquipCh(s.uid),nlv:o.level})}e.sort(function(t,e){return e.d.q>t.d.q?1:e.d.q==t.d.q?t.nlv-e.nlv:-1});var n=this._mc.petMgr.petnum;this._gridArray.removeAll();for(var r=-1,h=1;n>=h;h++){var a=e[h-1];a?(a.d.uid==this._mc.petMgr.bid&&(r=h-1),this._gridArray.addItem(a)):this._gridArray.addItem(null)}-1==this._sIdx?-1!=r?this.selGrid(r):this.selGrid(0):this.updGrid()}},e.prototype.onGridList=function(t){if(t.target.data){var e=this.getGridIndex(t.target.data.d.petidx);-1!=e&&this.selGrid(e)}},e.prototype.getGridIndex=function(t){for(var e=0;e<this._gridArray.length;e++){var i=this._gridArray.getItemAt(e);if(i&&i.d.petidx==t)return e}return-1},e.prototype.selGrid=function(t){if(t!=this._sIdx){if(-1!=this._sIdx){var e=this._gridArray.getItemAt(this._sIdx);e&&(e.sel=!1,this._gridArray.replaceItemAt(e,this._sIdx))}var i=this._gridArray.getItemAt(t);i&&(this._sIdx=t,i.sel=!0,this._gridArray.replaceItemAt(i,t),this._petIdx=i.d.petidx,this.updGrid())}},e.prototype.updGrid=function(){var t=this._gridArray.getItemAt(this._sIdx);if(t){t.sel=!0,this._gridArray.replaceItemAt(this._gridArray.getItemAt(this._sIdx),this._sIdx),this._petIdx=t.d.petidx;var e=t.d,i=this._mc.npcMgr.getNpcCfg(e.id);i&&(this.tName.text=i.name,this.tName.visible=!0,this.tXt.text=this._mc.npcMgr.getWx(i.eleattrid)+" "+this._mc.npcMgr.getTx(i.shapeattrid)+" "+this._mc.npcMgr.getLeixi(i.raceattrid),this.tXt.visible=!0,this._petModel?this._petModel.setInfo(Utils.getLocalUID(),i.res,i.h,1.5*i.scale||1,ActionType.STAND_TO):(this._petModel=UnitViewCreator.instence().createMonsterUIModel(e.id,1.5*i.scale),this.petCon.addChildAt(this._petModel,this.petCon.getChildIndex(this.itf)),this._petModel.x=this.petCon.width/2,this._petModel.y=350)),this.tType.text=GmConst.PET_TYPE[e.tf.type-1],this.clearTf();var s=0;for(var o in e.tf.lst){var n=e.tf.lst[o],r=this["tTf"+s],h=this["iTf"+s];r.text=this._mc.petMgr.tfNames[n-1],h.source="pet_json.pet_tf_"+(n-1),r.visible=!0,h.visible=!0,s++}var a=this._mc.petMgr.uplvs[e.lv-1];this.barTlv.text=e.exp+"/"+a.exp,this.barLv.value=e.exp,this.barLv.maximum=a.exp,this.tlv.text="LV."+e.lv,this.barThy.text=e.hyd+"/"+this._mc.petMgr.inithyd,this.barhy.value=e.hyd,this.barhy.maximum=this._mc.petMgr.inithyd;var l=(this._mc.petMgr.upLvAtrs.indexOf("hm"),0),c=e.attr;c&&c.hm&&(l=c.hm);var d=e.hp;this.tType.visible=!0,this.tlv.visible=!0,e.uid==this._mc.petMgr.bid?(Utils.setBtnEnable(this.bHs,!1),Utils.setBtnEnable(this.bZsHs,!1),this.bCz.label="Remove",d=GmGlobal.vmc.scene.currenScene.getMyPetHp()):(Utils.setBtnEnable(this.bHs,!0),Utils.setBtnEnable(this.bZsHs,!0),this.bCz.label="Battle"),Utils.setBtnEnable(this.bCz,!0),this._mc.petMgr.isEquipCh(e.uid)&&(Utils.setBtnEnable(this.bHs,!1),Utils.setBtnEnable(this.bZsHs,!1),Utils.setBtnEnable(this.bCz,!1)),Utils.setBtnEnable(this.baddhy,!0),Utils.setBtnEnable(this.baddlv,!0),this.barThy.visible=!0,this.barTlv.visible=!0;for(var p=0;7>p;p++){var u=this._mc.petMgr.upLvAtrs[p],m=this._mc.heroMgr.isAddJia(u),_=this._mc.heroMgr.getAtrName(u),r=this["tBAtr"+p],g=this["tBAtrNum"+p];r.text=_;var f=0;c&&c[u]&&(f=c[u]),m?g.text="+"+f:g.text=f}var v="";e.q&&(v=this._mc.petMgr.getPetQStr(e.q)),this.tpz.text=v;var y=e.attr.z||0;this.tZl.text="Power:"+y,this.tZl.visible=!0,i&&i.uplvmax?this.lvMax.text="Level Limit："+i.uplvmax:this.lvMax.text=""}else this.tName.visible=!1,this.tXt.visible=!1,this.tType.visible=!1,this.tlv.text="LV.0",this.barThy.visible=!1,this.barTlv.visible=!1,this.barLv.value=0,this.barhy.value=0,Utils.setBtnEnable(this.baddhy,!1),Utils.setBtnEnable(this.baddlv,!1),Utils.setBtnEnable(this.bHs,!1),Utils.setBtnEnable(this.bZsHs,!1),Utils.setBtnEnable(this.bCz,!1),this.bCz.label="Battle",this.clearTf(),this.clearModel(),this.tZl.visible=!1
},e.prototype.clearModel=function(){UnitViewCreator.instence().releaseUIModel(this._petModel),this._petModel=null},e.prototype.clearTf=function(){for(var t=0;6>t;t++){var e=this["tTf"+t],i=this["iTf"+t];e.visible=!1,i.visible=!1}},e.prototype.updLst=function(){var t=(this._mc.petMgr.skillCfgs,this._mc.petMgr.getSkillLst()),e=this._gridArray.getItemAt(this._sIdx);if(e||(this._sIdx=-1,this.updIcons()),e=this._gridArray.getItemAt(this._sIdx)){for(var i=e.d,s=0;s<t.length;s++){var o=t[s],n={item:o,pet:i,idx:s+1},r=this._array.getItemAt(s);r?this._array.replaceItemAt(n,s):this._array.addItem(n)}this.updateRedDot()}},e.prototype.updateRedDot=function(){for(var t=0;2>t;t++){var e=this._mc.petMgr.redDot.childs[t],i=this.tableBgCon.getChildAt(t);if(1==e.state){var s=this.tableBgCon.x+110*(t+1)+10*t-20;RedDotView.addRedDot(i,this.redDotCon,"pet",s,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(i)}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data,i=e.item,s=this.isYxx(i.id);if(s){var o="Skill slot full. Please forget an owned skill before learning new skills!";1==s?this.onSkillOk(i.id):3==s?(o="You can only learn one element at a time. After learning the element, the original element will be replaced.",MsgBox.confirm(o,this.onSkillOk,null,this,"Learn","Cancel",i.id)):MsgBox.alert(o,null,null,"Cancel")}else this.onSkillOk(i.id)}},e.prototype.onSkillOk=function(t){this._cc.dataCtl.doAction(ServerActionId.PET_SKILL,[this._petIdx,t,0])},e.prototype.isYxx=function(t){var e=0,i=this._mc.petMgr.plst[this._petIdx],s=0;for(var o in i.skill)t==Number(o)?e=1:-1!=this._mc.petMgr.eles.indexOf(t)&&-1!=this._mc.petMgr.eles.indexOf(Number(o))&&(e=3),s++;return e},e.prototype.onAddHy=function(){CmdBus.doCmd(CmdType.O_PET_USE,ItemID.PETHY,this._petIdx)},e.prototype.onAddLv=function(){CmdBus.doCmd(CmdType.O_PET_USE,ItemID.PETEXP,this._petIdx)},e.prototype.onHs=function(){-1!=this._petIdx&&MsgBox.confirm("Recycled pets will "+TextFormat.setColor("Disappear",13002900)+"，The level and skill of this pet "+TextFormat.setColor("Will be refunded as per a certain ratio",13002900)+"。",this.onHsOk,null,this,"Confirm","Cancel")},e.prototype.onZsHs=function(){if(-1!=this._petIdx){var t=0,e=this._gridArray.getItemAt(this._sIdx);e&&(t=this._mc.petMgr.getHsPrice(e.d.lv)),MsgBox.confirm("Spend "+TextFormat.setColor(t.toString(),13002900)+" Diamonds to recycle the Pet? All the upgrade materials will be returned.",this.onZsHsOk,null,this,"Confirm","Cancel")}},e.prototype.onHsOk=function(){this._cc.dataCtl.doAction(ServerActionId.PET_CZ,[this._petIdx,1],this.onOk,this)},e.prototype.onZsHsOk=function(){this._cc.dataCtl.doAction(ServerActionId.PET_CZ,[this._petIdx,1,0,1],this.onOk,this)},e.prototype.onOk=function(){this._sIdx=-1,this._petIdx=-1,this.updIcons()},e.prototype.onCz=function(){this._cc.dataCtl.doAction(ServerActionId.PET_CZ,[this._petIdx,0],this.czOk,this)},e.prototype.czOk=function(){var t=this._mc.petMgr.plst[this._petIdx];t&&t.uid==this._mc.petMgr.bid&&this.onClose()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.petMgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_PET)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,this._sIdx=-1,this._petIdx=-1,this.clearTf(),this.clearModel(),RedDotView.removeRedDotByGroup("pet"),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,this._cc=null,this._hcView&&(this._hcView.close(),this._hcView.destroy(),this._hcView=null),this._chView&&(this._chView.close(),this._chView.destroy(),this._chView=null),RES.destroyRes("pet_json")},e}(UIBase);__reflect(PetView.prototype,"PetView");var McjCjView=function(t){function e(){var e=t.call(this,"McjCjViewSkin")||this;return e._cjing=!1,e._mc=GmGlobal.mc,e}return __extends(e,t),e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bOne.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.bTen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTen,this),this.bChange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),EventBus.addListener(EventType.M_JUPD+JsonID.MCJ_CJ_LST,this.updateLst,this),EventBus.addListener(EventType.M_JUPD+JsonID.MCJ_UPD,this.updateBzInfo,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bOne.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOne,this),this.bTen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTen,this),this.bChange.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),EventBus.rmListener(EventType.M_JUPD+JsonID.MCJ_CJ_LST,this.updateLst,this),EventBus.rmListener(EventType.M_JUPD+JsonID.MCJ_UPD,this.updateBzInfo,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateCost(),this.updateLst(),this.updateBzInfo()},e.prototype.updateCost=function(){this.tTen.text=this._mc.mcjMgr.cfg.tencost,this.tOne.text=this._mc.mcjMgr.cfg.onecost},e.prototype.updateBzInfo=function(){var t=this._mc.dataMgr.getJData(JsonID.MCJ_UPD).data;this.tCj.text=(t.c||0)+"/"+this._mc.mcjMgr.cfg.rareawardcnt+" draws in the event guarantees Pet Boss rewards."},e.prototype.updateLst=function(){this.cjCon.rotation=0;for(var t=this._mc.dataMgr.getJData(JsonID.MCJ_CJ_LST).data,e=0;8>e;e++){var i=t.uidlst[e+1],s=this["item"+e];if(i){var o=this._mc.mcjMgr.getCjItemData(i.uid);s.setItem({id:o.id,num:o.num}),s.enableTip(!0)}else s.setItem(null)}var n=GmGlobal.getServerTime(),r=t.time+this._mc.mcjMgr.cfg.refreshtime-n;0>=r?this.tChange.text="Switch":CDText.getInstence().addCD(this.tChange,r,"Switch\n","h:m:s","",this.onTimeOut,this)},e.prototype.onTimeOut=function(){this.tChange.text="Switch"},e.prototype.onOne=function(){this.doCj(1)},e.prototype.onTen=function(){this.doCj(10)},e.prototype.onChange=function(){var t=this._mc.dataMgr.getJData(JsonID.MCJ_CJ_LST).data,e=GmGlobal.getServerTime(),i=t.time+this._mc.mcjMgr.cfg.refreshtime-e;i>0?MsgBox.confirm("Spend "+this._mc.mcjMgr.cfg.refreshprice+" Diamonds to change?",this.doChange,null,this):this.doChange()},e.prototype.doChange=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.MCJ_R)},e.prototype.doCj=function(t){var e=this._mc.itemMgr.getItemNum(ItemID.DIAMOND);return e>=(1==t?this._mc.mcjMgr.cfg.onecost:this._mc.mcjMgr.cfg.tencost)?(this.setBtnEnable(!1),this._cjing=!0,void GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.MCJ_CJ,[t],this.onCjRet,this)):void ItemLackTips.instance().diamondTips()},e.prototype.onCjRet=function(t){var e=this,i=[],s=0;for(var o in t){var n=Number(o);s||(s=n);for(var r=this._mc.mcjMgr.getCjItemData(n),h=0;h<t[o];h++)i.push({id:r.id,num:r.num})}this._items=i;var a=this.getIdxByUId(s),l=1800-45*a;egret.Tween.get(e.cjCon).to({rotation:l},3e3,egret.Ease.quartInOut).call(function(){AwardTipView.showAward(i,e.onAwClose,e),e.setBtnEnable(!0),e._cjing=!1},e),egret.Tween.get(e.zpBg).to({rotation:l},3e3,egret.Ease.quartInOut)},e.prototype.onAwClose=function(){this.showItemTips(this._items),this._items=null},e.prototype.showItemTips=function(t){for(var e=0,i=t;e<i.length;e++){var s=i[e];GmGlobal.cc.itemCtl.showGetItemTips(s.id,s.num,0)}},e.prototype.setBtnEnable=function(t){Utils.setBtnEnable(this.bOne,t),Utils.setBtnEnable(this.bTen,t)},e.prototype.getIdxByUId=function(t){var e=this._mc.dataMgr.getJData(JsonID.MCJ_CJ_LST).data;for(var i in e.uidlst)if(e.uidlst[i].uid==t)return Number(i)-1;return 0},e.prototype.onClose=function(){this._cjing||(CmdBus.doCmd(CmdType.C_MCJ_CJ),CmdBus.doCmd(CmdType.O_MCJ))},e.prototype.close=function(){CDText.getInstence().rmCD(this.tChange),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null},e}(UIBase);__reflect(McjCjView.prototype,"McjCjView");var McjController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.MCJ_TSK,this.onTaskUpd,this)}return t.prototype.onTaskUpd=function(t){var e=GmGlobal.mc,i=e.dataMgr.getJData(JsonID.MCJ_TSK).data,s=e.mcjMgr.redDot;s.state=0;for(var o in i){var n=i[o];if(n&&n.sub)for(var r in n.sub)if(1==n.sub[r].state){s.state=1;break}}EventBus.dispatchEvt(EventType.MCJ_TASK)},t}();__reflect(McjController.prototype,"McjController");var McjItemView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)),this.dhBtn.label="Claim",this.ttit.textFlow=TextFormat.parser.parse(this.data.str),3==this.data.state?(this.dhBtn.visible=!1,this.iyld.visible=!0):(this.dhBtn.visible=!0,this.iyld.visible=!1,Utils.setBtnEnable(this.dhBtn,1==this.data.state?!0:!1))},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(McjItemView.prototype,"McjItemView");var McjManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_mcj.json",this.initCfg,this),this.redDot=new RedDot("",null),GmGlobal.mc.muiMgr.regRedDot(ModelID.MCJ,this.redDot)}return t.prototype.initCfg=function(t){this.cfg=t},t.prototype.getCjItemData=function(t){return this.cfg.cj[t]},t}();__reflect(McjManager.prototype,"McjManager");var McjMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.MCJ,CmdType.O_MCJ),CmdBus.adListener(CmdType.O_MCJ,this.onOpenView,this),CmdBus.adListener(CmdType.C_MCJ,this.onCloseView,this),CmdBus.adListener(CmdType.O_MCJ_CJ,this.onShowCj,this),CmdBus.adListener(CmdType.C_MCJ_CJ,this.onCloseCj,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.MCJ_UPD,this.updateIcon,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.updateIcon=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.MCJ_UPD).data,e=t.et||0;e-GmGlobal.getServerTime()>0?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.MCJ,"mui_json.mui_b_mcj"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.MCJ)},t.prototype.onOpenView=function(){this._view||(this._view=new McjView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.onShowCj=function(){this._cjView||(this._cjView=new McjCjView),this._cjView.isShow||this._cjView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseCj=function(){this._cjView&&this._cjView.isShow&&this._cjView.close()},t.prototype.destroy=function(){return this._view?(this._view&&this._view.isDestroy()&&this._cjView&&!this._cjView.isShow&&(this._view.destroy(),this._view=null,this._cjView.destroy(),this._cjView=null),!0):!0},t}();__reflect(McjMediator.prototype,"McjMediator",["IMediator"]);var McjView=function(t){function e(){var e=t.call(this,"McjViewSkin")||this;return e._mc=GmGlobal.mc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="HuntItemSkin",this.itemList.itemRenderer=McjItemView},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bhd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHd,this),EventBus.addListener(EventType.MCJ_TASK,this.updList,this),EventBus.addListener(EventType.M_JUPD+JsonID.MCJ_UPD,this.updateTime,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bhd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHd,this),EventBus.rmListener(EventType.MCJ_TASK,this.updList,this),EventBus.rmListener(EventType.M_JUPD+JsonID.MCJ_UPD,this.updateTime,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updList(),this.updateTime()},e.prototype.updateTime=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.MCJ_UPD).data,e=t.et||0,i=Math.max(e-GmGlobal.getServerTime(),0);i>0?(this.tTime.visible=!0,CDText.getInstence().addCD(this.tTime,i,"Event Countdown: ",i>86400?"DD h:m:s":"h:m:s")):this.tTime.visible=!1},e.prototype.updList=function(){for(var t=this._mc.mcjMgr.cfg.tasks,e=[],i=this._mc.dataMgr.getJData(JsonID.MCJ_TSK).data,s=0;s<t.length;s++)for(var o=t[s],n=i[o.id],r=0;r<o.lst.length;r++){var h=o.lst[r],a=o.des,l=0,c=2,d=n?n.sub[h.id]:null;2==o.id&&n&&(l=n.num),d&&(1==o.id&&(l=d.num||0),1==d.state?c=1:2==d.state&&(c=3)),1==o.id?(a=a.replace("x%",TextFormat.setColor(this._mc.petMgr.getPetQStr(h.nums.X),Utils.getQualityColor(h.nums.X))),a=a.replace("y%",Math.min(l,h.nums.Y)+"/"+h.nums.Y)):a=a.replace("x%",Math.min(l,h.nums.X)+"/"+h.nums.X);var p={tid:o.id,id:h.id,str:a,items:h.items,state:c};e.push(p)}e.sort(function(t,e){return t.state-e.state});for(var r=0;r<e.length;r++)r<this._array.length?this._array.replaceItemAt(e[r],r):this._array.addItem(e[r])},e.prototype.onList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;GmGlobal.cc.dataCtl.doAction(ServerActionId.MCJ_AW,[e.tid,e.id])}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.mcjMgr.cfg.rule)},e.prototype.onHd=function(){this.onClose(),CmdBus.doCmd(CmdType.O_MCJ_CJ)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MCJ)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){this.clearItems(),CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,RES.destroyRes("mcj_bg_jpg"),RES.destroyRes("mcj_json")},e}(UIBase);__reflect(McjView.prototype,"McjView");var LupingController=function(){function t(){this._state=0}return t.prototype.start=function(){this._state=0,startRecorder(this.onRecorder,this)},t.prototype.stop=function(){stopRecorder()},t.prototype.onRecorder=function(t){t>0&&(this._state=1)},t.prototype.hasVideo=function(){return 1==this._state?!0:!1},t.prototype.share=function(t,e){GmGlobal.cc.loginCtl.doHeart();var i=(new Date).getTime();shareRecorder(function(s){var o=(new Date).getTime();5e4>o-i?t&&t.call(e,s):(GmGlobal.cc.loginCtl.doHeart(),setTimeout(function(){t&&t.call(e,s)},1500))},this)},t}();__reflect(LupingController.prototype,"LupingController");var LupingShareView=function(t){function e(){return t.call(this,"LupingShareSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bLp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLp,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bLp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLp,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.mc.giftMgr.getDayConfig(GiftType.LUPING);if(i){var s=i.award[0].id,o=i.award[0].num;this.icon.source=GmGlobal.mc.itemMgr.getItemSicon(s),this.numTxt.text="×"+o}PFConst.HAS_AD&&GmGlobal.cc.pfCtl.pfShowBannerAd()},e.prototype.onLp=function(){GmGlobal.cc.lpCtl.share(this.onShareRet,this)},e.prototype.onShareRet=function(t){1==t?(GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_GIFT,[GiftType.LUPING,0],this.onShareAwOk,this),this.onClose()):(MsgBox.prompt("Failed to share video"),this.onClose())},e.prototype.onShareAwOk=function(){console.log("视频奖励领取成功")},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_LP_SHARE)},e.prototype.close=function(){t.prototype.close.call(this),PFConst.HAS_AD&&GmGlobal.cc.pfCtl.pfCloseBannerAd()},e}(UIBase);__reflect(LupingShareView.prototype,"LupingShareView");var PfReportType;!function(t){t[t.INIT=1]="INIT",t[t.CREATE=2]="CREATE",t[t.LOGIN=3]="LOGIN",t[t.LVUP=4]="LVUP",t[t.TASK_CMPL=5]="TASK_CMPL",t[t.VIP_UP=6]="VIP_UP"}(PfReportType||(PfReportType={}));var PfInitStep;!function(t){t[t.INITGAME=1]="INITGAME",t[t.PFLOGIN=2]="PFLOGIN",t[t.GETSLIST=3]="GETSLIST",t[t.JQ_START=4]="JQ_START",t[t.JQ_LX=5]="JQ_LX",t[t.JQ_SM=6]="JQ_SM",t[t.SHOW_CREATE=7]="SHOW_CREATE",t[t.CREATE=8]="CREATE",t[t.ENTERSCENE=9]="ENTERSCENE"}(PfInitStep||(PfInitStep={}));var PFController=function(){function t(){}return t.prototype.pfInitGame=function(t,e){"undefined"!=typeof pfCommand&&(pfCommand("gameInit",{serverId:t,roleId:e},null,null),this.initPfData())},t.prototype.initPfData=function(){var t="gamecreatetime"+GmGlobal.mc.role.roleId,e=Number(egret.localStorage.getItem(t));(!e||0>e)&&(e=(new Date).getTime(),egret.localStorage.setItem(t,e.toString())),GmGlobal.mc.pfMgr.gameCreateTime=e},t.prototype.pfLogin=function(t,e){"undefined"!=typeof pfCommand&&pfCommand("gameLogin",null,t,e)},t.prototype.pfPay=function(t,e,i,s){if(void 0===e&&(e=1),void 0===i&&(i=null),void 0===s&&(s=ItemID.DIAMOND),"undefined"!=typeof pfCommand){var o=GmGlobal.mc.sceneMgr;return o.mapType==SceneType.FUBEN?void MsgBox.alert("Payment cannot be made in Event"):void pfCommand("gamePay",{itemId:s,money:Math.round(t),name:i,num:e},null,null)}},t.prototype.Pay=function(t,e){if("undefined"!=typeof pfCommand){var i=GmGlobal.mc.sceneMgr;return i.mapType==SceneType.FUBEN?void MsgBox.alert("Payment cannot be made in Event"):void pfCommand("gamePay",{itemId:e,money:Math.round(t),name:this.getZgName(e,t/100)},null,null)}},t.prototype.getZgName=function(t,e){return""},t.prototype.pfInvite=function(t,e){"undefined"==typeof pfCommand},t.prototype.pfShare=function(t,e,i){void 0===i&&(i=null),"undefined"!=typeof pfCommand&&pfCommand("gameShare",i,t,e)},t.prototype.pfLogout=function(){"undefined"!=typeof pfCommand&&pfCommand("pfLoginOut",null,null,null)},t.prototype.pfRestart=function(){"undefined"!=typeof pfCommand&&pfCommand("pfRestart",null,null,null)},t.prototype.pfHasLogout=function(){return"undefined"!=typeof pfCommand?pfCommand("hasLoginOut",null,null,null):void 0},t.prototype.pfReport=function(t){if("undefined"!=typeof pfCommand){this._reportData||(this._reportData={});var e=GmGlobal.mc;if(this._reportData.type=t,t!=PfReportType.INIT){var i=e.role;this._reportData.roleId=i.roleId,this._reportData.name=i.name,this._reportData.serverId=i.serverId,this._reportData.hefuId=i.hefuId,this._reportData.level=i.lv||1,this._reportData.zhanli=e.heroMgr.getAtrValue("z"),this._reportData.vip=e.vip1Mgr.getCurVip(),this._reportData.cz=e.vip1Mgr.getCurExp(),this._reportData.zs=e.itemMgr.getItemNum(ItemID.DIAMOND)}return pfCommand("pfReport",this._reportData,null,null)}},t.prototype.pfReportInitStep=function(t){"undefined"!=typeof pfCommand&&pfCommand("pfReportInit",t,null,null)},t.prototype.showMoreGame=function(){"undefined"!=typeof pfCommand&&pfCommand("showMoreGame",{parent:GmGlobal.vmc.uiLayer},null,null)},t.prototype.showPfKefu=function(){"undefined"!=typeof pfCommand&&pfCommand("showKefu",null,null,null)},t.prototype.bindOpenPayCB=function(){"undefined"!=typeof pfCommand&&pfCommand("bindPayOpenCB",null,this.onOpenPay,this)},t.prototype.onOpenPay=function(){PFConst.IS_NOPAY=!1,EventBus.dispatchEvt(EventType.PAY_OPEN)},t.prototype.pfCheckPay=function(t,e,i){"undefined"!=typeof checkPay?checkPay(t,e,i):e.call(i,!0)},t.prototype.checkMsg=function(t,e){PFConst.CHECK_MSG&&void 0!=checkMsg?checkMsg(t,function(t){0!=t&&MsgBox.prompt("Sensitive word detected"),e(t)}):e(0)},t.prototype.pfViewAd=function(t,e,i){if(void 0===i&&(i=0),"undefined"!=typeof pfCommand){GmGlobal.cc.loginCtl.doHeart();var s=(new Date).getTime();console.log("pfViewAd sTime:"+s),pfCommand("pfViewAd",i,function(i){var o=(new Date).getTime();console.log("pfViewAd eTime:"+o),5e4>o-s?t&&t.call(e,i):(GmGlobal.cc.loginCtl.doHeart(),setTimeout(function(){t&&t.call(e,i)},1500))},this)}},t.prototype.pfShowBannerAd=function(){"undefined"!=typeof showBannerAd&&showBannerAd()},t.prototype.pfCloseBannerAd=function(){"undefined"!=typeof closeBannerAd&&closeBannerAd()},t.prototype.pfGameReport=function(t){"undefined"!=typeof gameReport&&gameReport(t)},t.prototype.pfCmd=function(t,e){void 0===e&&(e=null),"undefined"!=typeof pfCommand&&pfCommand(t,e,null,null)},t}();__reflect(PFController.prototype,"PFController");var PFManager=function(){function t(){}return t}();__reflect(PFManager.prototype,"PFManager");var Rank=function(){function t(t){this.myRank=0,this.rankLen=0,this.cacheTime=-6e5,this.id=t}return t.prototype.updateMyRank=function(t){t!=this.myRank&&(this.myRank=t,this.clearCache())},t.prototype.clearCache=function(){this.cacheTime=-6e5,this.clearDatas()},t.prototype.getFirstData=function(){return this.rankDatas&&this.rankDatas.length>0?this.rankDatas[0]:null},t.prototype.length=function(){return this.rankDatas?this.rankDatas.length:0},t.prototype.getData=function(t){this.rankDatas||(this.rankDatas=[]);for(var e=0,i=this.rankDatas;e<i.length;e++){var s=i[e];if(t==s.roleId)return s}var o=RankData.create();return o.roleId=t,this.rankDatas.push(o),o},t.prototype.getDataIndex=function(t){if(!this.rankDatas)return-1;for(var e=0;e<this.rankDatas.length;e++)if(t==this.rankDatas[e].roleId)return e;return-1},t.prototype.getDataByRank=function(t){if(!this.rankDatas)return null;for(var e=0,i=this.rankDatas;e<i.length;e++){var s=i[e];if(s.rank==t)return s}return null},t.prototype.clearDatas=function(){if(this.rankDatas){for(var t=0,e=this.rankDatas;t<e.length;t++){var i=e[t];RankData.release(i)}this.rankDatas=[],this.rankLen=0}},t}();__reflect(Rank.prototype,"Rank");var RankController=function(){function t(){GmGlobal.server.regUpdCb(MsgID.UPD_RANK_DATA,this.onUpdateRankData,this),GmGlobal.server.regUpdCb(MsgID.UPD_MY_RANK_DATA,this.onUpdateMyRank,this),GmGlobal.server.regUpdCb(MsgID.UPD_ROLE_RANKS,this.onUpdateMyRanks,this)}return t.prototype.onUpdateRankData=function(t){for(var e=t.type,i=GmGlobal.mc.rankMgr.getRank(e),s=t.data,o=(t.bIndex,0);o<s.length;o++){var n=s[o],r=i.getData(n.roleId);r.rank=t.bIndex+1+o,r.name=n.name,r.data=n.data,r.additional=n.additional}var h=(new Date).getTime();h-GmConst.RANK_CACHE_TIME>i.cacheTime&&(i.cacheTime=h)},t.prototype.onUpdateMyRank=function(t){var e=t.type,i=GmGlobal.mc.rankMgr.getRank(e);i.updateMyRank(t.rnkLevel),EventBus.dispatchEvt(EventType.RANK_UPD,e)},t.prototype.onUpdateMyRanks=function(t){for(var e=0,i=t.data;e<i.length;e++){var s=i[e],o=GmGlobal.mc.rankMgr.getRank(s.type);o.updateMyRank(s.rnkLevel)}EventBus.dispatchEvt(EventType.RANK_UPD)},t.prototype.getRankData=function(t,e,i,s,o,n){var r=MsgStruct.getMsg(MsgID.REQ_GET_RANK_DATA);if(!r)return 0;r.type=t,r.bIndex=e,r.num=i;var h=this;return GmGlobal.server.sendMsg(MsgID.REQ_GET_RANK_DATA,r,function(e){if(0!=e.retCode)GmGlobal.mc.txtMgr.showRetCode(e.retCode);else{var i=GmGlobal.mc.rankMgr.getRank(t);if(s&&s.length>0){for(var r=[],a=(new Date).getTime(),l=0;l<i.length();l++){var c=i.rankDatas[l];GmGlobal.mc.rankMgr.hasRoleData(c.roleId,a,s)||r.push(c.roleId)}r.length>0?h.getRoleData(r,i,s,o,n):o&&o.call(n,i)}else o&&o.call(n,i)}})},t.prototype.getRoleData=function(t,e,i,s,o){var n=MsgStruct.getMsg(MsgID.REQ_ROLE_INFO);if(n){n.roleId=t,n.idx=i,GmGlobal.server.sendMsg(MsgID.REQ_ROLE_INFO,n,function(t){for(var n=0;n<t.data.length;n++){var r=t.data[n],h=GmGlobal.mc.rankMgr.getRoleData(r.roleId);h||(h=new RankRoleData,h.roleId=r.roleId,h.serverId=r.serverid,h.name=r.roleName,GmGlobal.mc.rankMgr.setRoleData(h));for(var a=0;a<i.length;a++)h.setAttrValue(i[a],r.data[a]);h.rtime=(new Date).getTime()}s&&s.call(o,e)})}},t.prototype.getRankDataBuyList=function(t,e,i,s,o){var n=MsgStruct.getMsg(MsgID.REQ_RANKING_DATA);if(!n)return 0;n.type=t,n.ranklist=e;var r=this;return GmGlobal.server.sendMsg(MsgID.REQ_RANKING_DATA,n,function(e){if(0!=e.retCode)GmGlobal.mc.txtMgr.showRetCode(e.retCode);else{var n=GmGlobal.mc.rankMgr.getRank(t);n.cacheTime=egret.getTimer();for(var h=0;h<e.data.length;h++){var a=e.data[h],l=n.getData(a.data.roleId);l.rank=a.rank,l.name=a.data.name,l.data=a.data.data}if(i&&i.length>0){for(var c=[],d=(new Date).getTime(),h=0;h<n.length();h++){var l=n.rankDatas[h];GmGlobal.mc.rankMgr.hasRoleData(l.roleId,d,i)||c.push(l.roleId)}c.length>0?r.getRoleData(c,n,i,s,o):s&&s.call(o,n)}else s&&s.call(o,n)}})},t.prototype.getRankDataByRoleList=function(t,e,i,s,o){var n=MsgStruct.getMsg(MsgID.REQ_RANK_DATA);if(!n)return 0;n.type=t,n.serverId=GmGlobal.mc.loginMgr.serverId,n.rolelist=e;var r=this;return GmGlobal.server.sendMsg(MsgID.REQ_RANK_DATA,n,function(e){if(0!=e.retCode)GmGlobal.mc.txtMgr.showRetCode(e.retCode);else{var n=GmGlobal.mc.rankMgr.getRank(t);n.cacheTime=egret.getTimer();for(var h=0;h<e.data.length;h++){var a=e.data[h],l=n.getData(a.data.roleId);l.rank=a.rank,l.name=a.data.name,l.data=a.data.data}if(i&&i.length>0){for(var c=[],d=(new Date).getTime(),h=0;h<n.length();h++){var l=n.rankDatas[h];GmGlobal.mc.rankMgr.hasRoleData(l.roleId,d,i)||c.push(l.roleId)}c.length>0?r.getRoleData(c,n,i,s,o):s&&s.call(o,n)}else s&&s.call(o,n)}})},t.prototype.getRankMaxNum=function(t,e,i){var s=MsgStruct.getMsg(MsgID.REQ_RANK_MAXNUM);if(!s)return 0;s.type=t;return GmGlobal.server.sendMsg(MsgID.REQ_RANK_MAXNUM,s,function(s){e&&e.call(i,t,s.num)})},t}();__reflect(RankController.prototype,"RankController");var RankData=function(){function t(){this.data=0}return t.create=function(){var e=t._pool.pop();return e||(e=new t),e},t.release=function(e){(e||-1==t._pool.indexOf(e))&&(e.additional=0,t._pool.push(e))},t._pool=[],t}();__reflect(RankData.prototype,"RankData");var RankID=function(){function t(){}return t.ZHANLI=1,t.GUILD_JF=34,t.GUILD_JF_MY=35,t.ARENA=4,t.ARENA_JS_RANK=5,t.GUILD_HURT=7,t.MVP_RANK=9,t.PAY=100,t.QIANGHUA=101,t.LEVEL=102,t.PET=103,t.TOWER=104,t.TOUSHI=105,t.XINGZUO=106,t.CHUANBAO=107,t.HUOBAN=108,t.SY_NR=109,t.GUILD_JF_KF=32,t.GUILD_JF_MY_KF=33,t.QD_DDS=501,t.KFQD_DDS=502,t.QD_LHJ=503,t.KFQD_LHJ=504,t.ZLB=600,t.JZT=601,t}();__reflect(RankID.prototype,"RankID");var RankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.rid,e=this.data.data,i=GmGlobal.mc.rankMgr.getRoleData(e.roleId);this.tName.text=e.name,this.tName.textColor=e.roleId==GmGlobal.mc.role.roleId?Colors.GREEN:2383516,i?(2==PFConst.SERVER_TYPE?this.tServer.text="[S"+i.serverId+"]":this.tServer.text="",this.setModel(i.career,i.toushi),t==RankID.ARENA&&(this.tValue.text="Power："+i.zhanli)):(this.tServer.text="",this.clearModel()),e.rank<4?(this.rankBg.visible=!0,this.rankImg.visible=!0,this.rankBg.source="lcom_json.flag_"+e.rank,this.rankImg.source="lcom_json.rank_"+e.rank,this.tRank.visible=!1):(this.rankBg.visible=!1,this.rankImg.visible=!1,this.tRank.visible=!0,this.tRank.text=e.rank.toString()),e.rank<4?this.dzImg.source="lcom_json.dz_"+e.rank:this.dzImg.source="lcom_json.dz_4",t==RankID.LEVEL?this.tValue.text="LV："+e.data:t==RankID.ZHANLI?this.tValue.text="Power："+e.data:t==RankID.PET?this.tValue.text="LV："+e.data:t==RankID.TOWER?this.tValue.text="Highest Floor："+e.data:t==RankID.TOUSHI?this.tValue.text="LV："+e.data:(t==RankID.XINGZUO||t==RankID.CHUANBAO||t==RankID.HUOBAN)&&(this.tValue.text="Total LV："+e.data)},e.prototype.setModel=function(t,e){this._uiRoleView||(this._uiRoleView=new UIRoleModel,this.addChild(this._uiRoleView),this._uiRoleView.x=236,this._uiRoleView.y=141),this._uiRoleView.setInfo(t,e)},e.prototype.clearModel=function(){this._uiRoleView&&(this._uiRoleView.clear(),this.removeChild(this._uiRoleView),this._uiRoleView=null)},e}(eui.ItemRenderer);__reflect(RankItem.prototype,"RankItem");var RankManager=function(){function t(){this._ranks={},this._rankRoles={}}return t.prototype.getRank=function(t){var e=this._ranks[t];return e||(e=new Rank(t),this._ranks[t]=e),e},t.prototype.getRoleData=function(t){return this._rankRoles[t]},t.prototype.hasRoleData=function(t,e,i){void 0===e&&(e=0);var s=this._rankRoles[t];return e||(e=(new Date).getTime()),!s||e-s.rtime>GmConst.RANK_CACHE_TIME?!1:s.hasAttrs(i)},t.prototype.setRoleData=function(t){this._rankRoles[t.roleId]=t},t}();__reflect(RankManager.prototype,"RankManager");var RankMediator=function(){function t(){this._idx=0,GmGlobal.mc.muiMgr.regCmd(ModelID.RANK,CmdType.O_RANK),CmdBus.adListener(CmdType.O_RANK,this.onOpenView,this),CmdBus.adListener(CmdType.C_RANK,this.onCloseView,this)}return t.prototype.onOpenView=function(t){void 0===t&&(t=0),this._idx=t,this.doOpen()},t.prototype.doOpen=function(){this._uiView||(this._uiView=new RankView),this._uiView.isShow||(this._uiView.show(GmGlobal.vmc.uiLayer),this._uiView.selTab(this._idx),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._uiView&&this._uiView.isShow&&this._uiView.close()},t.prototype.destroy=function(){return this._uiView?this._uiView&&this._uiView.isDestroy()?(this._uiView.destroy(),this._uiView=null,!0):!1:!0},t}();__reflect(RankMediator.prototype,"RankMediator",["IMediator"]);var RankRoleData=function(){function t(){this.zhanli=0,this.rtime=0,this.toushi=0}return t.prototype.hasAttrs=function(t){for(var e=0,i=t;e<i.length;e++){var s=i[e];if(!this.getAttrValue(s))return!1}return!0},t.prototype.getAttrValue=function(t){return t==RoleAttrId.LEVEL?this.level:t==RoleAttrId.CAREER?this.career:t==RoleAttrId.GOLD?this.gold:t==RoleAttrId.ZHANLI?this.zhanli:t==RoleAttrId.OFFLINE?this.offline:t==RoleAttrId.TOUSHI?0==this.toushi?!1:!0:0},t.prototype.setAttrValue=function(t,e){t==RoleAttrId.LEVEL?this.level=e:t==RoleAttrId.CAREER?this.career=e:t==RoleAttrId.GOLD?this.gold=e:t==RoleAttrId.ZHANLI?this.zhanli=e:t==RoleAttrId.OFFLINE?this.offline=e:t==RoleAttrId.TOUSHI&&(this.toushi=e||-1)},t}();__reflect(RankRoleData.prototype,"RankRoleData");var RankView=function(t){function e(){var e=t.call(this,"RankViewSkin")||this;return e._item=-1,e._tabIndex=-1,e._sNo=0,e._sNo1=0,e._viewIndex=1,e._reqNum=10,e.MAX_NUM=100,e._needGetData=!1,e._rankIds=[RankID.LEVEL,RankID.ZHANLI,RankID.PET,RankID.TOWER,RankID.ARENA,RankID.TOUSHI,RankID.XINGZUO,RankID.CHUANBAO,RankID.HUOBAN],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="RankItemSkin",this.itemList.itemRenderer=RankItem},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.scoll.addEventListener(eui.UIEvent.CHANGE,this.onScrollChange,this),this.scoll.addEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.scoll.removeEventListener(eui.UIEvent.CHANGE,this.onScrollChange,this),this.scoll.removeEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this)
},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.updPanel()}},e.prototype.updateSelState=function(){for(var t=0;9>t;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.updPanel=function(){this._cid=this.getRankId(),this.updateRankList()},e.prototype.updateRankList=function(){this._viewIndex=1,this.scoll.viewport.scrollV=0,this.scoll.stopAnimation(),this._array.removeAll();var t=GmGlobal.mc.rankMgr.getRank(this._cid),e=(new Date).getTime();e-t.cacheTime>GmConst.RANK_CACHE_TIME&&t.clearDatas(),this.reqRankData()},e.prototype.reqRankData=function(){this.setMyRankInfo();var t=GmGlobal.mc.rankMgr.getRank(this._cid),e=t.length(),i=0;if(i=e+this._reqNum<this.MAX_NUM?this._reqNum:this.MAX_NUM-e,i>0&&e<this._viewIndex+i){var s=0;t.rankDatas&&t.rankDatas.length>0&&(s=t.rankDatas.length);var o=[RoleAttrId.CAREER,RoleAttrId.TOUSHI];this._cid==RankID.ARENA&&o.push(RoleAttrId.ZHANLI),this._sNo=GmGlobal.cc.rankCtl.getRankData(this._cid,s,i,o,this.onRankListUpdate,this),this._viewIndex+=i}else this.onRankListUpdate(t)},e.prototype.onRankListUpdate=function(t){if(this._sNo=0,t.rankDatas&&!(this._array.length>=t.rankDatas.length)){var e=this._array.length,i=!1;0!=e&&e<t.rankDatas.length&&(i=!0);for(var s=0;e>s;s++)this._array.replaceItemAt({rank:s+1,rid:this._cid,data:t.rankDatas[s]},s);for(s;s<t.rankDatas.length;s++)this._array.addItem({rank:s+1,rid:this._cid,data:t.rankDatas[s]});t.rankDatas.length>this._viewIndex&&(this._viewIndex=t.rankDatas.length),i&&(this.scoll.viewport.scrollV=this.scoll.viewport.scrollV+210)}},e.prototype.onScrollChange=function(t){this._viewIndex>=this.MAX_NUM||this.scoll.viewport.scrollV>this.scoll.viewport.contentHeight-this.scoll.viewport.height&&(this._needGetData=!0)},e.prototype.onScrollChangeEnd=function(t){this._needGetData&&(this._needGetData=!1,this.reqRankData())},e.prototype.setMyRankInfo=function(){var t=GmGlobal.mc.rankMgr.getRank(this._cid),e="My Ranking：";0==t.myRank?this.myRank.text=e+"Unranked":this.myRank.text=e+String(t.myRank)},e.prototype.getRankId=function(){return this._tabIndex<this._rankIds.length?this._rankIds[this._tabIndex]:-1},e.prototype.onTouchList=function(t){var e=t.target;if(e.parent.parent==this.itemList){e.parent}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearModel()}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_RANK)},e.prototype.close=function(){0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),0!=this._sNo1&&(GmGlobal.server.clearSerialCallbak(this._sNo1),this._sNo1=0),this._tabIndex=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(RankView.prototype,"RankView");var RoleAttrId=function(){function t(){}return t.LEVEL=1,t.ZHANLI=2,t.CAREER=3,t.GOLD=4,t.OFFLINE=5,t.HP=6,t.ONLINE=7,t.TOUSHI=8,t}();__reflect(RoleAttrId.prototype,"RoleAttrId");var RewardController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD,this.onUpdRwd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD_RC,this.onUpdRc,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD_RC_ONE,this.onUpdOneRc,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD_TZ,this.onUpdTz,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD_TZ_ONE,this.onUpdOneTz,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD_SJ,this.onUpdSj,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_RWD_SJ_ONE,this.onUpdOneSj,this)}return t.prototype.onUpdRwd=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.exp=e.exp||0,i.unlock=e.unlock-1||0,i.lv=e.lv||0,i.jlLst=e.lst||{},i.startTime=e.t,this.updateJlRedDot(),EventBus.dispatchEvt(EventType.M_RWD)},t.prototype.onUpdRc=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.rcInfo=e||{},this.updateRcRedDot(),EventBus.dispatchEvt(EventType.M_RWD_RC)},t.prototype.onUpdOneRc=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.rcInfo[e.id]=e,this.updateRcRedDot(),EventBus.dispatchEvt(EventType.M_RWD_RC)},t.prototype.onUpdTz=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.tzInfo=e.list||{},this.updateTzRedDot(),EventBus.dispatchEvt(EventType.M_RWD_TZ)},t.prototype.onUpdOneTz=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.tzInfo[e.id]=e,this.updateTzRedDot(),EventBus.dispatchEvt(EventType.M_RWD_TZ)},t.prototype.onUpdSj=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.sjInfo=e.list||{},this.updateSjRedDot(),EventBus.dispatchEvt(EventType.M_RWD_SJ)},t.prototype.onUpdOneSj=function(t){var e=t.data.data,i=GmGlobal.mc.rwdMgr;i.sjInfo[e.id]=e,this.updateSjRedDot(),EventBus.dispatchEvt(EventType.M_RWD_SJ)},t.prototype.updateJlRedDot=function(){var t=GmGlobal.mc.rwdMgr.redDot.childs[0];if(t){for(var e=GmGlobal.mc.rwdMgr,i=0,s=0;3>s;s++)if(s<=e.unlock){var o=e.jlLst[s+1]||0;if(o<e.lv){i=1;break}}t.state=i}},t.prototype.updateRcRedDot=function(){var t=GmGlobal.mc.rwdMgr.redDot.childs[1];if(t){var e=GmGlobal.mc.rwdMgr.rcInfo,i=0;for(var s in e){var o=e[s];if(1==o.state){i=1;break}}t.state=i}},t.prototype.updateTzRedDot=function(){var t=GmGlobal.mc.rwdMgr.redDot.childs[2];if(t){var e=GmGlobal.mc.rwdMgr.tzInfo,i=0;for(var s in e){var o=e[s];if(1==o.state){i=1;break}}t.state=i}},t.prototype.updateSjRedDot=function(){var t=GmGlobal.mc.rwdMgr.redDot.childs[3];if(t){var e=GmGlobal.mc.rwdMgr.sjInfo,i=GmGlobal.mc.rwdMgr.sjCfg,s=0;for(var o in i){var n=i[o],r=1,h=e[n.id];h&&(r=h.sub);var a=n.lst[r-1];if(a){var l=GmGlobal.mc.itemMgr.getItemNum(n.sjId),c=a.nums.X;l>=c&&(s=1)}}t.state=s}},t}();__reflect(RewardController.prototype,"RewardController");var RewardItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.index=this.data.index,this.tms.text=this.data.ms,this.data.hNum=Math.min(this.data.hNum,this.data.nNum);var t=this.data.item[0];this.icon.source=GmGlobal.mc.itemMgr.getItemIcon(t.id),this.tnum.text="X"+t.num,this.data.hNum>=this.data.nNum?this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.GREEN)):this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.RED)),0==this.data.state?(this.blq.visible=!0,this.iylq.visible=!1,this.tJd.visible=!0,Utils.setBtnEnable(this.blq,!1),this.blq.label="Incomplete"):1==this.data.state?(this.blq.visible=!0,this.iylq.visible=!1,this.tJd.visible=!0,Utils.setBtnEnable(this.blq,!0),this.blq.label="Claim"):(this.blq.visible=!1,this.tJd.visible=!1,this.iylq.visible=!0)},e}(eui.ItemRenderer);__reflect(RewardItem.prototype,"RewardItem");var RewardjlItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.index;var t=GmGlobal.mc.rwdMgr;this.index<=1?this.line0.visible=!1:this.index>=t.lvCfg.length?this.line1.visible=!1:(this.line0.visible=!0,this.line1.visible=!0),this.tnum.text=this.index.toString();var e=this.data.cfg,i=(e.num,e.awds);this.index<=t.lv?(this.line0.source="reward_json.xsl_line_2",this.line1.source="reward_json.xsl_line_2"):(this.line0.source="reward_json.xsl_line_0",this.line1.source="reward_json.xsl_line_0");for(var s=0;3>s;s++){var o=this["item"+s],n=this["iYqd"+s],r=this["iKl"+s],h=this["tKl"+s];if(o.setItem(i[s]),s<=t.unlock){var a=t.jlLst[s+1]||0;this.index<=a?(n.visible=!0,r.visible=!1,h.visible=!1,o.enableTip(!0)):this.index<=t.lv?(n.visible=!1,r.visible=!0,h.visible=!0,h.text="Claimable",o.enableTip(!1)):(n.visible=!1,r.visible=!1,h.visible=!1,o.enableTip(!0))}else n.visible=!1,r.visible=!1,h.visible=!1,o.enableTip(!0)}},e}(eui.ItemRenderer);__reflect(RewardjlItem.prototype,"RewardjlItem");var RewardManager=function(){function t(){this.rule="",this.exchange=0,this.price=[],this.lvCfg=[],this.startTime=0,this.exp=0,this.lv=0,this.jlLst={},this.rcInfo={},this.tzInfo={},this.sjInfo={},this.unlock=0,GmGlobal.mc.regUnzipCfg("c_reward.json",this.initCfg,this);var t={0:0,1:0,2:0,3:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.XUSHANG,this.redDot)}return t.prototype.initCfg=function(t){this.rcCfg=t.rcCfg,this.tzCfg=t.tzCfg,this.sjCfg=t.sjCfg,this.rule=t.rule,this.exchange=t.exchange,this.price=t.price,this.lvCfg=t.lvCfg},t.prototype.sortLst=function(t){void 0===t&&(t=1);var e=[],i=[],s=[],o=this.rcCfg,n=this.rcInfo;2==t?(o=this.tzCfg,n=this.tzInfo):3==t&&(o=this.sjCfg,n=this.sjInfo);for(var r in o){var h=o[r],a=n[h.id];a&&1==a.state?e.push(h):a&&2==a.state?i.push(h):s.push(h)}return e.concat(s,i)},t.prototype.getKlqIdx=function(){for(var t=0,e=0;3>e;e++)if(e<=this.unlock){var i=this.jlLst[e+1]||0;if(i<this.lv){t=i;break}}return t},t.prototype.sortSjList=function(){var t=[],e=[],i=[],s=this.sjCfg,o=this.sjInfo;for(var n in s){var r=s[n],h=o[r.id],a=1;h&&(a=h.sub);var l=r.lst[a-1];if(l){var c=GmGlobal.mc.itemMgr.getItemNum(r.sjId),d=l.nums.X;c>=d?t.push(r):i.push(r)}else e.push(r)}return t.concat(i,e)},t.prototype.getCdTime=function(){var t=2505600+Utils.getNextDatTime(this.startTime);return t-GmGlobal.getServerTime()},t}();__reflect(RewardManager.prototype,"RewardManager");var RewardMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.XUSHANG,CmdType.O_REWARD),CmdBus.adListener(CmdType.O_REWARD,this.onOpenView,this),CmdBus.adListener(CmdType.C_REWARD,this.onCloseView,this),EventBus.addListener(EventType.M_UPD_CON,this.updateRedDot,this)}return t.prototype.updateRedDot=function(){GmGlobal.cc.rwdCtl.updateSjRedDot()},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new RewardView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(RewardMediator.prototype,"RewardMediator",["IMediator"]);var RewardView=function(t){function e(){var e=t.call(this,"RewardSkin")||this;return e._tabIndex=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.baddlv.sound="ui_jiajian",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this.lpScoll.verticalScrollBar&&(this.lpScoll.verticalScrollBar.autoVisibility=!1),this.lpScoll.horizontalScrollBar&&(this.lpScoll.horizontalScrollBar.autoVisibility=!1),this._jlarray=new eui.ArrayCollection,this.itemList.dataProvider=this._jlarray,this.itemList.itemRendererSkinName="RewardjlItemSkin",this.itemList.itemRenderer=RewardjlItem,this._array=new eui.ArrayCollection,this.lpitemList.dataProvider=this._array,this.lpitemList.itemRendererSkinName="RewardItemSkin",this.lpitemList.itemRenderer=RewardItem,this.tMs.text=this._mc.rwdMgr.rule,this.bbuy0.label="$"+this._mc.rwdMgr.price[0],this.bbuy1.label="$"+this._mc.rwdMgr.price[1],this.initJlItems()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.baddlv.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bbuy0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy0,this),this.bbuy1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy1,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.lpitemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchLpList,this),EventBus.addListener(EventType.M_RWD,this.updJl,this),EventBus.addListener(EventType.M_RWD_RC,this.updLst,this),EventBus.addListener(EventType.M_RWD_TZ,this.updLst,this),EventBus.addListener(EventType.M_RWD_SJ,this.updLst,this),EventBus.addListener(EventType.M_UPD_CON,this.updSjLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.baddlv.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bbuy0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy0,this),this.bbuy1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy1,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.lpitemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchLpList,this),EventBus.rmListener(EventType.M_RWD,this.updJl,this),EventBus.rmListener(EventType.M_RWD_RC,this.updLst,this),EventBus.rmListener(EventType.M_RWD_TZ,this.updLst,this),EventBus.rmListener(EventType.M_RWD_SJ,this.updLst,this),EventBus.rmListener(EventType.M_UPD_CON,this.updSjLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selTab(0),this.alphaShow()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);if(i.source="com_json.tab_ui1",this._tabIndex=t,0==t){this.jlCon.visible=!0,this.lpScoll.visible=!1;var s=this._mc.rwdMgr.getKlqIdx(),o=125*s;o>=125*this._mc.rwdMgr.lvCfg.length-500&&(o=125*this._mc.rwdMgr.lvCfg.length-500),this.scoll.viewport.scrollH=o,this.updJl(),CDText.getInstence().addCD(this.cdTxt,this._mc.rwdMgr.getCdTime(),"Reset countdown：","DD h:m:s","",this.onTimeOut,this)}else CDText.getInstence().rmCD(this.cdTxt),this.jlCon.visible=!1,this.lpScoll.visible=!0,1==t?this._cc.dataCtl.doAction(ServerActionId.RWD_RC_REF):2==t?this._cc.dataCtl.doAction(ServerActionId.RWD_TZ_REF):this.updLst()}},e.prototype.onTimeOut=function(){this.cdTxt.text=""},e.prototype.initJlItems=function(){for(var t=this._mc.rwdMgr.lvCfg,e=0;e<t.length;e++){var i={cfg:t[e],index:e+1};this._jlarray.addItem(i)}},e.prototype.updLst=function(){if(0!=this._tabIndex){if(this.lpScoll.stopAnimation(),this._array.removeAll(),this.lpScoll.viewport.scrollV=0,3==this._tabIndex)return void this.updSjLst();var t=this._mc.rwdMgr.rcInfo;2==this._tabIndex&&(t=this._mc.rwdMgr.tzInfo);for(var e=this._mc.rwdMgr.sortLst(this._tabIndex),i=0;i<e.length;i++){var s=e[i],o={id:s.id,ms:"",item:null,state:0,hNum:0,nNum:0};o.ms=s.describe;var n=1,r=t[s.id];if(r&&(o.state=r.state||0,o.hNum=r.num||0,n=r.sub),1==this._tabIndex)o.item=s.items,o.nNum=s.num,o.ms=o.ms.replace("%x",Utils.formatNum(s.num));else{n>=s.lst.length&&(n=s.lst.length);var h=s.lst[n-1];o.item=h.items,o.nNum=h.nums.X,o.ms=o.ms.replace("%x",Utils.formatNum(h.nums.X))}this._array.addItem(o)}this.updateRedDot()}},e.prototype.updSjLst=function(){if(3==this._tabIndex){for(var t=this._mc.rwdMgr.sjInfo,e=this._mc.rwdMgr.sortSjList(),i=0;i<e.length;i++){var s=e[i],o={id:s.id,ms:"",item:null,state:0,hNum:0,nNum:0};o.ms=s.describe;var n=1,r=t[s.id];r&&(n=r.sub);var h=s.lst[n-1];h?(o.hNum=this._mc.itemMgr.getItemNum(s.sjId),o.nNum=h.nums.X,o.hNum>=o.nNum?o.state=1:o.state=0):(h=s.lst[s.lst.length-1],o.state=2,o.hNum=o.nNum=h.nums.X),o.item=h.items,o.ms=o.ms.replace("%x",Utils.formatNum(h.nums.X)),null!=this._array.getItemAt(i)?this._array.replaceItemAt(o,i):this._array.addItem(o)}this.updateRedDot()}},e.prototype.updJl=function(){var t=this._mc.rwdMgr.lv,e=this._mc.rwdMgr.lvCfg[t];e?(this.barTlv.text="Requires "+(e.num-this._mc.rwdMgr.exp)+" token(s) to unlock next level",Utils.setBtnEnable(this.baddlv,!0)):(e=this._mc.rwdMgr.lvCfg[this._mc.rwdMgr.lvCfg.length-1],this.barTlv.text="Max LV",Utils.setBtnEnable(this.baddlv,!1)),this.barLv.value=this._mc.rwdMgr.exp,this.barLv.maximum=e.num;for(var i=0;i<this._jlarray.length;i++){var s=this._jlarray.getItemAt(i);this._jlarray.itemUpdated(s)}this._mc.rwdMgr.unlock>=2?(this.bbuy0.visible=!1,this.bbuy1.visible=!1):1==this._mc.rwdMgr.unlock?(this.bbuy0.visible=!1,this.bbuy1.visible=!0):(this.bbuy0.visible=!0,this.bbuy1.visible=!0),this.updateRedDot()},e.prototype.onAdd=function(){var t=this._mc.rwdMgr.lv,e=this._mc.rwdMgr.lvCfg[t];if(e){var i=(e.num-this._mc.rwdMgr.exp)*this._mc.rwdMgr.exchange;MsgBox.confirm("Spend "+i+" crystals to reach the next level?",this.addOk,null,this,"Purchase","Cancel")}},e.prototype.onBuy0=function(){this._cc.pfCtl.Pay(100*this._mc.rwdMgr.price[0],2)},e.prototype.onBuy1=function(){this._cc.pfCtl.Pay(100*this._mc.rwdMgr.price[1],2)},e.prototype.addOk=function(){this._cc.dataCtl.doAction(ServerActionId.RWD_UP)},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList){var e=t.target.parent,i=e.data,s=Utils.getNameIndex(t.target.name),o=i.index-1;if(-1!=s){if(s>this._mc.rwdMgr.unlock)return;var n=this._mc.rwdMgr.jlLst[s+1]||0;if(n>o)return;if(o>=this._mc.rwdMgr.lv)return;this._cc.dataCtl.doAction(ServerActionId.RWD_GET,[s+1,o+1])}}},e.prototype.onTouchLpList=function(t){if(t.target.parent.parent==this.lpitemList&&"btn"==t.target.name&&t.target.parent.data){var e=t.target.parent.data,i=ServerActionId.RWD_RC;2==this._tabIndex?i=ServerActionId.RWD_TZ:3==this._tabIndex&&(i=ServerActionId.RWD_SJ),1==e.state&&GmGlobal.cc.dataCtl.doAction(i,[e.id])}},e.prototype.updateRedDot=function(){var t=this._mc.rwdMgr.redDot;if(t.childs)for(var e=0;4>e;e++){var i=t.childs[e],s=this.tableBgCon.getChildAt(e);if(1==i.state){var o=this.tableBgCon.x+110*(e+1)+10*e-20;e>1&&(o+=16),RedDotView.addRedDot(s,this.redDotCon,"rwd",o,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(s)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_REWARD)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,RedDotView.removeRedDotByGroup("rwd"),CDText.getInstence().rmCD(this.cdTxt),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("reward_json"),RES.destroyRes("xsl_bg_jpg")},e}(UIBase);__reflect(RewardView.prototype,"RewardView");var Role=function(){function t(){this.roleId=0,this.name="",this.careerId=0,this.account="",this.serverId=0,this.createTime=0,this.loginTime=0,this.logoutTime=0,this.hefuId=0,this.zhanli=0,this.lv=0,this.exp=0,this.expMax=0,this.chuzhanId=0,this.hp=0,this.hpMax=0,this.sp=0,this.spMax=0,this.toushi=0,this.ch=0,this.halo=0,this.bh=0,this.team=0,this.speed=GmConst.ROLE_SPEED,this.plV=0,this.kfFlag=1}return t.prototype.addHp=function(t){this.hp=this.hp+Math.floor(t),this.hp<0?this.hp=0:this.hp>this.hpMax&&(this.hp=this.hpMax)},t.prototype.getLoginDay=function(){var t=new Date(1e3*this.createTime),e=3600*t.getHours()+60*t.getMinutes()+t.getSeconds(),i=GmGlobal.getServerTime()-this.createTime+e,s=Math.ceil(i/86400);return s},t}();__reflect(Role.prototype,"Role");var RoleController=function(){function t(){this._isInit=!1,this._preLV=0,this._preExp=0,this._preExpMax=0,GmGlobal.server.regUpdCb(MsgID.UPD_RINFO,this.onUpdateRole,this),EventBus.addListener(EventType.M_JUPD+JsonID.ROLE_DATA,this.onRoleJsonData,this)}return t.prototype.onUpdateRole=function(t){var e=GmGlobal.mc.role;e.roleId=Number(t.roleId),e.name=t.roleName,e.careerId=t.careerId,e.account=t.userId,e.serverId=t.platserver,e.createTime=t.createTime,e.loginTime=t.loginTime,e.logoutTime=t.logoutTime,e.hefuId=t.hefuId,GmGlobal.setServerTime(t.serverTime),this._isInit||(this._isInit=!0,GmGlobal.isNewPlayer&&GmGlobal.cc.pfCtl.pfReport(PfReportType.CREATE)),EventBus.dispatchEvt(EventType.M_R_UPD)},t.prototype.onRoleJsonData=function(t){var e=GmGlobal.mc.role,i=t.data.data;if(e.exp=i.exp,e.expMax=i.expMax,e.zhanli=i.z,e.lv=i.level||1,EventBus.dispatchEvt(EventType.M_R_UPD),i.level>this._preLV&&(EventBus.dispatchEvt(EventType.M_RLV_UPD),this._preLV=i.level,GmGlobal.cc.pfCtl.pfReport(PfReportType.LVUP)),0!=this._preExp||0!=this._preExpMax){var s=0;s=i.expMax>this._preExpMax?this._preExpMax-this._preExp+i.exp:i.exp-this._preExp}this._preExp=i.exp,this._preExpMax=i.expMax},t.prototype.getRoleId=function(t,e,i){var s=MsgStruct.getMsg(MsgID.REQ_ROLEID);if(!s)return 0;return s.serverid=t||GmGlobal.mc.loginMgr.gamePlatServer,s.name=e,GmGlobal.server.sendMsg(MsgID.REQ_ROLEID,s,function(t){i&&i(t.roleid)})},t.prototype.rename=function(t,e,i){var s=MsgStruct.getMsg(MsgID.REQ_RNAME);if(s){s.name=t,GmGlobal.server.sendMsg(MsgID.REQ_RNAME,s,function(t){0==t.retCode?e&&e.call(i):27==t.retCode?ItemLackTips.instance().diamondTips():GmGlobal.mc.txtMgr.showRetCode(t.retCode)})}},t.prototype.checkName=function(t,e){PFConst.CHECK_MSG&&void 0!=checkMsg?checkMsg(t,function(t){0!=t&&MsgBox.prompt("Sensitive words found in name"),e(t)}):e(0)},t.prototype.getRoleInfo=function(t,e,i,s){var o=MsgStruct.getMsg(MsgID.REQ_ROLE_INFO);if(!o)return 0;return o.roleId=t,o.idx=e,GmGlobal.server.sendMsg(MsgID.REQ_ROLE_INFO,o,function(t){i&&i.call(s,t.data)})},t}();__reflect(RoleController.prototype,"RoleController");var RuleMediator=function(){function t(){CmdBus.adListener(CmdType.O_RULE,this.onOpenView,this),CmdBus.adListener(CmdType.C_RULE,this.onCloseView,this)}return t.prototype.onOpenView=function(t,e){void 0===e&&(e=0),this._view||(this._view=new RuleView),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer),this._view.setInfo(t,e)},t.prototype.onCloseView=function(){this._view&&this._view.isShow&&this._view.close()},t}();__reflect(RuleMediator.prototype,"RuleMediator");var RuleView=function(t){function e(){return t.call(this,"RuleViewSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.txt.lineSpacing=10,this.txt.wordWrap=!0,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setInfo=function(t,e){void 0===e&&(e=0),this.scoll.viewport.scrollV=0,this.txt.textFlow=TextFormat.parser.parse(this.txt.chackFlowWordWrap(t,this.txt.width)),this.scoll.height=Math.min(this.txt.textHeight+5,900),this.height=Math.max(this.scoll.height,300)+100,this.txtBg.height=this.height-80,this.bClose.y=this.height-25,this.x=(GmGlobal.stageWidth-this.width)/2;var i=(GmGlobal.stageHeight-this.height)/2;this.y=i-400,egret.Tween.get(this).to({y:i},400,egret.Ease.backOut)},e.prototype.onClose=function(t){CmdBus.doCmd(CmdType.C_RULE)},e}(UIBase);__reflect(RuleView.prototype,"RuleView");var AutoReturnTask=function(){function t(){this._timer=0,this.isTrigger=!1}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.trigger=function(){this.isTrigger=!0;var t=GmGlobal.vmc.scene.currenScene;this._pType=t.getLockUnitType(),this._pMap=t.getMapCfg().id},t.prototype.start=function(t,e){this.isTrigger=!1,this._ox=t,this._oy=e,0==this._timer&&(this._timer=egret.setInterval(this.onTime,this,1e3)),EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this)},t.prototype.onTime=function(){if(GmGlobal.vmc.scene.currenScene.isPosChange(this._ox,this._oy))return void this.stop();var t=GmGlobal.mc.role;if(t.hp/t.hpMax>.5){if(this.stop(),this._pType){var e=GmGlobal.mc.npcMgr.getNpcCfg(this._pType);if(e){var i=GmGlobal.mc.sceneMgr;i.lockType=this._pType,i.fx=e.x,i.fy=e.y}}GmGlobal.cc.sceneCtl.reqWildScne(this._pMap),this._pMap=0,this._pType=0}},t.prototype.onEnterScene=function(){var t=GmGlobal.mc.sceneMgr;t.mapType!=SceneType.CITY&&this.stop()},t.prototype.stop=function(){EventBus.rmListener(EventType.ENTER_SCENE,this.onEnterScene,this),0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0)},t}();__reflect(AutoReturnTask.prototype,"AutoReturnTask");var SceneController=function(){function t(){this._reqTime=0;var t=GmGlobal.cc.dataCtl,e=GmGlobal.server;t.regPbCb(PbMsgId.PRELOAD_SCENE,this.onPreloadSc,this),t.regPbCb(PbMsgId.KILLAWARD,this.onSkillAward,this),t.regPbCb(PbMsgId.UNIT_SP,this.onUnitSp,this),t.regPbCb(PbMsgId.UNIT_HP,this.onUnitHp,this),t.regPbCb(PbMsgId.BUFF_ICON,this.onBuffIcon,this),t.regPbCb(PbMsgId.BATTLE_RANK,this.onBattleRank,this),t.regPbCb(PbMsgId.SCORE_RANK,this.onScoreRank,this),t.regPbCb(PbMsgId.SKILL_CD,this.onSkillCd,this),e.regUpdCb(MsgID.ENTER_SCENE,this.onEnterSc,this),e.regUpdCb(MsgID.UNIT_ENTER,this.onUnitEnter,this),e.regUpdCb(MsgID.UNIT_LEAVE,this.onUnitExit,this),e.regUpdCb(MsgID.UNIT_WALK,this.onUnitMove,this),e.regUpdCb(MsgID.UNIT_STAND,this.onRoleStand,this),e.regUpdCb(MsgID.UNIT_DEAD,this.onUnitDaed,this),e.regUpdCb(MsgID.UNIT_ATTACK,this.onUnitAtc,this),e.regUpdCb(MsgID.UNIT_SKILL,this.onUnitSkill,this),e.regUpdCb(MsgID.UNIT_EFFECT,this.onUnitEffect,this),e.regUpdCb(MsgID.BATTLE_SB,this.onBattleSb,this),e.regUpdCb(MsgID.BATTLE_S_HURT,this.onBattleSkillHurt,this),e.regUpdCb(MsgID.BATTLE_N_HURT,this.onBattleNormalHurt,this),e.regUpdCb(MsgID.BATTLE_FT_HURT,this.onBattleFjHurt,this),e.regUpdCb(MsgID.UNIT_SPEED,this.onSpeed,this),EventBus.addListener(EventType.S_CLOSE,this.onSocketClose,this),EventBus.addListener(EventType.S_HP_CH,this.onHpChange,this)}return t.prototype.onSocketClose=function(){var t=GmGlobal.mc.sceneMgr;t.buffIcons=null,EventBus.dispatchEvt(EventType.BUFF_CLEAR)},t.prototype.setCurrentScene=function(t){this._sceneView=t},t.prototype.clearSceneView=function(){this._sceneView=null},t.prototype.onPreloadSc=function(t){GmGlobal.IS_DEBUG&&console.log("scene pre load:"+t.mapId),CmdBus.doCmd(CmdType.PLOAD_CS,t.mapId)},t.prototype.onEnterSc=function(t){var e=GmGlobal.mc.sceneMgr;e.clearUnits();var i=0;e.mapId&&e.mapId!=t.mapid&&(i=e.mapId),e.mapId=t.mapid,e.sceneId=t.sceneid,e.mapType=GmGlobal.mc.mapMgr.getMapType(t.mapid),e.eX=t.x,e.eY=t.y,e.eDir=t.direct,t.arg&&(t.arg=JSON.parse(t.arg));var s=GmGlobal.mc.role;s.toushi=t.arg.ts,s.halo=t.arg.gh,s.hp=t.arg.hp,s.hpMax=t.arg.hpmax,s.sp=t.arg.sp,s.team=t.arg.team||0,s.gonghui=t.arg.gname,s.ch=t.arg.ch,s.bh=t.arg.fhz,CmdBus.doCmd(CmdType.ENTER_CS,t.mapid,i),EventBus.dispatchEvt(EventType.S_HP_CH),EventBus.dispatchEvt(EventType.S_SP_CH)},t.prototype.onUnitEnter=function(t){var e=GmGlobal.mc.sceneMgr;if(t.sceneid==e.sceneId){for(var i in t.unit){var s=t.unit[i];s.arg&&(s.arg=JSON.parse(s.arg))}if(this._sceneView)this._sceneView.unitEnter(t.unit);else for(var o=0,n=t.unit;o<n.length;o++){var r=n[o];r.type==UnitType.MONSTER?e.monsters[r.uid]=r:r.type==UnitType.ROLE?e.othRoles[r.uid]=r:r.type==UnitType.PET?e.pets[r.uid]=r:r.type==UnitType.HUOBAN?e.hbs[r.uid]=r:r.type==UnitType.BOX?e.boxs[r.uid]=r:r.type==UnitType.TOWER&&(e.towers[r.uid]=r)}}},t.prototype.onUnitExit=function(t){var e=GmGlobal.mc.sceneMgr;if(t.sceneid==e.sceneId)if(this._sceneView)this._sceneView.unitExit(t.uid);else for(var i=0;i<t.uid.length;i+=2){var s=t.uid[i],o=t.uid[i+1];o==UnitType.ROLE?delete e.othRoles[s]:o==UnitType.MONSTER?delete e.monsters[s]:o==UnitType.PET?delete e.pets[s]:o==UnitType.HUOBAN?delete e.hbs[s]:o==UnitType.BOX&&delete e.boxs[s]}},t.prototype.onUnitMove=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&this._sceneView&&(this._sceneView.unitMove(t),4==t.type&&console.log("moveing id:"+t.uid+" t:"+egret.getTimer()))},t.prototype.onRoleStand=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&this._sceneView&&this._sceneView.unitStand(t)},t.prototype.onUnitAtc=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&(t.atk=JSON.parse(t.atk),this._sceneView&&this._sceneView.onUnitAttack(t))},t.prototype.onUnitSkill=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&(t.atk=JSON.parse(t.atk),this._sceneView&&this._sceneView.onUnitSkill(t))},t.prototype.onUnitDaed=function(t){var e=GmGlobal.mc.sceneMgr;if(t.sceneid==e.sceneId)if(this._sceneView)this._sceneView.unitDead(t.uid);else for(var i=0;i<t.uid.length;i+=2){var s=t.uid[i],o=t.uid[i+1];o==UnitType.ROLE?delete e.othRoles[s]:o==UnitType.MONSTER?delete e.monsters[s]:o==UnitType.PET?delete e.pets[s]:o==UnitType.HUOBAN&&delete e.hbs[s]}},t.prototype.onUnitEffect=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&(t.effect=JSON.parse(t.effect),this._sceneView&&this._sceneView.unitUpdateData(t))},t.prototype.onBattleSb=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&this._sceneView&&this._sceneView.battleSb(t)},t.prototype.onBattleSkillHurt=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&this._sceneView&&this._sceneView.battleSkillHurt(t)},t.prototype.onBattleNormalHurt=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&this._sceneView&&this._sceneView.battleNormalHurt(t)},t.prototype.onBattleFjHurt=function(t){var e=GmGlobal.mc.sceneMgr;t.sceneid==e.sceneId&&this._sceneView&&this._sceneView.battleFjHurt(t)},t.prototype.onSkillAward=function(t){this._sceneView&&this._sceneView.killAward(t)},t.prototype.onUnitSp=function(t){var e=GmGlobal.mc.role;e.sp=t.sp,EventBus.dispatchEvt(EventType.S_SP_CH),t.cd&&CmdBus.doCmd(CmdType.BATTLE_USE_SKILL,t.skill,t.cd)},t.prototype.onBuffIcon=function(t){var e=GmGlobal.mc.sceneMgr;if(e.buffIcons||(e.buffIcons={}),e.buffIcons[t.id]){var i=e.buffIcons[t.id];i.setTime(t.t)}else e.buffIcons[t.id]=new GameTime(t.t);EventBus.dispatchEvt(EventType.BUFF_ICON,t.id)},t.prototype.onUnitHp=function(t){var e=GmGlobal.mc.role,i=t.hp-e.hp;e.hp=t.hp,this._sceneView&&this._sceneView.updateRoleHp(t.hp),EventBus.dispatchEvt(EventType.S_HP_CH,i>0?i:null)},t.prototype.roleHpUpd=function(t){this._sceneView&&this._sceneView.updateRoleHp(t)},t.prototype.onHpChange=function(t){t.data&&this._sceneView&&this._sceneView.hpAddEffect(t.data)},t.prototype.onSpeed=function(t){console.log("onSpeed: "+t.speed);var e=GmGlobal.mc.role;e.speed=t.speed,this._sceneView&&this._sceneView.updateRoleSpeed(t.speed)},t.prototype.onBattleRank=function(t){var e=GmGlobal.mc.sceneMgr;t.scene==e.sceneId&&BattleRankView.getInstance().updateHpData(t)},t.prototype.onScoreRank=function(t){var e=GmGlobal.mc.sceneMgr;t.scene==e.sceneId&&BattleRankView.getInstance().updateSData(t)},t.prototype.onSkillCd=function(t){var e=GmGlobal.mc.sceneMgr;e.cdRate=t.cdrate||1,e.spRate=t.sprate||1},t.prototype.reqWildScne=function(t){GmGlobal.cc.dataCtl.doAction(ServerActionId.T_SCENE,[t],this.onTransitionOk,this)},t.prototype.reqGoBackCity=function(){var t=GmGlobal.mc,e=t.mapMgr.getCityMap();e&&GmGlobal.cc.dataCtl.doAction(ServerActionId.T_SCENE,[e.id,t.sceneMgr.tpX-100,t.sceneMgr.tpY,5],this.onTransitionOk,this)},t.prototype.onTransitionOk=function(t){},t.prototype.reqExitScene=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),GmGlobal.cc.dataCtl.pbReq(PbReqId.EXIT_SCENE,null,null,t,e)},t.prototype.checkReqInterval=function(){var t=egret.getTimer();return t-this._reqTime<100?!1:(this._reqTime=t,!0)},t.prototype.reqSceneMove=function(t,e,i,s,o){if(void 0===o&&(o=!0),o&&!this.checkReqInterval())return!1;var n=[Math.round(t),Math.round(e),s];return i&&(n=n.concat(i)),GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_WALK,n),!0},t.prototype.reqAiSceneMove=function(t,e,i,s,o){var n=[Math.round(e),Math.round(i),o];s&&(n=n.concat(s)),console.log("reqAiSceneMove"),GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_WALK,n,{ai:t})},t.prototype.reqUnitAttack=function(t,e,i,s){this.checkReqInterval()&&GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_ATTACK,[Math.round(t),Math.round(e),i,s])
},t.prototype.reqAiAttack=function(t,e,i,s,o){GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_ATTACK,[Math.round(e),Math.round(i),s,o],{ai:t})},t.prototype.reqUnitSkill=function(t,e,i,s,o){this.checkReqInterval()&&GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_SKILL,[Math.round(t),Math.round(e),i,s,o])},t.prototype.reqAiAkill=function(t,e,i,s,o,n){GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_SKILL,[Math.round(e),Math.round(i),s,o,n],{ai:t})},t.prototype.reqUnitStand=function(t,e,i){GmGlobal.cc.dataCtl.pbReq(PbReqId.UNIT_STAND,[Math.round(t),Math.round(e),i])},t.prototype.reqPetMove=function(t,e,i,s){var o=[Math.round(t),Math.round(e),s];i&&(o=o.concat(i)),GmGlobal.cc.dataCtl.pbReq(PbReqId.PET_WALK,o)},t.prototype.reqPetStand=function(t,e,i){GmGlobal.cc.dataCtl.pbReq(PbReqId.PET_STAND,[Math.round(t),Math.round(e),i])},t.prototype.reqPetAttack=function(t,e,i,s){this.checkReqInterval()&&GmGlobal.cc.dataCtl.pbReq(PbReqId.PET_ATTACK,[Math.round(t),Math.round(e),i,s])},t}();__reflect(SceneController.prototype,"SceneController");var SceneType=function(){function t(){}return t.CITY=1,t.WILD=2,t.FUBEN=3,t.GUIDE_MVP=4,t}();__reflect(SceneType.prototype,"SceneType");var SceneManager=function(){function t(){this.lockType=0,this.fx=0,this.fy=0,this.cdRate=1,this.spRate=1,this.isAutoAI=!0,this.othRoles={},this.monsters={},this.pets={},this.hbs={},this.boxs={},this.towers={},GmGlobal.mc.regUnzipCfg("c_tsmodel.json",this.initTsCfg,this)}return t.prototype.initTsCfg=function(t){this._tsCfg=t},t.prototype.getTsRes=function(t,e){var i=this._tsCfg[t];return i?i[e]:null},t.prototype.pushSelIcon=function(t,e){this.selIcons||(this.selIcons={}),this.selIcons[t]=e},t.prototype.clearUnits=function(){this.othRoles={},this.monsters={},this.pets={},this.hbs={},this.boxs={}},t}();__reflect(SceneManager.prototype,"SceneManager");var SceneMediator=function(){function t(){this._isReady=!1,this._preMapId=0,this._preLockType=0}return t.prototype.init=function(){EventBus.addListener(EventType.GAME_READY,this.onReady,this),EventBus.addListener(EventType.S_CLOSE,this.onSocketClose,this),EventBus.addListener(EventType.S_RECONNECT,this.onReConnect,this),CmdBus.adListener(CmdType.PLOAD_CS,this.preloadSscne,this),CmdBus.adListener(CmdType.ENTER_CS,this.enterScene,this),CmdBus.adListener(CmdType.O_MAPSEL,this.showMapSel,this),CmdBus.adListener(CmdType.C_MAPSEL,this.closeMapSel,this),CmdBus.adListener(CmdType.O_MVP_AW,this.showMvpAw,this),CmdBus.adListener(CmdType.C_MVP_AW,this.closeMvpAw,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_MPV_AW,this.onMvpAw,this)},t.prototype.onReady=function(){EventBus.rmListener(EventType.GAME_READY,this.onReady,this),this._isReady=!0},t.prototype.onSocketClose=function(){this.currenScene&&this.currenScene.getSceneType()==SceneType.WILD&&(this._preLockType=this.currenScene.getLockUnitType(),this._preMapId=this.currenScene.getMapCfg().id)},t.prototype.onReConnect=function(){},t.prototype.preloadSscne=function(t){var e=SceneResPreLoad.getInstence();e.show(),t==FubenType.ARENA&&CmdBus.doCmd(CmdType.C_WANFA),e.start(t,this.onPreloaded,this)},t.prototype.onPreloaded=function(t,e){this._preloadMap=t.id,this._preloadTexture=e,console.log("scene pre load: onPreloaded"),GmGlobal.cc.dataCtl.doAction(ServerActionId.REQ_ENTER_S,[t.id],this.onPreloadReqOk,this)},t.prototype.onPreloadReqOk=function(){console.log("scene pre load: doActionOk "+ServerActionId.REQ_ENTER_S+" t:"+egret.getTimer())},t.prototype.enterScene=function(t,e){if(t==FubenType.ARENA&&CmdBus.doCmd(CmdType.C_WANFA),console.log("enterScene mid:"+t+" preid:"+e+" t:"+egret.getTimer()),this._preloadMap==t){e&&EventBus.dispatchEvt(EventType.LEAVE_SCENE,{pid:e,cid:t}),this.clearScene();var i=GmGlobal.mc.mapMgr.getMapCfg(t);this.onSceneLoaded(i,this._preloadTexture),this._preloadMap=0,this._preloadTexture=null}else{var s=SceneResPreLoad.getInstence();s.show(),e&&EventBus.dispatchEvt(EventType.LEAVE_SCENE,{pid:e,cid:t}),s.start(t,this.onSceneLoaded,this),this.clearScene()}},t.prototype.onSceneLoaded=function(t,e){if(t){if(t.id==FubenType.ARENA?AutoRecover.getInstance().stop():AutoRecover.getInstance().start(),t.id==FubenType.YABIAO_Y||t.id==FubenType.YABIAO_J){var i=new YBSceneView;this.currenScene=i,i.init(),i.initScene(t,e),i.inited()}else if(t.id==FubenType.ARENA||t.id==FubenType.DAOC){var s=new PVPSceneView;this.currenScene=s,s.init(),s.initScene(t,e),s.inited()}else if(t.id==FubenType.MAOMAO){var o=new MMSceneView;this.currenScene=o,o.init(),o.initScene(t,e),o.inited()}else if(t.id==FubenType.JZTXB){var n=new JZTSceneView;this.currenScene=n,n.init(),n.initScene(t,e),n.inited()}else this.currenScene=new SceneView,this.currenScene.init(),this.currenScene.initScene(t,e),this.currenScene.inited();this.currenMapView=this.currenScene,GmGlobal.cc.sceneCtl.setCurrentScene(this.currenScene),EventBus.dispatchEvt(EventType.ENTER_SCENE),t.type==SceneType.CITY||FubenType.isNoFightFb(t.id)||(t.id==FubenType.MAOMAO?this.currenScene.startAutoAttack(FubenType.isPvpFuben(t.id),!1):this.currenScene.startAutoAttack(FubenType.isPvpFuben(t.id))),t.type==SceneType.WILD?(GmGlobal.cc.itemCtl.bindItemCallback(ItemID.JIAZI,this.onJiaziItemUpdate,this),this.onJiaziItemUpdate()):CmdBus.doCmd(CmdType.S_ZHUABU,!1,0,t.id),this.currenScene.checkGuide(),console.log("onSceneLoaded ****");var r=SceneResPreLoad.getInstence();if(r.loadingView&&r.loadingView.isShow?(console.log("delay close loading view"),setTimeout(function(){r.isCanClose(t.id)&&r.close()},100)):r.close(),this._preMapId){var h=this;setTimeout(function(){var t=GmGlobal.mc.mapMgr.getMapCfg(h._preMapId);if(t.type==SceneType.WILD){if(h._preLockType){var e=GmGlobal.mc.npcMgr.getNpcCfg(h._preLockType);if(e){var i=GmGlobal.mc.sceneMgr;i.lockType=h._preLockType,i.fx=e.x,i.fy=e.y}}GmGlobal.cc.sceneCtl.reqWildScne(h._preMapId)}h._preMapId=0,h._preLockType=0},1e3)}}},t.prototype.onJiaziItemUpdate=function(){var t=GmGlobal.mc.itemMgr.getItemNum(ItemID.JIAZI);CmdBus.doCmd(CmdType.S_ZHUABU,!0,t)},t.prototype.clearScene=function(){this.currenScene&&(this.currenScene.getSceneType()==SceneType.WILD?(GmGlobal.cc.itemCtl.removeItemCallback(ItemID.JIAZI,this.onJiaziItemUpdate,this),BattleRankView.getInstance().close()):this.currenScene.getSceneType()==SceneType.FUBEN&&BattleRankView.getInstance().close(),this.currenScene.clear(),this.currenScene=null,this.currenMapView=null,GmGlobal.cc.sceneCtl.clearSceneView())},t.prototype.showMapSel=function(){this._mapSelView||(this._mapSelView=new MapSelView),this._mapSelView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeMapSel=function(){this._mapSelView&&(this._mapSelView.alphaClose(this._mapSelView.closeAndDestroy,this._mapSelView),this._mapSelView=null)},t.prototype.onMvpAw=function(t){this.showMvpAw(t.data.data)},t.prototype.showMvpAw=function(t){this._mvpAw||(this._mvpAw=new BattleMVPWinView),this._mvpAw.isShow||this._mvpAw.show(GmGlobal.vmc.uiLayer),this._mvpAw.updateList(t)},t.prototype.closeMvpAw=function(){this._mvpAw&&this._mvpAw.close()},t}();__reflect(SceneMediator.prototype,"SceneMediator");var ActionState=function(){function t(){}return t.initState=function(){var e={},i={};i[ActionType.STAND]=ActionType.STAND,i[ActionType.STAND_TO]=ActionType.STAND_TO,i[ActionType.RUN]=ActionType.RUN,i[ActionType.ATTACK]=ActionType.ATTACK,i[ActionType.SKILL]=ActionType.SKILL,i[ActionType.DEAD]=ActionType.DEAD,e[ActionType.STAND]=i;var s={};s[ActionType.STAND]=ActionType.STAND,s[ActionType.STAND_TO]=ActionType.STAND_TO,s[ActionType.RUN]=ActionType.RUN,s[ActionType.ATTACK]=ActionType.ATTACK,s[ActionType.SKILL]=ActionType.SKILL,s[ActionType.DEAD]=ActionType.DEAD,e[ActionType.STAND_TO]=s;var o={};o[ActionType.STAND]=ActionType.STAND,o[ActionType.STAND_TO]=ActionType.STAND_TO,o[ActionType.RUN]=ActionType.RUN,o[ActionType.ATTACK]=ActionType.ATTACK,o[ActionType.SKILL]=ActionType.SKILL,o[ActionType.DEAD]=ActionType.DEAD,e[ActionType.RUN]=o;var n={};n[ActionType.DEAD]=ActionType.DEAD,n[ActionType.SKILL]=ActionType.SKILL,e[ActionType.ATTACK]=n,e[ActionType.SKILL]={},e[ActionType.SKILL][ActionType.DEAD]=ActionType.DEAD,t._states=e},t.hasAction=function(e,i){var s=t._states[e];return s&&s[i]?!0:!1},t}();__reflect(ActionState.prototype,"ActionState");var ActionType=function(){function t(){}return t.STAND=1,t.RUN=2,t.ATTACK=3,t.SKILL=4,t.STAND_TO=5,t.DEAD=6,t}();__reflect(ActionType.prototype,"ActionType");var PetAAttackState=function(t){function e(){var e=t.call(this)||this;return e.type=AIStateType.ATTACK,e._aPoint=new egret.Point,e}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&-1==this._pool.indexOf(t)&&this._pool.push(t)},e.prototype.excute=function(t,e){var i=this;if(!t.lockView||t.lockView.isDead||Utils.distence(t.master.point.x,t.master.point.y,t.lockView.point.x,t.lockView.point.y)>t.findRange)return t.lockView=null,void t.stopDAttack();if(t.isMove)return void(Utils.distence(t.tox,t.toy,t.master.point.x,t.master.point.y)>t.findRange&&t.reqStand());if(!(t.attackData.skillId>0))if(Utils.distence(t.point.x,t.point.y,t.lockView.point.x,t.lockView.point.y)<=t.aDis)i.checkSkillAttack()||t.attackData.skillId<0&&GmGlobal.cc.sceneCtl.reqPetAttack(t.point.x,t.point.y,t.lockView.uid,t.lockView.type);else{var s=GmGlobal.vmc.scene.currenScene;s.updateAttackPoint(t.point,t.lockView.point,t.aDis,this._aPoint),s.petMoveToPath(t,i._aPoint.x,this._aPoint.y)}},e.prototype.checkSkillAttack=function(){return!1},e.prototype.release=function(){e.release(this)},e._pool=[],e}(PetAIState);__reflect(PetAAttackState.prototype,"PetAAttackState");var FilterUtils=function(){function t(){}return t.disabled=function(){return[t.getDisabledFilter()]},t.getDisabledFilter=function(){var t=[.3,.4,0,0,0,.3,.4,0,0,0,.3,.4,0,0,0,0,0,0,1,0];return new egret.ColorMatrixFilter(t)},t.createBrightnessFilter=function(t){return new egret.ColorMatrixFilter([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0])},t.seleteFilter=function(){return[new egret.GlowFilter(16764230,.8,10,10,6)]},t.seleteFilter2=function(){return[new egret.GlowFilter(16711680,.8,10,10,6)]},t.seleteFilter3=function(){return[new egret.GlowFilter(16774656,1,10,10,8)]},t}();__reflect(FilterUtils.prototype,"FilterUtils");var PetDAttackState=function(t){function e(){var e=t.call(this)||this;return e._lockType=0,e._lockId=0,e.type=AIStateType.ATTACK,e._aPoint=new egret.Point,e}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&-1==this._pool.indexOf(t)&&this._pool.push(t)},e.prototype.excute=function(t,e){var i=t.master.lockedView;if(!i||i.isDead)return t.attackData.skillId=-1,this._lockId=0,void(this._lockType=0);if((this._lockId!=i.uid||this._lockType!=i.typeId)&&(this._lockId=i.uid,this._lockType=i.typeId,t.attackData.skillId=-1),!(t.isMove||t.attackData.skillId>0))if(Utils.distence(t.point.x,t.point.y,i.point.x,i.point.y)<=t.aDis)t.attackData.skillId<0&&GmGlobal.cc.sceneCtl.reqPetAttack(t.point.x,t.point.y,i.uid,i.type);else{var s=GmGlobal.vmc.scene.currenScene;s.updateAttackPoint(t.point,i.point,t.aDis,this._aPoint),s.petMoveToPath(t,this._aPoint.x,this._aPoint.y)}},e.prototype.checkSkillAttack=function(){return!1},e.prototype.release=function(){this._lockId=0,this._lockType=0,e.release(this)},e._pool=[],e}(PetAIState);__reflect(PetDAttackState.prototype,"PetDAttackState");var PetFollowState=function(t){function e(){var e=t.call(this)||this;return e._checkInterval=0,e.type=AIStateType.FOLLOW,e}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&-1==this._pool.indexOf(t)&&this._pool.push(t)},e.prototype.excute=function(t,e){if(!(Utils.distence(t.point.x,t.point.y,t.master.x,t.master.y)<t.hangRang))if(this._checkInterval=0,this._checkInterval<=0){this._checkInterval=2;var i=t.master.tox,s=t.master.toy;if(t.master.mPath&&t.master.mPath.length>0){var o=t.master.mPath.length;i=t.master.mPath[o-2],s=t.master.mPath[o-1]}if(t.isMove)if(t.mPath&&t.mPath.length>0){var o=t.mPath.length;if(i==t.mPath[o-2]&&s==t.mPath[o-1])return}else if(i==t.tox&&s==t.toy)return;if(Utils.distence(t.point.x,t.point.y,i,s)<Utils.distence(t.master.point.x,t.master.point.y,i,s))return void t.reqStand();var n=GmGlobal.vmc.scene.currenScene;n.petMoveToPath(t,i,s)}else this._checkInterval-=e},e.prototype.release=function(){this._checkInterval=0,e.release(this)},e._pool=[],e}(PetAIState);__reflect(PetFollowState.prototype,"PetFollowState");var PetHangState=function(t){function e(){var e=t.call(this)||this;return e._standTime=0,e.type=AIStateType.HANG,e}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&-1==this._pool.indexOf(t)&&this._pool.push(t)},e.prototype.excute=function(t,e){t.isMove?Utils.distence(t.tox,t.toy,t.master.point.x,t.master.point.y)<50&&t.reqStand():t.action==ActionType.STAND||t.action==ActionType.STAND_TO?(Utils.distence(t.point.x,t.point.y,t.master.point.x,t.master.point.y)>t.hangRang&&(this._standTime=1e-6),this._standTime>0?(this._standTime-=e,this._standTime<=0&&this.moveRandomPos(t)):this._standTime=Utils.random(20,30)):t.reqStand()},e.prototype.moveRandomPos=function(t){var e=Utils.random(Math.floor(t.hangRang/2),t.hangRang),i=Utils.random(0,360)*Math.PI/180,s=Math.floor(e*Math.cos(i)),o=Math.floor(e*Math.sin(i)),n=GmGlobal.vmc.scene.currenScene;n.petMoveToPath(t,t.master.point.x+s,t.master.point.y+o)},e.prototype.release=function(){this._standTime=0,e.release(this)},e._pool=[],e}(PetAIState);__reflect(PetHangState.prototype,"PetHangState");var AutoAttackAI=function(){function t(t,e,i){this.lockType=0,this.isPvp=!1,this.isAutoTarget=!0,this.mToX=0,this.mToY=0,this._preSkill=0,this._unitView=t,this._monsters=e,this._roles=i}return t.prototype.start=function(){GameTick.instence().setInterval(.5,this.onTime,this)},t.prototype.stop=function(){GameTick.instence().clearInterval(this.onTime,this)},t.prototype.onTime=function(t){var e=this;if(!e.isAutoTarget&&!e._unitView.lockedView)return void(e._unitView.attackData.skillId>=0&&e._unitView.stopNormalAttack());if(!e._unitView.isMove&&!e._unitView.isDead){var i=GmGlobal.vmc.scene.currenScene;if((GmGlobal.mc.sceneMgr.isAutoAI||this.isPvp)&&!e._unitView.lockedView){var s=void 0;if(s=i.getMapCfg().id==FubenType.CT_PT?e.getMinIdMonster():e.getNaerMonster(this.lockType),!s)if(i.getSceneType()==SceneType.WILD||i.getSceneType()==SceneType.GUIDE_MVP){if(s=e.getNaerMonster(0),s&&this.lockType){var o=GmGlobal.mc.npcMgr.getNpcCfg(this.lockType);if(o.x&&o.y&&Utils.distence(s.point.x,s.point.y,o.x,o.y)>360)return void i.moveToPoint(o.x,o.y,!1)}}else s=i.getNearestFightView(this._unitView.team,this._unitView.point.x,this._unitView.point.y,this._unitView.unitData.bh);if(!s)return void this.findMove();i.selTarget(s,!1)}var n=e._unitView.lockedView;return!n||n.isDead?void i.unlockView():void(e._unitView.attackData.skillId>0||this.mToX&&this.mToY&&Utils.distence(this._unitView.point.x,this._unitView.point.y,this.mToX,this.mToY)<40&&(this.mToX=0,this.mToY=0,i.unlockView(),i.moveToPoint(this.mToX,this.mToY,!1))||e.useSkill()||(this._preSkill=0,i.checkDisAndAttack()))}},t.prototype.checkMoveTo=function(){this.mToX&&this.mToY&&Utils.distence(this._unitView.point.x,this._unitView.point.y,this.mToX,this.mToY)<40&&(this.mToX=0,this.mToY=0)},t.prototype.clearMoveTo=function(){this.mToX=0,this.mToY=0},t.prototype.findMove=function(){var t=GmGlobal.mc.sceneMgr,e=GmGlobal.vmc.scene.currenScene;if(t.mapId==FubenType.GH_BOSS){var i=0,s=Math.floor(e.blockMap.mapData.width/2);i=this._unitView.x<s?Math.min(this._unitView.point.x+360,s):Math.max(this._unitView.point.x-360,s),e.moveToPoint(i,this._unitView.point.y)}},t.prototype.useSkill=function(){var t=BattleSkillPanle.getInstence().getFreeSkill();return t?t==this._preSkill?(this._preSkill=0,!0):GmGlobal.vmc.scene.currenScene.doSkillAttack(t)?(this._preSkill=t,!0):!1:!1},t.prototype.getMinIdMonster=function(){var t=1e5;for(var e in this._monsters){var i=Number(e);t>i&&(t=i)}return this._monsters[t]},t.prototype.getNaerMonster=function(t){var e=1e4,i=this,s=null,o=null;for(var n in i._monsters){var r=i._monsters[n];if(!(r.team&&r.team==this._unitView.team||r.isDead||t&&r.typeId!=t)){var h=Utils.distence(i._unitView.point.x,i._unitView.point.y,r.point.x,r.point.y);e>h&&(s&&Utils.distence(s.point.x,s.point.y,r.point.x,r.point.y)<100&&(o=s),s=r,e=h)}}return o&&Math.random()<.5&&(s=o),s},t.prototype.getNearRole=function(){var t=1e4,e=this,i=null;for(var s in e._roles){var o=e._roles[s];if(!o.isDead&&0!=o.unitData.hp){var n=Utils.distence(e._unitView.point.x,e._unitView.point.y,o.point.x,o.point.y);t>n&&(i=o,t=n)}}return i},t.prototype.clear=function(){this.stop(),this._unitView=null,this._monsters=null},t}();__reflect(AutoAttackAI.prototype,"AutoAttackAI");var PVPAI=function(){function t(t,e){this._isUseFirst=!1,this._unitView=t,this._lockView=e,this._aPoint=new egret.Point,t.setSkillEndCb(this.onSkillEnd,this)}return t.prototype.start=function(){GameTick.instence().setInterval(.3,this.onTime,this),this.initSkill()},t.prototype.stop=function(){GameTick.instence().clearInterval(this.onTime,this)},t.prototype.onSkillEnd=function(){this.onTime(0)},t.prototype.initSkill=function(){var t=GmGlobal.mc.btMgr;this._sp=t.pvpAiSp;var e=t.pvpAiSkill;if(e){this._skillList=[];for(var i in e){var s=Number(i),o=GmGlobal.mc.skillMgr.getSkillCfg(s);this._skillList.push({id:s,sp:o.sp,cd:e[i]})}}},t.prototype.onTime=function(t){var e=this;if(!(e._unitView.isDead||e._unitView.isXuanyun||e._unitView.isBingdong)){if(!e._lockView||e._lockView.isDead||0==e._lockView.unitData.hp){0==this._unitView.attackData.skillId&&(this._unitView.attackData.skillId=-1,this._unitView.stopAttack(),this._unitView.fightStand());var i=GmGlobal.vmc.scene.currenScene,s=i.getNearestFightView(e._unitView.team,e._unitView.point.x,e._unitView.point.y);if(!s)return;e._lockView=s}if(e._unitView.isMove&&Utils.distence(e._unitView.point.x,e._unitView.point.y,e._lockView.point.x,e._lockView.point.y)<=e._unitView.aDis-36&&e._unitView.stand(),!(e._unitView.attackData.skillId>0))if(!this._isUseFirst&&this.useFirstSkill());else if(Utils.distence(e._unitView.point.x,e._unitView.point.y,e._lockView.point.x,e._lockView.point.y)<=e._unitView.aDis)e.useSkill()||e._unitView.attackData.skillId<0&&GmGlobal.cc.sceneCtl.reqAiAttack(e._unitView.uid,e._unitView.point.x,e._unitView.point.y,e._lockView.uid,this._lockView.type);else{var i=GmGlobal.vmc.scene.currenScene;i.updateAttackPoint(e._unitView.point,e._lockView.point,e._unitView.aDis,e._aPoint),i.aiMoveToPath(e._unitView,e._aPoint.x,e._aPoint.y)}}},t.prototype.useSkill=function(){var t=this.getFreeSkill();return t?(GmGlobal.cc.sceneCtl.reqAiAkill(this._unitView.uid,this._unitView.point.x,this._unitView.point.y,this._lockView.uid,this._lockView.type,t),!0):!1},t.prototype.useFirstSkill=function(){if(!this._skillList||0==this._skillList.length)return!1;var t=this._skillList[0],e=GmGlobal.mc.skillMgr.getSkillCfg(t.id);return e&&!e.needTarget?(GmGlobal.cc.sceneCtl.reqAiAkill(this._unitView.uid,this._unitView.point.x,this._unitView.point.y,this._lockView.uid,this._lockView.type,t.id),this._isUseFirst=!0,!0):!1},t.prototype.getFreeSkill=function(){if(!this._skillList)return 0;for(var t=0;t<this._skillList.length;t++){var e=this._skillList[t];if(e.sp>this._sp)return;if(!e.cdt||0==e.cdt.cd)return e.cdt?e.cdt.setTime(e.cd):e.cdt=new GameTime(e.cd),this._sp-=e.sp,e.id}return 0},t.prototype.clear=function(){this.stop(),this._unitView=null,this._lockView=null},t}();__reflect(PVPAI.prototype,"PVPAI");var normalAttackData=function(){function t(){this.isBaoji=!1}return t.prototype.getNormalHurt=function(){if(this.sbp&&(this.sbNum+=this.sbp,this.sbNum>=100))return this.sbNum-=100,0;var t=1;return this.two&&(this.towNum+=this.two,this.towNum>=100&&(this.towNum-=100,t=2)),this.bjp&&(this.bjNum+=this.bjp,this.bjNum>=100)?(this.bjNum-=100,this.isBaoji=!0,this.bjHp*t):(this.isBaoji=!1,this.hp*t)},t}();__reflect(normalAttackData.prototype,"normalAttackData");var AttackData=function(){function t(){this.ax=0,this.ay=0,this.fdhp=-1,this.fbj=-1,this.reset()}return t.updateData=function(t,e){e.reset(),e.attacker=t.attacker,e.attackerType=t.attackerType,e.defender=t.defender,e.defenderType=t.defenderType,e.skillId=t.skillId,e.efNum=t.efNum,e.duration=t.duration,e.targetX=t.targetX,e.targetY=t.targetY,e.targetH=t.targetH,e.hitEffect=t.hitEffect,e.hitSound=t.hitSound,e.aScaleX=t.aScaleX,e.fdhp=t.fdhp,e.fbj=t.fbj,t.fdhp=-1,t.fbj=-1},t.prototype.reset=function(){this.attacker=0,this.attackerType=0,this.defender=0,this.defenderType=0,this.skillId=-1,this.efNum=0,this.duration=0,this.targetX=0,this.targetY=0,this.targetH=0,this.aScaleX=1,this.hitEffect=null,this.hitSound=null,this.fdhp=-1,this.fbj=-1},t}();__reflect(AttackData.prototype,"AttackData");var BuffData=function(){function t(){}return t.prototype.reset=function(){this.bfId=0,this.skillId=0,this.time=0},t}();__reflect(BuffData.prototype,"BuffData");var BuffId=function(){function t(){}return t.XUANYUN=11,t.BINGDONG=12,t.ZHONGDU=13,t.ZHUOSHAO=14,t.BATI=15,t.TIAOXIN=17,t}();__reflect(BuffId.prototype,"BuffId");var UnitData=function(){function t(){this.ts=0}return t.prototype.reset=function(){this.hp=0,this.hpMax=0,this.ts=0,this.gh=null,this.lv=0,this.ch=0,this.halo=0,this.bh=0},t}();__reflect(UnitData.prototype,"UnitData");var BuffEffect=function(){function t(){this.addLayer=0,this.scaleX=1,this.scaleY=1,this._isTimeOut=!1,this.buffData=new BuffData}return t.create=function(){var e=this._pool.pop();return e||(e=new t),e},t.release=function(t){t&&(t.unuse(),-1==this._pool.indexOf(t)&&this._pool.push(t))},Object.defineProperty(t.prototype,"effectId",{set:function(t){this._effectId!=t&&(this._mc=null),this._effectId=t},enumerable:!0,configurable:!0}),t.prototype.show=function(t,e,i){this._p=t,this._cb=e,this._cbThis=i,this._mc?this.addMc():GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this._effectId,this.onEffectLoaded,this),this.buffData.time&&GameTick.instence().setTimeOut(this.buffData.time,this.onPlayEnd,this)},t.prototype.resetTime=function(t){this._isTimeOut||GameTick.instence().setTimeOut(t,this.onPlayEnd,this)},t.prototype.onEffectLoaded=function(e){this._mc=new egret.MovieClip(e.generateMovieClipData(this._effectId)),this._mc&&this._p&&this._p.stage?this.addMc():t.release(this)},t.prototype.addMc=function(){this._mc.x=this.x,this._mc.y=this.y,this._mc.scaleX=this.scaleX,this._mc.scaleY=this.scaleY,-1==this.addLayer?this._p.addChildAt(this._mc,0):this._p.addChild(this._mc),this.buffData.time?this._mc.gotoAndPlay(this._effectId,-1):(this._mc.addEventListener(egret.Event.COMPLETE,this.onPlayEnd,this),this._mc.gotoAndPlay(this._effectId))},t.prototype.onPlayEnd=function(){this.buffData.time&&(this._isTimeOut=!0),this._cb&&this._cbThis&&this._cb.call(this._cbThis,this),t.release(this)},t.prototype.unuse=function(){this._mc&&(this._mc.stop(),this._mc.removeEventListener(egret.Event.COMPLETE,this.onPlayEnd,this),this._mc.parent&&this._p.removeChild(this._mc)),this.buffData.time&&!this._isTimeOut&&GameTick.instence().clearTimeOut(this.onPlayEnd,this),this.addLayer=0,this.scaleX=1,this.scaleY=1,this._isTimeOut=!0,this.buffData.reset(),this._cb=null,this._cbThis=null,this._p=null},t.prototype.clear=function(){this.unuse(),GmGlobal.res.releaseMCData(this._effectId,!1,this.onEffectLoaded,this),this._mc=null},t._pool=[],t}();__reflect(BuffEffect.prototype,"BuffEffect");var LoopEffect=function(){function t(){}return t.create=function(){var e=this._pool.pop();return e||(e=new t),e},t.release=function(t){t&&(t.unuse(),-1==this._pool.indexOf(t)&&this._pool.push(t))},Object.defineProperty(t.prototype,"effectId",{set:function(t){this._effectId!=t&&(this._mc=null),this._effectId=t},enumerable:!0,configurable:!0}),t.prototype.show=function(t){this._p=t,this._mc?this.addMc():GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this._effectId,this.onEffectLoaded,this)},t.prototype.onEffectLoaded=function(e){this._mc=new egret.MovieClip(e.generateMovieClipData(this._effectId)),this._mc&&this._p&&this._p.stage?this.addMc():t.release(this)},t.prototype.addMc=function(){this._mc.x=this.x||0,this._mc.y=this.y||0,this._p.addChild(this._mc),this._mc.gotoAndPlay(this._effectId,-1)},t.prototype.setPos=function(t,e){this.x=t,this.y=e,this._mc&&(this._mc.x=t,this._mc.y=e)},t.prototype.unuse=function(){this._mc?(this._mc.stop(),this._mc.parent&&this._p.removeChild(this._mc)):GmGlobal.res.stopMovieClipLoad(this._effectId,this.onEffectLoaded,this),this._p=null},t.prototype.clear=function(){this.unuse(),GmGlobal.res.releaseMCData(this._effectId,!1,this.onEffectLoaded,this),this._mc=null},t._pool=[],t}();__reflect(LoopEffect.prototype,"LoopEffect");var McEffect=function(){function t(t){this.name=t}return t.prototype.show=function(t,e,i,s,o,n,r,h){void 0===s&&(s=1),void 0===o&&(o=1),void 0===n&&(n=0),void 0===r&&(r=null),void 0===h&&(h=null),t&&(this._parent=t,this._x=e,this._y=i,this._addLayer=n,this._cb=r,this._thisObj=h,this._scaleX=s,this._scaleY=o,this._mc?this.addMc():GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this.name,this.onEffectLoaded,this))},t.prototype.addMc=function(){this._mc.x=this._x,this._mc.y=this._y,this._mc.scaleX=this._scaleX,this._mc.scaleY=this._scaleY,-1==this._addLayer?this._parent.addChildAt(this._mc,0):this._parent.addChild(this._mc),this._mc.addEventListener(egret.Event.COMPLETE,this.onPlayEnd,this),this._mc.gotoAndPlay(this.name)},t.prototype.onEffectLoaded=function(t){this._mc=new egret.MovieClip(t.generateMovieClipData(this.name)),this._mc&&this._parent&&this._parent.stage?this.addMc():this.releaseEffect()},t.prototype.onPlayEnd=function(t){this._cb&&this._thisObj&&this._cb.call(this._thisObj),this.releaseEffect()},t.prototype.releaseEffect=function(){ObjectPool.push(this,this.name)},t.prototype.getMc=function(){return this._mc},t.prototype.removeFormParent=function(){this._mc&&this._mc.parent&&(GmGlobal.res.stopMovieClipLoad(this.name,this.onEffectLoaded,this),this.onPlayEnd(null))},t.prototype.unuse=function(){this._mc&&(this._mc.stop(),this._mc.removeEventListener(egret.Event.COMPLETE,this.onPlayEnd,this),this._mc.parent&&this._parent.removeChild(this._mc)),this._cb=null,this._thisObj=null,this._parent=null},t.prototype.reuse=function(){},t.prototype.clear=function(){this.unuse(),GmGlobal.res.releaseMCData(this.name,!1,this.onEffectLoaded,this),this._mc=null,this._parent=null,this._cb=null,this._thisObj=null},t.create=function(e){var i=ObjectPool.pop(e);return i||(i=new t(e)),i},t}();__reflect(McEffect.prototype,"McEffect",["IObject"]);var SkillEffect=function(){function t(){this.isMove=!1,this.angle=0,this._delayTimer=0,this._durationEnd=!1}return t.create=function(e){var i=ObjectPool.pop(e);if(!i){i=new t;var s=GmGlobal.mc.btMgr.getModelPlayCfg(e);s&&s[e]&&(i.playConfig=s[e]),-1==t._effectIds.indexOf(e)&&t._effectIds.push(e)}return i.effectId=e,i},t.release=function(t){t&&ObjectPool.push(t,t.effectId)},t.clearEffect=function(){for(var e=t._effectIds,i=0;i<e.length;i++)ObjectPool.clear(e[i]);t._effectIds=[]},t.prototype.setAttackData=function(t){null==this.attackData&&(this.attackData=new AttackData),AttackData.updateData(t,this.attackData)},t.prototype.show=function(t,e,i,s,o,n){this._x=t,this._y=e,this._scale=i,this._playEndCb=s,this._thisObj=o,this._scaleX=n,this._effectMc?this.playEffect():(GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this.effectId,this.onEffectLoaded,this),this.clearTimer(),this._delayTimer=egret.setTimeout(this.onTimeOut,this,600)),this.attackData.duration&&GameTick.instence().setTimeOut(this.attackData.duration,this.onDurationEnd,this)},t.prototype.onTimeOut=function(){this._delayTimer=0,this.doAttack()},t.prototype.onEffectLoaded=function(t){this.clearTimer(),this._effectMc=new egret.MovieClip(t.generateMovieClipData(this.effectId)),this._effectMc?this.playEffect():(this._playEndCb.call(this._thisObj,this),this.clearCallback())},t.prototype.playEffect=function(){var t=GmGlobal.vmc.scene.currenMapView;if(t)if(this._effectMc.x=this._x,this._effectMc.y=this._y,this._effectMc.rotation=this.angle,this._scaleX<0&&!this.isMove?this._effectMc.scaleX=-this._scale:this._effectMc.scaleX=this._scale,this._effectMc.scaleY=this._scale,this.playConfig.mdata){var e=this.playConfig.mdata,i=this._scaleX<0?e[1]-90:-e[1]-90,s=i*Math.PI/180,o=this._x+Math.cos(s)*e[0],n=this._y+Math.sin(s)*e[0];this._effectMc.x=o,this._effectMc.y=n,t.addToEffectLayer(this._effectMc),this._effectMc.gotoAndPlay("e1",-1),egret.Tween.get(this._effectMc).to({x:this._x,y:this._y},1e3*e[2]).call(this.onDownEnd,this)}else if(this.isMove){t.addToEffectLayer(this._effectMc),this._effectMc.gotoAndPlay(this.effectId,-1);var r=Utils.distence(this._x,this._y,this.attackData.targetX,this.attackData.targetY),h=r/this.speed*1e3;egret.Tween.get(this._effectMc).to({x:this.attackData.targetX,y:this.attackData.targetY},h).call(this.onMoveEnd,this)}else-1==this.playConfig.aefl?t.addToShadowLayer(this._effectMc):t.addToEffectLayer(this._effectMc),this.playConfig.duration?this._effectMc.gotoAndPlay(this.effectId,-1):(this._effectMc.gotoAndPlay(this.effectId,1),this._effectMc.addEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onFrame,this),this._effectMc.addEventListener(egret.Event.COMPLETE,this.onPlayEnd,this))},t.prototype.onMoveEnd=function(){this.doAttack(),this.onPlayEnd(null)},t.prototype.onDownEnd=function(){this._effectMc.gotoAndPlay("e2",1),this._effectMc.addEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onFrame,this),this._effectMc.addEventListener(egret.Event.COMPLETE,this.onPlayEnd,this)},t.prototype.removeListeners=function(){this._effectMc&&(this.isMove||(this._effectMc.removeEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onFrame,this),this._effectMc.removeEventListener(egret.Event.COMPLETE,this.onPlayEnd,this)))},t.prototype.onFrame=function(t){this.doAttack()},t.prototype.doAttack=function(){this.attackData&&(this.playConfig&&(this.attackData.hitEffect=this.playConfig.hitef,this.attackData.hitSound=this.playConfig.hSound),CmdBus.doCmd(CmdType.BATTLE_ATTACK,this.attackData))},t.prototype.onPlayEnd=function(e){t.release(this),this._playEndCb&&this._thisObj&&this._playEndCb.call(this._thisObj,this),this.clearCallback()},t.prototype.doRelease=function(){t.release(this),this.clearCallback()},t.prototype.clearTimer=function(){0!=this._delayTimer&&(egret.clearTimeout(this._delayTimer),this._delayTimer=0)},t.prototype.onDurationEnd=function(){this._durationEnd=!0,this.doAttack(),this.onPlayEnd(null)},t.prototype.unuse=function(){this.attackData.duration&&!this._durationEnd&&GameTick.instence().clearTimeOut(this.onDurationEnd,this),this.removeListeners(),this.angle=0,this.speed=0,this.isMove=!1,this._durationEnd=!1,this.attackData.reset(),this.clearTimer(),this._effectMc?(this._effectMc.stop(),this._effectMc.parent&&this._effectMc.parent.removeChild(this._effectMc)):GmGlobal.res.stopMovieClipLoad(this.effectId,this.onEffectLoaded,this)},t.prototype.reuse=function(){},t.prototype.clearCallback=function(){this._playEndCb=null,this._thisObj=null},t.prototype.clear=function(){this.removeListeners(),this.clearTimer(),this._effectMc&&(egret.Tween.removeTweens(this._effectMc),this._effectMc.stop(),this._effectMc.parent&&this._effectMc.parent.removeChild(this._effectMc),GmGlobal.res.releaseMCData(this.effectId,!1,this.onEffectLoaded,this)),this.effectId=null,this.playConfig=null,this.attackData=null,this._effectMc=null,this._playEndCb=null,this._thisObj=null},t._effectIds=[],t}();__reflect(SkillEffect.prototype,"SkillEffect",["IObject"]);var SubEffectCreator=function(){function t(){}return t.create=function(){var e=this._pool.pop();return e||(e=new t),e},t.release=function(t){t&&(t.clear(),-1==this._pool.indexOf(t)&&this._pool.push(t))},t.prototype.initSubs=function(t,e,i,s,o,n,r,h){this._sound=e,this._baseX=o,this._baseY=n,this._scale=r,this._dirScale=h,this._subEffects=[];for(var a=0;i>a;a++){var l=SkillEffect.create(t);l.setAttackData(s),this._subEffects.push(l)}},t.prototype.show=function(t,e){this._cb=t,this._cbObj=e,GameTick.instence().setInterval(.1,this.showSub,this)
},t.prototype.showSub=function(){var t=this._subEffects.pop(),e=this._baseX-50+Utils.random(1,100),i=this._baseY-50+Utils.random(1,100);t.show(e,i,this._scale,this.onSubPlayEnd,this,this._dirScale),this._showEffects?this._showEffects.push(t):this._showEffects=[t],this._sound&&GmGlobal.sound.playSoundEffect(this._sound),0==this._subEffects.length&&GameTick.instence().clearInterval(this.showSub,this)},t.prototype.onSubPlayEnd=function(e){var i=this._showEffects.indexOf(e);-1!=i&&this._showEffects.splice(i,1),0==this._subEffects.length&&0==this._showEffects.length&&(this._cb&&this._cb.call(this._cbObj,this),this._subEffects=null,t.release(this))},t.prototype.clear=function(){if(this._subEffects){if(this._subEffects.length>0){GameTick.instence().clearInterval(this.showSub,this);for(var t=0,e=this._subEffects;t<e.length;t++){var i=e[t];SkillEffect.release(i),this._subEffects=null}}if(this._showEffects&&this._showEffects.length>0){for(var s=0,o=this._showEffects;s<o.length;s++){var i=o[s];SkillEffect.release(i)}this._showEffects=null}}},t._pool=[],t}();__reflect(SubEffectCreator.prototype,"SubEffectCreator");var BattleHpText=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&(t.clear(),-1==this._pool.indexOf(t)&&this._pool.push(t))},e.prototype.setTxt=function(t,e,i){void 0===i&&(i=null),this._numPrefix=e,i&&(this.effect||(this.effect=new eui.Image),this.effect.texture=RES.getRes("battle_json."+i),this.effect.height=this.effect.texture.textureHeight,this.addChild(this.effect)),0!=t&&(this.number||(this.number=BitmapNumber.create()),this.updateHurt(t),this.effect&&this.effect.parent&&(this.effect.width=this.number.width+70,this.effect.y=(this.number.height-this.effect.height)/2+2,this.effect.x=-35),this.addChild(this.number))},e.prototype.updateHurt=function(t){this.number&&(this.number.setNumber(t,this._numPrefix),this.anchorOffsetX=this.number.width/2,this.anchorOffsetY=this.number.height/2)},e.prototype.showEffect=function(t,e,i,s,o,n,r){this.effect||(this.effect=new eui.Image),this.effect.texture=RES.getRes("battle_json."+t),this.effect.width=this.effect.texture.textureWidth,this.effect.height=this.effect.texture.textureHeight,this.addChild(this.effect),this.anchorOffsetX=this.effect.width/2,this.anchorOffsetY=this.effect.height/2,e.addChild(this),this.x=i+(20-40*Math.random()),this.y=s-(o>200?200:o+40),this.scaleX=.5,this.scaleY=.5,this.alpha=1,egret.Tween.get(this).to({scaleX:1,scaleY:1},100).wait(200).to({y:this.y-40,alpha:0},500).call(this.onRemoveComplete,this)},e.prototype.show=function(t,e,i,s,o,n,r){this._cb=n,this._cbThis=r,this.x=i,this.y=s-(o>200?200:o),t.addChild(this),0==e?this.moveStyle2():this.moveStyle1(e,s,o)},e.prototype.moveStyle1=function(t,e,i){this.scaleX=.8,this.scaleY=.8,this.alpha=1,this._move=ObjectPool.pop("HpTextMove1"),this._move||(this._move=new HpTextMove1),this._move.start(this,(30+Math.floor(30*Math.random()))*t,400,e,this.moveStyle1ShowEnd,this)},e.prototype.moveStyle1ShowEnd=function(t){ObjectPool.push(t,"HpTextMove1"),this._move=null,this.onRemoveComplete()},e.prototype.moveStyle2=function(){this._moveY=40,this.scaleX=.8,this.scaleY=.8,this.alpha=1,egret.Tween.get(this).to({x:this.x,y:this.y-this._moveY,scaleX:1,scaleY:1},300).call(this.moveStyle2ShowEnd,this)},e.prototype.moveStyle2ShowEnd=function(){egret.Tween.get(this).to({x:this.x,y:this.y-40,alpha:.1},300).call(this.onRemoveComplete,this)},e.prototype.onRemoveComplete=function(){this._cb&&this._cb.call(this._cbThis,this),e.release(this)},e.prototype.clear=function(){this._move&&(ObjectPool.push(this._move,"HpTextMove1"),this._move=null),egret.Tween.removeTweens(this),this.number&&(BitmapNumber.release(this.number),this.number=null),this.effect&&this.effect.parent&&this.removeChild(this.effect),this.parent&&this.parent.removeChild(this),this._numPrefix=null,this._cb=null,this._cbThis=null},e._pool=[],e}(egret.DisplayObjectContainer);__reflect(BattleHpText.prototype,"BattleHpText");var BattleManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_modelplay.json",this.initConfig,this),GmGlobal.mc.regUnzipCfg("c_buff.json",this.initBuffCfg,this),GmGlobal.mc.regUnzipCfg("c_fb_buff.json",this.initFbBuffCfg,this),this._skillCd={}}return t.prototype.initConfig=function(t){this._playCfg=t},t.prototype.initBuffCfg=function(t){this._buffCfg=t},t.prototype.initFbBuffCfg=function(t){this._fbBuffCfg=t},t.prototype.getModelPlayCfg=function(t){return this._playCfg[t]},t.prototype.getBuffCfg=function(t){return this._buffCfg[t]},t.prototype.getFbBuffCfg=function(t){return this._fbBuffCfg[t]},t.prototype.getSkillCD=function(t){var e=this._skillCd[t];return e||(e=new GameTime(0),this._skillCd[t]=e),e},t.prototype.setSkillCD=function(t,e){var i=this._skillCd[t];return i?0==i.cd&&i.setTime(e):(i=new GameTime(e),this._skillCd[t]=i),i},t.prototype.clearSkillCD=function(){for(var t in this._skillCd){var e=this._skillCd[t];e.setTime(0)}},t}();__reflect(BattleManager.prototype,"BattleManager");var ExpText=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&(t.clear(),-1==this._pool.indexOf(t)&&this._pool.push(t))},e.prototype.show=function(t,e,i,s,o){t.addChild(this),this.number||(this.number=BitmapNumber.create(),this.addChild(this.number)),this.number.setNumber(-e,"battle_json.exp_",0),this.anchorOffsetX=this.number.width/2,this.anchorOffsetY=this.number.height/2,this.x=i,this.y=s-o,egret.Tween.get(this).to({y:this.y-50},500).to({y:this.y-70,alpha:0},500).call(this.onMoveEnd,this)},e.prototype.onMoveEnd=function(){e.release(this)},e.prototype.clear=function(){this.number&&(this.alpha=1,BitmapNumber.release(this.number),this.number=null),this.parent&&this.parent.removeChild(this)},e._pool=[],e}(egret.DisplayObjectContainer);__reflect(ExpText.prototype,"ExpText");var HpAddEffect=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&(t.clear(),-1==this._pool.indexOf(t)&&this._pool.push(t))},e.prototype.show=function(t,e,i,s,o){t.addChild(this),this.number||(this.number=BitmapNumber.create(),this.addChild(this.number)),this.number.setNumber(e,"battle_json.num_g_",0),this.anchorOffsetX=this.number.width/2,this.anchorOffsetY=this.number.height/2,this.x=i,this.y=s-o,egret.Tween.get(this).to({y:this.y-50},500).to({y:this.y-70,alpha:0},500).call(this.onMoveEnd,this)},e.prototype.onMoveEnd=function(){e.release(this)},e.prototype.clear=function(){this.number&&(this.alpha=1,BitmapNumber.release(this.number),this.number=null),this.parent&&this.parent.removeChild(this)},e._pool=[],e}(egret.DisplayObjectContainer);__reflect(HpAddEffect.prototype,"HpAddEffect");var HpTextMove1=function(){function t(){}return t.prototype.start=function(t,e,i,s,o,n){this._txt=t,this._endY=s,this._cb=o,this._cbThis=n,this._scaleStep=0,this._alphaStep=0,this._vy=i,this._vx=e,this._isUp=!0,this._isStop=!1,this._g=-1e3,this._toX=t.x,this._toY=t.y,GameTick.instence().bindTick(this.onTick,this)},t.prototype.onTick=function(t){var e=this;e._toY-=e._vy*t+.5*e._g*t*t,e._toX+=e._vx*t,e._vy=e._vy+e._g*t,e._txt.scaleX+=e._scaleStep,e._txt.scaleY+=e._scaleStep,e._txt.alpha+=e._alphaStep,e._vy<=0&&e._isUp&&(e._alphaStep=-.015,e._scaleStep=-.01,e._isUp=!1),e._txt.x=e._toX,e._txt.y=e._toY,!e._isUp&&e._toY>=this._endY&&e.stop()},t.prototype.stop=function(){this._isStop=!0,GameTick.instence().unbindTick(this.onTick,this),this._cb&&this._cb.call(this._cbThis,this)},t.prototype.unuse=function(){this._isStop||GameTick.instence().unbindTick(this.onTick,this),this._txt=null,this._cb=null,this._cbThis=null},t.prototype.reuse=function(){},t.prototype.clear=function(){this.unuse()},t}();__reflect(HpTextMove1.prototype,"HpTextMove1",["IObject"]);var SkillHpText=function(){function t(){this._num=0}return t.create=function(){var e=this._pool.pop();return e||(e=new t),e},t.release=function(t){t&&(t.clear(),-1==this._pool.indexOf(t)&&this._pool.push(t))},t.prototype.setTxt=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=null),this._hurt=t,this._showNum=e,this._effect=i},t.prototype.show=function(t,e,i,s,o,n){this._parent=t,this._x=e,this._y=i,this._h=s,this._num=0,this.showTotalTxt(),this.createTxt(),this._showNum>0&&GameTick.instence().setInterval(.1,this.onTime,this)},t.prototype.showTotalTxt=function(){this._totalHp||(this._totalHp=BattleHpText.create()),this._totalHp.setTxt(this._hurt,"battle_json.num_y_",this._effect),this._totalHp.x=this._x,this._totalHp.y=this._y-((this._h>200?200:this._h)+40),this._totalHp.alpha=1,this._parent.addChild(this._totalHp)},t.prototype.hideTotalTxt=function(){this._totalHp&&(egret.Tween.removeTweens(this._totalHp),egret.Tween.get(this._totalHp).wait(300).to({y:this._totalHp.y-120,alpha:0},600).call(this.onTTextMoveEnd,this))},t.prototype.createTxt=function(){this._num++,this._showNum--,this._totalHp&&(this._totalHp.updateHurt(this._hurt*this._num),egret.Tween.removeTweens(this._totalHp),this._totalHp.scaleX=1,this._totalHp.scaleY=1,this._showNum>1?egret.Tween.get(this._totalHp).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:1,scaleY:1},100):egret.Tween.get(this._totalHp).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:1,scaleY:1},100).call(this.hideTotalTxt,this))},t.prototype.onTime=function(){0==this._showNum?GameTick.instence().clearInterval(this.onTime,this):this.createTxt()},t.prototype.onTTextMoveEnd=function(){this._cb&&this._cb.call(this._cbThis,this),this._totalHp=null,t.release(this)},t.prototype.clear=function(){this._totalHp&&egret.Tween.removeTweens(this._totalHp),this._totalHp=null,this._cb=null,this._cbThis=null},t._pool=[],t}();__reflect(SkillHpText.prototype,"SkillHpText");var BlockMapData=function(){function t(){}return t.prototype.getFarGrid=function(t,e,i){var s=(this.getBorderPoint(t,e,i),this.grid.getRowByY(e)),o=this.grid.getColByX(t);this._fGrid||(this._fGrid=new egret.Point),this._fGrid.y=s,this._fGrid.x=o;var n=0,r=s,h=0,a=t,l=e;if(Math.abs(i+Math.PI/2)<=.022)for(var c=r;0>=c;c--){if(0!=this.grid.getBGCellValue(c,o))return this._fGrid;this._fGrid.y=c}else if(i+Math.PI<=.022||Math.PI-i<=.022)for(var d=o;d>=0;d--){if(0!=this.grid.getBGCellValue(s,d))return this._fGrid;this._fGrid.x=d}else if(.022>=i&&i>=-.022)for(var d=o;d<this.grid.cols;d++){if(0!=this.grid.getBGCellValue(s,d))return this._fGrid;this._fGrid.x=d}else{if(!(Math.abs(i-Math.PI/2)<=.022)){if(i<-Math.PI/2){for(var d=o;d>=0;d--){a=this.grid.getXByCol(d),l-=(0==h?t-a:24)*Math.tan(i),n=this.grid.getRowByY(0>l?0:l);for(var c=r;c>=n;c--){if(0!=this.grid.getBGCellValue(c,d))return this._fGrid;this._fGrid.y=c,this._fGrid.x=d}h++,r=n}return this._fGrid}if(i>Math.PI/2){for(var d=o;d>=0;d--){a=this.grid.getXByCol(d),l-=(0==h?t-a:24)*Math.tan(i),n=this.grid.getRowByY(l>this.height?this.height:l);for(var c=r;n>=c;c++){if(0!=this.grid.getBGCellValue(c,d))return this._fGrid;this._fGrid.y=c,this._fGrid.x=d}h++,r=n}return this._fGrid}if(i>-Math.PI/2&&0>i){for(var d=o;d<this.grid.cols;d++){a=this.grid.getXByCol(d+1),l+=(0==h?a-t:24)*Math.tan(i),n=this.grid.getRowByY(0>l?0:l);for(var c=r;c>=n;c--){if(0!=this.grid.getBGCellValue(c,d))return this._fGrid;this._fGrid.y=c,this._fGrid.x=d}h++,r=n}return this._fGrid}for(var d=o;d<this.grid.cols;d++){a=this.grid.getXByCol(d+1),l+=(0==h?a-t:24)*Math.tan(i),n=this.grid.getRowByY(l>this.height?this.height:l);for(var c=r;n>=c;c++){if(0!=this.grid.getBGCellValue(c,d))return this._fGrid;this._fGrid.y=c,this._fGrid.x=d}h++,r=n}return this._fGrid}for(var c=r;c<this.grid.rows;c++){if(0!=this.grid.getBGCellValue(c,o))return this._fGrid;this._fGrid.y=c}}},t.prototype.getBorderPoint=function(t,e,i){var s=0,o=0;return i<-Math.PI/2?(s=0,o=t*Math.tan(i),0>o&&(o=0,s=e/Math.tan(i))):i>=-Math.PI/2&&0>i?(s=this.width,o=(this.width-t)*Math.tan(i),0>o&&(o=0,s=e/Math.tan(i))):i>Math.PI/2?(s=0,o=t*Math.tan(i),o>this.height&&(o=this.height,s=(this.height-e)/Math.tan(i))):(s=this.width,o=(this.width-t)*Math.tan(i),o>this.height&&(o=this.height,s=(this.height-e)/Math.tan(i))),this._bPoint?(this._bPoint.x=t,this._bPoint.y=e):this._bPoint=new egret.Point(s,o),this._bPoint},t}();__reflect(BlockMapData.prototype,"BlockMapData");var BlockMapView=function(t){function e(e,i,s){var o=t.call(this)||this;return o.mapRes=e,o.mapData=i,o.touchEnabled=!0,o.touchChildren=!1,o.initMap(s),o}return __extends(e,t),e.prototype.initMap=function(t){t&&(this._miniBitmap=new egret.Bitmap(t),this._miniBitmap.width=this.mapData.width,this._miniBitmap.height=this.mapData.height,this.addChild(this._miniBitmap)),this._blockLoadNum=0,this._mapBlocks=[],this._blockFix=GmConst.MAP_DIR+this.mapRes+"/"+this.mapRes+"_";for(var e,i=0;i<this.mapData.bgGrid.rows;++i)for(var s=0;s<this.mapData.bgGrid.cols;++s)e=BlockView.create(),e.mapId=this.mapRes,e.url=this._blockFix+i.toString()+"_"+s.toString()+"."+this.mapData.suffix,e.rect.x=s*this.mapData.bgGrid.gridWidth,e.rect.y=i*this.mapData.bgGrid.gridHeight,e.rect.x+this.mapData.bgGrid.gridWidth>this.mapData.width?e.rect.width=this.mapData.width-e.rect.x:e.rect.width=this.mapData.bgGrid.gridWidth,e.rect.y+this.mapData.bgGrid.gridHeight>this.mapData.height?e.rect.height=this.mapData.height-e.rect.y:e.rect.height=this.mapData.bgGrid.gridWidth,e.x=e.rect.x,e.y=e.rect.y,this._mapBlocks.push(e),this.addChild(e)},e.prototype.updateViewPort=function(t){if(this._mapBlocks)for(var e,i=0;i<this._mapBlocks.length;++i)e=this._mapBlocks[i],e.rect.intersects(t)?(e.visible||(e.visible=!0),e.isLoad||e.loadImg(this.blockLoaded,this)):e.visible&&(e.visible=!1)},e.prototype.clearNoShowBlock=function(t){if(this._mapBlocks)for(var e,i=0;i<this._mapBlocks.length;++i)e=this._mapBlocks[i],e.rect.intersects(t)||(e.parent&&this.removeChild(e),e.isLoad&&e.clearImg())},e.prototype.blockLoaded=function(t){return this._mapBlocks?(this._blockLoadNum++,void(this._blockLoadNum==this._mapBlocks.length&&this._miniBitmap&&(this.removeChild(this._miniBitmap),this._miniBitmap=null))):void BlockView.release(t)},e.prototype.clearBlock=function(){if(this._mapBlocks)for(var t,e=0;e<this._mapBlocks.length;++e)t=this._mapBlocks[e],t.clearImg()},e.prototype.clear=function(){if(this._mapBlocks){for(var t,e=0;e<this._mapBlocks.length;++e)t=this._mapBlocks[e],BlockView.release(t);this._mapBlocks=null}this._miniBitmap&&(this._miniBitmap.parent&&this.removeChild(this._miniBitmap),this._miniBitmap.texture&&this._miniBitmap.texture.dispose()),this.mapRes=null,this.mapData=null,this._miniBitmap=null,this._viewPort=null},e}(egret.DisplayObjectContainer);__reflect(BlockMapView.prototype,"BlockMapView");var BlockView=function(t){function e(){var e=t.call(this)||this;return e.isLoad=!1,e.isRelease=!0,e.rect=new egret.Rectangle,e}return __extends(e,t),e.prototype.loadImg=function(t,e){if(!this.isLoad){this._cb=t,this._cbThis=e,this.isLoad=!0,this.isRelease=!1;var i=GmGlobal.res.getVersion(this.url);i>1&&(this.url+="."+i),RES.getResByUrl(PFConst.RES_ROOT+this.url,this.onImgLoaded,this,RES.ResourceItem.TYPE_IMAGE)}},e.prototype.onImgLoaded=function(t,e){return this.mapId&&-1!=e.indexOf(this.mapId)?this.isRelease?void RES.destroyRes(e):(t&&(this.texture=t),void(this._cb&&this._cb.call(this._cbThis,this))):void RES.destroyRes(e)},e.prototype.clearImg=function(){this.isLoad&&RES.destroyRes(this.url),this.texture=null,this.isLoad=!1,this.isRelease=!0},e.prototype.clear=function(){this.clearImg()},e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t&&(t.parent&&t.parent.removeChild(t),t.clear())},e._pool=[],e}(egret.Bitmap);__reflect(BlockView.prototype,"BlockView");var MapData=function(){function t(t,e){this.type=0,this.id=t,this.mapRes=e}return t}();__reflect(MapData.prototype,"MapData");var MapGrid=function(){function t(t,e,i,s,o,n){void 0===o&&(o=null),void 0===n&&(n=null),this.gridWidth=t,this.gridHeight=e,this.rows=i,this.cols=s,this.barrierGrid=o,this.perspectiveGrid=n}return t.prototype.initUnblockedGrid=function(){var t=this;t.unblockedGrid=[];for(var e,i=0;i<t.barrierGrid.length;i++){e=t.barrierGrid[i];for(var s=0;s<e.length;s++)0==t.barrierGrid[i][s]&&t.unblockedGrid.push([i,s])}},t.prototype.getRowByY=function(t){return Math.floor(t/this.gridHeight)},t.prototype.getXByCol=function(t){return t*this.gridHeight},t.prototype.getColByX=function(t){return Math.floor(t/this.gridWidth)},t.prototype.getYByRow=function(t){return t*this.gridWidth},t.prototype.getBGCellValue=function(t,e){return 0>t||0>e||t>=this.rows||e>=this.cols?999:this.barrierGrid[t][e]},t.prototype.getToushiValue=function(t,e){var i=Math.floor(e/this.gridHeight),s=Math.floor(t/this.gridWidth);return 0>i||0>s||i>=this.rows||s>=this.cols?0:this.perspectiveGrid[i][s]},t}();__reflect(MapGrid.prototype,"MapGrid");var MapManager=function(){function t(){this._blockMapDatas={},GmGlobal.mc.regUnzipCfg("c_map.json",this.initConfig,this)}return t.prototype.initConfig=function(t){this.rule=t.rule,this._mapCfgs={};for(var e in t.maps){var i=t.maps[e],s=new MapData(Number(e),i.res);s.type=i.type,s.bgMusic=i.bgm,s.lv=i.lv,s.sicon=i.sicon,s.isPvp=Boolean(i.pvp),s.isfh=Boolean(i.isfh),s.fhCd=i.cd||0,s.fhPrice=i.price||0,s.maxNum=i.rolemax||-1,this._mapCfgs[e]=s}this._boxaws=t.mapaw},t.prototype.getMapCfg=function(t){return this._mapCfgs[t]},t.prototype.getMapMaxRole=function(t){var e=this.getMapCfg(t);return e?e.maxNum:-1},t.prototype.getMapType=function(t){var e=this._mapCfgs[t];return e?e.type:1},t.prototype.getMapList=function(t){if(2==t&&this.wildList)return this.wildList;var e=[];for(var i in this._mapCfgs){var s=this._mapCfgs[i];s.type==t&&e.push(s)}return 2==t&&(this.wildList=e),e},t.prototype.getCityMap=function(){var t=this.getMapList(SceneType.CITY);return t.length>0?t[0]:null},t.prototype.getBoxAw=function(t){return this._boxaws[t]},t.prototype.setBlockMapData=function(t){var e=new BlockMapData;e.mapRes=t.mapResId,t.drect&&(e.drect=new egret.Rectangle(t.drect.x,t.drect.y,t.drect.width,t.drect.height)),t.dpoint&&(e.dpoint=new egret.Point(t.dpoint.x,t.dpoint.y)),e.suffix=t.suffix,e.width=t.width,e.height=t.height,e.bgGrid=new MapGrid(t.bgGrid.gridWidth,t.bgGrid.gridHeight,t.bgGrid.rows,t.bgGrid.cols),e.grid=new MapGrid(t.grid.gridWidth,t.grid.gridHeight,t.grid.rows,t.grid.cols,t.grid.barrierGrid,t.grid.perspectiveGrid),e.grid.initUnblockedGrid();var i,s;e.scenerys=[];for(var o=0;o<t.scenerys.length;o++)i=t.scenerys[o],s=new MapScenery,s.res=i.res,s.name=i.name,s.fileType=i.fileType,s.type=i.type,s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height,s.apX=i.ap.x,s.apY=i.ap.y,e.scenerys.push(s);return e.tps=t.tps,this._blockMapDatas[e.mapRes]=e,e},t.prototype.getBlockMapData=function(t){return this._blockMapDatas[t]},t.prototype.getLastOpenMap=function(){for(var t=this.getMapList(2),e=GmGlobal.mc.role.lv,i=0,s=0;s<t.length;s++){var o=t[s];if(o.lv>e)break;i=o.id}return i},t}();__reflect(MapManager.prototype,"MapManager");var MapScenery=function(){function t(){}return t}();__reflect(MapScenery.prototype,"MapScenery");var SceneryView=function(t){function e(e,i){var s=t.call(this)||this;return s.name="scenery",s.dir=e,s.scenery=i,s.touchChildren=!1,s}return __extends(e,t),e.prototype.init=function(){this.x=this.scenery.x,this.y=this.scenery.y,"img"==this.scenery.fileType?(this._pngUrl=this.dir+this.scenery.res+".png",RES.getResByUrl(PFConst.RES_ROOT+this._pngUrl,this.onImgLoaded,this,RES.ResourceItem.TYPE_IMAGE)):GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this.scenery.res,this.onMcDataLoaded,this)},e.prototype.onImgLoaded=function(t){return this.parent?(this._bitmap=new egret.Bitmap(t),this.anchorOffsetX=this._bitmap.width/2,this.anchorOffsetY=this._bitmap.height/2,this.x+=this.anchorOffsetX,this.y+=this.anchorOffsetY,void this.addChild(this._bitmap)):void RES.destroyRes(this._pngUrl)},e.prototype.onMcDataLoaded=function(t){this._mc=new egret.MovieClip(t.generateMovieClipData(this.scenery.res)),this._mc&&(this.addChild(this._mc),this._mc.gotoAndPlay(this.scenery.res,-1))},e.prototype.clear=function(){this._bitmap&&this._bitmap.parent&&this.removeChild(this._bitmap),this._mc&&this._mc.parent&&this.removeChild(this._mc),this._pngUrl&&RES.destroyRes(this._pngUrl),"img"!=this.scenery.fileType&&GmGlobal.res.releaseMCData(this.scenery.res,!1,this.onMcDataLoaded,this),this._bitmap=null,this._mc=null,this.scenery=null},e}(egret.DisplayObjectContainer);__reflect(SceneryView.prototype,"SceneryView");var NpcType=function(){function t(){}return t.NPC=0,t.MONSTER=1,t.BOSS=2,t}();__reflect(NpcType.prototype,"NpcType");var NpcManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_npc.json",this.initConfig,this)}return t.prototype.initConfig=function(t){this._cfg=t},t.prototype.getNpcCfg=function(t){return this._cfg.npcs[t]},t.prototype.getMapNpcs=function(t){return this._cfg.map[t]},t.prototype.getWx=function(t){switch(t){case 1:return"Fire";case 2:return"Water";case 3:return"Wind";case 4:return"Earth";case 5:return"Holy";case 6:return"Dark";default:return"Normal"}},t.prototype.getWxImg=function(t){switch(t){case 1:return"com_json.s_ys02";case 2:return"com_json.s_ys03";case 3:return"com_json.s_ys04";case 4:return"com_json.s_ys05";case 5:return"com_json.s_ys06";case 6:return"com_json.s_ys07";default:return"com_json.s_ys01"}},t.prototype.getWxKey=function(t){switch(t){case 1:return"fi";case 2:return"wa";case 3:return"wi";case 4:return"ea";case 5:return"sa";case 6:return"sh";default:return"na"}},t.prototype.getTx=function(t){switch(t){case 2:return"Large";case 3:return"Medium";case 4:return"Small";default:return"Shapeless"}},t.prototype.getTxImg=function(t){switch(t){case 2:return"com_json.s_xt04";case 3:return"com_json.s_xt03";case 4:return"com_json.s_xt02";default:return"com_json.s_xt01"}},t.prototype.getTxKey=function(t){switch(t){case 2:return"bs";case 3:return"ms";case 4:return"ss";default:return"ns"}},t.prototype.getLeixi=function(t){switch(t){case 0:return"Human";case 1:return"Animal";case 2:return"Plant";case 3:return"Insect";case 4:return"Fish";case 5:return"Human";case 6:return"Undead";default:return""}},t.prototype.getLeixiImg=function(t){switch(t){case 0:return"";case 1:return"com_json.s_zz01";case 2:return"com_json.s_zz02";case 3:return"com_json.s_zz03";case 4:return"com_json.s_zz04";case 5:return"com_json.s_zz05";case 6:return"com_json.s_zz06";default:return""}},t.prototype.getLeixiKey=function(t){switch(t){case 0:return"";case 1:return"an";case 2:return"pl";case 3:return"is";case 4:return"fs";case 5:return"hu";case 6:return"ud";default:return""}},t}();__reflect(NpcManager.prototype,"NpcManager");var MapDataPreLoad=function(t){function e(e){var i=t.call(this)||this;return i._mapId=e,i}return __extends(e,t),e.prototype.execute=function(e,i,s,o){t.prototype.execute.call(this,e,i,s,o),this._progressInfo.name="Loading map data";var n=GmGlobal.mc.mapMgr.getMapCfg(this._mapId);if(n){var r=GmGlobal.mc.mapMgr.getBlockMapData(n.mapRes);if(r)this.notifyProgress(),this.notifyComplete();else{var h=GmConst.MAP_DIR+n.mapRes+".json",a=GmGlobal.res.getVersion(h);a>1&&(h+="."+a),RES.getResByUrl(PFConst.RES_ROOT+h,this.onDataLoaded,this,RES.ResourceItem.TYPE_JSON),this.autoProgress(60)}}else this.notifyProgress(),this.notifyComplete()},e.prototype.onDataLoaded=function(t){if(!this.isStop){GmGlobal.mc.mapMgr.setBlockMapData(t);this.notifyProgress(),this.notifyComplete()}},e}(SingleOperation);__reflect(MapDataPreLoad.prototype,"MapDataPreLoad");var MiniMapPreLoad=function(t){function e(e){var i=t.call(this)||this;return i._mapId=e,i}return __extends(e,t),e.prototype.execute=function(e,i,s,o){t.prototype.execute.call(this,e,i,s,o),this._progressInfo.name="Loading map preview";var n=GmGlobal.mc.mapMgr.getMapCfg(this._mapId);if(n){var r=GmConst.MAP_DIR+n.mapRes+"/"+n.mapRes+"_preload.jpg";RES.getResByUrl(PFConst.RES_ROOT+r,this.onMiniLoaded,this,RES.ResourceItem.TYPE_IMAGE),this.autoProgress(60)}else this.notifyProgress(),this.notifyComplete()},e.prototype.onMiniLoaded=function(t){this.isStop||(SceneResPreLoad.getInstence().miniMap=t,this.notifyProgress(),this.notifyComplete())},e}(SingleOperation);__reflect(MiniMapPreLoad.prototype,"MiniMapPreLoad");var SceneResPreLoad=function(){function t(){this._percent=0,this._exitTimer=0}return t.getInstence=function(){return this._instence||(this._instence=new t),this._instence},t.prototype.show=function(t){void 0===t&&(t="Loading scene resources"),this.loadingView=LoadingView.getInstence(),this.loadingView.show(),this.loadingView.setTxt(t)},t.prototype.start=function(t,e,i){this._cb=e,this._cbThis=i,this._mapId=t;var s=GmGlobal.mc;if(this._mapCfg=s.mapMgr.getMapCfg(t),this._sequence&&(this._sequence.stop(),this._sequence.clear(),this._sequence=null),this._sequence=new SequenceOperation,this._sequence.addOperation(new MapDataPreLoad(t)),this._sequence.addOperation(new MiniMapPreLoad(t)),this._mapCfg.type!=SceneType.CITY&&!FubenType.isNoFightFb(t)){var o=s.skillMgr.getEqpSkill();if(o){var n=s.heroMgr,r=s.role,h=n.getHeroCfg(r.careerId);if(h){var a=s.btMgr.getModelPlayCfg(h.modelRes);if(a)for(var l=0;l<o.length;l++){var c=o[l],d=a[c.id];d&&(d.aef&&this._sequence.addOperation(new FilesLoadOperation(d.aef,!1,"effect")),d.ef&&this._sequence.addOperation(new FilesLoadOperation(d.ef,!1,"effect")))}}}}this._sequence.execute(this.onProgress,this.onComplete,null,this)},t.prototype.onProgress=function(t){var e;e=t.childProgress?t.current/t.total+t.childProgress.current/t.childProgress.total/t.total:t.current/t.total,this.loadingView&&this.loadingView.setPercent(Math.floor(100*e))},t.prototype.onComplete=function(t){console.log("scenePreLoad: onComplete"),this._exitTimer=egret.setTimeout(this.onShowExitTip,this,2e3),this._cb&&this._cb.call(this._cbThis,this._mapCfg,this.miniMap),this._cb=null,this._cbThis=null,this._sequence.clear(),this._sequence=null},t.prototype.onShowExitTip=function(){this.loadingView.showExitTip(),this.loadingView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTimeOut,this)},t.prototype.onTimeOut=function(){this.close()},t.prototype.isCanClose=function(t){return this._mapId&&this._mapId!=t?!1:!0},t.prototype.close=function(){console.log("scenePreLoad: closeView"),0!=this._exitTimer&&(egret.clearTimeout(this._exitTimer),this._exitTimer=0),this.loadingView&&this.loadingView.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.miniMap=null,this._mapCfg=null,this.loadingView&&(this.loadingView.close(),this.loadingView=null)},t}();__reflect(SceneResPreLoad.prototype,"SceneResPreLoad");var GameTick=function(){function t(){this._pret=0,this._ticks=[],this._timeouts=[],this._intervals=[]}return t.instence=function(){return t._instence||(t._instence=new t),t._instence},t.prototype.bindTick=function(t,e){-1==this.isBind(t,e)&&this._ticks.push({c:t,t:e})},t.prototype.isBind=function(t,e){for(var i=0;i<this._ticks.length;i++){var s=this._ticks[i];if(s.c==t&&s.t==e)return i}return-1},t.prototype.unbindTick=function(t,e){var i=this.isBind(t,e);-1!=this.isBind(t,e)&&this._ticks.splice(i,1)},t.prototype.setTimeOut=function(t,e,i){for(var s=0;s<this._timeouts.length;s++){var o=this._timeouts[s];if(o.c==e&&o.t==i)return void(o.tm=t)}this._timeouts.push({tm:t,c:e,t:i})},t.prototype.clearTimeOut=function(t,e){for(var i=0;i<this._timeouts.length;i++){var s=this._timeouts[i];if(s.c==t&&s.t==e)return void this._timeouts.splice(i,1)}},t.prototype.setInterval=function(t,e,i){for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s];if(o.c==e&&o.t==i)return o.tm=t,void(o.ct=t)}this._intervals.push({tm:t,ct:t,c:e,t:i})},t.prototype.clearInterval=function(t,e){for(var i=0;i<this._intervals.length;i++){var s=this._intervals[i];if(s.c==t&&s.t==e)return void this._intervals.splice(i,1)}},t.prototype.startTick=function(){this._pret=egret.getTimer(),egret.startTick(this.onTick,this)},t.prototype.stopTick=function(){egret.stopTick(this.onTick,this)},t.prototype.onTick=function(t){var e=(t-this._pret)/1e3;if(this._pret=t,e>.1)return!0;for(var i=0,s=this._ticks;i<s.length;i++){var o=s[i];o.c.call(o.t,e)}return this.updateTimeOut(e),this.updateInterval(e),!0},t.prototype.updateTimeOut=function(t){for(var e=0;e<this._timeouts.length;e++){var i=this._timeouts[e];i.tm-=t,i.tm<=0&&(this._timeouts.splice(e,1),e--,i.c.call(i.t))}},t.prototype.updateInterval=function(t){for(var e=0;e<this._intervals.length;e++){var i=this._intervals[e];i.ct-=t,i.ct<=0&&(i.c.call(i.t),i.ct=i.tm)}},t.prototype.clear=function(){this.stopTick(),this._ticks=[],this._intervals=[],this._timeouts=[]},t}();__reflect(GameTick.prototype,"GameTick");var JuqingSceneView=function(t){function e(){var e=t.call(this)||this;return e._idx=1,e._timerId=0,e._cfg=GmGlobal.mc.jqMgr.jqCfg,e._monsters=[],e._heros=[],e}return __extends(e,t),e.prototype.initScene=function(e,i,s){void 0===s&&(s=!1),t.prototype.initScene.call(this,e,i,s),this._ui=new JuqingSceneUI,this._ui.show(GmGlobal.vmc.uiLayer)},e.prototype.inited=function(){this.updateFocus(this.mapData.width/2,this.mapData.height/2),this.initUnits(),GameTick.instence().startTick(),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.JQ_START)},e.prototype.initUnits=function(){for(var t=this._cfg[1],e=Math.floor((1560-GmGlobal.stageHeight)/2),i=GmGlobal.stageHeight+e-400,s=i/200,o=0;o<t.msts.length;o++){var n=t.msts[o],r=this.createMonsterView(n.id);r.dir=DirType.RIGHT,r.resetPos(360+n.pos.x,GmGlobal.stageHeight+e+n.pos.y),r.speed=200,this.addUnit(r),r.moveTo(r.x,400+n.pos.y),this._monsters.push(r)}var h=this.createHeroView(1001);h.dir=DirType.UP_RIGHT;var a=260*(s+.5);h.resetPos(360,920+a),h.speed=260,this.addUnit(h),h.moveTo(h.x,920),h.bindSceneCb(this.onUnitMoveing,this.onUnitMoveEnd,this),this._heros.push(h)},e.prototype.createMonsterView=function(t){var e=GmGlobal.mc.npcMgr.getNpcCfg(t);if(!e)return null;var i=new JqMonsterView;return i.setInfo(Utils.getLocalUID(),e.res,e.h,e.scale||1,ActionType.STAND_TO),i.type=UnitType.MONSTER,i},e.prototype.createHeroView=function(t){var e=new JqHeroView,i=GmGlobal.mc.heroMgr.getHeroCfg(t);return i&&e.setInfo(Utils.getLocalUID(),i.modelRes,i.h,i.scale||1),e.type=UnitType.ROLE,e},e.prototype.showDialog=function(t,e,i){this._dialog||(this._dialog=new GuideDialog),this._dialog.parent||this._dialog.show(GmGlobal.vmc.uiLayer),this._dialog.setDialog(t,e,i)},e.prototype.onUnitMoveing=function(t){this.sortUnit(t)},e.prototype.onUnitMoveEnd=function(t){if(1==this._idx){var e=this._cfg[this._idx];this.showDialog(e.dialogs,this.onS1DialogEnd,this)}else if(2==this._idx)if(t.type==UnitType.MONSTER){var i=this._monsters.indexOf(t);i>0?(this._monsters.splice(i,1),t.dead(!0),1==this._monsters.length&&this.moveToFightPos()):(t.point.x<360?t.dir=DirType.RIGHT:t.dir=DirType.LEFT,this.checkS2Dialog())}else t.point.x<360?t.dir=DirType.RIGHT:t.dir=DirType.LEFT,this.checkS2Dialog();else if(3==this._idx)if(t.type==UnitType.ROLE){var s=t;s.startFight()}else{var o=t;o.startFight()}else if(4==this._idx){var s=this._monsters[0];this._monsters.splice(0,1),s.dead(!0),this.herosMovein()}else if(5==this._idx){var o=t;o.look(this.heroLookEnd,this),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.JQ_LX)}},e.prototype.onS1DialogEnd=function(){this._idx=2,this.monsterMoveOut()},e.prototype.monsterMoveOut=function(){for(var t=1;t<this._monsters.length;t++){var e=this._monsters[t];e.moveTo(e.x,170),e.bindSceneCb(this.onUnitMoveing,this.onUnitMoveEnd,this)}},e.prototype.moveToFightPos=function(){var t=this._monsters[0];t.moveTo(480,620),t.bindSceneCb(this.onUnitMoveing,this.onUnitMoveEnd,this);var e=this._heros[0];e.moveTo(240,620)},e.prototype.checkS2Dialog=function(){if(620==this._monsters[0].y&&620==this._heros[0].y){var t=this._cfg[2];this.showDialog(t.dialogs,this.startFight,this)}},e.prototype.startFight=function(){this._idx=3;var t=this._monsters[0];t.moveTo(420,t.point.y);var e=this._heros[0];e.moveTo(300,t.point.y)},e.prototype.heroDead=function(){var t=this._heros[0];this._heros.splice(0,1),t.dead(!0);var e=this._cfg[3];this.showDialog(e.dialogs,this.bossMoveout,this)
},e.prototype.bossMoveout=function(){this._idx=4;var t=this._monsters[0];t.moveTo(360,170)},e.prototype.herosMovein=function(){this._idx=5;for(var t=this._cfg[5],e=Math.floor((1560-GmGlobal.stageHeight)/2),i=0;i<t.heros.length;i++){var s=t.heros[i],o=this.createHeroView(s.id);o.dir=s.d,o.resetPos(360+s.pos.x,GmGlobal.stageHeight+e+s.pos.y),o.speed=200,this.addUnit(o),o.moveTo(o.x,600+s.pos.y),this._heros.push(o),0==i&&o.bindSceneCb(null,this.onUnitMoveEnd,this)}},e.prototype.heroLookEnd=function(){var t=this._cfg[5];this.showDialog(t.dialogs,this.showS6,this)},e.prototype.showS6=function(){this._mask=new eui.Rect(GmGlobal.stageWidth,GmGlobal.stageHeight,0),this._mask.alpha=0,this.addChild(this._mask),egret.Tween.get(this._mask).to({alpha:1},1e3).call(this.onTouchMask,this)},e.prototype.maskEnd=function(){this._txt=new egret.TextField,this._txt.size=28,this._txt.textColor=16777215,this._txt.width=700,this._txt.lineSpacing=10,this._txt.x=10,this._txt.text=this._cfg[6].txt,this._txt.y=(GmGlobal.stageHeight-this._txt.textHeight)/2,this.addChild(this._txt),this._mask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchMask,this),this._timerId=egret.setTimeout(this.onTouchMask,this,3e4),PFConst.PF_RP_INIT&&GmGlobal.cc.pfCtl.pfReportInitStep(PfInitStep.JQ_SM)},e.prototype.onTouchMask=function(){this.removeChild(this._mask),GmGlobal.cc.pfCtl.pfGameReport(10),CmdBus.doCmd(CmdType.EXIT_JQ)},e.prototype.clear=function(){for(var e=0,i=this._monsters;e<i.length;e++){var s=i[e];s.clear()}this._monsters=null;for(var o=0,n=this._heros;o<n.length;o++){var r=n[o];r.clear()}this._heros=null,this._ui&&(this._ui.close(),this._ui=null),this._dialog&&(this._dialog.close(),this._dialog=null),GmGlobal.sound.stopBgm(),t.prototype.clear.call(this)},e}(BlockSceneBase);__reflect(JuqingSceneView.prototype,"JuqingSceneView");var JZTSceneView=function(t){function e(){var e=t.call(this)||this;return e._sx=0,e._sy=0,e._gridW=137,e._gridH=120,e._cPos=0,e._nextPos=-1,e._isFClose=!0,e._isMEnd=!0,e._state=0,e}return __extends(e,t),e.prototype.inited=function(){t.prototype.inited.call(this),this.roleView.dir=DirType.RIGHT,this._gridLayer=new egret.DisplayObjectContainer,this.con.addChildAt(this._gridLayer,1),BattleSkillPanle.getInstence().hide();var e=this._mc.wfMgr.jztGridData;e?this.addGrid(e):EventBus.addListener(EventType.JZT_GRID_UPD,this.onGrid,this)},e.prototype.addListener=function(){t.prototype.addListener.call(this),EventBus.addListener(EventType.BATTLE_FAILE_C,this.onFaileClose,this),EventBus.addListener(EventType.JZT_RANDOM,this.onRandom,this),CmdBus.adListener(CmdType.JZT_TOPOS,this.onPos,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.JZT_RPOS,this.onResetPos,this)},e.prototype.removeListener=function(){t.prototype.removeListener.call(this),EventBus.rmListener(EventType.JZT_GRID_UPD,this.onGrid,this),EventBus.rmListener(EventType.BATTLE_FAILE_C,this.onFaileClose,this),EventBus.rmListener(EventType.JZT_RANDOM,this.onRandom,this),CmdBus.rmListener(CmdType.JZT_TOPOS,this.onPos,this),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.JZT_RPOS)},e.prototype.onGrid=function(){var t=this._mc.wfMgr.jztGridData;this.addGrid(t)},e.prototype.getGridPos=function(t){var e=this._mc.wfMgr.getJztCfg().grid,i=this._sx+e[t][0]*this._gridW,s=this._sy+e[t][1]*this._gridH;return{x:i,y:s}},e.prototype.addGrid=function(t){var e=this._mc.wfMgr.getJztCfg();this._gridMax=e.floorgrid+1;var i=e.grid;this._sx=this.roleView.x,this._sy=this.roleView.y-i[0][1]*this._gridH,this._gridCfg=i;for(var s=0;s<i.length;s++){var o=new eui.Image("wanfa_json.jzt_tz");if(o.anchorOffsetX=68,o.anchorOffsetY=35,o.x=this._sx+i[s][0]*this._gridW,o.y=this._sy+i[s][1]*this._gridH,0==s){var n=new eui.Image("wanfa_json.jzt_flg1");n.anchorOffsetX=48,n.anchorOffsetY=106,n.x=o.x,n.y=o.y-30,this._gridLayer.addChild(n)}else if(s==i.length-1){var n=new eui.Image("wanfa_json.jzt_flg2");n.anchorOffsetX=48,n.anchorOffsetY=106,n.x=o.x,n.y=o.y-30,this._gridLayer.addChild(n)}if(o.zIndex=s,this._gridLayer.addChild(o),t[s]){var r=t[s],h=this.getItemData(r.award);if(h){var a=new eui.Image(this._mc.itemMgr.getItemIcon(h.id));a.anchorOffsetX=50,a.anchorOffsetY=50,a.x=o.x,a.y=o.y+5,a.scaleX=a.scaleY=.7,this._gridLayer.addChild(a)}}}this.sortByY()},e.prototype.sortByY=function(){for(var t,e,i=0;i<this._gridLayer.numChildren;i++){t=this._gridLayer.getChildAt(i);for(var s=i+1;s<this._gridLayer.numChildren;s++)e=this._gridLayer.getChildAt(s),e.y<t.y&&(t=e,this._gridLayer.setChildIndex(e,i))}},e.prototype.getItemData=function(t){for(var e in t)return{id:Number(e),num:t[e]};return null},e.prototype.onRandom=function(t){this._state=0},e.prototype.onPos=function(t){var e=t-this._cPos;e>0?this.showStepText(e+" forward"):0>e&&this.showStepText(Math.abs(e)+" backward"),t>this._gridMax&&(t=this._gridMax);var i=[];if(t>this._cPos)for(var s=this._cPos+1;t>=s;s++)i.push(this._sx+this._gridCfg[s][0]*this._gridW,this._sy+this._gridCfg[s][1]*this._gridH);else for(var s=this._cPos-1;s>=t;s--)i.push(this._sx+this._gridCfg[s][0]*this._gridW,this._sy+this._gridCfg[s][1]*this._gridH);0!=i.length&&this._cc.sceneCtl.reqSceneMove(this.roleView.point.x,this.roleView.point.y,i,DirType.RIGHT,!1)&&(this.roleView.movePath(i),this._cPos=t)},e.prototype.showStepText=function(t){this._setpTextView||(this._setpTextView=new FloorTextView("font_saizi.fnt",!1)),this._setpTextView.x=GmGlobal.stageWidth/2,this._setpTextView.y=GmGlobal.stageHeight/2,GmGlobal.vmc.uiLayer.addChild(this._setpTextView),this._setpTextView.show(t)},e.prototype.onUnitMoveEnd=function(t){if(t==this.roleView)if(this._cPos==this._gridMax){var e=BattleWinView.getInstence();e.updateList(null,FubenType.JZTXB_W),e.show(GmGlobal.vmc.uiLayer),this._cc.dataCtl.pbReq(PbReqId.JZT_MEND,null,null,this.onMEndRet,this)}else-1!=this._nextPos?(this._gridLayer.alpha<1&&this.showFGrid(),this._isMEnd=!0,this._isMEnd&&this._isFClose&&this.moveToNextPos()):0==this._state&&this._cc.dataCtl.pbReq(PbReqId.JZT_MEND,null,null,this.onMEndRet,this)},e.prototype.onMEndRet=function(t,e){if(this._state=1,0==t)if(2==e){var i=this._mc.wfMgr.jztGridData,s=i[this._cPos];if(s){var o=this.getItemData(s.award);AwardTipView.showAward([o],this.onAwGet,this,{cb:this.onAwSbGet,itemid:s.money,num:s.buyprice,label:s.buyprice+" 2x Claim"})}}else(3==e||4==e||5==e)&&this.hideFGrid()},e.prototype.onAwGet=function(){this._cc.dataCtl.pbReq(PbReqId.JZT_GETAW,[0])},e.prototype.onAwSbGet=function(){this._cc.dataCtl.pbReq(PbReqId.JZT_GETAW,[1])},e.prototype.showFGrid=function(){BattleSkillPanle.getInstence().hide(),egret.Tween.get(this._gridLayer).to({alpha:1},200)},e.prototype.hideFGrid=function(){BattleSkillPanle.getInstence().show(),egret.Tween.get(this._gridLayer).to({alpha:0},200)},e.prototype.onResetPos=function(t){if(this._state=2,this.clearPVPAI(),PVPSceneUI.release(),t.pos<this._cPos){this._isMEnd=!1,this._isFClose=!1;var e=BattleFailView.getInstence();e.show(GmGlobal.vmc.uiLayer)}else{var e=BattleWinView.getInstence();e.updateList(null,FubenType.JZTXB),e.show(GmGlobal.vmc.uiLayer)}this._nextPos=t.pos,egret.setTimeout(this.delayMto,this,1e3)},e.prototype.delayMto=function(){var t=this.getGridPos(this._cPos);this.moveToPoint(t.x,t.y)||(this.showFGrid(),BattleFailView.getInstence().isShow?this._isMEnd=!0:this.moveToNextPos())},e.prototype.moveToNextPos=function(){this._nextPos==this._cPos?(this._nextPos=-1,2==this._state&&(this._state=3,this._cc.dataCtl.pbReq(PbReqId.JZT_RSETPOS,null,null))):this.onPos(this._nextPos)},e.prototype.onFaileClose=function(){this._isFClose=!0,this._isFClose&&this._isMEnd&&this.moveToNextPos()},e.prototype.clear=function(){this._mc.wfMgr.jztGridData=null,this.clearPVPAI(),PVPSceneUI.release(),t.prototype.clear.call(this)},e}(PVPSceneView);__reflect(JZTSceneView.prototype,"JZTSceneView");var MMSceneView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addListener=function(){t.prototype.addListener.call(this),EventBus.addListener(EventType.MM_CAT_UPD,this.onCatInfo,this)},e.prototype.removeListener=function(){t.prototype.removeListener.call(this),EventBus.rmListener(EventType.MM_CAT_UPD,this.onCatInfo,this)},e.prototype.onCatInfo=function(){var t=GmGlobal.mc.wfMgr.mmCatInfo;for(var e in t){var i=Number(e),s=this.getSceneUnitView(i,UnitType.ROLE);s&&s.setMMNum(t[e])}},e}(SceneView);__reflect(MMSceneView.prototype,"MMSceneView");var GameTime=function(){function t(t){this.setTime(t)}return t.prototype.setTime=function(t){this._t=t,this._st=egret.getTimer()},t.prototype.restart=function(){this._st=egret.getTimer()},Object.defineProperty(t.prototype,"time",{get:function(){var t=egret.getTimer(),e=Math.floor((t-this._st)/1e3);return this._t+e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cd",{get:function(){var t=egret.getTimer(),e=Math.floor((t-this._st)/1e3);return Math.max(this._t-e,0)},enumerable:!0,configurable:!0}),t}();__reflect(GameTime.prototype,"GameTime");var HitFlyAction=function(){function t(){this._s=0,this._ts=0,this._v=1e3,this._x=0,this._y=0,this._rotate=0,this._radian=0,this.isEnd=!1}return t.create=function(){var e=this._pool.pop();return e||(e=new t),e},t.release=function(t){t&&(t.isEnd||t.stop(),-1==this._pool.indexOf(t)&&this._pool.push(t))},t.prototype.fly=function(t,e,i,s){this._mView=t,this._radian=e,this._cb=i,this._thisObj=s,this.isEnd=!1,this._preTime=egret.getTimer(),egret.startTick(this.onTick,this)},t.prototype.onTick=function(t){var e=(t-this._preTime)/1e3;this._preTime=t;var i=this;return i._mView.alpha-=.03,i._mView.alpha<=0?void i.stop():i._mView.x<-80||i._mView.x>GmGlobal.stageWidth+80||i._mView.y<-80||i._mView.y>GmGlobal.stageHeight+80?(i._cb.call(i._thisObj),void i.stop()):(i._rotate+=i._v/60,i._mView.rotation=i._rotate,i._rotate>360?i._rotate-=360:i._rotate<-360&&(i._rotate+=360),i._s=e*i._v,i._ts+=i._s,i._x=i._s*Math.cos(i._radian),i._y=i._s*Math.sin(i._radian),i._mView.x+=i._x,i._mView.y+=i._y,i._mView.x=i._mView.x,i._mView.y=i._mView.y,!0)},t.prototype.stop=function(){this.isEnd||(this.isEnd=!0,this._mView=null,this._cb=null,this._thisObj=null,egret.stopTick(this.onTick,this))},t._pool=[],t}();__reflect(HitFlyAction.prototype,"HitFlyAction");var YBSceneView=function(t){function e(){var e=t.call(this)||this;return e._isYabiao=!0,e._bcs={},e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this._smgr.mapId==FubenType.YABIAO_Y?this._isYabiao=!0:this._isYabiao=!1,this._maxNum=GmGlobal.mc.mapMgr.getMapMaxRole(this._smgr.mapId),-1==this._maxNum&&(this._maxNum=20)},e.prototype.initScene=function(e,i){t.prototype.initScene.call(this,e,i,this._isYabiao?!1:!0)},e.prototype.initUnit=function(){this.initHero();var t=GmGlobal.mc,e=t.wfMgr.bcList;e&&this.updateBiaoces()},e.prototype.initUI=function(){},e.prototype.inited=function(){this.addListener();var t=GameTick.instence();t.startTick(),t.bindTick(this.onTick,this)},e.prototype.addListener=function(){t.prototype.addListener.call(this),EventBus.addListener(EventType.YB_UPD,this.onBaocheUpd,this),EventBus.addListener(EventType.YB_LEVEL,this.onBcLevel,this),CmdBus.adListener(CmdType.S_BCJS,this.showJsEffect,this)},e.prototype.removeListener=function(){t.prototype.removeListener.call(this),EventBus.rmListener(EventType.YB_UPD,this.onBaocheUpd,this),EventBus.rmListener(EventType.YB_LEVEL,this.onBcLevel,this),CmdBus.rmListener(CmdType.S_BCJS,this.showJsEffect,this)},e.prototype.onYgDirChange=function(e){this._isYabiao||t.prototype.onYgDirChange.call(this,e)},e.prototype.onTouchUnit=function(t){if(!this._isYabiao&&t.target.uid&&t.target.type==UnitType.BIAOCHE){var e=this._bcs[t.target.uid];e&&!e.isBh&&GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_ACTION,[1,e.uid])}},e.prototype.onBaocheUpd=function(t){this.updateBiaoces(t.data)},e.prototype.onBcLevel=function(t){var e=t.data;this.rmBiaoche(e)},e.prototype.addMyHero=function(t){if(void 0===t&&(t=null),this.roleView=UnitViewCreator.instence().createMyRoleView(),this.roleView.touchEnabled=!1,t)t.roleView=this.roleView,t.updateRolePos(),this.roleView.dir=DirType.RIGHT,this.roleView.setAction(ActionType.RUN);else{var e=GmGlobal.mc.wfMgr.getYbCfg(),i=e.srect.x+e.srect.w-200,s=e.srect.y+e.srect.h/2;this.roleView.resetPos(i,s),this.roleView.dir=DirType.LEFT,this.roleView.setAction(ActionType.STAND)}this.addUnit(this.roleView),this.updateFocus(this.roleView.point.x,this.roleView.point.y),this.updateToushi(this.roleView),this._isYabiao||this.roleView.bindSceneCb(this.onUnitMoving,this.onUnitMoveEnd,this)},e.prototype.addOtherHero=function(t){var e={uid:Utils.getLocalUID(),direct:DirType.RIGHT,arg:{careerId:t.bcData.career,name:t.bcData.name,ts:t.bcData.hwear,hp:100,hpmax:100}},i=UnitViewCreator.instence().createRoleView(e);i.touchEnabled=!1,t.roleView=i,t.updateRolePos(),this.sortUnit(i),i.setAction(ActionType.RUN),this.addUnit(i),this.updateToushi(i)},e.prototype.onUnitMoving=function(t){this.sortUnit(t),t==this.roleView&&this.updateFocus(this.roleView.point.x,this.roleView.point.y)},e.prototype.onTouchMap=function(e){this._isYabiao||t.prototype.onTouchMap.call(this,e)},e.prototype.createPetView=function(t){},e.prototype.updateBiaoces=function(t){void 0===t&&(t=null);var e=GmGlobal.mc;if(t&&(t=e.wfMgr.bcList),t){var i=GmGlobal.mc.wfMgr.getYbCfg(),s=GmGlobal.getServerMSTime();for(var o in t){var n=t[o];if(n.q){var r=void 0;this._bcs[n.carid]?(r=this._bcs[n.carid],r.bcData=n):(r=this.addBiaoche(n,Number(o)),n.carid==e.role.roleId?(r.roleView=this.roleView,r.updateRolePos(),this.sortUnit(r.roleView),this.roleView.dir=DirType.RIGHT,this.roleView.setAction(ActionType.RUN)):this.addOtherHero(r)),r.startTime=egret.getTimer();var h=n.s||0;if(r.speedScale=1+h*i.js,0==r.sx){r.sx=n.x||1;var a=s-1e3*n.xtime;a>0&&(r.sx=r.sx+a/1e3*r.speedScale*r.speed)}else r.sx=r.point.x-r.ox;h==i.jsPrice.length&&r.setBhState(!0);var l=1e3*n.robetime||0;r.setBhTime(l>s?l-s:0),r.updatePos()}}}},e.prototype.addBiaoche=function(t,e){var i=UnitViewCreator.instence().createBcView(t);this._bcs[t.carid]=i;var s=GmGlobal.mc.wfMgr.getYbCfg(),o=s.srect.x,n=s.srect.h/this._maxNum,r=Math.floor(s.srect.y+n*e-n/2);return i.resetPos(o,r),i.bcData=t,i.speed=s.srect.w/s.movetime,i.ox=s.srect.x,i.ex=s.srect.x+s.srect.w,i.startTime=egret.getTimer(),this.addUnit(i),i},e.prototype.onTick=function(t){var e=GmGlobal.getServerMSTime();for(var i in this._bcs){var s=this._bcs[i];s.bcData.stop||(s.updatePos(),s.bhTime>0&&e>=s.bhTime&&s.setBhTime(0),this._isYabiao&&s.roleView==this.roleView?this.updateFocus(this.roleView.point.x,this.roleView.point.y):s.point.x>=s.ex&&this.rmBiaoche(s.uid))}},e.prototype.showJsEffect=function(){var t=this._bcs[this.roleView.uid];if(t){var e=McEffect.create("msskill3");e.show(t,0,-75),GmGlobal.sound.playSoundEffect("yx63006")}},e.prototype.rmBiaoche=function(t){var e=this._bcs[t];e&&(e.roleView!=this.roleView?(this.removeUnit(e.roleView),UnitViewCreator.instence().releaseRoleView(e.roleView)):this.rmMyRoleView(),this.removeUnit(e),UnitViewCreator.instence().releaseBcView(e),delete this._bcs[t])},e.prototype.rmAllUnit=function(){for(var t in this._bcs){var e=this._bcs[t];e.roleView!=this.roleView&&(this.removeUnit(e.roleView),UnitViewCreator.instence().releaseRoleView(e.roleView),this.removeUnit(e),UnitViewCreator.instence().releaseBcView(e))}this._bcs=null,GmGlobal.mc.wfMgr.bcList=null},e.prototype.rmMyRoleView=function(){this.roleView.stand(),this.roleView.removeBindCb(),this.roleView.lockedView=null,this.removeUnit(this.roleView),this.roleView.unuse(),this.roleView=null},e.prototype.clear=function(){this.rmAllUnit(),t.prototype.clear.call(this)},e}(SceneView);__reflect(YBSceneView.prototype,"YBSceneView");var BiaocheTitle=function(t){function e(){var e=t.call(this)||this;return e.skinName="BCTitleSkin",e}return __extends(e,t),e.prototype.setTitleInfo=function(t){var e;2==t?(e="Silver",this.nameTxt.textColor=7321049):3==t?(e="Gold",this.nameTxt.textColor=16088800):4==t?(e="Legend",this.nameTxt.textColor=16760832):(e="Normal",this.nameTxt.textColor=16777215),this.nameTxt.text=e+" Escort Cart",this.anchorOffsetX=this.width/2},e.prototype.setName=function(t){},e.prototype.setGonghui=function(t){},e.prototype.setOffsetY=function(t){this.offsetY=-t},e.prototype.remove=function(){},e.prototype.show=function(t){},e.prototype.updateHP=function(t){},e.prototype.resetHP=function(t,e){},e.prototype.unuse=function(){},e.prototype.reuse=function(){},e.prototype.clear=function(){},e}(UnitTitle);__reflect(BiaocheTitle.prototype,"BiaocheTitle");var MonsterTitle=function(t){function e(){var e=t.call(this)||this;return e._isBoss=!1,e.skinName="MonsterTitleSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.hpBar.slideDuration=200},e.prototype.setTitleInfo=function(t,e,i,s,o,n){void 0===n&&(n=!1);var r=GmGlobal.mc.npcMgr,h=r.getNpcCfg(t);h&&(i>0?this.nTxt.text="Lv."+i+"  "+h.name:this.nTxt.text=e,this.wx.source=r.getWxImg(h.eleattrid),this.xt.source=r.getTxImg(h.shapeattrid),this.lx.source=r.getLeixiImg(h.raceattrid)),h&&2==h.type?this._isBoss=!0:this._isBoss=!1,this.hpBar.skinName=n?"HpBarSkin1":"HpBarSkin2",this.hpBar.maximum=o,this.hpBar.value=s,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height},e.prototype.setName=function(t){},e.prototype.setGonghui=function(t){},e.prototype.setOffsetY=function(t){this.offsetY=-t},e.prototype.remove=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this)},e.prototype.show=function(t){void 0===t&&(t=!0),this._isBoss||(this.visible=!0,this.alpha=1,egret.Tween.removeTweens(this),t&&egret.Tween.get(this).wait(1e3).to({alpha:0},500).call(this.onHideEnd,this))},e.prototype.onHideEnd=function(){this.visible=!1},e.prototype.updateHP=function(t){this.hpBar.value=t},e.prototype.getHp=function(){return this.hpBar.value},e.prototype.resetHP=function(t,e){this.hpBar.maximum=e,this.hpBar.value=t},e.prototype.unuse=function(){},e.prototype.reuse=function(){},e.prototype.clear=function(){this.remove()},e}(UnitTitle);__reflect(MonsterTitle.prototype,"MonsterTitle");var NpcTitle=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e._timg=new eui.Image,e.addChild(e._timg),e._timg.x=-80,e._timg.y=-60,e}return __extends(e,t),e.prototype.setTitleInfo=function(t){this._timg.source="npct_json.npc_t_"+t},e.prototype.setName=function(t){},e.prototype.setGonghui=function(t){},e.prototype.setOffsetY=function(t){this.offsetY=-t},e.prototype.remove=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this)},e.prototype.show=function(t){void 0===t&&(t=!0)},e.prototype.updateHP=function(t){},e.prototype.resetHP=function(t,e){},e.prototype.unuse=function(){},e.prototype.reuse=function(){},e.prototype.clear=function(){this.remove()},e}(UnitTitle);__reflect(NpcTitle.prototype,"NpcTitle");var RoleTitle=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleTitleSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.hpBar.slideDuration=200},e.prototype.setTitleInfo=function(t,e,i,s,o){void 0===i&&(i=0),void 0===s&&(s=0),void 0===o&&(o=!1),this.nameTxt.text=t,this.nameTxt.textColor=e?577829:16777215,GmGlobal.mc.sceneMgr.mapType==SceneType.CITY?(this.hpBar.visible=!1,this.nameTxt.y=0,this.ghTxt.y=this.nameTxt.height+4):(this.hpBar.visible=!0,this.hpBar.maximum=s,this.hpBar.value=i,this.nameTxt.y=this.hpBar.height+4,this.ghTxt.y=this.nameTxt.y+this.nameTxt.height+4,this.hpBar.skinName=o?"HpBarSkin1":"HpBarSkin2"),this.anchorOffsetX=this.width/2},e.prototype.setName=function(t){this.nameTxt.text=t},e.prototype.setGonghui=function(t){t&&""!=t?(this.ghTxt.text=t,this.ghTxt.visible=!0):this.ghTxt.visible=!1},e.prototype.setOffsetY=function(t){this.offsetY=-t},e.prototype.remove=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this)},e.prototype.updateHP=function(t){this.hpBar.value=t},e.prototype.getHp=function(){return this.hpBar.value},e.prototype.resetHP=function(t,e){this.hpBar.maximum=e,this.hpBar.value=t},e.prototype.show=function(t){void 0===t&&(t=!0)},e.prototype.unuse=function(){},e.prototype.reuse=function(){},e.prototype.clear=function(){this.remove()},e}(UnitTitle);__reflect(RoleTitle.prototype,"RoleTitle");var Jitter=function(){function t(){this._scale=1,this._isStop=!1}return t.create=function(){var e=ObjectPool.pop("jitter");return e||(e=new t),e},t.release=function(t){ObjectPool.push(t,"jitter")},t.prototype.start=function(t,e,i,s,o){this._target=t,this._d=e,this._dir=i,this._strength=s,this._damping=o,this._initX=t.x,this._initY=t.y,this._preTime=egret.getTimer(),this._isStop=!1,GameTick.instence().setInterval(.05,this.onTick,this)},t.prototype.onTick=function(t){return this._isStop?void 0:(this._d-=.05,0==this._dir?this._target.x=this._initX+this._strength*this._scale:this._target.y=this._initY+this._strength*this._scale,this._scale=-this._scale,this._strength-=this._damping,(this._strength<=0||this._d<=0)&&this.stop(),!0)},t.prototype.stop=function(){this._isStop=!0,GameTick.instence().clearInterval(this.onTick,this),this._target.x=this._initX,this._target.y=this._initY},t.prototype.reuse=function(){this._target=null,this._d=0,this._dir=1,this._strength=0,this._damping=0,this._initX=0,this._initY=0,this._scale=1},t.prototype.unuse=function(){this.stop(),this._target=null},t.prototype.clear=function(){this.unuse()},t}();__reflect(Jitter.prototype,"Jitter",["IObject"]);var BattleFailView=function(t){function e(){var e=t.call(this,"BattleFailViewSkin")||this;return e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.delayEnd=function(){t.prototype.delayEnd.call(this),this.tTip.visible=!0},e.prototype.show=function(e){t.prototype.show.call(this,e),this.tTip.visible=!1},e.prototype.setFbType=function(t){this._fbType=t},e.prototype.clear=function(){this._fbType=0,t.prototype.close.call(this)},e.prototype.close=function(){var e,i=0;this._fbType==FubenType.YABIAO_F?GmGlobal.mc.wfMgr.isYbAction||(i=CmdType.O_WANFA,e=2):this._fbType==FubenType.ARENA?(i=CmdType.O_WANFA,e=0):this._fbType==FubenType.SHENY&&(i=CmdType.O_WANFA,e=6),i&&CmdBus.doCmd(i,e),(this._fbType==FubenType.ARENA||this._fbType==FubenType.CT_PT||this._fbType==FubenType.CT_SY||this._fbType==FubenType.DAOC||this._fbType==FubenType.SWSX)&&GmGlobal.cc.sceneCtl.reqExitScene(),EventBus.dispatchEvt(EventType.BATTLE_FAILE_C),t.prototype.close.call(this)},e}(BattleResultView);__reflect(BattleFailView.prototype,"BattleFailView");var BattleMVPAWItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=GmGlobal.mc;this.nameTxt.text=this.data.rolename,this.cIconQ.source=t.itemMgr.getItemIconK(this.data.itemid),this.cIcon.source=t.itemMgr.getItemIcon(this.data.itemid);var e=t.itemMgr.getItemCfg(this.data.itemid);this.star.visible=e.isBoss,this.tNum.text=this.data.itemnum},e}(eui.ItemRenderer);__reflect(BattleMVPAWItem.prototype,"BattleMVPAWItem");var BattleMVPWinView=function(t){function e(){var e=t.call(this,"BattleMvpWinSkin")||this;return e._timerId=-1,e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="BattleMvpAwItemSkin",this.itemList.itemRenderer=BattleMVPAWItem},e.prototype.addEvts=function(){t.prototype.addEvts.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.rmEvts=function(){t.prototype.rmEvts.call(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.updateList=function(t){this._array.removeAll();var e=0;for(var i in t)this._array.addItem(t[i]),e++;var s=115*e+10*(e-1);this.scoll.x=Math.max(0,(this.width-s)/2),this.clearTimer(),this._timerId=egret.setTimeout(this.onTimeout,this,1e4);var o=GmGlobal.vmc.scene.currenScene;o.showMvpAw(t)},e.prototype.onTouch=function(t){if(t.target.parent.data){t.target.parent.data;ItemTips.show(t.target.parent.data.itemid,t.stageX,t.stageY)}else this.close()},e.prototype.onTimeout=function(){this._timerId=-1,this.close()},e.prototype.clearTimer=function(){-1!=this._timerId&&(egret.clearTimeout(this._timerId),this._timerId=-1)},e.prototype.close=function(){this.clearTimer(),t.prototype.close.call(this)},e}(BattleResultView);__reflect(BattleMVPWinView.prototype,"BattleMVPWinView");var BattleRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleRankItemSkin",e}return __extends(e,t),e.create=function(){var t=this._pool.pop();return t||(t=new e),t},e.release=function(t){t.parent&&t.parent.removeChild(t),-1==this._pool.indexOf(t)&&this._pool.push(t)},e.prototype.setData=function(t,e,i){this.tRank.text=t.toString(),this.tName.text=e,this.tHp.text=Utils.formatNum(i,0),this.height=this.tName.height},e._pool=[],e}(eui.Component);__reflect(BattleRankItem.prototype,"BattleRankItem");var BattleRankView=function(t){function e(){var e=t.call(this)||this;return e._items=[],e.skinName="BattleRankSkin",e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.updatePos=function(){var t=GmGlobal.vmc.scene.currenScene;this.x=Math.min(t.blockMap.width-this.width-2,GmGlobal.stageWidth-this.width-2)},e.prototype.updateYPos=function(){var t=0;t=BossHpBar.isShow()?BossHpBar.getInstance().height+BossHpBar.getInstance().y+10:WanfaSceneUIBase.currentUI?WanfaSceneUIBase.currentUI.y+WanfaSceneUIBase.currentUI.getHeight()+10:GmConst.IS_FULLSCENE?GmConst.TOP_SPACE+370:370,this.y=t},e.prototype.show=function(){this.parent||GmGlobal.vmc.scene.currenScene.addChild(this),this.updateYPos(),this.updatePos(),EventBus.addListener(EventType.RESIZE,this.updatePos,this),EventBus.addListener(EventType.BOSSHP_SHOW,this.updateYPos,this)},e.prototype.updateItem=function(t){for(var e=Utils.getObjectLength(t.rank),i=e;i<this._items.length;i++){var s=this._items[i];BattleRankItem.release(s),this._items.splice(i,1),i--}!this.parent&&this._items.length>0&&this.show()},e.prototype.updateHpData=function(t){this.title.text="DMG Ranking",this.myHp.text="My DMG："+Utils.formatNum(t.hp,0);var e=[];for(var i in t.rank){var s=t.rank[i];Number(i);e.push({id:Number(i),name:s.name,hp:s.hp})}e.sort(function(t,e){return e.hp-t.hp});for(var o=Math.min(10,e.length),n=40,r=0;o>r;r++){var h=e[r],a=null;r<this._items.length?a=this._items[r]:(a=BattleRankItem.create(),this._items.push(a)),a.setData(r+1,h.name,h.hp),a.x=10,a.y=n,n+=a.height+4,a.parent||this.addChild(a)}this.updateItem(t),this.height=80+Math.max(n-40,80)},e.prototype.updateSData=function(t){this.title.text="Points Ranking",this.myHp.text="My Points："+t.s;var e=0,i=40;for(var s in t.rank){var o=t.rank[s],n=(Number(s),null);e<this._items.length?n=this._items[e]:(n=BattleRankItem.create(),this._items.push(n)),n.setData(e+1,o.name,o.s),n.x=10,n.y=i,i+=n.height+4,n.parent||this.addChild(n),e++}this.updateItem(t),this.height=80+Math.max(i-40,80)},e.prototype.close=function(){EventBus.rmListener(EventType.RESIZE,this.updatePos,this),EventBus.rmListener(EventType.BOSSHP_SHOW,this.updateYPos,this),this.parent&&this.parent.removeChild(this);for(var t=0,e=this._items;t<e.length;t++){var i=e[t];BattleRankItem.release(i)}this._items=[]},e}(eui.Component);__reflect(BattleRankView.prototype,"BattleRankView");var ObjectPool=function(){function t(){}return t.pop=function(e){var i=t._pools[e];if(!i||0==i.length)return null;var s=i.pop();return s.reuse(),s},t.push=function(e,i){if(e){var s=t._pools[i];s||(s=[],t._pools[i]=s),e.unuse(),-1==s.indexOf(e)&&s.push(e)}},t.clear=function(e){var i=t._pools[e];if(i){for(var s=0,o=i;s<o.length;s++){var n=o[s];n.clear()}delete t._pools[e]}},t._pools={},t}();__reflect(ObjectPool.prototype,"ObjectPool");var BattleSkillItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.touchEnabled=!0,e.icon=new eui.Image,e.icon.width=50,e.icon.height=50,e.addChild(e.icon),e.skMask=new eui.Image,e.skMask.width=50,e.skMask.height=50,e}return __extends(e,t),e.prototype.setMask=function(t){t?this.skMask.parent||this.addChild(this.skMask):this.skMask.parent&&this.removeChild(this.skMask)},e}(egret.DisplayObjectContainer);__reflect(BattleSkillItem.prototype,"BattleSkillItem");var BattleSkillPanle=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e._items={},e._cdTxts={},e._cdLsit={},e._iconCon=new egret.DisplayObjectContainer,e._iconCon.touchChildren=!0,e.addChild(e._iconCon),e._cdTxtCon=new egret.DisplayObjectContainer,e._cdTxtCon.touchEnabled=!1,e._cdTxtCon.touchChildren=!1,e.addChild(e._cdTxtCon),e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.RESIZE,this.resize,this),EventBus.addListener(EventType.M_SKILL_UPD,this.onSkillUpdate,this),EventBus.addListener(EventType.S_SP_CH,this.onSpUpdate,this),CmdBus.adListener(CmdType.BATTLE_USE_SKILL,this.useSkill,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.RESIZE,this.resize,this),EventBus.rmListener(EventType.M_SKILL_UPD,this.onSkillUpdate,this),EventBus.rmListener(EventType.S_SP_CH,this.onSpUpdate,this),CmdBus.rmListener(CmdType.BATTLE_USE_SKILL,this.useSkill,this)},e.prototype.show=function(){this.parent||(GmGlobal.vmc.scene.currenScene.addChild(this),this.addEvts());var t=GmGlobal.mc,e=t.heroMgr.getHeroCfg(t.role.careerId);this._iconRes="skicon"+e.career+"_json.",this._numberRes=this._iconRes+"cd_",this.updateList(),this.updateSpState(),Utils.getObjectLength(this._cdLsit)>0&&GameTick.instence().setInterval(.1,this.onTime,this),this.resize()},e.prototype.onSkillUpdate=function(){this.updateList()},e.prototype.clearList=function(){for(;this._iconCon.numChildren>0;)this._iconCon.removeChildAt(0);for(;this._cdTxtCon.numChildren>0;)this._cdTxtCon.removeChildAt(0);this._skillList=[]},e.prototype.updateList=function(){this.clearList();var t=GmGlobal.mc,e=t.skillMgr.getEqpSkill();if(e){for(var i=0,s=0;s<e.length;s++){var o=e[s],n=t.skillMgr.getSkillCfg(o.id);if(0!=n.type){this._skillList.push(o.id);var r=this._items[o.id];if(r||(r=new BattleSkillItem,r.skId=o.id,r.cd=n.cd,r.sp=n.sp,r.icon.source=this._iconRes+n.icon,r.skMask.source=this._iconRes+"mask",this._items[o.id]=r),r.index=i,this._iconCon.addChild(r),r.y=52*i,this._cdLsit[o.id]){var h=this._cdLsit[o.id];h.cd>0&&this.showCdText(o.id,h.cd)}i++}}this.resize()}},e.prototype.showCdText=function(t,e){var i=this._items[t];i.setMask(!0);var s=this._cdTxts[t];s||(s=BitmapNumber.create(),this._cdTxts[t]=s),s.parent||this._cdTxtCon.addChild(s),s.setNumber(e,this._numberRes),s.x=(50-s.width)/2,s.y=52*i.index+(50-s.height)/2},e.prototype.hideCdText=function(t){var e=this._items[t];e.setMask(!1);var i=this._cdTxts[t];i&&i.parent&&this._cdTxtCon.removeChild(i),this.updateSkillSp(e)},e.prototype.resize=function(){this.y=Math.round((GmGlobal.stageHeight-52*this._iconCon.numChildren)/2)+45},e.prototype.getFreeSkill=function(){var t=GmGlobal.mc;if(!this._skillList)return 0;for(var e=0;e<this._skillList.length;e++){var i=this._skillList[e],s=t.btMgr.getSkillCD(i);if(!(s.cd>0)){var o=this._items[i];if(!(t.role.sp<o.sp))return i}}return 0},e.prototype.onTouchList=function(t){var e=t.target;e.skId&&this.doSkill(e.skId)},e.prototype.doSkill=function(t){var e=GmGlobal.mc.btMgr.getSkillCD(t);if(!(e.cd>0)){var i=this._items[t],s=GmGlobal.mc.role;s.sp<i.sp||GmGlobal.vmc.scene.currenScene.doSkillAttack(t)}},e.prototype.useSkill=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=1);
var s=GmGlobal.mc;if(2==i){if(s.btMgr.getSkillCD(t).cd>0)return;var o=this._items[t],n=s.role;n.sp-=Math.floor(o.sp*s.sceneMgr.spRate),EventBus.dispatchEvt(EventType.S_SP_CH),e=Math.floor(s.sceneMgr.cdRate*o.cd)}if(!(0>=e)){var r=s.btMgr.setSkillCD(t,e);this._cdLsit[t]=r,this.showCdText(t,e),1==Utils.getObjectLength(this._cdLsit)&&GameTick.instence().setInterval(.1,this.onTime,this)}},e.prototype.onTime=function(t){var e=0;for(var i in this._cdLsit){var s=Number(i),o=this._cdLsit[i];if(0==o.cd)delete this._cdLsit[i],this.hideCdText(s);else{var n=this._cdTxts[s];n&&(n.setNumber(o.cd,this._numberRes),n.x=(50-n.width)/2),e++}}e||GameTick.instence().clearInterval(this.onTime,this)},e.prototype.onSpUpdate=function(){this.updateSpState()},e.prototype.updateSpState=function(){for(var t in this._items){var e=this._items[t];this.updateSkillSp(e)}},e.prototype.updateSkillSp=function(t){var e=GmGlobal.mc.role;this._cdLsit[t.skId]||t.setMask(t.sp<=e.sp?!1:!0)},e.prototype.hide=function(){this.parent&&(GameTick.instence().clearInterval(this.onTime,this),this.rmEvts(),this.parent.removeChild(this))},e}(egret.DisplayObjectContainer);__reflect(BattleSkillPanle.prototype,"BattleSkillPanle");var BattleWinView=function(t){function e(){var e=t.call(this,"BattleWinViewSkin")||this;return e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.show=function(e){t.prototype.show.call(this,e),this.tTip.visible=!1},e.prototype.delayEnd=function(){t.prototype.delayEnd.call(this),this.tTip.visible=!0},e.prototype.setTxtType=function(t){void 0===t&&(t=1),1==t?this.timg1.visible=!0:this.timg1.visible=!1},e.prototype.updateList=function(t,e){if(this.clearItems(),this._fbType=e,e==FubenType.YABIAO_Y?this.setTxtType(2):this.setTxtType(1),!t||0==t.length)return void(this.txtCon.visible=!1);this.txtCon.visible=!0,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,100,!1,t.length<=6?!0:!1,!1),this._itemGridCon.addToParent(10,10,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0),t.length<=6&&(this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER);var i=110*(Math.ceil(t.length/6)-1);this.itemBg.height=318+i,this.height=537+i},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.clear=function(){this.clearItems(),t.prototype.close.call(this)},e.prototype.close=function(){this.clearItems();var e,i=0;this._fbType==FubenType.YABIAO_Y?(i=CmdType.O_WANFA,e=2):this._fbType==FubenType.CT_PT||this._fbType==FubenType.CT_SY?(i=CmdType.O_WANFA,e=1):this._fbType==FubenType.ARENA?(i=CmdType.O_WANFA,e=0):this._fbType==FubenType.YABIAO_F?GmGlobal.mc.wfMgr.isYbAction||(i=CmdType.O_WANFA,e=2):this._fbType==FubenType.SHENY?(i=CmdType.O_WANFA,e=6):this._fbType==FubenType.JZTXB_W&&(i=CmdType.O_WANFA,e=13),i&&CmdBus.doCmd(i,e),(this._fbType==FubenType.ARENA||this._fbType==FubenType.CT_PT||this._fbType==FubenType.CT_SY||this._fbType==FubenType.DAOC||this._fbType==FubenType.SWSX||this._fbType==FubenType.JZTXB_W)&&GmGlobal.cc.sceneCtl.reqExitScene(),t.prototype.close.call(this)},e}(BattleResultView);__reflect(BattleWinView.prototype,"BattleWinView");var BossHpBar=function(t){function e(){var e=t.call(this)||this;return e.BAR_NUM=5,e.topSpace=164,e.skinName="BossHpSkin",e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.isShow=function(){return this._instence&&this._instence.parent?!0:!1},e.prototype.setInfo=function(t,e,i,s){this.uid=t,this._hpMax=s,this.nameTxt.text=e,this.bar.maximum=s,this._step=Math.ceil(s/this.BAR_NUM),this.bar.maximum=this._step,this.setHp(i)},e.prototype.setHp=function(t){this.hpTxt.text=t+"/"+this._hpMax,this.updateBar(t)},e.prototype.updateBar=function(t){var e=Math.ceil(t/this._step);0==e&&(e=1),e!=this._idx&&(this.bar.value=this._step,this._idx=e),this.bg.source="com_json.boss_hp_"+(e-1);var i=this.bar.thumb;if(i.source="com_json.boss_hp_"+e,t!=this._hpMax){var s=t%this._step;this.bar.value=s}},e.prototype.show=function(t){this.parent||(t.addChild(this),this.topSpace=GmConst.UI_FREE_Y,this.onResize(),EventBus.addListener(EventType.RESIZE,this.onResize,this),EventBus.dispatchEvt(EventType.BOSSHP_SHOW),this._idx=this.BAR_NUM,this.alpha=0,egret.Tween.get(this).to({alpha:1},500))},e.prototype.onResize=function(){this.x=(GmGlobal.stageWidth-this.width)/2,GmConst.IS_FULLSCENE?this.y=GmConst.BOTTOM_SPACE+this.topSpace:this.y=this.topSpace},e.prototype.close=function(){EventBus.rmListener(EventType.RESIZE,this.onResize,this),this.parent&&(this.parent.removeChild(this),EventBus.dispatchEvt(EventType.BOSSHP_HIDE),BattleRankView.getInstance().close())},e}(eui.Component);__reflect(BossHpBar.prototype,"BossHpBar");var BoxOpenView=function(t){function e(){return t.call(this,"ZhuabuSkin")||this}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.close=function(){this._instence&&this._instence.isShow&&this._instence.close()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.setBoxInfo=function(t,e,i,s,o){this.id=t,this.sTxt=e,this.time=i,this._t=0,this._cb=s,this._thisObj=o},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0,.1),this.txt.text=this.sTxt,this.bar.value=0,GameTick.instence().setInterval(.05,this.onTime,this)},e.prototype.onTime=function(t){this._t+=.05,this.bar.value=Math.ceil(this._t/this._t*100),100==this.bar.value&&(GameTick.instence().clearInterval(this.onTime,this),GmGlobal.cc.dataCtl.pbReq(PbReqId.OPENS_S_BOX,[this.id],null,this.onRet,this))},e.prototype.openBox=function(t){GmGlobal.cc.dataCtl.pbReq(PbReqId.OPENS_S_BOX,[t])},e.prototype.onRet=function(){this._cb&&this._cb.call(this._thisObj),this.close()},e.prototype.maskClose=function(){MsgBox.prompt("Stop Opening"),this._cb&&this._cb.call(this._thisObj),this.close()},e.prototype.close=function(){this.bar.value<100&&GameTick.instence().clearInterval(this.onTime,this),this.bar.value=0,this._cb=null,this._thisObj=null,t.prototype.close.call(this)},e}(UIBase);__reflect(BoxOpenView.prototype,"BoxOpenView");var DelayTimeView=function(t){function e(){var e=t.call(this)||this;return e.skinName="DeadTimeSkin",e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&this._instence.close(),this._instence=null},e.isShow=function(){return this._instence&&this._instence.parent?!0:!1},e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2,GmConst.IS_FULLSCENE?this.y=GmGlobal.stageHeight-300-this.height-GmConst.BOTTOM_SPACE:this.y=GmGlobal.stageHeight-300-this.height},e.prototype.show=function(t,e,i,s,o){this.parent||t.addChild(this),this.updatePos(),this._cb=s,this._cbObj=o,this._txt=i,this._cd?this._cd.setTime(e):this._cd=new GameTime(e),GameTick.instence().setInterval(1,this.onTime,this),this.onTime()},e.prototype.onTime=function(){var t=this._cd.cd;this.txt.text="Dead, TP in "+t+"s",this.txt.text=this._txt.replace("%s",t.toString()),0==t&&this.onTimeOut()},e.prototype.onTimeOut=function(){this._cb&&this._cb.call(this._cbObj),this.close()},e.prototype.close=function(){GameTick.instence().clearInterval(this.onTime,this),this._cb=null,this._cbObj=null,this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(DelayTimeView.prototype,"DelayTimeView");var FloorTextView=function(t){function e(e,i){void 0===i&&(i=!1);var s=t.call(this)||this;return s._alwaysShow=i,RES.getResByUrl(PFConst.RES_ROOT+"resource/bmfont/"+e,s.onLoaded,s,RES.ResourceItem.TYPE_FONT),s}return __extends(e,t),e.prototype.onLoaded=function(t){this._text=new egret.BitmapText,this._text.font=t,this.addChild(this._text),this._str&&this.updateText()},e.prototype.show=function(t){this._str=t,this._text&&this.updateText()},e.prototype.updateText=function(){this._text.text=this._str,this._text.anchorOffsetX=this._text.textWidth/2,this._text.anchorOffsetY=this._text.textHeight/2,this._text.alpha=1,this._text.scaleX=0,this._text.scaleY=0,egret.Tween.removeTweens(this._text),egret.Tween.get(this._text).to({scaleX:1,scaleY:1},500,egret.Ease.backOut).wait(500).call(this.onShowEnd,this)},e.prototype.onShowEnd=function(){this._alwaysShow||egret.Tween.get(this._text).to({alpha:0,delay:1},500,egret.Ease.backOut).call(this.onHideEnd,this)},e.prototype.onHideEnd=function(){this.parent&&this.parent.removeChild(this)},e.prototype.clear=function(){egret.Tween.removeTweens(this._text)},e}(egret.DisplayObjectContainer);__reflect(FloorTextView.prototype,"FloorTextView");var MapSelItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.icon.source=this.data.icon,this.lv.text="LV Limit："+this.data.lv,this.lv.textColor=this.data.isOpen?16777215:16711680,this.data.boxstate?this.box.visible=!1:(this.box.visible=!0,this.data.isOpen?this.box.filters=[]:this.box.filters=FilterUtils.disabled()),GmGlobal.mc.sceneMgr.pushSelIcon(this.data.id,this.data.icon)},e}(eui.ItemRenderer);__reflect(MapSelItem.prototype,"MapSelItem");var MapSelView=function(t){function e(){var e=t.call(this,"MapSelSkin")||this;return e._lastOpenIndx=-1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="MapSelItemSkin",this.itemList.itemRenderer=MapSelItem;var e=GmGlobal.mc.mapMgr.getMapList(SceneType.WILD);this._mapList=e;for(var i=GmGlobal.mc.dataMgr.getJData(JsonID.U_GQ_BX),s=i.data.id||0,o=GmGlobal.mc.role.lv,n=0,r=0;r<e.length;r++){var h=e[r],a={id:h.id,index:r+1,icon:GmConst.MAP_DIR+"sicon/"+h.sicon+".jpg",lv:h.lv,boxstate:s>r?1:0,isOpen:h.lv<=o?!0:!1};if(this._array.addItem(a),h.lv>o&&n++,n>=6)return;a.isOpen&&(this._lastOpenIndx=r+1)}},e.prototype.updateState=function(){for(var t=GmGlobal.mc.dataMgr.getJData(JsonID.U_GQ_BX),e=t.data.id||0,i=0;i<this._array.length;i++){var s=this._array.getItemAt(i);s.boxstate=e>i?1:0,this._array.replaceItemAt(s,i)}},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_GQ_BX,this.updateState,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_JUPD+JsonID.U_GQ_BX,this.updateState,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow();var i=this.getNoOpenIndex(),s=145*(i+1)-this.scoll.height,o=135*this._mapList.length+10*(this._mapList.length-1)-this.scoll.height;0>s?s=0:s>o&&(s=o),this.validateNow(),this.scoll.viewport.scrollV=s,this.validateNow(),this.checkGuide()},e.prototype.getNoOpenIndex=function(){for(var t=0;t<this._array.length;t++){var e=this._array.getItemAt(t);if(!e.isOpen)return t}},e.prototype.onTouchList=function(t){if("box"==t.target.name){var e=t.target.parent.data;e.isOpen?GmGlobal.cc.dataCtl.reqAward(AwardId.KQ_BOX,[e.index],this.onBoxAw,this):AwardPreviewTip.showAward(GmGlobal.mc.mapMgr.getBoxAw(e.id))}else{var e=t.target.data;e&&(e.lv<=GmGlobal.mc.role.lv?(GmGlobal.vmc.mGuide.triggerTarget(t.target),GmGlobal.cc.sceneCtl.reqWildScne(e.id),this.onClose()):MsgBox.prompt("LV too low"))}},e.prototype.onBoxAw=function(t,e){e&&e.length>0&&AwardTipView.showAward(e)},e.prototype.onRule=function(t){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.mapMgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MAPSEL)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&(t.guideData.id==GuideID.KILL_MONSTER||t.guideData.id==GuideID.KILL_MONSTER2||t.guideData.id==GuideID.PET_ZB)){var e=null,i=GmGlobal.mc.guideMgr,s=i.getGuideTask();if(s.idx)if(t.guideData.id==GuideID.KILL_MONSTER||t.guideData.id==GuideID.PET_ZB){var o=i.getPreFightMap(s.idx);e=this.getMapItem(-1==o?this._lastOpenIndx:o)}else{var n=i.getTaskListInfo(s.idx);n&&(e=this.getMapItem(n.mapid))}if(e){var r=e.parent.localToGlobal(e.x,e.y);t.bindTarget(GuideTargetId.MAP_SEL,e,r),this.scoll.scrollPolicyV=eui.ScrollPolicy.OFF}else t.clearGuide()}},e.prototype.getItemByIdx=function(t){for(var e=0;e<this.itemList.numChildren;e++){var i=this.itemList.getChildAt(e);if(i.data.index==t)return i}return null},e.prototype.getMapIndex=function(t){if(this._mapList)for(var e=0;e<this._mapList.length;e++){var i=this._mapList[e];if(i.id==t)return e}return-1},e.prototype.getMapItem=function(t){var e=this.getMapIndex(t);if(-1==e)return null;var i=145*(e+1)-this.scoll.height,s=135*this._mapList.length+10*(this._mapList.length-1)-this.scoll.height;return 0>i?i=0:i>s&&(i=s),this.scoll.viewport.scrollV=i,this.validateNow(),this.getItemByIdx(e+1)},e.prototype.close=function(){this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.scoll.scrollPolicyV=eui.ScrollPolicy.AUTO,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=GmGlobal.mc.sceneMgr,i=e.selIcons;for(var s in i)RES.destroyRes(i[s]);e.selIcons=null},e}(UIBase);__reflect(MapSelView.prototype,"MapSelView");var TowerHpBar=function(t){function e(){var e=t.call(this)||this;return e.topSpace=164,e._hideTimer=0,e._hideT=3,e.skinName="BossHpSkin",e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.isShow=function(){return this._instence&&this._instence.parent?!0:!1},e.prototype.setInfo=function(t,e,i,s){this.uid=t,this._hpMax=s,this.nameTxt.text=e,this.bar.maximum=s,this.hpTxt.text=i+"/"+this._hpMax,this.bar.value=i},e.prototype.setHp=function(t){this.hpTxt.text=t+"/"+this._hpMax,this.bar.value=t,this._hideT=3,this.parent||this.show(GmGlobal.vmc.uiLayer),0==this._hideTimer&&(this._hideTimer=egret.setInterval(this.onTimer,this,1e3))},e.prototype.show=function(t){this.parent||(t.addChild(this),this.topSpace=GmConst.UI_FREE_Y,this.onResize(),EventBus.addListener(EventType.RESIZE,this.onResize,this),EventBus.dispatchEvt(EventType.TOWERHP_SHOW),this.alpha=0,egret.Tween.get(this).to({alpha:1},500))},e.prototype.onResize=function(){this.x=(GmGlobal.stageWidth-this.width)/2,GmConst.IS_FULLSCENE?this.y=GmConst.BOTTOM_SPACE+this.topSpace:this.y=this.topSpace},e.prototype.onTimer=function(){this._hideT--,0==this._hideT&&(this.clearTimer(),this.parent&&this.parent.removeChild(this))},e.prototype.clearTimer=function(){0!=this._hideTimer&&(egret.clearInterval(this._hideTimer),this._hideTimer=0)},e.prototype.close=function(){EventBus.rmListener(EventType.RESIZE,this.onResize,this),this.clearTimer(),this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(TowerHpBar.prototype,"TowerHpBar");var YaoganView=function(t){function e(){var e=t.call(this)||this;return e._preR=-1,e._minR=20,e._maxR=45,e._isStartTick=!1,e._delay=0,e.touchEnabled=!1,e.touchChildren=!1,e._bg=new egret.Bitmap,e._bg.texture=RES.getRes("yg_json.yb_bg"),e._bg.anchorOffsetX=94,e._bg.anchorOffsetY=96,e._dian=new egret.Bitmap,e._dian.texture=RES.getRes("yg_json.yb_d"),e._dian.anchorOffsetX=40,e._dian.anchorOffsetY=40,e.addChild(e._bg),e.addChild(e._dian),e._rStep=Math.PI/36,e}return __extends(e,t),e.instence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.show=function(t){this.parent||t.addChild(this),this._scene=t,this.alpha=.5,this.addListers(),this.onResize()},e.prototype.onResize=function(){this.x=GmGlobal.stageWidth/2-this._scene.x;var t=GmGlobal.stageHeight-this._bg.anchorOffsetY-140;this.y=GmConst.IS_FULLSCENE?t-GmConst.BOTTOM_SPACE:t},e.prototype.addListers=function(){this._scene.blockMap.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),EventBus.addListener(EventType.RESIZE,this.onResize,this)},e.prototype.removeListers=function(){this._scene.blockMap.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),EventBus.rmListener(EventType.RESIZE,this.onResize,this)},e.prototype.onTouchBegin=function(t){this._rx=this.x=t.stageX-this._scene.x,this._ry=this.y=t.stageY,this._dian.x=0,this._dian.y=0,this._preR=100,egret.Tween.get(this).to({alpha:1}),this._scene.blockMap.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._scene.blockMap.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._scene.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},e.prototype.onTouchMove=function(t){this.move(t.stageX-this._scene.x,t.stageY)},e.prototype.onTouchEnd=function(t){this._scene.blockMap.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._scene.blockMap.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._scene.stage.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.onResize(),this._dian.x=0,this._dian.y=0,egret.Tween.get(this).to({alpha:.5}),this.stopTick(),this._scene&&this._scene.onYaoganUp()},e.prototype.startTick=function(){this._isStartTick=!0,GameTick.instence().bindTick(this.onTick,this)},e.prototype.stopTick=function(){this._isStartTick=!1,GameTick.instence().unbindTick(this.onTick,this)},e.prototype.onTick=function(t){this._delay-=t,this._delay<=0&&(this.stopTick(),this._scene&&this._scene.onYgDirChange(this._preR))},e.prototype.move=function(t,e){var i=Math.atan2(e-this._ry,t-this._rx),s=Utils.distence(t,e,this._rx,this._ry);if(s>this._maxR){var o=this._maxR*Math.cos(i),n=this._maxR*Math.sin(i);this._dian.x=o,this._dian.y=n}else this._dian.x=t-this._rx,this._dian.y=e-this._ry;s<this._minR||100!=this._preR&&Math.abs(i-this._preR)<this._rStep||(this._preR=i,this._delay=.1,this._isStartTick||this.startTick())},e.prototype.hide=function(){this.stopTick(),this.parent&&(this.removeListers(),this.parent.removeChild(this)),this._scene=null},e}(egret.DisplayObjectContainer);__reflect(YaoganView.prototype,"YaoganView");var YaoganView2=function(t){function e(){var e=t.call(this)||this;return e._minR=20,e._maxR=45,e._preR=0,e._isStartTick=!1,e._delay=0,e.touchEnabled=!0,e.touchChildren=!1,e._bg=new egret.Bitmap,e._bg.texture=RES.getRes("yg_json.yb_bg"),e._bg.anchorOffsetX=94,e._bg.anchorOffsetY=96,e._dian=new egret.Bitmap,e._dian.texture=RES.getRes("yg_json.yb_d"),e._dian.anchorOffsetX=40,e._dian.anchorOffsetY=40,e.addChild(e._bg),e.addChild(e._dian),e}return __extends(e,t),e.instence=function(){return this._instence||(this._instence=new e),this._instence},e.prototype.show=function(t){this.parent||t.addChild(this),this._scene=t,this.onResize(),this._dian.x=0,this._dian.y=0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),EventBus.addListener(EventType.RESIZE,this.onResize,this),this.alpha=.5},e.prototype.onResize=function(){this.x=GmGlobal.stageWidth/2;var t=GmGlobal.stageHeight-this._bg.anchorOffsetY-140;this.y=GmConst.IS_FULLSCENE?t-GmConst.BOTTOM_SPACE:t},e.prototype.onTouchBegin=function(t){this._scene.blockMap.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._scene.blockMap.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._scene.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.touchEnabled=!1,egret.Tween.get(this).to({alpha:1},100)},e.prototype.onTouchMove=function(t){this.move(t.stageX-this.x,t.stageY-this.y)},e.prototype.onTouchEnd=function(t){this._scene.blockMap.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._scene.blockMap.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._scene.stage.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.touchEnabled=!0,this._isStartTick&&(this._isStartTick=!1,GameTick.instence().unbindTick(this.onTimer,this)),egret.Tween.get(this).to({alpha:.5},100),egret.Tween.get(this._dian).to({x:0,y:0},100),this._scene&&this._scene.onYaoganUp()},e.prototype.move=function(t,e){var i=Math.atan2(e,t),s=Utils.distence(t,e,0,0);if(s>this._maxR){var o=this._maxR*Math.cos(i),n=this._maxR*Math.sin(i);this._dian.x=o,this._dian.y=n}else this._dian.x=t,this._dian.y=e;this._preR=i,this._delay=.1,this._isStartTick||(this._isStartTick=!0,GameTick.instence().bindTick(this.onTimer,this))},e.prototype.onTimer=function(t){this._delay-=t,this._delay<=0&&(GameTick.instence().unbindTick(this.onTimer,this),this._isStartTick=!1,this._scene&&this._scene.onYgDirChange(this._preR))},e.prototype.hide=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),EventBus.rmListener(EventType.RESIZE,this.onResize,this),this._isStartTick&&(this._isStartTick=!1,GameTick.instence().unbindTick(this.onTimer,this)),this.parent&&this.parent.removeChild(this),this._scene=null},e}(egret.DisplayObjectContainer);__reflect(YaoganView2.prototype,"YaoganView2");var ZhuabuView=function(t){function e(){return t.call(this,"ZhuabuSkin")||this}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.close=function(){this._instence&&this._instence.isShow&&this._instence.close()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.setZhabuMonster=function(t,e,i,s){this.zbId=t,this.typeId=e,this._cb=i,this._thisObj=s},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0,.1),this.bar.value=0,GameTick.instence().setInterval(.01,this.onTime,this)},e.prototype.onTime=function(t){this.bar.value+=1,100==this.bar.value&&(GameTick.instence().clearInterval(this.onTime,this),GmGlobal.cc.dataCtl.doAction(ServerActionId.ZHUABU,[this.typeId,this.zbId],this.onZbRet,this,this.onZbRet))},e.prototype.onZbRet=function(){this._cb&&this._cb.call(this._thisObj),this.close()},e.prototype.maskClose=function(){MsgBox.prompt("Stop capturing"),this._cb&&this._cb.call(this._thisObj),this.close()},e.prototype.close=function(){this.bar.value<100&&GameTick.instence().clearInterval(this.onTime,this),this.bar.value=0,this._cb=null,this._thisObj=null,t.prototype.close.call(this)},e}(UIBase);__reflect(ZhuabuView.prototype,"ZhuabuView");var Shake=function(){function t(){this._timer=0,this.isShake=!1}return t.prototype.start=function(t,e,i,s){void 0===s&&(s=-1),this.isShake||(this._target=t,this._t=s,this._strengthX=e,this._strengthY=i,this._initX=t.x,this._initY=t.y,this.isShake=!0,this._timer=egret.setInterval(this.update,this,0),this._preTime=egret.getTimer())},t.prototype.update=function(){if(this._target.x=Math.random()*this._strengthX*2-this._strengthX,this._target.y=Math.random()*this._strengthY*2-this._strengthY,-1!=this._t){var t=egret.getTimer();this._t-=t-this._preTime,this._preTime=t,this._t<=0&&this.stop()}},t.prototype.stop=function(){this.isShake=!1,this._target&&(this._target.x=this._initX,this._target.y=this._initY),0!=this._timer&&(egret.clearInterval(this._timer),this._timer=0)},t.prototype.clear=function(){this.stop(),this._target=null},t}();__reflect(Shake.prototype,"Shake");var SoundManager=function(){function t(){this._bgmState=!0,this._sEffectState=!0,this._bgVolume=1,this._bgPosition=0,this._bgPlingPos=0,this._sounds={},this._volumeObj={volume:0},this._effectChannels={}}return t.prototype.bgmSwitch=function(t){this._bgmState=t,t?this.startBgm():this.stopBgm()},t.prototype.stop=function(){this.stopBgm(),this.clearAllEffects()},t.prototype.start=function(){this.startBgm()},t.prototype.startBgm=function(){this._musicId&&this.playBgm(this._musicId,this._bgVolume,this._bgPosition)},t.prototype.sEffectSwitch=function(t){this._sEffectState=t},t.prototype.playBgm=function(t,e,i){if(void 0===e&&(e=.7),void 0===i&&(i=0),(this._musicId!=t||!this._bgChannel)&&(this._musicId!=t&&(this._bgPlingPos=i),this._bgVolume=e,this._bgPosition=this._bgPlingPos,this._bgmState&&!GmGlobal.GAME_HIDDEN))if("undefined"!=typeof playBgm){var s=PFConst.RES_ROOT+"resource/sound/"+t+".mp3";playBgm(s,e),this._musicId=t}else{this._bgChannel&&this._bgChannel.volume>0?(this._playBgm=t,this.stopBgm()):this._musicId=t;var o=this._sounds[t];o?this.playBgMusic(o):this.loadSound(t,e,this._bgPosition,!0)}},t.prototype.stopBgm=function(){if("undefined"!=typeof playBgm)return void playBgm(null,0);if(this._bgChannel){if(this.clearChannelEvent(),egret.Tween.removeTweens(this._volumeObj),GmGlobal.GAME_HIDDEN)return this._bgPlingPos=this._bgChannel.position,this._bgChannel.stop(),void(this._bgChannel=null);this._volumeObj.volume=this._bgChannel.volume,egret.Tween.get(this._volumeObj,{onChange:this.onBgChValumeChange,onChangeObj:this}).to({volume:0},300).call(this.stopMusicEnd,this)}},t.prototype.stopMusicEnd=function(){var t=this._sounds[this._musicId];t&&(t.close(),delete this._sounds[this._musicId]),this._bgChannel&&(this._bgChannel.stop(),this._bgChannel=null,this._bgmState&&this._playBgm&&(t=this._sounds[this._playBgm],t&&(this._musicId=this._playBgm,this._playBgm=null,this._bgChannel=t.play(0,1),this._bgChannel.addEventListener(egret.Event.SOUND_COMPLETE,this.onBGMPlauEnd,this),this._bgChannel.volume=this._volumeObj.volume=0,egret.Tween.get(this._volumeObj,{onChange:this.onBgChValumeChange,onChangeObj:this}).to({volume:this._bgVolume},300))))},t.prototype.onBgChValumeChange=function(){if(this._bgChannel)try{this._bgChannel.volume=this._volumeObj.volume}catch(t){console.log("this._bgChannel.volume error")}},t.prototype.getAllSoundEffectNum=function(){var t=0;for(var e in this._effectChannels){var i=this._effectChannels[e];i&&(t+=i.length)}return t},t.prototype.getSoundEffectNum=function(t){var e=this._effectChannels[t];return e?e.length:0},t.prototype.playSoundEffect=function(t,e,i){if(void 0===e&&(e=.5),void 0===i&&(i=0),!GmGlobal.GAME_HIDDEN&&this._sEffectState&&!(this.getSoundEffectNum(t)>4))if(PFConst.IS_WX_GAME){if(playSound){var s=PFConst.RES_ROOT+"resource/sound/"+t+".mp3";playSound(s,e)}}else{var o=this._sounds[t];o?this.playSound(t,o,e,i):this.loadSound(t,e,i)}},t.prototype.loadSound=function(t,e,i,s){void 0===s&&(s=!1);var o=this,n=new egret.Sound;n.addEventListener(egret.Event.COMPLETE,function(r){o._sounds[t]=n,s?(n.type=egret.Sound.MUSIC,o.playBgMusic(n)):(n.type=egret.Sound.EFFECT,o.playSound(t,n,e,i))},this);var r=RES.getVersionController().getVirtualUrl("resource/sound/"+t+".mp3");n.load(r)},t.prototype.loadSoundRes=function(t){var e=this,i=new egret.URLLoader;i.addEventListener(egret.Event.COMPLETE,function(s){var o=i.data;e._sounds[t]=o},this),i.dataFormat=egret.URLLoaderDataFormat.SOUND,i.load(new egret.URLRequest(RES.getVersionController().getVirtualUrl("resource/sound/"+t+".mp3")))},t.prototype.setSound=function(t,e){this._sounds[t]=e},t.prototype.getSound=function(t){return this._sounds[t]},t.prototype.playSound=function(t,e,i,s){var o=e.play(s,1);o.volume=i,o.addEventListener(egret.Event.SOUND_COMPLETE,this.onEffectPlayEnd,this),this.addPlayingEffect(t,o)},t.prototype.addPlayingEffect=function(t,e){var i=this._effectChannels[t];i?i.push(e):this._effectChannels[t]=[e]},t.prototype.removeEffectChannel=function(t){for(var e in this._effectChannels){var i=this._effectChannels[e],s=i.indexOf(t);if(s>=0){i.splice(s,1);break}}},t.prototype.clearEffects=function(t){var e=this._effectChannels[t];if(e){for(var i=0;i<e.length;i++){var s=e[i];s.removeEventListener(egret.Event.SOUND_COMPLETE,this.onEffectPlayEnd,this),s.stop(),s=null}delete this._effectChannels[t]}},t.prototype.clearAllEffects=function(){for(var t in this._effectChannels)this.clearEffects(t)},t.prototype.onEffectPlayEnd=function(t){var e=t.target;e.removeEventListener(egret.Event.SOUND_COMPLETE,this.onEffectPlayEnd,this),this.removeEffectChannel(t.target)},t.prototype.playBgMusic=function(t){this._bgChannel||(this._bgChannel=t.play(this._bgPosition,1),this._bgChannel.addEventListener(egret.Event.SOUND_COMPLETE,this.onBGMPlauEnd,this),this._bgChannel.volume=this._volumeObj.volume=0,egret.Tween.get(this._volumeObj,{onChange:this.onBgChValumeChange,onChangeObj:this}).to({volume:this._bgVolume},300))},t.prototype.clearChannelEvent=function(){this._bgChannel&&this._bgChannel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onBGMPlauEnd,this)},t.prototype.onBGMPlauEnd=function(){this.clearChannelEvent(),this._bgPosition=0,egret.Tween.removeTweens(this._volumeObj),this._bgChannel.stop(),this._bgChannel=null;var t=this._sounds[this._musicId];t&&this.playBgMusic(t)},t}();__reflect(SoundManager.prototype,"SoundManager");var BiaoCheUnitView=function(t){function e(){var e=t.call(this)||this;return e.ox=0,e.sx=0,e.ex=0,e.speedScale=1,e.bhTime=0,e.isBh=!1,e._bhTimer=0,e}return __extends(e,t),e.prototype.addTitle=function(t){this.title||(this.title=new BiaocheTitle);var e="Normal";2==this.bcData.q?e="Silver":3==this.bcData.q?e="Gold":4==this.bcData.q&&(e="Legend"),this.title.setTitleInfo(this.bcData.q),this.title.setOffsetY(this.mHeight),this.title.x=this.point.x,this.title.y=this.point.y+this.title.offsetY,t.addChild(this.title)},e.prototype.unuse=function(){t.prototype.unuse.call(this),this.clearBhImg(),this.roleView=null,this.bcData=null,this.isBh=!1,this._bhTimer&&(egret.clearTimeout(this._bhTimer),this._bhTimer=0)},e.prototype.updatePos=function(){var t=egret.getTimer()-this.startTime;if(t>0){var e=this.ox+this.sx+t/1e3*this.speedScale*this.speed;e>this.ex&&(e=this.ex),this.x=this.point.x=e,this.onPosUpdate(),this.updateRolePos()}else console.log("ybnext time:"+t)},e.prototype.onBodyLoaded=function(){t.prototype.onBodyLoaded.call(this),this.isBh&&this.adBhImg()},e.prototype.setBhTime=function(t){this.bhTime=t,this.isBh||(t>0?(this.isBh=!0,this.adBhImg(),this._bhTimer&&egret.clearTimeout(this._bhTimer),this._bhTimer=egret.setTimeout(this.onTimeOut,this,t)):(this.isBh=!1,this.rmBhImg()))},e.prototype.onTimeOut=function(){this._bhTimer=0,this.isBh=!1,this.rmBhImg()},e.prototype.setBhState=function(t){this.isBh=t,t&&this.adBhImg()},e.prototype.adBhImg=function(){this.bhImg||(this.bhImg=new eui.Image("yabaobh_png"),this.bhImg.anchorOffsetX=70,this.bhImg.anchorOffsetY=170),!this.bhImg.parent&&this.isBody&&this.addChild(this.bhImg)},e.prototype.rmBhImg=function(){this.bhImg&&this.bhImg.parent&&this.bhImg.parent.removeChild(this.bhImg)},e.prototype.clearBhImg=function(){this.bhImg&&(this.bhImg.parent&&this.bhImg.parent.removeChild(this.bhImg),this.bhImg=null)},e.prototype.updateRolePos=function(){this.roleView.resetPos(this.point.x+100,this.point.y)},e}(BattleUnitView);__reflect(BiaoCheUnitView.prototype,"BiaoCheUnitView");var BossItemView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setItem=function(t,e,i,s,o){void 0===e&&(e=1),void 0===s&&(s=10),void 0===o&&(o=null),this.itemId=t,this.roleId=i,this._showTime=s,this._roleView=o,this.num=e,this.scaleX=1,this.scaleY=1,this._icon||(this._icon=new eui.Image,this._icon.width=72,this._icon.height=72,this._icon.anchorOffsetX=36,this._icon.anchorOffsetY=36,this.addChild(this._icon)),this._icon.source=GmGlobal.mc.itemMgr.getItemIcon(t),this._l||(this._l=new eui.Image,this._l.width=76,this._l.height=304,this._l.anchorOffsetX=38,this._l.anchorOffsetY=266,this.addChild(this._l)),this._l.visible=!0,this._l.source=GmGlobal.mc.itemMgr.getBossItemL(t)},e.prototype.moveTo=function(t,e,i,s){this._cb=i,this._cbObj=s,egret.Tween.get(this).to({x:t,y:e},500).call(this.onMEnd,this)
},e.prototype.onMEnd=function(){GameTick.instence().setTimeOut(this._showTime,this.onTimeOut,this)},e.prototype.moveToRole=function(t,e){egret.Tween.get(this).to({x:t,y:e-40,scaleX:.3,scaleY:.3},300).wait(200).call(this.showEnd,this)},e.prototype.onTimeOut=function(){return this.roleId&&this._roleView?(this._l.visible=!1,void this.moveToRole(this._roleView.x,this._roleView.y)):void this.showEnd()},e.prototype.showEnd=function(){this._cb&&this._cb.call(this._cbObj,this),e.release(this)},e.prototype.unuse=function(){egret.Tween.removeTweens(this),GameTick.instence().clearTimeOut(this.onTimeOut,this),this._cb=null,this._cbObj=null,this._roleView=null,this.parent&&this.parent.removeChild(this)},e.prototype.reuse=function(){},e.prototype.clear=function(){this.unuse()},e.create=function(){var t=ObjectPool.pop("BossItemView");return t||(t=new e),t},e.release=function(t){t&&(t.unuse(),ObjectPool.push(t,"BossItemView"))},e}(egret.DisplayObjectContainer);__reflect(BossItemView.prototype,"BossItemView",["IObject"]);var DirType;!function(t){t[t.UP_RIGHT=1]="UP_RIGHT",t[t.RIGHT=2]="RIGHT",t[t.DOWN_RIGHT=3]="DOWN_RIGHT",t[t.DOWN_LEFT=4]="DOWN_LEFT",t[t.LEFT=5]="LEFT",t[t.UP_LEFT=6]="UP_LEFT"}(DirType||(DirType={}));var HuoBanUnitView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addTitle=function(t){this.title||(this.title=new RoleTitle);var e=(GmGlobal.mc.role,this.isMyTeam());this.title.setTitleInfo(this.uName,!1,this.unitData.hp,this.unitData.hpMax,e),this.title.setOffsetY(-20),this.title.x=this.point.x,this.title.y=this.point.y+this.title.offsetY,t.addChild(this.title)},e.prototype.isMyTeam=function(){var t=GmGlobal.mc.role;return this.team>0&&this.team==t.team?!0:!1},e.prototype.onDeadEnd=function(){t.prototype.onDeadEnd.call(this),UnitViewCreator.instence().releaseHbView(this)},e}(BattleUnitView);__reflect(HuoBanUnitView.prototype,"HuoBanUnitView");var JqHeroView=function(t){function e(){var e=t.call(this)||this;return e._fNum=0,e._lookNum=0,e._timerId=0,e}return __extends(e,t),e.prototype.addTitle=function(t){},e.prototype.startFight=function(){this.attackData.skillId=0,this.normalAttack(2e3)},e.prototype.checkNormalAttack=function(){return this._fNum++,this._fNum>=4?(this.attackData.skillId=60009,this.skillAttack(this.attackData.skillId),!1):!0},e.prototype.updateActionName=function(){switch(this.action){case ActionType.STAND:this.dir==DirType.UP_RIGHT||this.dir==DirType.UP_LEFT?this.actionName="stand_01":this.dir==DirType.RIGHT||this.dir==DirType.LEFT?this.actionName="stand_03":this.actionName="stand_06";break;case ActionType.STAND_TO:this.actionName="stand-to";break;case ActionType.RUN:this.dir==DirType.UP_RIGHT||this.dir==DirType.UP_LEFT?this.actionName="run_01":this.dir==DirType.RIGHT||this.dir==DirType.LEFT?this.actionName="run_03":this.actionName="run_06";break;case ActionType.ATTACK:this.actionName="attack";break;case ActionType.SKILL:this.actionName="skill";break;default:this.actionName=null}},e.prototype.look=function(t,e){this._cb=t,this._cbThis=e,this.dir=DirType.RIGHT,this._timerId=egret.setInterval(this.updataDir,this,1e3)},e.prototype.updataDir=function(){this._lookNum++,1==this._lookNum?this.dir=DirType.LEFT:2==this._lookNum?this.dir=DirType.DOWN_RIGHT:(egret.clearInterval(this._timerId),this._timerId=0,this._cb.call(this._cbThis),this._cb=null,this._cbThis=null)},e}(BattleUnitView);__reflect(JqHeroView.prototype,"JqHeroView");var JqMonsterView=function(t){function e(){var e=t.call(this)||this;return e._fNum=0,e}return __extends(e,t),e.prototype.addTitle=function(t){},e.prototype.startFight=function(){this.attackData.skillId=0,this.normalAttack(2e3)},e.prototype.checkNormalAttack=function(){if(this._fNum++,this._fNum>=4){var t=this;return setTimeout(function(){t.attackData.skillId=6804,t.skillAttack(t.attackData.skillId)},500),!1}return!0},e.prototype.onActionPlayEnd=function(e){if(t.prototype.onActionPlayEnd.call(this,e),-1==this.attackData.skillId){var i=GmGlobal.vmc.mJq.getScene();i.heroDead()}},e}(BattleUnitView);__reflect(JqMonsterView.prototype,"JqMonsterView");var MonsterUnitView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addTitle=function(t){this.title||(this.title=new MonsterTitle);var e=GmGlobal.mc.npcMgr.getNpcCfg(this.typeId),i=this.unitData.lv;i||e&&e.level&&(i=e.level);var s=GmGlobal.mc.role,o=this.team>0&&this.team==s.team?!0:!1;this.title.setTitleInfo(this.typeId,this.uName,i,this.unitData.hp,this.unitData.hpMax,o),this.title.setOffsetY(this.mHeight),this.title.x=this.point.x,this.title.y=this.point.y+this.title.offsetY,e&&2==e.type?this.title.visible=!0:this.title.visible=!1,t.addChild(this.title)},e.prototype.onDeadEnd=function(){t.prototype.onDeadEnd.call(this),UnitViewCreator.instence().releaseMonsterView(this)},e}(BattleUnitView);__reflect(MonsterUnitView.prototype,"MonsterUnitView");var MyPetUnitView=function(t){function e(){var e=t.call(this)||this;return e.lockType=0,e.hangRang=120,e.findRange=400,e._ticktTime=.2,e.aiStart=!1,e}return __extends(e,t),e.prototype.isMyTeam=function(){return!0},e.prototype.startAI=function(t){this.aiStart&&this.stopAI(),this.aiStart=!0,this.master=t,this.setState(PetHangState.create()),this._upd=this.getUpd(),GameTick.instence().setInterval(this._ticktTime,this._upd,this)},e.prototype.stopAI=function(){this.aiStart=!1,this.master=null,this.lockView=null,this._upd&&GameTick.instence().clearInterval(this._upd,this)},e.prototype.setState=function(t){this._aiState&&t!=this._aiState&&this._aiState.release(),this._aiState=t},e.prototype.getUpd=function(){return GmGlobal.mc.sceneMgr.mapType==SceneType.CITY?this.cityUpd:1==this.tfType?this.zdUpd:this.bdUpd},e.prototype.cityUpd=function(){this.master.isMove?this._aiState.type!=AIStateType.FOLLOW&&this.setState(PetFollowState.create()):this._aiState.type!=AIStateType.HANG&&this.setState(PetHangState.create()),this._aiState.excute(this,this._ticktTime)},e.prototype.bdUpd=function(){var t=this;t.master.isMove&&Utils.distence(t.point.x,t.point.y,t.master.point.x,t.master.point.y)>t.hangRang?(t.lockView=null,t._aiState.type!=AIStateType.FOLLOW&&t.setState(PetFollowState.create())):((!t.lockView||t.lockView.isDead)&&(t.lockView=t.master.lockedView),t.lockView?t._aiState.type!=AIStateType.ATTACK&&t.setState(PetAAttackState.create()):t._aiState.type!=AIStateType.HANG&&t.setState(PetHangState.create())),this._aiState.excute(this,this._ticktTime)},e.prototype.zdUpd=function(){var t=this;if(t.master.isMove&&Utils.distence(t.point.x,t.point.y,t.master.point.x,t.master.point.y)>t.hangRang)t.lockView=null,t._aiState.type!=AIStateType.FOLLOW&&t.setState(PetFollowState.create());else{if(!t.lockView||t.lockView.isDead)if(t.master.lockedView&&t.master.lockedView.type==UnitType.ROLE)t.lockView=t.master.lockedView;else{var e=GmGlobal.vmc.scene.currenScene;this.lockType&&(t.lockView=e.getNearestMonsterByType(t.team,t.master.point.x,t.master.point.y,t.lockType,t.findRange)),t.lockView||(e.getSceneType()==SceneType.WILD?t.lockView=e.getNearestMonster(t.master.point.x,t.master.point.y,t.findRange):t.lockView=e.getNearestFightView(t.team,t.master.point.x,t.master.point.y,t.findRange))}t.lockView?t._aiState.type!=AIStateType.ATTACK&&t.setState(PetAAttackState.create()):t._aiState.type!=AIStateType.HANG&&t.setState(PetHangState.create())}t._aiState.excute(t,t._ticktTime)},e.prototype.checkLockView=function(t,e){this.lockView&&this.lockView.uid==t&&this.lockView.type==e&&(this.lockView=null,this.stopDAttack())},e.prototype.stopDAttack=function(){this.attackData.skillId=-1,this.fightStand(),GmGlobal.cc.sceneCtl.reqPetStand(this.point.x,this.point.y,this.dir)},e.prototype.reqStand=function(){this.stand(),GmGlobal.cc.sceneCtl.reqPetStand(this.point.x,this.point.y,this.dir)},e.prototype.unuse=function(){this.stopAI(),this.lockType=0,this._aiState&&(this._aiState.release(),this._aiState=null),t.prototype.unuse.call(this)},e}(PetUnitView);__reflect(MyPetUnitView.prototype,"MyPetUnitView");var MyRoleUnitView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setAutoAi=function(t){this._autoAi=t},e.prototype.checkNormalAttack=function(){var t=GmGlobal.vmc.scene.currenScene.getSceneUnitView(this.attackData.defender,this.attackData.defenderType);return!t||Utils.distence(this.point.x,this.point.y,t.point.x,t.point.y)>this.aDis?(0==this.attackData.skillId&&this.body&&this.body.play(1),this.attackData.skillId=-1,GmGlobal.cc.sceneCtl.reqUnitStand(this.point.x,this.point.y,this.dir),!1):t.isDead?(GmGlobal.cc.sceneCtl.reqUnitStand(this.point.x,this.point.y,this.dir),!1):(this.attackData&&(this.attackData.targetX=t.point.x,this.attackData.targetY=t.point.y),!0)},e.prototype.stopNormalAttack=function(){this.attackData.skillId=-1,this.fightStand(),GmGlobal.cc.sceneCtl.reqUnitStand(this.point.x,this.point.y,this.dir)},e.prototype.reqStop=function(){this.stand(),GmGlobal.cc.sceneCtl.reqUnitStand(this.point.x,this.point.y,this.dir)},e.prototype.doAttack=function(){0==this.attackData.skillId&&!this.checkNormalAttack(),t.prototype.doAttack.call(this)},e.prototype.onSkillEnd=function(){this._autoAi&&this._autoAi.onTime(0)},e.prototype.unuse=function(){this.lockedView=null,t.prototype.unuse.call(this)},e}(RoleUnitView);__reflect(MyRoleUnitView.prototype,"MyRoleUnitView");var NpcUnitView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addTitle=function(t){if(!this.title){var e=new NpcTitle;e.typeId=this.typeId,this.title=e}this.title.setTitleInfo(this.typeId),this.title.setOffsetY(this.mHeight),this.title.x=this.point.x,this.title.y=this.point.y+this.title.offsetY,t.addChild(this.title)},e}(BattleUnitView);__reflect(NpcUnitView.prototype,"NpcUnitView");var TextFormat=function(){function t(){}return t.setColor=function(t,e){return'<font color="#'+e.toString(16)+'">'+t+"</font>"},t.setMoneyStr=function(t,e,i,s){void 0===s&&(s=!1),s?t.textFlow=this.parser.parser(this.setColor(Utils.formatNum(e,0),e>=i?Colors.GREEN:Colors.RED)+"/"+Utils.formatNum(i,0)):t.textFlow=this.parser.parser(this.setColor(String(e),e>=i?Colors.GREEN:Colors.RED)+"/"+i)},t.setMoneyStr1=function(t,e,i,s){void 0===s&&(s=!1),s?t.textFlow=this.parser.parser(Utils.formatNum(i,0)+"/"+this.setColor(Utils.formatNum(e,0),e>=i?Colors.GREEN:Colors.RED)):t.textFlow=this.parser.parser(i+"/"+this.setColor(String(e),e>=i?Colors.GREEN:Colors.RED))},t.setTaskNum=function(t,e,i){t.textFlow=this.parser.parser(this.setColor(Utils.formatNum(e,0),e>=i?Colors.GREEN:Colors.RED)+"/"+Utils.formatNum(i,0))},t.setRankTaskStr=function(t,e,i){t.textFlow=this.parser.parser(this.setColor(String(e),i>=e?Colors.GREEN:Colors.RED)+"/"+i)},t.formatHpText=function(t){var e;return e=-1e5>t||t>1e5?Math.round(t/1e4).toString()+"w":t.toString()},t.parser=new egret.HtmlTextParser,t}();__reflect(TextFormat.prototype,"TextFormat");var Utils=function(){function t(){}return t.getNameIndex=function(t){var e=t.split("_"),i=-1;return e[1]&&(i=Number(e[1])),i},t.compare=function(t,e){for(var i,s,o=[],n=0;n<t.length;++n)i=t[n],s=e.indexOf(i),-1==s&&o.push(i);return o},t.getLocalUID=function(){return t._localUID--},t.getRandomIndexArray=function(t){for(var e=[],i=0;t>i;++i)e.push(i);var s=0,o=0,n=0;for(i=0;t>i;++i)s=Math.ceil(Math.random()*t),s=0==s?0:s-1,o=Math.ceil(Math.random()*t),o=0==o?0:o-1,s!=o&&(n=e[s],e[s]=e[o],e[o]=n);return e},t.formatDate=function(t,e){var i=new Date;i.setTime(1e3*t);var s=i.getFullYear(),o=i.getMonth()+1,n=i.getDate(),r=i.getHours(),h=i.getMinutes(),a=i.getSeconds(),l=e.replace("Y",s.toString());return l=l.replace("M",(10>o?"0":"")+o),l=l.replace("D",(10>n?"0":"")+n),l=l.replace("h",(10>r?"0":"")+r),l=l.replace("m",(10>h?"0":"")+h),l=l.replace("s",(10>a?"0":"")+a)},t.formatServerDate=function(e,i,s){var o=new Date;o.setTime(1e3*e);o.getTimezoneOffset();return t.formatDate(e,s)},t.getServerTime=function(t){t=Number(t);var e=new Date;e.setTime(1e3*t);var i=60*e.getTimezoneOffset(),s=t+i+GmGlobal.serverUtcOffset;return s},t.formatTime=function(t,e){var i=Math.floor(t/3600/24);t-=3600*i*24;var s=Math.floor(t/3600);t-=3600*s;var o=Math.floor(t/60);t-=60*o;var n=Math.ceil(t%60),r=e.replace("D",i.toString());return r=10>s?r.replace("h","0"+s):r.replace("h",s.toString()),r=10>o?r.replace("m","0"+o):r.replace("m",o.toString()),r=10>n?r.replace("s","0"+n):r.replace("s",n.toString())},t.formatDayCDTime=function(e,i,s){void 0===i&&(i="DD"),void 0===s&&(s="h:m:s");var o=Math.floor(e/3600/24);return o>0?i.replace("D",o.toString()):t.formatTime(e,s)},t.isEmptyObj=function(t){if(!t)return!0;for(var e in t)return!1;return!0},t.getObjectLength=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},t.random=function(t,e){var i=e-t+1;return t+Math.floor(i*Math.random())},t.getCDByWeek=function(t,e){var i=new Date(1e3*e),s=i.getDay(),o=t>s?t-s:t+7-s;return 86400*o-(3600*i.getHours()+60*i.getMinutes()+i.getSeconds())},t.lockBtn=function(t,e,i){void 0===i&&(i=!1),t.enabled=!1,i&&(t.filters=FilterUtils.disabled()),egret.setTimeout(function(){t.enabled=!0,i&&(t.filters=[])},this,e)},t.setBtnEnable=function(t,e){t.touchEnabled=e,e?t.filters=[]:t.filters=FilterUtils.disabled()},t.hasSpecialWold=function(t){for(var e=0;e<t.length;e++)if(-1!=this.specialWold.indexOf(t[e]))return!0;return!1},t.checkName=function(e){if(t.hasSpecialWold(e))return MsgBox.prompt("Cannot contain special characters"),!1;var i=e.length;return 0==i?(MsgBox.prompt("Name can't be empty"),!1):i>16||4>i?(MsgBox.prompt("Name length is 4-16 character(s)"),!1):!0},t.isNumber=function(t){var e=/^[0-9]*$/;return e.test(t)},t.hasLabel=function(t,e){var i=t.movieClipData.labels;if(!i)return!1;for(var s=0;s<i.length;++s)if(e==i[s].name)return!0;return!1},t.formatNum=function(t,e){return void 0===e&&(e=1),1e3>t?t.toString():1e6>t?t%1e3==0?String(t/1e3+"K"):(t/=1e3,t.toFixed(e)+"K"):1e9>t?t%1e6==0?String(t/1e6+"M"):(t/=1e6,t.toFixed(e)+"M"):t%1e9==0?String(t/1e9+"G"):(t/=1e9,t.toFixed(e)+"G")},t.getTodaySecond=function(t){void 0===t&&(t=0);var e=new Date(1e3*(t||GmGlobal.getServerTime()));return 3600*e.getHours()+60*e.getMinutes()+e.getSeconds()},t.getNextDatTime=function(e){void 0===e&&(e=0);var i=e||GmGlobal.getServerTime();return i-t.getTodaySecond(e)+86400},t.getDayHasTime=function(){return Math.max(86400-t.getTodaySecond(),0)},t.getServerTodaySecond=function(){var t=new Date(1e3*GmGlobal.getServerLocalTime());return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},t.objToArray=function(t){var e=[];for(var i in t)e.push(t[i]);return e},t.isNormalMonster=function(t){return 20>=t?!0:!1},t.getMonsterState=function(t){return t>=.6?1:t>=.3?2:t>1e-5?3:4},t.getBinAry=function(t){void 0===t&&(t=0);for(var e=[];;){var i=t%2;if(t=Math.floor(t/2),e.push(i),0==t)break}return e},t.getQualityColor=function(t){switch(t){case ItemQuality.WHILE:return 15266040;case ItemQuality.GREEN:return 7923859;case ItemQuality.BLUE:return 10796282;case ItemQuality.PURPLE:return 12946917;case ItemQuality.ORANGE:return 16760976;case ItemQuality.GOLDEN:return Colors.GOLDEN;case ItemQuality.RED:return Colors.RED}},t.distence=function(t,e,i,s){var o=Math.abs(t-i),n=Math.abs(e-s);return Math.floor(Math.sqrt(o*o+n*n))},t.getDir=function(t,e){if(t>-45&&45>t)return DirType.RIGHT;if(t>-90&&-45>t)return DirType.UP_RIGHT;if(t>45&&90>t)return DirType.DOWN_RIGHT;if(t>90&&135>t)return DirType.DOWN_LEFT;if(t>135&&180>=t)return DirType.LEFT;if(t>=-180&&-135>t)return DirType.LEFT;if(t>-135&&-90>t)return DirType.UP_LEFT;if(-45==t){if(e!=DirType.UP_RIGHT&&e!=DirType.RIGHT)return DirType.UP_RIGHT}else if(45==t&&e!=DirType.DOWN_RIGHT&&e!=DirType.RIGHT)return DirType.DOWN_RIGHT;if(-135==t){if(e!=DirType.UP_LEFT&&e!=DirType.LEFT)return DirType.UP_LEFT}else if(135==t){if(e!=DirType.DOWN_LEFT&&e!=DirType.LEFT)return DirType.DOWN_LEFT}else if(-90==t){if(e!=DirType.UP_LEFT&&e!=DirType.UP_RIGHT)return DirType.UP_RIGHT}else if(90==t&&e!=DirType.DOWN_LEFT&&e!=DirType.DOWN_RIGHT)return DirType.DOWN_RIGHT;return 0},t.getDirXV=function(t){return t==DirType.UP_LEFT||t==DirType.LEFT||t==DirType.DOWN_LEFT?-1:1},t.replaceColorCode=function(t){return t=t.replace(/<#/g,"<font color=#"),t=t.replace(/<\/>/g,"</font>")},t.iconSaggle=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=100),egret.Tween.get(t,{loop:!0}).to({rotation:e},i).to({rotation:0},i).to({rotation:-e},i).to({rotation:0},i)},t.formatSysMsg=function(e){var i=e.indexOf("<item"),s=e.indexOf("</item>");if(-1!=i&&-1!=s){var o=e.substring(i,s+7),n=o.substring(1,o.indexOf(">")),r=n.split("="),h=GmGlobal.mc.itemMgr.getItemCfg(Number(r[1]));if(!h)return e;var a=TextFormat.setColor(h.name,t.getQualityColor(h.quality));return e=e.replace(o,a),t.formatSysMsg(e)}return e},t.formatChatSysMsg=function(e,i){void 0===i&&(i=null),i||(i=[]);var s=e.indexOf("<item"),o=e.indexOf("</item>");if(-1!=s&&-1!=o){var n=e.substring(s,o+7),r=n.substring(1,n.indexOf(">")),h=r.split("=");i=i.concat(TextFormat.parser.parse(e.substr(0,s)));var a=Number(h[1]),l=GmGlobal.mc.itemMgr.getItemCfg(a);return l&&(l.quality>1?i.push({text:l.name,style:{href:"event:"+a,underline:!0,textColor:t.getQualityColor(l.quality)}}):i.push({text:l.name,style:{href:"event:"+a,underline:!0}})),e=e.substr(o+7),t.formatChatSysMsg(e,i)}return i=i.concat(TextFormat.parser.parse(e))},t.isInDic=function(t,e){for(var i in e)if(e[i]==t)return!0;return!1},t.getWx=function(t){switch(t){case 1:return"Fire";case 2:return"Water";case 3:return"Wind";case 4:return"Earth";case 5:return"Holy";case 6:return"Dark";default:return"Normal"}},t._localUID=-1,t.specialWold="\x00\b	\n\f\r",t.ELetters=["A","B","C","D"],t}();__reflect(Utils.prototype,"Utils");var SceneBox=function(t){function e(e,i,s){void 0===s&&(s=1);var o=t.call(this)||this;return o.type=UnitType.BOX,o.source=i,o.uid=e,o.itemId=s,o}return __extends(e,t),e}(eui.Image);__reflect(SceneBox.prototype,"SceneBox");var SceneItemView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setInfo=function(t,e,i,s,o,n,r){this._x=i,this._y=s,this._myPoint=o,this._moveEndCb=n,this._thisObj=r,this._num=e,this._itemId==t&&this.texture?this.startMove():(this._itemId=t,this._icon=GmGlobal.mc.itemMgr.getItemIcon(t),RES.getResByUrl(this._icon,this.onImgLoaded,this))},e.prototype.onImgLoaded=function(t,e){this._icon==e&&(this.texture=t,this.startMove())},e.prototype.startMove=function(){this.x=this._x,this.y=this._y,this.scaleX=.5,this.scaleY=.5,this.anchorOffsetX=50,this.anchorOffsetY=50,egret.Tween.get(this).to({y:this._y-100},300,egret.Ease.quadOut).call(this.onUpEnd,this)},e.prototype.onUpEnd=function(){egret.Tween.get(this).to({y:this._y},600,egret.Ease.bounceOut).call(this.onDownEnd,this)},e.prototype.onDownEnd=function(){if(this.parent){var t=FubenType.getClientType(GmGlobal.mc.sceneMgr.mapId);if(t==FubenType.JXGC||t==FubenType.MK01){var e=t==FubenType.JXGC?JxgcSceneUI.getInstence():WanfaMkSceneUI.getInstence(),i=this.parent.localToGlobal(this.x,this.y);i=e.globalToLocal(i.x,i.y),this.parent.removeChild(this),e.addChild(this),this.x=i.x,this.y=i.y;var s=e.getAwBtn();egret.Tween.get(this).to({x:s.x,y:s.y},500).call(this.onBagMoveEnd,this)}else this._myPoint?egret.Tween.get(this).to({x:this._myPoint.x,y:this._myPoint.y-40,scaleX:.3,scaleY:.3},300).wait(200).call(this.onMoveEnd,this):this.onMoveEnd()}},e.prototype.onMoveEnd=function(){this._moveEndCb.call(this._thisObj,this);var t=GmGlobal.mc.itemMgr.getItemCfg(this._itemId);if(t){var i=TextFormat.setColor(t.name,Utils.getQualityColor(t.quality))+" *"+this._num;Horselamp.showVText(i,this._icon)}e.release(this)},e.prototype.onBagMoveEnd=function(){this._moveEndCb.call(this._thisObj,this);var t=FubenType.getClientType(GmGlobal.mc.sceneMgr.mapId),i=t==FubenType.JXGC?JxgcSceneUI.getInstence():WanfaMkSceneUI.getInstence(),s=i.getAwBtn();egret.Tween.removeTweens(s),egret.Tween.get(s).to({scaleX:1.2,scaleY:1.2},200).to({scaleX:1,scaleY:1},200),e.release(this)},e.prototype.unuse=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this),this._myPoint=null,this._moveEndCb=null,this._thisObj=null},e.prototype.reuse=function(){},e.prototype.clear=function(){this.unuse()},e.create=function(){var t=ObjectPool.pop("SceneItemView");return t||(t=new e),t},e.release=function(t){t&&(t.unuse(),ObjectPool.push(t,"SceneItemView"))},e}(egret.Bitmap);__reflect(SceneItemView.prototype,"SceneItemView",["IObject"]);var TowerUnitView=function(t){function e(e,i,s,o){var n=t.call(this)||this;return n.uid=e,n.model=new eui.Image(i),n.model.anchorOffsetX=s,n.model.anchorOffsetY=o,n.addChild(n.model),n.touchEnabled=!1,n.hpBar=new eui.ProgressBar,n.hpBar.skinName="HpBarSkin1",n.hpBar.anchorOffsetX=20,n.hpBar.y=-o-20,n.addChild(n.hpBar),n}return __extends(e,t),e.prototype.setHp=function(t,e){this.hpBar.maximum=e,this.hpBar.value=t},e.prototype.updHp=function(t){this.hpBar.value=t},e}(egret.DisplayObjectContainer);__reflect(TowerUnitView.prototype,"TowerUnitView");var UIRoleModel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setInfo=function(t,e){void 0===e&&(e=0);var i=GmGlobal.mc.heroMgr.getHeroCfg(t);i?this.setModel(i.modelRes):this.clearModel();var s=GmGlobal.mc.sceneMgr.getTsRes(t,e);this.setToushi(s)},e.prototype.setModel=function(t){this._mRes!=t&&(this._modelView&&this.clearModel(),t&&(this._mRes=t,GmGlobal.res.getMovieClipData(GmConst.MODEL_DIR,t,this.onModelLoaded,this)))},e.prototype.clearModel=function(){this._modelView?(this._modelView.parent&&this.removeChild(this._modelView),GmGlobal.res.releaseMCData(this._mRes,!1,this.onModelLoaded,this),this._modelView=null):GmGlobal.res.stopMovieClipLoad(this._mRes,this.onModelLoaded,this),this._mRes=null},e.prototype.onModelLoaded=function(t){var e=new egret.MovieClip(t.generateMovieClipData(this._mRes));return e.frameLabels?(this._modelView=e,this.addChild(this._modelView),void this._modelView.gotoAndStop("stand_06")):void console.log("onModelLoaded error "+this._tsRes)},e.prototype.setToushi=function(t){this._tsRes!=t&&(this._tsView&&this.clearToushi(),t&&(this._tsRes=t,GmGlobal.res.getMovieClipData(GmConst.TOUSHI_DIR,t,this.onToushiLoaded,this)))},e.prototype.clearToushi=function(){this._tsView?(this._tsView.parent&&this.removeChild(this._tsView),GmGlobal.res.releaseMCData(this._tsRes,!1,this.onToushiLoaded,this),this._tsView=null):GmGlobal.res.stopMovieClipLoad(this._tsRes,this.onToushiLoaded,this),this._tsRes=null},e.prototype.onToushiLoaded=function(t){var e=new egret.MovieClip(t.generateMovieClipData(this._tsRes));return e.frameLabels?(this._tsView=e,this.addChild(this._tsView),void this._tsView.gotoAndStop("stand_06")):void console.log("onToushiLoaded error "+this._tsRes)},e.prototype.clear=function(){this.clearModel(),this.clearToushi()},e}(egret.DisplayObjectContainer);__reflect(UIRoleModel.prototype,"UIRoleModel");var UnitType=function(){function t(){}return t.ROLE=1,t.MONSTER=2,t.PET=3,t.HUOBAN=4,t.BOX=5,t.TOWER=6,t.NPC=100,t.BIAOCHE=101,t}();__reflect(UnitType.prototype,"UnitType");var UnitViewCreator=function(){function t(){this._actionUnitPool=[],this._roleViewPool=[],this._monsterViewPool=[],this._npcViewPool=[],this._petViewPool=[],this._hbViewPool=[],this._mc=GmGlobal.mc}return t.instence=function(){return t._instence||(t._instence=new t),t._instence},t.prototype.createHeroUIModel=function(t){var e=new RoleUnitView;e.isRelease=!1,e.dir=DirType.DOWN_RIGHT;var i=this._mc.heroMgr,s=i.getHeroCfg(t);return s&&e.setInfo(Utils.getLocalUID(),s.modelRes,s.h,s.scale||1,ActionType.STAND),e},t.prototype.createMonsterUIModel=function(t,e){void 0===e&&(e=0);var i=this._actionUnitPool.pop();i||(i=new ActionUnitView),i.isRelease=!1,i.dir=DirType.RIGHT;var s=this._mc.npcMgr.getNpcCfg(t);return s&&i.setInfo(Utils.getLocalUID(),s.res,s.h,e||1,ActionType.STAND_TO),i},t.prototype.createHuobanUIModel=function(t,e){void 0===e&&(e=0);var i=this._actionUnitPool.pop();i||(i=new ActionUnitView),i.isRelease=!1,i.dir=DirType.RIGHT;var s=this._mc.huobMgr.getCfgById(t);return s&&i.setInfo(Utils.getLocalUID(),s.mode,s.h,e||1,ActionType.STAND_TO),i},t.prototype.releaseUIModel=function(t){t&&(t.parent&&t.parent.removeChild(t),t.unuse(),-1==this._actionUnitPool.indexOf(t)&&this._actionUnitPool.push(t))},t.prototype.createMyRoleView=function(){this._myRoleView?this._myRoleView.reuse():this._myRoleView=new MyRoleUnitView,this._myRoleView.isRelease=!1;var t=this._mc.heroMgr,e=this._mc.role,i=t.getHeroCfg(e.careerId);i&&this._myRoleView.setInfo(e.roleId,i.modelRes,i.h,i.scale||1),this._myRoleView.type=UnitType.ROLE,this._myRoleView.typeId=e.careerId,this._myRoleView.uName=e.name,this._myRoleView.team=e.team,this._myRoleView.speed=e.speed||GmConst.ROLE_SPEED,this._myRoleView.aDis=i.adis,this._myRoleView.dir=DirType.LEFT,this._myRoleView.unitData||(this._myRoleView.unitData=new UnitData);var s=this._myRoleView.unitData;return s.hp=e.hp,s.hpMax=e.hpMax,s.ts=e.toushi,s.gh=e.gonghui,s.ch=e.ch,s.halo=e.halo,s.bh=e.bh,this._myRoleView},t.prototype.createRoleView=function(t){var e=this._roleViewPool.pop();e?e.reuse():e=new RoleUnitView,e.isRelease=!1;var i=this._mc.heroMgr,s=i.getHeroCfg(t.arg.careerId);s&&e.setInfo(t.uid,s.modelRes,s.h,s.scale||1),e.type=UnitType.ROLE,e.typeId=t.arg.careerId,e.uName=t.arg.name,e.team=t.arg.team||0,e.speed=GmConst.ROLE_SPEED,e.aDis=s.adis,e.dir=t.direct,e.unitData||(e.unitData=new UnitData);var o=e.unitData;return o.hpMax=t.arg.hpmax,o.hp=t.arg.hp,o.ts=t.arg.ts,o.gh=t.arg.gname,o.ch=t.arg.ch,o.halo=t.arg.gh,o.bh=t.arg.fhz,e},t.prototype.releaseRoleView=function(t){t&&(t.unuse(),-1==this._roleViewPool.indexOf(t)&&this._roleViewPool.push(t))},t.prototype.createNpcView=function(t){var e=this._mc.npcMgr.getNpcCfg(t);if(!e)return null;var i=this._npcViewPool.pop();return i?i.reuse():i=new NpcUnitView,i.isRelease=!1,i.setInfo(Utils.getLocalUID(),e.res,e.h,e.scale||1,ActionType.STAND_TO),i.type=UnitType.NPC,i.typeId=t,i.aDis=e.adis,i.isFuncNpc=!0,i},t.prototype.releaseNpcView=function(t){t&&(t.unuse(),-1==this._npcViewPool.indexOf(t)&&this._npcViewPool.push(t))},t.prototype.createMonsterView=function(t){var e=this._mc.npcMgr.getNpcCfg(t.arg.itemid);if(!e)return null;var i=this._monsterViewPool.pop();i?i.reuse():i=new MonsterUnitView,i.isRelease=!1,i.setInfo(t.uid,e.res,e.h||0,e.scale||1,ActionType.STAND_TO),i.type=UnitType.MONSTER,i.typeId=t.arg.itemid,i.isBoss=2==e.type?!0:!1;var s=GmGlobal.mc;FubenType.getClientType(s.sceneMgr.mapId)==FubenType.WANGZUO?s.wfMgr.wzName?i.uName=s.wfMgr.wzName+"'s Phantom":i.uName="Phantom":i.uName=e.name,i.team=1,i.speed=e.s||120,0==t.direct?i.dir=Utils.random(1,6):i.dir=t.direct,i.unitData||(i.unitData=new UnitData);var o=i.unitData;return o.hpMax=t.arg.hpmax,o.hp=t.arg.hp<0?t.arg.hpmax:t.arg.hp,o.lv=t.arg.lv||0,t.arg.ms&&(i.speed=t.arg.ms),i},t.prototype.releaseMonsterView=function(t){t&&(t.unuse(),-1==this._monsterViewPool.indexOf(t)&&this._monsterViewPool.push(t))},t.prototype.createPetView=function(t,e){void 0===e&&(e=!1);var i=this._mc.npcMgr.getNpcCfg(t.arg.itemid);if(!i)return null;var s;if(e){this._myPetView||(this._myPetView=new MyPetUnitView,this._myPetView.lockType=0);var o=this._mc.petMgr.getCzPet();o&&(this._myPetView.tfType=o.tf.type),s=this._myPetView,s.reuse()}else s=this._petViewPool.pop(),s?s.reuse():s=new PetUnitView;s.isRelease=!1,s.setInfo(t.uid,i.res,i.h||0,i.scale||1,ActionType.STAND),s.type=UnitType.PET,s.typeId=t.arg.itemid,s.roleId=t.arg.rid,s.uName=i.name+" of "+t.arg.name,s.team=t.arg.team||0,s.speed=GmConst.ROLE_SPEED,s.aDis=i.adis,0==t.direct?s.dir=Utils.random(1,6):s.dir=t.direct,s.unitData||(s.unitData=new UnitData);var n=s.unitData;return n.hpMax=t.arg.hpmax,n.hp=t.arg.hp,s},t.prototype.releasePetView=function(t){t&&(t.unuse(),t!=this._myPetView&&-1==this._petViewPool.indexOf(t)&&this._petViewPool.push(t))},t.prototype.createBcView=function(t){var e=new BiaoCheUnitView;return e.setInfo(t.carid,"biaoche",114,1,ActionType.RUN),e.type=UnitType.BIAOCHE,e.dir=DirType.RIGHT,e},t.prototype.releaseBcView=function(t){t&&t.unuse()},t.prototype.createHbView=function(t){var e=this._mc.huobMgr.getCfgById(t.arg.itemid);if(!e)return null;var i;i=this._hbViewPool.pop(),i?i.reuse():i=new HuoBanUnitView,i.isRelease=!1,i.setInfo(t.uid,e.res,e.height||0,e.scale,ActionType.STAND),i.type=UnitType.HUOBAN,i.typeId=t.arg.itemid,i.roleId=t.arg.rid,i.uName=e.name,i.team=t.arg.team||0,i.speed=GmConst.ROLE_SPEED,i.aDis=e.adis,0==t.direct?i.dir=Utils.random(1,6):i.dir=t.direct,i.unitData||(i.unitData=new UnitData);var s=i.unitData;return s.hpMax=t.arg.hpmax,s.hp=t.arg.hp,i},t.prototype.releaseHbView=function(t){t&&(t.unuse(),-1==this._hbViewPool.indexOf(t)&&this._hbViewPool.push(t))},t}();__reflect(UnitViewCreator.prototype,"UnitViewCreator");var BugSubmitView=function(t){function e(){var e=t.call(this,"BugSubmitSkin")||this;return e._smTime=-6e4,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.submit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSm,this),this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.rmEvts=function(){this.submit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSm,this),this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.onSm=function(){if(egret.getTimer()-this._smTime<6e4)return void MsgBox.alert("Submission too frequent，Try again later");var t=this.txt.text;if(""==t)return void MsgBox.alert("Empty，Failed");this._smTime=egret.getTimer();for(var e=0;e<t.length;e+=150)GmGlobal.cc.chatCtl.sengChatMsg(1,t.substr(e,150),{},!1);MsgBox.alert("Thanks"),this.close()},e.prototype.close=function(){this.txt.text="",t.prototype.close.call(this)},e}(UIBase);__reflect(BugSubmitView.prototype,"BugSubmitView");var CostRecordItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tTime.text=Utils.formatDate(Utils.getServerTime(this.data.t),"Y-M-D h:m:s"),this.tCost.text=this.data.cost;var t=GmGlobal.mc.itemMgr.getItemCfg(this.data.id);if(t){var e=t.name;t.quality>1&&(e=TextFormat.setColor(t.name,Utils.getQualityColor(t.quality))),this.tName.textFlow=TextFormat.parser.parse("Mall:"+e)}else this.tName.text=GmGlobal.mc.txtMgr.getCostName(this.data.id)},e}(eui.ItemRenderer);__reflect(CostRecordItem.prototype,"CostRecordItem");var CostRecordView=function(t){function e(){return t.call(this,"CostRecordSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="CostRecordItemSkin",this.itemList.itemRenderer=CostRecordItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),GmGlobal.mc.setMgr.costList?this.update():GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.TAKE_RECORD,null,this.onJsonRet,this)},e.prototype.updateData=function(t){console.log("ddd")},e.prototype.onJsonRet=function(t){if(t.l){var e=[];for(var i in t.l){var s=t.l[i],o=s.split(","),n={id:Number(o[1]),t:t.b+Number(o[2]),cost:o[3]+("1"==o[0]?" Diamond":" Crystal")};e.push(n)}e.sort(function(t,e){return e.t-t.t}),GmGlobal.mc.setMgr.costList=e,this.update()}},e.prototype.update=function(){this._array.replaceAll(GmGlobal.mc.setMgr.costList)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_RECORD)},e}(UIBase);__reflect(CostRecordView.prototype,"CostRecordView");var SettingManager=function(){function t(){this.bgmState=!0,this.soundState=!0,GmGlobal.mc.regUnzipCfg("c_txk.json",this.initXkCfg,this)
}return t.prototype.initXkCfg=function(t){this.xkCfg=t},t.prototype.setMusicState=function(t){this.bgmState=t;var e=t?"1":"-1";egret.localStorage.setItem("musicstate",e)},t.prototype.setSoundState=function(t){this.soundState=t;var e=t?"1":"-1";egret.localStorage.setItem("soundstate",e)},t.prototype.getXkCfg=function(t){return this.xkCfg[t]},t.prototype.getSelTxk=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.TXK).data,e=t.head||0;return e},t}();__reflect(SettingManager.prototype,"SettingManager");var SettingMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SET,CmdType.O_SET),CmdBus.adListener(CmdType.O_SET,this.doOpen,this),CmdBus.adListener(CmdType.C_SET,this.onCloseView,this),CmdBus.adListener(CmdType.O_BUG_SM,this.onOpenBugSm,this),CmdBus.adListener(CmdType.O_RECORD,this.openCostView,this),CmdBus.adListener(CmdType.C_RECORD,this.closeCostView,this),CmdBus.adListener(CmdType.O_XK,this.openXKView,this),CmdBus.adListener(CmdType.C_XK,this.closeXKView,this),GmGlobal.cc.itemCtl.bindItemCallback(ItemID.DIAMOND,this.onItemChange,this),GmGlobal.cc.itemCtl.bindItemCallback(ItemID.SHUIJING,this.onItemChange,this)}return t.prototype.onItemChange=function(){GmGlobal.mc.setMgr.costList=null},t.prototype.doOpen=function(){this._uiView||(this._uiView=new SettingView),this._uiView.isShow||this._uiView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseView=function(){this._uiView&&(this._uiView.close(),this._uiView=null)},t.prototype.onOpenBugSm=function(){this._bugView||(this._bugView=new BugSubmitView),this._bugView.isShow||this._bugView.show(GmGlobal.vmc.uiLayer,!0,!0)},t.prototype.openCostView=function(){this._costView||(this._costView=new CostRecordView),this._costView.isShow||this._costView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeCostView=function(){this._costView&&(this._costView.close(),this._costView=null)},t.prototype.openXKView=function(){this._xkView||(this._xkView=new XKView),this._xkView.isShow||this._xkView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeXKView=function(){this._xkView&&(this._xkView.close(),this._xkView=null)},t}();__reflect(SettingMediator.prototype,"SettingMediator");var SettingView=function(t){function e(){return t.call(this,"SetSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",PFConst.HAS_HELP||this.bHelp.parent.removeChild(this.bHelp)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow(),this.updateSoundSwitch(),PFConst.init();var i=GmGlobal.mc.role;this.tName.text="S"+i.serverId+" - "+i.name,this.tId.text="ID："+i.roleId;var s=GmGlobal.mc.ghMgr;s.id?this.tGh.text="Guild："+s.name:this.tGh.text="Guild：None",this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+i.careerId+".png",this.tqq.text=PFConst.CONTACTUS,PFConst.CONTACTUS&&""!=PFConst.CONTACTUS||(this.tqq.visible=!1),PFConst.S_ACCOUNT||this.bSaccount.parent.removeChild(this.bSaccount),PFConst.RESTART||this.bRstart.parent.removeChild(this.bRstart),1==this.btnCon.numChildren?this.btnCon.getChildAt(0).x=280:2==this.btnCon.numChildren&&(this.btnCon.getChildAt(0).x=150,this.btnCon.getChildAt(1).x=410),this.showCDK(PFConst.HAS_CDK),this.onTxkUpd(),PFConst.CID&&""!=PFConst.CID?this.tCid.text="CharacterID:\n"+PFConst.CID:(this.tCid.text="",this.bCopy.visible=!1,this.cidBg.visible=!1)},e.prototype.updatePos=function(){this.x=Math.round(GmGlobal.stageWidth/2),this.y=Math.round(GmGlobal.stageHeight/2),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bGm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGm,this),this.bMusic.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.bSound.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.bGg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGg,this),this.bCdk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCDK,this),this.cdkTxt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCDKTxt,this),this.bRstart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRstart,this),this.bSaccount.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSaccount,this),this.bCost.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecord,this),this.bXk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onXk,this),this.bHelp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelp,this),this.bCopy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCopy,this),EventBus.addListener(EventType.M_JUPD+JsonID.TXK,this.onTxkUpd,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bGm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGm,this),this.bMusic.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.bSound.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.bGg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGg,this),this.bCdk.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCDK,this),this.cdkTxt.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCDKTxt,this),this.bRstart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRstart,this),this.bSaccount.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSaccount,this),this.bCost.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecord,this),this.bXk.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onXk,this),this.bHelp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelp,this),this.bCopy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCopy,this),EventBus.rmListener(EventType.M_JUPD+JsonID.TXK,this.onTxkUpd,this)},e.prototype.showCDK=function(t){this.cdkBg.visible=t,this.cdkTxt.visible=t,this.bCdk.visible=t},e.prototype.onGm=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.PAY).data,e=t.rn||0,i=GmGlobal.mc.heroMgr.getRNameCost(e);MsgBox.input("Enter new name("+TextFormat.setColor(i.toString(),6854854)+" diamonds)",this.doReName,null,this)},e.prototype.doReName=function(t){if(t==GmGlobal.mc.role.name)return void MsgBox.alert("Enter new name");if(t=t.replace(/ /g,""),Utils.checkName(t)){var e=this;PFConst.CHECK_MSG?GmGlobal.cc.roleCtl.checkName(t,function(i){0==i&&GmGlobal.cc.roleCtl.rename(t,e.renameOk,e)}):GmGlobal.cc.roleCtl.rename(t,this.renameOk,this)}},e.prototype.renameOk=function(){var t=GmGlobal.mc.role;this.tName.text=t.name,GmGlobal.cc.pfCtl.pfCmd("rename",t.name)},e.prototype.onSwitch=function(t){var e=GmGlobal.mc.setMgr;t.target==this.bMusic?(e.setMusicState(!e.bgmState),GmGlobal.sound.bgmSwitch(e.bgmState)):(e.setSoundState(!e.soundState),GmGlobal.sound.sEffectSwitch(e.soundState)),this.updateSoundSwitch()},e.prototype.updateSoundSwitch=function(){var t=GmGlobal.mc.setMgr;this.bMusic.source=t.bgmState?"com_json.set_open":"com_json.set_off",this.bSound.source=t.soundState?"com_json.set_open":"com_json.set_off"},e.prototype.onBug=function(){CmdBus.doCmd(CmdType.O_BUG_SM),this.onClose()},e.prototype.onGg=function(){CmdBus.doCmd(CmdType.O_NOTICE),this.onClose()},e.prototype.onCDKTxt=function(){this.cdkTxt.text=""},e.prototype.onCDK=function(){var t=this.cdkTxt.text;if(t=t.replace(/\s+/g," "),t&&""!=t&&" "!=t&&!(t.length>30)){GmGlobal.cc.dataCtl.ajaxReq("/cdk/code/"+t,this.onCdkRet,this)}},e.prototype.onCdkRet=function(t){this.cdkTxt.text="",MsgBox.prompt(t.data)},e.prototype.onTxkUpd=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.TXK).data,i=e.head||0,s=t.setMgr.getXkCfg(i);s?(this.txk.source="txk_json."+s.icon,this.getChildIndex(this.txk)<this.getChildIndex(this.icon)&&this.setChildIndex(this.txk,this.getChildIndex(this.icon))):(this.txk.source="txk_json.txk",this.getChildIndex(this.txk)>this.getChildIndex(this.icon)&&this.setChildIndex(this.txk,this.getChildIndex(this.icon)-1))},e.prototype.onRstart=function(){GmGlobal.cc.pfCtl.pfRestart()},e.prototype.onSaccount=function(){GmGlobal.cc.pfCtl.pfLogout()},e.prototype.onRecord=function(){CmdBus.doCmd(CmdType.O_RECORD)},e.prototype.onXk=function(){CmdBus.doCmd(CmdType.O_XK)},e.prototype.onHelp=function(){GmGlobal.cc.pfCtl.showPfKefu()},e.prototype.onCopy=function(){GmGlobal.cc.pfCtl.pfCmd("copy",PFConst.CID)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SET)},e}(UIBase);__reflect(SettingView.prototype,"SettingView");var XKItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GmGlobal.mc;this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+t.role.careerId+".png",this.xk.source="txk_json."+this.data.cfg.icon,this.sel.visible=this.data.id==this.data.sid?!0:!1;var e=t.vip1Mgr.getCurVip();e<this.data.cfg.vip?this.vip.text="VIP"+this.data.cfg.vip+" Enable":this.vip.text=""},e}(eui.ItemRenderer);__reflect(XKItem.prototype,"XKItem");var XKView=function(t){function e(){return t.call(this,"XkViewSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="XKItemSkin",this.itemList.itemRenderer=XKItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateList()},e.prototype.updateList=function(){var t=GmGlobal.mc,e=t.setMgr.xkCfg,i=t.dataMgr.getJData(JsonID.TXK).data,s=i.head||0;this._array.removeAll();for(var o in e)this._array.addItem({id:Number(o),cfg:e[o],sid:s})},e.prototype.onTouchList=function(t){if(t.target.data){var e=GmGlobal.mc,i=e.vip1Mgr.getCurVip(),s=e.dataMgr.getJData(JsonID.TXK).data;s.head||0;t.target.data.cfg.vip>i?MsgBox.prompt("VIP"+t.target.data.cfg.vip+" Enable"):(GmGlobal.cc.dataCtl.doAction(ServerActionId.TXK,[t.target.data.id]),this.close())}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_XK)},e}(UIBase);__reflect(XKView.prototype,"XKView");var ShareController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_SHARE,this.onUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.shareMgr;i.infos=e||{},this.updRedDot(),EventBus.dispatchEvt(EventType.M_SHARE)},t.prototype.updRedDot=function(){var t=GmGlobal.mc.shareMgr.redDot;if(t){var e=GmGlobal.mc.shareMgr.infos,i=0;for(var s in e){var o=e[s];if(o)for(var n in o.sub){var r=o.sub[n];r&&1==r.state&&(i=1)}}t.state=i}},t}();__reflect(ShareController.prototype,"ShareController");var ShareItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.ms;1==this.data.state?(this.bLq.visible=!0,this.ylqImg.visible=!1,t=t.replace("%x",this.data.nnum)):2==this.data.state?(this.bLq.visible=!1,this.ylqImg.visible=!0,t=t.replace("%x",this.data.nnum)):(this.bLq.visible=!1,this.ylqImg.visible=!1,t=t.replace("%x","("+TextFormat.setColor(this.data.hnum,Colors.RED)+"/"+TextFormat.setColor(this.data.nnum,Colors.GREEN)+")")),this.jdTxt.textFlow=TextFormat.parser.parse(t),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.item,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.txtCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(ShareItem.prototype,"ShareItem");var ShareManager=function(){function t(){this.infos={},GmGlobal.mc.regUnzipCfg("c_share.json",this.initConfig,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.SHARE,this.redDot)}return t.prototype.initConfig=function(t){t&&(this.cfgs=t)},t.prototype.getTaskData=function(t,e){var i=this.infos[t];return i?i.sub[e]:null},t.prototype.isDelIcon=function(){var t=!0,e=this.cfgs;for(var i in e)for(var s=e[i],o=0;o<s.lst.length;o++){var n=(s.lst[o],this.getTaskData(i,o+1)),r=n?n.state:0;if(2!=r){t=!1;break}}return t},t}();__reflect(ShareManager.prototype,"ShareManager");var ShareMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SHARE,CmdType.O_SHARE),CmdBus.adListener(CmdType.O_SHARE,this.onOpenView,this),CmdBus.adListener(CmdType.C_SHARE,this.onCloseView,this)}return t.prototype.onOpenView=function(){this.doOpen()},t.prototype.doOpen=function(){this._uiView||(this._uiView=new ShareView),this._uiView.isShow||(this._uiView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._uiView&&this._uiView.isShow&&this._uiView.close()},t.prototype.destroy=function(){return this._uiView?this._uiView&&this._uiView.isDestroy()?(this._uiView.destroy(),this._uiView=null,!0):!1:!0},t}();__reflect(ShareMediator.prototype,"ShareMediator",["IMediator"]);var ShareView=function(t){function e(){return t.call(this,"ShareSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ShareItemSkin",this.itemList.itemRenderer=ShareItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bYq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),EventBus.addListener(EventType.M_SHARE,this.updateUI,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bYq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),EventBus.rmListener(EventType.M_SHARE,this.updateUI,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.updateUI()},e.prototype.updateUI=function(){var t=GmGlobal.mc.shareMgr,e=t.cfgs;for(var i in e)for(var s=e[i],o=0;o<s.lst.length;o++){var n=s.lst[o],r=t.getTaskData(i,o+1),h={item:n.items,nnum:n.num,ms:s.describe.replace("%y",n.num[1]),hnum:r?r.num:0,state:r?r.state:0,id1:i,id2:o+1},a=this._array.getItemAt(o);a?this._array.replaceItemAt(h,o):this._array.addItem(h)}},e.prototype.onTouchList=function(t){var e=t.target;if("btn"==e.name){var i=e.parent.data;GmGlobal.cc.dataCtl.doAction(ServerActionId.INVITE,[i.id1,i.id2])}},e.prototype.onYq=function(){GmGlobal.cc.pfCtl.pfShare(this.onShare,this)},e.prototype.onShare=function(){},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SHARE)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("share_json"),t.prototype.destroy.call(this)},e}(UIBase);__reflect(ShareView.prototype,"ShareView");var ShipinController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_SHIPIN,this.onUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.shipinMgr;i.info=e||{},EventBus.dispatchEvt(EventType.M_SHIPIN)},t}();__reflect(ShipinController.prototype,"ShipinController");var ShipinItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.cfg,e="Watch today X Obtain the following packs";e=this.data.cnt<t.cnt?e.replace("%x",TextFormat.setColor(this.data.cnt,Colors.RED)+"/"+TextFormat.setColor(t.cnt,Colors.GREEN)):e.replace("%x",t.cnt+"/"+t.cnt),this.tTxt.textFlow=TextFormat.parser.parse(e);var i=t.award;this.clearItems(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(i,115,!1,!0,!1),this._itemGridCon.addToParent(15,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(ShipinItem.prototype,"ShipinItem");var ShipinManager=function(){function t(){this.info={},GmGlobal.mc.regUnzipCfg("c_shipin.json",this.initConfig,this)}return t.prototype.initConfig=function(t){t&&(this._cfgs=t)},t.prototype.getCfgs=function(t){return void 0===t&&(t=1),this._cfgs[t-1]},t}();__reflect(ShipinManager.prototype,"ShipinManager");var ShipinMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SHIPIN,CmdType.O_SHIPIN),CmdBus.adListener(CmdType.O_SHIPIN,this.onOpenView,this),CmdBus.adListener(CmdType.C_SHIPIN,this.onCloseView,this)}return t.prototype.onOpenView=function(){GroupLoading.getInstence().start("shipin",null,this.doOpen,this)},t.prototype.doOpen=function(){this._uiView||(this._uiView=new ShipinView),this._uiView.isShow||(this._uiView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._uiView&&this._uiView.isShow&&this._uiView.close()},t.prototype.destroy=function(){return this._uiView?this._uiView&&this._uiView.isDestroy()?(this._uiView.destroy(),this._uiView=null,!0):!1:!0},t}();__reflect(ShipinMediator.prototype,"ShipinMediator",["IMediator"]);var ShipinView=function(t){function e(){var e=t.call(this,"ShipinSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ShipinItemSkin",this.itemList.itemRenderer=ShipinItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),EventBus.addListener(EventType.M_SHIPIN,this.updateUI,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bBuy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),EventBus.addListener(EventType.M_SHIPIN,this.updateUI,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateUI()},e.prototype.updateUI=function(){var t=this._mc.shipinMgr.info.et||0;t-=GmGlobal.getServerTime(),t>0?(this.tcd.visible=!0,Utils.setBtnEnable(this.bBuy,!1),CDText.getInstence().addCD(this.tcd,t,"","m:s"," to watch the video again",this.onTimeOut,this)):this.onTimeOut(),this.updLst()},e.prototype.onTimeOut=function(){this.tcd.visible=!1,Utils.setBtnEnable(this.bBuy,!0)},e.prototype.updLst=function(){for(var t=this._mc.shipinMgr,e=t.info.id||1,i=t.info.cnt||0,s=t.getCfgs(e),o=0;o<s.cfg.length;o++){var n=s.cfg[o],r={cfg:n,cnt:i,idx:o+1},h=this._array.getItemAt(o);h?this._array.replaceItemAt(r,o):this._array.addItem(r)}},e.prototype.onBuy=function(){GmGlobal.cc.pfCtl.pfViewAd(this.onVideoRet,this)},e.prototype.onVideoRet=function(t){0==t&&this._cc.dataCtl.doAction(ServerActionId.SHIPIN)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SHIPIN)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("shipin_bg_png")},e}(UIBase);__reflect(ShipinView.prototype,"ShipinView");var AllPayTestItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tName.text=this.data.txt,this.payBtn.label="$"+this.data.price},e}(eui.ItemRenderer);__reflect(AllPayTestItem.prototype,"AllPayTestItem");var AllPayTestView=function(t){function e(){return t.call(this,"PayTestSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="PayTestItemSkin",this.itemList.itemRenderer=AllPayTestItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateList()},e.prototype.updateList=function(){this._array.removeAll(),this.scoll.viewport.scrollV=0;for(var t=GmGlobal.mc.shopMgr.testCfgs,e=0;e<t.length;e++){var i=t[e];this._array.addItem(i)}},e.prototype.onList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;GmGlobal.cc.pfCtl.Pay(100*e.price,e.itemId)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_PAYTEST)},e}(UIBase);__reflect(AllPayTestView.prototype,"AllPayTestView");var ExchangeView=function(t){function e(){var e=t.call(this,"ExchangeSkin")||this;return e._buyNum=1,e._maxNum=1e7,e._txt="",e._sNo=0,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inputTxt.restrict="0-9",this.inputTxt.prompt="1",this.inputTxt.text=this._buyNum+"",this.okBtn.label="Redeem",this.cancelBtn.label="Cancel",this.badd.sound="ui_jiajian",this.brdc.sound="ui_jiajian"},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.badd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addNum,this),this.brdc.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lessNum,this),this.inputTxt.addEventListener(egret.Event.CHANGE,this.onChang,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.cancelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.badd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.addNum,this),this.brdc.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.lessNum,this),this.inputTxt.removeEventListener(egret.Event.CHANGE,this.onChang,this)},e.prototype.updateBox=function(t,e,i,s,o){void 0===s&&(s=1),void 0===o&&(o=1),this._txt=t,this._getId=e,this._needId=i,this._scale=s,this._change=o,this.icon0.source=GmGlobal.mc.itemMgr.getItemSicon(this._getId),this.icon1.source=GmGlobal.mc.itemMgr.getItemSicon(this._needId),this.txt.text=t,this.refNum()},e.prototype.onChang=function(t){""==t.target.text?this._buyNum=1:this._buyNum=Math.floor(parseInt(t.target.text)/this._change),this._buyNum>=this._maxNum/this._change?this._buyNum=this._maxNum/this._change:this._buyNum<=1&&(this._buyNum=1)},e.prototype.addNum=function(){this._buyNum+=1,this._buyNum>=this._maxNum/this._change&&(this._buyNum=this._maxNum/this._change),this.refNum()},e.prototype.lessNum=function(){this._buyNum-=1,this._buyNum<=1&&(this._buyNum=1),this.refNum()},e.prototype.refNum=function(){this.inputTxt.text=this._buyNum*this._change+"",this.tnum.text=Math.floor(this._buyNum*this._change*this._scale)+""},e.prototype.onTouchEnd=function(t){this.refNum()},e.prototype.onOk=function(){ItemLackTips.instance().setItemUse(this._needId,Number(this.inputTxt.text)),this._cc.dataCtl.doAction(ServerActionId.ITEM_SELL,[this._needId,Number(this.inputTxt.text)],this.onCancel,this,this.onCancel)},e.prototype.onCancel=function(){ItemLackTips.instance().setItemUse(0,0),this.close()},e.prototype.close=function(){0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),this._buyNum=1,t.prototype.close.call(this)},e}(UIBase);__reflect(ExchangeView.prototype,"ExchangeView");var PayItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.cfg;this.data.fb?t.first?this.sm.textFlow=TextFormat.parser.parser("From First Recharge:"+TextFormat.setColor(t.first,16615680)):this.sm.text="":t.other?this.sm.textFlow=TextFormat.parser.parser("Recharge to get:"+TextFormat.setColor(t.other,16615680)):this.sm.text="",this.payBtn.label="$ "+t.price,this.icon.source="zsicon_json."+t.icon,this.tName.text=t.name,t.tagStr?(this.itag.visible=!0,this.ttag.visible=!0,this.ttag.text=t.tagStr,this.data.fb||(this.itag.visible=!1,this.ttag.visible=!1)):(this.itag.visible=!1,this.ttag.visible=!1)},e}(eui.ItemRenderer);__reflect(PayItem.prototype,"PayItem");var ShopController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_SHOP,this.onUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_SHOP_ZS,this.onZsUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.GIFT_DATA,this.onGiftUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.shopMgr;i.infos=e,EventBus.dispatchEvt(EventType.M_SHOP)},t.prototype.onZsUpd=function(t){var e=t.data.data,i=GmGlobal.mc.shopMgr;i.zsInfos=e,EventBus.dispatchEvt(EventType.M_SHOP_ZS)},t.prototype.onGiftUpd=function(t){var e=GmGlobal.mc,i=e.dataMgr.getGiftValue(GiftType.SHOPGIFT_FREE,0),s=e.shopMgr.giftCfgs.gift[0];e.shopMgr.redDot.childs[1].state=i<s.daynum?1:0,EventBus.dispatchEvt(EventType.SHOP_LB)},t}();__reflect(ShopController.prototype,"ShopController");var ShopGiftItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=GmGlobal.mc,e=t.itemMgr.getItemCfg(this.data.id);e&&(this.tName.text=e.name),this.data||console.log("this.data is null"),this.icon.source="lbicon_json."+this.data.res,this.data.price?(this.payBtn.label="$"+this.data.price,this.payBtn.skinName="ComBtnSkinY1"):(this.payBtn.label="Free",this.payBtn.skinName="ComBtnSkinB1");var i=t.dataMgr.getJData(JsonID.SHOP_LB).data,s=i[this.data.id]||0;if(this.data.price){var o=t.dataMgr.getJData(JsonID.SHOP_LB).data;s=o[this.data.id]||0,this.sm.text="Today Only Sale "+s+"/"+this.data.daynum}else s=t.dataMgr.getGiftValue(GiftType.SHOPGIFT_FREE,0),this.sm.text="Claim Today "+s+"/"+this.data.daynum;Utils.setBtnEnable(this.payBtn,s>=this.data.daynum?!1:!0)}},e}(eui.ItemRenderer);__reflect(ShopGiftItem.prototype,"ShopGiftItem");var ShopItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.cfg,e=GmGlobal.mc.itemMgr.getItemCfg(t.item.id);this.tName.text=e.name,this.sm.text=this.data.str,this.icon.setItem(t.item),this.icon.enableTip(!0),this.btn.label=t.cost.num,this.btn.iconDisplay.source=GmGlobal.mc.itemMgr.getItemSicon(t.cost.id)},e}(eui.ItemRenderer);__reflect(ShopItem.prototype,"ShopItem");var ShopManager=function(){function t(){this.payCfgs=[],this.xhCfgs=[],this.clCfgs=[],this.eqpCfgs=[],this.ghCfgs=[],this.kplCfgs=[],this.qkplCfgs=[],this.dhCfgs=[],this.zsInfos={},this.infos={},GmGlobal.mc.regUnzipCfg("c_shop.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_paytest.json",this.initTestCfg,this),GmGlobal.mc.regUnzipCfg("c_shopgift.json",this.initShopGift,this),GmGlobal.mc.regUnzipCfg("c_box.json",this.initBoxCfg,this),GmGlobal.mc.regUnzipCfg("c_pay.json",this.initPayCfg,this);var t={1:0};this.redDot=RedDot.initRedDot(t),this.redDot.childs[1].state=1,GmGlobal.mc.muiMgr.regRedDot(ModelID.SHOP,this.redDot)}return t.prototype.initCfg=function(t){this.payCfgs=t.pay,this.xhCfgs=t.xiaohao,this.clCfgs=t.cailiao,this.eqpCfgs=t.equip,this.ghCfgs=t.guild,this.kplCfgs=t.kapula,this.qkplCfgs=t.quickpurchase,this.dhCfgs=t.exchange||[],this.sweetCfgs=t.candy,this.smsd1=t.mystery1,this.smsd2=t.mystery2,this.lhjDh1=t.tiger1,this.lhjDh2=t.tiger2},t.prototype.initTestCfg=function(t){this.testCfgs=t},t.prototype.initShopGift=function(t){this.giftCfgs=t},t.prototype.initBoxCfg=function(t){this.boxCfgs=t},t.prototype.initPayCfg=function(t){this.payCfgs=t.pay},t.prototype.getPayName=function(t,e){for(var i=0;i<this.testCfgs.length;i++){var s=this.testCfgs[i];if(s.itemId==t&&s.price==e)return s.txt}return"$"+e+" Recharge"},t.prototype.getKapulaItemCfg=function(t){for(var e=0,i=this.kplCfgs;e<i.length;e++){var s=i[e];if(s.item.id==t)return s}return null},t.prototype.getQuickKapulaCfg=function(t){for(var e=0,i=this.qkplCfgs;e<i.length;e++){var s=i[e];if(s.item.id==t)return s}return null},t.prototype.getShopGiftGetStr=function(t){var e=this.boxCfgs[t];if(!e)return null;var i;i=10072==t?"Claim to receive:":"Open to receive:";for(var s=0;s<e.award.length;s++){var o=e.award[s],n=GmGlobal.mc.itemMgr.getItemCfg(o.id);n&&(i+="\n"+n.name+"*"+o.num)}if(i+="\n",e.extraaward)for(var s=0;s<e.extraaward.length;s++){var r=e.extraaward[s],n=GmGlobal.mc.itemMgr.getItemCfg(r.id);i+="\n"+r.rate+"% rate to receive:\n"+n.name+"*"+r.num}return i},t}();__reflect(ShopManager.prototype,"ShopManager");var ShopMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SHOP,CmdType.O_SHOP),GmGlobal.mc.muiMgr.regCmd(ModelID.PAY_TEST,CmdType.O_PAYTEST),CmdBus.adListener(CmdType.O_SHOP,this.onOpenView,this),CmdBus.adListener(CmdType.C_SHOP,this.onCloseView,this),CmdBus.adListener(CmdType.O_EXCHANGE,this.onOpenExView,this),CmdBus.adListener(CmdType.C_EXCHANGE,this.onCloseExView,this),CmdBus.adListener(CmdType.O_PAYTEST,this.onOpenTest,this),CmdBus.adListener(CmdType.C_PAYTEST,this.onCloseTest,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._idx=t,this._cmd=e,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new ShopView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._idx,this._cmd)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenExView=function(t,e,i,s,o){void 0===s&&(s=1),void 0===o&&(o=1),this._exview||(this._exview=new ExchangeView),this._exview.isShow||(this._exview.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._exview.updateBox(t,e,i,s,o)},t.prototype.onCloseExView=function(){this._exview&&this._exview.isShow&&this._exview.close()},t.prototype.onOpenTest=function(){this._testView||(this._testView=new AllPayTestView),this._testView.isShow||this._testView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseTest=function(){this._testView&&this._testView.isShow&&(this._testView.close(),this._testView=null)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(ShopMediator.prototype,"ShopMediator",["IMediator"]);var ShopView=function(t){function e(){var e=t.call(this,"ShopSkin")||this;return e._cmd=0,e._sNo=0,e._tabIdx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.zsScoll.verticalScrollBar?this.zsScoll.verticalScrollBar.autoVisibility=!1:(this.zsScoll.verticalScrollBar=new eui.VScrollBar,this.zsScoll.verticalScrollBar.skinName="skins.VScrollBarSkin",this.zsScoll.addChild(this.zsScoll.verticalScrollBar),this.zsScoll.verticalScrollBar.x=this.zsScoll.width-this.zsScoll.verticalScrollBar.width,this.zsScoll.verticalScrollBar.height=this.zsScoll.height,this.zsScoll.verticalScrollBar.viewport=this.zsitemList,this.zsScoll.verticalScrollBar.autoVisibility=!1),this.scoll.verticalScrollBar?this.scoll.verticalScrollBar.autoVisibility=!1:(this.scoll.verticalScrollBar=new eui.VScrollBar,this.scoll.verticalScrollBar.skinName="skins.VScrollBarSkin",this.scoll.addChild(this.scoll.verticalScrollBar),this.scoll.verticalScrollBar.x=this.scoll.width-this.scoll.verticalScrollBar.width,this.scoll.verticalScrollBar.height=this.scoll.height,this.scoll.verticalScrollBar.viewport=this.itemList,this.scoll.verticalScrollBar.autoVisibility=!1),this._zsArray=new eui.ArrayCollection,this.zsitemList.dataProvider=this._zsArray,this.zsitemList.itemRendererSkinName="PayItemSkin",this.zsitemList.itemRenderer=PayItem,this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ShopItemSkin",this.itemList.itemRenderer=ShopItem,PFConst.IS_NOPAY&&(PFConst.IS_IOS_AUDIT?(this.tableBgCon.removeChildAt(4),this.tableTxtCon.removeChildAt(4),this.tableBgCon.removeChildAt(3),this.tableTxtCon.removeChildAt(3),this.tableBgCon.removeChildAt(2),this.tableTxtCon.removeChildAt(2),this.tableBgCon.removeChildAt(1),this.tableTxtCon.removeChildAt(1)):(this.tableBgCon.removeChildAt(1),this.tableTxtCon.removeChildAt(1),this.tableBgCon.removeChildAt(0),this.tableTxtCon.removeChildAt(0)))
},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.zsitemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchZsList,this),EventBus.addListener(EventType.M_SHOP_ZS,this.updZsLst,this),EventBus.addListener(EventType.M_SHOP,this.updLst,this),EventBus.addListener(EventType.SHOP_LB,this.onGiftUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.SHOP_LB,this.onGiftUpd,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.zsitemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchZsList,this),EventBus.rmListener(EventType.M_SHOP_ZS,this.updZsLst,this),EventBus.rmListener(EventType.M_SHOP,this.updLst,this),EventBus.rmListener(EventType.SHOP_LB,this.onGiftUpd,this),EventBus.rmListener(EventType.M_JUPD+JsonID.SHOP_LB,this.onGiftUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),PFConst.IS_NOPAY||(this.updateTabRedDot(),this.bindRedDotCb())},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIdx)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t,e){if(void 0===e&&(e=0),t!=this._tabIdx){if(-1!=this._tabIdx){var i=this.tableBgCon.getChildAt(this._tabIdx);i.source="com_json.tab_ui0"}var s=this.tableBgCon.getChildAt(t);s.source="com_json.tab_ui1",this._tabIdx=t;var o=t;PFConst.IS_NOPAY&&!PFConst.IS_IOS_AUDIT&&(o+=2),0==o?(this.zstit.visible=!0,this.zsScoll.visible=!0,this.scoll.visible=!1,this.zsitemList.itemRendererSkinName="PayItemSkin",this.zsitemList.itemRenderer=PayItem,this.zsScoll.stopAnimation(),this.zsScoll.viewport.scrollV=0,this.updZsLst()):1==o?(this.zstit.visible=!0,this.zsScoll.visible=!0,this.scoll.visible=!1,this.zsitemList.itemRendererSkinName="ShopGiftItemSkin",this.zsitemList.itemRenderer=ShopGiftItem,this.zsScoll.stopAnimation(),this.zsScoll.viewport.scrollV=0,this.updGiftLst()):(this.zstit.visible=!1,this.zsScoll.visible=!1,this.scoll.visible=!0,this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.updLst()),this._cmd=e}},e.prototype.onZsLstUpd=function(){0==this._tabIdx&&this.updZsLst()},e.prototype.updZsLst=function(){this._zsArray.removeAll();for(var t=this._mc.shopMgr.payCfgs,e=0;e<t.length;e++){var i=t[e],s=this._mc.shopMgr.zsInfos[i.price],o={cfg:i,fb:1==s?!1:!0,index:e+1};this._zsArray.addItem(o)}this.zsScoll.verticalScrollBar&&(this.zsScoll.verticalScrollBar.visible=t.length>9?!0:!1)},e.prototype.updGiftLst=function(){this._zsArray.removeAll();for(var t=this._mc.shopMgr.giftCfgs,e=0;e<t.gift.length;e++)this._zsArray.addItem(t.gift[e]);this.zsScoll.verticalScrollBar&&(this.zsScoll.verticalScrollBar.visible=t.gift.length>9?!0:!1)},e.prototype.onGiftUpd=function(){if(1==this._tabIdx)for(var t=this._mc.shopMgr.giftCfgs,e=0;e<t.gift.length;e++)this._zsArray.replaceItemAt(t.gift[e],e);PFConst.IS_NOPAY||this.updateTabRedDot()},e.prototype.updLst=function(){var t=[],e=this._tabIdx;PFConst.IS_NOPAY&&!PFConst.IS_IOS_AUDIT&&(e+=2);var i=0;2==e?(i=1,t=this._mc.shopMgr.xhCfgs):3==e?(i=2,t=this._mc.shopMgr.clCfgs):4==e&&(i=4,t=this._mc.shopMgr.dhCfgs),this._array.removeAll();for(var s=this._mc.shopMgr.infos[i]||{},o=0,n=0,r=0;r<t.length;r++){var h=t[r];o=h.maxNum,n=0;var a=s[r+1],l="",c="";h.vip&&(c="P.VIP ");var d=0,p=!0;h.daynum?(a&&a.dnum&&(d=a.dnum),l=c+"Daily Limit\n"+(h.daynum-d)+"/"+h.daynum,o=h.daynum,n=h.daynum-d,0>=d&&(p=!1)):h.weeknum?(a&&a.wnum&&(d=a.wnum),l=c+"Weekly Limit\n"+(h.weeknum-d)+"/"+h.weeknum,o=h.weeknum,n=h.weeknum-d,0>=d&&(p=!1)):h.monthnum?(a&&a.mnum&&(d=a.mnum),l=c+"Monthly Limit\n"+(h.monthnum-d)+"/"+h.monthnum,o=h.monthnum,n=h.monthnum-d,0>=d&&(p=!1)):h.totalnum?(a&&a.tnum&&(d=a.tnum),l=c+"Total Limit\n"+(h.totalnum-d)+"/"+h.totalnum,o=h.totalnum,n=h.totalnum-d,0>=d&&(p=!1)):l="";var u={cfg:h,str:l,isBuy:p,index:r+1,tnum:o,cnum:n};this._array.addItem(u)}this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.visible=t.length>12?!0:!1)},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent,i=e.data.cfg;if(i.vip){var s=this._mc.vipMgr.state;if(!s&&0!=s)return void MsgBox.prompt("VIP only")}if(!e.data.isBuy)return void MsgBox.prompt("Purchase limit reached");var o=Math.max(1,e.data.tnum-e.data.cnum),n=ItemSellView.getInstance();1==i.item.num?n.setItem(i.item.id,i.cost.num,i.cost.id,o):n.setItemMany(i.item.id,i.cost.num,i.cost.id,i.item.num),n.show(GmGlobal.vmc.uiLayer)}},e.prototype.onTouchZsList=function(t){if(0==this._tabIdx||1==this._tabIdx)if("btn"==t.target.name){if(0==this._tabIdx){var e=t.target.parent,i=e.data.cfg;GmGlobal.cc.pfCtl.pfPay(100*i.price,i.diamon)}else if(1==this._tabIdx){var s=t.target.parent.data;if(0==s.price)GmGlobal.cc.dataCtl.doAction(ServerActionId.GET_GIFT,[GiftType.SHOPGIFT_FREE,0],this.onFreeGiftOk,this);else{this._mc.itemMgr.getItemCfg(s.id);GmGlobal.cc.pfCtl.Pay(100*s.price,16)}}}else if("icon"==t.target.name&&1==this._tabIdx){var s=t.target.parent.data;ItemTips.show(s.id,t.stageX,t.stageY)}},e.prototype.onFreeGiftOk=function(){this.onGiftUpd()},e.prototype.updateTabRedDot=function(){var t=GmGlobal.mc.shopMgr.redDot,e=t.childs[1],i=this.tableBgCon.getChildAt(1);if(1==e.state){var s=210;RedDotView.addRedDot(i,this.tableBgCon,"shop",s,-4)}else RedDotView.removeRedDot(i)},e.prototype.bindRedDotCb=function(){var t=GmGlobal.mc.shopMgr.redDot,e=t.childs[1];e.bindChangeCB(this.updateTabRedDot,this)},e.prototype.unbindRedDotCb=function(){var t=GmGlobal.mc.shopMgr.redDot,e=t.childs[1];e.unbindChangeCB(this.updateTabRedDot,this)},e.prototype.onClose=function(){this._cmd&&CmdBus.doCmd(CmdType.O_7DAY,0,1),CmdBus.doCmd(CmdType.C_SHOP)},e.prototype.close=function(){if(RedDotView.removeRedDotByGroup("shop"),this.unbindRedDotCb(),-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}this._tabIdx=-1,0!=this._sNo&&GmGlobal.server.clearSerialCallbak(this._sNo),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("shop_json")},e}(UIBase);__reflect(ShopView.prototype,"ShopView");var Skill=function(){function t(){}return t}();__reflect(Skill.prototype,"Skill");var SkillController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_SKILL_LST,this.onUpdSkillLst,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_SKILL_ONE,this.onUpdSkillOne,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_SKILL_LEFT,this.onUpdSkillLeft,this)}return t.prototype.onUpdSkillLst=function(t){var e=t.data.data,i=GmGlobal.mc.skillMgr;for(var s in e){var o=e[s];i.updLst(o.sd,o)}this.updateRedDot(),EventBus.dispatchEvt(EventType.M_SKILL_UPD)},t.prototype.onUpdSkillOne=function(t){var e=t.data.data,i=GmGlobal.mc.skillMgr;i.updLst(e.sd,e),this.updateRedDot(),EventBus.dispatchEvt(EventType.M_SKILL_UPD)},t.prototype.onUpdSkillLeft=function(t){var e=t.data.data,i=GmGlobal.mc.skillMgr;i.lNum=e.sattr||0,this.updateRedDot(),EventBus.dispatchEvt(EventType.M_SKILL_L_UPD)},t.prototype.updateRedDot=function(){var t=GmGlobal.mc.skillMgr,e=t.redDot.childs[0],i=GmGlobal.mc.heroMgr.getHeroCfg(GmGlobal.mc.role.careerId),s=t.poss[i.career];for(var o in s){var n=s[o],r=t.isCanUp(n),h=t.getSkillCfg(n),a=t.getSkill(n),l=0;a&&a.lv&&(l=a.lv);var c=t.lNum||0,d=0;r&&c>0&&l<h.xgDes.nums.length&&(d=1),this.setItemRD(e,n,d)}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t}();__reflect(SkillController.prototype,"SkillController");var SkillItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bAdd.sound="ui_jiajian"},e}(eui.Component);__reflect(SkillItem.prototype,"SkillItem");var SkillManager=function(){function t(){this.lNum=0,this.skillLst={},GmGlobal.mc.regUnzipCfg("c_skill.json",this.initCfg,this),this.skillLst={};var t={0:0,1:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.SKILL,this.redDot)}return t.prototype.initCfg=function(t){this.skillCfgs=t.itemCfgs,this.poss=t.poss},t.prototype.updLst=function(t,e){var i=this.getSkill(t);i||(i=new Skill),i.id=e.sd,i.lv=e.lv,i.e=e.e,this.skillLst[t]=i},t.prototype.getSkill=function(t){return this.skillLst[t]},t.prototype.getSkillCfg=function(t){return this.skillCfgs[t]},t.prototype.getIcon=function(t){var e="",i=this.skillCfgs[t],s=GmGlobal.mc.role.careerId,o=GmGlobal.mc.heroMgr.getHeroCfg(s);return i&&i.icon&&(e="skicon"+o.career+"_json."+i.icon),e},t.prototype.getSkillAry=function(t){var e=[],i=GmGlobal.mc.heroMgr.getHeroCfg(t);if(i){var s=this.poss[i.career];for(var o in s)e.push(s[o])}return e},t.prototype.isCanUp=function(t){var e=!0,i=this.skillCfgs[t],s=i.preSkill;for(var o in s){var n=this.getSkill(Number(o));if(!n||n.lv<s[o]){e=!1;break}}return e},t.prototype.getEqpSkill=function(){var t=[];for(var e in this.skillLst){var i=this.skillLst[e];i.e&&t.push(i)}return t.sort(function(t,e){return t.e-e.e}),t},t}();__reflect(SkillManager.prototype,"SkillManager");var SkillMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SKILL,CmdType.O_SKILL),CmdBus.adListener(CmdType.O_SKILL,this.onOpenView,this),CmdBus.adListener(CmdType.C_SKILL,this.onCloseView,this)}return t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new SkillView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(SkillMediator.prototype,"SkillMediator",["IMediator"]);var SkillView=function(t){function e(){var e=t.call(this,"SkillSkin")||this;return e._tabIndex=-1,e._names=["Knight","Hunter","Wizard","Priest"],e._sIdx=-1,e._col=3,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.initLst()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bReset.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReset,this),this.iconCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIconCon,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.addListener(EventType.M_SKILL_L_UPD,this.updLeftNum,this),EventBus.addListener(EventType.M_SKILL_UPD,this.updLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bReset.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReset,this),this.iconCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onIconCon,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.rmListener(EventType.M_SKILL_L_UPD,this.updLeftNum,this),EventBus.rmListener(EventType.M_SKILL_UPD,this.updLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selTab(0),this.updLst(),this.updLeftNum(),this.selGrid(0),this.alphaShow(),this.checkGuide()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(1==e)return void MsgBox.prompt("Stay tuned!");if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIndex=t}},e.prototype.updLeftNum=function(){this.tLeft.text=this._mc.skillMgr.lNum.toString(),this.updateRedDot()},e.prototype.initLst=function(){var t=this._mc.heroMgr.getHeroCfg(this._mc.role.careerId);this._poss=this._mc.skillMgr.poss[t.career];for(var e=0;12>e;e++){var i=this._poss[e+1],s=this.iconCon.getChildAt(e);s.icon.source=this._mc.skillMgr.getIcon(i),i?s.visible=!0:s.visible=!1,e%this._col==2?(s.iYjt.visible=!1,s.tyLv.visible=!1):3==Math.floor(e/this._col)&&(s.iXjt.visible=!1,s.txLv.visible=!1);var o=this._mc.skillMgr.getSkillCfg(i);o&&(s.bEqp.visible=o.type?!0:!1)}var n=this.tableTxtCon.getChildAt(0),r=this._mc.heroMgr.getCareerCfg(t.career);n.text=r.name},e.prototype.updLst=function(){for(var t in this._poss){var e=this._poss[t],i=Number(t)-1,s=this.iconCon.getChildAt(i),o=this._mc.skillMgr.getSkill(e),n=this._mc.skillMgr.skillCfgs[e];i==this._sIdx?(s.bEqp.visible=n.type?!0:!1,s.ilk.visible=!0):(s.bEqp.visible=!1,s.ilk.visible=!1),o&&o.e?(s.bEqp.skinName="ComBtnSkinB1",s.bEqp.label="Uninstall",s.iz.visible=n.type?!0:!1):(s.bEqp.skinName="ComBtnSkinY1",s.bEqp.label="Gear",s.iz.visible=!1);var r=0;o&&o.lv&&(r=o.lv),s.tNum.text=r+"/"+n.xgDes.nums.length,s.bAdd.visible=this._mc.skillMgr.isCanUp(e);var h=this.isShowXjt(i);s.iXjt.visible=0==h?!1:!0,s.txLv.visible=0==h?!1:!0,s.txLv.text="Lv."+h;var a=this.isShowYjt(i);s.iYjt.visible=0==a?!1:!0,s.tyLv.visible=0==a?!1:!0,s.tyLv.text="Lv."+a}-1!=this._sIdx&&this.updGrid(),this.updateRedDot()},e.prototype.isShowXjt=function(t){var e=0,i=this._poss[t+1],s=t+this._col,o=this._poss[s+1];if(o){var n=this._mc.skillMgr.skillCfgs[o];if(n&&n.preSkill){var r=n.preSkill[i];if(r){var h=this._mc.skillMgr.getSkill(i);(!h||h.lv<r)&&(e=r)}}}return e},e.prototype.isShowYjt=function(t){var e=0,i=this._poss[t+1],s=t+1,o=this._poss[s+1];if(o){var n=this._mc.skillMgr.skillCfgs[o];if(n&&n.preSkill){var r=n.preSkill[i];if(r){var h=this._mc.skillMgr.getSkill(i);(!h||h.lv<r)&&(e=r)}}}return e},e.prototype.onIconCon=function(t){var e=t.target.parent;if(e.parent==this.iconCon){var i=this.iconCon.getChildIndex(e);this.selGrid(i);var s=GmGlobal.vmc.mGuide;if(s.guideData&&s.guideData.id==GuideID.SKILL_DRESS){var o=s.getCurrentStep();o&&o.id==GuideTargetId.SKILL_SEL&&s.triggerTargetByID(GuideTargetId.SKILL_SEL)}var n=this._poss[i+1];if("btn"==t.target.name)GmGlobal.cc.dataCtl.doAction(ServerActionId.SKILL_UP,[n]),GmGlobal.vmc.mGuide.triggerTarget(t.target);else if("ebtn"==t.target.name){var r=this._mc.skillMgr.getSkill(n);r&&r.lv>0?(GmGlobal.cc.dataCtl.doAction(ServerActionId.SKILL_EQP,[n]),GmGlobal.vmc.mGuide.triggerTarget(t.target)):MsgBox.prompt("Skill disabled，LV up first！")}}},e.prototype.selGrid=function(t){if(t!=this._sIdx){if(-1!=this._sIdx){var e=this.iconCon.getChildAt(this._sIdx);e.ilk.visible=!1,e.bEqp.visible=!1}var i=this.iconCon.getChildAt(t);i.ilk.visible=!0,i.bEqp.visible=!0,this._sIdx=t,this.updGrid()}},e.prototype.updGrid=function(){var t=this._poss[this._sIdx+1],e=this._mc.skillMgr.getSkill(t),i=this._mc.skillMgr.skillCfgs[t];this.tName.text=i.name,this.tType.text=GmConst.SKILL_TYPE[i.type];var s="Skill Intro: "+i.des,o=0;e&&e.lv&&(o=i.xgDes.nums[e.lv-1]);var n=i.xgDes.txt;n=n.replace("%x",o.toString()),s+="\nSkill Effect: "+n,i.sp&&(s+="\nSkill Cost: "+i.sp+"SP"),i.cd&&(s+="\nSkill CD: "+i.cd+"S"),this.tms.text=s;var r=this.iconCon.getChildAt(this._sIdx);r.bEqp.visible=i.type?!0:!1},e.prototype.onReset=function(){var t=new Item(ItemID.RESETSKILL,1);ResetAtrTipView.showInfo(t,"Consume the following items，Reset your skill points？",this.resetSkill,this)},e.prototype.resetSkill=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_SKILL_RESET,[ItemID.RESETSKILL])},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData)if(t.guideData.id==GuideID.SKILL_DRESS)if(-1!=this._mc.guideMgr.guideEndIds.indexOf(GuideID.SKILL_DRESS))t.clearGuide();else{var e=this.getFirstZdSkill();-1==e&&t.clearGuide();var i=this._poss[e],s=this._mc.skillMgr.getSkill(i);if(s.e)return void t.clearGuide();var o=this.iconCon.getChildAt(e-1);if(s.lv){var n=this.x+this.iconCon.x+o.x+o.ilk.x,r=this.y+this.iconCon.y+o.y+o.ilk.y;t.bindTargetRect(GuideTargetId.SKILL_SEL,new egret.Rectangle(n,r,112,112),null);var h=t.guideData.getGuideTargetById(GuideTargetId.SKILL_ADD);h&&(h.isSkip=!0)}else{var h=t.guideData.getGuideTargetById(GuideTargetId.SKILL_SEL);h&&(h.isSkip=!0),t.bindTarget(GuideTargetId.SKILL_ADD,o.bAdd,o.bAdd.parent.localToGlobal(o.bAdd.x,o.bAdd.y))}t.bindTarget(GuideTargetId.SKILL_EQUIP,o.bEqp,o.bEqp.parent.localToGlobal(o.bEqp.x,o.bEqp.y)),t.bindTarget(GuideTargetId.CLOSE_BTN,this.bClose,this.bClose.parent.localToGlobal(this.bClose.x,this.bClose.y))}else if(t.guideData.id==GuideID.SKILL_LEARN){var e=1,i=this._poss[1],s=this._mc.skillMgr.getSkill(i);if(s.lv&&(e=2,i=this._poss[2],s=this._mc.skillMgr.getSkill(i)),s.lv)return void t.clearGuide();var o=this.iconCon.getChildAt(e-1);t.bindTarget(GuideTargetId.SKILL_ADD,o.bAdd,o.bAdd.parent.localToGlobal(o.bAdd.x,o.bAdd.y))}},e.prototype.getFirstZdSkill=function(){for(var t in this._poss){var e=this._poss[t],i=GmGlobal.mc.skillMgr.getSkillCfg(e);if(2==i.type&&!i.preSkill)return Number(t)}return-1},e.prototype.getGuidePoint=function(t){var e=this.x+this.iconCon.x+t.x,i=this.y+this.iconCon.y+t.y;return new egret.Point(e,i)},e.prototype.updateRedDot=function(){for(var t=0;1>t;t++){var e=this._mc.skillMgr.redDot.childs[t],i=this.tableBgCon.getChildAt(t);if(1==e.state){var s=this.tableBgCon.x+150*(t+1)+10*t-20;RedDotView.addRedDot(i,this.redDotCon,"skill",s,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(i);0==t&&this.updScRedDot()}},e.prototype.updScRedDot=function(){var t=this._mc.skillMgr.redDot.childs[0];if(t.childs){var e=0;for(var i in this._poss){var s=this._poss[i],o=t.childs[s],n=this.iconCon.getChildAt(e);if(o&&1==o.state&&0==this._tabIndex){var r=this.getRDPoint(n);RedDotView.addRedDot(n,this.redDotCon,"skill",r.x,r.y,"com_json.com_rdd")}else RedDotView.removeRedDot(n);e++}}},e.prototype.getRDPoint=function(t){var e=t.parent.localToGlobal(t.x,t.y);return e.x-=this.x-t.width+110,e.y-=this.y-20,e},e.prototype.onClose=function(){var t=GmGlobal.vmc.mGuide;t&&t.triggerTarget(this.bClose),CmdBus.doCmd(CmdType.C_SKILL)},e.prototype.close=function(){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,this._sIdx=-1,RedDotView.removeRedDotByGroup("skill"),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("skill_json")},e}(UIBase);__reflect(SkillView.prototype,"SkillView");var SweetBuyItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.index=this.data.index;var t=this.data.cfg,e=GmGlobal.mc.itemMgr.getItemCfg(t.item.id);this.tName.text=e.name,this.icon.setItem(t.item),this.icon.enableTip(!0),this.btn.label=t.cost.num,this.btn.iconDisplay.source=GmGlobal.mc.itemMgr.getItemSicon(t.cost.id)},e}(eui.ItemRenderer);__reflect(SweetBuyItem.prototype,"SweetBuyItem");var SweethouseController=function(){function t(){}return t}();__reflect(SweethouseController.prototype,"SweethouseController");var SweethouseItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){for(var t=0;t<this.data.need.length;t++){var e=this["sicon"+t];e.visible=!0;var i=this["num"+t];i.visible=!0;var s=this.data.need[t];e.source=GmGlobal.mc.itemMgr.getItemSicon(s.id),TextFormat.setMoneyStr(i,GmGlobal.mc.itemMgr.getItemNum(s.id),s.num,!0)}for(t;4>t;t++){var e=this["sicon"+t];e.visible=!1;var i=this["num"+t];i.visible=!1}this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.aw,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)),this.updateItems()},e.prototype.updateItems=function(){for(var t=0,e=0;e<this.data.need.length;e++){var i=this["num"+e],s=this.data.need[e],o=GmGlobal.mc.itemMgr.getItemNum(s.id);TextFormat.setMoneyStr(i,o,s.num,!0),o>=s.num&&t++}t>=this.data.need.length?Utils.setBtnEnable(this.dhBtn,!0):Utils.setBtnEnable(this.dhBtn,!1)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(SweethouseItem.prototype,"SweethouseItem");var SweethouseManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_sweethouse.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.getRule=function(){return this._cfg.rule},t.prototype.getExchangeList=function(t){return this._cfg.exchange[t]},t.prototype.getTransitionList=function(){return this._cfg.transition},t}();__reflect(SweethouseManager.prototype,"SweethouseManager");var SweethouseMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.SWEET_HOUSE,CmdType.O_SWEET),CmdBus.adListener(CmdType.O_SWEET,this.onOpenView,this),CmdBus.adListener(CmdType.C_SWEET,this.onCloseView,this),CmdBus.adListener(CmdType.O_SWEET_ZG,this.openZg,this),CmdBus.adListener(CmdType.C_SWEET_ZG,this.closeZg,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.SWEET_UPD,this.updateIcon,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.updateIcon=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.SWEET_UPD).data,e=t.et||0;e-GmGlobal.getServerTime()>0?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.SWEET_HOUSE,"mui_json.mui_b_tgw"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.SWEET_HOUSE)},t.prototype.onOpenView=function(t){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new SweetHouseView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.openZg=function(){this._zgView||(this._zgView=new SweetHouseZGView),this._zgView.isShow||this._zgView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeZg=function(){this._zgView&&this._zgView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._zgView=null,!0):!1:!0},t}();__reflect(SweethouseMediator.prototype,"SweethouseMediator",["IMediator"]);var SweetHouseView=function(t){function e(){return t.call(this,"SweetHouseViewSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="SweethouseItemSkin",this.itemList.itemRenderer=SweethouseItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bZg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZg,this),GmGlobal.cc.itemCtl.bindItemCallback(10052,this.onItemUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(10053,this.onItemUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(10054,this.onItemUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(10055,this.onItemUpdate,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bZg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZg,this),GmGlobal.cc.itemCtl.removeItemCallback(10052,this.onItemUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(10053,this.onItemUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(10054,this.onItemUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(10055,this.onItemUpdate,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.update()},e.prototype.update=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.SWEET_UPD).data,e=t.et||0,i=Math.max(e-GmGlobal.getServerTime(),0);if(i>0){this.tTime.visible=!0;var s="Event Countdown: ";CDText.getInstence().addCD(this.tTime,i,s,i>86400?"DD h:m:s":"h:m:s")}else this.tTime.visible=!1;for(var o=GmGlobal.mc.shMgr.getExchangeList(t.id),n=0;n<o.length;n++)this._array.addItem(o[n])},e.prototype.onItemUpdate=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.updateItems()}},e.prototype.onList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;GmGlobal.cc.dataCtl.doAction(ServerActionId.SWEET_DH,[e.id])}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.shMgr.getRule())},e.prototype.onZg=function(){CmdBus.doCmd(CmdType.O_SWEET_ZG)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SWEET)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),this.clearItems(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("sweet")},e}(UIBase);__reflect(SweetHouseView.prototype,"SweetHouseView");var SweetHouseZGView=function(t){function e(){return t.call(this,"SweetHouseZGSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._dhArray=new eui.ArrayCollection,this.itemList.dataProvider=this._dhArray,this.itemList.itemRendererSkinName="SweethouseDhItemSkin",this.itemList.itemRenderer=SweethouseZhItem,this.shopScoll.verticalScrollBar&&(this.shopScoll.verticalScrollBar.autoVisibility=!1),this.shopScoll.horizontalScrollBar&&(this.shopScoll.horizontalScrollBar.autoVisibility=!1),this._shopArray=new eui.ArrayCollection,this.shopItemList.dataProvider=this._shopArray,this.shopItemList.itemRendererSkinName="SweetBuyItemSkin",this.shopItemList.itemRenderer=SweetBuyItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.shopItemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShop,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDhList,this),GmGlobal.cc.itemCtl.bindItemCallback(10052,this.onItemUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(10053,this.onItemUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(10054,this.onItemUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(10055,this.onItemUpdate,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.shopItemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShop,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDhList,this),GmGlobal.cc.itemCtl.removeItemCallback(10052,this.onItemUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(10053,this.onItemUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(10054,this.onItemUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(10055,this.onItemUpdate,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateShop(),this.updateDhList()},e.prototype.updateShop=function(){this._shopArray.removeAll();for(var t=GmGlobal.mc.shopMgr.sweetCfgs,e=0;e<t.length;e++){var i=t[e],s={cfg:i,str:"",isBuy:!0,index:e+1,tnum:0,cnum:0};this._shopArray.addItem(s)}},e.prototype.updateDhList=function(){this._dhArray.removeAll();for(var t=GmGlobal.mc.shMgr.getTransitionList(),e=0;e<t.length;e++)this._dhArray.addItem(t[e])},e.prototype.onShop=function(t){if(t.target.parent.parent==this.shopItemList&&"btn"==t.target.name){var e=t.target.parent,i=e.data.cfg,s=ItemSellView.getInstance();s.setItem(i.item.id,i.cost.num,i.cost.id,i.maxNum),s.show(GmGlobal.vmc.uiLayer)}},e.prototype.onDhList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent,i=e.data;GmGlobal.cc.dataCtl.doAction(ServerActionId.SWEET_ZH,[i.id])}},e.prototype.onItemUpdate=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.updateItem()}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SWEET_ZG)},e}(UIBase);__reflect(SweetHouseZGView.prototype,"SweetHouseZGView");var SweethouseZhItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=GmGlobal.mc.itemMgr;this.q1.source=t.getItemIconK(this.data.need[0].id),this.icon1.source=t.getItemIcon(this.data.need[0].id),this.q2.source=t.getItemIconK(this.data.need[1].id),this.icon2.source=t.getItemIcon(this.data.need[1].id),this.q3.source=t.getItemIconK(this.data.to[0].id),this.icon3.source=t.getItemIcon(this.data.to[0].id),this.t1.text=this.data.need[0].num,this.t2.text=this.data.need[1].num,this.t3.text=this.data.to[0].num,this.updateItem()},e.prototype.updateItem=function(){var t=GmGlobal.mc.itemMgr,e=t.getItemNum(this.data.need[0].id),i=t.getItemNum(this.data.need[1].id),s=0;TextFormat.setMoneyStr(this.t1,e,this.data.need[0].num,!1),e<this.data.need[0].num||s++,i<this.data.need[1].num?this.t2.textColor=15560559:(s++,this.t2.textColor=16777215),2==s?Utils.setBtnEnable(this.dhBtn,!0):Utils.setBtnEnable(this.dhBtn,!1)},e}(eui.ItemRenderer);__reflect(SweethouseZhItem.prototype,"SweethouseZhItem");var QuickTaskView=function(t){function e(){return t.call(this,"QuickTaskSkin")||this}return __extends(e,t),e.prototype.updatePos=function(){GmConst.IS_FULLSCENE?this.y=GmGlobal.stageHeight-390-this.height-GmConst.BOTTOM_SPACE:this.y=GmGlobal.stageHeight-390-this.height;var t=GmGlobal.vmc.scene.currenScene;this.x=Math.min(t.x+t.blockMap.width-this.width-2,GmGlobal.stageWidth-this.width-2)},e.prototype.addEvts=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAward,this),EventBus.addListener(EventType.RESIZE,this.updatePos,this),EventBus.addListener(EventType.ENTER_SCENE,this.updatePos,this),EventBus.addListener(EventType.M_TASK_LOOP,this.updateTask,this)},e.prototype.rmEvts=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAward,this),EventBus.rmListener(EventType.RESIZE,this.updatePos,this),EventBus.rmListener(EventType.ENTER_SCENE,this.updatePos,this),EventBus.rmListener(EventType.M_TASK_LOOP,this.updateTask,this)},e.prototype.updateTask=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!1),this.checkLoopTask(e)?!0:(t&&CmdBus.doCmd(CmdType.C_QUICK_TASK),!1)},e.prototype.checkDayTask=function(){var t=GmGlobal.mc.taskMgr,e=t.getDayTCfg(),i=t.dayInfo;for(var s in e){var o=e[s],n=i[o.id];if((!n||2!=n.state)&&6!=o.id&&9!=o.id&&10!=o.id&&12!=o.id&&15!=o.id){this.tpName.text="Daily Quest";var r=1,h=0,a=0;n&&(r=n.sub||1,h=n.num||0,a=n.state||0),r>=o.lst.length&&(r=o.lst.length);var l=o.lst[r-1];this.tName.text=o.describe.replace("%x",Utils.formatNum(l.nums.X))+"("+h+"/"+l.nums.X+")",this.tName.textColor=h>=l.nums.X?Colors.GREEN:Colors.WHILE;for(var c=TextFormat.setColor("Reward：",4377794),d=0,p=l.items;d<p.length;d++){var u=p[d],m=GmGlobal.mc.itemMgr.getItemCfg(u.id);
c+=TextFormat.setColor(m.name,Utils.getQualityColor(m.quality))+"*"+u.num+" "}return this.tAw.textFlow=TextFormat.parser.parse(c),this.tAw.y=this.tName.y+this.tName.textHeight+10,this.height=this.tAw.y+this.tAw.textHeight+10,this._taskType=1,this._taskId=o.id,this._taskState=a,!0}}return!1},e.prototype.checkLoopTask=function(t){void 0===t&&(t=!1);var e=GmGlobal.mc,i=e.dataMgr.getJData(JsonID.TASK_LOOP_D).data;if(!t&&this.getLoopTaskAw(i))return!0;for(var s in i){var o=Number(s),n=i[s],r=e.taskMgr.loopInfo[o],h=1,a=0,l=0;if(!r||(h=r.sub,a=r.num,l=r.state,2!=l)){this.tpName.text="Circle Quest";var c=e.taskMgr.getLoopTask(n.aid);h>=c.lst.length&&(h=c.lst.length);var d=c.lst[h-1],p=c.describe.replace("%x",Utils.formatNum(n.num)),u=GmGlobal.mc.npcMgr.getNpcCfg(n.id);u&&(p+=u.name),p+="("+a+"/"+n.num+")",this.tName.text=p,this.tName.textColor=a>=n.num?Colors.GREEN:Colors.WHILE;for(var m=TextFormat.setColor("Reward：",4377794),_=0,g=d.items;_<g.length;_++){var f=g[_],v=GmGlobal.mc.itemMgr.getItemCfg(f.id);m+=TextFormat.setColor(v.name,Utils.getQualityColor(v.quality))+"*"+f.num+" "}return n.exp&&(m+="Exp*"+n.exp),this.tAw.textFlow=TextFormat.parser.parse(m),this.tAw.y=this.tName.y+this.tName.textHeight+10,this.height=this.tAw.y+this.tAw.textHeight+10,this._taskType=2,this._taskId=o,this._taskState=l,this._mstId=n.id,1==l&&GmGlobal.cc.dataCtl.doAction(ServerActionId.LOOP_TASK,[this._taskId],this.loopAwOk,this),!0}}return!1},e.prototype.getLoopTaskAw=function(t){var e=GmGlobal.mc;for(var i in t){var s=Number(i),o=(t[i],e.taskMgr.loopInfo[s]),n=1,r=0,h=0;if(o&&(n=o.sub,r=o.num,h=o.state,1==h))return GmGlobal.cc.dataCtl.doAction(ServerActionId.LOOP_TASK,[s],this.loopAwOk,this),!0}return!1},e.prototype.loopAwOk=function(){this.onAward(null)},e.prototype.onAward=function(t){if(1==this._taskState)1==this._taskType?GmGlobal.cc.dataCtl.doAction(ServerActionId.DAY_TASK,[this._taskId]):2==this._taskType&&GmGlobal.cc.dataCtl.doAction(ServerActionId.LOOP_TASK,[this._taskId]);else if(1==this._taskType){var e=GmGlobal.mc.taskMgr.getGotoCmd(1,this._taskId);if(e){if(e.m&&!GmGlobal.mc.guideMgr.isModeuleOpen(e.m,!0))return;CmdBus.doCmd(CmdType.C_TASK),e.npc?TaskGo.getInstance().start(e.npc,e.a):(e.cmd==CmdType.O_FULI&&PFConst.IS_NOPAY&&(e.a=1),CmdBus.doCmd(e.cmd,e.a))}}else if(2==this._taskType&&this._mstId){var i=GmGlobal.mc.npcMgr.getNpcCfg(this._mstId),s=GmGlobal.mc.sceneMgr;s.mapId!=i.mapid?(s.lockType=this._mstId,s.fx=i.x,s.fy=i.y,GmGlobal.cc.sceneCtl.reqWildScne(i.mapid)):GmGlobal.vmc.scene.currenScene.lockUnitType(this._mstId,i.x,i.y),CmdBus.doCmd(CmdType.C_TASK)}},e}(UIBase);__reflect(QuickTaskView.prototype,"QuickTaskView");var TaskController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.TASK_DAY,this.onDayUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_DAY_ONE,this.onDayOneUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_GROW,this.onGrowUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_GROW_ONE,this.onGrowOneUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_BOX,this.onBoxUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_LOOP,this.onLoopUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_LOOP_ONE,this.onLoopOneUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_WEEK,this.onWeekUpdate,this),EventBus.addListener(EventType.M_UPD_CON,this.updateBoxRedDot,this),EventBus.addListener(EventType.MONSTER_DEAD,this.onMonsterDead,this)}return t.prototype.onDayUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.dayInfo=e||{},this.updateDayRedDot(),EventBus.dispatchEvt(EventType.M_TASK_DAY)},t.prototype.onDayOneUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.dayInfo[e.id]=e,this.updateDayRedDot(),EventBus.dispatchEvt(EventType.M_TASK_DAY)},t.prototype.onGrowUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.growInfo=e||{},this.updateGrowRedDot(),EventBus.dispatchEvt(EventType.M_TASK_GROW)},t.prototype.onGrowOneUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.growInfo[e.id]=e,this.updateGrowRedDot(),EventBus.dispatchEvt(EventType.M_TASK_GROW)},t.prototype.onBoxUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.box=e.box||{},this.updateBoxRedDot(),EventBus.dispatchEvt(EventType.M_TASK_HYD)},t.prototype.onLoopUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.loopInfo=e||{},this.updateLoopRedDot(),EventBus.dispatchEvt(EventType.M_TASK_LOOP)},t.prototype.onLoopOneUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.loopInfo[e.id]=e,this.updateLoopRedDot(),EventBus.dispatchEvt(EventType.M_TASK_LOOP)},t.prototype.onWeekUpdate=function(t){var e=t.data.data,i=GmGlobal.mc.taskMgr;i.updateWeekTask(e.task),this.updateWeekRedDot(),EventBus.dispatchEvt(EventType.M_TASK_WEEK)},t.prototype.onMonsterDead=function(t){var e=t.data,i=GmGlobal.mc,s=i.dataMgr.getJData(JsonID.TASK_LOOP_D).data;for(var o in s){var n=s[o];if(n.id==e){var r=i.taskMgr.loopInfo[o];r||(r={state:0,num:0,sub:1},i.taskMgr.loopInfo[o]=r),n.num>r.num&&(r.num++,this.updateLoopRedDot(),EventBus.dispatchEvt(EventType.M_TASK_LOOP))}}},t.prototype.updateDayRedDot=function(){var t=GmGlobal.mc.taskMgr.redDot.childs[0];if(t){var e=GmGlobal.mc.taskMgr.dayInfo,i=0;for(var s in e){var o=e[s];if(1==o.state){i=1;break}}t.state=i}},t.prototype.updateGrowRedDot=function(){var t=GmGlobal.mc.taskMgr.redDot.childs[1];if(t){var e=GmGlobal.mc.taskMgr.growInfo,i=0;for(var s in e){var o=e[s];if(1==o.state){i=1;break}}t.state=i}},t.prototype.updateLoopRedDot=function(){var t=GmGlobal.mc.taskMgr.redDot.childs[3];if(t){var e=GmGlobal.mc.taskMgr.loopInfo,i=0;for(var s in e){var o=e[s];if(1==o.state){i=1;break}}t.state=i}},t.prototype.updateBoxRedDot=function(){var t=GmGlobal.mc.taskMgr,e=t.redDot.childs[2];if(e)for(var i=GmGlobal.mc.itemMgr.getItemNum(ItemID.HUOYUEDU),s=0;s<t.hydCfgs.length;s++){var o=t.hydCfgs[s],n=o.num,r=t.box[o.num]||0,h=void 0;h=e.childs&&e.childs[s]?e.childs[s]:new RedDot(s.toString(),e),i>=n&&!r?h.state=1:h.state=0}},t.prototype.updateWeekRedDot=function(){var t=GmGlobal.mc.taskMgr.redDot.childs[4];if(t){var e=GmGlobal.mc.taskMgr.weekInfo,i=0;for(var s in e){var o=e[s];if(1==o.state){i=1;break}}t.state=i}},t}();__reflect(TaskController.prototype,"TaskController");var TaskDayItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tName.text=this.data.ms,this.data.hNum=Math.min(this.data.hNum,this.data.nNum),this.icon.source=GmConst.TASKICON_DIR+this.data.icon+".png";for(var t=0;2>t;t++){var e=this["icon"+t],i=this["num"+t];if(t<this.data.item.length){var s=this.data.item[t];i.text=Utils.formatNum(s.num),e.source=GmGlobal.mc.itemMgr.getItemSicon(s.id),e.visible=!0,i.visible=!0}else e.visible=!1,i.visible=!1}this.data.hNum>=this.data.nNum?this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.GREEN)):this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.RED)),0==this.data.state?(this.ywc.visible=!1,this.tJd.visible=!0,this.data.gotoCmd?(this.bLq.visible=!0,this.bLq.label="Go",this.bLq.skinName="ComBtnSkinB"):this.bLq.visible=!1):1==this.data.state?(this.ywc.visible=!1,this.tJd.visible=!0,this.bLq.visible=!0,this.bLq.label="Claim",this.bLq.skinName="ComBtnSkinY"):(this.bLq.visible=!1,this.tJd.visible=!1,this.ywc.visible=!0)},e}(eui.ItemRenderer);__reflect(TaskDayItem.prototype,"TaskDayItem");var TaskDayPage=function(t){function e(){return t.call(this,"TaskDaySkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.icon.source=GmGlobal.mc.itemMgr.getItemIcon(10034),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TaskDayItemSkin",this.itemList.itemRenderer=TaskDayItem;for(var e=GmGlobal.mc.taskMgr,i=e.hydCfgs,s=0;s<i.length;s++){var o=i[s],n=this["t"+(s+1)];n.text=o.num}},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){EventBus.addListener(EventType.M_TASK_DAY,this.updateList,this),EventBus.addListener(EventType.M_TASK_HYD,this.updateBox,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.box1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),this.box2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),this.box3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),this.box4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),GmGlobal.cc.itemCtl.bindItemCallback(ItemID.HUOYUEDU,this.updateBox,this)},e.prototype.rmEvts=function(){EventBus.rmListener(EventType.M_TASK_DAY,this.updateList,this),EventBus.rmListener(EventType.M_TASK_HYD,this.updateBox,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.box1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),this.box2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),this.box3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),this.box4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBox,this),GmGlobal.cc.itemCtl.removeItemCallback(ItemID.HUOYUEDU,this.updateBox,this)},e.prototype.updateBox=function(){var t=GmGlobal.mc.itemMgr.getItemNum(ItemID.HUOYUEDU),e=GmGlobal.mc.taskMgr;this.hyd.text=t+"/"+e.maxHy;for(var i=e.hydCfgs,s=0;s<i.length;s++){var o=i[s],n=this["box"+(s+1)],r=this["t"+(s+1)],h=e.box[o.num];egret.Tween.removeTweens(n),n.rotation=0,2==h?(n.filters=FilterUtils.disabled(),n.touchEnabled=!1,r.textColor=65280):t>=o.num?(this.touchEnabled=!0,Utils.iconSaggle(n,5,100),r.textColor=65280):(n.filters=[],n.touchEnabled=!0,r.textColor=16777215)}},e.prototype.updateList=function(){for(var t=GmGlobal.mc.taskMgr,e=t.shortDayTask(),i=0;i<e.length;i++){var s=e[i];if(15!=s.id||!PFConst.IS_NOPAY){var o={id:s.id,ms:"",icon:s.icon,item:null,state:0,hNum:0,nNum:0,gotoCmd:t.getGotoCmd(1,s.id)};o.ms=s.describe;var n=1,r=t.dayInfo[s.id];r&&(o.state=r.state||0,o.hNum=r.num||0,n=r.sub),n>=s.lst.length&&(n=s.lst.length);var h=s.lst[n-1];o.item=h.items,o.nNum=h.nums.X,o.ms=o.ms.replace("%x",Utils.formatNum(h.nums.X)),this._array.length>i?this._array.replaceItemAt(o,i):this._array.addItem(o)}}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;if(1==e.state)GmGlobal.cc.dataCtl.doAction(ServerActionId.DAY_TASK,[e.id]);else if(0==e.state&&e.gotoCmd){if(e.gotoCmd.m&&!GmGlobal.mc.guideMgr.isModeuleOpen(e.gotoCmd.m,!0))return;CmdBus.doCmd(CmdType.C_TASK),e.gotoCmd.npc?TaskGo.getInstance().start(e.gotoCmd.npc,e.gotoCmd.a):(e.gotoCmd.cmd==CmdType.O_FULI&&PFConst.IS_NOPAY&&(e.gotoCmd.a=1),CmdBus.doCmd(e.gotoCmd.cmd,e.gotoCmd.a))}}},e.prototype.onTouchBox=function(t){var e=this.getBoxIndex(t.target),i=GmGlobal.mc.taskMgr.hydCfgs[e],s=GmGlobal.mc.itemMgr.getItemNum(ItemID.HUOYUEDU);s>=i.num?GmGlobal.cc.dataCtl.doAction(ServerActionId.TASK_BOX,[i.num,0]):AwardPreviewTip.showAward(i.item)},e.prototype.getBoxIndex=function(t){return t==this.box1?0:t==this.box2?1:t==this.box3?2:t==this.box4?3:void 0},e.prototype.close=function(){for(var e=GmGlobal.mc.taskMgr.hydCfgs,i=0;i<e.length;i++){var s=(e[i],this["box"+(i+1)]);egret.Tween.removeTweens(s)}t.prototype.close.call(this)},e}(UIBase);__reflect(TaskDayPage.prototype,"TaskDayPage");var TaskGo=function(){function t(){}return t.getInstance=function(){return this._instence||(this._instence=new t),this._instence},t.prototype.start=function(t,e){this.npc=t,this.tIdx=e;var i=GmGlobal.mc.sceneMgr;if(i.mapType!=SceneType.CITY)EventBus.addListener(EventType.ENTER_SCENE,this.onEnterSC,this),GmGlobal.cc.sceneCtl.reqGoBackCity();else{var s=GmGlobal.vmc.scene.currenScene;s.openNpcFunc(t,e)}},t.prototype.onEnterSC=function(t){var e=GmGlobal.mc.sceneMgr;if(e.mapType==SceneType.CITY){EventBus.rmListener(EventType.ENTER_SCENE,this.onEnterSC,this);var i=this;setTimeout(function(){var t=GmGlobal.vmc.scene.currenScene;t.openNpcFunc(i.npc,i.tIdx)},100)}},t}();__reflect(TaskGo.prototype,"TaskGo");var TaskGroupItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tName.text=this.data.ms,18==this.data.id?this.data.hNum<=this.data.nNum?this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.GREEN)):this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.RED)):this.data.hNum>=this.data.nNum?this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.GREEN)):this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.RED)),0==this.data.state?(this.ywc.visible=!1,this.tJd.visible=!0,this.data.gotoCmd?(this.bLq.visible=!0,this.bLq.label="Go",this.bLq.skinName="ComBtnSkinB"):this.bLq.visible=!1):1==this.data.state?(this.ywc.visible=!1,this.tJd.visible=!0,this.bLq.visible=!0,this.bLq.label="Claim",this.bLq.skinName="ComBtnSkinY"):(this.bLq.visible=!1,this.tJd.visible=!1,this.ywc.visible=!0),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.item,90,!1,!0,!0),this._itemGridCon.addToParent(20,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(TaskGroupItem.prototype,"TaskGroupItem");var TaskGroupPage=function(t){function e(){return t.call(this,"TaskGroupSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TaskGroupItemSkin",this.itemList.itemRenderer=TaskGroupItem},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){EventBus.addListener(EventType.M_TASK_GROW,this.updateList,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){EventBus.rmListener(EventType.M_TASK_GROW,this.updateList,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;1==e.state?GmGlobal.cc.dataCtl.doAction(ServerActionId.GROW_TASK,[e.id]):0==e.state&&e.gotoCmd&&(CmdBus.doCmd(CmdType.C_TASK),CmdBus.doCmd(e.gotoCmd.cmd,e.gotoCmd.a))}},e.prototype.updateList=function(){for(var t=GmGlobal.mc.taskMgr,e=t.sortGroupTask(),i=0;i<e.length;i++){var s=e[i],o={id:s.id,ms:"",item:null,state:0,hNum:0,nNum:0,gotoCmd:t.getGotoCmd(2,s.id)};o.ms=s.describe;var n=1,r=t.growInfo[s.id];r&&(o.state=r.state||0,o.hNum=r.num||0,n=r.sub||1),n>=s.lst.length&&(n=s.lst.length);var h=s.lst[n-1];o.item=h.items,o.nNum=h.nums.X,o.ms=o.ms.replace("%x",Utils.formatNum(h.nums.X)),this._array.length>i?this._array.replaceItemAt(o,i):this._array.addItem(o)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearItems()},e}(UIBase);__reflect(TaskGroupPage.prototype,"TaskGroupPage");var TaskLoopItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tName.text=this.data.ms,this.data.hNum>=this.data.nNum?this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.GREEN)):this.tJd.textFlow=TextFormat.parser.parse(TextFormat.setColor(Utils.formatNum(this.data.hNum)+"/"+Utils.formatNum(this.data.nNum),Colors.RED)),0==this.data.state?(this.ywc.visible=!1,this.tJd.visible=!0,this.bLq.visible=!0,this.bLq.label="Go",this.bLq.skinName="ComBtnSkinB"):1==this.data.state?(this.ywc.visible=!1,this.tJd.visible=!0,this.bLq.visible=!0,this.bLq.label="Claim",this.bLq.skinName="ComBtnSkinY"):(this.bLq.visible=!1,this.tJd.visible=!1,this.ywc.visible=!0),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.item,90,!1,!0,!0),this._itemGridCon.addToParent(20,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(TaskLoopItem.prototype,"TaskLoopItem");var TaskLoopPage=function(t){function e(){return t.call(this,"TaskGroupSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TaskGroupItemSkin",this.itemList.itemRenderer=TaskLoopItem},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){EventBus.addListener(EventType.M_TASK_LOOP,this.updateList,this),EventBus.addListener(EventType.M_JUPD+JsonID.TASK_LOOP_D,this.updateList,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){EventBus.rmListener(EventType.M_TASK_LOOP,this.updateList,this),EventBus.rmListener(EventType.M_JUPD+JsonID.TASK_LOOP_D,this.updateList,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;if(1==e.state)GmGlobal.cc.dataCtl.doAction(ServerActionId.LOOP_TASK,[e.id]);else if(0==e.state&&e.mid){var i=GmGlobal.mc.npcMgr.getNpcCfg(e.mid),s=GmGlobal.mc.sceneMgr;s.mapId!=i.mapid?(s.lockType=e.mid,s.fx=i.x,s.fy=i.y,GmGlobal.cc.sceneCtl.reqWildScne(i.mapid)):GmGlobal.vmc.scene.currenScene.lockUnitType(e.mid,i.x,i.y),CmdBus.doCmd(CmdType.C_TASK)}}},e.prototype.updateList=function(){for(var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.TASK_LOOP_D).data,i=t.taskMgr.shortLoopTask(e),s=0;s<i.length;s++){var o=i[s],n={id:o.tid,ms:"",item:null,state:0,hNum:0,nNum:0,mid:0},r=1,h=t.taskMgr.loopInfo[o.tid];h&&(n.state=h.state||0,n.hNum=h.num||0,r=h.sub||1);var a=t.taskMgr.getLoopTask(o.aid);r>=a.lst.length&&(r=a.lst.length);var l=a.lst[r-1];n.item=l.items.concat({id:10004,num:o.exp}),n.mid=o.id,n.nNum=o.num;var c=a.describe.replace("%x",Utils.formatNum(o.num)),d=t.npcMgr.getNpcCfg(o.id);d&&(c+=d.name),n.ms=c,this._array.length>s?this._array.replaceItemAt(n,s):this._array.addItem(n)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearItems()},e}(UIBase);__reflect(TaskLoopPage.prototype,"TaskLoopPage");var TaskManager=function(){function t(){this.hydCfgs={},this.growInfo={},this.dayInfo={},this.box={},this.loopInfo={},this.weekInfo={},GmGlobal.mc.regUnzipCfg("c_task.json",this.initCfg,this);var t={0:0,1:0,2:0,3:0,4:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.TASK,this.redDot),this._gotoCmds={1:{1:{cmd:CmdType.O_CHAT},2:{npc:6701,a:0,m:ModelID.EQUIP},3:{npc:6701,a:2,m:ModelID.EQUIP},4:{npc:6701,a:1,m:ModelID.EQUIP},5:{cmd:CmdType.O_BAG},7:{cmd:CmdType.O_FULI,a:3,m:ModelID.FULI},8:{cmd:CmdType.O_MVP,m:ModelID.MVP},10:{npc:6705,a:1,m:ModelID.GONGHUI},11:{cmd:CmdType.O_WANFA,a:2,m:ModelID.WANFA},12:{cmd:CmdType.O_WANFA,a:3,m:ModelID.WANFA},13:{cmd:CmdType.O_WANFA,a:0,m:ModelID.WANFA},14:{cmd:CmdType.O_WANFA,a:1,m:ModelID.WANFA},15:{cmd:CmdType.O_SHOP,m:ModelID.SHOP}},2:{},3:{1:{cmd:CmdType.O_MAPSEL},4:{cmd:CmdType.O_MVP},5:{cmd:CmdType.O_WANFA,m:ModelID.WANFA,a:5},6:{cmd:CmdType.O_WANFA,m:ModelID.WANFA,a:10},7:{cmd:CmdType.O_WANFA,m:ModelID.WANFA,a:3},8:{cmd:CmdType.O_WANFA,m:ModelID.WANFA,a:4},14:{cmd:CmdType.O_SHOP,m:ModelID.SHOP},15:{cmd:CmdType.O_WANFA,m:ModelID.WANFA,a:0},16:{cmd:CmdType.O_WANFA,m:ModelID.WANFA,a:7}}}}return t.prototype.initCfg=function(t){this._dayT=t.dayT,this._groupT=t.growT,this._loopT=t.circleT,this._loopExp=t.circleExp,this.hydCfgs=t.totalActive,this._weekT=t.weekT,this.maxHy=this.getMaxHy()},t.prototype.getDayTCfg=function(){return this._dayT},t.prototype.getLoopTCfg=function(){return this._loopT},t.prototype.getGotoCmd=function(t,e){var i=this._gotoCmds[t];return i?i[e]:null},t.prototype.getMaxHy=function(){var t=0;for(var e in this._dayT)for(var i=this._dayT[e],s=0,o=i.lst;s<o.length;s++)for(var n=o[s],r=0,h=n.items;r<h.length;r++){var a=h[r];a.id==ItemID.HUOYUEDU&&(t+=a.num)}return t},t.prototype.sortGroupTask=function(){var t=[],e=[],i=[];for(var s in this._groupT){var o=this._groupT[s],n=this.growInfo[o.id];n&&1==n.state?t.push(o):n&&2==n.state?e.push(o):i.push(o)}return t.concat(i,e)},t.prototype.shortDayTask=function(){var t=[],e=[],i=[];for(var s in this._dayT){var o=this._dayT[s],n=this.dayInfo[o.id];if(6==o.id){var r=Math.floor(GmGlobal.mc.onlineMgr.onlineTime.time/60),h=Math.min(n?n.sub:1,o.lst.length),a=o.lst[h-1];if(r>=a.nums.X){var l=n&&2==n.state?2:1;if(1==l){var c=this.redDot.childs[0];c&&(c.state=1)}n={num:r,state:l,sub:h}}else n={num:r,state:0,sub:h};this.dayInfo[o.id]=n}n&&1==n.state?t.push(o):n&&2==n.state?e.push(o):i.push(o)}return t.concat(i,e)},t.prototype.shortLoopTask=function(t){var e=[],i=[],s=[];for(var o in t){var n=t[o];n.tid=Number(o);var r=this.loopInfo[o];r&&1==r.state?e.push(n):r&&2==r.state?i.push(n):s.push(n)}return e.concat(s,i)},t.prototype.getLoopTask=function(t){return this._loopT[t]},t.prototype.updateWeekTask=function(t){this.weekInfo={};for(var e in t){var i=t[e],s={tid:Number(e),num:0,sub:i.sub,state:i.s||0},o=this._weekT[e];if(o){var n=s.sub||1;n>=o.lst.length&&(n=o.lst.length),s.sub=n;var r=o.lst[n-1];s.num=i.num,s.num>=r.nums.X&&2!=s.state&&(s.state=1),this.weekInfo[e]=s}}},t.prototype.shortWeekTask=function(t){var e=[],i=[],s=[];for(var o in t){var n=t[o],r=this._weekT[o];if(2==n.tid){var h=Math.floor(GmGlobal.mc.onlineMgr.weekTime.time/60),a=Math.min(n?n.sub:1,r.lst.length),l=r.lst[a-1];if(h>=l.nums.X){var c=n&&2==n.state?2:1;if(1==c){var d=this.redDot.childs[4];d&&(d.state=1)}n={tid:n.tid,num:h,state:c,sub:a}}else n={tid:n.tid,num:h,state:0,sub:a};this.weekInfo[n.tid]=n}n&&1==n.state?e.push(n):n&&2==n.state?i.push(n):s.push(n)}return e.concat(s,i)},t.prototype.getWeekTask=function(t){return this._weekT[t]},t}();__reflect(TaskManager.prototype,"TaskManager");var TaskMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.TASK,CmdType.O_TASK),CmdBus.adListener(CmdType.O_TASK,this.onOpenView,this),CmdBus.adListener(CmdType.C_TASK,this.onCloseView,this)}return t.prototype.onOpenView=function(t){this._showIndex=t||0,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new TaskView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),this._view.selTab(this._showIndex),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(TaskMediator.prototype,"TaskMediator",["IMediator"]);var TaskView=function(t){function e(){var e=t.call(this,"TaskViewSkin")||this;return e._tabIndex=-1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.updateTabRedDot(),this.bindRedDotCb()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;if(2==e&&GmGlobal.mc.role.lv<50)return void MsgBox.prompt("Unlocks at LV.50");this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;4>t;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){this._growPage&&this._growPage.close(),this._dayPage&&this._dayPage.close(),this._loopPage&&this._loopPage.close(),0==this._tabIndex?this.showDayPage():1==this._tabIndex?this.showGrowPage():2==this._tabIndex?this.showLoopPage():3==this._tabIndex&&this.showWeekPage()},e.prototype.showDayPage=function(){this._dayPage||(this._dayPage=new TaskDayPage),this._dayPage.show(this),this._dayPage.updateList(),this._dayPage.updateBox(),GmGlobal.cc.dataCtl.doAction(ServerActionId.REQ_DTASK)},e.prototype.showGrowPage=function(){this._growPage||(this._growPage=new TaskGroupPage),this._growPage.show(this),this._growPage.updateList(),GmGlobal.cc.dataCtl.doAction(ServerActionId.REQ_GTASK)},e.prototype.showLoopPage=function(){this._loopPage||(this._loopPage=new TaskLoopPage),this._loopPage.show(this),this._loopPage.updateList()},e.prototype.showWeekPage=function(){this._weekPage||(this._weekPage=new TaskWeekPage),this._weekPage.show(this),this._weekPage.updateList()},e.prototype.updateTabRedDot=function(){var t=GmGlobal.mc.taskMgr.redDot,e=t.childs[0],i=t.childs[2],s=this.tableBgCon.getChildAt(0);if(1==e.state||1==i.state){var o=90;RedDotView.addRedDot(s,this.tableBgCon,"task",o,-4)}else RedDotView.removeRedDot(s);var n=t.childs[1],r=this.tableBgCon.getChildAt(1);if(1==n.state){var o=210;RedDotView.addRedDot(r,this.tableBgCon,"task",o,-4)}else RedDotView.removeRedDot(r);var h=t.childs[3],a=this.tableBgCon.getChildAt(2);if(1==h.state){var o=330;o+=40,RedDotView.addRedDot(a,this.tableBgCon,"task",o,-4)}else RedDotView.removeRedDot(a)},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.taskMgr.redDot,e=0;4>e;e++){var i=t.childs[e];i.bindChangeCB(this.updateTabRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.taskMgr.redDot,e=0;4>e;e++){var i=t.childs[e];i.unbindChangeCB(this.updateTabRedDot,this)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TASK)},e.prototype.close=function(){RedDotView.removeRedDotByGroup("task"),this.unbindRedDotCb(),this._tabIndex=-1,this._growPage&&(this._growPage.close(),this._growPage=null),this._dayPage&&(this._dayPage.close(),this._dayPage=null),this._loopPage&&(this._loopPage.close(),this._loopPage=null),t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("task_json")},e}(UIBase);__reflect(TaskView.prototype,"TaskView");var TaskWeekPage=function(t){function e(){return t.call(this,"TaskWeekSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TaskGroupItemSkin",this.itemList.itemRenderer=TaskGroupItem},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_TASK_WEEK,this.updateList,this)},e.prototype.rmEvts=function(){this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_TASK_WEEK,this.updateList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=Utils.getCDByWeek(1,GmGlobal.getServerLocalTime());CDText.getInstence().addCD(this.tTime,i,"Reset Countdown: ","DD h:m:s")},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;1==e.state?GmGlobal.cc.dataCtl.doAction(ServerActionId.TASK_WEEK_AW,[e.id]):0==e.state&&e.gotoCmd&&(CmdBus.doCmd(CmdType.C_TASK),CmdBus.doCmd(e.gotoCmd.cmd,e.gotoCmd.a))}},e.prototype.updateList=function(){for(var t=GmGlobal.mc.taskMgr,e=t.shortWeekTask(t.weekInfo),i=0;i<e.length;i++){var s=e[i],o=t.getWeekTask(s.tid),n={id:s.tid,ms:"",item:null,state:0,hNum:0,nNum:0,gotoCmd:t.getGotoCmd(3,o.id)};n.ms=o.describe;var r=1;s&&(n.state=s.state||0,n.hNum=s.num||0,r=s.sub||1),r>=o.lst.length&&(r=o.lst.length);var h=o.lst[r-1];n.item=h.items,n.nNum=h.nums.X,n.ms=n.ms.replace("X",Utils.formatNum(h.nums.X)),this._array.length>i?this._array.replaceItemAt(n,i):this._array.addItem(n)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearItems()},e}(UIBase);__reflect(TaskWeekPage.prototype,"TaskWeekPage");var TextConst=function(){function t(){}return t.FREQUENT_OPERATION="Too frequent, Try again later",t.AWAIT_SERVER="Communicating...",t}();__reflect(TextConst.prototype,"TextConst");var TextManager=function(){function t(){GmGlobal.mc.regUnzipCfg("retcode.json",this.initRetCode,this)}return t.prototype.initRetCode=function(t){this._retCodes=t},t.prototype.getRetCode=function(t,e){if(void 0===e&&(e=null),!this._retCodes.hasOwnProperty(t))return null;var i=this._retCodes[t];if(!i)return null;if(e)for(var s=0;s<e.length;s++)i=i.replace("%s",e[s]);return i=Utils.replaceColorCode(i)},t.prototype.showRetCode=function(t){var e=this._retCodes[t];e&&(52!=t&&111!=t||""==PFConst.CONTACTUS?MsgBox.prompt(e):(e+="\nAccount:"+GmGlobal.mc.loginMgr.account+"\n"+PFConst.CONTACTUS,MsgBox.prompt(e,5e3)))},t.prototype.getCostName=function(t){var e=this._retCodes[t];return e||String(t)},t}();__reflect(TextManager.prototype,"TextManager");var EquipTips=function(t){function e(){var e=t.call(this)||this;return e._isTh=0,EventBus.addListener(EventType.M_EATRS_UPD,e.updOk,e),e}return __extends(e,t),e.prototype.addEvts=function(){this.bZs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this),this.bth.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTh,this)},e.prototype.rmEvts=function(){this.bZs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this),this.bth.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTh,this)},e.show=function(t,i,s,o,n,r,h,a){if(void 0===o&&(o=0),void 0===n&&(n=null),void 0===r&&(r=GmGlobal.mc.role.roleId),void 0===h&&(h=0),void 0===a&&(a=0),e._instance||(e._instance=new e),e._instance._uid=t,e._instance._openModel=o,e._instance._heroId=r,e._instance._grid=h,e._instance._p=n,e._instance._posx=i,e._instance._posy=s,e._instance._isTh=a,-1==o&&(e._instance._isTh=2),o==ModelID.EQUIP){var l=GmGlobal.mc.equipMgr.getEqpByUid(t);
e._instance.updateEqpTips(l,o,r,h,a),e._instance.showTips(n||GmGlobal.vmc.uiLayer2,i,s)}else GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_REQ_ATR,[r,t],e._instance.reqOk,e._instance)},e.prototype.updOk=function(t){var e=t.data;this._uid==e&&this.reqOk()},e.prototype.reqOk=function(){e._instance.updateTips(this._uid,this._openModel,this._heroId,this._grid,this._isTh)&&e._instance.showTips(this._p||GmGlobal.vmc.uiLayer2,this._posx,this._posy)},e.close=function(){e._instance&&e._instance.close()},e.prototype.showTips=function(e,i,s){t.prototype.showTips.call(this,e,i,s),this.checkGuide()},e.prototype.updateTips=function(t,i,s,o,n){if(void 0===s&&(s=GmGlobal.mc.role.roleId),void 0===n&&(n=0),e._instance.isShow)return!1;var r;if(s==GmGlobal.mc.role.roleId)r=GmGlobal.mc.equipMgr.getEItem(t);else if(r=GmGlobal.mc.equipMgr.otherEItem,!r||r.uid!=t||s!=r.owner)return!1;if(!r)return!1;this._itemId=r.id,this._uid=t,this._openModel=i,this._heroId=s,this._grid=o,this._isTh=n,this.bCs.label="Sell",i==ModelID.BAG||i==ModelID.EQUIP?this.bZs.visible=!0:this.bZs.visible=!1;var h=GmGlobal.mc.itemMgr.getItemCfg(this._itemId);if(!h)return!1;if(this.itemName.text=h.name,this.tMs.y=this.itemName.y+this.itemName.height+10,this.updateIcon(this._itemId),i!=ModelID.BAG)this.bSy.visible=!1,this.bCs.visible=!1,this.bHc.visible=!1,1==this._isTh?(this.bth.label="Replace",this.bth.visible=!0):2==this._isTh?(this.bth.label="Equip",this.bth.visible=!0):this.bth.visible=!1;else{this.bth.visible=!1,this.bSy.visible=!0,this.bHc.visible=!1,this.bSy.label="Reset";var a=GmGlobal.mc.equipMgr.getJlLv(this._uid);0==a&&(this.bSy.label="Disassemble"),this.bCs.visible=null==h.sell?!1:!0}this.bSy.visible&&this.bCs.visible?(this.bCs.x=120,this.bSy.x=300):this.bCs.visible?this.bCs.x=Math.floor(this.width/2):this.bSy.visible&&(this.bSy.x=Math.floor(this.width/2)),this.eqpCon.visible=!0;var l=GmGlobal.mc.equipMgr.getEqpCfg(this._itemId),c=GmConst.EQP_NAME[l.eid-1];9==l.eid&&(c+="(R)"),this.tMs.textFlow=TextFormat.parser.parser("Gear Type: "+TextFormat.setColor(c,6854856));var d="";if(l.career){for(var p in l.career){var u=GmGlobal.mc.heroMgr.getHeroCfg(l.career[p]),m=GmGlobal.mc.heroMgr.getCareerCfg(u.career);-1==d.indexOf(m.name)&&(d+=" "+m.name)}this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor(d,6854856))}else this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor("Any Job",6854856));this.tAtr.y=this.tMs.y+this.tMs.height+10;var _=l.natrs,g="",f=0;for(var p in _){var v=GmGlobal.mc.heroMgr.getAtrName(p);g+="\n                "+v+" "+_[p],f++}var y=GmGlobal.mc.equipMgr.getQlvStr(l.qlv);this.tCd.textFlow=TextFormat.parser.parser("Requirements:"+TextFormat.setColor(g,6854856)+"\nGear Rarity:"+TextFormat.setColor(y,6854856)),this.tDes.text="Item Description:"+h.des,this.tDes.y=this.tCd.height+15;var C=this.tDes.y+this.tDes.height+15,T=r;if(T){if(T.battr&&!Utils.isEmptyObj(T.battr)){this.line0.visible=!0,this.tAtr0.visible=!0,this.line0.y=C,C+=15,this.tAtr0.y=C;var b="",I=0;for(var p in T.battr){var E=GmGlobal.mc.heroMgr.getAtrName(p),G=GmGlobal.mc.heroMgr.isAddJia(p),w=GmGlobal.mc.heroMgr.isNdPre(p);b+=G?"\n                "+E+"+"+T.battr[p]:"\n                "+E+T.battr[p],w&&(b+="%"),I++}this.tAtr0.textFlow=TextFormat.parser.parser("Basic Stats:"+TextFormat.setColor(b,6854856)),C+=this.tAtr0.height+15}else{this.tDes.y+this.tDes.height+15;this.line0.visible=!1,this.tAtr0.visible=!1}if(T.qattr&&!Utils.isEmptyObj(T.qattr)){this.line1.visible=!0,this.tAtr1.visible=!0,this.line1.y=C,C+=15,this.tAtr1.y=C;var b="",S=0,L="";T.qattr.ele&&(L=TextFormat.setColor(Utils.getWx(T.qattr.ele),16145485));for(var p in T.qattr){var M=GmGlobal.mc.heroMgr.getAtrName(p),G=GmGlobal.mc.heroMgr.isAddJia(p),w=GmGlobal.mc.heroMgr.isNdPre(p);"ele"!=p&&(b+=G?"\n                "+M+"+"+T.qattr[p]:"\n                "+M+T.qattr[p],w&&(b+="%"),S++)}this.tAtr1.textFlow=TextFormat.parser.parser("Rarity Stats:"+L+TextFormat.setColor(b,6854856)),C+=this.tAtr1.height+15}else this.line1.visible=!1,this.tAtr1.visible=!1;if(l.tz){this.line6.visible=!0,this.tAtr6.visible=!0,this.tTz.visible=!0,this.line6.y=C,C+=15,this.tAtr6.y=C,this.tAtr6.text="Set Stats：(Stacked)",C+=this.tAtr6.height+10;var A="",D=GmGlobal.mc.equipMgr.getTzCfg(l.tz),x=this.getTaozhuangAddStr(l.tz,D);A+=x,this.tTz.y=C,this.tTz.textFlow=TextFormat.parser.parser(A),C+=this.tTz.height+15}else this.line6.visible=!1,this.tAtr6.visible=!1,this.tTz.visible=!1;if(T.jl){this.line3.visible=!0,this.tAtr3.visible=!0,this.line3.y=C,C+=15,this.tAtr3.y=C;var b="",B=GmGlobal.mc.equipMgr.getUpCfg(l.eid-1),U=B.jlCfg[r.jl-1],P=U.atrs[h.quality-1],O=0;for(var p in P){var R=(P[p],GmGlobal.mc.heroMgr.getAtrName(p)),G=GmGlobal.mc.heroMgr.isAddJia(p);b+=G?"\n                "+R+"+"+P[p]+"%":"\n                "+R+P[p]+"%",O++}this.tAtr3.textFlow=TextFormat.parser.parser("Refine Stats:"+TextFormat.setColor(b,6854856)),C+=this.tAtr3.height+15}else this.line3.visible=!1,this.tAtr3.visible=!1;if(this.line2.visible=!1,this.tAtr2.visible=!1,this.line4.visible=!1,this.tAtr4.visible=!1,T.cardlst&&!Utils.isEmptyObj(T.cardlst)){this.line5.visible=!0,this.tAtr5.visible=!0,this.line5.y=C,C+=15,this.tAtr5.y=C;var b="",k=0;for(var p in T.cardlst){var H=T.cardlst[p],N=GmGlobal.mc.equipMgr.getCardCfg(H);b+="\n                "+N.txt,k++}this.tAtr5.textFlow=TextFormat.parser.parser("Card Stats:"+TextFormat.setColor(b,6854856)),C+=this.tAtr5.height+15}else this.line5.visible=!1,this.tAtr5.visible=!1}else for(var V=0;6>V;V++)this["line"+V].visible=!1,this["tAtr"+V].visible=!1;if(h.sell){this.tJg.visible=!0;for(var F="",j=0;j<h.sell.length;j++){var J=h.sell[j].id,q=GmGlobal.mc.itemMgr.getItemCfg(J);F+=" "+q.name+"*"+h.sell[j].num}this.tJg.textFlow=TextFormat.parser.parser("Unit Price:"+TextFormat.setColor(F,6854856)),this.tJg.y=this.tAtr.y+this.tAtr.height+10,this.tJg.y+this.tJg.height>=140?this.eqpCon.y=this.tJg.y+this.tJg.height+10:this.eqpCon.y=140}else this.tJg.visible=!1,this.tAtr.y+this.tAtr.height>=140?this.eqpCon.y=this.tAtr.y+this.tAtr.height+10:this.eqpCon.y=140;return this.eqpCon.height=C,this.eqpCon.y+C>=610?this.height=700:this.height=this.eqpCon.y+C+90,this.resetTipsHeight(),this.scoll.viewport.scrollV=0,!0},e.prototype.getTaozhuangAddStr=function(t,e){var i="",s=e.attrInfo,o=0;this._openModel==ModelID.EQUIP&&(o=this.getTaozhuangNum(t));for(var n=0,r=s.length-1;r>=n;n++)for(var h=s[n],a=h.txt.split(";"),l=0,c=a.length-1;c>=l;l++){var d=void 0;d=o>=1&&o>=h.num?TextFormat.setColor(a[l],6854856):a[l],i+=0==l?d:"　　　"+d,(n!=r||l!=c)&&(i+="\n")}return i},e.prototype.getTaozhuangNum=function(t){for(var e=GmGlobal.mc.equipMgr,i=e.getTzList(t),s=e.getTzEquips(t),o=0,n=0,r=s;n<r.length;n++){var h=r[n];-1!=i.indexOf(h)&&o++}return o},e.prototype.updateEqpTips=function(t,e,i,s,o){void 0===i&&(i=GmGlobal.mc.role.roleId),void 0===o&&(o=0),this._itemId=t.itemId,this._uid=t.uid,this._openModel=e,this._heroId=i,this._grid=s,this._isTh=o,this.bCs.label="Sell",e==ModelID.BAG||e==ModelID.EQUIP?this.bZs.visible=!0:this.bZs.visible=!1;var n=GmGlobal.mc.itemMgr.getItemCfg(t.itemId);if(n){if(this.itemName.text=n.name,this.tMs.y=this.itemName.y+this.itemName.height+10,this.updateIcon(t.itemId),e!=ModelID.BAG)this.bSy.visible=!1,this.bCs.visible=!1,this.bHc.visible=!1,1==this._isTh?(this.bth.label="Replace",this.bth.visible=!0):2==this._isTh?(this.bth.label="Equip",this.bth.visible=!0):this.bth.visible=!1;else{this.bth.visible=!1,this.bSy.visible=!0,this.bHc.visible=!1,this.bSy.label="Reset";var r=GmGlobal.mc.equipMgr.getJlLv(this._uid);0==r&&(this.bSy.label="Disassemble"),this.bCs.visible=null==n.sell?!1:!0}this.bSy.visible&&this.bCs.visible?(this.bCs.x=120,this.bSy.x=300):this.bCs.visible?this.bCs.x=Math.floor(this.width/2):this.bSy.visible&&(this.bSy.x=Math.floor(this.width/2)),this.eqpCon.visible=!0;var h=GmGlobal.mc.equipMgr.getEqpCfg(t.itemId),a=GmConst.EQP_NAME[h.eid-1];9==h.eid&&(a+="(R)"),this.tMs.textFlow=TextFormat.parser.parser("Gear Type:"+TextFormat.setColor(a,6854856));var l="";if(h.career){for(var c in h.career){var d=GmGlobal.mc.heroMgr.getHeroCfg(h.career[c]),p=GmGlobal.mc.heroMgr.getCareerCfg(d.career);-1==l.indexOf(p.name)&&(l+=" "+p.name)}this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor(l,6854856))}else this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor("Any Job",6854856));this.tAtr.y=this.tMs.y+this.tMs.height+10;var u=h.natrs,m="",_=0;for(var c in u){var g=GmGlobal.mc.heroMgr.getAtrName(c),f=GmGlobal.mc.heroMgr.isAddJia(c);m+=f?"\n                "+g+" "+u[c]:"\n                "+g+u[c],_++}var v=GmGlobal.mc.equipMgr.getQlvStr(h.qlv);this.tCd.textFlow=TextFormat.parser.parser("Requirements:"+TextFormat.setColor(m,6854856)+"          \nGear Rarity:"+TextFormat.setColor(v,6854856)),this.tDes.text="Item Description:"+n.des,this.tDes.y=this.tCd.height+15;var y=this.tDes.y+this.tDes.height+15,C=GmGlobal.mc.equipMgr.getEItem(t.uid);if(C.battr&&!Utils.isEmptyObj(C.battr)){this.line0.visible=!0,this.tAtr0.visible=!0,this.line0.y=y,y+=15,this.tAtr0.y=y;var T="",b=0;for(var c in C.battr){var I=GmGlobal.mc.heroMgr.getAtrName(c),f=GmGlobal.mc.heroMgr.isAddJia(c);T+=f?"\n                "+I+"+"+C.battr[c]:"\n                "+I+C.battr[c],b++}this.tAtr0.textFlow=TextFormat.parser.parser("Basic Stats:"+TextFormat.setColor(T,6854856)),y+=this.tAtr0.height+15}else{this.tDes.y+this.tDes.height+15;this.line0.visible=!1,this.tAtr0.visible=!1}if(C.qattr&&!Utils.isEmptyObj(C.qattr)){this.line1.visible=!0,this.tAtr1.visible=!0,this.line1.y=y,y+=15,this.tAtr1.y=y;var T="",E=0,G="";C.qattr.ele&&(G=TextFormat.setColor(Utils.getWx(C.qattr.ele),16145485));for(var c in C.qattr){var w=GmGlobal.mc.heroMgr.getAtrName(c),f=GmGlobal.mc.heroMgr.isAddJia(c),S=GmGlobal.mc.heroMgr.isNdPre(c);"ele"!=c&&(T+=f?"\n                "+w+"+"+C.qattr[c]:"\n                "+w+C.qattr[c],S&&(T+="%"),E++)}this.tAtr1.textFlow=TextFormat.parser.parser("Rarity Stats:"+G+TextFormat.setColor(T,6854856)),y+=this.tAtr1.height+15}else this.line1.visible=!1,this.tAtr1.visible=!1;if(h.tz){this.line6.visible=!0,this.tAtr6.visible=!0,this.tTz.visible=!0,this.line6.y=y,y+=15,this.tAtr6.y=y,this.tAtr6.text="Set Stats：(Stacked)",y+=this.tAtr6.height+10;var L=GmGlobal.mc.equipMgr.getTzCfg(h.tz),M=this.getTaozhuangAddStr(h.tz,L);this.tTz.y=y,this.tTz.textFlow=TextFormat.parser.parser(M),y+=this.tTz.height+15}else this.line6.visible=!1,this.tAtr6.visible=!1,this.tTz.visible=!1;var A=GmGlobal.mc.equipMgr.getUpCfg(t.grid);if(t.qhLv){this.line2.visible=!0,this.tAtr2.visible=!0,this.line2.y=y,y+=15,this.tAtr2.y=y;var T="",D=A.qhCfg[t.qhLv-1],x=0;for(var c in D.atrs){var B=GmGlobal.mc.heroMgr.getAtrName(c),f=GmGlobal.mc.heroMgr.isAddJia(c);T+=f?"\n                "+B+"+"+D.atrs[c]:"\n                "+B+D.atrs[c],x++}this.tAtr2.textFlow=TextFormat.parser.parser("Enhance Stats:"+TextFormat.setColor(T,6854856)),y+=this.tAtr2.height+15}else this.line2.visible=!1,this.tAtr2.visible=!1;if(C.jl){this.line3.visible=!0,this.tAtr3.visible=!0,this.line3.y=y,y+=15,this.tAtr3.y=y;var T="",U=A.jlCfg[C.jl-1],P=U.atrs[n.quality-1],O=0;for(var c in P){var R=(P[c],GmGlobal.mc.heroMgr.getAtrName(c)),f=GmGlobal.mc.heroMgr.isAddJia(c);T+=f?"\n                "+R+"+"+P[c]+"%":"\n                "+R+P[c]+"%",O++}this.tAtr3.textFlow=TextFormat.parser.parser("Refine Stats:"+TextFormat.setColor(T,6854856)),y+=this.tAtr3.height+15}else this.line3.visible=!1,this.tAtr3.visible=!1;if(t.dzattrlst&&!Utils.isEmptyObj(t.dzattrlst)){this.line4.visible=!0,this.tAtr4.visible=!0,this.line4.y=y,y+=15,this.tAtr4.y=y;var T="",k=0;for(var c in t.dzattrlst){var H=t.dzattrlst[c];if(H&&!Utils.isEmptyObj(H)){var N=GmGlobal.mc.heroMgr.getAtrName(H.aid),f=GmGlobal.mc.heroMgr.isAddJia(H.aid),V=GmGlobal.mc.heroMgr.isNdPre(H.aid);T+=H.atype?f?"\n                LV."+H.lv+"    "+N+"+"+H.aval+"%":"\n                LV."+H.lv+"    "+N+H.aval+"%":f?"\n                LV."+H.lv+"    "+N+"+"+H.aval:"\n                LV."+H.lv+"    "+N+H.aval,V&&(T+="%")}k++}this.tAtr4.textFlow=TextFormat.parser.parser("Forge Stats:"+TextFormat.setColor(T,6854856)),y+=this.tAtr4.height+15}else this.line4.visible=!1,this.tAtr4.visible=!1;if(C.cardlst&&!Utils.isEmptyObj(C.cardlst)){this.line5.visible=!0,this.tAtr5.visible=!0,this.line5.y=y,y+=15,this.tAtr5.y=y;var T="",F=0;for(var c in C.cardlst){var j=C.cardlst[c],J=GmGlobal.mc.equipMgr.getCardCfg(j);J&&(T+="\n                "+J.txt,F++)}this.tAtr5.textFlow=TextFormat.parser.parser("Card Stats:"+TextFormat.setColor(T,6854856)),y+=this.tAtr5.height+15}else this.line5.visible=!1,this.tAtr5.visible=!1;if(n.sell){this.tJg.visible=!0;for(var q="",z=0;z<n.sell.length;z++){var W=n.sell[z].id,Y=GmGlobal.mc.itemMgr.getItemCfg(W);q+=" "+Y.name+"*"+n.sell[z].num}this.tJg.textFlow=TextFormat.parser.parser("Unit Price:"+TextFormat.setColor(q,6854856)),this.tJg.y=this.tAtr.y+this.tAtr.height+10,this.tJg.y+this.tJg.height>=140?this.eqpCon.y=this.tJg.y+this.tJg.height+10:this.eqpCon.y=140}else this.tJg.visible=!1,this.tAtr.y+this.tAtr.height>=140?this.eqpCon.y=this.tAtr.y+this.tAtr.height+10:this.eqpCon.y=140;this.eqpCon.height=y,this.eqpCon.y+y>=610?this.height=700:this.height=this.eqpCon.y+y+90,this.resetTipsHeight(),this.scoll.viewport.scrollV=0}},e.prototype.onZs=function(){var t=GmGlobal.mc,e={i:this._itemId,uid:this._uid,s:t.role.serverId,txk:t.setMgr.getSelTxk(),h:t.role.careerId};GmGlobal.cc.chatCtl.sengChatMsg(t.chatMgr.currenCh,this._itemId.toString(),e),this.close(),CmdBus.doCmd(CmdType.O_CHAT,GmGlobal.mc.chatMgr.currenCh)},e.prototype.onCs=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.ITEM_SELL,[this._uid,1]),this.close()},e.prototype.onTh=function(){1==this._isTh?CmdBus.doCmd(CmdType.O_HERO_EQP,0,GmGlobal.mc.equipMgr.clickIdx):2==this._isTh&&(GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP,[GmGlobal.mc.equipMgr.clickIdx+1,this._uid]),CmdBus.doCmd(CmdType.C_HERO_EQP));var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.EQUIPE_DRESS&&t.triggerTarget(this.bth),this.close()},e.prototype.onUse=function(){var t=GmGlobal.mc.equipMgr.getJlLv(this._uid);0==t?MsgBox.confirm2("Disassemble the equipment?",this.onFj,null,this):(MsgBox.confirm("Spend 200 crystals to Reset gear，All the Orichalcum and Silver of the current Refine LV will be refunded to you",this.useOk,null,this,null,null,this._uid),this.close())},e.prototype.onFj=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_FJ,[1,this._uid]),this.close()},e.prototype.useOk=function(t){GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_FJ,[2,t])},e.prototype.resetTipsHeight=function(){this.bg.height=this.height-80,this.scoll.height=this.bg.height,this.bHc.y=this.height-35,this.bSy.y=this.height-35,this.bCs.y=this.height-35,this.bth.y=this.height-35},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.EQUIPE_DRESS&&(t.bindTarget(GuideTargetId.REPLACE_RBTN,this.bth,this.bth.parent.localToGlobal(this.bth.x,this.bth.y)),t.setIdxToTop())},e.prototype.onClose=function(t){t.target!=this.bCs&&t.target!=this.bSy&&t.target!=this.bZs&&this.close()},e.prototype.close=function(){t.prototype.close.call(this),this._uid=0},e.prototype.destroy=function(){EventBus.rmListener(EventType.M_EATRS_UPD,this.updOk,this),t.prototype.destroy.call(this)},e}(TipsBase);__reflect(EquipTips.prototype,"EquipTips");var ItemTips=function(t){function e(){var e=t.call(this)||this;return e._isclose=!0,e._isTh=0,e}return __extends(e,t),e.prototype.addEvts=function(){this.bZs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this),this.bHc.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this),this.bth.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTh,this)},e.prototype.rmEvts=function(){this.bZs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this),this.bHc.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHc,this),this.bth.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTh,this)},e.show=function(t,i,s,o,n,r,h,a){void 0===o&&(o=0),void 0===n&&(n=null),void 0===r&&(r=0),void 0===h&&(h=0),void 0===a&&(a=0),e._instance||(e._instance=new e),e._instance.updateTips(t,o,r,h,a),e._instance.showTips(n||GmGlobal.vmc.uiLayer2,i,s)},e.close=function(){e._instance&&e._instance.close()},e.prototype.showTips=function(e,i,s){t.prototype.showTips.call(this,e,i,s),this.checkGuide()},e.prototype.updateTips=function(t,e,i,s,o){void 0===o&&(o=0),this._itemId=t,this._openModel=e,this._heroId=i,this._grid=s,this._isTh=o,-1==e&&(this._isTh=2),this.bCs.label="Sell",e==ModelID.BAG?this.bZs.visible=!0:this.bZs.visible=!1;var n=GmGlobal.mc.itemMgr.getItemCfg(t);if(n){if(this._isclose=!0,this.itemName.text=n.name,this.tMs.y=this.itemName.y+this.itemName.height+10,this.updateIcon(t),e!=ModelID.BAG)this.bSy.visible=!1,this.bCs.visible=!1,this.bHc.visible=!1,1==this._isTh?(this.bth.label="Replace",this.bth.visible=!0):2==this._isTh||3==this._isTh?(this.bth.label="Equip",this.bth.visible=!0):this.bth.visible=!1;else{if(this.bth.visible=!1,n.type==ItemType.CARD){var r=GmGlobal.mc.equipMgr.getCardCfg(t);this.bHc.visible=2==r.type?!0:!1,this.bSy.visible=1==r.type&&r.fjnum>0?!0:!1,this.bSy.label="Disassemble",this.bHc.label="Fuse",1==r.type&&(this.bCs.label="Batch \nDisassemble")}else this.bSy.visible=n.enabled?!0:!1,this.bHc.visible=!1,n.type==ItemType.EQUIP||n.type==ItemType.XINGSHI?this.bSy.label="Disassemble":4==n.enabled?(this.bSy.label="Fuse",this._isclose=!1):this.bSy.label="Use";this.bCs.visible=null==n.sell?!1:!0}if(this.bSy.visible&&this.bCs.visible&&this.bHc.visible?(this.bCs.x=75,this.bSy.x=Math.floor(this.width/2),this.bHc.x=345):this.bSy.visible&&this.bCs.visible&&!this.bHc.visible?(this.bCs.x=120,this.bSy.x=300):this.bSy.visible&&this.bHc.visible&&!this.bCs.visible?(this.bSy.x=120,this.bHc.x=480):this.bCs.visible?this.bCs.x=Math.floor(this.width/2):this.bSy.visible?this.bSy.x=Math.floor(this.width/2):this.bHc.visible&&(this.bHc.x=Math.floor(this.width/2)),n.type==ItemType.CARD){this.eqpCon.visible=!1,this.eqpCon.height=0;var r=GmGlobal.mc.equipMgr.getCardCfg(t);if(r){var h=r.txt;if(h=h.replace("%x",r.num),this.tAtr.visible=!0,this.tAtr.text="Stats:"+h,r.eid){var a=GmConst.EQP_NAME[r.eid-1];this.tMs.text="Slot:"+a,r.eid>=9&&(this.tMs.text="Slot:"+a+"(R)")}else this.tMs.text="Slot:All Gear slots"}this.tAtr.y=this.tMs.y+this.tMs.height+10}else if(n.type==ItemType.EQUIP){this.eqpCon.visible=!0;var l=GmGlobal.mc.equipMgr.getEqpCfg(this._itemId),c=GmConst.EQP_NAME[l.eid-1];9==l.eid&&(c+="(R)"),this.tMs.textFlow=TextFormat.parser.parser("Gear Type:"+TextFormat.setColor(c,6854854));var h="";if(l.career){for(var d in l.career){var p=GmGlobal.mc.heroMgr.getHeroCfg(l.career[d]),u=GmGlobal.mc.heroMgr.getCareerCfg(p.career);-1==h.indexOf(u.name)&&(h+=" "+u.name)}this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor(h,6854854))}else this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor("Any Job",6854854));this.tAtr.y=this.tMs.y+this.tMs.height+10;var m=l.natrs,_="",g=0;for(var d in m){var f=GmGlobal.mc.heroMgr.getAtrName(d);_+=0==g?f+" "+m[d]:"\n                "+f+" "+m[d],g++}var v=GmGlobal.mc.equipMgr.getQlvStr(l.qlv);this.tCd.textFlow=TextFormat.parser.parser("Requirements:"+TextFormat.setColor(_,6854854)+"\nGear Rarity:"+TextFormat.setColor(v,6854856)),this._openModel==ModelID.GONGHUI?this.tDes.text="Source:"+n.getWay:this.tDes.text="Item Description:"+n.des,this.tDes.y=this.tCd.height+15;var y=this.tDes.y+this.tDes.height+15;this.eqpCon.y+y>=610?(this.height=700,this.eqpCon.height=610):(this.eqpCon.height=y,this.height=this.eqpCon.y+y+90);for(var C=0;6>C;C++){var T=this["line"+C],b=this["tAtr"+C];T.visible=!1,b.visible=!1}}else this.eqpCon.visible=!1,this.eqpCon.height=0,this.tAtr.visible=!1,this.tMs.text=GmGlobal.mc.shopMgr.getShopGiftGetStr(n.id)||"Description:"+n.des||"",n.getWay?(this.tAtr.visible=!0,this.tAtr.text="Source:\n"+n.getWay):(this.tAtr.visible=!1,this.tAtr.text=""),this.tAtr.y=this.tMs.y+this.tMs.height+10;if(n.sell){this.tJg.visible=!0;for(var h="",g=0;g<n.sell.length;g++){var I=n.sell[g].id,E=GmGlobal.mc.itemMgr.getItemCfg(I);h+=" "+n.sell[g].num+" "+E.name}this.tJg.textFlow=TextFormat.parser.parser("Unit Price:"+TextFormat.setColor(h,6854854)),this.tJg.y=this.tAtr.y+this.tAtr.height+10,this.tJg.y+this.tJg.height>=140?this.eqpCon.y=this.tJg.y+this.tJg.height+10:this.eqpCon.y=140}else this.tJg.visible=!1,this.tAtr.y+this.tAtr.height>=140?this.eqpCon.y=this.tAtr.y+this.tAtr.height+10:this.eqpCon.y=140;this.height=this.eqpCon.y+this.eqpCon.height+90,this.resetTipsHeight(),this.scoll.viewport.scrollV=0}},e.prototype.onZs=function(){var t=GmGlobal.mc,e={i:this._itemId,s:t.role.serverId,txk:t.setMgr.getSelTxk(),h:t.role.careerId};GmGlobal.cc.chatCtl.sengChatMsg(t.chatMgr.currenCh,this._itemId.toString(),e),this.close(),CmdBus.doCmd(CmdType.O_CHAT,GmGlobal.mc.chatMgr.currenCh)},e.prototype.onCs=function(){"Batch \nDisassemble"==this.bCs.label?MsgBox.confirm2("Batch-disassemble the cards?",this.doCardFjAll,null,this):MsgBox.confirm("Sell the item?",this.doCs,null,this),this.close()},e.prototype.doCs=function(){var t=GmGlobal.mc.itemMgr.getItemNum(this._itemId);GmGlobal.cc.dataCtl.doAction(ServerActionId.ITEM_SELL,[this._itemId,t])},e.prototype.doCardFj=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_FJ,[0,this._itemId])},e.prototype.doCardFjAll=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.EQP_FJ,[0,this._itemId,1])},e.prototype.onUse=function(){var t=GmGlobal.mc.itemMgr.getItemCfg(this._itemId);if(t.type==ItemType.CARD){var e=GmGlobal.mc.equipMgr.getCardCfg(t.id);1==e.type?MsgBox.confirm2("Disassemble the card?",this.doCardFj,null,this):GmGlobal.cc.dataCtl.doAction(ServerActionId.CARD_HC,[0,this._itemId])}else if(this._itemId==ItemID.RESETATR)GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_ATR_RESET,[this._itemId]);else if(this._itemId==ItemID.RESETSKILL)GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_SKILL_RESET,[this._itemId]);else if(this._itemId==ItemID.SKILLITEM){var i=GmGlobal.mc.itemMgr.getItemNum(this._itemId);GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_SKILL_ITEM,[this._itemId,i])}else 3==t.enabled?GmGlobal.cc.dataCtl.doAction(ServerActionId.PET_BOX,[this._itemId]):4==t.enabled?(ItemHcView.getInstance().setItem(this._itemId),ItemHcView.getInstance().show(GmGlobal.vmc.uiLayer),this.close()):t.type==ItemType.XINGSHI?(ItemHcView.getInstance().setItem(this._itemId),ItemHcView.getInstance().show(GmGlobal.vmc.uiLayer),this.close()):5==t.enabled?CmdBus.doCmd(CmdType.O_BAG_ZX,this._itemId):1==t.buffitem?GmGlobal.cc.dataCtl.doAction(ServerActionId.USE_EXP_ITEM,[this._itemId,1]):GmGlobal.cc.dataCtl.reqAward(AwardId.USE_ITEM,[this._itemId],function(t,e){e&&e.length>0&&AwardTipView.showAward(e)});this._isclose&&this.close()},e.prototype.BwHcOk=function(){this.close();var t=GmGlobal.mc.baowuMgr.getIdBySpId(this._itemId);t&&CmdBus.doCmd(CmdType.O_BAOWU_JH,t)},e.prototype.onTh=function(){1==this._isTh?CmdBus.doCmd(CmdType.O_HERO_CARD,GmGlobal.mc.equipMgr.clickIdx):2==this._isTh?(GmGlobal.cc.dataCtl.doAction(ServerActionId.HERO_EQP_CARD,[GmGlobal.mc.equipMgr.clickIdx+1,GmGlobal.mc.equipMgr.clickCid,this._itemId]),CmdBus.doCmd(CmdType.C_HERO_EQP)):3==this._isTh&&(CmdBus.doCmd(CmdType.XS_REPLACE,this._itemId),ItemReplaceView.instence().close());var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.CARD_XQ&&t.triggerTarget(this.bth),this.close()},e.prototype.onHc=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.CARD_HC,[0,this._itemId]),this.close()},e.prototype.resetTipsHeight=function(){this.bg.height=this.height-80,this.scoll.height=this.bg.height,this.bHc.y=this.height-35,this.bSy.y=this.height-35,this.bCs.y=this.height-35,this.bth.y=this.height-35},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.CARD_XQ&&(t.bindTarget(GuideTargetId.REPLACE_RBTN,this.bth,this.bth.parent.localToGlobal(this.bth.x,this.bth.y)),t.setIdxToTop())},e.prototype.onClose=function(t){t.target!=this.bCs&&t.target!=this.bSy&&t.target!=this.bZs&&this.close()},e.prototype.close=function(){t.prototype.close.call(this)},e}(TipsBase);__reflect(ItemTips.prototype,"ItemTips");var MsEquipTips=function(t){function e(){var e=t.call(this)||this;return e._isclose=!0,e}return __extends(e,t),e.prototype.addEvts=function(){this.bZs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this)},e.prototype.rmEvts=function(){this.bZs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this)},e.show=function(t,i,s,o,n,r){void 0===o&&(o=0),void 0===n&&(n=null),void 0===r&&(r=0),e._instance||(e._instance=new e),e._instance.updateTips(t,o,r),e._instance.showTips(n||GmGlobal.vmc.uiLayer2,i,s)},e.close=function(){e._instance&&e._instance.close()},e.prototype.showTips=function(e,i,s){t.prototype.showTips.call(this,e,i,s)},e.prototype.updateTips=function(t,e,i){void 0===i&&(i=0),this._itemId=t,this._openModel=e,this._type=i,e==ModelID.HERO?this.bZs.visible=!0:this.bZs.visible=!1;var s=GmGlobal.mc,o=s.itemMgr.getItemCfg(t);if(o){var n=s.heroMgr.getMsItem(t);this._isclose=!0,this.itemName.text=o.name,this.updateIcon(t),this.bHc.visible=!1,this.bth.visible=!1,e!=ModelID.HERO?(this.bSy.visible=!1,this.bCs.visible=!1):(this.bth.visible=!1,this.bSy.visible=!0,1==this._type?(this.bCs.visible=!1,this.bSy.visible=!0,this.bSy.label="Equip",this.bSy.skinName="ComBtnSkinB"):2==this._type?(this.bCs.visible=!1,this.bSy.visible=!1):(this.bCs.visible=!0,this.bCs.skinName="ComBtnSkinY",n.jw<4&&10==n.jd?this.bCs.label="Evolve":4==n.jw&&99==n.jd?this.bCs.visible=!1:this.bCs.label="Fuse",this.bSy.visible=!0,this.bSy.label="Unequip",this.bSy.skinName="ComBtnSkinB")),this.bSy.visible&&this.bCs.visible&&this.bHc.visible?(this.bCs.x=75,this.bSy.x=Math.floor(this.width/2),this.bHc.x=345):this.bSy.visible&&this.bCs.visible&&!this.bHc.visible?(this.bCs.x=120,this.bSy.x=300):this.bSy.visible&&this.bHc.visible&&!this.bCs.visible?(this.bSy.x=120,this.bHc.x=480):this.bCs.visible?this.bCs.x=Math.floor(this.width/2):this.bSy.visible?this.bSy.x=Math.floor(this.width/2):this.bHc.visible&&(this.bHc.x=Math.floor(this.width/2)),this.eqpCon.visible=!0,this.tMs.textFlow=TextFormat.parser.parser("Gear Type:"+TextFormat.setColor("Altem",6854854)),this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor("Any Job",6854854)),this.tCd.textFlow=TextFormat.parser.parser("Requirements:"+TextFormat.setColor("Lv. 70+",6854854)),this.tDes.text="Item Description:"+o.des,this.tDes.y=this.tCd.height+15;var r=this.tDes.y+this.tDes.height+15;this.line0.visible=!0,this.tAtr0.visible=!0,this.line0.y=r,r+=15,this.tAtr0.y=r;var h=s.heroMgr.getMsItem(this._itemId),a=this.setAttrStr(h.attr,h.speed);this.tAtr0.textFlow=TextFormat.parser.parser("Basic Stats:"+TextFormat.setColor(a,6854856)),r+=this.tAtr0.height+15,this.line1.visible=!0,this.tAtr1.visible=!0,this.line1.y=r,r+=15,this.tAtr1.y=r,this.tAtr1.textFlow=TextFormat.parser.parser("Stage Level:"+TextFormat.setColor(h.jd,6854856)),r+=this.tAtr1.height+15,this.line2.visible=!0,this.tAtr2.visible=!0,this.line2.y=r,r+=15,this.tAtr2.y=r;var l;if(n.jw<4)l="None";else{var c=0,d=-1;if(l="",0==this._type?(c=s.heroMgr.getMsMinJd(),d=s.heroMgr.getMsGmIdx(c)):d=0,d>=0){var p=s.heroMgr.getMsGmData(d),u=this.setAttrStr(p.atr,p.speed||0,"         ");l+=TextFormat.setColor("\nBlessing Altem x8 +"+p.jd+":"+u,c>=p.jd?6854856:11777205)}if(c>0){var m=s.heroMgr.getMsGmData(d+1);if(m){var u=this.setAttrStr(m.atr,m.speed||0,"         ");l+=TextFormat.setColor("\nBlessing Altem x8 +"+m.jd+":"+u,11777205)}}}if(this.tAtr2.textFlow=TextFormat.parser.parser("Resonance Stats (Unstacked):"+l),r+=this.tAtr2.height+15,this.line3.visible=!1,this.tAtr3.visible=!1,this.line4.visible=!1,this.tAtr4.visible=!1,this.line5.visible=!1,this.tAtr5.visible=!1,this.line6.visible=!1,this.tAtr6.visible=!1,this.tTz.visible=!1,o.sell){this.tJg.visible=!0;for(var _="",g=0;g<o.sell.length;g++){var f=o.sell[g].id,v=GmGlobal.mc.itemMgr.getItemCfg(f);_+=" "+v.name+"*"+o.sell[g].num}this.tJg.textFlow=TextFormat.parser.parser("Unit Price:"+TextFormat.setColor(_,6854856)),this.tJg.y=this.tAtr.y+this.tAtr.height+10,this.tJg.y+this.tJg.height>=140?this.eqpCon.y=this.tJg.y+this.tJg.height+10:this.eqpCon.y=140}else this.tJg.visible=!1,this.tAtr.y+this.tAtr.height>=140?this.eqpCon.y=this.tAtr.y+this.tAtr.height+10:this.eqpCon.y=140;this.eqpCon.height=r,this.eqpCon.y+r>=610?this.height=700:this.height=this.eqpCon.y+r+90,this.resetTipsHeight(),this.scoll.viewport.scrollV=0}},e.prototype.setAttrStr=function(t,e,i){void 0===i&&(i="                ");var s="";for(var o in t){var n=GmGlobal.mc.heroMgr.getAtrName(o),r=GmGlobal.mc.heroMgr.isAddJia(o),h=GmGlobal.mc.heroMgr.isNdPre(o);s+=r?"\n"+i+n+" +"+t[o]:"\n"+i+n+" +"+t[o],h&&(s+="%")}return e&&(s+="\n"+i+"Character Pace +"+e),s},e.prototype.onZs=function(){var t=GmGlobal.mc,e={i:this._itemId,s:t.role.serverId,txk:t.setMgr.getSelTxk(),h:t.role.careerId};GmGlobal.cc.chatCtl.sengChatMsg(t.chatMgr.currenCh,this._itemId.toString(),e),this.close(),CmdBus.doCmd(CmdType.O_CHAT,GmGlobal.mc.chatMgr.currenCh)},e.prototype.onCs=function(){this._type||CmdBus.doCmd(CmdType.O_MS_HC,this._itemId),this.close()},e.prototype.onUse=function(){var t=GmGlobal.mc.heroMgr.getMsItem(this._itemId);1==this._type?GmGlobal.cc.dataCtl.doAction(ServerActionId.MS_EQUIP,[t.eid,this._itemId]):0==this._type&&GmGlobal.cc.dataCtl.doAction(ServerActionId.MS_EQUIP,[t.eid,0]),this._isclose&&this.close()},e.prototype.resetTipsHeight=function(){this.bg.height=this.height-80,this.scoll.height=this.bg.height,this.bHc.y=this.height-35,this.bSy.y=this.height-35,this.bCs.y=this.height-35,this.bth.y=this.height-35},e.prototype.onClose=function(t){t.target!=this.bCs&&t.target!=this.bSy&&t.target!=this.bZs&&this.close()},e.prototype.close=function(){t.prototype.close.call(this)},e}(TipsBase);__reflect(MsEquipTips.prototype,"MsEquipTips");var AStar=function(t){function e(e,i){void 0===i&&(i=1e4);var s=t.call(this)||this;return s.isBalk=!1,s.COST_STRAIGHT=10,s.COST_DIAGONAL=20,s.COST_SWERVE=5,s.NOTE_ID=0,s.NOTE_OPEN=1,s.NOTE_CLOSED=2,s.m_openCount=0,s.m_openId=0,s.m_maxTry=0,s.m_Start=0,s.m_End=0,s.m_mapTileModel=e,s.m_maxTry=i,s}return __extends(e,t),Object.defineProperty(e.prototype,"maxTry",{get:function(){return this.m_maxTry},set:function(t){t=t,this.m_maxTry=t},enumerable:!0,configurable:!0}),e.prototype.find=function(t,e,i,s){this.m_Start=egret.getTimer(),this.initLists(),this.m_openCount=0,this.m_openId=-1,this.openNote(t,e,0,0,0);for(var o,n=0,r=0,h=0,a=0,l=0,c=0,d=0,p=0,u=0;this.m_openCount>0;){if(this.m_End=egret.getTimer(),this.m_End-this.m_Start>this.m_maxTry)return this.destroyLists(),null;if(n=this.m_openList[0],this.closeNote(n),r=this.m_xList[n],h=this.m_yList[n],r==i&&h==s)return this.getPath(t,e,n);o=this.getArounds(r,h),a=this.m_fatherList[n],l=this.m_xList[a],c=this.m_yList[a];for(var m in o){var _=o[m];p=r-_[0]==h-_[1]?this.m_movementCostList[n]+this.COST_DIAGONAL:this.m_movementCostList[n]+this.COST_STRAIGHT,(r<<1!=l+_[0]||h<<1!=c+_[1])&&(p+=this.COST_SWERVE),u=p+(Math.abs(i-_[0])+Math.abs(s-_[1]))*this.COST_STRAIGHT,this.isOpen(_[0],_[1])?(d=this.m_noteMap[_[1]][_[0]][this.NOTE_ID],p<this.m_movementCostList[d]&&(this.m_movementCostList[d]=p,this.m_pathScoreList[d]=u,this.m_fatherList[d]=n,this.aheadNote(this.getIndex(d)))):this.openNote(_[0],_[1],u,p,n)}}return this.destroyLists(),null},e.prototype.openNote=function(t,e,i,s,o){this.m_openCount++,this.m_openId++,null==this.m_noteMap[e]&&(this.m_noteMap[e]=[]),this.m_noteMap[e][t]=[],this.m_noteMap[e][t][this.NOTE_OPEN]=!0,this.m_noteMap[e][t][this.NOTE_ID]=this.m_openId,this.m_xList.push(t),this.m_yList.push(e),this.m_pathScoreList.push(i),this.m_movementCostList.push(s),this.m_fatherList.push(o),this.m_openList.push(this.m_openId),this.aheadNote(this.m_openCount)
},e.prototype.aheadNote=function(t){for(var e=0,i=0;t>1&&(e=Math.floor(t>>1),this.getScore(t)<this.getScore(e));)i=this.m_openList[t-1],this.m_openList[t-1]=this.m_openList[e-1],this.m_openList[e-1]=i,t=e},e.prototype.getScore=function(t){return this.m_pathScoreList[this.m_openList[t-1]]},e.prototype.initLists=function(){this.m_openList=[],this.m_xList=[],this.m_yList=[],this.m_pathScoreList=[],this.m_movementCostList=[],this.m_fatherList=[],this.m_noteMap=[]},e.prototype.destroyLists=function(){this.m_openList=null,this.m_xList=null,this.m_yList=null,this.m_pathScoreList=null,this.m_movementCostList=null,this.m_fatherList=null,this.m_noteMap=null},e.prototype.closeNote=function(t){this.m_openCount--;var e=this.m_xList[t],i=this.m_yList[t];return this.m_noteMap[i][e][this.NOTE_OPEN]=!1,this.m_noteMap[i][e][this.NOTE_CLOSED]=!0,this.m_openCount<=0?(this.m_openCount=0,void(this.m_openList=[])):(this.m_openList[0]=this.m_openList.pop(),void this.backNote())},e.prototype.backNote=function(){for(var t=1,e=0,i=0,s=0;;){if(e=t,i=e<<1,i<=this.m_openCount&&(this.getScore(t)>this.getScore(i)&&(t=i),i+1<=this.m_openCount&&this.getScore(t)>this.getScore(i+1)&&(t=i+1)),e==t)break;s=this.m_openList[e-1],this.m_openList[e-1]=this.m_openList[t-1],this.m_openList[t-1]=s}},e.prototype.getPath=function(t,e,i){for(var s=[],o=this.m_xList[i],n=this.m_yList[i],r=0,h=0,a=0,l=0,c=0;o!=t||n!=e;){if(0==a)s.unshift([o,n]),r=o,h=n,a++;else if(1==a)s.unshift([o,n]),l=Math.atan2(n-h,o-r),r=o,h=n,a++;else{if(c=Math.atan2(n-h,o-r),c==l){var d=s[0];d[0]=o,d[1]=n}else l=c,s.unshift([o,n]),a++;r=o,h=n}i=this.m_fatherList[i],o=this.m_xList[i],n=this.m_yList[i]}s[0];return s.length>0&&s[0][0]!=t&&s[0][1]!=e&&s.unshift([t,e]),this.destroyLists(),s},e.prototype.getArounds=function(t,e){var i=[],s=0,o=0;s=t+1,o=e;var n=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;n&&!this.isClosed(s,o)&&i.push([s,o]),s=t,o=e-1;var r=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;r&&!this.isClosed(s,o)&&i.push([s,o]),s=t-1,o=e;var h=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;h&&!this.isClosed(s,o)&&i.push([s,o]),s=t,o=e+1;var a=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;a&&!this.isClosed(s,o)&&i.push([s,o]),s=t+1,o=e+1;var l=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;l&&a&&n&&!this.isClosed(s,o)&&i.push([s,o]),s=t+1,o=e-1;var c=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;c&&r&&n&&!this.isClosed(s,o)&&i.push([s,o]),s=t-1,o=e-1;var d=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;d&&h&&r&&!this.isClosed(s,o)&&i.push([s,o]),s=t-1,o=e+1;var p=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,o)!=Tile.PATH_BARRIER;return p&&h&&a&&!this.isClosed(s,o)&&i.push([s,o]),i},e.prototype.isClosed=function(t,e){return null==this.m_noteMap[e]?!1:null==this.m_noteMap[e][t]?!1:this.m_noteMap[e][t][this.NOTE_CLOSED]},e.prototype.isOpen=function(t,e){return null==this.m_noteMap[e]?!1:null==this.m_noteMap[e][t]?!1:this.m_noteMap[e][t][this.NOTE_OPEN]},e.prototype.getIndex=function(t){var e=1;for(var i in this.m_openList){var s=this.m_openList[i];if(s==t)return e;e++}return-1},e}(egret.HashObject);__reflect(AStar.prototype,"AStar");var YzEquipTips=function(t){function e(){var e=t.call(this)||this;return e._isclose=!0,e}return __extends(e,t),e.prototype.addEvts=function(){this.bZs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this)},e.prototype.rmEvts=function(){this.bZs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bCs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCs,this),this.bSy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUse,this)},e.show=function(t,i,s,o,n,r){void 0===o&&(o=0),void 0===n&&(n=null),void 0===r&&(r=0),e._instance||(e._instance=new e),e._instance.updateTips(t,o,r),e._instance.showTips(n||GmGlobal.vmc.uiLayer2,i,s)},e.close=function(){e._instance&&e._instance.close()},e.prototype.showTips=function(e,i,s){t.prototype.showTips.call(this,e,i,s)},e.prototype.updateTips=function(t,e,i){void 0===i&&(i=0),this._itemId=t,this._openModel=e,this._type=i,this.bCs.label="Sell",e==ModelID.HERO?this.bZs.visible=!0:this.bZs.visible=!1;var s=GmGlobal.mc.itemMgr.getItemCfg(t),o=GmGlobal.mc.heroMgr.getYzCfg(this._itemId);if(s){this._isclose=!0,this.itemName.text=s.name,this.tMs.y=this.itemName.y+this.itemName.height+10,this.updateIcon(t),this.bHc.visible=!1,this.bth.visible=!1,e!=ModelID.HERO?(this.bSy.visible=!1,this.bCs.visible=!1):(this.bth.visible=!1,this.bSy.visible=!0,this._type?(this.bCs.visible=null==s.sell?!1:!0,this.bCs.skinName="ComBtnSkinY",this.bSy.label="Equip",this.bSy.skinName="ComBtnSkinB"):(this.bCs.label="Convert",this.bCs.skinName="ComBtnSkinB",this.bCs.visible=!0,this.bSy.label="Refine",this.bSy.skinName="ComBtnSkinY")),this.bSy.visible&&this.bCs.visible&&this.bHc.visible?(this.bCs.x=75,this.bSy.x=Math.floor(this.width/2),this.bHc.x=345):this.bSy.visible&&this.bCs.visible&&!this.bHc.visible?(this.bCs.x=120,this.bSy.x=300):this.bSy.visible&&this.bHc.visible&&!this.bCs.visible?(this.bSy.x=120,this.bHc.x=480):this.bCs.visible?this.bCs.x=Math.floor(this.width/2):this.bSy.visible?this.bSy.x=Math.floor(this.width/2):this.bHc.visible&&(this.bHc.x=Math.floor(this.width/2)),this.eqpCon.visible=!0;var n=GmGlobal.mc.heroMgr.tzCfgs[o.tzid],r=GmConst.EQP_NAME[o.eid-1];this.tMs.textFlow=TextFormat.parser.parser("Gear Type:"+TextFormat.setColor("Shadow Gear_"+r,6854854)),this.tAtr.y=this.tMs.y+this.tMs.height+10,this.tAtr.textFlow=TextFormat.parser.parser("Job Requirement:"+TextFormat.setColor("Any Job",6854854)),this.tCd.textFlow=TextFormat.parser.parser("Requirements:"+TextFormat.setColor("None",6854854)),this.tDes.text="Item Description:"+s.des,this.tDes.y=this.tCd.height+15;var h=this.tDes.y+this.tDes.height+15;this.line0.visible=!0,this.tAtr0.visible=!0,this.line0.y=h,h+=15,this.tAtr0.y=h;var a=GmGlobal.mc.heroMgr.bAtrDes[o.eid-1];a=a.replace("%x",o.bAtr),this.tAtr0.textFlow=TextFormat.parser.parser("Basic Stats:"+TextFormat.setColor(a,6854856)),h+=this.tAtr0.height+15,this.line1.visible=!0,this.tAtr1.visible=!0,this.line1.y=h,h+=15,this.tAtr1.y=h;var l=GmGlobal.mc.heroMgr.jlAtrDes[o.eid-1];l=l.replace("%x",o.jlAtr),this.tAtr1.textFlow=TextFormat.parser.parser("Refine Stats:"+TextFormat.setColor(l,6854856)),h+=this.tAtr1.height+15,this.line2.visible=!0,this.tAtr2.visible=!0,this.line2.y=h,h+=15,this.tAtr2.y=h;for(var c="",d=6854856,p=GmGlobal.mc.heroMgr.getYzCdNum(this._itemId),u=0;u<n.tzAtr.length;u++){var m=n.tzAtr[u],_=m.num;c+=p>=_?TextFormat.setColor("\n"+m.txt,d):"\n"+m.txt}this.tAtr2.textFlow=TextFormat.parser.parser("Set Stats:"+c),h+=this.tAtr2.height+15,this.line3.visible=!0,this.tAtr3.visible=!0,this.line3.y=h,h+=15,this.tAtr3.y=h;for(var g="",f=GmGlobal.mc.heroMgr.getYzJlNum(this._itemId),u=0;u<n.gmAtr.length;u++){for(var m=n.gmAtr[u],v="",y=0;y<m.atr.length;y++){var C=m.atr[y];for(var T in C){var b=GmGlobal.mc.heroMgr.getAtrName(T),I=GmGlobal.mc.heroMgr.isAddJia(T),E=GmGlobal.mc.heroMgr.isNdPre(T);v+=I?"\n"+b+"+"+C[T]:"\n"+b+C[T],E&&(v+="%")}}m.tsAtr&&(v+="\n"+m.tsAtr),g+=p>=8&&m.jllv<=f?TextFormat.setColor("\nFull set total Refine LV reaches "+m.jllv+":"+v,d):"\nFull set total Refine LV reaches "+m.jllv+":"+v}if(this.tAtr3.textFlow=TextFormat.parser.parser("Echo Stats:"+g),h+=this.tAtr3.height+15,this.line4.visible=!1,this.tAtr4.visible=!1,this.line5.visible=!1,this.tAtr5.visible=!1,this.line6.visible=!1,this.tAtr6.visible=!1,this.tTz.visible=!1,s.sell){this.tJg.visible=!0;for(var G="",u=0;u<s.sell.length;u++){var w=s.sell[u].id,S=GmGlobal.mc.itemMgr.getItemCfg(w);G+=" "+S.name+"*"+s.sell[u].num}this.tJg.textFlow=TextFormat.parser.parser("Unit Price:"+TextFormat.setColor(G,6854856)),this.tJg.y=this.tAtr.y+this.tAtr.height+10,this.tJg.y+this.tJg.height>=140?this.eqpCon.y=this.tJg.y+this.tJg.height+10:this.eqpCon.y=140}else this.tJg.visible=!1,this.tAtr.y+this.tAtr.height>=140?this.eqpCon.y=this.tAtr.y+this.tAtr.height+10:this.eqpCon.y=140;this.eqpCon.height=h,this.eqpCon.y+h>=610?this.height=700:this.height=this.eqpCon.y+h+90,this.resetTipsHeight(),this.scoll.viewport.scrollV=0}},e.prototype.onZs=function(){var t=GmGlobal.mc,e={i:this._itemId,s:t.role.serverId,txk:t.setMgr.getSelTxk(),h:t.role.careerId};GmGlobal.cc.chatCtl.sengChatMsg(t.chatMgr.currenCh,this._itemId.toString(),e),this.close(),CmdBus.doCmd(CmdType.O_CHAT,GmGlobal.mc.chatMgr.currenCh)},e.prototype.onCs=function(){if(this._type){var t=GmGlobal.mc.itemMgr.getItemNum(this._itemId);GmGlobal.cc.dataCtl.doAction(ServerActionId.ITEM_SELL,[this._itemId,t])}else CmdBus.doCmd(CmdType.O_HERO_YZ_ZH,this._itemId);this.close()},e.prototype.onUse=function(){if(this._type)GmGlobal.cc.dataCtl.doAction(ServerActionId.YZ_EQP_CD,[this._itemId]);else{var t=GmGlobal.mc.heroMgr.getYzCfg(this._itemId);if(t.jllv>=15)MsgBox.prompt("Max gear Refine LV reached");else{var e=GmGlobal.mc.heroMgr.getYzIdxById(this._itemId);-1!=e&&CmdBus.doCmd(CmdType.O_HERO_YZ_JL,e-1)}}this._isclose&&this.close()},e.prototype.resetTipsHeight=function(){this.bg.height=this.height-80,this.scoll.height=this.bg.height,this.bHc.y=this.height-35,this.bSy.y=this.height-35,this.bCs.y=this.height-35,this.bth.y=this.height-35},e.prototype.onClose=function(t){t.target!=this.bCs&&t.target!=this.bSy&&t.target!=this.bZs&&this.close()},e.prototype.close=function(){t.prototype.close.call(this)},e}(TipsBase);__reflect(YzEquipTips.prototype,"YzEquipTips");var TishiManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_tishi.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this._cfg=t},t.prototype.getCfg=function(){return this._cfg},t}();__reflect(TishiManager.prototype,"TishiManager");var TishiMediator=function(){function t(){this._preIndex=-1,EventBus.addListener(EventType.M_MUI_READY,this.onMuiReady,this)}return t.prototype.onMuiReady=function(){var t=GmGlobal.mc,e=t.dataMgr.getDayCacheValue(LocalDayDataId.TISHI_NUM),i=t.tishiMgr.getCfg();e>=i.daymax||egret.setTimeout(this.showTishi,this,1e3*i.interval)},t.prototype.showTishi=function(){var t=GmGlobal.mc,e=t.tishiMgr.getCfg(),i=t.dataMgr.getDayCacheValue(LocalDayDataId.TISHI_NUM);GmGlobal.cc.chatCtl.addTishi(e.txts[0==i?0:this.getTxtIndex(e.txts.length)],ChatChannel.WORLD),GmGlobal.cc.dataCtl.cacheDayDataToServer([LocalDayDataId.TISHI_NUM,i+1]),i+1<e.daymax&&egret.setTimeout(this.showTishi,this,1e3*e.interval)},t.prototype.getTxtIndex=function(t){for(var e=Utils.random(0,t-1);e==this._preIndex;)e=Utils.random(0,t-1);return this._preIndex=e,e},t}();__reflect(TishiMediator.prototype,"TishiMediator");var TitleController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_TITLE,this.onUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.titleMgr;i.updInfos(e),this.updateRedDot(),EventBus.dispatchEvt(EventType.TITLE_UPD)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.titleMgr,e=0;3>e;e++){var i=t.redDot.childs[e];i.state=0;for(var s=t.getInfoByIdx(e),o=0;o<s.length;o++){var n=s[o];if(0==n.state){i.state=1;break}}}},t}();__reflect(TitleController.prototype,"TitleController");var TitleItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.info,e=this.data.cfg;this.tms.text=e.introduce.replace("%x",e.num),this.icon.source=GmGlobal.mc.titleMgr.getIconById(t.id),this.tnum.text=e.num+"/"+e.num;for(var i="",s=0;s<e.attr.length;s++){var o=e.attr[s];for(var n in o){s>0&&(i+="\n"),i+=GmGlobal.mc.heroMgr.getAtrName(n);var r=GmGlobal.mc.heroMgr.isAddJia(n),h=GmGlobal.mc.heroMgr.isNdPre(n);r&&(i+=" +"),i+=o[n],h&&(i+="%")}}this.tatr.text=i,this.okBtn.skinName="ComBtnSkinY",Utils.setBtnEnable(this.okBtn,!0),this.ird.visible=!1,0==t.state?(this.okBtn.label="Available",this.ird.visible=!0):1==t.state?this.okBtn.label="Equip":2==t.state?(this.okBtn.label="Unequip",this.okBtn.skinName="ComBtnSkinB"):(this.okBtn.label="Not obtained",Utils.setBtnEnable(this.okBtn,!1),this.tnum.text=t.num+"/"+e.num)},e}(eui.ItemRenderer);__reflect(TitleItem.prototype,"TitleItem");var TitleManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_title.json",this.initConfig,this);var t={0:0,1:0,2:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.TITLE,this.redDot)}return t.prototype.initConfig=function(t){t&&(this._cfgs=t)},t.prototype.getCfgById=function(t){return this._cfgs[t]},t.prototype.sortLst=function(){var t=[];return t},t.prototype.getIconById=function(t){var e=this.getCfgById(t);return e?GmConst.TITLE_ICON_DIR+e.icon+".png":GmConst.TITLE_ICON_DIR+"ch001.png"},t.prototype.updInfos=function(t){var e=t.a,i=t.b;this._infos=[];var s=[],o=[];for(var n in e){var r={id:Number(n),state:e[n],num:-1};0==r.state?s.push(r):1==r.state?o.push(r):2==r.state&&this._infos.push(r)}this._infos=this._infos.concat(s),this._infos=this._infos.concat(o);for(var n in i){var h={id:Number(n),state:-1,num:i[n]};this._infos.push(h)}},t.prototype.updWjhInfo=function(t){for(var e in t)for(var i=Number(e),s=0;s<this._infos.length;s++){var o=this._infos[s];if(i==o.id){o.num=t[e];break}}},t.prototype.getInfoByIdx=function(t){for(var e=[],i=0;i<this._infos.length;i++){var s=this._infos[i],o=this.getCfgById(s.id);o.type==t+1&&e.push(s)}return e},t.prototype.getCdIds=function(){for(var t=[],e=0;e<this._infos.length;e++){var i=this._infos[e];2==i.state&&t.push(i.id)}return t},t}();__reflect(TitleManager.prototype,"TitleManager");var TitleMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.TITLE,CmdType.O_TITLE),CmdBus.adListener(CmdType.O_TITLE,this.onOpenView,this),CmdBus.adListener(CmdType.C_TITLE,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t){void 0===t&&(t=0),this._tIdx=t,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new TitleView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._tIdx)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(TitleMediator.prototype,"TitleMediator",["IMediator"]);var TitleView=function(t){function e(){var e=t.call(this,"TitleSkin")||this;return e._tIdx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TitleItemSkin",this.itemList.itemRenderer=TitleItem,this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.TITLE_UPD,this.updLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.TITLE_UPD,this.updLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),GmGlobal.cc.dataCtl.doAction(ServerActionId.TITLE_R)},e.prototype.onTouchList=function(t){if(t.target.parent.parent==this.itemList&&"btn"==t.target.name){var e=t.target.parent,i=e.data.info;0==i.state?this._cc.dataCtl.doAction(ServerActionId.TITLE_JH,[i.id]):(1==i.state||2==i.state)&&this._cc.dataCtl.doAction(ServerActionId.TITLE_CD,[i.id])}},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tIdx)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tIdx){if(-1!=this._tIdx){var e=this.tableBgCon.getChildAt(this._tIdx);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tIdx=t,this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.updLst()}},e.prototype.updLst=function(){for(var t=this._mc.titleMgr.getInfoByIdx(this._tIdx),e=0;e<t.length;e++){var i=t[e],s=this._mc.titleMgr.getCfgById(i.id),o={info:i,cfg:s,idx:e+1},n=this._array.getItemAt(e);n?this._array.replaceItemAt(o,e):this._array.addItem(o)}this.updateRedDot()},e.prototype.updateRedDot=function(){for(var t=0;3>t;t++){var e=this._mc.titleMgr.redDot.childs[t],i=this.tableBgCon.getChildAt(t);if(1==e.state){var s=this.tableBgCon.x+150*(t+1)+10*t-20;RedDotView.addRedDot(i,this.redDotCon,"title",s,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(i)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TITLE)},e.prototype.close=function(){if(-1!=this._tIdx){var e=this.tableBgCon.getChildAt(this._tIdx);e.source="com_json.tab_ui0"}this._tIdx=-1,RedDotView.removeRedDotByGroup("title"),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(TitleView.prototype,"TitleView");var TousController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_TOUSHI,this.onUpdTs,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_TOUSHI_SC,this.onUpdTssc,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_TOUSHI_LST,this.onUpdTsLst,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_TOUSHI_ONE,this.onUpdTsOne,this),EventBus.addListener(EventType.M_UPD_CON,this.updateRedDot,this)}return t.prototype.onUpdTs=function(t){var e=t.data.data,i=GmGlobal.mc.tsMgr;i.bid=e.bid,this.updateRedDot(),EventBus.dispatchEvt(EventType.M_TOUSHI_BID_UPD)},t.prototype.onUpdTssc=function(t){var e=t.data.data,i=GmGlobal.mc.tsMgr;i.slv=e.slv||0,i.sexp=e.sexp||0;var s=i.getScMaxLv();s==i.slv&&this.updateRedDot(),EventBus.dispatchEvt(EventType.M_TOUSHI_SC,Boolean(s==i.slv))},t.prototype.onUpdTsLst=function(t){var e=t.data.data,i=GmGlobal.mc.tsMgr;i.lst=e||{},this.updateRedDot(),EventBus.dispatchEvt(EventType.M_TOUSHI_UPD)},t.prototype.onUpdTsOne=function(t){var e=t.data.data,i=GmGlobal.mc.tsMgr;i.lst[e.id]=e.data,this.updateRedDot(),EventBus.dispatchEvt(EventType.M_TOUSHI_UPD)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.tsMgr,e=t.redDot.childs[1],i=t.tsCfgs,s=t.getScMaxLv(),o=0;o<i.length;o++){var n=i[o],r=GmGlobal.mc.itemMgr.getItemNum(n.id);this.setItemRD(e,n.id,t.slv<s&&r>=1?1:0)}for(var h=t.redDot.childs[0],o=0;o<t.tsCfgs.length;o++){var a=0,n=t.tsCfgs[o],l=GmGlobal.mc.itemMgr.getItemNum(n.upId),c=0,d=t.lst[o+1];d&&(c=d.lv);var p=n.upCfgs[c];p||(p=n.upCfgs[n.upCfgs.length-1]),a=d&&!Utils.isEmptyObj(d)&&l>=p.num&&d.lv<n.upCfgs.length?1:0,this.setItemRD(h,n.id,a)}this.checkItemRD(e.childs)},t.prototype.checkItemRD=function(t){for(var e in t){var i=Number(e),s=t[e];0==GmGlobal.mc.itemMgr.getItemNum(i)&&(s.state=0)}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t}();__reflect(TousController.prototype,"TousController");var TousMadeView=function(t){function e(){var e=t.call(this,"TousMadeSkin")||this;return e._sId=-1,e.col=5,e.row=4,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bMade.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMade,this),this.bBuy3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onB3,this),this.bBuy4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onB4,this),this.bBuy5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onB5,this),EventBus.addListener(EventType.M_UPD_CON,this.updGrid,this),EventBus.addListener(EventType.M_TOUSHI_UPD,this.updLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bMade.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMade,this),this.bBuy3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onB3,this),this.bBuy4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onB4,this),this.bBuy5.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onB5,this),EventBus.rmListener(EventType.M_UPD_CON,this.updGrid,this),EventBus.rmListener(EventType.M_TOUSHI_UPD,this.updLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updLst(),this.selGrid(0),this.alphaShow()},e.prototype.updLst=function(){var t=this._mc.tsMgr.tsCfgs,e=0;this._itemList=[];for(var i=0;i<t.length;i++){var s=t[i],o=this._mc.itemMgr.getItemNum(s.id),n=new Item(s.id,o);this._itemList.push(n),e++}var r=this.col*this.row;this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(r,115,!1,!1,!0),this._itemGridCon.addToParent(10,10,this.itemCon,null,this.scroll.width),this._itemGridCon.setTouchCb(!1,this.onLstTouch,this),this.iSel=new eui.Image("item_json.item_k_sel"),this.itemCon.addChild(this.iSel),this.iSel.touchEnabled=!1),this._itemGridCon.setItems(this._itemList);for(var h=this._itemGridCon.grids,i=0;i<h.length;i++){var a=h[i],l=this._mc.tsMgr.lst[i+1];l?a.disabled(!0):a.disabled(!1)}},e.prototype.onLstTouch=function(t){this.selGrid(t.index)},e.prototype.selGrid=function(t){if(t!=this._sId){this._sId=t;var e=Math.floor(this._sId/this.col),i=this._sId%this.col;this.iSel.x=125*i,this.iSel.y=125*e,this.updGrid()}},e.prototype.updGrid=function(){var t=(this._mc.tsMgr.lst[this._sId+1],this._mc.tsMgr.tsCfgs[this._sId]);this.icon.source="tsIcon_json."+t.icon,this.icon.anchorOffsetX=Math.floor((this.icon.width||150)/2),this.icon.anchorOffsetY=Math.floor((this.icon.height||99)/2),this.clearNItems(),this._nItemGridCon=ItemGridCon.create(),this._nItemGridCon.initGridsByItems(t.items,92,!1,!0,!0),this._nItemGridCon.addToParent(8,0,this.itemIconCon,this.itemTextCon),this._nItemGridCon.setTouchCb(!0),this._nItemGridCon.setItems(t.items,!0),this._nItemGridCon.textAlign=egret.HorizontalAlign.CENTER;var e=this._mc.itemMgr.getItemCfg(t.id);this.tname.text=e.name;var i=this.isCanMade(t.items);Utils.setBtnEnable(this.bMade,i);for(var s=3;s<t.items.length;s++){var o=t.items[s],n=this._mc.itemMgr.getItemNum(o.id),r=this["bBuy"+s];if(n<o.num&&this._mc.shopMgr.getKapulaItemCfg(o.id)){r.visible=!0;var h=this._nItemGridCon.grids[s];r.x=this.itemIconCon.x+h.qGrid.x+46}else r.visible=!1}for(s;5>=s;s++)this["bBuy"+s].visible=!1},e.prototype.isCanMade=function(t){for(var e=!0,i=0;i<t.length;i++){var s=this._mc.itemMgr.getItemNum(t[i].id);if(s<t[i].num){e=!1;break}}return e},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.clearNItems=function(){this._nItemGridCon&&(ItemGridCon.release(this._nItemGridCon),this._nItemGridCon=null)},e.prototype.onMade=function(){this.bMade.touchEnabled=!1,this.showQhEft()},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("toushizz"),this.addChild(this._eft),this._eft.x=this.ibg.x+Math.floor(this.ibg.width/2),this._eft.y=this.ibg.y+Math.floor(this.ibg.height/2)-2),this._eft.visible=!0,this._eft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._eft.visible=!1,GmGlobal.cc.dataCtl.doAction(ServerActionId.TOUS_MADE,[this._sId+1,0]),this.bMade.touchEnabled=!0},e.prototype.onB3=function(){this.quickBuy(3)},e.prototype.onB4=function(){this.quickBuy(4)},e.prototype.onB5=function(){this.quickBuy(5)},e.prototype.quickBuy=function(t){var e=this._nItemGridCon.grids[t],i=this._mc.shopMgr.getKapulaItemCfg(e.itemId),s=this._mc.itemMgr.getItemNum(e.itemId),o=ItemSellView.getInstance();o.setItem(i.item.id,2*i.cost.num,i.cost.id,e.num,!0,e.num-s),o.show(GmGlobal.vmc.uiLayer)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TOUSHI_M)},e.prototype.close=function(){this._sId=-1,this.clearItems(),this.clearNItems(),this._eft&&(this._eft.clear(),this._eft=null),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(TousMadeView.prototype,"TousMadeView");var TousManager=function(){function t(){this.tsCfgs=[],this.scCfgs=[],this.atrs=[],this.lst={},this.slv=0,this.sexp=0,GmGlobal.mc.regUnzipCfg("c_toushi.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_tsuipos.json",this.initPosCfg,this);var t={0:0,1:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.TOUSHI,this.redDot)}return t.prototype.initCfg=function(t){this.tsCfgs=t.toushi,this.rule=t.rule,this.scCfgs=t.scCfgs,this.atrs=t.scAtrs},t.prototype.initPosCfg=function(t){this._poss=t},t.prototype.getScMaxLv=function(){return this.scCfgs.length-1},t.prototype.getRoleTsPos=function(t,e){return this._poss[t][e]},t.prototype.getCfgByTsId=function(t){for(var e,i=0;i<this.tsCfgs.length;i++)if(t==this.tsCfgs[i].id){e=this.tsCfgs[i];break}return e},t.prototype.getCdIdx=function(){var t=-1;if(this.bid)for(var e=0;e<this.tsCfgs.length;e++){var i=this.tsCfgs[e];if(this.bid==i.id){t=e;break}}return t},t}();__reflect(TousManager.prototype,"TousManager");var TousMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.TOUSHI,CmdType.O_TOUSHI),CmdBus.adListener(CmdType.O_TOUSHI,this.onOpenView,this),CmdBus.adListener(CmdType.C_TOUSHI,this.onCloseView,this)}return t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new TousView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(TousMediator.prototype,"TousMediator",["IMediator"]);var TousMMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.TOUSHI_M,CmdType.O_TOUSHI_M),CmdBus.adListener(CmdType.O_TOUSHI_M,this.onOpenView,this),CmdBus.adListener(CmdType.C_TOUSHI_M,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new TousMadeView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(TousMMediator.prototype,"TousMMediator",["IMediator"]);var TousView=function(t){function e(){var e=t.call(this,"TousSkin")||this;return e._scIdx=-1,e._tabIndex=-1,e._sId=-1,e.col=5,e.row=4,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bMade.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMade,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.scCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onScCon,this),EventBus.addListener(EventType.M_UPD_CON,this.updPanel,this),EventBus.addListener(EventType.M_TOUSHI_BID_UPD,this.updGrid,this),EventBus.addListener(EventType.M_TOUSHI_UPD,this.updPanel,this),EventBus.addListener(EventType.M_TOUSHI_SC,this.updScIcon,this),EventBus.addListener(EventType.M_R_UPD,this.updateRoleInfo,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bMade.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMade,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.scCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onScCon,this),EventBus.rmListener(EventType.M_UPD_CON,this.updPanel,this),EventBus.rmListener(EventType.M_TOUSHI_BID_UPD,this.updGrid,this),EventBus.rmListener(EventType.M_TOUSHI_UPD,this.updPanel,this),EventBus.rmListener(EventType.M_TOUSHI_SC,this.updScIcon,this),EventBus.rmListener(EventType.M_R_UPD,this.updateRoleInfo,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateRoleInfo(),this.updLst(),this.updScIcons(),this.selTab(0);var i=this._mc.tsMgr.getCdIdx();-1==i?this.selGrid(0):this.selGrid(i),this.selScIcon(0),this.updScIcon(null),this.alphaShow()},e.prototype.updateRoleInfo=function(){var t=GmGlobal.mc.role;this.iHero.source=this._mc.heroMgr.getHeroUIModel2(t.careerId)},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){if(-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);if(i.source="com_json.tab_ui1",this._tabIndex=t,0==t){this.tsCon.visible=!0,this.scCon.visible=!1;var s=this._mc.tsMgr.getCdIdx();-1==s?this.selGrid(0):this.selGrid(s)}else this.tsCon.visible=!1,this.scCon.visible=!0;RedDotView.removeRedDotByGroup("toushi"),this.updateRedDot()}},e.prototype.onScCon=function(t){if(t.target.parent==this.scCon){var e=Utils.getNameIndex(t.target.name);-1!=e&&this.selScIcon(e)}},e.prototype.selScIcon=function(t){var e=this._mc.tsMgr.tsCfgs[t],i=(this._mc.tsMgr.lst[t+1],this._mc.itemMgr.getItemNum(e.id));i>=1&&1==this._tabIndex&&-1!=this._scIdx&&MsgBox.confirm("Mark the Head for EXP",this.onOk,null,this),t!=this._scIdx&&(this._scIdx=t)},e.prototype.updScIcon=function(t){var e=this._mc.tsMgr.slv,i=this._mc.tsMgr.sexp;this.tScLv.textFlow=TextFormat.parser.parser("Mark LV: "+TextFormat.setColor(e.toString(),14050935)),e>=this._mc.tsMgr.scCfgs.length&&(e=this._mc.tsMgr.scCfgs.length-1);var s=this._mc.tsMgr.scCfgs[e];this.tBar.text=i+"/"+s.exp,this.bar.value=i,this.bar.maximum=s.exp;for(var o=0;6>o;o++){var n=this._mc.tsMgr.atrs[o];this["tAtr"+o].text=this._mc.heroMgr.getAtrName(n),this["tAtrNum"+o].text="+"+s.atrs[o]}t&&t.data&&this.updateRedDot()},e.prototype.updPanel=function(){this.updLst(),this.updScIcons(),this.updScIcon(null),this.updGrid()},e.prototype.updScIcons=function(){for(var t=this._mc.tsMgr.tsCfgs,e=0;18>e;e++){var i=this["icon"+e],s=t[e];i.source=this._mc.itemMgr.getItemIcon(s.id),i.name="icon_"+e;var o=this._mc.tsMgr.lst[e+1];o&&o.lv>0?i.filters=[]:i.filters=FilterUtils.disabled()}},e.prototype.updLst=function(){var t=this._mc.tsMgr.tsCfgs,e=0;this._itemList=[];for(var i=0;i<t.length;i++){var s=t[i],o=this._mc.itemMgr.getItemNum(s.id),n=new Item(s.id,o);
this._itemList.push(n),e++}var r=this.col*this.row;this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(r,115,!1,!1,!0),this._itemGridCon.addToParent(10,10,this.itemCon,null,this.scroll.width),this._itemGridCon.setTouchCb(!1,this.onLstTouch,this),this.iSel=new eui.Image("item_json.item_k_sel"),this.itemCon.addChild(this.iSel),this.iSel.touchEnabled=!1),this._itemGridCon.setItems(this._itemList);for(var h=this._itemGridCon.grids,i=0;i<h.length;i++){var a=h[i],l=this._mc.tsMgr.lst[i+1];l?a.disabled(!0):a.disabled(!1)}},e.prototype.onLstTouch=function(t){this.selGrid(t.index)},e.prototype.selGrid=function(t){if(t!=this._sId){this._sId=t;var e=Math.floor(this._sId/this.col),i=this._sId%this.col;this.iSel.x=125*i,this.iSel.y=125*e,this.updGrid()}},e.prototype.updGrid=function(){var t=this._mc.tsMgr.lst[this._sId+1],e=this._mc.tsMgr.tsCfgs[this._sId],i=this._mc.itemMgr.getItemCfg(e.id);this.tname.text=i.name,this.xhIcon.source=this._mc.itemMgr.getItemIcon(e.upId);var s=this._mc.itemMgr.getItemNum(e.upId),o=0,n=e.upCfgs[o];if(t){Utils.setBtnEnable(this.bMade,!0),e.id==this._mc.tsMgr.bid?this.bMade.label="Unequip":this.bMade.label="Equip",this.tLv.text=t.lv,t.lv>0&&(o=t.lv-1);var r=e.upCfgs[o];t.lv>=e.upCfgs.length?(n=e.upCfgs[t.lv-1],this.bUp.label="Max LV"):(n=e.upCfgs[t.lv],this.bUp.label="LV UP");var h=0;if(r.atrs)for(var a in r.atrs){this["tBAtr"+h].visible=!0,this["tBAtrNum"+h].visible=!0,this["atrBg"+h].visible=!0,this["line"+h].visible=!0;var l=this._mc.heroMgr.getAtrName(a),c=GmGlobal.mc.heroMgr.isAddJia(a),d=GmGlobal.mc.heroMgr.isNdPre(a),p=r.atrs[a];c&&(p="+"+r.atrs[a]),d&&(p+="%"),this["tBAtr"+h].text=l+":",this["tBAtrNum"+h].text=p,h++}if(r.patrs)for(var a in r.patrs){this["tBAtr"+h].visible=!0,this["tBAtrNum"+h].visible=!0,this["atrBg"+h].visible=!0,this["line"+h].visible=!0;var u=this._mc.heroMgr.getAtrName(a),c=GmGlobal.mc.heroMgr.isAddJia(a),d=GmGlobal.mc.heroMgr.isNdPre(a),p=r.patrs[a]+"%";c&&(p="+"+r.atrs[a]),d&&(p+="%"),this["tBAtr"+h].text=u+":",this["tBAtrNum"+h].text=p,h++}for(var m=h;4>m;m++)this["tBAtr"+m].visible=!1,this["tBAtrNum"+m].visible=!1,this["atrBg"+m].visible=!1,this["line"+m].visible=!1}else{Utils.setBtnEnable(this.bMade,!1),this.bMade.label="Equip",this.tLv.text="0";var r=e.upCfgs[0],h=0;if(r.atrs)for(var a in r.atrs){this["tBAtr"+h].visible=!0,this["tBAtrNum"+h].visible=!0,this["atrBg"+h].visible=!0,this["line"+h].visible=!0;var _=this._mc.heroMgr.getAtrName(a),c=GmGlobal.mc.heroMgr.isAddJia(a),d=GmGlobal.mc.heroMgr.isNdPre(a),p=r.atrs[a];c&&(p="+"+r.atrs[a]),d&&(p+="%"),this["tBAtr"+h].text=_+":",this["tBAtrNum"+h].text=p,h++}if(r.patrs)for(var a in r.patrs){this["tBAtr"+h].visible=!0,this["tBAtrNum"+h].visible=!0,this["atrBg"+h].visible=!0,this["line"+h].visible=!0;var g=this._mc.heroMgr.getAtrName(a),c=GmGlobal.mc.heroMgr.isAddJia(a),d=GmGlobal.mc.heroMgr.isNdPre(a),p=r.patrs[a]+"%";c&&(p="+"+r.atrs[a]),d&&(p+="%"),this["tBAtr"+h].text=g+":",this["tBAtrNum"+h].text=p,h++}for(var m=h;4>m;m++)this["tBAtr"+m].visible=!1,this["tBAtrNum"+m].visible=!1,this["atrBg"+m].visible=!1,this["line"+m].visible=!1}TextFormat.setMoneyStr(this.tNum,s,n.num),t&&!Utils.isEmptyObj(t)&&s>=n.num&&t.lv<e.upCfgs.length?Utils.setBtnEnable(this.bUp,!0):Utils.setBtnEnable(this.bUp,!1),this.updCdTs(),this.updateRedDot()},e.prototype.updCdTs=function(){var t=this._mc.tsMgr.tsCfgs[this._sId],e=this._mc.tsMgr.getRoleTsPos(this._mc.role.careerId,t.id);this.iTs.x=this.iHero.x+e.x,this.iTs.y=this.iHero.y+e.y,this.iTs.source="tsIcon_json."+t.icon,this.iTs.visible=!0},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onOk=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.TOUS_MADE,[this._scIdx+1,2])},e.prototype.onUp=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.TOUS_MADE,[this._sId+1,1])},e.prototype.onMade=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.TOUS_MADE,[this._sId+1,3])},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.tsMgr.rule)},e.prototype.updateRedDot=function(){for(var t=0;2>t;t++){var e=this._mc.tsMgr.redDot.childs[t],i=this.tableBgCon.getChildAt(t);if(1==e.state){var s=this.tableBgCon.x+110*(t+1)+10*t-20;RedDotView.addRedDot(i,this.redDotCon,"toushi",s,this.tableBgCon.y-4,"com_json.com_rdd")}else RedDotView.removeRedDot(i)}1==this._tabIndex?this.updScRedDot():this.updUpRedDot()},e.prototype.updScRedDot=function(){var t=this._mc.tsMgr.redDot.childs[1],e=this._mc.tsMgr.tsCfgs;if(t.childs)for(var i=0;i<e.length;i++){var s=e[i],o=t.childs[s.id],n=this["icon"+i];if(o&&1==o.state&&1==this._tabIndex){var r=this.getRDPoint(n);RedDotView.addRedDot(n,this.redDotCon,"toushi",r.x,r.y,"com_json.com_rdd")}else RedDotView.removeRedDot(n)}},e.prototype.updUpRedDot=function(){var t=this._mc.tsMgr.redDot.childs[0];if(t.childs)for(var e=0;e<this._itemList.length;e++){var i=this._itemList[e],s=t.childs[i.id],o=this._itemGridCon.grids[e],n=o.qGrid;s&&1==s.state&&0==this._tabIndex?RedDotView.addRedDot(n,this.itemRedCon,"toushi",n.x-30+n.width,n.y,"com_json.com_rdd"):RedDotView.removeRedDot(n)}},e.prototype.getRDPoint=function(t){var e=t.parent.localToGlobal(t.x,t.y);return e.x-=this.x-t.width+25,e.y-=this.y+5,e},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TOUSHI)},e.prototype.close=function(){if(RedDotView.removeRedDotByGroup("toushi"),this._sId=-1,-1!=this._tabIndex){var e=this.tableBgCon.getChildAt(this._tabIndex);e.source="com_json.tab_ui0"}this._tabIndex=-1,this.clearItems(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(TousView.prototype,"TousView");var TradeController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_TRADE_SELL,this.onUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.U_TRADE_LOW_PRICE,this.onLowPrice,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.tradeMgr,s=e.op||GmGlobal.getServerTime();i.opCd.setTime(s-GmGlobal.getServerTime()),i.sellLst=e.lst||{},i.selNum=e.dnum||0,EventBus.dispatchEvt(EventType.M_TRADE_SELL)},t.prototype.onLowPrice=function(t){var e=t.data.data;GmGlobal.mc.tradeMgr.lowPrice=e.bpice,EventBus.dispatchEvt(EventType.M_TRADE_BPRICE)},t}();__reflect(TradeController.prototype,"TradeController");var TradeData=function(){function t(){}return t}();__reflect(TradeData.prototype,"TradeData");var TradeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bGz.visible=!0,this.bTh.visible=!1,this.bQh.visible=!1,this.tTit.visible=!0,this.tRname.visible=!0,this.bbuy.visible=!0,this.tSj.visible=!1,this.iycs.visible=!1;var t=this.data;if(t){this.icon.setItem(new Item(t.id,t.num));var e=GmGlobal.mc.itemMgr.getItemCfg(t.id);this.tRname.text=t.owner,this.tnum.text=t.price.toString(),this.tname.text=e.name,this.iicon.source=GmGlobal.mc.itemMgr.getItemSicon(ItemID.DIAMOND);var i=GmGlobal.mc.tradeMgr.gzIds.indexOf(t.soldid);-1==i?this.bGz.source="trade_json.trade_gz_1":this.bGz.source="trade_json.trade_gz_0",this.iycs.visible=0==t.num?!0:!1,this.bbuy.visible=0==t.num?!1:!0,this.bGz.visible=!0,t.ownerid==GmGlobal.mc.role.roleId&&(this.bbuy.visible=!1,this.bGz.visible=!1),e.type==ItemType.EQUIP&&this.icon.setItem(new Item(t.id,t.num),null,"",t.jl,t.uid)}},e}(eui.ItemRenderer);__reflect(TradeItem.prototype,"TradeItem");var TradeManager=function(){function t(){this._sjLst={},this.cfgs={},this.selTnum=10,this.selNum=0,this.gzIds=[],this.sellLst={},this.pageNum=12,this.lowPrice=0,GmGlobal.mc.regUnzipCfg("c_trade.json",this.initCfg,this),this.opCd=new GameTime(0)}return t.prototype.initCfg=function(t){this.cfgs=t},t.prototype.getTagList=function(){return this.cfgs.equipsearch},t.prototype.loadGzIds=function(){var t=egret.localStorage.getItem("trade.gz"+GmGlobal.mc.role.roleId);null!=t&&""!=t&&(this.gzIds=JSON.parse(t))},t.prototype.saveGzids=function(){egret.localStorage.setItem("trade.gz"+GmGlobal.mc.role.roleId,JSON.stringify(this.gzIds))},t.prototype.updSjLst=function(t,e){var i=e,s=[];for(var o in i){var n=new TradeData,r=i[o];n.uid=r.uid,n.id=r.id,n.num=r.num,n.lid=r.lid,n.price=r.price,n.rep=r.rep,n.et=r.et,n.owner=r.owner,n.soldid=r.soldid,n.ownerid=r.ownerid,n.jl=r.jl,s.push(n)}this._sjLst[t]=s},t.prototype.getSjLst=function(t){var e=this._sjLst[t];return e},t.prototype.getSellItems=function(){var t=[],e=this.cfgs.items;for(var i in e){var s=e[i],o=GmGlobal.mc.itemMgr.getItemCfg(s.id);if(o.type==ItemType.EQUIP)for(var n=GmGlobal.mc.itemMgr.getItemListByType([ItemType.EQUIP]),r=0;r<n.length;r++){var h=n[r];if(s.id==h.num){var a=GmGlobal.mc.equipMgr.isJlOrCard(h.id);a||t.push(h)}}else{var l=GmGlobal.mc.itemMgr.getItem(s.id);l&&t.push(l)}}return t},t.prototype.getSsId=function(t){var e=[];for(var i in this.cfgs.items){var s=this.cfgs.items[i],o=GmGlobal.mc.itemMgr.getItemCfg(s.id);o&&o.name==t&&e.push(o.id)}return e},t}();__reflect(TradeManager.prototype,"TradeManager");var TradeMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.TRADE,CmdType.O_TRADE),CmdBus.adListener(CmdType.O_TRADE,this.onOpenView,this),CmdBus.adListener(CmdType.C_TRADE,this.onCloseView,this),CmdBus.adListener(CmdType.O_TRADE_SELL,this.onOpenSView,this),CmdBus.adListener(CmdType.C_TRADE_SELL,this.onCloseSView,this),CmdBus.adListener(CmdType.O_TRADE_ZS,this.onOpenZsView,this),CmdBus.adListener(CmdType.C_TRADE_ZS,this.onCloseZsView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){GmGlobal.mc.tradeMgr.loadGzIds()},t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new TradeView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenSView=function(t){void 0===t&&(t=1),this._sellView||(this._sellView=new TradeSellView),this._sellView.isShow||(this._sellView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._sellView.setLid(t)},t.prototype.onCloseSView=function(){this._sellView&&this._sellView.isShow&&this._sellView.close()},t.prototype.onOpenZsView=function(t){void 0===t&&(t=GmGlobal.mc.role.roleId),this._zsView||(this._zsView=new TradeZsView),this._zsView.isShow||(this._zsView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._zsView.setRId(t)},t.prototype.onCloseZsView=function(){this._zsView&&this._zsView.isShow&&this._zsView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._sellView&&(this._sellView.destroy(),this._sellView=null),this._zsView&&!this._zsView.isShow&&(this._zsView.destroy(),this._zsView=null),!0):!1:!0},t}();__reflect(TradeMediator.prototype,"TradeMediator",["IMediator"]);var TradeSellView=function(t){function e(){var e=t.call(this,"TradeSellSkin")||this;return e._lid=1,e._bprice=0,e._hprice=0,e._sId=-1,e.col=5,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tprice.restrict="0-9",this.tnum.restrict="0-9"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bSj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSj,this),EventBus.addListener(EventType.M_UPD_CON,this.updLst,this),EventBus.addListener(EventType.M_TRADE_BPRICE,this.updBprice,this)},e.prototype.rmEvts=function(){this.bSj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSj,this),EventBus.rmListener(EventType.M_UPD_CON,this.updLst,this),EventBus.rmListener(EventType.M_TRADE_BPRICE,this.updBprice,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0),this.updLst(),this.iSel&&(this.iSel.visible=!1),this.srCon.visible=!1,this.tlow.visible=!1},e.prototype.setLid=function(t){this._lid=t},e.prototype.updLst=function(){for(var t=this._mc.tradeMgr.getSellItems(),e=[],i=0;i<t.length;i++){var s=t[i],o=GmGlobal.mc.equipMgr.getJlLv(s.id);e.push(o)}this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(t.length,115,!1,!1,!0),this._itemGridCon.addToParent(10,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this),this._itemGridCon.setItems(t,!1,"",e),this.iSel||(this.iSel=new eui.Image("item_json.item_k_sel"),this.iSel.touchEnabled=!1),this.itemCon.addChild(this.iSel)},e.prototype.onTouchItemGrid=function(t){if(t.index!=this._sId){this._sItem=t,this.iSel.visible=!0,this.srCon.visible=!0,this.tlow.visible=!0,this._sId=t.index;var e=Math.floor(this._sId/this.col),i=this._sId%this.col;this.iSel.x=125*i,this.iSel.y=125*e;var s=this._mc.itemMgr.getItemCfg(t.itemId);s.type==ItemType.EQUIP&&this._cc.dataCtl.doAction(ServerActionId.TRADE_SJ,[1,this._lid,t.uid,t.num]),this.updItemGrid()}},e.prototype.updItemGrid=function(){var t=new Item(this._sItem.itemId,this._sItem.num),e=this._mc.itemMgr.getItemCfg(this._sItem.itemId),i=this._mc.tradeMgr.cfgs.items[this._sItem.itemId],s=i.bPrice;this.tlow.text="Single Min Sell Price："+s;var o=this._mc.tradeMgr.cfgs.hprice[e.type].num;if(this.tprice.text=s,this.tnum.text=e.type==ItemType.EQUIP?"1":this._sItem.num.toString(),this._bprice=s,this._hprice=o,e.type==ItemType.EQUIP){var n=GmGlobal.mc.equipMgr.getJlLv(this._sItem.uid);this.icon.setItem(t,null,"",n)}else this.icon.setItem(t);this.icon.enableTip(!0)},e.prototype.updBprice=function(){var t=this._mc.tradeMgr.lowPrice;this.tlow.text="Single Min Sell Price："+t,this.tprice.text=t.toString()},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),this.iSel&&this.itemCon.removeChild(this.iSel)},e.prototype.onSj=function(){var t=Number(this.tprice.text);if(t<this._bprice)return MsgBox.prompt("Price too low,Enter again！"),void(this.tprice.text=this._bprice.toString());if(t>this._hprice)return MsgBox.prompt("Price too high,Enter again！"),void(this.tprice.text=this._hprice.toString());var e=Number(this.tnum.text);if(1>e)return MsgBox.prompt("Quantity below 1，Enter again！"),void(this.tnum.text="1");if(e>this._sItem.num)return MsgBox.prompt("Quantity owned exceeded,Enter again！"),void(this.tnum.text=this._sItem.num.toString());var i=this._mc.itemMgr.getItemCfg(this._sItem.itemId),s=this._sItem.itemId;i.type==ItemType.EQUIP&&(s=this._sItem.uid),this._cc.dataCtl.doAction(ServerActionId.TRADE_SJ,[1,this._lid,s,Number(this.tnum.text),Number(this.tprice.text)],this.onSjok,this)},e.prototype.onSjok=function(){this.iSel&&(this.iSel.visible=!1),this.srCon.visible=!1,this.tlow.visible=!1,this.close()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TRADE_SELL)},e.prototype.close=function(){this.clearItems(),this._sId=-1,this.iSel=null,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(UIBase);__reflect(TradeSellView.prototype,"TradeSellView");var TradeSItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.index=this.data.index,1==this.data.tIdx){this.bGz.visible=!1,this.tTit.visible=!1,this.tRname.visible=!1,this.bbuy.visible=!1;var t=this.data.lst,e=GmGlobal.mc.tradeMgr.opCd,i=e.cd<=0?!1:!0;if(Utils.setBtnEnable(this.bQh,!i),Utils.setBtnEnable(this.bTh,!i),t&&t.id){this.icon.setItem(new Item(t.id,t.num));var s=GmGlobal.mc.itemMgr.getItemCfg(t.id);if(this.iicon.source=GmGlobal.mc.itemMgr.getItemSicon(ItemID.DIAMOND),this.tnum.text=t.price,this.tname.text=s.name,this.iycs.visible=!1,this.setBtnState(!0),t.num||(this.iycs.visible=!0,this.setBtnState(!1)),s.type==ItemType.EQUIP){var o=GmGlobal.mc.equipMgr.getJlLv(t.uid);this.icon.setItem(new Item(t.id,t.num),null,"",o,t.uid)}}else this.icon.setItem(null),this.iycs.visible=!1,this.setBtnState(!1)}else if(2==this.data.tIdx){this.bGz.visible=!0,this.bTh.visible=!1,this.bQh.visible=!1,this.tTit.visible=!0,this.tRname.visible=!0,this.tnum.visible=!0,this.tname.visible=!0,this.tSj.visible=!1,this.iycs.visible=!1;var n=this.data.lst;if(n&&!Utils.isEmptyObj(n)){this.icon.setItem(new Item(n.id,n.num));var s=GmGlobal.mc.itemMgr.getItemCfg(n.id);this.tRname.text=n.owner||"",this.tnum.text=n.price.toString(),this.tname.text=s.name||"",this.iicon.source=GmGlobal.mc.itemMgr.getItemSicon(ItemID.DIAMOND),this.bGz.source="trade_json.trade_gz_0",this.iycs.visible=0==n.num?!0:!1,this.bbuy.visible=0==n.num?!1:!0,s.type==ItemType.EQUIP&&this.icon.setItem(new Item(n.id,n.num),null,"",n.jl,n.uid)}}},e.prototype.setBtnState=function(t){t?(this.tname.visible=!0,this.iicon.visible=!0,this.tnum.visible=!0,this.tSj.visible=!1,this.bTh.visible=!0,this.bQh.visible=!0,this.bQh.y=95,this.bQh.label="Replace"):(this.tSj.visible=!0,this.tname.visible=!1,this.iicon.visible=!1,this.tnum.visible=!1,this.bTh.visible=!1,this.bQh.visible=!0,this.bQh.y=65,this.bQh.label="Sell")},e}(eui.ItemRenderer);__reflect(TradeSItem.prototype,"TradeSItem");var TradeTagItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.txt.text=this.data.txt,this.txt.width=this.txt.textWidth<130?130:this.txt.textWidth,this.txt.textAlign="center",this.width=this.txt.width+20,this.bg.source=this.data.sel?"com_json.xq_bg_2":"com_json.xq_bg_1"},e}(eui.ItemRenderer);__reflect(TradeTagItem.prototype,"TradeTagItem");var TradeTagView=function(t){function e(){var e=t.call(this,"TradeTagSkin")||this;return e.idArgs=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TradeTagItemSkin",this.itemList.itemRenderer=TradeTagItem,this.updateList()},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bOk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.rmEvts=function(){this.bOk.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0,!0)},e.prototype.setCb=function(t,e){this._cb=t,this._cbThis=e},e.prototype.updateList=function(){var t=GmGlobal.mc.tradeMgr.getTagList(),e=0;for(var i in t)this._array.addItem({idx:e,id:Number(i),txt:t[i],sel:!1}),e++},e.prototype.onTouchList=function(t){if(t.target.data){var e=(t.target,t.target.data);e.sel=!e.sel,this._array.replaceItemAt(e,e.idx)}},e.prototype.clearSel=function(){for(var t=0;t<this._array.length;t++){var e=this._array.getItemAt(t);e.sel&&(e.sel=!1,this._array.replaceItemAt(e,t))}this.idArgs=0},e.prototype.onOk=function(){for(var t=[],e=!1,i=0,s=0;s<this._array.length;s++){var o=this._array.getItemAt(s);o.sel&&t.push(o.id)}if(t.length>0)for(var s=0;s<t.length;s++)i+=1<<t[s]-1;this.idArgs!=i&&(e=!0),this.idArgs=i,e&&this._cb&&this._cb.call(this._cbThis),this.close()},e.prototype.maskClose=function(){this.close()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._cb=null,this._cbThis=null},e}(UIBase);__reflect(TradeTagView.prototype,"TradeTagView");var TradeView=function(t){function e(){var e=t.call(this,"TradeSkin")||this;return e._totalPage=0,e._timer=0,e._tabIdx=-1,e._tabTypeIdx=-1,e._page=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.sscroll.verticalScrollBar&&(this.sscroll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TradeItemSkin",this.itemList.itemRenderer=TradeItem,this._sArray=new eui.ArrayCollection,this.sitemList.dataProvider=this._sArray,this.sitemList.itemRendererSkinName="TradeItemSkin",this.sitemList.itemRenderer=TradeSItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.tabBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTypeTab,this),this.bOpen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOpen,this),this.sitemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSLst,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLst,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bzs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bSel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSel,this),this.bClear.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClear,this),EventBus.addListener(EventType.M_TRADE_SELL,this.updSellLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.tabBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTypeTab,this),this.bOpen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOpen,this),this.sitemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSLst,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLst,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bzs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZs,this),this.bSel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSel,this),this.bClear.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClear,this),EventBus.rmListener(EventType.M_TRADE_SELL,this.updSellLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.selTab(0),this.alphaShow()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIdx)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIdx){if(-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tabIdx=t,this.bOpen.visible=1==t?!0:!1,this.tTime.visible=1==t?!0:!1,this.srCon.visible=0==t?!0:!1,this.tabTCon.visible=0==t?!0:!1,this.tabBgCon.visible=0==t?!0:!1,this.scroll.visible=0==t?!0:!1,this.sscroll.visible=0==t?!1:!0,this._page=1,this.pageTxt.text=this._page.toString(),1==this._tabIdx?this.updSellLst():2==this._tabIdx?this.updGzLst():-1==this._tabTypeIdx?this.selTypeTab(0):this.reqRefLst(),this.zsCon.visible=1==this._tabIdx?!0:!1}},e.prototype.onSelTypeTab=function(t){if(t.target.parent==this.tabBgCon){var e=this.tabBgCon.getChildIndex(t.target);if(e==this._tabTypeIdx)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTypeTab(e)}},e.prototype.selTypeTab=function(t){if(t!=this._tabTypeIdx){if(-1!=this._tabTypeIdx){var e=this.tabBgCon.getChildAt(this._tabTypeIdx);e.source="trade_json.trade_tit_1";var i=this.tabTCon.getChildAt(this._tabTypeIdx);i.textColor=10526880}var s=this.tabBgCon.getChildAt(t);s.source="trade_json.trade_tit_0";var o=this.tabTCon.getChildAt(t);o.textColor=12286258,this._tabTypeIdx=t,this._page=1,this.pageTxt.text=this._page.toString(),this.scroll.stopAnimation(),this.scroll.viewport.scrollV=0,this.reqRefLst()}},e.prototype.updSellLst=function(){var t=this._mc.tradeMgr.sellLst;this._sArray.removeAll();for(var e=0;6>e;e++){var i=t[e+1],s={tIdx:this._tabIdx,lst:i,index:e+1};this._sArray.addItem(s)}this.startTimer()},e.prototype.updGzLst=function(){this._sArray.removeAll();for(var t=this._mc.tradeMgr.gzIds,e=[],i=0;i<t.length;i++){var s=t[i],o=Math.floor(s/1e6),n=s%1e6;e.push(o,n)}var r=this;GmGlobal.cc.dataCtl.pbReq(PbReqId.TRADE_GZITEM,e,null,function(t,e){var i=0;GmGlobal.mc.tradeMgr.gzIds=[];for(var s in e){var o={tIdx:r._tabIdx,lst:e[s],index:i+1};GmGlobal.mc.tradeMgr.gzIds.push(o.lst.soldid),r._sArray.addItem(o),i++}GmGlobal.mc.tradeMgr.saveGzids()})},e.prototype.onSLst=function(t){var e=t.target.parent;if(e.parent==this.sitemList){var i=e.data,s=i.index;if("btn"==t.target.name)CmdBus.doCmd(CmdType.O_TRADE_SELL,s);else if("btn1"==t.target.name)this._cc.dataCtl.doAction(ServerActionId.TRADE_SJ,[0,s]);else if("bgz"==t.target.name){var o=this._mc.tradeMgr.gzIds,n=o.indexOf(i.lst.soldid);-1!=n&&(o.splice(n,1),this._sArray.removeItemAt(n)),GmGlobal.mc.tradeMgr.saveGzids()}else if("bbuy"==t.target.name){var r=Math.floor(i.lst.soldid/1e6),h=i.lst.soldid%1e6;this._cc.dataCtl.doAction(ServerActionId.TRADE_BUY,[r,h,i.price],this.updGzLst,this)}else if("icon"==t.target.name&&i.lst&&i.lst.id){var a=this._mc.itemMgr.getItemCfg(i.lst.id);a.type==ItemType.EQUIP&&i.lst.num?i.lst.ownerid&&i.lst.ownerid!=GmGlobal.mc.role.roleId?EquipTips.show(i.lst.uid,t.stageX,t.stageY,0,null,i.lst.ownerid):EquipTips.show(i.lst.uid,t.stageX,t.stageY):ItemTips.show(i.lst.id,t.stageX,t.stageY)}}},e.prototype.onLst=function(t){var e=t.target.parent;if(e.parent==this.itemList){var i=e.data,s=Math.floor(i.soldid/1e6),o=i.soldid%1e6;if("bgz"==t.target.name){var n=this._mc.tradeMgr.gzIds,r=n.indexOf(i.soldid);-1!=r?(n.splice(r,1),this._array.refresh()):n.length>=6?MsgBox.prompt("Item following limit exceeded"):0==i.num?MsgBox.prompt("Item sold，Can't follow"):(n.push(i.soldid),this._array.refresh()),GmGlobal.mc.tradeMgr.saveGzids()}else if("bbuy"==t.target.name)this._cc.dataCtl.doAction(ServerActionId.TRADE_BUY,[s,o,i.price],this.buyOk,this);else if("icon"==t.target.name&&i&&i.id){var h=this._mc.itemMgr.getItemCfg(i.id);h.type==ItemType.EQUIP?i.ownerid&&i.ownerid!=GmGlobal.mc.role.roleId?EquipTips.show(i.uid,t.stageX,t.stageY,0,null,i.ownerid):EquipTips.show(i.uid,t.stageX,t.stageY):ItemTips.show(i.id,t.stageX,t.stageY)}}},e.prototype.buyOk=function(){this.reqRefLst()},e.prototype.reqRefLst=function(){var t=this,e=this._tabTypeIdx+1;this._page<=1?Utils.setBtnEnable(t.bPageUp,!1):Utils.setBtnEnable(t.bPageUp,!0);var i=this.getTag();i&&1==e?GmGlobal.cc.dataCtl.pbReq(PbReqId.TRADE_TAG_REQ,[i,this._page,GmGlobal.mc.role.hefuId],null,this.onDataRet,this):GmGlobal.cc.dataCtl.pbReq(PbReqId.TRADE_RITEM,[e,0,this._page,GmGlobal.mc.role.hefuId],null,this.onDataRet,this)},e.prototype.onDataRet=function(t,e){Utils.setBtnEnable(this.bPageDown,!1);var i=0,s={};for(var o in e){if(i>=6){Utils.setBtnEnable(this.bPageDown,!0);break}s[o]=e[o],i++}var n=this._tabTypeIdx+1;this._mc.tradeMgr.updSjLst(n,s),this.updLst()},e.prototype.getTag=function(){return this._tagView&&this._tagView.idArgs?this._tagView.idArgs:0},e.prototype.updLst=function(){var t=this._mc.tradeMgr.getSjLst(this._tabTypeIdx+1);this._array.replaceAll(t)},e.prototype.startTimer=function(){var t=this._mc.tradeMgr.opCd;this._timer||(this.tTime.text="Open："+Utils.formatTime(t.cd,"DD h:m:s"),this._timer=egret.setInterval(this.onTimer,this,1e3),this.bOpen.label="Close",Utils.setBtnEnable(this.bzs,!0)),t.cd<=0&&(this.bOpen.label="Open Shop",this.tTime.text="Closed",this.clearTimer(),this._sArray.refresh(),Utils.setBtnEnable(this.bzs,!1))},e.prototype.onTimer=function(){var t=this._mc.tradeMgr.opCd;this.tTime.text="Open："+Utils.formatTime(t.cd,"DD h:m:s"),this.bOpen.label="Close",Utils.setBtnEnable(this.bzs,!0),t.cd<=0&&(this.bOpen.label="Open Shop",this.tTime.text="Closed",this.clearTimer(),this._sArray.refresh(),Utils.setBtnEnable(this.bzs,!1))},e.prototype.clearTimer=function(){this._timer&&(egret.clearInterval(this._timer),this._timer=0)},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.reqRefLst(),this.pageTxt.text=this._page.toString())},e.prototype.onPageDown=function(){this._page++,this.reqRefLst(),this.pageTxt.text=this._page.toString()},e.prototype.onZs=function(){this._cc.dataCtl.doAction(ServerActionId.TRADE_ZS,null,this.onOk,this)},e.prototype.onOk=function(){GmGlobal.cc.chatCtl.tradeZs(this._mc.role.roleId)},e.prototype.onOpen=function(){this._cc.dataCtl.doAction(ServerActionId.TRADE_OP)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.tradeMgr.cfgs.rule)},e.prototype.onSel=function(){this._tagView||(this._tagView=new TradeTagView,this._tagView.setCb(this.onFind,this)),this._tagView.isShow||this._tagView.show(GmGlobal.vmc.uiLayer)},e.prototype.onClear=function(){this._tagView&&this._tagView.clearSel(),this._page=1,this.reqRefLst(),this.pageTxt.text=this._page.toString(),Utils.setBtnEnable(this.bClear,!1)},e.prototype.onFind=function(){this._page=1,this.reqRefLst(),this.pageTxt.text=this._page.toString(),Utils.setBtnEnable(this.bClear,this._tagView.idArgs?!0:!1)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TRADE)},e.prototype.close=function(){if(-1!=this._tabIdx){var e=this.tableBgCon.getChildAt(this._tabIdx);e.source="com_json.tab_ui0"}if(this._tabIdx=-1,-1!=this._tabTypeIdx){var e=this.tabBgCon.getChildAt(this._tabTypeIdx);e.source="trade_json.trade_tit_1";var i=this.tabTCon.getChildAt(this._tabTypeIdx);i.textColor=10526880}this._tabTypeIdx=-1,this.clearTimer(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("trade_json")},e}(UIBase);__reflect(TradeView.prototype,"TradeView");var TradeZsItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bGz.visible=!1,this.bTh.visible=!1,this.bQh.visible=!1,this.tTit.visible=!0,this.tRname.visible=!0,this.bbuy.visible=!0,this.tSj.visible=!1,this.iycs.visible=!1;var t=this.data;if(t){this.icon.setItem(new Item(t.id,t.num));var e=GmGlobal.mc.itemMgr.getItemCfg(t.id);this.tRname.text=t.owner,this.tnum.text=t.price.toString(),this.tname.text=e.name,this.iicon.source=GmGlobal.mc.itemMgr.getItemSicon(ItemID.DIAMOND);GmGlobal.mc.tradeMgr.gzIds.indexOf(t.soldid);this.iycs.visible=0==t.num?!0:!1,this.bbuy.visible=0==t.num?!1:!0,t.ownerid==GmGlobal.mc.role.roleId&&(this.bbuy.visible=!1),e.type==ItemType.EQUIP&&this.icon.setItem(new Item(t.id,t.num),null,"",t.jl,t.uid)}},e}(eui.ItemRenderer);__reflect(TradeZsItem.prototype,"TradeZsItem");var TradeZsView=function(t){function e(){var e=t.call(this,"TradeZsSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TradeItemSkin",this.itemList.itemRenderer=TradeZsItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setRId=function(t){void 0===t&&(t=GmGlobal.mc.role.roleId),this._rid=t,this.reqRefLst()},e.prototype.onLst=function(t){var e=t.target.parent;
if(e.parent==this.itemList){var i=e.data,s=Math.floor(i.soldid/1e6),o=i.soldid%1e6;if("bbuy"==t.target.name)this._cc.dataCtl.doAction(ServerActionId.TRADE_BUY,[s,o,i.price],this.buyOk,this);else if("icon"==t.target.name&&i&&i.id){var n=this._mc.itemMgr.getItemCfg(i.id);n.type==ItemType.EQUIP?i.ownerid&&i.ownerid!=GmGlobal.mc.role.roleId?EquipTips.show(i.uid,t.stageX,t.stageY,0,null,i.ownerid):EquipTips.show(i.uid,t.stageX,t.stageY):ItemTips.show(i.id,t.stageX,t.stageY)}}},e.prototype.buyOk=function(){this.reqRefLst()},e.prototype.reqRefLst=function(){var t=this;GmGlobal.cc.dataCtl.pbReq(PbReqId.TRADE_ZS,[this._rid],null,function(e,i){var s=[];for(var o in i)s.push(i[o]);t._array.replaceAll(s);var n=s[0];n&&!Utils.isEmptyObj(n)?t.tname.text=n.owner+"'s Shop":t.tname.text="Shop empty"})},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.tradeMgr.cfgs.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TRADE_ZS)},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(TradeZsView.prototype,"TradeZsView");var TujianController=function(){function t(){}return t}();__reflect(TujianController.prototype,"TujianController");var TujianGzView=function(t){function e(){var e=t.call(this,"TujianGzSkin")||this;return e._hecId=-1,e._selList=[],e._selImgPool=[],e._selImg={},e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(e.ONE_PAGE_NUM,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),EventBus.addListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),EventBus.rmListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updSelItems(),this.updateLst()},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.CARD]),i=0;i<e.length;i++){var s=e[i],o=this._mc.equipMgr.getCardCfg(s.id);if(o.isUp)for(var n=0;n<s.num;n++){var r=new Item(s.id,1);t.push(r)}}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.onTouchItemGrid=function(t){var e=t.itemId+"_"+this._page+"_"+t.index;if(this._selList.length>=3&&-1==this._selList.indexOf(e))return void MsgBox.prompt("Selected 3 items，Can modify！");if(!this._selList||this._selList.length<=0)this.setItemSelState(t,!this.isSel(e));else{var i=this._selList[0].split("_"),s=Number(i[0]);t.itemId==s?this.setItemSelState(t,!this.isSel(e)):MsgBox.prompt("Different type. Can't modify")}},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]);for(var o in this._selImg){var n=this._selImg[o];n&&n.parent&&n.parent.removeChild(n)}for(var r=t;i>r;r++){var h=this._itemList[r];s.push(h);var n=this._selImg[h.id+"_"+this._page+"_"+r];n&&!n.parent&&this.selCon.addChild(n)}this._itemGridCon.setItems(s)}},e.prototype.updSelItems=function(){for(var t=0;3>t;t++){var e=this["item"+t];if(this._selList[t]){var i=this._selList[t].split("_"),s=Number(i[0]);e.setItem(new Item(s,1)),e.enableTip(!0)}else e.setItem(null),e.enableTip(!1)}if(this._selList.length>=1){Utils.setBtnEnable(this.bfj,!1),this._selList.length>=3&&Utils.setBtnEnable(this.bfj,!0);var i=this._selList[0].split("_"),s=Number(i[0]),o=this._mc.tjMgr.getGzCfg(s),n=o.xhItems;this.xhItem0.setItem(n[0],!0),this.xhItem1.setItem(n[1],!0),this.xhItem0.enableTip(!0),this.xhItem1.enableTip(!0),this.item3.setItem(new Item(o.toId,1)),this.item3.enableTip(!0)}else Utils.setBtnEnable(this.bfj,!1),this.item3.setItem(null),this.xhItem0.setItem(null),this.xhItem1.setItem(null),this.item3.enableTip(!1),this.xhItem0.enableTip(!1),this.xhItem1.enableTip(!1)},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t],s=i.itemId+"_"+this._page+"_"+i.index;this._selList.length>0&&-1!=this._selList.indexOf(s)?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}},e.prototype.setItemSelState=function(t,e){var i=t.itemId+"_"+this._page+"_"+t.index,s=this._selList.indexOf(i);if(e){var o=void 0;s>=0?o=this._selImg[i]:(this._selList.push(i),o=this.getSelImg(),o.x=t.icon.x+t.icon.width-31,o.y=t.icon.y-10,this._selImg[i]=o),o.parent||this.selCon.addChild(o)}else{if(-1==s)return;this._selList.splice(s,1);var o=this._selImg[i];o.parent&&(this.selCon.removeChild(o),this._selImgPool.push(o),delete this._selImg[i])}this.updSelItems()},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t in this._selImg){var e=this._selImg[t];e&&(e.visible=!0,this._selImgPool.push(e),delete this._selImg[t],e.parent&&this.selCon.removeChild(e))}this._selList=[]},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onFj=function(){this.bfj.touchEnabled=!1,this.showQhEft()},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("yingzijl"),this.addChild(this._eft),this._eft.x=this.item3.x+Math.floor(this.item3.width/2),this._eft.y=this.item3.y+Math.floor(this.item3.height/2)),this._eft.visible=!0,this._eft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._eft.visible=!1;for(var t=[6],e=[],i=0;i<this._selList.length;i++){var s=this._selList[i].split("_");e.push(Number(s[0]))}t=t.concat(e),this._cc.dataCtl.doAction(ServerActionId.CARD_HC,t,this.hcOk,this),this.bfj.touchEnabled=!0},e.prototype.hcOk=function(){this.clearSelList(),this.updSelItems()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.tjMgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TUJIAN_GZ),CmdBus.doCmd(CmdType.O_TUJIAN)},e.prototype.close=function(){this._eft&&(this._eft.clear(),this._eft=null),this.clearSelList(),this._page=1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(TujianGzView.prototype,"TujianGzView");var TujianItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.index=this.data.idx;var t=this.data.cfg,e=t.num,i=this.data.killNum;e>i?(this.ixx.filters=FilterUtils.disabled(),this.tatr.textColor=0):(this.ixx.filters=[],this.tatr.textColor=2844323);var s=i;s>=e&&(s=e);var o="Kills:"+s+"/"+e+"\nEnable Stats:";for(var n in t.attr){var r=GmGlobal.mc.heroMgr.getAtrName(n);o+=r+"+"+t.attr[n]}this.tatr.text=o},e}(eui.ItemRenderer);__reflect(TujianItem.prototype,"TujianItem");var TujianManager=function(){function t(){this.rule="",this.tjCfgs={},this._gzCfgs={},this.tjInfos={},GmGlobal.mc.regUnzipCfg("c_tujian.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this.rule=t.rule,this.tjCfgs=t.cfgs,this._gzCfgs=t.gzCfgs,this._rhCfgs=t.fuseCfgs},t.prototype.getTjCfg=function(t){return this.tjCfgs[t]},t.prototype.getKillNum=function(t){return this.tjInfos[t]||0},t.prototype.getGzCfg=function(t){return this._gzCfgs[t]},t.prototype.getRhCfg=function(t){return this._rhCfgs[t]},t}();__reflect(TujianManager.prototype,"TujianManager");var TujianMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.TUJIAN,CmdType.O_TUJIAN),CmdBus.adListener(CmdType.O_TUJIAN,this.onOpenView,this),CmdBus.adListener(CmdType.C_TUJIAN,this.onCloseView,this),CmdBus.adListener(CmdType.O_TUJIAN_GZ,this.onOpenSView,this),CmdBus.adListener(CmdType.C_TUJIAN_GZ,this.onCloseSView,this),CmdBus.adListener(CmdType.O_TUJIAN_RH,this.onOpenRhView,this),CmdBus.adListener(CmdType.C_TUJIAN_RH,this.onCloseRhView,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this)},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new TujianView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.onOpenSView=function(t){void 0===t&&(t=1),this._gzView||(this._gzView=new TujianGzView),this._gzView.isShow||(this._gzView.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseSView=function(){this._gzView&&this._gzView.isShow&&this._gzView.close()},t.prototype.onOpenRhView=function(){this._rhView||(this._rhView=new TujianRhView),this._rhView.isShow||this._rhView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseRhView=function(){this._rhView&&this._rhView.isShow&&this._rhView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._gzView&&!this._gzView.isShow&&(this._gzView.destroy(),this._gzView=null),this._rhView&&!this._rhView.isShow&&(this._rhView.destroy(),this._rhView=null),!0):!1:!0},t}();__reflect(TujianMediator.prototype,"TujianMediator",["IMediator"]);var TujianRhView=function(t){function e(){var e=t.call(this,"TujianGzSkin")||this;return e._hecId=-1,e._selList=[],e._selImgPool=[],e._selImg={},e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tTit.text="Fuse Card",this.bfj.label="Fuse",this.bClose.sound="ui_guanbi",this.bRule.sound=null,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(e.ONE_PAGE_NUM,115,!1,!1,!0),this._itemGridCon.addToParent(15,10,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),EventBus.addListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFj,this),EventBus.rmListener(EventType.M_UPD_CON,this.updateLst,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updSelItems(),this.updateLst()},e.prototype.getEqpLst=function(){for(var t=[],e=GmGlobal.mc.itemMgr.getItemListByType([ItemType.CARD]),i=0;i<e.length;i++){var s=e[i],o=this._mc.equipMgr.getCardCfg(s.id),n=this._mc.equipMgr.getCardCfg(s.id);if(1==n.type&&!o.star)for(var r=0;r<s.num;r++){var h=new Item(s.id,1);t.push(h)}}return t},e.prototype.updateLst=function(){this._itemList=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemList.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.onTouchItemGrid=function(t){var e=t.itemId+"_"+this._page+"_"+t.index;if(this._selList.length>=3&&-1==this._selList.indexOf(e))return void MsgBox.prompt("3 items selected, fuse now!");if(!this._selList||this._selList.length<=0)this.setItemSelState(t,!this.isSel(e));else{var i=t.itemId,s=this._mc.itemMgr.getItemCfg(i);this.isSameQ(s.quality)?this.isSameId(i,e)?MsgBox.prompt("Cannot fuse the same card!"):this.setItemSelState(t,!this.isSel(e)):MsgBox.prompt("Must be the same rarity!")}},e.prototype.isSameQ=function(t){for(var e=0;e<this._selList.length;e++){var i=this._selList[e].split("_"),s=Number(i[0]),o=this._mc.itemMgr.getItemCfg(s);if(t!=o.quality)return!1}return!0},e.prototype.isSameId=function(t,e){if(1==this._selList.length||this.isSel(e))return!1;for(var i=0;i<this._selList.length;i++){var s=this._selList[i].split("_"),o=Number(s[0]);if(t!=o)return!1}return!0},e.prototype.isSel=function(t){return-1==this._selList.indexOf(t)?!1:!0},e.prototype.updateGrids=function(){if(this._itemList){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemList.length&&(i=this._itemList.length);var s=(GmGlobal.mc.itemMgr.getContainer(),[]);for(var o in this._selImg){var n=this._selImg[o];n&&n.parent&&n.parent.removeChild(n)}for(var r=t;i>r;r++){var h=this._itemList[r];s.push(h);var n=this._selImg[h.id+"_"+this._page+"_"+r];n&&!n.parent&&this.selCon.addChild(n)}this._itemGridCon.setItems(s)}},e.prototype.updSelItems=function(){for(var t=0;3>t;t++){var e=this["item"+t];if(this._selList[t]){var i=this._selList[t].split("_"),s=Number(i[0]);e.setItem(new Item(s,1)),e.enableTip(!0)}else e.setItem(null),e.enableTip(!1)}if(this._selList.length>=1){Utils.setBtnEnable(this.bfj,!1),this._selList.length>=3&&Utils.setBtnEnable(this.bfj,!0);var i=this._selList[0].split("_"),s=Number(i[0]),o=this._mc.itemMgr.getItemCfg(s),n=this._mc.tjMgr.getRhCfg(o.quality);this.xhItem0.setItem(n.xhItems[0],!0),this.xhItem1.setItem(n.xhItems[1],!0),this.xhItem0.enableTip(!0),this.xhItem1.enableTip(!0)}else Utils.setBtnEnable(this.bfj,!1),this.item3.setItem(null),this.xhItem0.setItem(null),this.xhItem1.setItem(null),this.item3.enableTip(!1),this.xhItem0.enableTip(!1),this.xhItem1.enableTip(!1)},e.prototype.updateItemSelState=function(){for(var t=0,e=this._itemGridCon.grids;t<e.length;t++){var i=e[t],s=i.itemId+"_"+this._page+"_"+i.index;this._selList.length>0&&-1!=this._selList.indexOf(s)?this.setItemSelState(i,!0):this.setItemSelState(i,!1)}},e.prototype.setItemSelState=function(t,e){var i=t.itemId+"_"+this._page+"_"+t.index,s=this._selList.indexOf(i);if(e){var o=void 0;s>=0?o=this._selImg[i]:(this._selList.push(i),o=this.getSelImg(),o.x=t.icon.x+t.icon.width-31,o.y=t.icon.y-10,this._selImg[i]=o),o.parent||this.selCon.addChild(o)}else{if(-1==s)return;this._selList.splice(s,1);var o=this._selImg[i];o.parent&&(this.selCon.removeChild(o),this._selImgPool.push(o),delete this._selImg[i])}this.updSelItems()},e.prototype.getSelImg=function(){var t=this._selImgPool.pop();return t||(t=new eui.Image("com_json.gx_0")),t},e.prototype.clearSelList=function(){for(var t in this._selImg){var e=this._selImg[t];e&&(e.visible=!0,this._selImgPool.push(e),delete this._selImg[t],e.parent&&this.selCon.removeChild(e))}this._selList=[]},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onFj=function(){this.bfj.touchEnabled=!1,this.showQhEft()},e.prototype.showQhEft=function(){this._eft||(this._eft=new MovieClipEx("yingzijl"),this.addChild(this._eft),this._eft.x=this.item3.x+Math.floor(this.item3.width/2),this._eft.y=this.item3.y+Math.floor(this.item3.height/2)),this._eft.visible=!0,this._eft.play(1,this.qhOk,this)},e.prototype.qhOk=function(){this._eft.visible=!1;for(var t=[8],e=[],i=0;i<this._selList.length;i++){var s=this._selList[i].split("_");e.push(Number(s[0]))}t=t.concat(e),this._cc.dataCtl.doAction(ServerActionId.CARD_HC,t,this.hcOk,this),this.bfj.touchEnabled=!0},e.prototype.hcOk=function(){this.clearSelList(),this.updSelItems()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.tjMgr.rule)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TUJIAN_RH),CmdBus.doCmd(CmdType.O_TUJIAN)},e.prototype.close=function(){this._eft&&(this._eft.clear(),this._eft=null),this.clearSelList(),this._page=1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(TujianRhView.prototype,"TujianRhView");var TujianView=function(t){function e(){var e=t.call(this,"TujianSkin")||this;return e._page=1,e._maxPage=1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="TujianItemSkin",this.itemList.itemRenderer=TujianItem,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByNum(20,115,!1,!1,!0),this._itemGridCon.addToParent(15,5,this.itemCon),this._itemGridCon.setTouchCb(!1,this.onTouchItemGrid,this)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bfj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGz,this),this.bfind.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFind,this),this.bPageUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRh,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bfj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGz,this),this.bfind.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFind,this),this.bPageUp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageUp,this),this.bPageDown.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPageDown,this),this.bRh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRh,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateLst();var i=this._itemLst[0];if(i.id){var s=this.getGridById(i.id);this.selGrid(s)}else this._sid=-1;this.updPanel(),this.alphaShow()},e.prototype.getEqpLst=function(){var t=[],e=GmGlobal.mc.tjMgr.tjCfgs;for(var i in e){for(var s=e[i],o=new Item(s.cid,0),n=this._mc.itemMgr.getItemCfg(o.id),r=0;r<t.length;r++){var h=t[r],a=this._mc.itemMgr.getItemCfg(h.id);if(n.quality<a.quality)break}t.splice(r,0,o)}return t},e.prototype.updateLst=function(){this._itemLst=this.getEqpLst(),this._maxPage=Math.max(Math.ceil(this._itemLst.length/e.ONE_PAGE_NUM),1),this._page>this._maxPage&&(this._page=this._maxPage),this.updateGrids(),this.updateItemSelState(),this.updatePage()},e.prototype.updateGrids=function(){if(this._itemLst){var t=(this._page-1)*e.ONE_PAGE_NUM,i=t+e.ONE_PAGE_NUM;i>=this._itemLst.length&&(i=this._itemLst.length);for(var s=[],o=t;i>o;o++){var n=this._itemLst[o];s.push(n)}this._itemGridCon.setItems(s)}},e.prototype.onTouchItemGrid=function(t){this._sid!=t.itemId&&this.selGrid(t)},e.prototype.selGrid=function(t){this._sid=t.itemId,this.isel.x=t.icon.x+this.itemCon.x-10,this.isel.y=t.icon.y+this.itemCon.y-5,this.isel.visible=!0,this.updPanel()},e.prototype.updOneInfo=function(t){var e,i=GmGlobal.mc.tjMgr;for(var s in t)i.tjInfos[s]=t[s].knum,e=Number(s);var o=this._mc.tjMgr.getTjCfg(this._sid);if(e==o.bossid)for(var n=o.killcfg,r=0;r<n.length;r++){var h=n[r],a=this._array.getItemAt(r),l=this._mc.tjMgr.getKillNum(o.bossid),c={cfg:h,killNum:l,idx:r+1};a?this._array.replaceItemAt(c,r):this._array.addItem(c)}},e.prototype.updPanel=function(){if(-1==this._sid)this.tname.text="No relevant card index yet",this.tXt.visible=!1,Utils.setBtnEnable(this.bfj,!1),this.txg.text="",this.scroll.visible=!1,this.clearModel();else{Utils.setBtnEnable(this.bfj,!0),this.scroll.visible=!0;var t=this._mc.tjMgr.getTjCfg(this._sid),e=this._mc.npcMgr.getNpcCfg(t.bossid),i=this._mc.equipMgr.getCardCfg(this._sid),s=GmConst.EQP_NAME[i.eid-1];this.txg.text="Card Effect:("+s+")\n"+i.txt;for(var o=t.killcfg,n=0;n<o.length;n++){var r=o[n],h=this._array.getItemAt(n),a=this._mc.tjMgr.getKillNum(t.bossid),l={cfg:r,killNum:a,idx:n+1};h?this._array.replaceItemAt(l,n):this._array.addItem(l)}if(o.length<this._array.length)for(var n=o.length;n<this._array.length;n++)this._array.removeItemAt(n);e&&(this.tname.text=e.name,this.tXt.visible=!0,this.tXt.text=this._mc.npcMgr.getWx(e.eleattrid)+" "+this._mc.npcMgr.getTx(e.shapeattrid)+" "+this._mc.npcMgr.getLeixi(e.raceattrid),this._petModel?this._petModel.setInfo(Utils.getLocalUID(),e.res,e.h,e.scale||1,ActionType.STAND_TO):(this._petModel=UnitViewCreator.instence().createMonsterUIModel(t.bossid),this.addChildAt(this._petModel,this.getChildIndex(this.tname)),this._petModel.x=this.imBg.x,this._petModel.y=this.imBg.y,this._petModel.scaleX=1.5,this._petModel.scaleY=1.5)),GmGlobal.cc.dataCtl.reqJsonData(JsonReqId.TUJIAN_KILLNUM,[t.bossid],this.updOneInfo,this)}},e.prototype.clearModel=function(){UnitViewCreator.instence().releaseUIModel(this._petModel),this._petModel=null},e.prototype.getGridById=function(t){for(var e=0,i=this._itemGridCon.grids;e<i.length;e++){var s=i[e];if(t==s.itemId)return s}},e.prototype.updateItemSelState=function(){if(this._sid){var t=this.getGridById(this._sid);t?this.isel.visible=!0:this.isel.visible=!1}else this.isel.visible=!1},e.prototype.onPageUp=function(){1!=this._page&&(this._page--,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.onPageDown=function(){this._page!=this._maxPage&&(this._page++,this.updatePage(),this.updateGrids(),this.updateItemSelState())},e.prototype.updatePage=function(){this.pageTxt.text=this._page+"/"+this._maxPage},e.prototype.onFind=function(){if(this._sid&&-1!=this._sid){var t=this._mc.tjMgr.getTjCfg(this._sid),e=GmGlobal.mc.npcMgr.getNpcCfg(t.bossid),i=this._mc.mapMgr.getMapCfg(e.mapid);if(this._mc.role.lv<i.lv)return void MsgBox.prompt("LV too low，Can't enter this map");var s=GmGlobal.mc.sceneMgr;if(s.mapType==SceneType.FUBEN)return void MsgBox.prompt(GmGlobal.mc.txtMgr.getRetCode(8));s.mapId!=e.mapid?(s.lockType=t.bossid,s.fx=e.x,s.fy=e.y,GmGlobal.cc.sceneCtl.reqWildScne(e.mapid)):GmGlobal.vmc.scene.currenScene.lockUnitType(t.bossid,e.x,e.y),this.onClose()}},e.prototype.onGz=function(){CmdBus.doCmd(CmdType.O_TUJIAN_GZ),this.onClose()},e.prototype.onRh=function(){CmdBus.doCmd(CmdType.O_TUJIAN_RH),this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_TUJIAN)},e.prototype.close=function(){this._sid=-1,this._page=1,this.clearModel(),t.prototype.close.call(this)},e.prototype.destroy=function(){RES.destroyRes("tujian_bg_png"),t.prototype.destroy.call(this)},e.ONE_PAGE_NUM=20,e}(UIBase);__reflect(TujianView.prototype,"TujianView");var UserAgreementTxtItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.txt.text=this.data,this.height=this.txt.height},e}(eui.ItemRenderer);__reflect(UserAgreementTxtItem.prototype,"UserAgreementTxtItem");var UserAgreementTxtView=function(t){function e(){return t.call(this,"AgreementTxtSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRenderer=UserAgreementTxtItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.tyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTy,this),this.btyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBTy,this)},e.prototype.rmEvts=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.tyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTy,this),this.btyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBTy,this)},e.prototype.loadFile=function(t,e,i,s){this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0,this.tTit.text=e,this._cb=i,this._thisObj=s,this._cb?(this.tyBtn.visible=!0,this.btyBtn.visible=!0,this.okBtn.visible=!1):(this.tyBtn.visible=!1,this.btyBtn.visible=!1,this.okBtn.visible=!0),RES.getResByUrl(t,this.onLoaded,this,RES.ResourceItem.TYPE_TEXT)},e.prototype.onLoaded=function(t){for(var e=t.split("\r\n"),i=0,s=e;i<s.length;i++){var o=s[i];this._array.addItem(o)}},e.prototype.onTy=function(){this._cb&&this._cb.call(this._thisObj,!0),this.close()},e.prototype.onBTy=function(){this._cb&&this._cb.call(this._thisObj,!1),this.close()},e.prototype.close=function(){this._cb=null,this._thisObj=null,this._array.removeAll(),t.prototype.close.call(this)},e}(UIBase);__reflect(UserAgreementTxtView.prototype,"UserAgreementTxtView");var UserAgreemnetView=function(t){function e(){var e=t.call(this,"UserAgreemnetViewSkin")||this;return e._isSel=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){if(PFConst.SHOW_AGREEMENT){var t=[];t.push({text:"I've read and agreed to the terms",style:{textColor:16777215}}),PFConst.AGREEMENT_YH_FILE&&(t.push({text:"User Agreement",style:{href:"event:yh",underline:!0,textColor:2408946}}),t.push({text:"&",style:{textColor:16777215}})),t.push({text:"Privacy Policy",style:{href:"event:ys",underline:!0,textColor:2408946}}),this.txt.textFlow=t}else this.yhsm.visible=!1,this._isSel=!0;PFConst.AGE_ICON&&PFConst.AGE_FILE?(this.ageTip.visible=!0,this.ageTip.source=PFConst.AGE_ICON,this.ageTip.y=-500):this.ageTip.visible=!1},e.prototype.updatePos=function(){this.y=GmGlobal.stageHeight-this.height-160,this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.addEvts=function(){this.txt.addEventListener(egret.TextEvent.LINK,this.onTouchText,this),this.selBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDSel,this),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.ageTip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgeTip,this)},e.prototype.rmEvts=function(){this.txt.removeEventListener(egret.TextEvent.LINK,this.onTouchText,this),this.selBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDSel,this),this.enterBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.ageTip.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgeTip,this)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=Number(egret.localStorage.getItem("isshowua"));PFConst.SHOW_USERAGR&&!i?(this._isSel=!1,PFConst.FORCE_SHOW_UA&&this.showYsTxt()):this._isSel=!0,this.updateDoubleState()},e.prototype.updateDoubleState=function(){this.selBtn.source=this._isSel?"com_json.sel_1":"com_json.sel_0",Utils.setBtnEnable(this.enterBtn,this._isSel)},e.prototype.onDSel=function(){this._isSel=!this._isSel,this.updateDoubleState()},e.prototype.onTouchText=function(t){var e=t.text;if("ys"==e)this.showYsTxt();else if("yh"==e){var i=PFConst.AGREEMENT_YH_FILE?"agreement/"+PFConst.AGREEMENT_YH_FILE:"agreement/yh.txt";this.showTxt(i,"User Agreement")}},e.prototype.showYsTxt=function(){var t=PFConst.AGREEMENT_YS_FILE?"agreement/"+PFConst.AGREEMENT_YS_FILE:"agreement/ys.txt";PFConst.AGREEMENT_YH_FILE?this.showTxt(t,"Privacy Policy"):this.showTxt(t,"Privacy Policy",this.onTyState,this)},e.prototype.onAgeTip=function(){this.showTxt("agreement/"+PFConst.AGE_FILE,"Age Restriction")},e.prototype.showTxt=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null),this._txtView||(this._txtView=new UserAgreementTxtView),this._txtView.show(GmGlobal.vmc.uiLayer,!0),this._txtView.loadFile(t,e,i,s)},e.prototype.onTyState=function(t){this._isSel=t,this.updateDoubleState()},e.prototype.onStart=function(){egret.localStorage.setItem("isshowua","1"),this._cb&&this._thisObj&&this._cb.call(this._thisObj)},e.prototype.setCb=function(t,e){this._cb=t,this._thisObj=e},e.prototype.close=function(){this._cb=null,this._thisObj=null,t.prototype.close.call(this)},e}(UIBase);__reflect(UserAgreemnetView.prototype,"UserAgreemnetView");var VipCardItam=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GmGlobal.mc.itemMgr;this.iconK.source=t.getItemIconK(this.data.item),this.icon.source=t.getItemIcon(this.data.item),this.numTxt.text=this.data.num,this.d.text="Day "+this.data.d,0==this.data.state?(this.ylq.visible=!0,this.ylq.source="com_json.flg_klq"):2==this.data.state?(this.ylq.visible=!0,this.ylq.source="com_json.flg_ylq"):this.ylq.visible=!1},e}(eui.ItemRenderer);__reflect(VipCardItam.prototype,"VipCardItam");var VipController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_VIP,this.onUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.MONTH_CARD,this.onMonth,this),EventBus.addListener(EventType.M_JUPD+JsonID.WEEK_CARD,this.onWeek,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.vipMgr;i.state=e.state,i.f=e.f,this.updateRedDot(),EventBus.dispatchEvt(EventType.M_VIP)},t.prototype.onMonth=function(t){var e=t.data.data,i=GmGlobal.mc.vipMgr,s=i.redDot.childs[1];e.time&&!e.state?s.state=1:s.state=0,EventBus.dispatchEvt(EventType.M_MONTH)},t.prototype.onWeek=function(t){var e=t.data.data,i=GmGlobal.mc.vipMgr,s=i.redDot.childs[2];e.time&&!e.state?s.state=1:s.state=0,EventBus.dispatchEvt(EventType.M_WEEK)},t.prototype.updateRedDot=function(){var t=GmGlobal.mc.vipMgr,e=t.state,i=t.redDot.childs[0];i.state=1==e?1:0},t}();__reflect(VipController.prototype,"VipController");var VipManager=function(){function t(){this.cfgs={},GmGlobal.mc.regUnzipCfg("c_vip.json",this.initCfg,this),GmGlobal.mc.regUnzipCfg("c_monthcard.json",this.initMonthCfg,this),GmGlobal.mc.regUnzipCfg("c_weekcard.json",this.initWeekCfg,this);var t={0:0,1:0,2:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.VIP,this.redDot)}return t.prototype.initCfg=function(t){this.cfgs=t},t.prototype.initMonthCfg=function(t){this.monthCfg=t},t.prototype.initWeekCfg=function(t){this.weekCfg=t},t}();__reflect(VipManager.prototype,"VipManager");var VipMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.VIP,CmdType.O_VIP),CmdBus.adListener(CmdType.O_VIP,this.onOpenView,this),CmdBus.adListener(CmdType.C_VIP,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new VipView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(0)
},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(VipMediator.prototype,"VipMediator",["IMediator"]);var VipView=function(t){function e(){var e=t.call(this,"VipSkin")||this;return e._tabIndex=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.msscoll.verticalScrollBar&&(this.msscoll.verticalScrollBar.autoVisibility=!1),this.msscoll.horizontalScrollBar&&(this.msscoll.horizontalScrollBar.autoVisibility=!1),this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="VipCardItemSkin",this.itemList.itemRenderer=VipCardItam},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.addListener(EventType.M_VIP,this.updui,this),EventBus.addListener(EventType.M_MONTH,this.updMonthCard,this),EventBus.addListener(EventType.M_WEEK,this.updWeekCard,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.rmListener(EventType.M_VIP,this.updui,this),EventBus.rmListener(EventType.M_MONTH,this.updMonthCard,this),EventBus.rmListener(EventType.M_WEEK,this.updWeekCard,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.updateTabRedDot(),this.bindRedDotCb()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;3>t;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){this.msscoll.stopAnimation(),this.msscoll.viewport.scrollV=0,0==this._tabIndex?this.updui():1==this._tabIndex?this.updMonthCard():2==this._tabIndex&&this.updWeekCard()},e.prototype.updui=function(){if(0==this._tabIndex){var t=this._mc.vipMgr.cfgs,e=this._mc.role.careerId,i=this._mc.heroMgr.getHeroCfg(e),s=this._mc.vipMgr.state,o=this._mc.vipMgr.f;if(this.tMs.text=this._mc.vipMgr.cfgs.rule,this.bg.source="vip_bg_jpg",this.tDay.visible=!1,this.msscoll.visible=!0,this.bRule.visible=!1,this.scoll.visible=!1,this.clearItem(),1!=s&&0!=s||o){var n=[];if(t.cItem){var r=t.cItem[i.career];r&&n.push(r)}n=n.concat(t.items),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(n,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0))}else this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t.otherItems,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0));this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,1==s?(Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="Claimable"):0==s?(Utils.setBtnEnable(this.okBtn,!1),this.okBtn.label="Claimed"):(Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="$"+t.price)}},e.prototype.updMonthCard=function(){if(1==this._tabIndex){var t=this._mc.vipMgr.monthCfg,e=this._mc.dataMgr.getJData(JsonID.MONTH_CARD).data;this.tMs.text=t.rule,this.bg.source="yk_bg_jpg",this.tDay.visible=!0;var i=0,s=-1;e.time&&(i=e.ad||0,s=e.state||0,2==s&&(i-=1)),this.msscoll.visible=!1,this.bRule.visible=!0,this.scoll.visible=!0,this.clearItem(),this.scoll.stopAnimation(),this._array.removeAll(),this.scoll.y=390,this.scoll.height=450;for(var o in t.day){var n=Number(o)-1,r=t.day[o],h={item:r.items[0].id,num:r.items[0].num,d:n+1,state:-1};i>n?h.state=2:n==i?h.state=s:h.state=-1,this._array.addItem(h)}var a=Math.ceil((i+1)/5),l=0;a>1&&(l=130*(a-1));var c=Math.ceil(this._array.length/5),d=130*c-10;if(l+this.scoll.height>d&&(l=d-this.scoll.height),this.validateNow(),this.scoll.viewport.scrollV=l,this.validateNow(),0==s?(Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="Claimable"):2==s?(Utils.setBtnEnable(this.okBtn,!1),this.okBtn.label="Claimed"):(Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="$"+t.price),-1!=s){var p=e.time-GmGlobal.getServerTime(),n=Math.ceil(p/86400);this.tDay.text=n+" day(s) left"}else this.tDay.text="";this._state=s,this._price=t.price}},e.prototype.updWeekCard=function(){if(2==this._tabIndex){var t=this._mc.vipMgr.weekCfg,e=this._mc.dataMgr.getJData(JsonID.WEEK_CARD).data;this.tMs.text=t.rule,this.bg.source="zk_bg_jpg",this.tDay.visible=!0;var i=0,s=-1;e.time&&(i=e.ad||0,s=e.state||0,2==s&&(i-=1));var o=null;t.day[i+1]&&(o=t.day[i+1].items),this.msscoll.visible=!0,this.bRule.visible=!1,this.scoll.visible=!0,this.clearItem(),this.scoll.stopAnimation(),this._array.removeAll(),this.scoll.viewport.scrollV=0,this.scoll.y=539,this.scoll.height=290;for(var n in t.day){var r=Number(n)-1,h=t.day[n],a={item:h.items[0].id,num:h.items[0].num,d:r+1,state:-1};i>r?a.state=2:r==i?a.state=s:a.state=-1,this._array.addItem(a)}if(0==s?(Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="Claimable"):2==s?(Utils.setBtnEnable(this.okBtn,!1),this.okBtn.label="Claimed"):(Utils.setBtnEnable(this.okBtn,!0),this.okBtn.label="$"+t.price),-1!=s){var l=e.time-GmGlobal.getServerTime(),r=Math.ceil(l/86400);this.tDay.text=r+" day(s) left"}else this.tDay.text="";this._state=s,this._price=t.price}},e.prototype.onOkBtn=function(){if(0==this._tabIndex){var t=this._mc.vipMgr.state;1==t?this._cc.dataCtl.doAction(ServerActionId.VIP_GET):this._cc.pfCtl.Pay(100*this._mc.vipMgr.cfgs.price,4)}else 1==this._tabIndex?0==this._state?this._cc.dataCtl.doAction(ServerActionId.MONTH_CARD_AW):this._cc.pfCtl.Pay(100*this._price,18):2==this._tabIndex&&(0==this._state?this._cc.dataCtl.doAction(ServerActionId.WEEK_CARD_AW):this._cc.pfCtl.Pay(100*this._price,19))},e.prototype.onList=function(t){t.target.data&&t.target.data.item&&ItemTips.show(t.target.data.item,t.stageX,t.stageY)},e.prototype.onRule=function(){var t=this._mc.vipMgr.monthCfg;CmdBus.doCmd(CmdType.O_RULE,t.rule)},e.prototype.clearItem=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.updateTabRedDot=function(){for(var t=GmGlobal.mc.vipMgr.redDot,e=0,i=0;3>i;i++){var s=this.tableBgCon.getChildAt(i),o=t.childs[i];e+=0==i?110:170,1==o.state?RedDotView.addRedDot(s,this.tableBgCon,"vip_crad",e-20,-4):RedDotView.removeRedDot(s)}},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.vipMgr.redDot,e=0;3>e;e++){var i=t.childs[e];i.bindChangeCB(this.updateTabRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.vipMgr.redDot,e=0;3>e;e++){var i=t.childs[e];i.unbindChangeCB(this.updateTabRedDot,this)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_VIP)},e.prototype.close=function(){RedDotView.removeRedDotByGroup("vip_crad"),this.unbindRedDotCb(),this._tabIndex=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){this.clearItem(),t.prototype.destroy.call(this),RES.destroyRes("vip_bg_jpg")},e}(UIBase);__reflect(VipView.prototype,"VipView");var Vip1Controller=function(){function t(){this.preLv=-1,EventBus.addListener(EventType.M_JUPD+JsonID.U_VIP1,this.onUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.vip1Mgr;-1!=this.preLv&&e.l>this.preLv&&GmGlobal.cc.pfCtl.pfReport(PfReportType.VIP_UP),i.info=e,this.preLv=e.l,this.updateRedDot(),EventBus.dispatchEvt(EventType.M_VIP1)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.vip1Mgr,e=t.redDot,i=t.getCurVip(),s=0;s<t.vipCfgs.length;s++){var o=t.vipCfgs[s],n=o.shqId,r=0;i-1>=s&&i>0&&(r=t.isShqJh(n)?0:1),this.setItemRD(e,s,r)}},t.prototype.setItemRD=function(t,e,i){var s;t.childs&&(s=t.childs[e]),s||(s=new RedDot(e.toString(),t)),s.state=i},t}();__reflect(Vip1Controller.prototype,"Vip1Controller");var Vip1Manager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_vip1.json",this.initCfg,this),this.redDot=RedDot.initRedDot(null),GmGlobal.mc.muiMgr.regRedDot(ModelID.VIP1,this.redDot)}return t.prototype.initCfg=function(t){this.vipCfgs=t.vip,this._shqCfgs=t.shqCfgs,this._tqCfgs=t.tqCfgs},t.prototype.getCurVip=function(){var t=0;return this.info&&(t=this.info.l||0),t},t.prototype.getCurExp=function(){var t=0;return this.info&&(t=this.info.e||0),t},t.prototype.getTqValue=function(t){for(var e=this.info?this.info.l||0:0,i=e-1;i>=0;i--)for(var s=this.vipCfgs[i],o=0,n=s.tqId;o<n.length;o++){var r=n[o];if(r.id==t)return r.num}return 0},t.prototype.isShqJh=function(t){var e=!1;if(this.info&&this.info.vlst)for(var i in this.info.vlst)if(t==Number(i)){e=!0;break}return e},t.prototype.getShqCfg=function(t){return this._shqCfgs[t]},t.prototype.getTqCfg=function(t){return this._tqCfgs[t]},t}();__reflect(Vip1Manager.prototype,"Vip1Manager");var Vip1Mediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.VIP1,CmdType.O_VIP1),CmdBus.adListener(CmdType.O_VIP1,this.onOpenView,this),CmdBus.adListener(CmdType.C_VIP1,this.onCloseView,this)}return t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t){void 0===t&&(t=0),this._tIdx=t,this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new Vip1View),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._tIdx)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(Vip1Mediator.prototype,"Vip1Mediator",["IMediator"]);var Vip1View=function(t){function e(){var e=t.call(this,"Vip1Skin")||this;return e._tIdx=-1,e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this),this.bjh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJh,this),this.ttq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTq,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.addListener(EventType.M_VIP1,this.updVip,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bPay.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPay,this),this.bjh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJh,this),this.ttq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTq,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),EventBus.rmListener(EventType.M_VIP1,this.updVip,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);for(var i=0;13>i;i++){var s=this.rdCon.getChildAt(i);s.visible=!1}this.scoll.viewport.scrollH=0,this.alphaShow()},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tIdx)return;GmGlobal.sound.playSoundEffect("ui_fenye"),this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tIdx){if(-1!=this._tIdx){var e=this.tableBgCon.getChildAt(this._tIdx);e.source="com_json.tab_ui0"}var i=this.tableBgCon.getChildAt(t);i.source="com_json.tab_ui1",this._tIdx=t,this.updVip()}},e.prototype.updVip=function(){var t=this._mc.vip1Mgr.getCurVip();this.tvip.text="VIP"+t;var e=this._mc.vip1Mgr.getCurExp(),i=this._mc.vip1Mgr.vipCfgs[t];i||(i=this._mc.vip1Mgr.vipCfgs[t-1]),this.barTlv.text=e+"/"+i.pay,this.barLv.maximum=i.pay,this.barLv.value=e;var s=(i.pay-e).toFixed(2);this.tms.textFlow=TextFormat.parser.parser("Recharge "+TextFormat.setColor("$"+s.toString(),16503902)+" more to reach "+TextFormat.setColor("VIP"+(t+1),16503902)),t==this._mc.vip1Mgr.vipCfgs.length&&(this.tms.text="Max LV reached"),this.updUi()},e.prototype.updUi=function(){var t=this._tIdx+1,e=this._mc.vip1Mgr.vipCfgs[this._tIdx],i=e.shqId;this.tviplb.text="VIP"+t+" Pack",this.clearItem(),this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(e.awd,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign="center");var s=this._mc.vip1Mgr.getCurVip();if(s>=t){this.iylq.visible=!0;var o=this._mc.vip1Mgr.isShqJh(i);o?(this.bjh.visible=!1,this.iyld.visible=!0):(this.bjh.visible=!0,this.iyld.visible=!1,Utils.setBtnEnable(this.bjh,!0),this.bjh.label="Enable")}else this.iylq.visible=!1,Utils.setBtnEnable(this.bjh,!1),this.bjh.label="Disabled",this.bjh.visible=!0,this.iyld.visible=!1;var n=this._mc.vip1Mgr.getShqCfg(i);this.tname.text=n.name;var r=n.atr,h=0;for(var a in r){var l=this["tAtrNum"+h],c=GmGlobal.mc.heroMgr.getAtrName(a)+":";c=TextFormat.setColor(c,1973019);var d=GmGlobal.mc.heroMgr.isAddJia(a),p=GmGlobal.mc.heroMgr.isNdPre(a);d&&(c+=" +"),c+=r[a],p&&(c+="%"),l.textFlow=TextFormat.parser.parser(c),h++}this._shqMc&&this.clearEft(),this._eftId=n.icon,GmGlobal.res.getMovieClipData(GmConst.EFFECT_DIR,this._eftId,this.addEft,this),this.updateRedDot()},e.prototype.addEft=function(t){this._shqMc||(this._shqMc=new egret.MovieClip(t.generateMovieClipData(this._eftId)),this.eftCon.addChild(this._shqMc),this._shqMc.x=this.eftCon.width/2,this._shqMc.y=this.eftCon.height/2),this.showEft()},e.prototype.showEft=function(){this._shqMc&&(this._shqMc.visible=!0,this._shqMc.gotoAndPlay(this._eftId,-1))},e.prototype.clearEft=function(){GmGlobal.res.releaseMCData(this._eftId,!0,this.addEft,this),this._shqMc&&(this._shqMc.stop(),this.eftCon.removeChild(this._shqMc),this._shqMc=null)},e.prototype.updateRedDot=function(){var t=this._mc.vip1Mgr.redDot;if(t.childs)for(var e=0;13>e;e++){var i=this._mc.vip1Mgr.redDot.childs[e],s=this.rdCon.getChildAt(e);1==i.state?s.visible=!0:s.visible=!1}},e.prototype.clearItem=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onTq=function(){for(var t=this._mc.vip1Mgr.vipCfgs[this._tIdx],e=t.tqId,i="",s=0;s<e.length;s++){var o=e[s],n=this._mc.vip1Mgr.getTqCfg(o.id);i+=-1!=n.indexOf("+%x%")?n.replace("+%x%",TextFormat.setColor("+"+o.num+"%",Colors.GREEN))+"\n":-1!=n.indexOf("+%x")?n.replace("+%x",TextFormat.setColor("+"+o.num,Colors.GREEN))+"\n":n+"\n",-1!=i.indexOf("Based on High VIP")&&(i=i.replace(/Based on High VIP/g,TextFormat.setColor("Based on High VIP",Colors.RED)))}CmdBus.doCmd(CmdType.O_RULE,i)},e.prototype.onJh=function(){this._cc.dataCtl.doAction(ServerActionId.VIP1_JH,[this._tIdx+1])},e.prototype.onPay=function(){CmdBus.doCmd(CmdType.O_SHOP),this.onClose()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_VIP1)},e.prototype.close=function(){if(-1!=this._tIdx){var e=this.tableBgCon.getChildAt(this._tIdx);e.source="com_json.tab_ui0"}this._tIdx=-1,this.clearItem(),this._shqMc&&this.clearEft(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("vip1_bg_jpg")},e}(UIBase);__reflect(Vip1View.prototype,"Vip1View");var ArenaJFView=function(t){function e(){return t.call(this,"ArenaJfAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="JifenAwItemSkin",this.itemList.itemRenderer=JifenAwItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.M_JUPD+JsonID.ARENA_JFAW,this.updateAwList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.rmListener(EventType.M_JUPD+JsonID.ARENA_JFAW,this.updateAwList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.updateAwList()},e.prototype.updateAwList=function(){var t=GmGlobal.mc,e=t.itemMgr.getItemNum(ItemID.ARENA_JF);this.tJifen.text=e.toString();for(var i=t.wfMgr.getArenaJfAwList(),s=t.dataMgr.getJData(JsonID.ARENA_JFAW),o=0;o<i.length;o++){var n=i[o],r={idx:n.jf,cfg:n,state:n.jf>e?0:s.data[n.jf]>0?2:1,isLast:o==i.length-1?!0:!1};null!=this._array.getItemAt(o)?this._array.replaceItemAt(r,o):this._array.addItem(r)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data.idx;GmGlobal.cc.dataCtl.doAction(ServerActionId.ARENA_JFAW,[e])}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_ARENA_JFAW)},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(ArenaJFView.prototype,"ArenaJFView");var ArenaJsItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.cfg;this.rankImg.visible=!1,this.tRank.visible=!0,t.rankto?(this.tRank.text=t.rank+"-"+t.rankto,this.tRank.size=30):(this.tRank.size=40,t.rank<=3?(this.rankImg.source="lcom_json.rank_"+t.rank,this.rankImg.visible=!0,this.tRank.visible=!1):this.tRank.text=t.rank),this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(ArenaJsItem.prototype,"ArenaJsItem");var ArenaJsView=function(t){function e(){return t.call(this,"ArenaJsSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ArenaJsItemSkin",this.itemList.itemRenderer=ArenaJsItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.updateList();var i=GmGlobal.mc.wfMgr.getArenaJsCD();0==i?this.endTime.text="00:00:00":CDText.getInstence().addCD(this.endTime,i,"","DD h:m:s")},e.prototype.updateList=function(){for(var t=GmGlobal.mc,e=t.wfMgr.getArenaJsAwList(),i=0;i<e.length;i++){var s=e[i],o={cfg:s};null!=this._array.getItemAt(i)?this._array.replaceItemAt(o,i):this._array.addItem(o)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_ARENA_JS)},e.prototype.close=function(){this.clearItems(),CDText.getInstence().rmCD(this.endTime),t.prototype.close.call(this)},e}(UIBase);__reflect(ArenaJsView.prototype,"ArenaJsView");var ArenaZbItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.fTime.text=Utils.formatDate(Utils.getServerTime(this.data.time),"Y-M-D h:m:s"),this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+this.data.data.career+".png",1==this.data.data.type?(this.txt.text="Challenged "+this.data.data.name+" and "+(this.data.data.win?"succeeded":"Failed"),this.bFj.visible=!1,this.fjImg.visible=!1,this.txt.width=500):(this.txt.width=380,this.data.data.rev>0?this.data.data.win?(this.txt.text=this.data.data.name+" challenged you. You won and kept your ranking",this.bFj.visible=!1,this.fjImg.visible=!1):(this.txt.text=this.data.data.name+" defeated you",this.bFj.visible=!0,this.fjImg.visible=!1):this.data.data.win?(this.txt.text=this.data.data.name+" defeated you",this.bFj.visible=!1,this.fjImg.visible=!0,this.fjImg.source="com_json.flg_fjcg"):(this.txt.text=this.data.data.name+" defeated you",this.bFj.visible=!1,this.fjImg.visible=!0,this.fjImg.source="com_json.flg_fjsb"))},e}(eui.ItemRenderer);__reflect(ArenaZbItem.prototype,"ArenaZbItem");var ArenaZbView=function(t){function e(){return t.call(this,"ArenaZbSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="ArenaZbItemSkin",this.itemList.itemRenderer=ArenaZbItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.JJ_ZB_UPD,this.updateList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.JJ_ZB_UPD,this.updateList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateList(),this.scoll.viewport.scrollV=0},e.prototype.updateList=function(){var t=GmGlobal.mc;this.tJifen.text=t.itemMgr.getItemNum(ItemID.ARENA_JF).toString();var e=t.dataMgr.getJData(JsonID.ARENA_UPD),i=0;i=void 0==e.data.fjacnt?t.wfMgr.getArenaFjMax():e.data.fjacnt,this.smTxt.text="Counterattack to obtain "+t.wfMgr.getArenaFjJf()+" Points，Remaining chances:"+i;var s=t.wfMgr.zbList;if(s){var o=[];for(var n in s)o.unshift(n);for(var r=0;r<o.length&&10>r;r++){var n=(s[o[r]],Number(o[r])),h={time:Number(n),data:s[n]};null!=this._array.getItemAt(r)?this._array.replaceItemAt(h,r):this._array.addItem(h)}}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;e&&(GmGlobal.cc.dataCtl.doAction(ServerActionId.ARENA_TZ,[e.data.id,e.time]),this.onClose())}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_ARENA_ZB)},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(ArenaZbView.prototype,"ArenaZbView");var BossSceneUI=function(t){function e(){var e=t.call(this)||this;return e._cd=0,e.skinName="BossSceneUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.release=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.setCD=function(t){this._cd=t},e.prototype.show=function(e){t.prototype.show.call(this,e),CDText.getInstence().addCD(this.hdTime,this._cd,"Time Left: ","m:s")},e.prototype.close=function(){CDText.getInstence().rmCD(this.hdTime),t.prototype.close.call(this)},e._instance=null,e}(WanfaSceneUIBase);__reflect(BossSceneUI.prototype,"BossSceneUI");var CtSceneUI=function(t){function e(){var e=t.call(this)||this;return e._mid=1,e._preF=-1,e.skinName="CtSceneUISkin",e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.show=function(e){t.prototype.show.call(this,e),this._preF=-1;var i=GmGlobal.mc,s=i.dataMgr.getJData(JsonID.CT_UPD);s.data.mode[s.data.mid];this._mid=s.data.mid||1,this.onUpdate(),this.onBuff();var o=Math.floor((egret.getTimer()-i.wfMgr.ctNextMst)/1e3),n=1==this._mid?i.wfMgr.getCtCd():i.wfMgr.getCtSyCd(),r=n-o;r>0&&this.setNextTime(r),EventBus.addListener(EventType.M_JUPD+JsonID.CT_UPD,this.onUpdate,this),EventBus.addListener(EventType.CT_BUFF_UPD,this.onBuff,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.TOWER_FLOOR,this.onUpdateFloor,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.TOWER_NEXT_MST,this.updateNextTime,this)},e.prototype.onUpdate=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.CT_UPD);if(e.data.mode){var i=e.data.mode[e.data.mid],s=t.wfMgr.getCtMaxFloor(),o=i.f||1,n=Math.min(o,s);this.updateFloor(n)}},e.prototype.onUpdateFloor=function(t){t.fblv&&this.updateFloor(t.fblv)},e.prototype.updateFloor=function(t){this.tFloor.text="Floor "+t,t>5&&this.checkGuide()},e.prototype.updateNextTime=function(){var t=GmGlobal.mc;1==this._mid?this.setNextTime(t.wfMgr.getCtCd()):this.setNextTime(t.wfMgr.getCtSyCd()),GmGlobal.res.destroyUnuseMCData()},e.prototype.setNextTime=function(t){CDText.getInstence().addCD(this.time,t,1==this._mid?"Next monster wave countdown: ":"Floor Clear Countdown: ","m:s")},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.EXIT_CT&&GmGlobal.vmc.mMui.getMainUI().bindHcBtnGuide()},e.prototype.onBuff=function(){var t=GmGlobal.mc.btMgr.getFbBuffCfg(GmGlobal.mc.wfMgr.ctBuffId);this.tip.text=t},e.prototype.close=function(){this.tip.text="",GmGlobal.mc.wfMgr.ctBuffId=0,EventBus.rmListener(EventType.M_JUPD+JsonID.CT_UPD,this.onUpdate,this),EventBus.rmListener(EventType.CT_BUFF_UPD,this.onBuff,this),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.TOWER_FLOOR),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.TOWER_NEXT_MST),t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(CtSceneUI.prototype,"CtSceneUI");var DatiView=function(t){function e(){return t.call(this,"DatiViewSkin")||this}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.aBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAt,this),this.bBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAt,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.aBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAt,this),this.bBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAt,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.aImg.visible=!1,this._answer=0;var i=GmGlobal.mc,s=i.wfMgr.getTbCfg(),o=i.wfMgr.getWfData(FubenType.TB_DATI);this.jdTxt.text="Q "+o.data.idx+"/"+s.dtnum,CDText.getInstence().addCD(this.cdTxt,s.dttime,"Time Left: ","sS","",this.onTimeOut,this);var n=i.wfMgr.getTbDtQuestion(o.data.tmid);n&&(this.qTxt.text=n.q,this.a1Txt.text="A: "+n.a1,this.a2Txt.text="B: "+n.a2)},e.prototype.onTimeOut=function(){TanbaoSceneUI.getInstance().setCtTime(),this.close()},e.prototype.onAt=function(t){if(!(this._answer>0)){var e=GmGlobal.cc.dataCtl;t.target==this.aBtn?(this._answer=1,e.pbReq(PbReqId.TB_DATI,[1],null,this.onRet,this)):t.target==this.bBtn&&(this._answer=2,e.pbReq(PbReqId.TB_DATI,[2],null,this.onRet,this))}},e.prototype.onRet=function(t,e){if(0==t){e&&1==e[1]?this.aImg.source="com_json.ic_right":this.aImg.source="com_json.ic_error";var i=1==this._answer?this.aBtn:this.bBtn;this.aImg.y=i.y+i.height-this.aImg.height,this.aImg.x=i.x+i.width-50,this.aImg.visible=!0}},e.prototype.onClose=function(){TanbaoSceneUI.getInstance().setCtTime(),this.close()},e.prototype.close=function(){CDText.getInstence().rmCD(this.cdTxt),t.prototype.close.call(this)},e}(UIBase);__reflect(DatiView.prototype,"DatiView");var FubenInvateView=function(t){function e(){return t.call(this,"FubenInvateSkin")||this}return __extends(e,t),e.show=function(t,i){this._instance||(this._instance=new e),this._instance.setData(t,i),this._instance.show(GmGlobal.vmc.uiLayer)},e.close=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.updatePos=function(){UIBase.aCenter(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.chat.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendToChat,this),this.frend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFrend,this),this.kuafu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onKq,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.chat.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendToChat,this),this.frend.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFrend,this),this.kuafu.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onKq,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.tweenShow()},e.prototype.setData=function(t,e){this._teamId=t,this._fbId=e;var i=FubenType.getClientType(e),s=this.getKfWeel(i);if(s){Utils.setBtnEnable(this.kuafu,!0);var o=new Date(1e3*GmGlobal.getServerLocalTime()),n=o.getDay();0==n&&(n=7),-1!=s.indexOf(n)?this._isKfOpen=!0:this._isKfOpen=!1}else this._isKfOpen=!1,Utils.setBtnEnable(this.kuafu,!1)},e.prototype.getKfWeel=function(t){var e=GmGlobal.mc;return t==FubenType.YCKJ?e.yckjMgr.cfg.crossserverday:e.wfMgr.getKfWeek(t)},e.prototype.onSendToChat=function(t){this.sendToChat()},e.prototype.sendToChat=function(t){void 0===t&&(t=ChatChannel.WORLD);var e=GmGlobal.cc,i=FubenType.getClientType(this._fbId);i==FubenType.JXGC?e.chatCtl.jxgcTeamInvite(this._teamId,t):i==FubenType.MK01?e.chatCtl.mkTeamInvite(this._teamId,t):i==FubenType.SWSX?e.chatCtl.sxTeamInvite(this._teamId,t):i==FubenType.YCKJ&&e.chatCtl.yckjTeamInvite(this._teamId,this._fbId,t),this.onClose()},e.prototype.onKq=function(){return this._isKfOpen?GmGlobal.mc.role.lv<80?void MsgBox.prompt("Cross-server team available at Lv. 80."):void this.sendToChat(ChatChannel.KUAFU):void MsgBox.prompt("Cross-server team-up is not available yet, can't send invitations.")},e.prototype.onFrend=function(){CmdBus.doCmd(CmdType.O_FRIEND,this._teamId,this._fbId),this.onClose()},e.prototype.onClose=function(){e.close()},e}(UIBase);__reflect(FubenInvateView.prototype,"FubenInvateView");
var FuHuoView=function(t){function e(){var e=t.call(this)||this;return e.skinName="FuhuoSkin",e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&this._instence.close(),this._instence=null},e.prototype.updatePos=function(){this.x=(GmGlobal.stageWidth-this.width)/2,GmConst.IS_FULLSCENE?this.y=GmGlobal.stageHeight-300-this.height-GmConst.BOTTOM_SPACE:this.y=GmGlobal.stageHeight-300-this.height},e.prototype.show=function(t,e,i){this.parent||t.addChild(this),this.updatePos(),this._cd?this._cd.setTime(e):this._cd=new GameTime(e),this._price=i,this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFuhuo,this),GameTick.instence().setInterval(1,this.onTime,this),this.onTime()},e.prototype.onTime=function(){var t=this._cd.cd;this.txt.text="Spend "+this._price+" crystals to revive now("+t+")",this.txtBg.height=this.txt.textHeight+30,this.height=this.txtBg.height+104,0==t&&this.onFuhuo()},e.prototype.onFuhuo=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_FUHUO,null,this.onOk,this)},e.prototype.onOk=function(){GameTick.instence().clearInterval(this.onTime,this),e.release()},e.prototype.close=function(){GameTick.instence().clearInterval(this.onTime,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFuhuo,this),this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(FuHuoView.prototype,"FuHuoView");var GHBattleSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="GHBattleSceneSkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.release=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.wfMgr,s=i.getWfData(FubenType.GHZ),o=GmGlobal.getServerTime(),n=s.endTime-o;0>=n?this.hdEnd():CDText.getInstence().addCD(this.hdTime,n,"Event Countdown: ","m:s","",this.onHdTimeOut,this),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this)},e.prototype.onHdTimeOut=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.GHZ),i=GmGlobal.getServerTime(),s=e.endTime-i;0>=s?this.hdEnd():CDText.getInstence().addCD(this.hdTime,s,"Event Countdown: ","m:s","",this.onHdTimeOut,this)},e.prototype.hdEnd=function(){this.hdTime.text="Event ended"},e.prototype.onHdClose=function(t){CDText.getInstence().rmCD(this.hdTime),this.hdEnd()},e.prototype.close=function(){EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),CDText.getInstence().rmCD(this.hdTime),t.prototype.close.call(this)},e._instance=null,e}(WanfaSceneUIBase);__reflect(GHBattleSceneUI.prototype,"GHBattleSceneUI");var GHBossSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="GHBossSceneUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.release=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.wfMgr,s=i.getWfData(FubenType.GH_BOSS),o=GmGlobal.getServerTime(),n=s.endTime-o;0>=n?this.hdEnd():CDText.getInstence().addCD(this.hdTime,n,"Event Countdown: ","m:s","",this.onHdTimeOut,this),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this),EventBus.addListener(EventType.FB_COMPLETE,this.onHdClose,this)},e.prototype.onHdTimeOut=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.GH_BOSS),i=GmGlobal.getServerTime(),s=e.endTime-i;0>=s?this.hdEnd():CDText.getInstence().addCD(this.hdTime,s,"Event Countdown: ","m:s","",this.onHdTimeOut,this)},e.prototype.hdEnd=function(){this.hdTime.text="Event ended"},e.prototype.onHdClose=function(t){CDText.getInstence().rmCD(this.hdTime),this.hdEnd()},e.prototype.close=function(){EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),EventBus.rmListener(EventType.FB_COMPLETE,this.onHdClose,this),CDText.getInstence().rmCD(this.hdTime),t.prototype.close.call(this)},e._instance=null,e}(WanfaSceneUIBase);__reflect(GHBossSceneUI.prototype,"GHBossSceneUI");var JifenAwItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tJf.text=this.data.cfg.jf,this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.cfg.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0),1==this.data.state?(this.bLq.visible=!0,Utils.setBtnEnable(this.bLq,!0),this.ylq.visible=!1):2==this.data.state?(this.bLq.visible=!1,this.ylq.visible=!0):(this.bLq.visible=!0,Utils.setBtnEnable(this.bLq,!1),this.ylq.visible=!1),this.line.visible=!this.data.isLast},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(JifenAwItem.prototype,"JifenAwItem");var JifenAwItem2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.tJf.text=this.data.jf,this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(JifenAwItem2.prototype,"JifenAwItem2");var JxgcSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="JxgcSceneUISkin",e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.getAwBtn=function(){return this.bAw},e.prototype.onResize=function(){t.prototype.onResize.call(this);var e=GmGlobal.vmc.scene.currenScene;this.bAw.x=Math.min(e.x+e.blockMap.width-this.bAw.anchorOffsetX-this.x,GmGlobal.stageWidth-this.bAw.anchorOffsetX-this.x)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.wfMgr.getJxgcCfg();this.setCDTime(i.time),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.JXGC_BATCH,this.onBatch,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.JXGC_BOSSSHOW,this.onBossShow,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAw,this)},e.prototype.onBatch=function(t){this.batchNum.text="Waves："+t.wave,t.time&&this.setCDTime(t.time)},e.prototype.setCDTime=function(t){CDText.getInstence().addCD(this.hdTime,t,"Dungeon Countdown: ","m:s")},e.prototype.onBossShow=function(t){t.show?(this.bossTip.visible=!0,this.bossTip.text="Boss refreshed，Find and kill"):this.bossTip.visible=!1},e.prototype.onGetAw=function(){GmGlobal.cc.dataCtl.pbReq(PbReqId.JXGC_QAW,null,null,this.onAwRet,this),Utils.lockBtn(this.bAw,2e3)},e.prototype.onAwRet=function(t,e){var i=[];for(var s in e)i.push({id:Number(s),num:e[s]});CmdBus.doCmd(CmdType.O_JXGC_AW,2,i)},e.prototype.close=function(){GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.JXGC_BATCH),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.JXGC_BOSSSHOW),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAw,this),this.bossTip.visible=!1,this.batchNum.text="",t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(JxgcSceneUI.prototype,"JxgcSceneUI");var MaoMaoSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="MaoMaoSceneUISkin",e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.tip.text="Defeat the player with a black cat to drop the cat",this.updateHdTime(),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.MM_TIP,this.onTip,this)},e.prototype.updateHdTime=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.MAOMAO),i=GmGlobal.getServerTime(),s=e.endTime-i;0>=s?this.hdEnd():CDText.getInstence().addCD(this.hdTime,s,"Dungeon Countdown: ","m:s","",this.onHdTimeOut,this)},e.prototype.onHdTimeOut=function(){this.updateHdTime()},e.prototype.hdEnd=function(){this.hdTime.text="Event ended"},e.prototype.onHdClose=function(t){CDText.getInstence().rmCD(this.hdTime),this.hdEnd()},e.prototype.onTip=function(t){this.tip.textFlow=TextFormat.parser.parse(t.txt)},e.prototype.close=function(){EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.MM_TIP),CDText.getInstence().rmCD(this.hdTime),t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(MaoMaoSceneUI.prototype,"MaoMaoSceneUI");var PVPSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="PVPSceneUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.release=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.show=function(e){t.prototype.show.call(this,e)},e.prototype.setCD=function(t){CDText.getInstence().addCD(this.hdTime,t,"Countdown: ","m:s")},e.prototype.close=function(){CDText.getInstence().rmCD(this.hdTime),t.prototype.close.call(this)},e._instance=null,e}(WanfaSceneUIBase);__reflect(PVPSceneUI.prototype,"PVPSceneUI");var ShenySceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenySceneUISkin",e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateTime(),this.onBuff(),EventBus.addListener(EventType.SY_TIME_UPD,this.updateTime,this),EventBus.addListener(EventType.SY_BUFF,this.onBuff,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.SY_BATCH,this.updateBatch,this)},e.prototype.updateTime=function(){var t=GmGlobal.mc.wfMgr,e=t.syBatch;e&&(this._batch=e,this.tBatch.text="Waves 1/"+e,CDText.getInstence().addCD(this.tTime,t.syTime.cd,"Hold Countdown：","m:s"))},e.prototype.updateBatch=function(t){this.tBatch.text="Waves "+t.wave+"/"+this._batch},e.prototype.onBuff=function(){var t=GmGlobal.mc.btMgr.getFbBuffCfg(GmGlobal.mc.wfMgr.syBuffId);if(t){var e=t.indexOf("：");-1!=e&&(t=t.substr(t.indexOf("：")+1)),this.tTx.text="Monster Feature："+t}},e.prototype.close=function(){EventBus.rmListener(EventType.SY_TIME_UPD,this.updateTime,this),EventBus.rmListener(EventType.SY_BUFF,this.onBuff,this),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.SY_BATCH),this.tTx.text="",t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(ShenySceneUI.prototype,"ShenySceneUI");var TanbaoSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="TanbaoSceneUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.release=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateHdTime(),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this),EventBus.addListener(EventType.HD_STATE_UPD,this.onHdUpd,this),EventBus.addListener(EventType.FB_COMPLETE,this.onComplete,this)},e.prototype.onHdUpd=function(t){var e=t.data;e==FubenType.TB_DATI&&this.updateHdTime()},e.prototype.updateHdTime=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.TB_DATI),i=GmGlobal.getServerTime(),s=t.getTbCfg(),o=e.startTime+s.readytime-i;if(0>=o){var n=e.endTime-i;0>=n?this.hdEnd():(CDText.getInstence().addCD(this.hdTime,n,"Event Countdown: ","m:s","",this.onHdTimeOut,this),e.isEnd?this.onComplete():this.ctTime.text="")}else CDText.getInstence().addCD(this.hdTime,o,"Random mode starts in ","m:s","",this.onHdTimeOut,this),this.ctTime.text=""},e.prototype.onHdTimeOut=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.TB_DATI),i=GmGlobal.getServerTime(),s=e.endTime-i;0>=s?this.hdEnd():CDText.getInstence().addCD(this.hdTime,s,"Event Countdown: ","m:s","",this.onHdTimeOut,this)},e.prototype.hdEnd=function(){this.hdTime.text="Event ended",this.ctTime.text=""},e.prototype.setCtTime=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.TB_DATI),i=GmGlobal.getServerTime();if(i>=e.endTime)return void(this.ctTime.text="");var s=t.getTbCfg(),o=1==e.subTyoe?s.cttime:3==e.subTyoe?s.xzcttime:0;if(o>0)if(e.data&&e.data.idx<s.dtnum){var n=o-(i-(e.startTime+s.readytime))%o;CDText.getInstence().addCD(this.ctTime,n,"Next question starts in ","sS"," ",this.onCtTimeOut,this)}else this.ctTime.text="";else this.ctTime.text=""},e.prototype.onCtTimeOut=function(){this.ctTime.text=""},e.prototype.onHdClose=function(t){CDText.getInstence().rmCD(this.hdTime),this.hdEnd()},e.prototype.onComplete=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.TB_DATI);2==e.subTyoe?this.ctTime.text="Boss killed":this.ctTime.text="Puzzle ended"},e.prototype.close=function(){EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),EventBus.rmListener(EventType.HD_STATE_UPD,this.onHdUpd,this),EventBus.rmListener(EventType.FB_COMPLETE,this.onComplete,this),CDText.getInstence().rmCD(this.hdTime),CDText.getInstence().rmCD(this.ctTime),t.prototype.close.call(this)},e._instance=null,e}(WanfaSceneUIBase);__reflect(TanbaoSceneUI.prototype,"TanbaoSceneUI");var WanfaChuangtaView=function(t){function e(){var e=t.call(this,"WanfaChuangtaViewSkin")||this;return e._isSy=!1,e._isMax=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bTz.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTz,this),this.bSd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSd,this),this.bType.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChangeType,this),EventBus.addListener(EventType.M_JUPD+JsonID.CT_UPD,this.onUpdate,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bTz.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTz,this),this.bSd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSd,this),this.bType.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChangeType,this),EventBus.rmListener(EventType.M_JUPD+JsonID.CT_UPD,this.onUpdate,this)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc,s=i.dataMgr.getJData(JsonID.CT_UPD),o=s.data.mid||1;this._isSy=1==o?!1:!0,this.onUpdate(),this.updateTypeState(),this.textCon.visible=!1,this.checkGuide()},e.prototype.onUpdate=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.CT_UPD);e.data.mode||(e.data.mode={1:{f:0,s:0,mf:0},2:{f:0,s:0,mf:0}}),this.updateData(e.data.mode[this._isSy?2:1])},e.prototype.updateData=function(t){t||(t={});var e=GmGlobal.mc,i=1,s=null,o=e.wfMgr.getCtMaxFloor();if(this._isSy){var n=t.f||1;i=Math.min(n,o),s=e.wfMgr.getCtSyAw(),this.bSd.visible=!1,this.sdF.visible=!1}else{var n=t.f||1;i=Math.min(n,o),s=e.wfMgr.getCtPtAw(),this.bSd.visible=!0;var r=t.mf||0,h=i-1;1==t.s&&r>h?(Utils.setBtnEnable(this.bSd,!0),this.sdF.visible=!0,this.sdF.text="Raid to Floor "+r):(Utils.setBtnEnable(this.bSd,!1),this.sdF.visible=!1)}if(t.f&&t.f>o?this._isMax=!0:this._isMax=!1,this.fTxt.text="Floor "+i,this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(s,100,!1,!0,!0),this._itemGridCon.addToParent(5,0,this.itemCon,this.textCon,630),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,t.et){var a=t.et-GmGlobal.getServerTime();a>0?CDText.getInstence().addCD(this.tCD,a,"Reset Countdown:"," DD h:m:s"):this.tCD.text=""}else this.tCD.text=""},e.prototype.onChangeType=function(){this._isSy=!this._isSy,this.updateTypeState(),this.onUpdate()},e.prototype.updateTypeState=function(){if(this._isSy){this.bg.source="chuangta_bg2_jpg";var t=this.bType.rotation%360,e=0;t>45?e=360-t:45>t&&(e=45-t),this.bType.rotation%360!=0&&(egret.Tween.removeTweens(this.bType),egret.Tween.get(this.bType).to({rotation:this.bType.rotation+e},200)),this.setTextColor(6854854,16777215)}else{this.bg.source="chuangta_bg1_jpg";var t=this.bType.rotation%360,e=0;t>215?e=360-t:215>e&&(e=215-t),this.bType.rotation%360!=180&&(egret.Tween.removeTweens(this.bType),egret.Tween.get(this.bType).to({rotation:this.bType.rotation+e},200)),this.setTextColor(16777215,6854854)}},e.prototype.setTextColor=function(t,e){this.ptt.textColor=t,this.syt.textColor=e},e.prototype.onTz=function(){return this._isMax?void MsgBox.prompt("Max floor challenged"):(this.checkExitGuide(),void GmGlobal.cc.dataCtl.doAction(ServerActionId.CT_TZ,[this._isSy?2:1],this.onTzOk,this))},e.prototype.onTzOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.onSd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.CT_SD)},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getCtRule())},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.TOWER&&t.bindTarget(GuideTargetId.TIAOZHAN,this.bTz,this.bTz.parent.localToGlobal(this.bTz.x,this.bTz.y))},e.prototype.checkExitGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.TOWER&&(GmGlobal.vmc.mGuide.triggerTarget(this.bTz),t.triggerGuide(GuideID.EXIT_CT,null,1,1))},e.prototype.close=function(){this.clearItems(),CDText.getInstence().rmCD(this.tCD),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("chuangta_bg1_jpg"),RES.destroyRes("chuangta_bg2_jpg")},e}(UIBase);__reflect(WanfaChuangtaView.prototype,"WanfaChuangtaView");var WanfaController=function(){function t(){this._yqTime={};var t=GmGlobal.cc.dataCtl;t.regPbCb(PbMsgId.TB_DT,this.onTbDtUpd,this),t.regPbCb(PbMsgId.FB_COMPLETE,this.onFbComplete,this),t.regPbCb(PbMsgId.TOWER_BUFF,this.onCTBuff,this),t.regPbCb(PbMsgId.TOWER_NEXT_MST,this.onCTNextMst,this),t.regPbCb(PbMsgId.FUBEN_AW,this.onFubenAw,this),t.regPbCb(PbMsgId.YB_LIST,this.onBcUpd,this),t.regPbCb(PbMsgId.PVP_TIME,this.onPvpTime,this),t.regPbCb(PbMsgId.FB_TEAM,this.onFbTeamUpd,this),t.regPbCb(PbMsgId.SY_TIME,this.onSyTime,this),t.regPbCb(PbMsgId.SY_BUFF,this.onSyBuff,this),t.regPbCb(PbMsgId.MM_CATNUM,this.onCatInfo,this),t.regPbCb(PbMsgId.FB_INVITE,this.onInviteFriend,this),t.regPbCb(PbMsgId.KF_FLAG,this.onKfFlag,this),t.regPbCb(PbMsgId.JZT_FDATA,this.onJztGridData,this),t.regPbCb(PbMsgId.JZT_RANDOM,this.onJztRandom,this),t.regPbCb(PbMsgId.JZT_ALIVE,this.onJztAlive,this),EventBus.addListener(EventType.M_JUPD+JsonID.ARENA_UPD,this.updateArenaCountDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.ARENA_JFAW,this.updateArenaAwDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.ARENA_ZB,this.onZbUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.CT_UPD,this.updateCtSdDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.YB_UPD,this.updateYbDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.WZ_UPD,this.onWzUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.JXGC_UPD,this.updateJxgcDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.SY_UPD,this.updateSyDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.DC_UPD,this.onDcUpd,this),EventBus.addListener(EventType.M_JUPD+JsonID.DC_ZB_UPD,this.onDcZb,this),EventBus.addListener(EventType.M_JUPD+JsonID.DC_AW,this.onDcAw,this),EventBus.addListener(EventType.M_JUPD+JsonID.MK_UPD,this.updateMkDot,this),EventBus.addListener(EventType.M_JUPD+JsonID.SWSX,this.updateSxDot,this),GmGlobal.cc.itemCtl.bindItemCallback(ItemID.ARENA_JF,this.updateArenaAwDot,this)}return t.prototype.onFbComplete=function(t){var e=FubenType.getClientType(t.mapid),i=GmGlobal.mc.wfMgr.getWfData(e);i.isEnd=!0,EventBus.dispatchEvt(EventType.FB_COMPLETE)},t.prototype.onTbDtUpd=function(t){var e=GmGlobal.mc,i=e.wfMgr.getWfData(FubenType.TB_DATI);i.data=t;var s=e.sceneMgr;FubenType.getClientType(s.mapId)==FubenType.TB_DATI&&(1==t.eventid?DatiView.getInstence().show(GmGlobal.vmc.uiLayer):3==t.eventid&&XzDatiView.getInstence().show(GmGlobal.vmc.uiLayer))},t.prototype.onWzUpd=function(t){var e=t.data,i=GmGlobal.mc.wfMgr,s=i.getWfData(FubenType.WANGZUO);for(var o in e.data)s.data||(s.data={}),s.data[o]=e.data[o];EventBus.dispatchEvt(EventType.WZ_UPD)},t.prototype.onCTBuff=function(t){GmGlobal.mc.wfMgr.ctBuffId=t.id,EventBus.dispatchEvt(EventType.CT_BUFF_UPD)},t.prototype.onCTNextMst=function(t){GmGlobal.mc.wfMgr.ctNextMst=egret.getTimer()},t.prototype.onFubenAw=function(t){var e=GmGlobal.vmc.scene.currenScene;if(e&&e.stopAutoAttack(),t.fbid==FubenType.CT_PT&&GmGlobal.vmc.mGuide.hasGuide(GuideID.EXIT_CT)&&GmGlobal.vmc.mGuide.clearGuide(),0==t.win){var i=BattleFailView.getInstence();return i.setFbType(t.fbid),void i.show(GmGlobal.vmc.uiLayer)}BattleFailView.getInstence().clear();var s=[];for(var o in t.award)s.push({id:Number(o),num:t.award[o]});var n=BattleWinView.getInstence();n.updateList(s,t.fbid),n.show(GmGlobal.vmc.uiLayer)},t.prototype.onBcUpd=function(t){var e=GmGlobal.mc.wfMgr;if(t.carid){if(e.bcList)for(var i in e.bcList){var s=e.bcList[i];s.carid==t.carid&&delete e.bcList[i]}EventBus.dispatchEvt(EventType.YB_LEVEL,t.carid)}else if(t.carlst){e.bcList||(e.bcList={});for(var i in t.carlst)e.bcList[i]=t.carlst[i];EventBus.dispatchEvt(EventType.YB_UPD,t.carlst)}},t.prototype.onPvpTime=function(t){var e=GmGlobal.mc.sceneMgr;if(e.mapId==t.mapid){var i=GmGlobal.mc.btMgr;i.pvpAiSkill=null,t.skill&&(i.pvpAiSkill=t.skill),i.pvpAiSp=t.sp||0;var s=GmGlobal.getServerTime(),o=t.time-s;if(o>0){if(t.mapid!=FubenType.JZTXB){var n=PVPSceneUI.getInstance();n.show(GmGlobal.vmc.uiLayer),n.setCD(o)}EventBus.dispatchEvt(EventType.PVP_TIME)}}},t.prototype.onFbTeamUpd=function(t){var e=GmGlobal.mc.wfMgr;0==Utils.getObjectLength(t)?e.fbTeam=null:t.kick?e.fbTeam&&(MsgBox.alert("You've been kicked out of the team"),GmGlobal.mc.wfMgr.setTeamXz(e.fbTeam[1].roleid),e.fbTeam=null):e.fbTeam=t.tmlst,EventBus.dispatchEvt(EventType.FB_TEAM)},t.prototype.onSyBuff=function(t){GmGlobal.mc.wfMgr.syBuffId=t.id,EventBus.dispatchEvt(EventType.SY_BUFF)},t.prototype.onDcUpd=function(t){this.updateDcDot(),EventBus.dispatchEvt(EventType.DC_UPD)},t.prototype.onDcZb=function(t){var e=GmGlobal.mc.dataMgr.getJData(JsonID.DC_ZB_UPD).data,i=GmGlobal.mc.wfMgr;i.dcZbList||(i.dcZbList={});for(var s in e)i.dcZbList[s]=e[s];EventBus.dispatchEvt(EventType.DC_ZB_UPD)},t.prototype.onDcAw=function(t){var e=t.data.data,i=[];for(var s in e)i.push({id:Number(s),num:e[s]});GmGlobal.mc.wfMgr.dcAw=i,this.updateDcDot(),EventBus.dispatchEvt(EventType.DC_AW)},t.prototype.onCatInfo=function(t){var e=GmGlobal.mc.wfMgr.mmCatInfo;for(var i in t)e[i]=t[i];EventBus.dispatchEvt(EventType.MM_CAT_UPD)},t.prototype.updateRedDots=function(){this.updateArenaCountDot(null),this.updateArenaAwDot(null),this.updateCtSdDot(null),this.updateJxgcDot(),this.updateSyDot(),this.updateDcDot(),this.updateMkDot(),this.updateSxDot()},t.prototype.updateArenaCountDot=function(t){var e=GmGlobal.mc.dataMgr.getJData(JsonID.ARENA_UPD).data,i=GmGlobal.mc.wfMgr.redDot;0==e.acnt?i.childs[0].childs[0].state=0:i.childs[0].childs[0].state=1},t.prototype.onZbUpd=function(t){var e=GmGlobal.mc.dataMgr.getJData(JsonID.ARENA_ZB).data,i=GmGlobal.mc.wfMgr;i.zbList||(i.zbList={});for(var s in e)i.zbList[s]=e[s];EventBus.dispatchEvt(EventType.JJ_ZB_UPD)},t.prototype.onSyTime=function(t){var e=GmGlobal.mc.wfMgr;e.syBatch=t.mwave,e.syTime?e.syTime.setTime(t.ntime):e.syTime=new GameTime(t.ntime),EventBus.dispatchEvt(EventType.SY_TIME_UPD)},t.prototype.updateArenaAwDot=function(t){for(var e=GmGlobal.mc,i=e.itemMgr.getItemNum(ItemID.ARENA_JF),s=e.wfMgr.getArenaJfAwList(),o=e.dataMgr.getJData(JsonID.ARENA_JFAW),n=e.wfMgr.redDot.childs[0].childs[1],r=0;r<s.length;r++){var h=s[r];if(h.jf<=i&&!o.data[h.jf])return void(n.state=1)}n.state=0},t.prototype.updateCtSdDot=function(t){var e=GmGlobal.mc,i=e.dataMgr.getJData(JsonID.CT_UPD),s=e.wfMgr.redDot.childs[1].childs[0];if(!i.data.mode)return void(s.state=0);var o=i.data.mode[1];o.mf>0&&(!o.f||o.f<o.mf)?s.state=1:s.state=0},t.prototype.updateYbDot=function(t){var e=GmGlobal.mc,i=e.dataMgr.getJData(JsonID.YB_UPD),s=e.wfMgr.redDot.childs[2],o=void 0==i.data.rcnt?1:i.data.rcnt,n=void 0==i.data.ecnt?1:i.data.ecnt;o>0||n>0?s.state=1:s.state=0},t.prototype.updateJxgcDot=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.JXGC_UPD),i=t.wfMgr.redDot.childs[5];e.data.acnt||void 0==e.data.acnt?i.state=1:i.state=0},t.prototype.updateSyDot=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.SY_UPD),i=t.wfMgr.redDot.childs[6];e.data.cnt||void 0==e.data.cnt?i.state=1:i.state=0},t.prototype.updateDcDot=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.DC_UPD),i=t.wfMgr.redDot.childs[7];e.data.acnt||void 0==e.data.acnt?i.childs[0].state=1:i.childs[0].state=0,t.wfMgr.dcAw&&t.wfMgr.dcAw.length>0?i.childs[1].state=1:i.childs[1].state=0},t.prototype.updateMkDot=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.MK_UPD),i=t.wfMgr.redDot.childs[10];e.data.acnt||void 0==e.data.acnt?i.state=1:i.state=0},t.prototype.updateSxDot=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.SWSX),i=t.wfMgr.redDot.childs[12],s=0;e.data&&(s=e.data.f||0),0==s?i.state=1:i.state=0},t.prototype.onInviteFriend=function(t){var e=this._yqTime[t.tid]||0,i=GmGlobal.getServerTime();if(!(60>i-e)){var s="Your friend "+t.name+" invites you to ";t.fid==FubenType.JXGC?s+="Mech Factory":t.fid==FubenType.MK01?s+="Den Adventure":t.fid==FubenType.SWSX&&(s+="Statue Defense"),s+=". Participate?",this._teamId=t.tid,this._fbId=t.fid,MsgBox.confirm(s,this.onJoin,this.onCancel,this)}},t.prototype.onJoin=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ZY,[this._teamId,this._fbId],this.onJoinOK,this)},t.prototype.onJoinOK=function(){this._fbId==FubenType.JXGC?CmdBus.doCmd(CmdType.O_WANFA,5):this._fbId==FubenType.MK01?CmdBus.doCmd(CmdType.O_WANFA,10):this._fbId==FubenType.SWSX&&CmdBus.doCmd(CmdType.O_WANFA,12)},t.prototype.onCancel=function(){this._yqTime[this._teamId]=GmGlobal.getServerTime()},t.prototype.onKfFlag=function(t){var e=GmGlobal.mc.role;e.kfFlag=t.flag},t.prototype.onJztGridData=function(t){GmGlobal.mc.wfMgr.jztGridData=t.map,EventBus.dispatchEvt(EventType.JZT_GRID_UPD)},t.prototype.onJztRandom=function(t){GmGlobal.mc.wfMgr.jztRandom=t.pos,EventBus.dispatchEvt(EventType.JZT_RANDOM)},t.prototype.onJztAlive=function(t){GmGlobal.mc.wfMgr.fhNum=t.alive,EventBus.dispatchEvt(EventType.JZT_ALIVE)},t}();__reflect(WanfaController.prototype,"WanfaController");var WanfaData=function(){function t(){this.isEnd=!1}return t}();__reflect(WanfaData.prototype,"WanfaData");var WanfaDcAwView=function(t){function e(){return t.call(this,"WanfaDcAwSkin")||this}return __extends(e,t),e.getInstance=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bLq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLq,this),EventBus.addListener(EventType.DC_AW,this.setItem,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bLq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLq,this),EventBus.rmListener(EventType.DC_AW,this.setItem,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.setItem()},e.prototype.setItem=function(){var t=GmGlobal.mc.wfMgr.dcAw;t&&0!=t.length?(this.bgCon.visible=!0,this.txt.visible=!1,this.scoll.visible=!0,this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,110),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,5,this.itemCon,null,590),Utils.setBtnEnable(this.bLq,!0)):(this.bgCon.visible=!1,this.txt.visible=!0,this.scoll.visible=!1,this.txt.text="No reward yet",Utils.setBtnEnable(this.bLq,!1))},e.prototype.onLq=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.DC_GET_AW),this.onClose()},e.prototype.onClose=function(){e.release()},e.prototype.close=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaDcAwView.prototype,"WanfaDcAwView");var WanfaDcItem=function(t){function e(){var e=t.call(this)||this;return e._bhTimer=0,e._endTimer=0,e.skinName="WanfaDcItemSkin",e.touchChildren=!1,e.anchorOffsetX=92,e}return __extends(e,t),e.prototype.setData=function(t,e){if(this.idx=t,this.data=e,this.dz.source=this.getBgRes(t),e){this.tZl.visible=!0,this.tName.visible=!0,this.tName.text=e.name,e.roleid==GmGlobal.mc.role.roleId?(this.tName.textColor=577829,this.tName.strokeColor=0):(this.tName.textColor=16777215,this.tName.strokeColor=6060977),this.tZl.text="Power："+e.z,e.msg?(this.xyCon.visible=!0,this.tXy.text=e.msg):(this.xyCon.visible=!1,this.tXy.text=""),this.setModel(e.career,e.headwear);var i=e.pt-GmGlobal.getServerTime();if(i>0&&(this._bhTimer=egret.setTimeout(this.rmBhImg,this,1e3*i),this.adBhImg()),GmGlobal.mc.role.roleId==e.roleid&&e.et){var s=e.et-GmGlobal.getServerTime();s>0?(this.tTime.visible=!0,CDText.getInstence().addCD(this.tTime,s,"","h:m:s","",this.onTimeOut,this)):this.tTime.visible=!1}else this.tTime.visible=!1}else this.xyCon.visible=!1,this.tZl.visible=!1,this.tName.visible=!1,this.tTime.visible=!1,this.clearModel(),this.clearBhImg()},e.prototype.onTimeOut=function(){this.tTime.visible=!1},e.prototype.getBgRes=function(t){return t>=1&&6>=t?"lcom_json.dz_0":t>=7&&18>=t?"lcom_json.dz_1":t>=19&&36>=t?"lcom_json.dz_2":t>=37&&60>=t?"lcom_json.dz_3":"lcom_json.dz_4"},e.prototype.setModel=function(t,e){this._uiRoleView||(this._uiRoleView=new UIRoleModel,this.addChildAt(this._uiRoleView,1),this._uiRoleView.x=92,this._uiRoleView.y=124),this._uiRoleView.setInfo(t,e)},e.prototype.clearModel=function(){this._uiRoleView&&(this._uiRoleView.clear(),this.removeChild(this._uiRoleView),this._uiRoleView=null)},e.prototype.adBhImg=function(){this.bhImg||(this.bhImg=new eui.Image("yabaobh_png"),this.bhImg.anchorOffsetX=70,this.bhImg.anchorOffsetY=170,this.bhImg.x=92,this.bhImg.y=150),this.bhImg.parent||this.addChildAt(this.bhImg,2)},e.prototype.rmBhImg=function(){this._bhTimer=0,this.bhImg&&this.bhImg.parent&&this.bhImg.parent.removeChild(this.bhImg)},e.prototype.clearBhImg=function(){0!=this._bhTimer&&(egret.clearTimeout(this._bhTimer),this._bhTimer=0),this.bhImg&&(this.bhImg.parent&&this.bhImg.parent.removeChild(this.bhImg),this.bhImg=null)},e.prototype.clear=function(){this.clearBhImg(),this.clearModel(),CDText.getInstence().rmCD(this.tTime)},e}(eui.Component);__reflect(WanfaDcItem.prototype,"WanfaDcItem");var WanfaDcList=function(){function t(){this.topH=234,this.blockH=494,this.itemH=200,this._reqTimer=0}return t.prototype.show=function(t){this.init(),this._bgCon.parent||t.addChild(this._bgCon),this._listCon.parent||t.addChild(this._listCon);var e=GmGlobal.mc.wfMgr;e.dcList?(this.updateList(e.dcList.lst||{}),this.reqV()):this.reqList(),this._listCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),0==this._reqTimer&&(this._reqTimer=egret.setInterval(this.reqV,this,2e3))},t.prototype.init=function(){if(!this._bgCon){this._bgCon=new eui.Group,this._bgCon.touchEnabled=!1,this._bgCon.touchChildren=!1,this._bgCon.width=647,this._listCon=new eui.Group,this._listCon.touchEnabled=!1,this._listCon.width=647;var t=new eui.Image("dc_bg1_jpg");this._bgCon.addChild(t),this.addBgs(0,2)
}},t.prototype.addBgs=function(t,e){for(var i=t;t+e>i;i++)if(!(this._bgCon.numChildren>i+1)){var s=new eui.Image("dc_bg2_jpg");s.y=this.topH+i*this.blockH,this._bgCon.addChild(s)}},t.prototype.reqList=function(){GmGlobal.cc.dataCtl.pbReq(PbReqId.DC_LIST,[GmGlobal.mc.role.hefuId],null,this.onRet,this)},t.prototype.reqV=function(){var t=GmGlobal.mc.role;GmGlobal.cc.dataCtl.pbReq(PbReqId.DC_LIST,[t.hefuId,1],null,this.onRetV,this)},t.prototype.onRet=function(t,e){if(0!=t)return void MsgBox.prompt(GmGlobal.mc.txtMgr.getRetCode(t));var i=GmGlobal.mc.wfMgr;e?i.dcList=e:i.dcList={id:1},this.updateList(i.dcList.lst||{})},t.prototype.onRetV=function(t,e){if(0!=t)return void MsgBox.prompt(GmGlobal.mc.txtMgr.getRetCode(t));if(e){var i=GmGlobal.mc.wfMgr;i.dcList&&i.dcList.id!=e.id&&this.reqList()}},t.prototype.getMaxId=function(t){var e=0;for(var i in t)Number(i)>e&&(e=Number(i));return e},t.prototype.updateList=function(t){var e=Utils.getObjectLength(t);e+=9,e%3!=0&&(e+=3-e%3),e=Math.min(e,100),this._items||(this._items=[]),e<this._items.length&&(e=this._items.length);for(var i=GmGlobal.mc.wfMgr.getDcCfg(),s=0;e>s;s++){var o=void 0;s<this._items.length?o=this._items[s]:(o=new WanfaDcItem,this._items.push(o));var n=s+1;o.setData(n,t[n]),6>=n?(o.x=i.pos[n][0],o.y=i.pos[n][1]):(o.x=n%3*(647/3)+647/6,o.y=(Math.floor((n-7)/3)+1)*(this.itemH+30)+i.pos[6][1]),o.parent||this._listCon.addChild(o)}this.updateHeight()},t.prototype.updateHeight=function(){var t=this._items[this._items.length-1],e=t.y+this.itemH+30,i=Math.ceil(e/this.blockH);2>=i?this._listCon.height=this._bgCon.height=e:(this.addBgs(2,i-2),this._listCon.height=this._bgCon.height=e)},t.prototype.onList=function(t){if(t.target.idx){var e=t.target.data?t.target.data.roleid:null;if(e==GmGlobal.mc.role.roleId)return;GmGlobal.cc.dataCtl.doAction(ServerActionId.DC_FIGHT,[t.target.idx],this.onFOk,this)}},t.prototype.onFOk=function(){this.reqList()},t.prototype.clearList=function(){if(this._items){for(var t=0,e=this._items;t<e.length;t++){var i=e[t];i.clear(),i.parent&&i.parent.removeChild(i)}this._items=[]}},t.prototype.clearBg=function(){this._bgCon.parent&&this._bgCon.parent.removeChild(this._bgCon),this._listCon.parent&&this._listCon.parent.removeChild(this._listCon)},t.prototype.close=function(){this._listCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),0!=this._reqTimer&&(egret.clearInterval(this._reqTimer),this._reqTimer=0),this.clearList(),this.clearBg()},t}();__reflect(WanfaDcList.prototype,"WanfaDcList");var WanfaDcView=function(t){function e(){return t.call(this,"WanfaDcSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bJlu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJilu,this),this.bXy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onXy,this),EventBus.addListener(EventType.DC_UPD,this.onUpdata,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bJlu.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJilu,this),this.bXy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onXy,this),EventBus.rmListener(EventType.DC_UPD,this.onUpdata,this)},e.prototype.onUpdata=function(t){this.updateData()},e.prototype.show=function(e){t.prototype.show.call(this,e,!1),this.updateData(),this._listView||(this._listView=new WanfaDcList),this._listView.show(this.itemCon),this.updateRedDot(),this.bindRedDotCb()},e.prototype.updateData=function(){var t=GmGlobal.mc,e=t.wfMgr.getDcCfg(),i=t.dataMgr.getJData(JsonID.DC_UPD),s=void 0==i.data.acnt?e.cnt:i.data.acnt;this.tNum.text="Seat Chances："+s,i.data.bcnt==e.buycntprice.length?this.buyCon.visible=!1:(this.buyCon.visible=!0,this.tPrice.text=t.wfMgr.getDcBuyCost(i.data.bcnt||0).toString())},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getDcCfg().rule)},e.prototype.onAdd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.DC_BUY)},e.prototype.onAw=function(){var t=WanfaDcAwView.getInstance();t.show(GmGlobal.vmc.uiLayer)},e.prototype.onJilu=function(){CmdBus.doCmd(CmdType.O_DC_ZB)},e.prototype.onXy=function(){MsgBox.input("Enter your Notice, up to 20 words",this.onXyOk,null,this)},e.prototype.onXyOk=function(t){if(t&&""!=t){if(t.length>20)return void MsgBox.prompt("Text too long. Please enter again");var e=GmGlobal.mc.role.hefuId,i=GmGlobal.cc.dataCtl;PFConst.CHECK_MSG?GmGlobal.cc.pfCtl.checkMsg(t,function(s){0==s&&i.pbReq(PbReqId.DC_SET_XY,[e],{data:t},this.onXyRet,this)}):i.pbReq(PbReqId.DC_SET_XY,[e],{data:t},this.onXyRet,this)}},e.prototype.onXyRet=function(t,e){0==t&&this._listView&&this._listView.reqList()},e.prototype.updateRedDot=function(){var t=GmGlobal.mc.wfMgr.redDot.childs[7];1==t.childs[1].state?RedDotView.addRedDot(this.bAw,this,"daoc",this.bAw.x+this.bAw.anchorOffsetX-10,this.bAw.y-this.bAw.anchorOffsetX):RedDotView.removeRedDot(this.bAw)},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.wfMgr.redDot.childs[7],e=1;2>=e;e++){var i=t.childs[e];i.bindChangeCB(this.updateRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.taskMgr.redDot,e=1;2>=e;e++){var i=t.childs[e];i.unbindChangeCB(this.updateRedDot,this)}},e.prototype.close=function(){RedDotView.removeRedDotByGroup("daoc"),this.unbindRedDotCb(),this._listView&&(this._listView.close(),this._listView=null),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("daoc")},e}(UIBase);__reflect(WanfaDcView.prototype,"WanfaDcView");var WanfaDcZbItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.fTime.text=Utils.formatDate(Utils.getServerTime(this.data.time),"Y-M-D h:m:s");var t=this.data.data,e="LV."+t.q+"Dojo";1==t.type?(this.bFj.visible=!1,this.fjImg.visible=!1,this.txt.width=600,t.win?this.txt.textFlow=TextFormat.parser.parse(TextFormat.setColor(t.name,Colors.RED)+"'s "+e+" captured. Begin collecting resources"):this.txt.textFlow=TextFormat.parser.parse("Failed to challenge "+TextFormat.setColor(t.name,Colors.RED)+"'s "+e)):(this.txt.width=480,this.data.data.win?(this.txt.textFlow=TextFormat.parser.parse(TextFormat.setColor(t.name,Colors.RED)+" Failed to challenge your "+e+". Defense won"),this.bFj.visible=!1,this.fjImg.visible=!1):(this.txt.textFlow=TextFormat.parser.parse(TextFormat.setColor(t.name,Colors.RED)+" Captured your "+e),this.bFj.visible=!0,this.fjImg.visible=!1,this.data.data.rev>0?(this.txt.textFlow=TextFormat.parser.parse(TextFormat.setColor(t.name,Colors.RED)+" Captured your "+e),this.bFj.visible=!0,this.fjImg.visible=!1):(this.txt.textFlow=TextFormat.parser.parse(TextFormat.setColor(t.name,Colors.RED)+" Captured your "+e),this.bFj.visible=!1,this.fjImg.visible=!0,this.fjImg.source="com_json.flg_fjcg")))},e}(eui.ItemRenderer);__reflect(WanfaDcZbItem.prototype,"WanfaDcZbItem");var WanfaDcZbView=function(t){function e(){return t.call(this,"WanfaDcZbSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="WanfaDcZbItemSkin",this.itemList.itemRenderer=WanfaDcZbItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.JJ_ZB_UPD,this.updateList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),EventBus.addListener(EventType.JJ_ZB_UPD,this.updateList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateList(),this.scoll.viewport.scrollV=0},e.prototype.updateList=function(){var t=GmGlobal.mc,e=t.wfMgr.dcZbList;if(e){var i=[];for(var s in e)i.unshift(s);for(var o=0;o<i.length&&10>o;o++){var s=(e[i[o]],Number(i[o])),n={time:Number(s),data:e[s]};null!=this._array.getItemAt(o)?this._array.replaceItemAt(n,o):this._array.addItem(n)}}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;e&&(GmGlobal.cc.dataCtl.doAction(ServerActionId.DC_FIGHT,[e.time]),this.onClose())}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_DC_ZB)},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaDcZbView.prototype,"WanfaDcZbView");var WanfaJingjiView=function(t){function e(){var e=t.call(this,"WanfaJingjiViewSkin")||this;return e._sNo=0,e._rNum=0,e._fNum=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bAw.sound=null,this.bJs.sound=null,this.bZb.sound=null,this.bGh.icon="sicon_json.sicon_10002"},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bFreeGh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefersh,this),this.bGh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefersh,this),this.bAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bZb.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZb,this),this.bJs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJs,this),this.mCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchModel,this),EventBus.addListener(EventType.M_JUPD+JsonID.ARENA_UPD,this.updateCount,this),EventBus.addListener(EventType.M_JUPD+JsonID.ARENA_RTIME,this.updateFreeTime,this),EventBus.addListener(EventType.RANK_UPD,this.onRankUpd,this)},e.prototype.rmEvts=function(){this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bFreeGh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefersh,this),this.bGh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefersh,this),this.bAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bZb.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onZb,this),this.bJs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJs,this),this.mCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchModel,this),EventBus.rmListener(EventType.M_JUPD+JsonID.ARENA_UPD,this.updateCount,this),EventBus.rmListener(EventType.M_JUPD+JsonID.ARENA_RTIME,this.updateFreeTime,this),EventBus.rmListener(EventType.RANK_UPD,this.onRankUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this._rNum=0,this.updateCount(),this.updateFreeTime(),this.updateRankList(),this.updateRedDot(),this.bindRedDotCb()},e.prototype.updateCount=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.ARENA_UPD);if(void 0==e.data.acnt){var i=t.wfMgr.getArenaFightNum();this.tNum.text=String(i),this._fNum=i}else this.tNum.text=e.data.acnt,this._fNum=e.data.acnt;if(void 0==e.data.bcnt){var s=t.wfMgr.getArenaMaxBuyNum();this.tPrice.text=String(t.wfMgr.getArenaAddPrice(s))}else this.tPrice.text=String(t.wfMgr.getArenaAddPrice(e.data.bcnt))},e.prototype.updateFreeTime=function(){var t=GmGlobal.mc,e=t.dataMgr.getJData(JsonID.ARENA_RTIME),i=e.data.time||0,s=i+t.wfMgr.getArenaFreeCD()-GmGlobal.getServerTime();if(0==i||0==s)this.tTime.visible=!1,this.bFreeGh.visible=!0,this.bGh.visible=!1,CDText.getInstence().rmCD(this.tTime);else{this.tTime.visible=!0,this.bFreeGh.visible=!1,this.bGh.visible=!0;var o=e.data.rcnt||0,n=t.wfMgr.getArenaRefreshPrice(o);this.bGh.label=n+" Switch",CDText.getInstence().addCD(this.tTime,s,"","h:m:s"," to free",this.onCDEnd,this)}},e.prototype.onRankUpd=function(t){var e=t.data;e==RankID.ARENA&&this.updateRankList()},e.prototype.onCDEnd=function(){this.tTime.visible=!1,this.bFreeGh.visible=!0,this.bGh.visible=!1},e.prototype.updateRankList=function(){var t=GmGlobal.mc.rankMgr.getRank(RankID.ARENA);if(t.myRank>0?this.tMyRank.text=String(t.myRank):this.tMyRank.text="Unranked",egret.getTimer()-t.cacheTime>6e5){t.clearDatas(),this.clearRankView();var e=GmGlobal.mc.wfMgr.getArenaRankIdList(t.myRank);this.reqRank(e)}else this.onRankListUpd(t)},e.prototype.reqRank=function(t){this._sNo=GmGlobal.cc.rankCtl.getRankDataBuyList(RankID.ARENA,t,[RoleAttrId.CAREER],this.onRankListUpd,this)},e.prototype.onRankListUpd=function(t){this._sNo=0;for(var e=1;8>=e;e++){var i=this["rname_"+e],s=this["model_"+e];if(t.rankDatas&&e<=t.rankDatas.length){var o=t.rankDatas[e-1];i.text=o.name;var n=GmGlobal.mc.rankMgr.getRoleData(o.roleId);if(n?(s.anchorOffsetX=217,s.anchorOffsetY=435,s.source="mui2_"+n.career+"_json.mui2_"+n.career,e>3?s.scaleX=s.scaleY=.4:s.scaleX=s.scaleY=.5):(i.text="None",s.source=null),e>3){var r=this["rrank_"+e];n?r.text=o.rank:r.text=""}}else if(i.text="None",s.source=null,e>3){var r=this["rrank_"+e];r.text=""}}this.checkGuide()},e.prototype.onRefersh=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.ARENA_REFERSH,null,this.onRefershOk,this)},e.prototype.onRefershOk=function(){var t=GmGlobal.mc,e=t.rankMgr.getRank(RankID.ARENA);if(e.rankDatas){var i=e.rankDatas.length;e.clearDatas();var s=t.wfMgr.getArenaRankIdList(e.myRank);i>=8?this._rNum++:e.myRank>8&&this._rNum--;for(var o=3;o<s.length;o++){for(var n=Math.ceil(s[o]*(1+.2*this._rNum)),r=0;o>r;r++)(s[r]==n||n==e.myRank)&&n++;s[o]=n}this.reqRank(s)}},e.prototype.onAdd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.ARENA_BUY)},e.prototype.getRankId=function(t){for(var e=1;8>=e;e++)if(t==this["model_"+e])return e;return-1},e.prototype.onTouchModel=function(t){var e=this.getRankId(t.target);if(-1!=e){var i=GmGlobal.mc.rankMgr.getRank(RankID.ARENA),s=i.rankDatas[e-1];if(s){if(s.roleId==GmGlobal.mc.role.roleId)return void MsgBox.prompt("Can't challenge yourself");GmGlobal.cc.dataCtl.doAction(ServerActionId.ARENA_TZ,[s.roleId],this.onOk,this),GmGlobal.vmc.mGuide.triggerTargetByID(GuideTargetId.TIAOZHAN)}}},e.prototype.onOk=function(){},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getArenaRule())},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_ARENA_JFAW)},e.prototype.onZb=function(){CmdBus.doCmd(CmdType.O_ARENA_ZB)},e.prototype.onJs=function(){CmdBus.doCmd(CmdType.O_ARENA_JS)},e.prototype.bindRedDotCb=function(){var t=GmGlobal.mc.wfMgr.redDot.childs[0].childs[1];t.bindChangeCB(this.updateRedDot,this)},e.prototype.unbindRedDotCb=function(){var t=GmGlobal.mc.wfMgr.redDot.childs[0].childs[1];t.unbindChangeCB(this.updateRedDot,this)},e.prototype.updateRedDot=function(){var t=GmGlobal.mc.wfMgr.redDot.childs[0].childs[1];1==t.state?RedDotView.addRedDot(this.bAw,this,"arena",this.bAw.x+this.bAw.anchorOffsetX-20,this.bAw.y-this.bAw.anchorOffsetY,"com_json.com_rdd"):RedDotView.removeRedDot(this.bAw)},e.prototype.clearRedDots=function(){RedDotView.removeRedDotByGroup("arena"),this.unbindRedDotCb()},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData&&t.guideData.id==GuideID.ARENA){var e=GmGlobal.mc.rankMgr.getRank(RankID.ARENA);if(e.rankDatas.length<2||0==this._fNum)t.clearGuide();else{var i=this.getLastFightIndex(e.rankDatas,GmGlobal.mc.role.roleId);-1==i&&t.clearGuide();var s=this["model_"+i],o=s.parent.localToGlobal(s.x,s.y);t.bindTargetRect(GuideTargetId.TIAOZHAN,new egret.Rectangle(o.x-86,o.y-174,172,174),null)}}},e.prototype.getLastFightIndex=function(t,e){for(var i=t.length-1;i>=0;i--){var s=t[i];if(s.roleId!=e)return i+1}return-1},e.prototype.clearRankView=function(){for(var t=1;8>=t;t++){var e=this["rname_"+t];e.text="";var i=this["model_"+t];if(i.source=null,t>3){var s=this["rrank_"+t];s.text=""}}},e.prototype.close=function(){this.clearRedDots(),CDText.getInstence().rmCD(this.tTime),0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("jingji_bg_jpg")},e}(UIBase);__reflect(WanfaJingjiView.prototype,"WanfaJingjiView");var WanfaJxgcAwView=function(t){function e(){return t.call(this,"WanfaJxgcAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1)},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setType=function(t,e,i){void 0===t&&(t=1),void 0===e&&(e=null),void 0===i&&(i=null),1==t?this.setCfgItems(e,i):this.setGetItems(e)},e.prototype.setCfgItems=function(t,e){this.tTit.text="Reward",this.txt.text=e,this.txt.numLines>1?this.txt.textAlign="left":this.txt.textAlign="center",this._itemGridCon&&ItemGridCon.release(this._itemGridCon),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,110),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,5,this.itemCon,null,590,!1)},e.prototype.setGetItems=function(t){this.tTit.text="Item Obtained",this.txt.text="Rewards will be settled and sent to your bag after leaving the dungeon",this.txt.textAlign="center",this._itemGridCon&&ItemGridCon.release(this._itemGridCon),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,110),this._itemGridCon.setTouchCb(!0),this._itemGridCon.addToParent(10,5,this.itemCon,null,590)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_JXGC_AW)},e.prototype.close=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null),t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaJxgcAwView.prototype,"WanfaJxgcAwView");var WanfaJxgcIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.updateIconIdx=function(){"txk_json.txk"!=this.txk.source?this.setChildIndex(this.txk,1):this.setChildIndex(this.txk,0)},e}(eui.Component);__reflect(WanfaJxgcIcon.prototype,"WanfaJxgcIcon");var WanfaJztRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.d){this.con.visible=!0,this.tip.visible=!1,this.tRank.text=this.data.rank,this.tName.text=this.data.d.name,this.tName.textColor=this.data.d.roleId==GmGlobal.mc.role.roleId?Colors.GREEN:1197947;var t=this.data.d.data%1e4,e=0,i=0,s=!1;t>1e3?(s=!0,e=Math.floor(t/1e3),i=1e3-t%1e3):(e=t%10,i=Math.floor(t/10));var o=s?"Step "+i:"";this.tData.textFlow=TextFormat.parser.parse((s?TextFormat.setColor("Cleared",Colors.GREEN):TextFormat.setColor("Not cleared",Colors.RED))+" "+TextFormat.setColor(GmGlobal.mc.wfMgr.getSyDiffName(e),GmGlobal.mc.wfMgr.getSyDiffColor(e))+" "+o);var n=GmGlobal.mc.wfMgr.getJztCfg();this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(n.aws[this.data.rank],100,!1,!0,!0),this._itemGridCon.addToParent(10,0,this.itemCon,this.txtCon),this._itemGridCon.setTouchCb(!0)}else this.con.visible=!1,this.tip.visible=!0},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(WanfaJztRankItem.prototype,"WanfaJztRankItem");var WanfaJztRankView=function(t){function e(){var e=t.call(this,"WanfaJztRankSkin")||this;return e._viewIndex=1,e._needGetData=!1,e._maxNum=10,e._sNo=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="WanfaJztRankItemSkin",this.itemList.itemRenderer=WanfaJztRankItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.mc.rankMgr.getRank(RankID.JZT),s=Math.ceil(i.myRank/this._maxNum)*this._maxNum,o=s-this._maxNum;this._sNo=GmGlobal.cc.rankCtl.getRankData(RankID.JZT,o,this._maxNum,null,this.updateRankList,this)},e.prototype.updateRankList=function(t){this.scoll.viewport.scrollV=0,this.scoll.stopAnimation(),this._array.removeAll();for(var e=Math.ceil(t.myRank/this._maxNum)*this._maxNum,i=e-this._maxNum,s=i;e>s;s++)this._array.addItem({rank:s+1-i,d:t.getDataByRank(s+1)})},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_JZT_R)},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaJztRankView.prototype,"WanfaJztRankView");var WanfaJztSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="WanfaJztSceneUISkin",e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.show=function(e){t.prototype.show.call(this,e),this._touzi=new eui.Image("wanfa_json.saizi"),this._touzi.anchorOffsetX=39,this._touzi.anchorOffsetY=42,this._touzi.scaleX=this._touzi.scaleY=1.3,this._touzi.x=this._tzX=this.width/2,this._touzi.y=this._tzY=GmGlobal.stageHeight/2-this.y,this._touzi.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTZ,this),this.startTzEffect(),this.updFhNum(),EventBus.addListener(EventType.JZT_RANDOM,this.showTz,this),EventBus.addListener(EventType.JZT_ALIVE,this.updFhNum,this)},e.prototype.startTzEffect=function(){egret.Tween.removeTweens(this._touzi),this._touzi.x=this._tzX,this._touzi.y=this._tzY,egret.Tween.get(this._touzi,{loop:!0}).to({y:this._tzY-10},500).to({y:this._tzY+10},1e3).to({y:this._tzY},500)},e.prototype.onTZ=function(){this.removeChild(this._touzi),this.showTzEffect()},e.prototype.showTzEffect=function(){this._tzEffect||(this._tzEffect=new MovieClipEx("touzi")),this._tzEffect.parent||this.addChild(this._tzEffect),this._tzEffect.x=this._touzi.x,this._tzEffect.y=this._touzi.y,this._tzEffect.play(),GameTick.instence().setTimeOut(1,this.onTzEnd,this)},e.prototype.onTzEnd=function(){this._tzEffect.stop(),this._tzEffect.parent&&this._tzEffect.parent.removeChild(this._tzEffect),CmdBus.doCmd(CmdType.JZT_TOPOS,GmGlobal.mc.wfMgr.jztRandom)},e.prototype.showTz=function(){this._touzi.parent||(this.addChild(this._touzi),this.startTzEffect())},e.prototype.updFhNum=function(){this.tFh.text="Revival Chances："+GmGlobal.mc.wfMgr.fhNum},e.prototype.close=function(){this._touzi.parent&&this._touzi.parent.removeChild(this._touzi),t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(WanfaJztSceneUI.prototype,"WanfaJztSceneUI");var WanfaJztView=function(t){function e(){var e=t.call(this,"WanfaJztSkin")||this;return e._bw=158,e._space=60,e._prex=0,e._moveX=0,e._selDiff=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bAw.sound=null,this._scRect=new egret.Rectangle(0,0,594,this.itemCon.height)},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bNRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this.bEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.itemCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),EventBus.addListener(EventType.M_JUPD+JsonID.JZTXB,this.updateData,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bNRank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this.bEnter.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.itemCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),EventBus.rmListener(EventType.M_JUPD+JsonID.JZTXB,this.updateData,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!1),this.updateData(),this.updateDList(),this.itemCon.validateNow(),this.itemCon.visible=!1,egret.setTimeout(this.onTimeOut,this,100)},e.prototype.onTimeOut=function(){this.itemCon.visible=!0,this.itemCon.scrollRect=this._scRect,this.moveToDiff(this._selDiff,!1)},e.prototype.updateData=function(){var t=GmGlobal.mc,e=t.wfMgr.getJztCfg(),i=t.dataMgr.getJData(JsonID.JZTXB),s=void 0==i.data.cnt?e.cnt:i.data.cnt;this.tNum.text="Daily Challenges："+s,Utils.setBtnEnable(this.bEnter,0==s?!1:!0),i.data.b==e.bprice.length?this.buyCon.visible=!1:(this.buyCon.visible=!0,this.tPrice.text=t.wfMgr.getJztBuyCost(i.data.b||0).toString())},e.prototype.updateDList=function(){for(var t=7,e=0;t>=e;e++)if(e>0&&t-1>=e){var i=new eui.Image("wanfa_json.d_"+e);i.anchorOffsetX=this._bw/2,i.anchorOffsetY=28,i.x=this._bw/2+e*(this._bw+this._space),i.y=60,this.itemCon.addChild(i),1==e&&(this._selDiff=e,i.scaleX=1.2,i.scaleY=1.2,i.y=25)}this.itemCon.width=8*this._bw+7*this._space},e.prototype.selDiff=function(t){if(this._selDiff>0){var e=this.itemCon.getChildAt(this._selDiff-1);e.scaleX=e.scaleY=1,e.y=60}var i=this.itemCon.getChildAt(t-1);i.scaleX=i.scaleY=1.2,i.y=25,this._selDiff=t,this.sel1.visible=!1,this.sel2.visible=!1,this.itemCon.validateNow(),this.itemCon.scrollRect=this._scRect,this.moveToDiff(this._selDiff)},e.prototype.onList=function(t){var e=this.itemCon.getChildIndex(t.target)+1;0!=e&&e!=this._selDiff&&this.selDiff(e)},e.prototype.onTouchBegin=function(t){this._prex=t.stageX,this._moveX=0},e.prototype.onTouchMove=function(t){var e=t.stageX-this._prex;this._moveX+=e,this._scRect.x-=e,this.itemCon.scrollRect=this._scRect,this._prex=t.stageX},e.prototype.onTouchEnd=function(t){var e=1;this._scRect.x>109&&(e=Math.floor((this._scRect.x-109)/188)+2),1>e?e=1:e>6&&(e=6),this.selDiff(e)},e.prototype.moveToDiff=function(t,e){void 0===e&&(e=!0),egret.Tween.removeTweens(this._scRect);var i=218*(t-1);i!=this._scRect.x&&(e?egret.Tween.get(this._scRect,{onChange:this.onScRectChange,onChangeObj:this}).to({x:i},200).call(this.onMEnd,this):(this._scRect.x=i,this.itemCon.scrollRect=this._scRect))},e.prototype.onScRectChange=function(){this.itemCon.scrollRect=this._scRect},e.prototype.onMEnd=function(){this.sel1.visible=!0,this.sel2.visible=!0},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getJztCfg().rule)},e.prototype.onAw=function(){var t=GmGlobal.mc.wfMgr.getJztCfg();CmdBus.doCmd(CmdType.O_JXGC_AW,1,t.items,"Chance to get")},e.prototype.onRank=function(){var t=GmGlobal.mc.rankMgr.getRank(RankID.JZT);return t.myRank?void CmdBus.doCmd(CmdType.O_JZT_R):void MsgBox.prompt("You don't have group rankings yet")},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.JZT_F,[this._selDiff],this.onOk,this)},e.prototype.onOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.onAdd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.JZT_BUY)},e.prototype.close=function(){for(;this.itemCon.numChildren>0;)this.itemCon.removeChildAt(0);t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("jzt_bg_jpg")},e}(UIBase);__reflect(WanfaJztView.prototype,"WanfaJztView");var WanfaListItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t="resource/ui/wanfa/wfbg_"+this.data+".jpg",e=GmGlobal.res.getVersion(t);e>1&&(t+="."+e),this.bg.source=PFConst.RES_ROOT+t,this.rd.visible=!1,this.timeBg.visible=!1,this.timeTxt.visible=!1;var i=GmGlobal.mc.wfMgr;if(this.data<=13){var s=i.redDot,o=s.childs[this.data-1];this.rd.visible=1==o.state?!0:!1}else this.rd.visible=!1;4==this.data?(this.timeBg.visible=!0,this.timeTxt.visible=!0,this.timeTxt.text="Daily "+Utils.formatTime(i.getTbStartTime(),"h:m")+" Available",this.timeBg.width=this.timeTxt.width+45):5==this.data?(this.timeBg.visible=!0,this.timeTxt.visible=!0,this.timeTxt.text="Daily "+Utils.formatTime(i.getWzStartTime(),"h:m")+" Available",this.timeBg.width=this.timeTxt.width+45):9==this.data?(this.timeBg.visible=!0,this.timeTxt.visible=!0,this.timeTxt.text=GmGlobal.mc.ghMgr.oTime,this.timeBg.width=this.timeTxt.width+45):10==this.data?(this.timeBg.visible=!0,this.timeTxt.visible=!0,this.timeTxt.text=GmGlobal.mc.ghMgr.hzDes,this.timeBg.width=this.timeTxt.width+45):12==this.data&&(this.timeBg.visible=!0,this.timeTxt.visible=!0,this.timeTxt.text=GmGlobal.mc.wfMgr.getMaomaoCfg().time,this.timeBg.width=this.timeTxt.width+45)},e}(eui.ItemRenderer);__reflect(WanfaListItem.prototype,"WanfaListItem");var WanfaListView=function(t){function e(){return t.call(this,"WanfaListViewSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="WanfaListItemSkin",this.itemList.itemRenderer=WanfaListItem;var e=[1,2,3,6,7,13,8,11,14,4,5,9,12,10];GmGlobal.IS_DEBUG&&(e=[1,2,3,6,7,13,8,11,14,4,5,9,12,10]);for(var i=0;i<e.length;i++)this._array.addItem(e[i])},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.checkGuide()},e.prototype.onList=function(t){var e=t.target.data;switch(e){case 1:case 2:case 3:case 4:case 5:CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose();break;case 6:var i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.JXGC,!0);i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose());break;case 7:i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.SYHY,!0),i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose());break;case 8:i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.BRDC,!0),i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose());break;case 9:this.checkGh()&&(TaskGo.getInstance().start(6705,2),this.onClose());break;case 10:this.checkGh()&&(TaskGo.getInstance().start(6705,3),this.onClose());
break;case 11:i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.MOKU,!0),i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose());break;case 12:i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.MAOMAO,!0),i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose());break;case 13:i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.SWSX,!0),i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose());break;case 14:i=GmGlobal.mc.guideMgr.isModeuleOpen(ModelID.JZTXB,!0),i&&(CmdBus.doCmd(CmdType.O_WANFA,e-1),this.onClose())}var s=GmGlobal.vmc.mGuide;s.guideData&&s.triggerTargetByID(GuideTargetId.TAB_SEL)},e.prototype.checkGh=function(){var t=GmGlobal.mc.ghMgr;return t.id?!0:(MsgBox.prompt("Join the guild to join this event"),!1)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;if(t.guideData){var e=-1;if(t.guideData.id==GuideID.ARENA||t.guideData.id==GuideID.ARENA2?e=0:t.guideData.id==GuideID.TOWER&&(e=1),-1!=e){var i=this.x+this.scoll.x,s=this.y+this.scoll.y+210*e;t.bindTargetRect(GuideTargetId.TAB_SEL,new egret.Rectangle(i,s,647,195),new egret.Point(i+324,s+98))}}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_WF_LST)},e}(UIBase);__reflect(WanfaListView.prototype,"WanfaListView");var WanfaManager=function(){function t(){this.isYbAction=!0,this.syBuffId=0,this.ctBuffId=0,this.ctNextMst=-1e4,this.mmCatInfo={},this._teamXz={};var t=GmGlobal.mc;t.regUnzipCfg("c_arena.json",this.initAreanCfg,this),t.regUnzipCfg("c_chuangta.json",this.initChuangtaCfg,this),t.regUnzipCfg("c_tanbao.json",this.initTanbaoCfg,this),t.regUnzipCfg("c_yabiao.json",this.initYabiaoCfg,this),t.regUnzipCfg("c_wangzuo.json",this.initWzCfg,this),t.regUnzipCfg("c_jxgc.json",this.initJxgcCfg,this),t.regUnzipCfg("c_sheny.json",this.initSyCfg,this),t.regUnzipCfg("c_daochang.json",this.initDcCfg,this),t.regUnzipCfg("c_moku.json",this.initMkCfg,this),t.regUnzipCfg("c_maomao.json",this.initMmCfg,this),t.regUnzipCfg("c_swsx.json",this.initSxCfg,this),t.regUnzipCfg("c_jztxb.json",this.initJztCfg,this),this._wfDatas={},this.initRedDot()}return t.prototype.initRedDot=function(){for(var t={},e=0;13>e;e++)if(0==e){var i={0:0,1:0};t[e]=i}else 1==e?t[e]={0:0}:7==e?t[e]={0:0,1:0,2:0}:t[e]=0;this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.WANFA,this.redDot),this.yckjRedDot=RedDot.initRedDot({0:0}),GmGlobal.mc.muiMgr.regRedDot(ModelID.YCKJ,this.yckjRedDot)},t.prototype.initAreanCfg=function(t){this._arenaCfg=t},t.prototype.initChuangtaCfg=function(t){this._chuangtaCfg=t},t.prototype.initTanbaoCfg=function(t){this._tanbaoCfg=t},t.prototype.initYabiaoCfg=function(t){this._yabiaoCfg=t},t.prototype.initWzCfg=function(t){this._wzCfg=t},t.prototype.initJxgcCfg=function(t){this._jxgcCfg=t},t.prototype.initMkCfg=function(t){this._mkCfg=t},t.prototype.initSyCfg=function(t){this._syCfg=t},t.prototype.initDcCfg=function(t){this._dcCfg=t},t.prototype.initMmCfg=function(t){this._mmCfg=t},t.prototype.initSxCfg=function(t){this._sxCfg=t},t.prototype.initJztCfg=function(t){this._jztCfg=t},t.prototype.getArenaFightNum=function(){return this._arenaCfg.fightNum},t.prototype.getArenaMaxBuyNum=function(){return this._arenaCfg.maxBuyNum},t.prototype.getArenaAddPrice=function(t){var e=this._arenaCfg.maxBuyNum-t;return e>=this._arenaCfg.buyPrice.length?this._arenaCfg.buyPrice[this._arenaCfg.buyPrice.length-1]:this._arenaCfg.buyPrice[e]},t.prototype.getArenaRefreshPrice=function(t){return t<this._arenaCfg.rPrice.length?this._arenaCfg.rPrice[t]:this._arenaCfg.rPrice[this._arenaCfg.rPrice.length-1]},t.prototype.getArenaFreeCD=function(){return this._arenaCfg.freeCD},t.prototype.getArenaRule=function(){return this._arenaCfg.rule},t.prototype.getArenaJfAwList=function(){return this._arenaCfg.jifen},t.prototype.getArenaJsAwList=function(){return this._arenaCfg.jisai},t.prototype.getArenaFjJf=function(){return this._arenaCfg.fjjf},t.prototype.getArenaFjMax=function(){return this._arenaCfg.fjmax},t.prototype.getArenaRankStep=function(t){var e=.3*(t-3)/5;return 1>e?e=1:e>25&&(e=25),e=Math.floor(e)},t.prototype.getArenaRankIdList=function(t){if(3>=t)return[1,2,3,4,5,6,7,8];if(9>=t){for(var e=[1,2,3],i=4;9>=i;i++)i!=t&&e.push(i);return e}for(var s=this.getArenaRankStep(t),e=[1,2,3],i=5;i>=1;i--)e.push(t-i*s-Math.floor(Math.random()*s));return e},t.prototype.getArenaJsIdList=function(){for(var t=this._arenaCfg.jisai,e=[],i=0;i<t.length;i++){var s=t[i];s.rankto?e.push(s.rankto):e.push(s.rank)}return e},t.prototype.getArenaJsCD=function(){var t=1626969600,e=259200,i=GmGlobal.getServerTime();return e-(i-t)%e},t.prototype.getCtRule=function(){return this._chuangtaCfg.rule},t.prototype.getCtSdVip=function(){return this._chuangtaCfg.sdvip},t.prototype.getCtPtAw=function(){return this._chuangtaCfg.ptaws},t.prototype.getCtSyAw=function(){return this._chuangtaCfg.syaws},t.prototype.getCtMaxFloor=function(){return this._chuangtaCfg.fmax},t.prototype.getCtCd=function(){return this._chuangtaCfg.ftime},t.prototype.getCtSyCd=function(){return this._chuangtaCfg.sytime},t.prototype.getTbRule=function(){return this._tanbaoCfg.rule},t.prototype.getTbStartTime=function(){return this._tanbaoCfg.startTime},t.prototype.getTbAws=function(){return this._tanbaoCfg.aws},t.prototype.getTbDtQuestion=function(t){return this._tanbaoCfg.dtquestion[t]},t.prototype.getTbXzQuestion=function(t){return this._tanbaoCfg.xzquestion[t]},t.prototype.getTbCfg=function(){return this._tanbaoCfg},t.prototype.getYbCfg=function(){return this._yabiaoCfg},t.prototype.getYbRule=function(){return this._yabiaoCfg.rule},t.prototype.getYbRCost=function(t){var e=this._yabiaoCfg.rPrice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getYbJbCost=function(t){var e=this._yabiaoCfg.jbBuyPrice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getYbYbCost=function(t){var e=this._yabiaoCfg.ybBuyPrice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getWangzuoCfg=function(){return this._wzCfg},t.prototype.getWzStartTime=function(){return this._wzCfg.startTime},t.prototype.getJxgcCfg=function(){return this._jxgcCfg},t.prototype.getJxgcBuyCost=function(t){var e=this._jxgcCfg.bprice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getMkCfg=function(){return this._mkCfg},t.prototype.getMkBuyCost=function(t){var e=this._mkCfg.bprice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getMkNextCdTime=function(){for(var t=this._mkCfg.cdtime,e=Utils.getTodaySecond(),i=0;i<t.length;i++)if(e<t[i])return t[i]-e;return-1},t.prototype.getSyCfg=function(){return this._syCfg},t.prototype.getSyBuyCost=function(t){var e=this._syCfg.buycntprice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getDcCfg=function(){return this._dcCfg},t.prototype.getDcBuyCost=function(t){var e=this._dcCfg.buycntprice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getMaomaoCfg=function(){return this._mmCfg},t.prototype.getSxCfg=function(){return this._sxCfg},t.prototype.getJztCfg=function(){return this._jztCfg},t.prototype.getJztBuyCost=function(t){var e=this._jztCfg.bprice;return t<e.length?e[t]:e[e.length-1]},t.prototype.getWfData=function(t){var e=this._wfDatas[t];return e||(e=new WanfaData,e.id=FubenType.getClientType(t),e.sceneId=t,this._wfDatas[e.id]=e),e},t.prototype.getWzNameByMapid=function(t){switch(t){case FubenType.WANGZUO:return"Titan";case FubenType.WANGZUO2:return"Starfall";case FubenType.WANGZUO3:return"Element";case FubenType.WANGZUO4:return"Thunder";case FubenType.WANGZUO5:return"Shield";case FubenType.WANGZUO6:return"Space";case FubenType.WANGZUO7:return"Blood";case FubenType.WANGZUO8:return"Glacier";case FubenType.WANGZUO9:return"Rebirth";case FubenType.WANGZUO10:return"Spirit";default:return""}},t.prototype.getBcQColor=function(t){switch(t){case 2:return 7575762;case 3:return 14058477;case 4:return 16629248;default:return 11645361}},t.prototype.getBcName=function(t){switch(t){case 2:return"Silver Escort Cart";case 3:return"Gold Escort Cart";case 4:return"Legend Escort Cart";default:return"Normal Escort Cart"}},t.prototype.getSyDiffName=function(t){switch(t){case 2:return"Normal";case 3:return"Hard";case 4:return"Abyss";case 5:return"Nightmare";case 6:return"Legend";default:return"Basic"}},t.prototype.getSyDiffColor=function(t){switch(t){case 2:return 10848767;case 3:return 14232831;case 4:return 16725404;case 5:return 16731951;case 6:return 16770409;default:return 2707455}},t.prototype.setTeamXz=function(t){this._teamXz[t]=GmGlobal.getServerTime()},t.prototype.hasTeamXz=function(t){var e=this._teamXz[t]||0,i=GmGlobal.getServerTime();return i-e>10?(delete this._teamXz[t],!1):!0},t.prototype.getKfWeek=function(t){return t==FubenType.JXGC?this._jxgcCfg.crossserverday:t==FubenType.MK01?this._mkCfg.crossserverday:t==FubenType.SWSX?this._sxCfg.crossserverday:null},t}();__reflect(WanfaManager.prototype,"WanfaManager");var WanfaMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.WANFA,CmdType.O_WF_LST),CmdBus.adListener(CmdType.O_WF_LST,this.onOpenListView,this),CmdBus.adListener(CmdType.C_WF_LST,this.onCloseListView,this),CmdBus.adListener(CmdType.O_WANFA,this.onOpenView,this),CmdBus.adListener(CmdType.C_WANFA,this.onCloseView,this),CmdBus.adListener(CmdType.O_ARENA_JFAW,this.showArenaJfAw,this),CmdBus.adListener(CmdType.C_ARENA_JFAW,this.closeArenaJfAw,this),CmdBus.adListener(CmdType.O_ARENA_JS,this.showArenaJsAw,this),CmdBus.adListener(CmdType.C_ARENA_JS,this.closeArenaJsAw,this),CmdBus.adListener(CmdType.O_ARENA_ZB,this.showArenaZb,this),CmdBus.adListener(CmdType.C_ARENA_ZB,this.closeArenaZb,this),CmdBus.adListener(CmdType.O_WZ_AW,this.showWzAw,this),CmdBus.adListener(CmdType.C_WZ_AW,this.closeWzAw,this),CmdBus.adListener(CmdType.O_JXGC_AW,this.showJxgcAw,this),CmdBus.adListener(CmdType.C_JXGC_AW,this.closeJxgcAw,this),CmdBus.adListener(CmdType.O_SY_AW,this.showSyAw,this),CmdBus.adListener(CmdType.C_SY_AW,this.closeSyAw,this),CmdBus.adListener(CmdType.O_SY_RANK,this.showSyRank,this),CmdBus.adListener(CmdType.C_SY_RANK,this.closeSyRank,this),CmdBus.adListener(CmdType.O_JZT_R,this.showJztRank,this),CmdBus.adListener(CmdType.C_JZT_R,this.closeJztRank,this),CmdBus.adListener(CmdType.DO_EXIT_FB,this.onExitFb,this),EventBus.addListener(EventType.M_JUPD+JsonID.CT_SDAW,this.onCtSdSw,this),EventBus.addListener(EventType.M_JUPD+JsonID.FB_OPEN,this.onHdOpen,this),EventBus.addListener(EventType.M_JUPD+JsonID.FB_CLOSE,this.onHdClose,this),EventBus.addListener(EventType.M_MUI_READY,this.onMuiReady,this),EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this),EventBus.addListener(EventType.LEAVE_SCENE,this.onLeaveScene,this),CmdBus.adListener(CmdType.O_DC_ZB,this.showDcZb,this),CmdBus.adListener(CmdType.C_DC_ZB,this.closeDcZb,this),CmdBus.adListener(CmdType.O_MM_JFAW,this.showMMjf,this),CmdBus.adListener(CmdType.C_MM_JFAW,this.closeMMjf,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.BOSS_FB,this.onBossFb,this)}return t.prototype.onEnterScene=function(t){var e=GmGlobal.mc,i=GmGlobal.mc.sceneMgr,s=FubenType.getClientType(i.mapId);if(s==FubenType.TB_DATI){TanbaoSceneUI.getInstance().show(GmGlobal.vmc.uiLayer);var o=e.wfMgr.getWfData(FubenType.TB_DATI);1==o.subTyoe&&o.data?DatiView.getInstence().show(GmGlobal.vmc.uiLayer):3==o.subTyoe&&o.data&&XzDatiView.getInstence().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)}else s==FubenType.CT_PT?(CtSceneUI.getInstence().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)):s==FubenType.GH_BOSS?(GHBossSceneUI.getInstance().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_GONGHUI)):s==FubenType.WANGZUO?(WZSceneUI.getInstance().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)):s==FubenType.YABIAO_Y||s==FubenType.YABIAO_J?(YBSceneUI.getInstence().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)):s==FubenType.GHZ?(GHBattleSceneUI.getInstance().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_GONGHUI)):s==FubenType.JXGC?(CmdBus.doCmd(CmdType.C_WANFA),JxgcSceneUI.getInstence().show(GmGlobal.vmc.uiLayer)):s==FubenType.SHENY?(ShenySceneUI.getInstence().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)):s==FubenType.DAOC?CmdBus.doCmd(CmdType.C_WANFA):s==FubenType.MK01?(WanfaMkSceneUI.getInstence().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)):s==FubenType.MAOMAO?MaoMaoSceneUI.getInstence().show(GmGlobal.vmc.uiLayer):s==FubenType.SWSX?(WanfaSxSceneUI.getInstence().show(GmGlobal.vmc.uiLayer),CmdBus.doCmd(CmdType.C_WANFA)):s==FubenType.JZTXB&&WanfaJztSceneUI.getInstence().show(GmGlobal.vmc.uiLayer)},t.prototype.onLeaveScene=function(t){var e=t.data.pid,i=(t.data.cid,FubenType.getClientType(e)),s=GmGlobal.mc;if(i==FubenType.TB_DATI){TanbaoSceneUI.release(),DatiView.release(),XzDatiView.release();var o=s.wfMgr.getWfData(FubenType.TB_DATI);o.data=null,o.isEnd=!1,CmdBus.doCmd(CmdType.O_WANFA,3)}else i==FubenType.CT_PT?CtSceneUI.release():i==FubenType.WANGZUO?(CmdBus.doCmd(CmdType.O_WANFA,4),WZSceneUI.release()):i==FubenType.GH_BOSS?(CmdBus.doCmd(CmdType.O_GONGHUI,2),GHBossSceneUI.release()):i==FubenType.GHZ?(CmdBus.doCmd(CmdType.O_GONGHUI,3),GHBattleSceneUI.release()):i==FubenType.YABIAO_Y||i==FubenType.YABIAO_J?YBSceneUI.release():i==FubenType.YABIAO_F||i==FubenType.ARENA?PVPSceneUI.release():i==FubenType.JXGC?JxgcSceneUI.release():i==FubenType.SHENY?ShenySceneUI.release():i==FubenType.DAOC?(PVPSceneUI.release(),CmdBus.doCmd(CmdType.O_WANFA,7)):i==FubenType.MK01?WanfaMkSceneUI.release():i==FubenType.MAOMAO?(MaoMaoSceneUI.release(),GmGlobal.mc.wfMgr.mmCatInfo={}):i==FubenType.SWSX?WanfaSxSceneUI.release():i==FubenType.JZTXB&&WanfaJztSceneUI.release();BossSceneUI.release()},t.prototype.onMuiReady=function(){var t=GmGlobal.cc;t.wfCtl.updateRedDots()},t.prototype.onExitFb=function(t){t==FubenType.YABIAO_Y||t==FubenType.YABIAO_J?this.onOpenView(2):t==FubenType.JXGC&&this.onOpenView(5)},t.prototype.onTbRet=function(t){if(t){var e=GmGlobal.mc.wfMgr,i=1==t.eventid?FubenType.TB_DATI:2==t.eventid?FubenType.TB_BOSS:FubenType.TB_XINGZUO,s=e.getWfData(i);s.startTime=t.begintime,s.endTime=t.endtime,s.subTyoe=t.eventid,EventBus.dispatchEvt(EventType.HD_STATE_UPD,i)}},t.prototype.onWzRet=function(t){var e=GmGlobal.mc.wfMgr,i=e.getWfData(FubenType.WANGZUO);i.startTime=t.begintime,i.endTime=t.endtime,EventBus.dispatchEvt(EventType.HD_STATE_UPD,FubenType.WANGZUO)},t.prototype.onCtSdSw=function(t){var e=t.data.data,i=null;for(var s in e)i||(i=[]),i.push({id:Number(s),num:e[s]});i&&AwardTipView.showAward(i)},t.prototype.onBossFb=function(t){var e=t.et-GmGlobal.getServerTime();if(e>0){var i=BossSceneUI.getInstance();i.setCD(e),i.show(GmGlobal.vmc.uiLayer)}},t.prototype.onHdOpen=function(t){var e=t.data.data,i=GmGlobal.mc.wfMgr.getWfData(e.fbid);i.startTime=e.begintime,i.endTime=e.endtime,i.subTyoe=e.eventid;var s=FubenType.getFubenModelId(e.fbid);if(!(s>0)||GmGlobal.mc.guideMgr.isModeuleOpen(s)){var o=GmGlobal.mc.sceneMgr;if(o.mapType!=SceneType.FUBEN){if(EventBus.dispatchEvt(EventType.HD_STATE_UPD,i.id),!e.hide){var n=FubenType.getFubenName(e.fbid)+" starting soon，go now?";MsgBox.alert2(n,this.onOpenHd,this,e.fbid)}e.fbid==FubenType.YCKJ&&(GmGlobal.mc.wfMgr.yckjRedDot.state=1)}}},t.prototype.onOpenHd=function(t){if(t){var e=FubenType.getFubenOpenCmd(t);e&&(BattleWinView.getInstence().close(),BattleFailView.getInstence().close(),CmdBus.doCmd(e.cmd,e.a))}},t.prototype.onHdClose=function(t){var e=t.data.data,i=GmGlobal.mc.wfMgr,s=i.getWfData(e.fbid);s.startTime=e.begintime,s.endTime=e.begintime,s.subTyoe=e.eventid;var o=FubenType.getClientType(e.fbid);if(o==FubenType.WANGZUO){var n=i.getWfData(FubenType.WANGZUO);n.data=null}EventBus.dispatchEvt(EventType.HD_CLOSE,e.fbid)},t.prototype.onOpenListView=function(){this._listView||(this._listView=new WanfaListView),this._listView.isShow||this._listView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseListView=function(){this._listView&&this._listView.isShow&&(this._listView.alphaClose(this._listView.close,this._listView),this._listView=null)},t.prototype.onOpenView=function(t){this._showIndex=t||0;var e=null;e=7==t?"daoc":"wanfa",this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new WanfaView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this)),this._view.selTab(this._showIndex)},t.prototype.onCloseView=function(){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.showArenaJfAw=function(){this._arenaJfAw||(this._arenaJfAw=new ArenaJFView),this._arenaJfAw.isShow||this._arenaJfAw.show(GmGlobal.vmc.uiLayer)},t.prototype.closeArenaJfAw=function(){this._arenaJfAw&&this._arenaJfAw.close()},t.prototype.showArenaJsAw=function(){this._arenaJsAw||(this._arenaJsAw=new ArenaJsView),this._arenaJsAw.isShow||this._arenaJsAw.show(GmGlobal.vmc.uiLayer)},t.prototype.closeArenaJsAw=function(){this._arenaJsAw&&this._arenaJsAw.close()},t.prototype.showArenaZb=function(){this._arenaZb||(this._arenaZb=new ArenaZbView),this._arenaZb.isShow||this._arenaZb.show(GmGlobal.vmc.uiLayer)},t.prototype.closeArenaZb=function(){this._arenaZb&&this._arenaZb.close()},t.prototype.showWzAw=function(){this._wzAw||(this._wzAw=new WangzuoAwView),this._wzAw.isShow||this._wzAw.show(GmGlobal.vmc.uiLayer)},t.prototype.closeWzAw=function(){this._wzAw&&this._wzAw.close()},t.prototype.showJxgcAw=function(t,e,i){void 0===i&&(i=null),this._jxgcAw||(this._jxgcAw=new WanfaJxgcAwView),this._jxgcAw.isShow||this._jxgcAw.show(GmGlobal.vmc.uiLayer),this._jxgcAw.setType(t,e,i)},t.prototype.closeJxgcAw=function(){this._jxgcAw&&this._jxgcAw.close()},t.prototype.showSyAw=function(){this._syAw||(this._syAw=new WanfaShenyAwView),this._syAw.isShow||this._syAw.show(GmGlobal.vmc.uiLayer)},t.prototype.closeSyAw=function(){this._syAw&&this._syAw.close()},t.prototype.showSyRank=function(){this._syRank||(this._syRank=new WanfaShenyNrRank),this._syRank.isShow||this._syRank.show(GmGlobal.vmc.uiLayer)},t.prototype.closeSyRank=function(){this._syRank&&this._syRank.close()},t.prototype.showJztRank=function(){this._jztRank||(this._jztRank=new WanfaJztRankView),this._jztRank.isShow||this._jztRank.show(GmGlobal.vmc.uiLayer)},t.prototype.closeJztRank=function(){this._jztRank&&this._jztRank.close()},t.prototype.showDcZb=function(){this._dcZbView||(this._dcZbView=new WanfaDcZbView),this._dcZbView.isShow||this._dcZbView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeDcZb=function(){this._dcZbView&&this._dcZbView.close()},t.prototype.showMMjf=function(){this._mmJfawView||(this._mmJfawView=new WanfaMMJfView),this._mmJfawView.isShow||this._mmJfawView.show(GmGlobal.vmc.uiLayer)},t.prototype.closeMMjf=function(){this._mmJfawView&&this._mmJfawView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._arenaJfAw=null,this._arenaJsAw=null,this._arenaZb=null,this._wzAw=null,this._syAw=null,this._syRank=null,this._dcZbView=null,this._mmJfawView=null,!0):!1:!0},t}();__reflect(WanfaMediator.prototype,"WanfaMediator",["IMediator"]);var WanfaMkSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="WanfaMkSceneUISkin",e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.onResize=function(){t.prototype.onResize.call(this);var e=GmGlobal.vmc.scene.currenScene;if(this.bAw.x=Math.min(e.x+e.blockMap.width-this.bAw.anchorOffsetX-this.x,GmGlobal.stageWidth-this.bAw.anchorOffsetX-this.x),this._cdIcon){GmConst.IS_FULLSCENE?this._cdIcon.y=GmGlobal.stageHeight-this.y-300-this._cdIcon.height-this._cdIcon.anchorOffsetY-GmConst.BOTTOM_SPACE:this._cdIcon.y=GmGlobal.stageHeight-this.y-300-this._cdIcon.height-this._cdIcon.anchorOffsetY;var i=GmGlobal.vmc.scene.currenScene;this._cdIcon.x=Math.min(i.x+i.blockMap.width-this._cdIcon.anchorOffsetX-2,GmGlobal.stageWidth-this._cdIcon.anchorOffsetX-2)-this.x}},e.prototype.getAwBtn=function(){return this.bAw},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.wfMgr.getJxgcCfg();this.setCDTime(i.time),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.MK_SINFO,this.onInfo,this),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.MK_CDBOSS,this.onCdState,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAw,this)},e.prototype.onInfo=function(t){if(this.LayerNum.text="Floor "+t.f,this.mstNum.text="Monsters left："+t.num,t.et){var e=t.et-GmGlobal.getServerTime();this.setCDTime(e)}if(0==t.num&&(DelayTimeView.isShow()||DelayTimeView.getInstence().show(GmGlobal.vmc.uiLayer,3,"All monsters killed，%s sec to next floor",this.onDelayTimeEnd,this)),t.buffid){var i=GmGlobal.mc.btMgr.getFbBuffCfg(t.buffid);i&&(this.tTx.text=i)}},e.prototype.onDelayTimeEnd=function(){},e.prototype.setCDTime=function(t){t>0?CDText.getInstence().addCD(this.hdTime,t,"Dungeon Countdown: ","m:s"):this.hdTime.text="Dungeon Countdown: 00:00"},e.prototype.onGetAw=function(){GmGlobal.cc.dataCtl.pbReq(PbReqId.MK_QAW,null,null,this.onAwRet,this),Utils.lockBtn(this.bAw,2e3)},e.prototype.onAwRet=function(t,e){var i=[];for(var s in e)i.push({id:Number(s),num:e[s]});CmdBus.doCmd(CmdType.O_JXGC_AW,2,i)},e.prototype.onCdState=function(t){0==t.alive?this.showCdIcon():this.rmCdIcon()},e.prototype.showCdIcon=function(){this._cdIcon||(this._cdIcon=new eui.Image("moku_cd_png"),this._cdIcon.anchorOffsetX=50,this._cdIcon.anchorOffsetY=50),this._cdIcon.parent||(this.addChild(this._cdIcon),this._cdIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCdBtn,this),this.onResize())},e.prototype.rmCdIcon=function(){this._cdIcon&&(this._cdIcon.parent&&(this.removeChild(this._cdIcon),this._cdIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCdBtn,this)),this._cdIcon=null)},e.prototype.onCdBtn=function(){GmGlobal.cc.dataCtl.pbReq(PbReqId.MK_CDBOSS_F,null)},e.prototype.close=function(){this.rmCdIcon(),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.MK_SINFO),GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.MK_CDBOSS),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAw,this),t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(WanfaMkSceneUI.prototype,"WanfaMkSceneUI");var WanfaMkView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(e){t.prototype.show.call(this,e),this.checkCdTime()},e.prototype.checkCdTime=function(){var t=GmGlobal.mc.wfMgr.getMkNextCdTime();t>0?(this.tTime.visible=!0,CDText.getInstence().addCD(this.tTime,t,"Easter Egg Boss Spawn Countdown：","h:m:s","",this.checkCdTime,this)):this.tTime.visible=!1},e.prototype.getBgRes=function(){return"mk_bg_jpg"},e.prototype.getCfg=function(){return GmGlobal.mc.wfMgr.getMkCfg()},e.prototype.getData=function(){return GmGlobal.mc.dataMgr.getJData(JsonID.MK_UPD)},e.prototype.isThisFb=function(t){return t&&t[1].fid==FubenType.MK01?!0:!1},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this.getCfg().rule)},e.prototype.onCreate=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_CREATE,[FubenType.MK01])},e.prototype.onYq=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&FubenInvateView.show(t[1].roleid,FubenType.MK01)},e.prototype.onAdd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.MK_BUY)},e.prototype.clearTeamData=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&t[1].fid==FubenType.MK01&&(GmGlobal.mc.wfMgr.fbTeam=null)},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("mk_bg_jpg")},e}(WanfaJxgcView);__reflect(WanfaMkView.prototype,"WanfaMkView");var WanfaMMJfView=function(t){function e(){return t.call(this,"WanfaMMJfSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="JifenAwItemSkin2",this.itemList.itemRenderer=JifenAwItem2},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.scoll.viewport.scrollV=0,this.updateAwList()},e.prototype.updateAwList=function(){this._array.removeAll();for(var t=GmGlobal.mc.wfMgr.getMaomaoCfg().jifen,e=0,i=t;e<i.length;e++){var s=i[e];this._array.addItem(s)}},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_MM_JFAW)},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaMMJfView.prototype,"WanfaMMJfView");var WanfaMMView=function(t){function e(){return t.call(this,"WanfaMMSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),EventBus.addListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bEnter.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),EventBus.rmListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateState()},e.prototype.onHdStateUpd=function(t){var e=t.data;e==FubenType.MAOMAO&&this.updateState()},e.prototype.updateState=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.MAOMAO),i=GmGlobal.getServerTime();if(e.startTime&&i<e.endTime){Utils.setBtnEnable(this.bEnter,!0);var s=e.endTime-i;CDText.getInstence().addCD(this.tTime,s,"Event in progress, Left ","h:m:s","",this.onTimeOut,this)}else this.setNoOpenState()},e.prototype.setNoOpenState=function(){this.tTime.text=GmGlobal.mc.wfMgr.getMaomaoCfg().time,Utils.setBtnEnable(this.bEnter,!1)},e.prototype.onTimeOut=function(){this.setNoOpenState()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getMaomaoCfg().rule)},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_MM_JFAW)},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.MM_ENTER,null,this.onOk,this)},e.prototype.onOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("mm_bg_jpg")},e}(UIBase);__reflect(WanfaMMView.prototype,"WanfaMMView");var Tile=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispose=function(){this.data=null},e.prototype.isBlock=function(t,i,s,o){var n=this.data.length,r=this.data[0].length;return 0>s||s>=n||0>o||o>=r?e.PATH_UNKNOWN:this.data[s][o]},e.prototype.getTargetTile=function(t,e){return this.isBlock(0,0,t,e)},e.prototype.isPass=function(t,i){var s=this.data.length,o=this.data[0].length;return 0>t||t>=s||0>i||i>=o?!1:this.data[t][i]!=e.PATH_BARRIER?!0:!1},e.prototype.isPassPoint=function(t){return this.isPass(t.x,t.y)},e.prototype.isPassAToB=function(t,i,s,o,n){for(var r=new egret.Point(t,i),h=new egret.Point(s,o),a=egret.Point.distance(r,h),l=this.moveIncrement(r,h,n),c=0;a>c;){r=r.add(l),c+=n;var d=e.getTileStageToPoint(r.x,r.y);if(0==this.isPass(d.x,d.y))return!1}return!0},e.prototype.moveIncrement=function(t,e,i){var s=egret.Point.distance(t,e),o=i/s,n=(e.x-t.x)*o,r=(e.y-t.y)*o;return new egret.Point(n,r)},e.getNextPos=function(t,i,s){var o=new egret.Point;return o.x=t+e.DELTA_X[s],o.y=i+e.DELTA_Y[s],o},e.getTileStageToPoint=function(t,i){var s=t-2*i;0>s&&(s-=e.TILE_WIDTH);var o=2*i+t,n=(o+e.TITE_HALF_WIDTH)/e.TILE_WIDTH,r=(s+e.TITE_HALF_WIDTH)/e.TILE_WIDTH;return new egret.Point(e.OFFSET_TAB_X+n,e.OFFSET_TAB_Y+r)},e.getTilePointToStage=function(t,i){var s=new egret.Point,o=t-e.OFFSET_TAB_X,n=i-e.OFFSET_TAB_Y;return s.x=o*e.TITE_HALF_WIDTH+n*e.TITE_HALF_WIDTH,s.y=o*e.TITE_HALF_HEIGHT-n*e.TITE_HALF_HEIGHT,s},e.getTileStageToPointByOffset=function(t,i,s,o){var n=t-2*i;0>n&&(n-=e.TILE_WIDTH);var r=2*i+t,h=(r+e.TITE_HALF_WIDTH)/e.TILE_WIDTH,a=(n+e.TITE_HALF_WIDTH)/e.TILE_WIDTH;return new egret.Point(s+h,o+a)},e.getTilePointToStageByOffset=function(t,i,s,o){var n=new egret.Point,r=t-s,h=i-o;return n.x=r*e.TITE_HALF_WIDTH+h*e.TITE_HALF_WIDTH,n.y=r*e.TITE_HALF_HEIGHT-h*e.TITE_HALF_HEIGHT,n},e.createMapData=function(t,e,i,s){for(var o=new Array,n=t%i==0?t/i:t/i+1,r=e%s==0?e/s:e/s+1,h=0;n>h;h++){o[h]=new Array;for(var a=0;r>a;a++)o[h][2*a]=0,o[h][2*a+1]=0}return o},e.distance=function(t,e,i,s){var o=Math.abs(t-i),n=Math.abs(e-s);return Math.max(o,n)},e.direction=function(t,e,i,s){return i>t?s>e?6:e>s?2:3:t>i?s>e?8:e>s?4:7:s>e?9:e>s?1:0},e.PATH_UNKNOWN=-1,e.PATH_PASS=0,e.PATH_BARRIER=1,e.PATH_TRANSLUCENCE=2,e.PATH_CLOSED_AREAS=3,e.OFFSET_TAB_X=0,e.OFFSET_TAB_Y=0,e.TILE_WIDTH=0,e.TILE_HEIGHT=0,e.TITE_HALF_WIDTH=0,e.TITE_HALF_HEIGHT=0,e.DELTA_X=[0,0,1,1,-1,0,1,-1,-1,0,0],e.DELTA_Y=[0,-1,-1,0,-1,0,1,0,1,1,0],e}(egret.HashObject);__reflect(Tile.prototype,"Tile",["ITile"]);var WanfaShenyAwItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.dImg.source="wanfa_json.d_"+this.data.d,this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,100,!1,!1,!0),this._itemGridCon.addToParent(6,6,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0);var t=Math.ceil(this.data.items.length/6);this.height=100*t+6*(t-1)+70},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(WanfaShenyAwItem.prototype,"WanfaShenyAwItem");var WanfaShenyAwView=function(t){function e(){return t.call(this,"WanfaShenyAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="WanfaShenyAwItemSkin",this.itemList.itemRenderer=WanfaShenyAwItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.mc.wfMgr.getSyCfg();for(var s in i.aws)this._array.addItem({d:s,items:i.aws[s]})},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SY_AW)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++){var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaShenyAwView.prototype,"WanfaShenyAwView");var WanfaShenyNrRank=function(t){function e(){var e=t.call(this,"WanfaShenyNrRankSkin")||this;return e._sNo=0,e._sNo1=0,e._viewIndex=1,e._reqNum=10,e.MAX_NUM=100,e._needGetData=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="WanfaShenyNrRankItemSkin",this.itemList.itemRenderer=WanfaShenyNrRankItem
},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.scoll.addEventListener(eui.UIEvent.CHANGE,this.onScrollChange,this),this.scoll.addEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.scoll.removeEventListener(eui.UIEvent.CHANGE,this.onScrollChange,this),this.scoll.removeEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateRankList(),this.setMyRankInfo()},e.prototype.updateRankList=function(){this._viewIndex=1,this.scoll.viewport.scrollV=0,this.scoll.stopAnimation(),this._array.removeAll();var t=GmGlobal.mc.rankMgr.getRank(RankID.SY_NR),e=(new Date).getTime();e-t.cacheTime>GmConst.RANK_CACHE_TIME&&t.clearDatas(),this.reqRankData()},e.prototype.reqRankData=function(){this.setMyRankInfo();var t=GmGlobal.mc.rankMgr.getRank(RankID.SY_NR),e=t.length(),i=0;if(i=e+this._reqNum<this.MAX_NUM?this._reqNum:this.MAX_NUM-e,i>0&&e<this._viewIndex+i){var s=0;t.rankDatas&&t.rankDatas.length>0&&(s=t.rankDatas.length);var o=[RoleAttrId.CAREER,RoleAttrId.LEVEL];RankID.SY_NR,this._sNo=GmGlobal.cc.rankCtl.getRankData(RankID.SY_NR,s,i,o,this.onRankListUpdate,this),this._viewIndex+=i}else this.onRankListUpdate(t)},e.prototype.onRankListUpdate=function(t){if(this._sNo=0,t.rankDatas&&!(this._array.length>=t.rankDatas.length)){var e=this._array.length,i=!1;0!=e&&e<t.rankDatas.length&&(i=!0);for(var s=0;e>s;s++)this._array.replaceItemAt({rank:s+1,rid:RankID.SY_NR,data:t.rankDatas[s]},s);for(s;s<t.rankDatas.length;s++)this._array.addItem({rank:s+1,rid:RankID.SY_NR,data:t.rankDatas[s]});t.rankDatas.length>this._viewIndex&&(this._viewIndex=t.rankDatas.length),i&&(this.scoll.viewport.scrollV=this.scoll.viewport.scrollV+210)}},e.prototype.onScrollChange=function(t){this._viewIndex+this._reqNum>=this.MAX_NUM||this.scoll.viewport.scrollV>this.scoll.viewport.contentHeight-this.scoll.viewport.height&&(this._needGetData=!0)},e.prototype.onScrollChangeEnd=function(t){this._needGetData&&(this._needGetData=!1,this.reqRankData())},e.prototype.setMyRankInfo=function(){var t=GmGlobal.mc.rankMgr.getRank(RankID.SY_NR);0==t.myRank?this.tRank.text="Unranked":this.tRank.text=String(t.myRank)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_SY_RANK)},e.prototype.close=function(){0!=this._sNo&&(GmGlobal.server.clearSerialCallbak(this._sNo),this._sNo=0),0!=this._sNo1&&(GmGlobal.server.clearSerialCallbak(this._sNo1),this._sNo1=0),t.prototype.close.call(this)},e}(UIBase);__reflect(WanfaShenyNrRank.prototype,"WanfaShenyNrRank");var WanfaShenyNrRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.data,e=GmGlobal.mc.rankMgr.getRoleData(t.roleId);this.tName.text=t.name,this.tName.textColor=t.roleId==GmGlobal.mc.role.roleId?Colors.GREEN:1197947,this.tRank.text=t.rank.toString(),e?(this.tLevel.text="Lv."+e.level,this.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+e.career+".png"):(this.tLevel.text="",this.icon.source=null);var i=Math.floor(t.data/1e4);this.tMs.text=GmGlobal.mc.wfMgr.getSyDiffName(i);var s=1e4-t.data%1e4;this.tTime.text=Utils.formatTime(s,"h:m:s")},e}(eui.ItemRenderer);__reflect(WanfaShenyNrRankItem.prototype,"WanfaShenyNrRankItem");var WanfaShenyView=function(t){function e(){var e=t.call(this,"WanfaShenySkin")||this;return e._bw=158,e._space=60,e._prex=0,e._moveX=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bAw.sound=null,this._scRect=new egret.Rectangle(0,0,594,this.itemCon.height)},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bNRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this.bEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.itemCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),EventBus.addListener(EventType.M_JUPD+JsonID.SY_UPD,this.updateData,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bNRank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this.bEnter.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.itemCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onList,this),this.bAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),EventBus.rmListener(EventType.M_JUPD+JsonID.SY_UPD,this.updateData,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!1),this.updateData(),this.updateDList(),this.itemCon.validateNow(),this.itemCon.visible=!1;var i=this;setTimeout(function(){i.itemCon.visible=!0,i.itemCon.scrollRect=i._scRect,i.moveToDiff(i._selDiff,!1)},100)},e.prototype.updateData=function(){var t=GmGlobal.mc,e=t.wfMgr.getSyCfg(),i=t.dataMgr.getJData(JsonID.SY_UPD),s=void 0==i.data.cnt?e.cnt:i.data.cnt;this.tNum.text="Daily Challenges："+s,Utils.setBtnEnable(this.bEnter,0==s?!1:!0),i.data.b==e.buycntprice.length?this.buyCon.visible=!1:(this.buyCon.visible=!0,this.tPrice.text=t.wfMgr.getSyBuyCost(i.data.b||0).toString())},e.prototype.updateDList=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.SY_UPD).data,e=Math.min((t.id||0)+1,6);this._openId=e;var i=e+1;6>e&&(i+=1);for(var s=0;i>=s;s++)if(s>0&&i-1>=s){var o=new eui.Image("wanfa_json.d_"+s);o.anchorOffsetX=this._bw/2,o.anchorOffsetY=28,o.x=this._bw/2+s*(this._bw+this._space),o.y=60,this.itemCon.addChild(o),s>e&&(o.alpha=.5),s==e&&(this._selDiff=s,o.scaleX=1.2,o.scaleY=1.2,o.y=25)}this.itemCon.width=(e+2)*this._bw+(e+1)*this._space},e.prototype.selDiff=function(t){if(this._selDiff>0){var e=this.itemCon.getChildAt(this._selDiff-1);e.scaleX=e.scaleY=1,e.y=60}var i=this.itemCon.getChildAt(t-1);i.scaleX=i.scaleY=1.2,i.y=25,this._selDiff=t,this.sel1.visible=!1,this.sel2.visible=!1,this.itemCon.validateNow(),this.itemCon.scrollRect=this._scRect,this.moveToDiff(this._selDiff)},e.prototype.onList=function(t){var e=this.itemCon.getChildIndex(t.target)+1;if(0!=e&&e!=this._selDiff)return e>this._openId?void MsgBox.prompt("Clear the last difficulty to unlock"):void this.selDiff(e)},e.prototype.onTouchBegin=function(t){this._prex=t.stageX,this._moveX=0},e.prototype.onTouchMove=function(t){var e=t.stageX-this._prex;this._moveX+=e,this._scRect.x-=e,this.itemCon.scrollRect=this._scRect,this._prex=t.stageX},e.prototype.onTouchEnd=function(t){var e=1;this._scRect.x>109&&(e=Math.floor((this._scRect.x-109)/188)+2),1>e?e=1:e>6&&(e=6);var i=GmGlobal.mc.dataMgr.getJData(JsonID.SY_UPD).data;e>i.id&&(e=i.id),this.selDiff(e)},e.prototype.moveToDiff=function(t,e){void 0===e&&(e=!0),egret.Tween.removeTweens(this._scRect);var i=218*(t-1);i!=this._scRect.x&&(e?egret.Tween.get(this._scRect,{onChange:this.onScRectChange,onChangeObj:this}).to({x:i},200).call(this.onMEnd,this):(this._scRect.x=i,this.itemCon.scrollRect=this._scRect))},e.prototype.onScRectChange=function(){this.itemCon.scrollRect=this._scRect},e.prototype.onMEnd=function(){this.sel1.visible=!0,this.sel2.visible=!0},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getSyCfg().rule)},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_SY_AW)},e.prototype.onRank=function(){CmdBus.doCmd(CmdType.O_SY_RANK)},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.SY_ENTER,[this._selDiff],this.onOk,this)},e.prototype.onOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.onAdd=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.SY_BUY)},e.prototype.close=function(){for(;this.itemCon.numChildren>0;)this.itemCon.removeChildAt(0);t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("sy_bg_jpg")},e}(UIBase);__reflect(WanfaShenyView.prototype,"WanfaShenyView");var WanfaSwsxView=function(t){function e(){return t.call(this,"WanfaSwsxSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bCreate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.bExit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bYq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),this.bStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this);for(var t=1;4>t;t++){var e=this["icon"+t];e.dui.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTc,this)}EventBus.addListener(EventType.FB_TEAM,this.updateTeamList,this),EventBus.addListener(EventType.M_JUPD+JsonID.SWSX,this.updateData,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bCreate.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.bExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bYq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),this.bStart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this);for(var t=1;4>t;t++){var e=this["icon"+t];e.dui.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTc,this)}EventBus.rmListener(EventType.FB_TEAM,this.updateTeamList,this),EventBus.rmListener(EventType.M_JUPD+JsonID.SWSX,this.updateData,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateData(),this.updateTeamList()},e.prototype.updateData=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.SWSX),e=0;if(this.tCD.text="",t.data&&(e=t.data.f||0,t.data.et)){var i=t.data.et-GmGlobal.getServerTime();i>0&&CDText.getInstence().addCD(this.tCD,i,"Reset Countdown:"," DD h:m:s")}this.tNum.text="Floor clearance record:"+e},e.prototype.updateTeamInfo=function(t){if(t){this.infoCon.visible=!0,this.bCreate.visible=!1;var e=t[1];e.roleid==GmGlobal.mc.role.roleId?(this.bStart.visible=!0,this.bExit.visible=!1):(this.bStart.visible=!1,this.bExit.visible=!0)}else this.infoCon.visible=!1,this.bCreate.visible=!0},e.prototype.isThisFb=function(t){return t&&t[1].fid==FubenType.SWSX?!0:!1},e.prototype.updateTeamList=function(){var t=GmGlobal.mc,e=t.wfMgr.fbTeam;if(!this.isThisFb(e))return this.infoCon.visible=!1,void(this.bCreate.visible=!0);this.updateTeamInfo(e);for(var i=!1,s=0;4>s;s++){var o=this["icon"+s],n=e[s+1];if(n){o.icon.visible=!0,o.dui.visible=!1,o.tLv.visible=!0,o.tName.visible=!0,o.roleId=n.roleid,o.tLv.text="Lv."+n.lv,o.tName.text=n.name,o.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+n.career+".png";var r=GmGlobal.mc.setMgr.getXkCfg(n.head||0);o.txk.source="txk_json."+(r?r.icon:"txk"),0==s?(o.dui.visible=!0,n.roleid==GmGlobal.mc.role.roleId&&(i=!0),o.dui.source="com_json.dui"):i&&(o.dui.visible=!0,o.dui.source="com_json.tichu")}else o.icon.visible=!1,o.txk.source="txk_json.txk",o.dui.visible=!1,o.tLv.visible=!1,o.tName.visible=!1;o.updateIconIdx()}},e.prototype.onTc=function(t){var e=t.target.parent.roleId;GmGlobal.cc.dataCtl.doAction(ServerActionId.TAKEOUT,[e])},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getSxCfg().rule)},e.prototype.onCreate=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_CREATE,[FubenType.SWSX])},e.prototype.onYq=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&FubenInvateView.show(t[1].roleid,FubenType.SWSX)},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ENTER,null,this.onEnterOk,this)},e.prototype.onEnterOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.onExit=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_EXIT,null)},e.prototype.onAw=function(){var t=GmGlobal.mc.wfMgr.getSxCfg();CmdBus.doCmd(CmdType.O_JXGC_AW,1,t.items,t.awtxt)},e.prototype.clearTeamData=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&t[1].fid==FubenType.SWSX&&(GmGlobal.mc.wfMgr.fbTeam=null)},e.prototype.close=function(){this.clearTeamData(),CDText.getInstence().rmCD(this.tCD),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("swsx_bg_jpg")},e}(UIBase);__reflect(WanfaSwsxView.prototype,"WanfaSwsxView");var WanfaSxSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="WanfaSxSceneUISkin",e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.show=function(e){t.prototype.show.call(this,e),GmGlobal.cc.dataCtl.regPbCb(PbMsgId.SX_INFO,this.onInfo,this)},e.prototype.onInfo=function(t){this.LayerNum.text="Floor "+t.floor,this.mstNum.text="Monsters left："+t.rnum},e.prototype.close=function(){GmGlobal.cc.dataCtl.unRegPbCb(PbMsgId.SX_INFO),t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(WanfaSxSceneUI.prototype,"WanfaSxSceneUI");var WanfaTanbaoView=function(t){function e(){return t.call(this,"WanfaTanbaoViewSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),EventBus.addListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bEnter.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),EventBus.rmListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this)},e.prototype.onHdStateUpd=function(t){var e=t.data;e==FubenType.TB_DATI&&this.updateState()},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.wfMgr.getTbAws();this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(i,100,!1,!0,!0),this._itemGridCon.addToParent(5,0,this.itemCon,this.textCon,630),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,this.textCon.visible=!1,this.updateState()},e.prototype.updateState=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.TB_DATI),i=GmGlobal.getServerTime();if(e.startTime&&i<e.endTime){Utils.setBtnEnable(this.bEnter,!0);var s=e.endTime-i;CDText.getInstence().addCD(this.tTime,s,"Event in progress, Left ","h:m:s","",this.onTimeOut,this)}else this.setNoOpenState()},e.prototype.setNoOpenState=function(){this.tTime.text="Daily "+Utils.formatTime(GmGlobal.mc.wfMgr.getTbStartTime(),"h:m")+" Available",Utils.setBtnEnable(this.bEnter,!1)},e.prototype.onTimeOut=function(){this.setNoOpenState()},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getTbRule())},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.TB_ENTER,null,this.onOk,this)},e.prototype.onOk=function(){CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.close=function(){this.clearItems(),CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("tanbao_bg_jpg")},e}(UIBase);__reflect(WanfaTanbaoView.prototype,"WanfaTanbaoView");var WanfaView=function(t){function e(){var e=t.call(this,"WanfaSkin")||this;return e._tabIndex=-1,e._pageClass={0:WanfaJingjiView,1:WanfaChuangtaView,3:WanfaTanbaoView,2:WanfaYabiaoView,4:WanfaWangzuoView,5:WanfaJxgcView,6:WanfaShenyView,7:WanfaDcView,10:WanfaMkView,11:WanfaMMView,12:WanfaSwsxView,13:WanfaJztView},e._pageInstence={},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.chatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChat,this),this.bFriend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFriend,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.chatBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChat,this),this.bFriend.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFriend,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow()},e.prototype.selTab=function(t){t!=this._tabIndex&&(this._tabIndex=t,this.tTit.text=this.getPageTitle(t),this.setPage(),5==t||10==t?(this.chatBtn.visible=!0,this.bFriend.visible=!0):(this.chatBtn.visible=!1,this.bFriend.visible=!1))},e.prototype.getPageTitle=function(t){switch(t){case 0:return"Arena";case 1:return"Endless Tower";case 2:return"Escort";case 3:return"Rift Explore";case 4:return"Battle of Throne";case 5:return"Mech Factory";case 6:return"Abyss Phantom";case 7:return"100 Dojo";case 10:return"Mystery Den";case 11:return"Whose Cat";case 12:return"Statue Defense";case 13:return"Pyramid Tour";default:return""}},e.prototype.setPage=function(){this.showPage(this._tabIndex)},e.prototype.showPage=function(t){var e=this._pageInstence[t];if(e)e.show(this);else if(this._pageClass[t]){var i=this._pageClass[t];e=new i,e.show(this),this._pageInstence[t]=e}},e.prototype.closePage=function(t){var e=this._pageInstence[t];e&&e.close()},e.prototype.clearPages=function(){for(var t in this._pageInstence){var e=this._pageInstence[t];e&&(e.close(),e.destroy(),delete this._pageInstence[t])}},e.prototype.onChat=function(){CmdBus.doCmd(CmdType.O_CHAT)},e.prototype.onFriend=function(){CmdBus.doCmd(CmdType.O_FRIEND)},e.prototype.onClose=function(){if(5==this._tabIndex||10==this._tabIndex||12==this._tabIndex){var t=GmGlobal.mc.wfMgr.fbTeam;!t||t[1].fid!=FubenType.JXGC&&t[1].fid!=FubenType.MK01&&t[1].fid!=FubenType.SWSX?this.doClose():MsgBox.confirm("You'll leave the team by closing the screen. Are you sure?",this.onExitJxgc,null,this)}else this.doClose()},e.prototype.onExitJxgc=function(){var t=this._pageInstence[this._tabIndex];t&&t.onExit(),this.doClose()},e.prototype.doClose=function(){CmdBus.doCmd(CmdType.C_WANFA),CmdBus.doCmd(CmdType.O_WF_LST)},e.prototype.close=function(){this.closePage(this._tabIndex),this._tabIndex=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.clearPages(),RES.destroyRes("wanfa")},e}(UIBase);__reflect(WanfaView.prototype,"WanfaView");var WanfaWangzuoView=function(t){function e(){var e=t.call(this,"WanfaWangzuoViewSkin")||this;return e._selIdx=-1,e._isTz=!0,e._isOpen=!1,e._isSh=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bAw.sound=null},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bTz.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTz,this);for(var t=1;10>=t;t++){var e=this["ibg_"+t];e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBg,this)}EventBus.addListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this),EventBus.addListener(EventType.WZ_UPD,this.onUpd,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.bTz.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTz,this);for(var t=1;10>=t;t++){var e=this["ibg_"+t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBg,this)}EventBus.rmListener(EventType.HD_STATE_UPD,this.onHdStateUpd,this),EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),EventBus.rmListener(EventType.WZ_UPD,this.onUpd,this)},e.prototype.onHdStateUpd=function(t){var e=t.data;e==FubenType.WANGZUO&&(this._selIdx=-1,this.updateState(),this.checkData(!0),this.setSelModel(this._selIdx))},e.prototype.onHdClose=function(){this.setNoOpenState(),this._isOpen=!1,this._selIdx=-1,this.setSelModel(this._selIdx),this.reqData()},e.prototype.onUpd=function(){this.updateList(),this.setSelModel(this._selIdx)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateState(),this.setSelModel(-1),this.checkData(!0)},e.prototype.checkData=function(t){void 0===t&&(t=!1);var e=GmGlobal.mc.wfMgr,i=e.getWfData(FubenType.WANGZUO);!i.data||t?this.reqData():this.updateList()},e.prototype.reqData=function(){var t=GmGlobal.mc.role;GmGlobal.cc.dataCtl.pbReq(PbReqId.WZ_GET_DATA,[t.kfFlag],null,this.onRet,this)},e.prototype.onRet=function(t,e){var i=GmGlobal.mc.wfMgr,s=i.getWfData(FubenType.WANGZUO);s.data={};for(var o in e)s.data[o]=e[o];this.onUpd()},e.prototype.updateState=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.WANGZUO),i=GmGlobal.getServerTime();if(e.startTime&&i<e.endTime){var s=e.endTime-i;CDText.getInstence().addCD(this.tTime,s,"Event in progress, Left ","h:m:s","",this.onTimeOut,this),this._isOpen=!0,-1!=this._selIdx&&(this.bTz.visible=!0)}else this.setNoOpenState(),this._isOpen=!1},e.prototype.setNoOpenState=function(){this.tTime.text="Daily "+Utils.formatTime(GmGlobal.mc.wfMgr.getWzStartTime(),"h:m")+" Available",this.bTz.visible=!1},e.prototype.onTimeOut=function(){this.setNoOpenState()},e.prototype.updateList=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.WANGZUO);this._isSh=!1;for(var i=1;10>=i;i++){var s=this["icon_"+i];if(e.data&&e.data[i]){var o=e.data[i];s.source=GmConst.MODEL_ICON_DIR+"micon_"+o.career+".png",this.setJSFlag(i,o.kill?!0:!1),o.roleid==GmGlobal.mc.role.roleId?o.kill?this._selIdx==i&&(this._selIdx=-1,this.setSelModel(this._selIdx)):(this._isSh=!0,-1==this._selIdx&&this.setSelModel(i)):o.kill&&this._selIdx==i&&(this._selIdx=-1,this.setSelModel(this._selIdx))}else s.source="wanfa_json.wzt_null",this.setJSFlag(i,!1)}},e.prototype.setJSFlag=function(t,e){var i=this["ibg_"+t],s=this["icon_"+t];if(e){i.touchEnabled=!1,i.filters=FilterUtils.disabled(),s.filters=FilterUtils.disabled(),this._flagImgs||(this._flagImgs={});var o=this._flagImgs[t];o||(o=new eui.Image("com_json.flg_yjb"),this._flagImgs[t]=o),o.parent||(o.x=i.x,o.y=i.y+60,o.rotation=-30,o.touchEnabled=!1,this.addChild(o))}else if(i.touchEnabled=!0,i.filters=[],s.filters=[],this._flagImgs){var o=this._flagImgs[t];o&&o.parent&&o.parent.removeChild(o)}},e.prototype.onTouchBg=function(t){var e=this.getIndex(t.target);this._selIdx=e,this.setSelModel(e)},e.prototype.setSelModel=function(t){if(this.tName.visible=!1,this.nameBg.visible=!1,this.selModel.visible=!1,this.selImg.visible=!1,this.bTz.visible=!1,!(1>t||t>10)){var e=GmGlobal.mc.wfMgr,i=e.getWfData(FubenType.WANGZUO);if(i.data&&i.data[t]){this.tName.visible=!0,this.nameBg.visible=!0,this.selModel.visible=!0;var s=i.data[t];this.tName.text=s.rolename,e.wzName=s.rolename,this.selModel.anchorOffsetX=217,this.selModel.anchorOffsetY=435,this.selModel.scaleX=this.selModel.scaleY=.6,this.selModel.source="mui2_"+s.career+"_json.mui2_"+s.career;var o=this["ibg_"+t];this.selImg.visible=!0,this.selImg.x=o.x,this.selImg.y=o.y,this._isOpen&&(this._isSh?s.roleid==GmGlobal.mc.role.roleId&&(this.bTz.visible=!0,this._isTz=!1,this.bTz.label="Guard",Utils.setBtnEnable(this.bTz,!0)):(this._isTz=!0,this.bTz.visible=!0,this.bTz.label="Challenge",Utils.setBtnEnable(this.bTz,!0)))}else this._isOpen&&!this._isSh&&GmGlobal.cc.dataCtl.doAction(ServerActionId.WZ_TZ,[this._selIdx],this.onOk,this)}},e.prototype.getIndex=function(t){return t==this.ibg_1?1:t==this.ibg_2?2:t==this.ibg_3?3:t==this.ibg_4?4:t==this.ibg_5?5:t==this.ibg_6?6:t==this.ibg_7?7:t==this.ibg_8?8:t==this.ibg_9?9:t==this.ibg_10?10:-1},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getWangzuoCfg().rule)},e.prototype.onAw=function(){CmdBus.doCmd(CmdType.O_WZ_AW)},e.prototype.onTz=function(){var t=GmGlobal.cc.dataCtl;this._isTz?t.doAction(ServerActionId.WZ_TZ,[this._selIdx],this.onOk,this):t.doAction(ServerActionId.WZ_SH,null,this.onOk,this)},e.prototype.onOk=function(){var t=GmGlobal.mc.sceneMgr,e=GmGlobal.mc.wfMgr.getWangzuoCfg();t.fx=e.mpos.x,t.fy=e.mpos.y,CmdBus.doCmd(CmdType.C_WANFA)},e.prototype.close=function(){CDText.getInstence().rmCD(this.tTime),this._selIdx=-1,t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("wangzhe_bg_jpg")},e}(UIBase);__reflect(WanfaWangzuoView.prototype,"WanfaWangzuoView");var WanfaYabiaoView=function(t){function e(){var e=t.call(this,"WanfaYabiaoViewSkin")||this;return e._effectTimer=-1,e._targetIdx=0,e._showNum=0,e._q=-1,e._reqQ=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bCSx.icon="sicon_json.sicon_10002"},e.prototype.updatePos=function(){this.x=37,this.y=110},e.prototype.addEvts=function(){this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bSx.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSx,this),this.bCSx.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSx,this),this.bAddJb.addEventListener(egret.TouchEvent.TOUCH_TAP,this.doAddJb,this),this.bAddYb.addEventListener(egret.TouchEvent.TOUCH_TAP,this.doAddYb,this),this.bJb.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJb,this),this.bYb.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYb,this),EventBus.addListener(EventType.M_JUPD+JsonID.YB_UPD,this.updateData,this)},e.prototype.rmEvts=function(){this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bSx.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSx,this),this.bCSx.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSx,this),this.bAddJb.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.doAddJb,this),this.bAddYb.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.doAddYb,this),this.bJb.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJb,this),this.bYb.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onYb,this),EventBus.rmListener(EventType.M_JUPD+JsonID.YB_UPD,this.updateData,this)},e.prototype.show=function(e){t.prototype.show.call(this,e),this.updateData()},e.prototype.setAwItems=function(t){if(this._q!=t){this._q=t;var e=GmGlobal.mc.wfMgr.getYbCfg();this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(e.aws[t],100,!1,!0,!0),this._itemGridCon.addToParent(5,0,this.itemCon,this.textCon,630),this._itemGridCon.setTouchCb(!0),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER}},e.prototype.updateData=function(){var t=GmGlobal.mc,e=t.wfMgr.getYbCfg(),i=t.dataMgr.getJData(JsonID.YB_UPD).data,s=i.q||1;if(-1!=this._effectTimer)this._targetIdx=s;else{var o=this["box"+s];this.selImg.x=o.x-3,this.selImg.y=o.y-3,this.setAwItems(s)}var n=void 0==i.rcnt?e.jbCount:i.rcnt,r=void 0==i.ecnt?e.ybCount:i.ecnt;this.tYbNum.text=r.toString(),this.tJbNum.text=n.toString();var h=this.getJbCost();-1==h?(Utils.setBtnEnable(this.bAddJb,!1),this.jbPrice.text="0"):(Utils.setBtnEnable(this.bAddJb,!0),this.jbPrice.text=h.toString());var a=this.getYbCost();-1==a?(Utils.setBtnEnable(this.bAddYb,!1),this.ybPrice.text="0"):(Utils.setBtnEnable(this.bAddYb,!0),this.ybPrice.text=a.toString());var l=i.r||0,c=t.wfMgr.getYbRCost(l);0==c?(this.bCSx.visible=!1,this.bSx.visible=!0):(this.bCSx.visible=!0,this.bSx.visible=!1,this.bCSx.label=c+" Refresh")},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.wfMgr.getYbRule())},e.prototype.onSx=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.YB_UPD).data;4!=t.q&&(this.showSelEffect(),GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_REFERSH,null,null,this,this.onSxFail))},e.prototype.onSxFail=function(){this.clearSelEffect();var t=GmGlobal.mc.dataMgr.getJData(JsonID.YB_UPD).data,e=t.q||1,i=this["box"+e];this.selImg.x=i.x-3,this.selImg.y=i.y-3},e.prototype.getJbCost=function(){var t=GmGlobal.mc,e=t.wfMgr.getYbCfg(),i=t.dataMgr.getJData(JsonID.YB_UPD).data,s=i.b||0;return s>=e.jbBuyMax?-1:t.wfMgr.getYbJbCost(s)},e.prototype.onAddJb=function(){var t=this.getJbCost();-1==t?MsgBox.alert("Daily chances used up"):MsgBox.confirm("Accelerate 1 Plunder with "+t+" crystals",this.doAddJb,null,this)},e.prototype.doAddJb=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_BUY_JB)},e.prototype.getYbCost=function(){var t=GmGlobal.mc,e=t.wfMgr.getYbCfg(),i=t.dataMgr.getJData(JsonID.YB_UPD).data,s=i.be||0;return s>=e.ybBuyMax?-1:t.wfMgr.getYbYbCost(s)},e.prototype.onAddYb=function(){var t=this.getYbCost();-1==t?MsgBox.alert("Daily chances used up"):MsgBox.confirm("Accelerate 1 Escort with "+t+" crystals？",this.doAddYb,null,this)},e.prototype.doAddYb=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_BUY_YB)},e.prototype.onJb=function(){var t=GmGlobal.mc,e=t.wfMgr.getYbCfg(),i=t.dataMgr.getJData(JsonID.YB_UPD).data,s=void 0==i.rcnt?e.ybCount:i.rcnt;0==s?MsgBox.prompt("No plunders left"):(t.wfMgr.isYbAction=!1,GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_ACTION,[1],this.onOk,this))},e.prototype.onYb=function(){var t=GmGlobal.mc,e=t.wfMgr.getYbCfg(),i=t.dataMgr.getJData(JsonID.YB_UPD).data,s=void 0==i.ecnt?e.jbCount:i.ecnt;this._reqQ=i.q||1,0==s?MsgBox.prompt("No escorts left"):(t.wfMgr.isYbAction=!0,GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_ACTION,[0],this.onOk,this))},e.prototype.onOk=function(){CmdBus.doCmd(CmdType.C_WANFA),this._reqQ>1&&GmGlobal.cc.chatCtl.ybTishi(this._reqQ)},e.prototype.showSelEffect=function(){(this._effectTimer=-1)&&(this._effectTimer=egret.setInterval(this.onEffect,this,150)),this._targetIdx=0,this._showNum=0,this.bSx.touchEnabled=!1,this.bCSx.touchEnabled=!1,this.onEffect()},e.prototype.onEffect=function(){var t=this._showNum%4+1,e=this["box"+t];this.selImg.x=e.x-3,this.selImg.y=e.y-3,this._showNum++,this._targetIdx&&this._showNum/4>=2&&t==this._targetIdx&&(this.setAwItems(this._targetIdx),this.clearSelEffect())},e.prototype.clearSelEffect=function(){-1!=this._effectTimer&&(egret.clearInterval(this._effectTimer),this._effectTimer=-1),this._targetIdx=0,this._showNum=0,this.bSx.touchEnabled=!0,this.bCSx.touchEnabled=!0},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.close=function(){this._q=-1,this.clearItems(),this.clearSelEffect(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("yabiao_bg_jpg")},e}(UIBase);__reflect(WanfaYabiaoView.prototype,"WanfaYabiaoView");var WangzuoAwView=function(t){function e(){return t.call(this,"WangzuoAwSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0);var i=GmGlobal.mc.wfMgr.getWangzuoCfg();this._cyGridCon=ItemGridCon.create(),this._cyGridCon.initGridsByItems(i.cyAw,100,!1,!0,!0),this._cyGridCon.addToParent(5,0,this.cyItemCon,this.cyTextCon,630),this._cyGridCon.setTouchCb(!0),this._cyGridCon.textAlign=egret.HorizontalAlign.CENTER,this._jsGridCon=ItemGridCon.create(),this._jsGridCon.initGridsByItems(i.jsAw,100,!1,!0,!0),this._jsGridCon.addToParent(5,0,this.jsItemCon,this.jsTextCon,630),this._jsGridCon.setTouchCb(!0),this._jsGridCon.textAlign=egret.HorizontalAlign.CENTER,this._zhyiGridCon=ItemGridCon.create(),this._zhyiGridCon.initGridsByItems(i.zhyjAw,100,!1,!0,!0),this._zhyiGridCon.addToParent(5,0,this.zhyjItemCon,this.zhyjITextCon,630),this._zhyiGridCon.setTouchCb(!0),this._zhyiGridCon.textAlign=egret.HorizontalAlign.CENTER,this._wzGridCon=ItemGridCon.create(),this._wzGridCon.initGridsByItems(i.wzAw,100,!1,!0,!0),this._wzGridCon.addToParent(5,0,this.wzItemCon,this.wzTextCon,630),this._wzGridCon.setTouchCb(!0),this._wzGridCon.textAlign=egret.HorizontalAlign.CENTER
},e.prototype.clearItems=function(){this._cyGridCon&&(ItemGridCon.release(this._cyGridCon),this._cyGridCon=null),this._jsGridCon&&(ItemGridCon.release(this._jsGridCon),this._jsGridCon=null),this._zhyiGridCon&&(ItemGridCon.release(this._zhyiGridCon),this._zhyiGridCon=null),this._wzGridCon&&(ItemGridCon.release(this._wzGridCon),this._wzGridCon=null)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_WZ_AW)},e.prototype.close=function(){this.clearItems(),t.prototype.close.call(this)},e}(UIBase);__reflect(WangzuoAwView.prototype,"WangzuoAwView");var WZSceneUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="GHBossSceneUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.release=function(){this._instance&&(this._instance.close(),this._instance=null)},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.wfMgr,s=i.getWfData(FubenType.WANGZUO),o=GmGlobal.getServerTime(),n=s.endTime-o;0>=n?this.hdEnd():CDText.getInstence().addCD(this.hdTime,n,"Event Countdown: ","m:s","",this.onHdTimeOut,this),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this)},e.prototype.onHdTimeOut=function(){var t=GmGlobal.mc.wfMgr,e=t.getWfData(FubenType.GH_BOSS),i=GmGlobal.getServerTime(),s=e.endTime-i;0>=s?this.hdEnd():CDText.getInstence().addCD(this.hdTime,s,"Event Countdown: ","m:s","",this.onHdTimeOut,this)},e.prototype.hdEnd=function(){this.hdTime.text="Event ended"},e.prototype.onHdClose=function(t){CDText.getInstence().rmCD(this.hdTime),this.hdEnd()},e.prototype.close=function(){EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),CDText.getInstence().rmCD(this.hdTime),t.prototype.close.call(this)},e._instance=null,e}(WanfaSceneUIBase);__reflect(WZSceneUI.prototype,"WZSceneUI");var XzDatiView=function(t){function e(){return t.call(this,"XzDatiViewSkin")||this}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.updatePos=function(){GmConst.IS_FULLSCENE?this.y=GmConst.TOP_SPACE+305:this.y=305,this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.addEvts=function(){},e.prototype.rmEvts=function(){},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc,s=i.wfMgr.getTbCfg(),o=i.wfMgr.getWfData(FubenType.TB_DATI);CDText.getInstence().addCD(this.cdTxt,s.xzdttime,"Time Left: ","sS","",this.onTimeOut,this);var n="Q "+o.data.idx+"/"+s.xzdtnum,r=i.wfMgr.getTbXzQuestion(o.data.tmid);r&&(n+=r.q),this.qTxt.text=n},e.prototype.onTimeOut=function(){TanbaoSceneUI.getInstance().setCtTime(),this.close()},e.prototype.close=function(){CDText.getInstence().rmCD(this.cdTxt),t.prototype.close.call(this)},e}(UIBase);__reflect(XzDatiView.prototype,"XzDatiView");var YBSceneUI=function(t){function e(){var e=t.call(this)||this;return e._byCost=0,e._js=0,e.skinName="YBSceneUISkin",e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.onResize=function(){GmConst.IS_FULLSCENE?(this.y=GmConst.TOP_SPACE+GmConst.UI_FREE_Y,this.jsCon.y=GmGlobal.stageHeight-this.y-300-this.jsCon.height-GmConst.BOTTOM_SPACE):(this.y=GmConst.UI_FREE_Y,this.jsCon.y=GmGlobal.stageHeight-this.y-300-this.jsCon.height),this.x=(GmGlobal.stageWidth-this.width)/2},e.prototype.show=function(e){t.prototype.show.call(this,e);var i=GmGlobal.mc.sceneMgr;if(i.mapId==FubenType.YABIAO_Y){var s=GmGlobal.mc.wfMgr.getYbCfg();this.jsTxt.text="Accelerate\n"+100*s.js+"%",this.bcUpd()}else this.jsCon.visible=!1;this.bJs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJs,this),EventBus.addListener(EventType.YB_UPD,this.bcUpd,this)},e.prototype.bcUpd=function(){var t=GmGlobal.mc,e=t.wfMgr.bcList,i=GmGlobal.mc.wfMgr.getYbCfg(),s=this.getMyData(e);if(s){var o=s.s||0;o>=i.jsPrice.length?this.jsCon.visible=!1:(this.jsCon.visible=!0,this._byCost=i.jsPrice[o],this._js=100*i.js)}},e.prototype.getMyData=function(t){if(!t)return null;var e=GmGlobal.mc.role;for(var i in t){var s=t[i];if(s.carid==e.roleId)return s}return null},e.prototype.onJs=function(){this._confirmBox=MsgBox.confirm("Accelerate "+this._js+"% with "+this._byCost+" Crystals？",this.doJs,null,this)},e.prototype.doJs=function(){this._confirmBox=null,GmGlobal.cc.dataCtl.doAction(ServerActionId.YB_JS,null,this.onJsOk,this)},e.prototype.onJsOk=function(){CmdBus.doCmd(CmdType.S_BCJS)},e.prototype.close=function(){this._confirmBox&&(this._confirmBox.close(),this._confirmBox=null),this.bJs.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onJs,this),EventBus.rmListener(EventType.YB_UPD,this.bcUpd,this),t.prototype.close.call(this)},e}(WanfaSceneUIBase);__reflect(YBSceneUI.prototype,"YBSceneUI");var WeightMediator=function(){function t(){CmdBus.adListener(CmdType.O_WEIGHT,this.onOpenView,this),CmdBus.adListener(CmdType.C_WEIGHT,this.onCloseView,this)}return t.prototype.onOpenView=function(t){this._view||(this._view=new WeightTip),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer),this._view.setInfo(t)},t.prototype.onCloseView=function(){this._view&&this._view.isShow&&this._view.close()},t}();__reflect(WeightMediator.prototype,"WeightMediator");var WeightTip=function(t){function e(){var e=t.call(this,"WeightTipSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scroll.verticalScrollBar&&(this.scroll.verticalScrollBar.autoVisibility=!1),this.scroll.horizontalScrollBar&&(this.scroll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array,this.itemList.itemRendererSkinName="WeightTipItemSkin",this.itemList.itemRenderer=WeightTipItem},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0)},e.prototype.setInfo=function(t){this.scroll.viewport.scrollV=0;for(var e=[],i=this.getTweight(t),s=0;s<t.length;s++){var o={data:t[s],tweight:i};e.push(o)}this._array.replaceAll(e)},e.prototype.getTweight=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].weight;return e},e.prototype.onClose=function(t){CmdBus.doCmd(CmdType.C_WEIGHT)},e}(UIBase);__reflect(WeightTip.prototype,"WeightTip");var WeightTipItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.data,e=this.data.tweight,i=GmGlobal.mc.itemMgr.getItemCfg(t.id);this.tTit.text=i.name;var s=(t.weight/e*100).toFixed(4);this.tNum.text=s+"%"},e}(eui.ItemRenderer);__reflect(WeightTipItem.prototype,"WeightTipItem");var WenjuanMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.WENJUAN,CmdType.O_WJ),CmdBus.adListener(CmdType.O_WJ,this.onWj,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.JINLI,this.onUpdate,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon(!0)},t.prototype.onUpdate=function(t){this.updateIcon()},t.prototype.updateIcon=function(t){void 0===t&&(t=!1);var e=GmGlobal.mc.dataMgr.getJData(JsonID.WENJUAN).data,i=e.et||0,s=GmGlobal.getServerTime(),o=i-s;0>o||(CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.WENJUAN,"mui_json.mui_b_wj",3),CmdBus.doCmd(CmdType.S_M_CD,ModelID.WENJUAN,o),egret.setTimeout(this.onTimeOut,this,1e3*o))},t.prototype.onTimeOut=function(){CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.WENJUAN,3),CmdBus.doCmd(CmdType.C_M_CD,ModelID.WENJUAN)},t.prototype.onWj=function(){var t=GmGlobal.mc.dataMgr.getJData(JsonID.WENJUAN).data,e=t.url||"https://www.baidu.com";window.open(e,"_blank")},t}();__reflect(WenjuanMediator.prototype,"WenjuanMediator");var XingzuoController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.XZ_UPD,this.onUpdate,this),EventBus.addListener(EventType.M_JUPD+JsonID.XZ_UPD_S,this.onUpdateOne,this),GmGlobal.cc.itemCtl.bindItemCallback(0,this.updateRedDot,this)}return t.prototype.onUpdate=function(t){var e=t.data.data;GmGlobal.mc.xzMgr.setXzData(e),this.updateRedDot(),EventBus.dispatchEvt(EventType.XZ_UPD)},t.prototype.onUpdateOne=function(t){var e=t.data.data;GmGlobal.mc.xzMgr.setOneData(e),this.updateRedDotOnce(e.xzid),EventBus.dispatchEvt(EventType.XZ_UPD)},t.prototype.updateRedDot=function(){for(var t=GmGlobal.mc.itemMgr.getItemListByType([12]),e=1;12>=e;e++)this.updateRedDotOnce(e,t)},t.prototype.updateRedDotOnce=function(t,e){void 0===e&&(e=null);var i=GmGlobal.mc.xzMgr,s=i.redDot.childs[t],o=i.getXzData(t);if(o&&o.star){e||(e=GmGlobal.mc.itemMgr.getItemListByType([12]));for(var n=i.getXzCfg(t),r=i.getXzXsList(t),h=GmGlobal.mc.role,a=1;8>=a;a++){var l=s.childs[a],c=o.star[a];if(c){var d=i.getXsCfg(c.sid);if(!d)continue;if(c.slv==d.lvs.length)l.state=0;else{var p=GmGlobal.mc.itemMgr.getItemNum(d.costitem),u=d.lvs[c.slv];p>=u.costnum?l.state=1:l.state=0}}else{var m=n.pos[a-1];1==m.type&&m.openlv<=h.lv&&(e&&(!r||e.length>r.length)?l.state=1:l.state=0)}}}},t}();__reflect(XingzuoController.prototype,"XingzuoController");var XingzuoIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);__reflect(XingzuoIcon.prototype,"XingzuoIcon");var XingzuoItemView=function(t){function e(){var e=t.call(this)||this;return e.xzId=-1,e.xsIdx=-1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),CmdBus.adListener(CmdType.XS_REPLACE,this.onSelItem,this)},e.prototype.setCb=function(t,e,i){this._selCb=t,this._sjCb=e,this._cbThis=i},e.prototype.setId=function(t){this.xzId!=t&&(-1!=this.xzId&&this.clearRedDots(),this.xzId=t,this.xsIdx=-1,this.skinName="XingzuoSkin"+t,this._cfg=GmGlobal.mc.xzMgr.getXzCfg(t),this.initIcons(),this.updateData(),this._cfg.openlv<=GmGlobal.mc.role.lv?this.selXs(1):this.xsIdx=-1,this.updateRedDot(),this.bindRedDotCb())},e.prototype.initIcons=function(){for(var t=0;t<this._cfg.pos.length;t++){var e=this._cfg.pos[t],i=t+1,s=this["icon"+i];s.idx=i,0==e.type&&(s.icon.source="xz_json.xz_"+e.xsid)}},e.prototype.updateData=function(){for(var t=GmGlobal.mc,e=t.xzMgr.getXzData(this.xzId),i=t.role.lv,s=0;s<this._cfg.pos.length;s++){var o=this._cfg.pos[s],n=s+1,r=null;e&&(r=e.star[n]);var h=this["icon"+n];1==o.type&&(r&&!Utils.isEmptyObj(r)?(h.icon.source=t.itemMgr.getItemIcon(r.sid),h.addBtn.visible=!1,h.resetBtn.visible=!0):(h.icon.source=null,h.addBtn.visible=!0,h.resetBtn.visible=!1)),i>=o.openlv?(h.filters=[],h.isOpen=!0):(h.filters=FilterUtils.disabled(),h.isOpen=!1,h.openLv=o.openlv)}},e.prototype.selXs=function(t){if(t!=this.xsIdx){this.clearSelFilter();var e=this["icon"+t];e.bg.filters=FilterUtils.seleteFilter(),this.xsIdx=t,this._selCb&&this._selCb.call(this._cbThis)}},e.prototype.clearSelFilter=function(){if(this.xsIdx>0){var t=this["icon"+this.xsIdx];t.bg.filters=[],this.xsIdx=-1}},e.prototype.showSjEffect=function(){if(-1!=this.xsIdx){var t=this["icon"+this.xsIdx],e=80==t.width?"xinghunx":"xinghund",i=McEffect.create(e);i.show(this,t.x+t.width/2-1,t.y+t.height/2-1,1,1,0,this._sjCb,this._cbThis)}},e.prototype.onTouch=function(t){if("resetBtn"==t.target.name){var e=t.target.parent.idx;e&&(this.selXs(e),this.showItemReplace())}else{var i=t.target;if(!i.isOpen)return void MsgBox.prompt("Unlocks at LV."+i.openLv);var e=i.idx;if(e){this.selXs(e);var s=GmGlobal.mc.xzMgr.getXsData(this.xzId,e);(!s||Utils.isEmptyObj(s))&&this.showItemReplace()}}},e.prototype.showItemReplace=function(){var t=GmGlobal.mc.xzMgr.getXzXsList(this.xzId),e=ItemReplaceView.instence();e.setType("Star Stone",12,t,null,null,ModelID.XINGZUO),e.show()},e.prototype.onSelItem=function(t){var e=GmGlobal.mc.xzMgr.getXsData(this.xzId,this.xsIdx);e&&e.slv>1?MsgBox.confirm(GmGlobal.mc.xzMgr.rsm,this.doXq,null,this,"Replace","Cancel",t):this.doXq(t)},e.prototype.doXq=function(t){GmGlobal.cc.dataCtl.doAction(ServerActionId.XZ_XQ,[this.xzId,this.xsIdx,t])},e.prototype.bindRedDotCb=function(){var t=GmGlobal.mc.xzMgr.redDot.childs[this.xzId];for(var e in t.childs){var i=t.childs[e];i.bindChangeCB(this.updateRedDot,this)}},e.prototype.unbindRedDotCb=function(){var t=GmGlobal.mc.xzMgr.redDot.childs[this.xzId];for(var e in t.childs){var i=t.childs[e];i.unbindChangeCB(this.updateRedDot,this)}},e.prototype.updateRedDot=function(){var t=GmGlobal.mc.xzMgr.redDot.childs[this.xzId];for(var e in t.childs){var i=t.childs[e],s=this["icon"+e];1==i.state?RedDotView.addRedDot(s,this,"xingzui",s.x+s.width-(80==s.width?15:26),s.y):RedDotView.removeRedDot(s)}},e.prototype.clearRedDots=function(){RedDotView.removeRedDotByGroup("xingzui"),this.unbindRedDotCb()},e.prototype.clear=function(){this.clearRedDots(),this.clearSelFilter(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),CmdBus.rmListener(CmdType.XS_REPLACE,this.onSelItem,this),this._selCb=null,this._sjCb=null,this._cbThis=null,this._cfg=null,this.xzId=-1,this.xsIdx=-1,this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(XingzuoItemView.prototype,"XingzuoItemView");var XingzuoManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_xingzuo.json",this.initCfg,this),this.initRedDot()}return t.prototype.initRedDot=function(){for(var t={},e=1;12>=e;e++){var i={};t[e]=i;for(var s=1;8>=s;s++)i[s]=0}this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.XINGZUO,this.redDot)},t.prototype.initCfg=function(t){this.rule=t.rule,this.rsm=t.rsm,this._xzCfg=t.xz,this._xsCfg=t.xs},t.prototype.setXzData=function(t){this._xzData=t},t.prototype.setOneData=function(t){var e=t.xzid,i=this._xzData[e];i||(i={star:{}}),i.star[t.staridx]={sid:t.sid,slv:t.slv}},t.prototype.getXzCfg=function(t){return this._xzCfg[t]},t.prototype.getXsCfg=function(t){return this._xsCfg[t]},t.prototype.getXzData=function(t){return this._xzData?this._xzData[t]:null},t.prototype.getXzXsList=function(t){var e=this.getXzData(t);if(!e||!e.star)return null;var i=[];for(var s in e.star){var o=e.star[s];o&&o.sid&&o.sid>1e3&&i.push(o.sid)}return i},t.prototype.getXsData=function(t,e){var i=this.getXzData(t);return i?i.star[e]:null},t.prototype.getXsIcon=function(t){var e=this._xsCfg[t];return e?0==e.type?"xz_json.xz_"+t:GmGlobal.mc.itemMgr.getItemIcon(t):null},t}();__reflect(XingzuoManager.prototype,"XingzuoManager");var XingzuoMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.XINGZUO,CmdType.O_XINGZUO),CmdBus.adListener(CmdType.O_XINGZUO,this.onOpenView,this),CmdBus.adListener(CmdType.C_XINGZUO,this.onCloseView,this),CmdBus.adListener(CmdType.O_XZ_ATTR,this.onOpenZsx,this),CmdBus.adListener(CmdType.C_XZ_ATTR,this.onCloseZsx,this)}return t.prototype.onOpenView=function(){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new XingzuoView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view)},t.prototype.onOpenZsx=function(){this._attrView||(this._attrView=new XingzuoZsxView),this._attrView.isShow||this._attrView.show(GmGlobal.vmc.uiLayer)},t.prototype.onCloseZsx=function(){this._attrView&&this._attrView.close()},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,this._attrView=null,!0):!1:!0},t}();__reflect(XingzuoMediator.prototype,"XingzuoMediator",["IMediator"]);var XingzuoView=function(t){function e(){var e=t.call(this,"XimgzuoViewSkin")||this;return e._openMax=-1,e._openList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.bRule.sound=null},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.bSj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSj,this),this.bAll.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllAttr,this),this.cIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),EventBus.addListener(EventType.XZ_UPD,this.onUpdate,this),GmGlobal.cc.itemCtl.bindItemCallback(0,this.onItemChange,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeft,this),this.bRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRight,this),this.bSj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSj,this),this.bAll.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllAttr,this),this.cIcon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),EventBus.rmListener(EventType.XZ_UPD,this.onUpdate,this),GmGlobal.cc.itemCtl.removeItemCallback(0,this.onItemChange,this)},e.prototype.show=function(e){if(t.prototype.show.call(this,e,!0),this.alphaShow(),!this._xzItem){var i=new XingzuoItemView;i.setCb(this.updateXsData,this.doSj,this),this.xzCon.addChild(i),this._xzItem=i}this.setXz(1),this.updateXsData(),this.updateOpenState(),this.checkGuide()},e.prototype.setXz=function(t){this._xzItem.setId(t),-1==this._openList.indexOf(t)&&this._openList.push(t);var e=GmGlobal.mc,i=e.xzMgr.getXzCfg(t);this.tName.text=i.name},e.prototype.onLeft=function(){var t=this._xzItem.xzId-1;1>t&&(t=12),this.setXz(t),this.updateBtnState(),GmGlobal.sound.playSoundEffect("ui_fenye")},e.prototype.onRight=function(){var t=this._xzItem.xzId+1;t>12&&(t=1),this.setXz(t),this.updateBtnState(),GmGlobal.sound.playSoundEffect("ui_fenye")},e.prototype.onItem=function(t){this._costItem&&ItemTips.show(this._costItem,t.stageX,t.stageY)},e.prototype.onUpdate=function(){this._xzItem&&(this._xzItem.updateData(),this.updateOpenState(),this.updateXsData())},e.prototype.updateOpenState=function(){for(var t=GmGlobal.mc,e=t.xzMgr,i=(e.getXzCfg(this._xzItem.xzId),1);12>=i;i++){var s=e.getXzCfg(i);s.openlv<=t.role.lv&&(this._openMax=i)}this.updateBtnState()},e.prototype.updateBtnState=function(){-1==this._openMax?(this.bLeft.visible=!1,this.bRight.visible=!1):(this.bLeft.visible=1==this._xzItem.xzId?!1:!0,this.bRight.visible=this._xzItem.xzId==this._openMax?!1:!0)},e.prototype.onItemChange=function(){this.updateXsData()},e.prototype.updateXsData=function(){var t=GmGlobal.mc,e=t.xzMgr.getXsData(this._xzItem.xzId,this._xzItem.xsIdx);if(!e||Utils.isEmptyObj(e))this.xsAttrCon.visible=!1;else{this.xsAttrCon.visible=!0,this.tLv.text=e.slv;var i=t.xzMgr.getXsCfg(e.sid),s=i.lvs[e.slv-1],o=i.shuoming.replace("%x",TextFormat.setColor(s.attrnum,6920136));if(this.attrT.textFlow=TextFormat.parser.parse(o),e.slv+1>i.lvs.length)this.nextAttrT.text="Max LV",this.nextAttrT.textColor=14050935,this.costCon.visible=!1;else{var n=i.lvs[e.slv],r=i.shuoming.replace("%x",TextFormat.setColor(n.attrnum,6920136));this.nextAttrT.textFlow=TextFormat.parser.parse(r),this.nextAttrT.textColor=6714495,this.costCon.visible=!0;var h=t.itemMgr.getItemNum(i.costitem);h<n.costnum?this.tCost.textFlow=TextFormat.parser.parse(TextFormat.setColor(h.toString(),Colors.RED)+"/"+n.costnum):this.tCost.text=h+"/"+n.costnum,this.cIconQ.source=t.itemMgr.getItemIconK(i.costitem),this.cIcon.source=t.itemMgr.getItemIcon(i.costitem),this._costItem=i.costitem,Utils.setBtnEnable(this.bSj,h>=n.costnum)}this.xsIcon.source=t.xzMgr.getXsIcon(e.sid),0==i.type?(this.xsIcon.width=this.xsIcon.height=88,this.xsIcon.x=10,this.xsIcon.y=7):(this.xsIcon.width=this.xsIcon.height=104,this.xsIcon.x=2,this.xsIcon.y=0),this.xsName.text=i.name}},e.prototype.onSj=function(){GmGlobal.vmc.mGuide.triggerTarget(this.bSj),this._xzItem.showSjEffect(),this.bSj.touchEnabled=!1},e.prototype.doSj=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.XZ_XQ,[this._xzItem.xzId,this._xzItem.xsIdx]),this.bSj.touchEnabled=!0},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.xzMgr.rule)},e.prototype.onAllAttr=function(){CmdBus.doCmd(CmdType.O_XZ_ATTR)},e.prototype.checkGuide=function(){var t=GmGlobal.vmc.mGuide;t.guideData&&t.guideData.id==GuideID.XZ_SJ&&(GmGlobal.mc.guideMgr.isSimpleGuide()?t.clearGuide():t.bindTarget(GuideTargetId.SJ_BTN,this.bSj,this.bSj.parent.localToGlobal(this.bSj.x,this.bSj.y)))},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_XINGZUO)},e.prototype.close=function(){this._xzItem&&(this._xzItem.clear(),this._xzItem=null),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0,i=this._openList;e<i.length;e++){var s=i[e];RES.destroyRes("xz_bg_"+s+"_png")}RES.destroyRes("xingzuo")},e}(UIBase);__reflect(XingzuoView.prototype,"XingzuoView");var XingzuoZsxItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.xzName.text=this.data.name,this.attrTxt.text=this.data.txt,this.height=this.attrTxt.textHeight+56},e}(eui.ItemRenderer);__reflect(XingzuoZsxItem.prototype,"XingzuoZsxItem");var XingzuoZsxView=function(t){function e(){return t.call(this,"XingzuoZsxSkin")||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this._arrayCollection=new eui.ArrayCollection,this.itemList.dataProvider=this._arrayCollection,this.itemList.itemRenderer=XingzuoZsxItem,this.itemList.itemRendererSkinName="XingzuoZsxItemSkin"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateList()},e.prototype.updateList=function(){this._arrayCollection.removeAll();for(var t=GmGlobal.mc.xzMgr,e=1;12>=e;e++){var i=t.getXzCfg(e),s=t.getXzData(e),o={name:i.name,txt:null};if(s)for(var n in s.star){var r=s.star[n];if(r){var h=t.getXsCfg(r.sid),a=h.lvs[r.slv-1];null==o.txt?o.txt=h.shuoming.replace("%x",a.attrnum):o.txt+="\n"+h.shuoming.replace("%x",a.attrnum)}}else o.txt="None";this._arrayCollection.addItem(o)}},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_XZ_ATTR)},e.prototype.close=function(){t.prototype.close.call(this)},e}(UIBase);__reflect(XingzuoZsxView.prototype,"XingzuoZsxView");var YckjManager=function(){function t(){this.bossRranserId=0,GmGlobal.mc.regUnzipCfg("c_adimension.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this.cfg=t},t.prototype.getHdCD=function(){for(var t=Utils.getTodaySecond(),e=1;4>=e;e++){var i=this.cfg["crossservertime"+e];if(t>=i&&t<=i+this.cfg.time)return i+this.cfg.time-t}return 0},t}();__reflect(YckjManager.prototype,"YckjManager");var YckjMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.YCKJ,CmdType.O_YCKJ),CmdBus.adListener(CmdType.O_YCKJ,this.onOpenView,this),CmdBus.adListener(CmdType.C_YCKJ,this.onCloseView,this),EventBus.addListener(EventType.ADD_SCENERY,this.onAddScenery,this),EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this),GmGlobal.cc.dataCtl.regPbCb(PbReqId.YCKJ_TRANSFER,this.onTranser,this)}return t.prototype.onOpenView=function(){this._view||(this._view=new YckjView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&(this._view.alphaClose(this._view.closeAndDestroy,this._view),this._view=null)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t.prototype.onAddScenery=function(t){var e=GmGlobal.mc,i=e.sceneMgr,s=FubenType.getClientType(i.mapId);if(s==FubenType.YCKJ){if(e.yckjMgr.bossRranserId==i.mapId)return;var o=t.data;"boss"==o.scenery.name&&(o.touchEnabled=!1,o.visible=!1)}},t.prototype.onTranser=function(t){var e=GmGlobal.mc;e.yckjMgr.bossRranserId=t.show||0;var i=e.sceneMgr;if(i.mapId==t.show){var s=GmGlobal.vmc.scene.currenScene;s.setSceneryVisible("boss",t.show?!0:!1)}EventBus.dispatchEvt(EventType.YCKJ_TRANCE)},t.prototype.onEnterScene=function(){var t=GmGlobal.mc,e=FubenType.getClientType(t.sceneMgr.mapId);e==FubenType.YCKJ?(YckjSceneUI.isShow||YckjSceneUI.getInstence().show(GmGlobal.vmc.uiLayer),this.onCloseView(null)):(YckjSceneUI.isShow&&(YckjSceneUI.getInstence().close(),YckjSceneUI.release()),t.yckjMgr.bossRranserId=0)},t}();__reflect(YckjMediator.prototype,"YckjMediator",["IMediator"]);var YckjSceneUI=function(t){function e(){var e=t.call(this)||this;return e._timerId=0,e.skinName="YckjSceneUISkin",e.touchEnabled=!1,e}return __extends(e,t),e.getInstence=function(){return this._instence||(this._instence=new e),this._instence},e.release=function(){this._instence&&(this._instence.close(),this._instence=null)},e.prototype.show=function(i){t.prototype.show.call(this,i),e.isShow=!0,EventBus.addListener(EventType.ENTER_SCENE,this.onEnterScene,this),EventBus.addListener(EventType.YCKJ_TRANCE,this.onTranser,this),EventBus.addListener(EventType.HD_CLOSE,this.onHdClose,this),this.updatePosInfo(),this.updateTranser();var s=GmGlobal.mc.wfMgr.getWfData(FubenType.YCKJ),o=GmGlobal.getServerTime();if(s.startTime&&o<s.endTime){var n=s.endTime-o;CDText.getInstence().addCD(this.hdTime,n,"Event Countdown：","h:m:s","",this.onTimeEnd,this)}else this.onTimeEnd()},e.prototype.onTimeEnd=function(){this.hdTime.text="Event ended"},e.prototype.onHdClose=function(t){t.data==FubenType.YCKJ&&(CDText.getInstence().rmCD(this.hdTime),this.onTimeEnd())},e.prototype.onEnterScene=function(){this.updatePosInfo(),FubenType.isYckjBossMap(GmGlobal.mc.sceneMgr.mapId)?this.bossTip.text="":this.updateTranser()},e.prototype.onTranser=function(t){void 0===t&&(t=0),this.updateTranser(1e4)},e.prototype.updateTranser=function(t){void 0===t&&(t=0);var e=GmGlobal.mc;e.yckjMgr.bossRranserId?this.bossTip.text="WARNING: Space rift found in Dimension "+(e.yckjMgr.bossRranserId-9350)+". Explore and defeat the monsters now.":t?(this.bossTip.text="The monsters have been wiped out and the space rift is now closed.",this._timerId&&egret.clearTimeout(this._timerId),this._timerId=egret.setTimeout(this.onBossTimeOut,this,t)):this.bossTip.text=""},e.prototype.onBossTimeOut=function(){this.bossTip.text="",this._timerId=0},e.prototype.updatePosInfo=function(){var t=(GmGlobal.mc,GmGlobal.mc.sceneMgr),e=FubenType.getClientType(t.mapId);e==FubenType.YCKJ?FubenType.isYckjBossMap(t.mapId)?this.kjTxt.text="":this.kjTxt.text="Location:  Dimension "+(t.mapId-9350):this.kjTxt.text=""},e.prototype.close=function(){e.isShow=!1,this._timerId&&(egret.clearTimeout(this._timerId),this._timerId=0),CDText.getInstence().rmCD(this.hdTime),EventBus.rmListener(EventType.YCKJ_TRANCE,this.onTranser,this),EventBus.rmListener(EventType.ENTER_SCENE,this.onEnterScene,this),EventBus.rmListener(EventType.HD_CLOSE,this.onHdClose,this),t.prototype.close.call(this)},e.isShow=!1,e}(WanfaSceneUIBase);__reflect(YckjSceneUI.prototype,"YckjSceneUI");var YckjView=function(t){function e(){var e=t.call(this,"YckjSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bRule.sound=null,this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bCreate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.bExit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bYq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),this.bStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bAw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.chatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChat,this),this.bFriend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFriend,this);for(var t=1;4>t;t++){var e=this["icon"+t];e.dui.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTc,this)}EventBus.addListener(EventType.FB_TEAM,this.updateTeamList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.bCreate.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this.bExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.bYq.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onYq,this),this.bStart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnter,this),this.bAw.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAw,this),this.chatBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChat,this),this.bFriend.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFriend,this);for(var t=1;4>t;t++){var e=this["icon"+t];e.dui.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTc,this)}EventBus.rmListener(EventType.FB_TEAM,this.updateTeamList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.alphaShow(),this.updateData(),this.updateTeamList()},e.prototype.updateData=function(){var t=this._mc.yckjMgr.cfg,e=Utils.formatTime(t.crossservertime1,"h:s")+" - "+Utils.formatTime(t.crossservertime1+t.time,"h:s");e+="  "+Utils.formatTime(t.crossservertime2,"h:s")+" - "+Utils.formatTime(t.crossservertime2+t.time,"h:s"),e+="\n"+Utils.formatTime(t.crossservertime3,"h:s")+" - "+Utils.formatTime(t.crossservertime3+t.time,"h:s"),e+="  "+Utils.formatTime(t.crossservertime4,"h:s")+" - "+Utils.formatTime(t.crossservertime4+t.time,"h:s"),this.tTime.text=e,this.updateTeamInfo(this._mc.wfMgr.fbTeam)},e.prototype.updateTeamInfo=function(t){if(t){this.infoCon.visible=!0,this.createCon.visible=!1;var e=t[1];e.roleid==GmGlobal.mc.role.roleId?(this.bStart.visible=!0,this.bExit.visible=!1):(this.bStart.visible=!1,this.bExit.visible=!0)}else this.infoCon.visible=!1,this.createCon.visible=!0},e.prototype.isThisFb=function(t){if(!t)return!1;var e=FubenType.getClientType(t[1].fid);return e!=FubenType.YCKJ?!1:!0},e.prototype.updateTeamList=function(){var t=GmGlobal.mc,e=t.wfMgr.fbTeam;if(!this.isThisFb(e))return this.infoCon.visible=!1,void(this.bCreate.visible=!0);this.updateTeamInfo(e);for(var i=!1,s=0;4>s;s++){var o=this["icon"+s],n=e[s+1];if(n){o.icon.visible=!0,o.dui.visible=!1,o.tLv.visible=!0,o.tName.visible=!0,o.roleId=n.roleid,o.tLv.text="Lv."+n.lv,o.tName.text=n.name,o.icon.source=GmConst.MODEL_ICON_DIR+"micon_"+n.career+".png";var r=GmGlobal.mc.setMgr.getXkCfg(n.head||0);o.txk.source="txk_json."+(r?r.icon:"txk"),0==s?(o.dui.visible=!0,n.roleid==GmGlobal.mc.role.roleId&&(i=!0),o.dui.source="com_json.dui"):i&&(o.dui.visible=!0,o.dui.source="com_json.tichu")}else o.icon.visible=!1,o.txk.source="txk_json.txk",o.dui.visible=!1,o.tLv.visible=!1,o.tName.visible=!1;o.updateIconIdx()}},e.prototype.onTc=function(t){var e=t.target.parent.roleId;GmGlobal.cc.dataCtl.doAction(ServerActionId.TAKEOUT,[e])},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,this._mc.yckjMgr.cfg.rule)},e.prototype.onCreate=function(){this._fbId=FubenType.YCKJ+Math.ceil(20*Math.random())-1,GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_CREATE,[this._fbId,this._mc.role.kfFlag])
},e.prototype.onYq=function(){var t=GmGlobal.mc.wfMgr.fbTeam;t&&FubenInvateView.show(t[1].roleid,this._fbId)},e.prototype.onEnter=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_ENTER,null,this.onEnterOk,this)},e.prototype.onEnterOk=function(){CmdBus.doCmd(CmdType.C_YCKJ)},e.prototype.onExit=function(){GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_EXIT,null)},e.prototype.onAw=function(){var t=this._mc.yckjMgr.cfg;CmdBus.doCmd(CmdType.O_JXGC_AW,1,t.items,t.awtxt)},e.prototype.clearTeamData=function(){var t=GmGlobal.mc.wfMgr.fbTeam;if(t&&t[1].fid){var e=FubenType.getClientType(t[1].fid);e==FubenType.YCKJ&&(GmGlobal.mc.wfMgr.fbTeam=null)}},e.prototype.onChat=function(){CmdBus.doCmd(CmdType.O_CHAT)},e.prototype.onFriend=function(){CmdBus.doCmd(CmdType.O_FRIEND)},e.prototype.onClose=function(){var t=GmGlobal.mc.wfMgr.fbTeam;this.isThisFb(t)?MsgBox.confirm("You'll leave the team by closing the screen. Are you sure?",this.doClose,null,this):this.doClose()},e.prototype.doClose=function(){var t=GmGlobal.mc.wfMgr.fbTeam;this.isThisFb(t)&&GmGlobal.cc.dataCtl.doAction(ServerActionId.FB_TEAM_EXIT,null),CmdBus.doCmd(CmdType.C_YCKJ)},e.prototype.close=function(){this.clearTeamData(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mc=null,this._cc=null,RES.destroyRes("yckj_bg_jpg")},e}(UIBase);__reflect(YckjView.prototype,"YckjView");var YcshopController=function(){function t(){var t=GmGlobal.cc.dataCtl;t.regPbCb(PbMsgId.YCSHOP_AW,this.onUpdAwd,this)}return t.prototype.onUpdAwd=function(t){var e=GmGlobal.mc.ycshopMgr;e.price=t.price,e.oprice=t.oprice||0,e.awards=[];for(var i in t.award){var s=new Item(Number(i),t.award[i]);e.awards.push(s)}EventBus.dispatchEvt(EventType.M_YCSHOP_AW)},t}();__reflect(YcshopController.prototype,"YcshopController");var YcshopManager=function(){function t(){this.price=0,this.oprice=0,this.awards=[]}return t}();__reflect(YcshopManager.prototype,"YcshopManager");var YcshopMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.YCSHOP,CmdType.O_YCSHOP),CmdBus.adListener(CmdType.O_YCSHOP,this.onOpenView,this),CmdBus.adListener(CmdType.C_YCSHOP,this.onCloseView,this),EventBus.addListener(EventType.M_YCSHOP_AW,this.onOpenView,this)}return t.prototype.onOpenView=function(){if(!PFConst.IS_NOPAY){var t=this;setTimeout(function(){t.doOpenView()},1e3)}},t.prototype.doOpenView=function(){this._view||(this._view=new YcshopView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(YcshopMediator.prototype,"YcshopMediator",["IMediator"]);var YcshopView=function(t){function e(){var e=t.call(this,"YcshopSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updui(),this.alphaShow()},e.prototype.updui=function(){var t=this._mc.ycshopMgr.price,e=this._mc.ycshopMgr.awards;this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(e,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0)),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,this.okBtn.setPrice(this._mc.ycshopMgr.oprice,t)},e.prototype.onOkBtn=function(){this._cc.pfCtl.Pay(100*this._mc.ycshopMgr.price,6),this.onClose()},e.prototype.clearItem=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_YCSHOP)},e.prototype.close=function(){this.clearItem(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("ycshop_bg_jpg")},e}(UIBase);__reflect(YcshopView.prototype,"YcshopView");var YiyuanController=function(){function t(){EventBus.addListener(EventType.M_JUPD+JsonID.U_YIYUAN,this.onUpd,this)}return t.prototype.onUpd=function(t){var e=t.data.data,i=GmGlobal.mc.yiyuanMgr;i.state=e.s||0,EventBus.dispatchEvt(EventType.M_YIYUAN)},t}();__reflect(YiyuanController.prototype,"YiyuanController");var YiyuanManager=function(){function t(){this.state=0,GmGlobal.mc.regUnzipCfg("c_yiyuan.json",this.initCfg,this)}return t.prototype.initCfg=function(t){this.cfgs=t},t}();__reflect(YiyuanManager.prototype,"YiyuanManager");var YiyuanMediator=function(){function t(){GmGlobal.mc.muiMgr.regCmd(ModelID.YIYUAN,CmdType.O_YIYUAN),CmdBus.adListener(CmdType.O_YIYUAN,this.onOpenView,this),CmdBus.adListener(CmdType.C_YIYUAN,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon()},t.prototype.updateIcon=function(){if(!PFConst.IS_NOPAY){var t=GmGlobal.mc.yiyuanMgr.state;2>t?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.YIYUAN,"mui_json.mui_b_1yuan"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.YIYUAN)}},t.prototype.updateRedDot=function(){},t.prototype.onOpenView=function(t){this.doOpenView()},t.prototype.doOpenView=function(){this._view||(this._view=new YiyuanView),this._view.isShow||(this._view.show(GmGlobal.vmc.uiLayer),GmGlobal.vmc.regDelayDestroy(this))},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&this._view.alphaClose(this._view.close,this._view),t>=0&&CmdBus.doCmd(t)},t.prototype.destroy=function(){return this._view?this._view&&this._view.isDestroy()?(this._view.destroy(),this._view=null,!0):!1:!0},t}();__reflect(YiyuanMediator.prototype,"YiyuanMediator",["IMediator"]);var YiyuanView=function(t){function e(){var e=t.call(this,"YiyuanSkin")||this;return e._mc=GmGlobal.mc,e._cc=GmGlobal.cc,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi"},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),EventBus.addListener(EventType.M_YIYUAN,this.updBtn,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onOkBtn,this),EventBus.rmListener(EventType.M_YIYUAN,this.updBtn,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updui(),this.alphaShow()},e.prototype.updui=function(){var t=this._mc.yiyuanMgr.cfgs.items;this._itemGridCon||(this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(t,115,!1,!0,!1),this._itemGridCon.addToParent(10,0,this.itemIconCon,this.itemTxtCon),this._itemGridCon.setTouchCb(!0)),this._itemGridCon.textAlign=egret.HorizontalAlign.CENTER,this.updBtn()},e.prototype.updBtn=function(){this._mc.yiyuanMgr.state?(this.buyBtn.visible=!1,this.okBtn.visible=!0,1==this._mc.yiyuanMgr.state?this.okBtn.label="Claimable":2==this._mc.yiyuanMgr.state&&(this.okBtn.label="Claimed",Utils.setBtnEnable(this.okBtn,!1))):(this.buyBtn.visible=!0,this.okBtn.visible=!1,this.buyBtn.setPrice(this._mc.yiyuanMgr.cfgs.oprice,this._mc.yiyuanMgr.cfgs.price))},e.prototype.onBuy=function(){this._cc.pfCtl.Pay(100*this._mc.yiyuanMgr.cfgs.price,8)},e.prototype.onOkBtn=function(){1==this._mc.yiyuanMgr.state&&this._cc.dataCtl.doAction(ServerActionId.YIYUAN_AWD)},e.prototype.clearItem=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_YIYUAN)},e.prototype.close=function(){this.clearItem(),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("yiy_bg_jpg")},e}(UIBase);__reflect(YiyuanView.prototype,"YiyuanView");var ZlbJfItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.cfg.award,90,!1,!0,!0),this._itemGridCon.addToParent(20,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0);var t=Math.min(this.data.czl,this.data.cfg.num);this.tName.text="Power Increase "+t+"/"+this.data.cfg.num,2==this.data.state?(this.ywc.visible=!0,this.bLq.visible=!1):(this.ywc.visible=!1,this.bLq.visible=!0,t>=this.data.cfg.num?Utils.setBtnEnable(this.bLq,!0):Utils.setBtnEnable(this.bLq,!1))},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(ZlbJfItem.prototype,"ZlbJfItem");var ZlbManager=function(){function t(){GmGlobal.mc.regUnzipCfg("c_zlincreaserank.json",this.initCfg,this);var t={0:0,1:0};this.redDot=RedDot.initRedDot(t),GmGlobal.mc.muiMgr.regRedDot(ModelID.ZLB,this.redDot)}return t.prototype.initCfg=function(t){this.cfgs=t},t}();__reflect(ZlbManager.prototype,"ZlbManager");var ZlbMediator=function(){function t(){this._isShowUI=!1,GmGlobal.mc.muiMgr.regCmd(ModelID.ZLB,CmdType.O_ZLB),CmdBus.adListener(CmdType.O_ZLB,this.onOpenView,this),CmdBus.adListener(CmdType.C_ZLB,this.onCloseView,this),EventBus.addListener(EventType.M_MUI_READY,this.onMainUIOk,this),EventBus.addListener(EventType.M_JUPD+JsonID.ZLB,this.onUpd,this)}return t.prototype.onMainUIOk=function(){EventBus.rmListener(EventType.M_MUI_READY,this.onMainUIOk,this),this.updateIcon(!0)},t.prototype.updateIcon=function(t){void 0===t&&(t=!1);var e=GmGlobal.mc.dataMgr.getJData(JsonID.ZLB).data,i=e.t||0,s=Math.max(i-GmGlobal.getServerTime(),0);s>0?CmdBus.doCmd(CmdType.AD_M_ICON,ModelID.ZLB,"mui_json.mui_b_zlb"):CmdBus.doCmd(CmdType.RM_M_ICON,ModelID.ZLB)},t.prototype.onOpenView=function(){this._view||(this._view=new ZlbView),this._view.isShow||this._view.show(GmGlobal.vmc.uiLayer),this._view.selTab(0)},t.prototype.onCloseView=function(t){this._view&&this._view.isShow&&(this._view.alphaClose(this._view.closeAndDestroy,this._view),this._view=null)},t.prototype.onUpd=function(t){this._isShowUI||(this._isShowUI=!0,this.updateIcon());var e=GmGlobal.mc,i=e.zlbMgr.cfgs,s=e.dataMgr.getJData(JsonID.ZLB).data,o=s.zlts||0,n=e.zlbMgr.redDot.childs[1];n.state=0;for(var r in i.zlinaw){var h=i.zlinaw[r];!(o>=h.num)||s.award&&s.award[r]||(n.state=1)}EventBus.dispatchEvt(EventType.ZLB_UPD)},t}();__reflect(ZlbMediator.prototype,"ZlbMediator");var ZlbRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.ywc.visible=!1,this.bLq.visible=!1;var t="No. "+this.data.rank+" Power Increase";this.data.name&&(t+=" "+this.data.name+" "),this.data.zl&&(t+="(Power Increase:"+this.data.zl+")"),this.tName.text=t,this.clearItems(),this._itemGridCon=ItemGridCon.create(),this._itemGridCon.initGridsByItems(this.data.items,90,!1,!0,!0),this._itemGridCon.addToParent(20,0,this.iconCon,this.textCon),this._itemGridCon.setTouchCb(!0)},e.prototype.clearItems=function(){this._itemGridCon&&(ItemGridCon.release(this._itemGridCon),this._itemGridCon=null)},e}(eui.ItemRenderer);__reflect(ZlbRankItem.prototype,"ZlbRankItem");var ZlbView=function(t){function e(){var e=t.call(this,"ZlbSkin")||this;return e._tabIndex=-1,e._reqTimer=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bClose.sound="ui_guanbi",this.scoll.verticalScrollBar&&(this.scoll.verticalScrollBar.autoVisibility=!1),this.scoll.horizontalScrollBar&&(this.scoll.horizontalScrollBar.autoVisibility=!1),this._array=new eui.ArrayCollection,this.itemList.dataProvider=this._array},e.prototype.updatePos=function(){UIBase.center(this)},e.prototype.addEvts=function(){this.bClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.scoll.addEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this),this.itemList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bRule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.addListener(EventType.ZLB_UPD,this.updateAwList,this)},e.prototype.rmEvts=function(){this.bClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.tableBgCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelTable,this),this.scoll.removeEventListener(eui.UIEvent.CHANGE_END,this.onScrollChangeEnd,this),this.itemList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this),this.bRule.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),EventBus.rmListener(EventType.ZLB_UPD,this.updateAwList,this)},e.prototype.show=function(e){t.prototype.show.call(this,e,!0),this.updateTabRedDot(),this.bindRedDotCb();var i=GmGlobal.mc.dataMgr.getJData(JsonID.ZLB).data,s=(i.t||0)-GmGlobal.getServerTime();0>=s?this.onEnd():CDText.getInstence().addCD(this.tTime,s,"Event Countdown: ","DD h:m:s","",this.onEnd,this);var o=GmGlobal.mc.rankMgr.getRank(RankID.ZLB);o.myRank?this.tMyRank.text=o.myRank.toString():this.tMyRank.text="Unranked",this.tMyZlts.text=""+(i.zlts||0)},e.prototype.onEnd=function(){this.tTime.text="Event ended"},e.prototype.onSelTable=function(t){if(t.target.parent==this.tableBgCon){var e=this.tableBgCon.getChildIndex(t.target);if(e==this._tabIndex)return;this.selTab(e)}},e.prototype.selTab=function(t){if(t!=this._tabIndex){this.tableBgCon.getChildAt(t);this._tabIndex=t,this.updateSelState(),this.setPage()}},e.prototype.updateSelState=function(){for(var t=0;2>t;t++){var e=this.tableBgCon.getChildAt(t);t==this._tabIndex?e.source="com_json.tab_ui1":e.source="com_json.tab_ui0"}},e.prototype.setPage=function(){this._array.removeAll(),this.scoll.stopAnimation(),this.scoll.viewport.scrollV=0;var t=GmGlobal.mc,e=t.zlbMgr.cfgs;if(0==this._tabIndex){this.itemList.itemRendererSkinName="ZlbItemSkin",this.itemList.itemRenderer=ZlbRankItem;for(var i=0;i<e.rankaw.length;i++)this._array.addItem({rank:i+1,items:e.rankaw[i],zl:0});this.itemList.validateNow(),this.updateRankList()}else this.itemList.itemRendererSkinName="ZlbItemSkin",this.itemList.itemRenderer=ZlbJfItem,this.updateAwList()},e.prototype.updateAwList=function(){if(1==this._tabIndex){var t=GmGlobal.mc,e=t.zlbMgr.cfgs,i=t.dataMgr.getJData(JsonID.ZLB).data,s=0;for(var o in e.zlinaw){var n={id:Number(o),czl:i.zlts||0,cfg:e.zlinaw[o],state:i.award?i.award[o]:0};s<this._array.length?this._array.replaceItemAt(n,s):this._array.addItem(n),s++}}},e.prototype.onScrollChangeEnd=function(t){0!=this._reqTimer&&egret.clearTimeout(this._reqTimer),this._reqTimer=egret.setTimeout(this.updateRankList,this,1e3)},e.prototype.updateRankList=function(){this._reqTimer=0;for(var t=GmGlobal.mc.rankMgr.getRank(RankID.ZLB),e=[],i=0;i<this.itemList.numChildren;i++){var s=this.itemList.getChildAt(i),o=s.data,n=t.getDataByRank(o.rank);n?(o.zl=n.data,o.name=n.name,this._array.replaceItemAt(o,o.rank-1)):e.push(s.data.rank)}e.length>0&&GmGlobal.cc.rankCtl.getRankDataBuyList(RankID.ZLB,e,null,this.onRankRet,this)},e.prototype.onRankRet=function(t){for(var e=0;e<this.itemList.numChildren;e++){var i=this.itemList.getChildAt(e),s=i.data,o=t.getDataByRank(s.rank);o&&(s.zl=o.data,s.name=o.name,this._array.replaceItemAt(s,s.rank-1))}},e.prototype.onTouchList=function(t){if("btn"==t.target.name){var e=t.target.parent.data;GmGlobal.cc.dataCtl.doAction(ServerActionId.ZLB,[e.id])}},e.prototype.updateTabRedDot=function(){for(var t=GmGlobal.mc.zlbMgr.redDot,e=0;2>e;e++){var i=this.tableBgCon.getChildAt(e),s=t.childs[e];if(1==s.state){var o=190*(e+1)+10*e-20;RedDotView.addRedDot(i,this.tableBgCon,"zlb",o,-4)}else RedDotView.removeRedDot(i)}},e.prototype.bindRedDotCb=function(){for(var t=GmGlobal.mc.zlbMgr.redDot,e=0;2>e;e++){var i=t.childs[e];i.bindChangeCB(this.updateTabRedDot,this)}},e.prototype.unbindRedDotCb=function(){for(var t=GmGlobal.mc.zlbMgr.redDot,e=0;2>e;e++){var i=t.childs[e];i.unbindChangeCB(this.updateTabRedDot,this)}},e.prototype.onRule=function(){CmdBus.doCmd(CmdType.O_RULE,GmGlobal.mc.zlbMgr.cfgs.rule)},e.prototype.clearItems=function(){for(var t=0;t<this.itemList.numChildren;t++)if(0==this._tabIndex){var e=this.itemList.getChildAt(t);e.clearItems()}else{var e=this.itemList.getChildAt(t);e.clearItems()}this._array.removeAll()},e.prototype.onClose=function(){CmdBus.doCmd(CmdType.C_ZLB)},e.prototype.close=function(){this.clearItems(),0!=this._reqTimer&&(egret.clearTimeout(this._reqTimer),this._reqTimer=0),RedDotView.removeRedDotByGroup("zlb"),this.unbindRedDotCb(),CDText.getInstence().rmCD(this.tTime),t.prototype.close.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes("zlb_bg_jpg")},e}(UIBase);__reflect(ZlbView.prototype,"ZlbView");